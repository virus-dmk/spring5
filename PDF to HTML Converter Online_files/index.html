
<!-- saved from url=(0088)https://www.pdf.investintech.com/preview/52cc2c04-22f2-11ea-a5fd-0cc47a792c0a/index.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<style type="text/css">
<!--
span.cls_003{font-family:Arial,serif;font-size:21.7px;color:rgb(254,255,255);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_003{font-family:Arial,serif;font-size:21.7px;color:rgb(254,255,255);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_004{font-family:Arial,serif;font-size:22.9px;color:rgb(254,255,255);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_004{font-family:Arial,serif;font-size:22.9px;color:rgb(254,255,255);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_005{font-family:Arial,serif;font-size:25.1px;color:rgb(254,255,255);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_005{font-family:Arial,serif;font-size:25.1px;color:rgb(254,255,255);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_002{font-family:Arial,serif;font-size:13.1px;color:rgb(56,42,37);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_002{font-family:Arial,serif;font-size:13.1px;color:rgb(56,42,37);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_006{font-family:Times,serif;font-size:12.1px;color:rgb(255,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_006{font-family:Times,serif;font-size:12.1px;color:rgb(255,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_007{font-family:Times,serif;font-size:13.1px;color:rgb(70,106,133);font-weight:bold;font-style:italic;text-decoration: none}
div.cls_007{font-family:Times,serif;font-size:13.1px;color:rgb(70,106,133);font-weight:bold;font-style:italic;text-decoration: none}
span.cls_008{font-family:Times,serif;font-size:13.1px;color:rgb(70,106,133);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_008{font-family:Times,serif;font-size:13.1px;color:rgb(70,106,133);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_009{font-family:Times,serif;font-size:11.0px;color:rgb(0,0,0);font-weight:normal;font-style:italic;text-decoration: none}
div.cls_009{font-family:Times,serif;font-size:11.0px;color:rgb(0,0,0);font-weight:normal;font-style:italic;text-decoration: none}
span.cls_010{font-family:Times,serif;font-size:11.0px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_010{font-family:Times,serif;font-size:11.0px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_011{font-family:Times,serif;font-size:11.0px;color:rgb(0,27,166);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_011{font-family:Times,serif;font-size:11.0px;color:rgb(0,27,166);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_013{font-family:Times,serif;font-size:46.1px;color:rgb(70,106,133);font-weight:normal;font-style:italic;text-decoration: none}
div.cls_013{font-family:Times,serif;font-size:46.1px;color:rgb(70,106,133);font-weight:normal;font-style:italic;text-decoration: none}
span.cls_014{font-family:Times,serif;font-size:30.1px;color:rgb(70,106,133);font-weight:normal;font-style:italic;text-decoration: none}
div.cls_014{font-family:Times,serif;font-size:30.1px;color:rgb(70,106,133);font-weight:normal;font-style:italic;text-decoration: none}
span.cls_015{font-family:Times,serif;font-size:18.1px;color:rgb(153,153,153);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_015{font-family:Times,serif;font-size:18.1px;color:rgb(153,153,153);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_016{font-family:Times,serif;font-size:14.5px;color:rgb(153,153,153);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_016{font-family:Times,serif;font-size:14.5px;color:rgb(153,153,153);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_017{font-family:Times,serif;font-size:14.0px;color:rgb(37,37,37);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_017{font-family:Times,serif;font-size:14.0px;color:rgb(37,37,37);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_018{font-family:Times,serif;font-size:11.3px;color:rgb(37,37,37);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_018{font-family:Times,serif;font-size:11.3px;color:rgb(37,37,37);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_019{font-family:Arial,serif;font-size:12.1px;color:rgb(37,37,37);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_019{font-family:Arial,serif;font-size:12.1px;color:rgb(37,37,37);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_020{font-family:Arial,serif;font-size:10.6px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_020{font-family:Arial,serif;font-size:10.6px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_021{font-family:Arial,serif;font-size:8.5px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_021{font-family:Arial,serif;font-size:8.5px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_022{font-family:Times,serif;font-size:9.1px;color:rgb(37,37,37);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_022{font-family:Times,serif;font-size:9.1px;color:rgb(37,37,37);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_023{font-family:Times,serif;font-size:9.1px;color:rgb(0,27,166);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_023{font-family:Times,serif;font-size:9.1px;color:rgb(0,27,166);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_025{font-family:Times,serif;font-size:14.0px;color:rgb(153,153,153);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_025{font-family:Times,serif;font-size:14.0px;color:rgb(153,153,153);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_026{font-family:Times,serif;font-size:11.3px;color:rgb(153,153,153);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_026{font-family:Times,serif;font-size:11.3px;color:rgb(153,153,153);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_027{font-family:"Book Antiqua",serif;font-size:10.1px;color:rgb(0,0,0);font-weight:normal;font-style:italic;text-decoration: none}
div.cls_027{font-family:"Book Antiqua",serif;font-size:10.1px;color:rgb(0,0,0);font-weight:normal;font-style:italic;text-decoration: none}
span.cls_028{font-family:Arial,serif;font-size:6.1px;color:rgb(204,166,88);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_028{font-family:Arial,serif;font-size:6.1px;color:rgb(204,166,88);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_029{font-family:Times,serif;font-size:11.0px;color:rgb(37,37,37);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_029{font-family:Times,serif;font-size:11.0px;color:rgb(37,37,37);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_024{font-family:Times,serif;font-size:9.1px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_024{font-family:Times,serif;font-size:9.1px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_030{font-family:Arial,serif;font-size:8.0px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_030{font-family:Arial,serif;font-size:8.0px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_031{font-family:Times,serif;font-size:9.5px;color:rgb(37,37,37);font-weight:normal;font-style:italic;text-decoration: none}
div.cls_031{font-family:Times,serif;font-size:9.5px;color:rgb(37,37,37);font-weight:normal;font-style:italic;text-decoration: none}
span.cls_032{font-family:Times,serif;font-size:16.1px;color:rgb(153,153,153);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_032{font-family:Times,serif;font-size:16.1px;color:rgb(153,153,153);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_033{font-family:Times,serif;font-size:12.8px;color:rgb(153,153,153);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_033{font-family:Times,serif;font-size:12.8px;color:rgb(153,153,153);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_035{font-family:Times,serif;font-size:13.1px;color:rgb(37,37,37);font-weight:bold;font-style:italic;text-decoration: none}
div.cls_035{font-family:Times,serif;font-size:13.1px;color:rgb(37,37,37);font-weight:bold;font-style:italic;text-decoration: none}
span.cls_034{font-family:Times,serif;font-size:36.1px;color:rgb(204,166,88);font-weight:normal;font-style:italic;text-decoration: none}
div.cls_034{font-family:Times,serif;font-size:36.1px;color:rgb(204,166,88);font-weight:normal;font-style:italic;text-decoration: none}
span.cls_036{font-family:Times,serif;font-size:10.1px;color:rgb(37,37,37);font-weight:normal;font-style:italic;text-decoration: none}
div.cls_036{font-family:Times,serif;font-size:10.1px;color:rgb(37,37,37);font-weight:normal;font-style:italic;text-decoration: none}
span.cls_037{font-family:Arial,serif;font-size:4.0px;color:rgb(204,166,88);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_037{font-family:Arial,serif;font-size:4.0px;color:rgb(204,166,88);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_038{font-family:Times,serif;font-size:11.0px;color:rgb(37,37,37);font-weight:normal;font-style:italic;text-decoration: none}
div.cls_038{font-family:Times,serif;font-size:11.0px;color:rgb(37,37,37);font-weight:normal;font-style:italic;text-decoration: none}
span.cls_039{font-family:Times,serif;font-size:10.1px;color:rgb(37,37,37);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_039{font-family:Times,serif;font-size:10.1px;color:rgb(37,37,37);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_040{font-family:Arial,serif;font-size:12.5px;color:rgb(70,106,133);font-weight:normal;font-style:italic;text-decoration: none}
div.cls_040{font-family:Arial,serif;font-size:12.5px;color:rgb(70,106,133);font-weight:normal;font-style:italic;text-decoration: none}
span.cls_041{font-family:Arial,serif;font-size:5.0px;color:rgb(204,166,88);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_041{font-family:Arial,serif;font-size:5.0px;color:rgb(204,166,88);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_042{font-family:Courier New,serif;font-size:9.1px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_042{font-family:Courier New,serif;font-size:9.1px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_043{font-family:Courier New,serif;font-size:9.1px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_043{font-family:Courier New,serif;font-size:9.1px;color:rgb(0,0,0);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_044{font-family:Arial,serif;font-size:12.1px;color:rgb(179,179,179);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_044{font-family:Arial,serif;font-size:12.1px;color:rgb(179,179,179);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_045{font-family:Times,serif;font-size:10.1px;color:rgb(0,27,166);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_045{font-family:Times,serif;font-size:10.1px;color:rgb(0,27,166);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_046{font-family:Times,serif;font-size:8.0px;color:rgb(37,37,37);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_046{font-family:Times,serif;font-size:8.0px;color:rgb(37,37,37);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_047{font-family:Times,serif;font-size:48.1px;color:rgb(70,106,133);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_047{font-family:Times,serif;font-size:48.1px;color:rgb(70,106,133);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_049{font-family:Arial,serif;font-size:12.1px;color:rgb(70,106,133);font-weight:normal;font-style:italic;text-decoration: none}
div.cls_049{font-family:Arial,serif;font-size:12.1px;color:rgb(70,106,133);font-weight:normal;font-style:italic;text-decoration: none}
span.cls_050{font-family:Arial,serif;font-size:8.6px;color:rgb(70,106,133);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_050{font-family:Arial,serif;font-size:8.6px;color:rgb(70,106,133);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_051{font-family:"Book Antiqua",serif;font-size:10.1px;color:rgb(70,106,133);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_051{font-family:"Book Antiqua",serif;font-size:10.1px;color:rgb(70,106,133);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_048{font-family:Times,serif;font-size:9.1px;color:rgb(101,101,101);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_048{font-family:Times,serif;font-size:9.1px;color:rgb(101,101,101);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_052{font-family:Times,serif;font-size:9.1px;color:rgb(37,37,37);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_052{font-family:Times,serif;font-size:9.1px;color:rgb(37,37,37);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_053{font-family:Arial,serif;font-size:8.0px;color:rgb(101,101,101);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_053{font-family:Arial,serif;font-size:8.0px;color:rgb(101,101,101);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_054{font-family:Arial,serif;font-size:6.4px;color:rgb(101,101,101);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_054{font-family:Arial,serif;font-size:6.4px;color:rgb(101,101,101);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_055{font-family:Times,serif;font-size:9.1px;color:rgb(101,101,101);font-weight:bold;font-style:italic;text-decoration: none}
div.cls_055{font-family:Times,serif;font-size:9.1px;color:rgb(101,101,101);font-weight:bold;font-style:italic;text-decoration: none}
span.cls_056{font-family:Arial,serif;font-size:8.1px;color:rgb(54,53,53);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_056{font-family:Arial,serif;font-size:8.1px;color:rgb(54,53,53);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_057{font-family:Arial,serif;font-size:7.0px;color:rgb(54,53,53);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_057{font-family:Arial,serif;font-size:7.0px;color:rgb(54,53,53);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_058{font-family:Arial,serif;font-size:7.0px;color:rgb(54,53,53);font-weight:normal;font-style:italic;text-decoration: none}
div.cls_058{font-family:Arial,serif;font-size:7.0px;color:rgb(54,53,53);font-weight:normal;font-style:italic;text-decoration: none}
span.cls_059{font-family:Courier New,serif;font-size:9.1px;color:rgb(37,37,37);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_059{font-family:Courier New,serif;font-size:9.1px;color:rgb(37,37,37);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_060{font-family:Courier New,serif;font-size:8.0px;color:rgb(37,37,37);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_060{font-family:Courier New,serif;font-size:8.0px;color:rgb(37,37,37);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_061{font-family:Courier New,serif;font-size:8.0px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_061{font-family:Courier New,serif;font-size:8.0px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_062{font-family:Arial,serif;font-size:8.6px;color:rgb(204,166,88);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_062{font-family:Arial,serif;font-size:8.6px;color:rgb(204,166,88);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_063{font-family:Arial,serif;font-size:10.6px;color:rgb(70,106,133);font-weight:normal;font-style:italic;text-decoration: none}
div.cls_063{font-family:Arial,serif;font-size:10.6px;color:rgb(70,106,133);font-weight:normal;font-style:italic;text-decoration: none}
span.cls_064{font-family:Arial,serif;font-size:9.5px;color:rgb(70,106,133);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_064{font-family:Arial,serif;font-size:9.5px;color:rgb(70,106,133);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_065{font-family:Arial,serif;font-size:7.6px;color:rgb(70,106,133);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_065{font-family:Arial,serif;font-size:7.6px;color:rgb(70,106,133);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_066{font-family:Arial,serif;font-size:9.1px;color:rgb(255,255,255);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_066{font-family:Arial,serif;font-size:9.1px;color:rgb(255,255,255);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_067{font-family:Arial,serif;font-size:9.1px;color:rgb(101,101,101);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_067{font-family:Arial,serif;font-size:9.1px;color:rgb(101,101,101);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_068{font-family:Arial,serif;font-size:9.1px;color:rgb(54,53,53);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_068{font-family:Arial,serif;font-size:9.1px;color:rgb(54,53,53);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_069{font-family:Times,serif;font-size:6.5px;color:rgb(37,37,37);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_069{font-family:Times,serif;font-size:6.5px;color:rgb(37,37,37);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_070{font-family:Times,serif;font-size:5.6px;color:rgb(37,37,37);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_070{font-family:Times,serif;font-size:5.6px;color:rgb(37,37,37);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_071{font-family:Times,serif;font-size:8.6px;color:rgb(37,37,37);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_071{font-family:Times,serif;font-size:8.6px;color:rgb(37,37,37);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_072{font-family:Times,serif;font-size:8.6px;color:rgb(37,37,37);font-weight:normal;font-style:italic;text-decoration: none}
div.cls_072{font-family:Times,serif;font-size:8.6px;color:rgb(37,37,37);font-weight:normal;font-style:italic;text-decoration: none}
span.cls_073{font-family:Arial,serif;font-size:8.0px;color:rgb(255,255,255);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_073{font-family:Arial,serif;font-size:8.0px;color:rgb(255,255,255);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_074{font-family:"Book Antiqua",serif;font-size:8.0px;color:rgb(37,37,37);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_074{font-family:"Book Antiqua",serif;font-size:8.0px;color:rgb(37,37,37);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_075{font-family:Arial,serif;font-size:10.6px;color:rgb(70,106,133);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_075{font-family:Arial,serif;font-size:10.6px;color:rgb(70,106,133);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_076{font-family:"Book Antiqua",serif;font-size:9.5px;color:rgb(37,37,37);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_076{font-family:"Book Antiqua",serif;font-size:9.5px;color:rgb(37,37,37);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_077{font-family:Courier New,serif;font-size:9.5px;color:rgb(255,255,255);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_077{font-family:Courier New,serif;font-size:9.5px;color:rgb(255,255,255);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_078{font-family:Courier New,serif;font-size:9.1px;color:rgb(70,106,133);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_078{font-family:Courier New,serif;font-size:9.1px;color:rgb(70,106,133);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_079{font-family:Arial,serif;font-size:8.1px;color:rgb(54,53,53);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_079{font-family:Arial,serif;font-size:8.1px;color:rgb(54,53,53);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_080{font-family:Arial,serif;font-size:11.1px;color:rgb(54,53,53);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_080{font-family:Arial,serif;font-size:11.1px;color:rgb(54,53,53);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_081{font-family:Arial,serif;font-size:9.1px;color:rgb(54,53,53);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_081{font-family:Arial,serif;font-size:9.1px;color:rgb(54,53,53);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_082{font-family:Courier New,serif;font-size:7.1px;color:rgb(54,53,53);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_082{font-family:Courier New,serif;font-size:7.1px;color:rgb(54,53,53);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_083{font-family:Arial,serif;font-size:8.6px;color:rgb(70,106,133);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_083{font-family:Arial,serif;font-size:8.6px;color:rgb(70,106,133);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_084{font-family:Arial,serif;font-size:8.0px;color:rgb(101,101,101);font-weight:normal;font-style:italic;text-decoration: none}
div.cls_084{font-family:Arial,serif;font-size:8.0px;color:rgb(101,101,101);font-weight:normal;font-style:italic;text-decoration: none}
span.cls_085{font-family:Arial,serif;font-size:5.2px;color:rgb(255,255,255);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_085{font-family:Arial,serif;font-size:5.2px;color:rgb(255,255,255);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_086{font-family:"Book Antiqua",serif;font-size:7.0px;color:rgb(37,37,37);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_086{font-family:"Book Antiqua",serif;font-size:7.0px;color:rgb(37,37,37);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_087{font-family:Courier New,serif;font-size:8.3px;color:rgb(101,101,101);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_087{font-family:Courier New,serif;font-size:8.3px;color:rgb(101,101,101);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_088{font-family:Arial,serif;font-size:7.1px;color:rgb(54,53,53);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_088{font-family:Arial,serif;font-size:7.1px;color:rgb(54,53,53);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_089{font-family:Arial,serif;font-size:7.1px;color:rgb(54,53,53);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_089{font-family:Arial,serif;font-size:7.1px;color:rgb(54,53,53);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_090{font-family:Arial,serif;font-size:12.1px;color:rgb(54,53,53);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_090{font-family:Arial,serif;font-size:12.1px;color:rgb(54,53,53);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_091{font-family:Courier New,serif;font-size:8.3px;color:rgb(255,255,255);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_091{font-family:Courier New,serif;font-size:8.3px;color:rgb(255,255,255);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_092{font-family:"Book Antiqua",serif;font-size:9.5px;color:rgb(37,37,37);font-weight:normal;font-style:italic;text-decoration: none}
div.cls_092{font-family:"Book Antiqua",serif;font-size:9.5px;color:rgb(37,37,37);font-weight:normal;font-style:italic;text-decoration: none}
span.cls_093{font-family:Arial,serif;font-size:8.1px;color:rgb(54,53,53);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_093{font-family:Arial,serif;font-size:8.1px;color:rgb(54,53,53);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_094{font-family:Arial,serif;font-size:7.0px;color:rgb(54,53,53);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_094{font-family:Arial,serif;font-size:7.0px;color:rgb(54,53,53);font-weight:bold;font-style:normal;text-decoration: none}
span.cls_095{font-family:Arial,serif;font-size:7.0px;color:rgb(43,42,41);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_095{font-family:Arial,serif;font-size:7.0px;color:rgb(43,42,41);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_096{font-family:Arial,serif;font-size:6.0px;color:rgb(54,53,53);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_096{font-family:Arial,serif;font-size:6.0px;color:rgb(54,53,53);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_097{font-family:Arial,serif;font-size:6.0px;color:rgb(54,53,53);font-weight:normal;font-style:italic;text-decoration: none}
div.cls_097{font-family:Arial,serif;font-size:6.0px;color:rgb(54,53,53);font-weight:normal;font-style:italic;text-decoration: none}
span.cls_098{font-family:Arial,serif;font-size:6.1px;color:rgb(54,53,53);font-weight:normal;font-style:italic;text-decoration: none}
div.cls_098{font-family:Arial,serif;font-size:6.1px;color:rgb(54,53,53);font-weight:normal;font-style:italic;text-decoration: none}
span.cls_099{font-family:Times,serif;font-size:12.1px;color:rgb(37,37,37);font-weight:normal;font-style:italic;text-decoration: none}
div.cls_099{font-family:Times,serif;font-size:12.1px;color:rgb(37,37,37);font-weight:normal;font-style:italic;text-decoration: none}
span.cls_100{font-family:Times,serif;font-size:8.6px;color:rgb(0,27,166);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_100{font-family:Times,serif;font-size:8.6px;color:rgb(0,27,166);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_101{font-family:Arial,serif;font-size:6.1px;color:rgb(54,53,53);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_101{font-family:Arial,serif;font-size:6.1px;color:rgb(54,53,53);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_102{font-family:Arial,serif;font-size:5.1px;color:rgb(54,53,53);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_102{font-family:Arial,serif;font-size:5.1px;color:rgb(54,53,53);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_103{font-family:Courier New,serif;font-size:7.0px;color:rgb(54,53,53);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_103{font-family:Courier New,serif;font-size:7.0px;color:rgb(54,53,53);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_104{font-family:Courier New,serif;font-size:8.0px;color:rgb(0,0,0);font-weight:normal;font-style:italic;text-decoration: none}
div.cls_104{font-family:Courier New,serif;font-size:8.0px;color:rgb(0,0,0);font-weight:normal;font-style:italic;text-decoration: none}
span.cls_105{font-family:Arial,serif;font-size:6.6px;color:rgb(54,53,53);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_105{font-family:Arial,serif;font-size:6.6px;color:rgb(54,53,53);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_106{font-family:Arial,serif;font-size:5.6px;color:rgb(54,53,53);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_106{font-family:Arial,serif;font-size:5.6px;color:rgb(54,53,53);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_135{font-family:Arial,serif;font-size:5.6px;color:rgb(54,53,53);font-weight:normal;font-style:normal;text-decoration: underline}
div.cls_135{font-family:Arial,serif;font-size:5.6px;color:rgb(54,53,53);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_107{font-family:Times,serif;font-size:10.1px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_107{font-family:Times,serif;font-size:10.1px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_108{font-family:Times,serif;font-size:9.1px;color:rgb(0,0,0);font-weight:bold;font-style:italic;text-decoration: none}
div.cls_108{font-family:Times,serif;font-size:9.1px;color:rgb(0,0,0);font-weight:bold;font-style:italic;text-decoration: none}
span.cls_109{font-family:Arial,serif;font-size:6.4px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_109{font-family:Arial,serif;font-size:6.4px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_110{font-family:"Book Antiqua",serif;font-size:8.0px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_110{font-family:"Book Antiqua",serif;font-size:8.0px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_111{font-family:Arial,serif;font-size:8.0px;color:rgb(0,0,0);font-weight:normal;font-style:italic;text-decoration: none}
div.cls_111{font-family:Arial,serif;font-size:8.0px;color:rgb(0,0,0);font-weight:normal;font-style:italic;text-decoration: none}
span.cls_112{font-family:Arial,serif;font-size:10.1px;color:rgb(70,106,133);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_112{font-family:Arial,serif;font-size:10.1px;color:rgb(70,106,133);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_113{font-family:Times,serif;font-size:9.1px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_113{font-family:Times,serif;font-size:9.1px;color:rgb(0,0,0);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_114{font-family:Times,serif;font-size:9.1px;color:rgb(37,37,37);font-weight:normal;font-style:italic;text-decoration: none}
div.cls_114{font-family:Times,serif;font-size:9.1px;color:rgb(37,37,37);font-weight:normal;font-style:italic;text-decoration: none}
span.cls_115{font-family:Times,serif;font-size:9.1px;color:rgb(0,0,0);font-weight:normal;font-style:italic;text-decoration: none}
div.cls_115{font-family:Times,serif;font-size:9.1px;color:rgb(0,0,0);font-weight:normal;font-style:italic;text-decoration: none}
span.cls_119{font-family:Arial,serif;font-size:10.1px;color:rgb(43,42,41);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_119{font-family:Arial,serif;font-size:10.1px;color:rgb(43,42,41);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_117{font-family:Arial,serif;font-size:28.6px;color:rgb(198,195,150);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_117{font-family:Arial,serif;font-size:28.6px;color:rgb(198,195,150);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_118{font-family:Arial,serif;font-size:19.4px;color:rgb(158,158,158);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_118{font-family:Arial,serif;font-size:19.4px;color:rgb(158,158,158);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_120{font-family:"Book Antiqua",serif;font-size:8.1px;color:rgb(114,114,114);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_120{font-family:"Book Antiqua",serif;font-size:8.1px;color:rgb(114,114,114);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_116{font-family:Arial,serif;font-size:13.2px;color:rgb(43,42,41);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_116{font-family:Arial,serif;font-size:13.2px;color:rgb(43,42,41);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_122{font-family:Garamond,serif;font-size:11.6px;color:rgb(43,42,41);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_122{font-family:Garamond,serif;font-size:11.6px;color:rgb(43,42,41);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_121{font-family:Arial,serif;font-size:51.0px;color:rgb(56,42,37);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_121{font-family:Arial,serif;font-size:51.0px;color:rgb(56,42,37);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_127{font-family:Garamond,serif;font-size:13.1px;color:rgb(43,42,41);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_127{font-family:Garamond,serif;font-size:13.1px;color:rgb(43,42,41);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_129{font-family:Garamond,serif;font-size:30.1px;color:rgb(198,195,150);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_129{font-family:Garamond,serif;font-size:30.1px;color:rgb(198,195,150);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_123{font-family:Arial,serif;font-size:13.2px;color:rgb(56,42,37);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_123{font-family:Arial,serif;font-size:13.2px;color:rgb(56,42,37);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_126{font-family:Garamond,serif;font-size:11.1px;color:rgb(43,42,41);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_126{font-family:Garamond,serif;font-size:11.1px;color:rgb(43,42,41);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_124{font-family:Arial,serif;font-size:14.8px;color:rgb(56,42,37);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_124{font-family:Arial,serif;font-size:14.8px;color:rgb(56,42,37);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_125{font-family:Arial,serif;font-size:4.9px;color:rgb(198,195,150);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_125{font-family:Arial,serif;font-size:4.9px;color:rgb(198,195,150);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_128{font-family:"Book Antiqua",serif;font-size:10.1px;color:rgb(43,42,41);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_128{font-family:"Book Antiqua",serif;font-size:10.1px;color:rgb(43,42,41);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_131{font-family:Arial,serif;font-size:19.4px;color:rgb(254,255,255);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_131{font-family:Arial,serif;font-size:19.4px;color:rgb(254,255,255);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_132{font-family:Garamond,serif;font-size:10.1px;color:rgb(43,42,41);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_132{font-family:Garamond,serif;font-size:10.1px;color:rgb(43,42,41);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_133{font-family:Garamond,serif;font-size:8.1px;color:rgb(43,42,41);font-weight:normal;font-style:normal;text-decoration: none}
div.cls_133{font-family:Garamond,serif;font-size:8.1px;color:rgb(43,42,41);font-weight:normal;font-style:normal;text-decoration: none}
span.cls_134{font-family:Arial,serif;font-size:13.1px;color:rgb(199,199,198);font-weight:bold;font-style:normal;text-decoration: none}
div.cls_134{font-family:Arial,serif;font-size:13.1px;color:rgb(199,199,198);font-weight:bold;font-style:normal;text-decoration: none}
-->
</style>
<script type="text/javascript" src="./wz_jsgraphics.js"></script>
<style type="text/css">/*.lleo_errorSelection *::-moz-selection,
.lleo_errorSelection *::selection,
.lleo_errorSelection *::-webkit-selection {
    background-color: red !important;
    color: #fff !important;;
}*/

#lleo_dialog,
#lleo_dialog * {
    color: #000 !important;
    font: normal 13px Arial, Helvetica !important;
    line-height: 15px !important;
    margin: 0 !important;
	padding: 0 !important;
	background: none !important;
	border: none 0 !important;
	position: static !important;
	vertical-align: baseline !important;
	overflow: visible !important;
	width: auto !important;
	height: auto !important;
    max-width: none !important;
    max-height: none !important;
	float: none !important;
	visibility: visible !important;
	text-align: left !important;
    text-transform: none !important;
	border-collapse: separate !important;
	border-spacing: 2px !important;
    box-sizing: content-box !important;
    box-shadow: none !important;
    opacity: 1 !important;
    text-shadow: none !important;
    letter-spacing: normal !important;
    -webkit-filter: none !important;
    -moz-filter: none !important;
    filter: none !important;
}
#lleo_dialog *:before,
#lleo_dialog *:after {
    content: '';
}

#lleo_dialog iframe {
	height: 0 !important;
	width: 0 !important;
}

#lleo_dialog {
    position: absolute !important;
    background: #fff !important;
    border: solid 1px #ccc !important;
    padding: 7px 0 0 !important;
    left: -999px;
    top: -999px;
    width: 440px !important;
    overflow: hidden;
    display: block !important;
    z-index: 999999999 !important;
    box-shadow: 8px 16px 30px rgba(0, 0, 0, 0.16) !important;
    border-radius: 3px !important;
    opacity: 0 !important;
    -webkit-transform: translateY(15px);
    -moz-transform: translateY(15px);
    -ms-transform: translateY(15px);
    -o-transform: translateY(15px);
    transform: translateY(15px);
}
#lleo_dialog.lleo_show_small {
    width: 150px !important;
}
#lleo_dialog.lleo_show {
    opacity: 1 !important;
    -webkit-transform: translateY(0);
    -moz-transform: translateY(0);
    -ms-transform: translateY(0);
    -o-transform: translateY(0);
    transform: translateY(0);
    -webkit-transition: -webkit-transform 0.3s, opacity 0.3s !important;
    -moz-transition: -moz-transform 0.3s, opacity 0.3s !important;
    -ms-transition: -ms-transform 0.3s, opacity 0.3s !important;
    -o-transition: -o-transform 0.3s, opacity 0.3s !important;
    transition: transform 0.3s, opacity 0.3s !important;
}
#lleo_dialog.lleo_collapse {
    opacity: 0 !important;
    -webkit-transform: scale(0.25, 0.1) translate(-550px, 100px);
    -moz-transform: scale(0.25, 0.1) translate(-550px, 100px);
    -ms-transform: scale(0.25, 0.1) translate(-550px, 100px);
    -o-transform: scale(0.25, 0.1) translate(-550px, 100px);
    transform: scale(0.25, 0.1) translate(-550px, 100px);
    -webkit-transition: -webkit-transform 0.4s, opacity 0.4s !important;
    -moz-transition: -moz-transform 0.4s, opacity 0.4s !important;
    -ms-transition: -ms-transform 0.4s, opacity 0.4s !important;
    -o-transition: -o-transform 0.4s, opacity 0.4s !important;
    transition: transform 0.4s, opacity 0.4s !important;
}
#lleo_dialog input::-webkit-input-placeholder {
    color: #aaa !important;
}
#lleo_dialog .lleo_has_pic #lleo_word {
	margin-right: 80px !important;
}
#lleo_dialog #lleo_translationsContainer1 {
	position: relative !important;
}
#lleo_dialog #lleo_translationsContainer2 {
	padding: 7px 0 0 !important;
	vertical-align: middle !important;
}
#lleo_dialog #lleo_word {
    color: #000 !important;
    margin: 0 5px 2px 0 !important;
    /*float: left !important;*/
}
#lleo_dialog .lleo_has_sound #lleo_word {
    margin-left: 30px !important;
}
#lleo_dialog #lleo_text {
    font-weight: bold !important;
    color: #d56e00 !important;
    text-decoration: none !important;
    cursor: default !important;
}
/*
#lleo_dialog #lleo_text.lleo_known {
    cursor: pointer !important;
    text-decoration: underline !important;
}
*/
/*#lleo_dialog #lleo_closeBtn {
    position: absolute !important;
    right: 6px !important;
    top: 5px !important;
    line-height: 1px !important;
    text-decoration: none !important;
    font-weight: bold !important;
    font-size: 0 !important;
    color: #aaa !important;
    display: block !important;
	z-index: 9999999999 !important;
	width: 7px !important;
	height: 7px !important;
	padding: 0 !important;
	margin: 0 !important;
}*/

#lleo_dialog #lleo_optionsBtn {
    position: absolute !important; 
    right: 3px !important;
    top: 5px !important;
    line-height: 1px !important;
    text-decoration: none !important;
    font-weight: bold !important;
    font-size: 13px !important;
    color: #aaa !important;
    padding: 2px !important;
	display: none;
}
    #lleo_dialog.lleo_optionsShown #lleo_optionsBtn {
        display: block !important;
    }
    #lleo_dialog #lleo_optionsBtn img {
        width: 12px !important;
        height: 12px !important;
    }
#lleo_dialog #lleo_sound {
    float: left !important;
    width: 16px !important;
    height: 16px !important;
    margin-left: 9px !important;
    margin-right: 3px !important;
    background: 0 0 no-repeat !important;
    cursor: pointer !important;
    display: none !important;
    background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAfNJREFUeNq0U01IVFEU/u57Oo5WhBRIBBptykWLYBa2soWiEKQQEbrSFsGbVRQKQc2iFqGitXqvjQxCoCJCqyI0aBUtZILaJNUuYWYWo8HovJ/707nP94bnz0rxwvfOuefd8517fi5TSuE4i50YwZ3l37ZhNlpgzFkaaM/G9sHF1YskNrT+7l4PjMOcb78t2JL71uxgB+2UlfxHTtq5N94fIOh/88kWgWfl73ZCSQkpeGg3H091JY6dI2S00qA/N3KO3dDUYhFgEmZGurG+w9FqApIHsVM7kaTF9Nhn0r8Q7hPWQgIRuNaH3AMUA4W/Lkdh04cpFS43G0TgxQTvCdMETVAk3KynIHwXZU/ge8XDt7KH9bKLjU0P2zVO5LsEpSejVRJ9UR18EtfqKegovs9R3Q6w9c/H1o4Aa2Jwm1lIvn9RJ4w9RdRRzqcYrpwycCll4Cy1lnkS3Bc6vfBg28v8aRIfI78zhB/1GygROH3jLyyzMQ0zlUZuZBSlKkeLoegGtTjYLcJ8pF+NakHOFC2J6w+f25mxSfWrWFF/ShXVPTGvtN14NNkVnxlYWJkgZEL7/vwKr55lKSVnaGYWkuYgrgG172uUv47+U7fw0EHaJXmalUQy/HqO6lBzEsVjJC4Q8kd6TETQpjuaGOvjv8b/AgwA/ij1XMx58NIAAAAASUVORK5CYII=) !important;
}
#lleo_dialog .lleo_has_sound #lleo_sound {
    display: block !important;
}

#lleo_dialog #lleo_soundWave {
    border: solid 5px #4495CC !important;
    border-radius: 5px !important;
    position: absolute !important;
    left: -5px !important;
    top: -5px !important;
    right: -5px !important;
    bottom: -5px !important;
    z-index: 0 !important;
    opacity: 0.9 !important;
    display: none !important;
}
    #lleo_dialog #lleo_soundWave.lleo_beforePlaying {
        display: block !important;
    }
    #lleo_dialog #lleo_soundWave.lleo_playing {
        opacity: 0 !important;
        border-width: 20px !important;
        border-radius: 30px !important;

        -webkit-transform: scale(1.07,1.1) !important;
        -moz-transform: scale(1.07,1.1) !important;
        -ms-transform: scale(1.07,1.1) !important;
        transform: scale(1.07,1.1) !important;

        -webkit-transition: all 0.6s !important;
        -moz-transition: all 0.6s !important;
        -ms-transition: all 0.6s !important;
        transition: all 0.6s !important;
    }


#lleo_dialog #lleo_picOuter {
    position: absolute !important;
    float: right !important;
    top: 4px;
    right: 5px;
    z-index: 9 !important;
    display: none !important;
    width: 100px !important;
}
    #lleo_dialog.lleo_optionsShown #lleo_picOuter {
        right: 25px;
    }
#lleo_dialog .lleo_has_pic #lleo_picOuter {
    display: block !important;
}
    #lleo_dialog #lleo_picOuter:hover {
        width: auto !important;
        z-index: 11 !important;
    }
#lleo_dialog #lleo_pic,
#lleo_dialog #lleo_picBig {
    position: absolute !important;
    top: 0 !important;
    right: 0 !important;
    border: solid 2px #fff !important;
    -webkit-border-radius: 2px !important;
    -moz-border-radius: 2px !important;
	border-radius: 2px !important;
    z-index: 1 !important;
}
#lleo_dialog #lleo_pic {
	position: relative !important;
    border: none !important;
	width: 30px !important;
}
#lleo_dialog #lleo_picBig {
    box-shadow: -1px 2px 4px rgba(0,0,0,0.3);
    z-index: 2 !important;
    opacity: 0 !important;
    visibility: hidden !important;
}
    #lleo_dialog #lleo_picOuter:hover #lleo_picBig {
        visibility: visible !important;
        opacity: 1 !important;
        -webkit-transition: opacity 0.3s !important;
        -webkit-transition-delay: 0.3s !important;
    }
#lleo_dialog #lleo_transcription {
    margin: 0 80px 4px 31px !important;
    color: #aaaaaa !important;
}
#lleo_dialog .lleo_no_trans {
    color: #aaa !important;
}

#lleo_dialog .ll-translation-counter {
	float: right !important;
    font-size: 11px !important;
    color: #aaa !important;
    padding: 2px 2px 1px 10px !important;
}

#lleo_dialog .ll-translation-text {
	float: left !important;
	/*width: 80% !important;*/
}

#lleo_dialog #lleo_trans a {
    color: #3F669F !important;
    text-decoration: none !important;
    text-overflow: ellipsis !important;
    padding: 1px 4px !important;
    overflow: hidden !important;
    float: left !important;
    width: 320px !important;
}

#lleo_dialog .ll-translation-item {
    color: #3F669F !important;
    border: solid 1px #fff !important;
    padding: 3px !important;
    width: 100% !important;
    float: left !important;
	-moz-border-radius: 2px !important;
	-webkit-border-radius: 2px !important;
	border-radius: 2px !important;
}

#lleo_dialog .ll-translation-item:hover {
	border: solid 1px #9FC2C9 !important;
    background: #EDF4F6 !important;
	cursor: pointer !important;
}
#lleo_dialog .ll-translation-item:hover .ll-translation-counter {
	color: #83a0a6 !important;
}

#lleo_dialog .ll-translation-marker {
    background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAWSURBVBhXY7RPm/+fAQkwIXNAbMICAJQ8AkvqWg/SAAAAAElFTkSuQmCC) !important;
    display: inline-block !important;
    width: 4px !important;
    height: 4px !important;
    margin: 7px 5px 2px 2px !important;
    float: left !important;
}

#lleo_dialog #lleo_icons {
    color: #aaa !important;
    font-size: 11px !important;
    background: #f8f8f8 !important;
    padding: 10px 10px 10px 16px !important;
}
#lleo_icons a {
    display: inline-block !important;
    width: 16px !important;
    height: 16px !important;
    margin: 0 10px -4px 3px !important;
    text-decoration: none !important;
    opacity: 0.5 !important;
    background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHIAAAAQCAYAAADK4SssAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAADopJREFUeNqsWQt0lNWd/33fzGQemUcmzwkhSkhYSSgpJJGVWHlEVEwLq0AFhC520xN0cfcUkHZ7QNetwfac6mp3oR5Ss8c9XaPVhoJCtGwSkYQglQBBNg/IgxBIQl7zyCSZ97f/e7+ZyeShpu7eM/fc797vu9/j/u7v93+MUqlUwuv1IlQ6Ojqk7u5utLaWo/nanfB45tbnsSI6GgsXLhQwpcx/9rCE/0PpOLSL39Pnh9TY2Y1NJXW4NeTFz59agp9uXASfYwR/Xv9dxJ6pxwJBhCIQoKtFuIUAXPRksyTx+U2rVy0TtdrywNhYeviFJAlSsJ1oJNY2ZdfVLeKdiGIb96Kqw45LvU40Dbj42F2mKNyXasCjGTGI0aqmvr6wdseL075fEORl6h+yYWzcDaNeh8Q4E7z0kVPLx//5Il0uTLqHQqGA3z/92qioKHg8Hn5/SZqYogwdOBwO6d19+9DQ0ADdqrmTJhesLML6nQ38uLj4jHSkuJi/a+Q1vd8QxORg6/dBUtDblLzbhBuuOIhJcfhl5QCeyB9DusWA3MO/hf2+e6FwjtFHKGj15Y8M0Cd0KQTpbr8kCBrNsaTn9iXoH3jga5/739nZC7Mj+n7aHBVNwwSUEhuy4rCR6m8vD9ID5MVyeAI4cPo2suI0KMpJgEoU+A5QiCKmg0jT6H49/cP4Tt4i/FXaHLS0d6O57RZ0WvXXvltaWhpOnz7NCbZ371588MEHHLQ9e/bwev78eTzzzDPo7+8PzxFDIO4rKOAgomHihq+9ckxgdd26dWHQSkuBvJ2lmLqTv2kJbQAGot/nw9U7xDa9CQHakY5xFd45f4OdhWZhFtz534GP9k9A9PPWIxGgAu2AgHwP79hYYseRI8q+f/832Kqr4O7t5bt6pioFAmIkiJXXrbCYtbg85MF1q5vv+IFxH6KUApSizLDsJB09F2i3yozoc3pn/CaBVKPr9gC+X3g/3ih5GruL1mPPjx7DwLCdA/x1xWKx4K677kJ6ejpWr14dHt+xYwdSUlKQl5cHvV4/aQ7/GMZEDiDVI9IF4asecqQ4FwzvnaWl/x84hhnJwFAKSiTFaCDS7ifhhEjMu9pJS0dg0SH8Bh28BKqCXSuRxAp+ApMAFBX8Hj6PR3G+uhrDFRXoeekltG3ZjOsbN6L7wH4M/O53GKEX97pc8NGGCckSW9ibdg9anBJqu0ZgpFvNM0ahf8yH75GU7siOx3aqIjHQS8+N0SiRGa/BhR4nLHpVhBSKfEN03erHny+3IinehBf+cQuqzzby8+1dfURuKSy5X1UMBkP4eM6cOfxdmdQuWrSIj7nd7mlAKquqqqTyVXtnvfCFhUkoRi4xswG7V7RIM9lMVvJJHoryM7Gr4hxcLisfO7m3EIcrm1HZ3DmNkYIo79RHFsfjbHMvlGozLTKBKSpJPhUQ3WRvmlpwO1mE1WCGygMk2pxIcHjhlfzBzSDbQ2Jb2C56Bwfhra2F40wtFxHRaMK899+nU/LzGGAvnR+ARSUTNDVaBTVRMI6AO3VjhMCRkGPRUQusutuABbFqDsaJ63akmtQEZhSf5xx1wWTU4eBPfoDBYQeSE818fOV9i/HZpVYcPPQeLPHmWQGZmJgYPmasZGXt2rUcTFaiyVeJBJszMgxi7uxZxFjJrn/tzBnef5MA6iwp4uCFyrjVhieXp6H5wIYw61ip2FUIjcYc7oeO227a2DKjeG0GFib74LPZoVf58NTKuSSiAkr/9CaeeMSFFQeWYsOPv4XCvVl44GdLsbVoMU5mmcLsCrUBWnneRlYa81qHJzHy983UJzBvOTy8ppvV/Nz+2j581GwjGZav27AwBp/dHsUgXcuY1TLgxns0N/y9LjdMhmisJuD+dkMB1j24jJ7jx5vvnsLT+98gJ8cHg147q/XNysoCcziHhoY4C1NTU7F582Y0NjZikDZmXFzcdGkt6f8IxReO/KWKKDAsS4P29EDZOVhJsqqDgC6NMeOSzQrzc+Uhr5SDvPHwOd4/vHF5WFYL0mL48fee/wBHP2lGkl6Dcy+vwVu70nHhYB7WLJmDX/ypFDsbf42erBTZmwPRkfTVRTJXnx2Ln27PnQCSFpm1UhA8KeDnAPI2OM6cCCnoxLzfYkP3qA/dTh/ujPuxxKJF7e0x1BIbB91+LErUYoDA23rsBk5ccyCRGHu224meMT+fGyrxsUb09VtBHiyy1/4DOm7ewcjoOF58vRz6aDUSyGP1zeCxzlSYnLa3t8NqtUKtVnM2LliwALWkLIyJbA00Gs1kaaVJQjD8mOa87H7uMT722LrdMzyOFq9BRrKPQMspeZsDU09AHn1ug7yLXzmKtANlKNtWyEF+tvwcHny1kh8XZBbBQvawzya7+MMuLX7063r85vhlFORasH/7CtouEk5f/xzPf/IykJFI8ubjVl3wqYJSSrbTEwi/ul+SJTUEaESowVuOHXUiGXnJ6oVRLTP50XkGREcp8M41GzpcPjycZICOJPdfzvXhf0a8+GGWnhwfAUdJVtvo/IhnAphAQOJ2Uh2lQrROgzlJsQRmHwFsQrRWQ8wOzJoljG03b97kjMzIyMDWrVu5XaypqcGWLVsQGxsLo9E43dmZzY1n64Ey4Ha9XcP7DFAG4qGT5/BqzSUcenI5Dm3L5+dqyA4yUPPpelZiFR7oozSov+7Cq+XXcKN/lBZbgfmxKchIzyEL74JIjqboVxIkBCAtnAAVj4Ek0SMvZnCxQrLqj6wRUhsJJK097rj8vK4hG+ghKX2fgGL9VanRXEb/i5jH+o/ON5LDI6G8Ve6LX2LuEgg8jVqFnjvD8Hh9s7KLkxzA5GR88cUXOH78OO8zz5W998mTJ9HZ2Ul+g8jlNfK+XwlkKPzIzc2d4U0aJtlVJqche8ecmRCgBZnJxNInZfDoJTItMSSxlSh6uxL1nRNOj9c2iLlaN9bnxeMHaxfC5qAQgZ6aGpeMs1tK8XD8CkhjTlpYGiSAA4LMQ84yr2qatPpD8uqPlFm55dIaBHLzPSZIPgksuls334CaW04MkcyKBOg6Au6znjH0EBtTSMbvn6NDzQ0HOUh+PofNjSzs3g7nOCwJsrnout0fTkR8qY2aAWSz2Qyn0ymHg8HS3NzMEwHDw8Nhh2fGhMBfUljcyexjcQSQjH0hqXz7Inmml3oJOBsHtDAzDYe3FfDz5ec6Z/RaS/YU4KHcxYgzi/DZmzA8dAZdl3uQnLEJ8YYEnNj0Ov7mvT34uLcaUhTJip88WWJWIKAIpyZC3ioHjR1JEZmdCImNZGTx4jiUXbWjMM0IA8lqxXUHD+hXpuoRr1Xil239fLGfINBEan9P7BQ4FQU+V3aOJc4+pVKBzu4+PLWpgI9/WPM5OTi6aVmYyDJ1XKvVchvIWNfa2gqbzYaYmBhcvHiRn3e5XOHMzyQb+U2A3PfudU7I3btXhMeYPczJSkOaRYNtOZnYW7A0bP8YsCWVsrQeICbOFEduLfg2nIONuHz8aZhxBUrVGJRuEZ3XDiHlwT/CGJuOfy3Yi7r/uIIRkmGFjxYnwLIItKi+CSC5LQy24TWakqbjqa/gcS45M0uTNBwoJpvH2x3cS348w8gX+Xib3P/+PTFw+wI41j7C+0voO9lcbt/tTjz+yHIUrs6Fj+59b/YCUpRR2Kk6yeFhVU92U6OO4naUybXb4+XjLHUXWZhkqlQqDhh7z7a2Np4AuHr1aohE4ViTpVfZpvxGQL5UeYfHkCxLFxlDMi/1Ur0cLx44Ws9ldlvOBLAhtvZ+SWbHHRhFa/VOpBvPw2RmwTUF/14JmsEm9NfthmH9CdwTfzcs0YkYcXXCz9ItBKKKHB+fT86weP3+PkLMEo4jg6yMBDEEZIgJbOdXbUjD65eHUHumD0PjPs7wJqsb/1TXh3aKU1MMKiwjb/bDNjtsJKkatYC3Hkrhc/kmXrscP3tmEy43dWJJlhyCMafnk3cO4sKVNlTXX+FMHbQ64HJ7OaCW+Bjk52by8cgyb948XkdGRnifAUjrzG0jT3oEgWN2NDIXq4w0ebMpDMTcXBZLFn9lnpUlAcoigC3Kz+GMZACHEgSRcaTH3g+97xY0qhiMkI0SfGQH6T112lj4XbcheEcxLkbD5RylhVaRrEaRnfSSp+oPhxIdbvezGqWyjEAyRUrWVCBd4+PSRbf79KaQTSL79/cUxtxf0SknSlmsfMUatmHLLDouq0eJrfPj1PjNymSYVBPuhdmkD4cgpz+7ircqqqEimd3+2Cqs/OtvIS87I3zt6JiLJxkYCMyeNkaYGZ5YINtYVVUVls6ysjJuGxn7WDl16hQHmkkua0MAh4H8lb0G+0wFM4PX0BBeBQZiza+2TEqaJ0eAGQpBJuUOYyZinpzkGHJyrNOeoY2ZB3XCGowOV0Cp0/HQQylEwT+ugHrOOrKLenz4+cfosfdCMJDdYZkZryh7qpKcXdnZ1VXBcg4/TkwUF2k0+00KxaNmhSJPIQiT/rLoaGv7/BeDgw+9HDGWpFOh5ckM/KFjBD+pv4MeZ5C19BOVMmiPLzDhlRXJaOwdxVxj9IR/8FE9zl9q5Uy7eq0LNvsoHz97oYXCEDOSE8xIosrklaX6HCNj6O4d4uHJ1MKcmhdeeAF2u5336+rqOOgh23jixAlcuXJlGiOFqX9jsfLpp59Kxz58jXutISCZB7Vq6WZsvdc0499Y1iDTmPe6sYAko09+cC8Ftb29cuBcUrQcyVoz8l+ZsJNmmhP+G2t0SLI1vg6l/QuI3jEEVBqoLQ9DsbgILT19+O4bu3BLHKDFoLCA7SOJZEZSQTpY86X+/TK9XvmEyfR30aK4MUWjyffpdM4NjY2RyaZpXgizsSPeAKxuOZwxq0Wyj360DpFtpsvvm6sPyypbwzXbn5eYTWS206jXUhCv4gLA7sOk1OX2kE1kGaEAv4Y5RVq6RqtR8+OP3vrnaX9jRXq1kvT1/0/8rwADAJ+LRelLmVNwAAAAAElFTkSuQmCC) !important;
}
#lleo_icons a:hover {
    opacity: 1 !important;
}
#lleo_icons a.lleo_google     {background-position:-34px 0 !important;}
#lleo_icons a.lleo_multitran  {background-position:-64px 0 !important;}
#lleo_icons a.lleo_lingvo     {background-position:-51px 0 !important; width: 12px !important;}
#lleo_icons a.lleo_dict       {background-position:-17px 0 !important;}
#lleo_icons a.lleo_linguee    {background-position:-81px 0 !important;}
#lleo_icons a.lleo_michaelis  {background-position:-98px 0 !important;}

#lleo_dialog #lleo_contextContainer {
    margin: 0 !important;
    padding: 3px 15px 8px 10px !important;
    background: #eee !important;
    background: -webkit-gradient(linear, left top, left bottom, from(#fff), to(#eee)) !important;
    background: -moz-linear-gradient(-90deg, #fff, #eee) !important;
    border-bottom: solid 1px #ddd !important;
    border-top-left-radius: 3px !important;
    border-top-right-radius: 3px !important;
    display: none !important;
    overflow: hidden !important;
}
#lleo_dialog .lleo_has_context #lleo_contextContainer {
    display: block !important;
}
#lleo_dialog #lleo_context {
    color: #444 !important;
    text-shadow: 1px 1px 0 #f4f4f4 !important;
    line-height: 12px !important;
    font-size: 11px !important;
    margin-left: 2px !important;
}
#lleo_dialog #lleo_context b {
    line-height: 12px !important;
    color: #000 !important;
    font-weight: bold !important;
    font-size: 11px !important;
}
/*#lleo_dialog #lleo_gBrand {
    color: #aaa !important;
    font-size: 10px !important;
    *//*padding-right: 52px !important;*//*
    padding-bottom: 14px !important;
    margin: -3px 4px 0 4px !important;
    background: left bottom url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAPCAYAAABJGff8AAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAcVSURBVHja3FZrbFTHFT4z97W++/KatfHGNrFjMNjFLQ24iiVIFBzCD1SFqj/aRlCUCvjRKlVatUFJVJJGNKUtoRVqgZZWKWCVOEqKQxsaUoypaWzclNgGI9sLtndZv9beh/d133ems3ZAvKTGkfqnZ3U1d++9M+d88535zkGUUsjbpl/PgixiEEz05aHLIzsjo9cwIrrEy4EA7ypLm8rMAX2q850cYGMtmoD3tKOgYwF0QDAUjcFwwoLG33ih5hkZIJwFGjMA8QDRaQuCIzb0ZtbCMe00oCRbwUIwU7EHwo4jYFs6VASWPb3cv+yP7SfO9RCNNFIByLMpB+ybKIRoLgeXZhKweYrAfzP+1h3CABY90n/unafCwSs/xJK7BfMOzVZjq2w92WJlbhyzLeWSyXuCTXgMOKDsh2Dhlp9HoF57DdzTX4H4kteh5iHtzcRo8ph9XQ+DwZFGJME+RQYq5b/99HYLjNch7gi2t35roOONNQX+mh4kF7GnGDjnA70sgCe0eG+tIlcGX3F0wwtSN+gqBwJGvEXBumdVti9ImB/vNcT2DQHBGriMBkh17QZH7dFCgetBbIcywOa9Cm4QecSYx3dsV3Nz8x3Ytm7dio4fP063bNmC4HZ3BWrqpyN950d5qaDHVqeA2gZw8mLgRA9YBCKGDR+8zF2E3eg8AOdoCFuo+YpitswiboAFtwvNb/qcaTmy5+qg3XwjQi7YBLUjBCXsmmMSIbrZUJKHBWr2muZYRyo0vSfWV+YkyMx/YTTZPDyBCh68QeAP/ap5WuX4fobrsZvB3z7mgdyXmeRUvEjTjE5O8gIlBmDRC2LRKigp8QClOSguRfCj0PcZatejHYb455ORxPZaEf5azaOXRET3ahQWUQk9r+fMjgOHVFvg6FN11dhbGYB+SuBaVud8HhHvGx88tT6RMp6JzXxhmZ6OrqfGwC98KyZT0excfPqLgs8R5jwdhyMTr22Q8W+9Dn4kTLi/s3fi3RzfZOa2hJi3gZCKBLnIxzmK2Mb7GRgPEGqBIIpQXl4OevVGeEt+EqDI/7v3QxPaoGa38hxn1RRwP17sdk/lOP67KpiPDX6YXXuxj758I4rSdVUQKSuGnU4ZPMkk3u3Skjsmr3V/bKszPQW+qiZPcSWxcvHtlpJJ2wyLm6DMGm9g54V4ungltj+u9chHuhRytU0hz88Rz8Qqn1J3j/cwkzF4Q3AvedhWoiyneeCdFWy2hU1d28YU5nFJkMUDeN17681gqUPJqH6OvRYlKA34wXR5O1EytDkXy2xi5wgFSpDM0p2RiMBVAmcWpYAmppOrr03FbVxY2+T2+WFJpQ/S4YgWSV8PIsEp2jr7HsAmNl7m0BVp2rbrT0TTb4YNu83xKXXmFjPsjJzmPVUyO/B7BV8dcAV+luGUnwr1jWcS0Wh8bORryvC7Femh/qElmCwu5ZHopDZjTgC5QMJjBNRYkrQWOimw1Pp6KdMP4mCIy0QlqWM6Ebp+fna8+3uUcwcKS1e0SJA7ef1fred8n1NfKFwqFCMm12lKudDw8PulShbnCC0ux7TtG4US7PDghYGxlcltQEiMd5bt4pyB/VhwA5aKDW9p/QfVdStPg5mBYZ1a/0yYO/xg05US6lhOdNlOxus+ikw29s5mfjadQJ1ZBf5dXQFbH6lHG3wcOIwkPnyqjUYsPXvI70dviCKDL8o0MtS/WbeLXi1cvdrSxLTTMgykPcDV/bwq027o6vgKgdtbJ6L9tRK31oXhyQVJM2MmTW2tiuiJvyB1+jvUSD+NJX+fDtLkR13dZZNXT13NYv5iO//g5U1a/7o4gV8FLTgRiqu5M+nULpuQoyYTpFSWNiTT8HtVh59Ajx0cGNazlwfg8/rqXyqLH9pW4ghNfns2HiWZWNx2V6zqivWHvho50zKk902eRYQzTnwRL60ds2r8YfLuoE2+KepGk0DooYaFgMnrP9PNLLXVx830iGzMXGpkuexVxMKJuGUErVQkgbAEBpkTlc4khS/N6hREU2PPWIlAedllVLNLN2H7xAyFmQSBVAbBbP1+sKufexRGPzw52vW34xZFe4Cil6TihzshLv4JTq5zEmfrBjYTwMRAWFQKhQ1X9HzRNKFeRAsrmncUNcQrFKG2ucrAOgOOF8BmopCvI+iTYpLPT475EBgCfJevPCieoyCxIxP2vQIZx7MQ0FKv9/VdELRc/DlP5UZwuIqgYNHSjYmBtzvpoOqSXI9k9eWd833FnJ/82vPx4IV2APcDBZ+pXflkYUxhXK+BsxOb2L8eiFLrHyq3ZI1nacNBuaT+oNPBs7oZfdFIDbeAhLOcUQZcrhwIGv3Mfnn4H1k+HMVwQTY1zdoelj6U/MA2ZmcBcVu0xOAazUiMqTN9Z3U1cRALMiBbuF9dXJjPm13z/4P9R4ABANu4bb16FOo4AAAAAElFTkSuQmCC) no-repeat !important;
    display: inline-block !important;
    float: right !important;
}
#lleo_dialog #lleo_gBrand.hidden {
    display: none !important;
}*/
#lleo_dialog #lleo_translateContextLink {
    color: #444 !important;
    text-shadow: 1px 1px 0 #f4f4f4 !important;
    background: -webkit-gradient(linear, left top, left bottom, from(#f4f4f4), to(#ddd)) !important;
    background: -moz-linear-gradient(-90deg, #f4f4f4, #ddd) !important;
    border: solid 1px !important;
    box-shadow: 1px 1px 0 #f6f6f6 !important;
    border-color: #999 #aaa #aaa #999 !important;
    -moz-border-radius: 2px !important;
	-webkit-border-radius: 2px !important;
	border-radius: 2px !important;
    padding: 0 3px !important;
    font-size: 11px !important;
    text-decoration: none !important;
    margin: 1px 5px 0 !important;
    display: inline-block !important;
    white-space: nowrap !important;
}
#lleo_dialog #lleo_translateContextLink:hover {
    background: #f8f8f8 !important;
}
#lleo_dialog #lleo_translateContextLink.hidden {
    visibility: hidden !important;
}

#lleo_dialog #lleo_setTransForm {
    display: block !important;
    margin-top: 3px !important;
    padding-top: 5px !important;
    /* Set position and background because the form might be overlapped by an image when no translations */
    position: relative !important;
    background: #fff !important;
    z-index: 10 !important;
    padding-bottom: 10px !important;
    padding-left: 16px !important;
}
#lleo_dialog .lleo-custom-translation {
    padding: 4px 5px !important;
    border: solid 1px #ddd !important;
	border-radius: 2px !important;
    width: 90% !important;
    min-width: 270px !important;
    background: -webkit-gradient(linear, 0 0, 0 20, from(#f1f1f1), to(#fff)) !important;
    background: -moz-linear-gradient(-90deg, #f1f1f1, #fff) !important;
	font: normal 13px Arial, Helvetica !important;
	line-height: 15px !important;
}
#lleo_dialog .lleo-custom-translation:hover {
    border: solid 1px #aaa !important;
}
#lleo_dialog .lleo-custom-translation:focus {
    background: #FFFEC9 !important;
}

#lleo_dialog *.hidden {
    display: none !important;
}

#lleo_dialog .infinitive{
    color: #D56E00 !important;
    text-decoration: none;
    border-bottom: 1px dotted #D56E00 !important;
}
#lleo_dialog .infinitive:hover{
    border: none !important;
}

#lleo_dialog .lleo_separator {
    height: 1px !important;
    background: #eee;
    margin-top: 10px !important;
    background: -webkit-linear-gradient(left, rgba(255,255,255,1) 0%,#eee 8%,rgba(255,255,255,1) 80%) !important;
    background: -moz-linear-gradient(left, rgba(255,255,255,1) 0%, #eee 8%, rgba(255,255,255,1) 80%) !important;
    background: -ms-linear-gradient(left, rgba(255,255,255,1) 0%,#eee 8%,rgba(255,255,255,1) 80%) !important;
    background: linear-gradient(to right, rgba(255,255,255,1) 0%,#eee 8%,rgba(255,255,255,1) 80%) !important;
}
#lleo_dialog #lleo_trans {
    /*border-top: 1px solid #eeeeee !important;*/
    padding: 5px 30px 0 14px !important;
    zoom: 1;
}

#lleo_dialog .lleo_clearfix {
	display: block !important;
	clear: both !important;
	visibility: hidden !important;
	height: 0 !important;
	font-size: 0 !important;
}


#lleo_dialog #lleo_picOuter table {
    width: 44px !important;
    position: absolute !important;
    right: 0 !important;
    top: 0 !important;
    vertical-align: middle !important;
}

#lleo_dialog #lleo_picOuter td {
    width: 38px !important;
    height: 38px !important;
    /*border: 1px solid #eeeeee !important;*/
    vertical-align: middle !important;
    text-align: center !important;
}

#lleo_dialog #lleo_picOuter td div {
	height: 38px !important;
	overflow: hidden !important;
}

#lleo_dialog .lleo_empty {
    margin: 0 5px 7px !important;
}

#lleo_youtubeExportBtn {
    margin-left: 10px;
    height: 24px;
}
    #lleo_youtubeExportBtn i {
        display: inline-block;
        width: 16px;
        height: 16px;
        background: 0 0 url(https://d144fqpiyasmrr.cloudfront.net/plugins/all/images/i16.png) !important;
    }
    #lleo_youtubeExportBtn .yt-uix-button-content {
        font-size: 12px;
        line-height: 2px;
    }


/*** Parsed Lyrics Content *****************************/

.lleo_lyrics tran {
    background: transparent !important;
    border-radius: 2px !important;
    text-shadow: none !important;
    cursor: pointer !important;
}
    .lleo_lyrics tran:hover {
        color: #fff !important;
        background: #C77213 !important;
        -webkit-transition: all 0.1s !important;
        -moz-transition: all 0.1s !important;
        -ms-transition: all 0.1s !important;
        -o-transition: all 0.1s !important;
        transition: all 0.1s !important;
    }

.lleo_songName {
    border: solid 1px #ffd47c;
    background: #fff1c2;
    border-radius: 2px;
}

.lleo_hidden_iframe {
    visibility: hidden;
}</style></head>
<body class="vsc-initialized">
<div style="position:absolute;left:50%;margin-left:-265px;top:0px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background001.jpg" width="531" height="666"></div>
<div style="position:absolute;left:376.99px;top:32.26px" class="cls_003"><span class="cls_003">Covers Spring 5.0</span></div>
<div style="position:absolute;left:42.50px;top:321.96px" class="cls_004"><span class="cls_004">FIFTH EDITION</span></div>
<div style="position:absolute;left:42.50px;top:414.43px" class="cls_005"><span class="cls_005">Craig Walls</span></div>
<div style="position:absolute;left:83.19px;top:618.79px" class="cls_002"><span class="cls_002">MANNING</span></div>
<div style="position:absolute;left:213.00px;top:649.00px" class="cls_006"><span class="cls_006"> </span><a href="http://www.allitebooks.org/">www.allitebooks.com</a> </div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:676px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background002.jpg" width="531" height="666"></div>
<div style="position:absolute;left:153.72px;top:118.48px" class="cls_007"><span class="cls_007">Praise for </span><span class="cls_008">Spring in Action</span><span class="cls_007">, 4th edition</span></div>
<div style="position:absolute;left:89.88px;top:167.36px" class="cls_009"><span class="cls_009">“The best book for Spring—updated and revised.”</span></div>
<div style="position:absolute;left:307.29px;top:184.97px" class="cls_010"><span class="cls_010">—Gregor Zurowski, Sotheby’s</span></div>
<div style="position:absolute;left:89.88px;top:209.60px" class="cls_009"><span class="cls_009">“The classic, remastered and full of awesomeness.”</span></div>
<div style="position:absolute;left:283.98px;top:227.21px" class="cls_010"><span class="cls_010">—Mario Arias, Cake Solutions Ltd.</span></div>
<div style="position:absolute;left:89.88px;top:251.80px" class="cls_009"><span class="cls_009">“Informative, accurate, and insightful!</span></div>
<div style="position:absolute;left:264.81px;top:269.41px" class="cls_010"><span class="cls_010">—Jeelani Shaik, </span><a href="http://d3banking.com/">D3Banking.com</a> </div>
<div style="position:absolute;left:89.88px;top:294.01px" class="cls_009"><span class="cls_009">“After ten years, this is still the clearest and most comprehensive introduction to the</span></div>
<div style="position:absolute;left:89.88px;top:306.01px" class="cls_009"><span class="cls_009">core concepts of the Spring platform.”</span></div>
<div style="position:absolute;left:259.14px;top:323.62px" class="cls_010"><span class="cls_010">—James Wright, Sword-Apak</span></div>
<div style="position:absolute;left:89.88px;top:348.25px" class="cls_009"><span class="cls_009">“This book is a quick and easy way to get into the Spring Framework Universe. Simply</span></div>
<div style="position:absolute;left:89.88px;top:360.25px" class="cls_009"><span class="cls_009">perfect for Java developers.”</span></div>
<div style="position:absolute;left:193.47px;top:377.86px" class="cls_010"><span class="cls_010">—Jens O’Richter, freelance Senior Software Architect</span></div>
<div style="position:absolute;left:89.88px;top:402.46px" class="cls_009"><span class="cls_009">“This book belongs on the bookshelf of any serious Java developer who uses Spring.”</span></div>
<div style="position:absolute;left:292.77px;top:420.07px" class="cls_010"><span class="cls_010">—Jonathan Thoms, Expedia Inc.</span></div>
<div style="position:absolute;left:89.88px;top:444.67px" class="cls_009"><span class="cls_009">“</span><span class="cls_010">Spring in Action</span><span class="cls_009"> is an excellent travel companion for the huge landscape that is the</span></div>
<div style="position:absolute;left:89.88px;top:456.67px" class="cls_009"><span class="cls_009">Spring Framework.”</span></div>
<div style="position:absolute;left:248.61px;top:474.28px" class="cls_010"><span class="cls_010">—Ricardo Lima, Senado Federal do Brasil</span></div>
<div style="position:absolute;left:89.88px;top:498.91px" class="cls_009"><span class="cls_009">“Pragmatic advice for Java’s most important framework.”</span></div>
<div style="position:absolute;left:256.74px;top:516.52px" class="cls_010"><span class="cls_010">—Mike Roberts, Information Innovators</span></div>
<div style="position:absolute;left:213.00px;top:649.00px" class="cls_006"><span class="cls_006"> </span><a href="http://www.allitebooks.org/">www.allitebooks.com</a> </div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:1352px;width:531px;height:664px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background003.jpg" width="531" height="664"></div>
<div style="position:absolute;left:175.86px;top:219.74px" class="cls_013"><span class="cls_013">Spring in Action</span></div>
<div style="position:absolute;left:325.08px;top:282.76px" class="cls_014"><span class="cls_014">Fifth Edition</span></div>
<div style="position:absolute;left:323.19px;top:343.89px" class="cls_015"><span class="cls_015">C</span><span class="cls_016">OVERS</span><span class="cls_015"> S</span><span class="cls_016">PRING</span><span class="cls_015"> 5.0</span></div>
<div style="position:absolute;left:393.96px;top:390.12px" class="cls_017"><span class="cls_017">C</span><span class="cls_018">RAIG</span><span class="cls_017"> W</span><span class="cls_018">ALLS</span></div>
<div style="position:absolute;left:402.18px;top:555.21px" class="cls_019"><span class="cls_019">MANNING</span></div>
<div style="position:absolute;left:400.38px;top:573.61px" class="cls_020"><span class="cls_020">S</span><span class="cls_021">HELTER</span><span class="cls_020"> I</span><span class="cls_021">SLAND</span></div>
<div style="position:absolute;left:213.00px;top:647.00px" class="cls_006"><span class="cls_006"> </span><a href="http://www.allitebooks.org/">www.allitebooks.com</a> </div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:2026px;width:531px;height:664px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background004.jpg" width="531" height="664"></div>
<div style="position:absolute;left:53.88px;top:59.59px" class="cls_022"><span class="cls_022">For online information and ordering of this and other Manning books, please visit</span></div>
<div style="position:absolute;left:53.88px;top:70.57px" class="cls_023"><span class="cls_023"> </span><a href="https://www.pdf.investintech.com/preview/52cc2c04-22f2-11ea-a5fd-0cc47a792c0a/www.manning.com">www.manning.com</a> <span class="cls_022">. The publisher offers discounts on this book when ordered in quantity.</span></div>
<div style="position:absolute;left:53.88px;top:81.58px" class="cls_022"><span class="cls_022">For more information, please contact</span></div>
<div style="position:absolute;left:77.88px;top:99.52px" class="cls_022"><span class="cls_022">Special Sales Department</span></div>
<div style="position:absolute;left:77.88px;top:111.43px" class="cls_022"><span class="cls_022">Manning Publications Co.</span></div>
<div style="position:absolute;left:77.88px;top:123.37px" class="cls_022"><span class="cls_022">20 Baldwin Road</span></div>
<div style="position:absolute;left:77.88px;top:135.31px" class="cls_022"><span class="cls_022">PO Box 761</span></div>
<div style="position:absolute;left:77.88px;top:147.25px" class="cls_022"><span class="cls_022">Shelter Island, NY 11964</span></div>
<div style="position:absolute;left:77.88px;top:159.16px" class="cls_022"><span class="cls_022">Email: orders@manning.com</span></div>
<div style="position:absolute;left:53.88px;top:189.04px" class="cls_022"><span class="cls_022">©2019 by Manning Publications Co. All rights reserved.</span></div>
<div style="position:absolute;left:53.88px;top:214.90px" class="cls_022"><span class="cls_022">No part of this publication may be reproduced, stored in a retrieval system, or transmitted, in</span></div>
<div style="position:absolute;left:53.88px;top:225.91px" class="cls_022"><span class="cls_022">any form or by means electronic, mechanical, photocopying, or otherwise, without prior written</span></div>
<div style="position:absolute;left:53.88px;top:236.89px" class="cls_022"><span class="cls_022">permission of the publisher.</span></div>
<div style="position:absolute;left:53.88px;top:262.75px" class="cls_022"><span class="cls_022">Many of the designations used by manufacturers and sellers to distinguish their products are</span></div>
<div style="position:absolute;left:53.88px;top:273.76px" class="cls_022"><span class="cls_022">claimed as trademarks. Where those designations appear in the book, and Manning</span></div>
<div style="position:absolute;left:53.88px;top:284.77px" class="cls_022"><span class="cls_022">Publications was aware of a trademark claim, the designations have been printed in initial caps</span></div>
<div style="position:absolute;left:53.88px;top:295.75px" class="cls_022"><span class="cls_022">or all caps.</span></div>
<div style="position:absolute;left:53.88px;top:326.62px" class="cls_022"><span class="cls_022">Recognizing the importance of preserving what has been written, it is Manning’s policy to have</span></div>
<div style="position:absolute;left:53.88px;top:337.63px" class="cls_022"><span class="cls_022">the books we publish printed on acid-free paper, and we exert our best efforts to that end.</span></div>
<div style="position:absolute;left:53.88px;top:348.64px" class="cls_022"><span class="cls_022">Recognizing also our responsibility to conserve the resources of our planet, Manning books</span></div>
<div style="position:absolute;left:53.88px;top:359.62px" class="cls_022"><span class="cls_022">are printed on paper that is at least 15 percent recycled and processed without the use of</span></div>
<div style="position:absolute;left:53.88px;top:370.63px" class="cls_022"><span class="cls_022">elemental chlorine.</span></div>
<div style="position:absolute;left:77.88px;top:437.35px" class="cls_022"><span class="cls_022">Manning Publications Co.</span></div>
<div style="position:absolute;left:230.86px;top:437.35px" class="cls_022"><span class="cls_022">Development editor:  Jennifer Stout</span></div>
<div style="position:absolute;left:77.88px;top:449.29px" class="cls_022"><span class="cls_022">20 Baldwin Road</span></div>
<div style="position:absolute;left:245.05px;top:449.29px" class="cls_022"><span class="cls_022">Project manager:  Janet Vail</span></div>
<div style="position:absolute;left:77.88px;top:461.23px" class="cls_022"><span class="cls_022">PO Box 761</span></div>
<div style="position:absolute;left:260.19px;top:461.23px" class="cls_022"><span class="cls_022">Copy editors:  Frances Buran, Andy Carroll</span></div>
<div style="position:absolute;left:77.88px;top:473.14px" class="cls_022"><span class="cls_022">Shelter Island, NY 11964</span></div>
<div style="position:absolute;left:258.85px;top:473.14px" class="cls_022"><span class="cls_022">Proofreaders:  Melody Dolab, Katie Tennant</span></div>
<div style="position:absolute;left:220.92px;top:485.08px" class="cls_022"><span class="cls_022">Technical proofreader:  Joshua White</span></div>
<div style="position:absolute;left:268.56px;top:497.02px" class="cls_022"><span class="cls_022">Typesetter:  Dennis Dalinnik</span></div>
<div style="position:absolute;left:250.59px;top:508.93px" class="cls_022"><span class="cls_022">Cover designer:  Marija Tudor</span></div>
<div style="position:absolute;left:53.88px;top:563.74px" class="cls_022"><span class="cls_022">ISBN: 9781617294945</span></div>
<div style="position:absolute;left:53.88px;top:575.68px" class="cls_022"><span class="cls_022">Printed in the United States of America</span></div>
<div style="position:absolute;left:53.88px;top:587.59px" class="cls_022"><span class="cls_022">1 2 3 4 5 6 7 8 9 10 - DP - 23 22 21 20 19 18</span></div>
<div style="position:absolute;left:213.00px;top:647.00px" class="cls_006"><span class="cls_006"> </span><a href="http://www.allitebooks.org/">www.allitebooks.com</a> </div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:2700px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background005.jpg" width="531" height="666"></div>
<div style="position:absolute;left:322.38px;top:229.97px" class="cls_014"><span class="cls_014">brief contents</span></div>
<div style="position:absolute;left:66.18px;top:279.34px" class="cls_025"><span class="cls_025">P</span><span class="cls_026">ART</span><span class="cls_025"> 1</span></div>
<div style="position:absolute;left:122.37px;top:279.34px" class="cls_025"><span class="cls_025">F</span><span class="cls_026">OUNDATIONAL</span><span class="cls_025"> S</span><span class="cls_026">PRING</span></div>
<div style="position:absolute;left:454.92px;top:279.34px" class="cls_025"><span class="cls_025">1</span></div>
<div style="position:absolute;left:168.33px;top:304.34px" class="cls_027"><span class="cls_027">1</span></div>
<div style="position:absolute;left:183.90px;top:303.35px" class="cls_028"><span class="cls_028">■</span><span class="cls_029">   Getting started with Spring</span></div>
<div style="position:absolute;left:338.32px;top:303.35px" class="cls_029"><span class="cls_029">3</span></div>
<div style="position:absolute;left:168.33px;top:321.32px" class="cls_027"><span class="cls_027">2</span></div>
<div style="position:absolute;left:183.90px;top:320.33px" class="cls_028"><span class="cls_028">■</span><span class="cls_029">   Developing web applications</span></div>
<div style="position:absolute;left:346.04px;top:320.33px" class="cls_029"><span class="cls_029">29</span></div>
<div style="position:absolute;left:168.33px;top:338.33px" class="cls_027"><span class="cls_027">3</span></div>
<div style="position:absolute;left:183.90px;top:337.34px" class="cls_028"><span class="cls_028">■</span><span class="cls_029">   Working with data</span></div>
<div style="position:absolute;left:297.06px;top:337.34px" class="cls_029"><span class="cls_029">56</span></div>
<div style="position:absolute;left:168.33px;top:355.34px" class="cls_027"><span class="cls_027">4</span></div>
<div style="position:absolute;left:183.90px;top:354.35px" class="cls_028"><span class="cls_028">■</span><span class="cls_029">   Securing Spring</span></div>
<div style="position:absolute;left:286.29px;top:354.35px" class="cls_029"><span class="cls_029">84</span></div>
<div style="position:absolute;left:168.33px;top:372.35px" class="cls_027"><span class="cls_027">5</span></div>
<div style="position:absolute;left:183.90px;top:371.36px" class="cls_028"><span class="cls_028">■</span><span class="cls_029">   Working with configuration properties</span></div>
<div style="position:absolute;left:394.16px;top:371.36px" class="cls_029"><span class="cls_029">114</span></div>
<div style="position:absolute;left:66.18px;top:395.35px" class="cls_025"><span class="cls_025">P</span><span class="cls_026">ART</span><span class="cls_025"> 2</span></div>
<div style="position:absolute;left:122.37px;top:395.35px" class="cls_025"><span class="cls_025">I</span><span class="cls_026">NTEGRATED</span><span class="cls_025"> S</span><span class="cls_026">PRING</span></div>
<div style="position:absolute;left:440.39px;top:395.35px" class="cls_025"><span class="cls_025">135</span></div>
<div style="position:absolute;left:168.33px;top:420.35px" class="cls_027"><span class="cls_027">6</span></div>
<div style="position:absolute;left:183.90px;top:419.36px" class="cls_028"><span class="cls_028">■</span><span class="cls_029">   Creating REST services</span></div>
<div style="position:absolute;left:319.53px;top:419.36px" class="cls_029"><span class="cls_029">137</span></div>
<div style="position:absolute;left:168.33px;top:437.33px" class="cls_027"><span class="cls_027">7</span></div>
<div style="position:absolute;left:183.90px;top:436.34px" class="cls_028"><span class="cls_028">■</span><span class="cls_029">   Consuming REST services</span></div>
<div style="position:absolute;left:333.30px;top:436.34px" class="cls_029"><span class="cls_029">169</span></div>
<div style="position:absolute;left:168.33px;top:454.34px" class="cls_027"><span class="cls_027">8</span></div>
<div style="position:absolute;left:183.90px;top:453.35px" class="cls_028"><span class="cls_028">■</span><span class="cls_029">   Sending messages asynchronously</span></div>
<div style="position:absolute;left:371.09px;top:453.35px" class="cls_029"><span class="cls_029">178</span></div>
<div style="position:absolute;left:168.33px;top:471.35px" class="cls_027"><span class="cls_027">9</span></div>
<div style="position:absolute;left:183.90px;top:470.36px" class="cls_028"><span class="cls_028">■</span><span class="cls_029">   Integrating Spring</span></div>
<div style="position:absolute;left:297.71px;top:470.36px" class="cls_029"><span class="cls_029">209</span></div>
<div style="position:absolute;left:66.18px;top:494.35px" class="cls_025"><span class="cls_025">P</span><span class="cls_026">ART</span><span class="cls_025"> 3</span></div>
<div style="position:absolute;left:122.37px;top:494.35px" class="cls_025"><span class="cls_025">R</span><span class="cls_026">EACTIVE</span><span class="cls_025"> S</span><span class="cls_026">PRING</span></div>
<div style="position:absolute;left:440.39px;top:494.35px" class="cls_025"><span class="cls_025">239</span></div>
<div style="position:absolute;left:162.45px;top:519.35px" class="cls_027"><span class="cls_027">10</span></div>
<div style="position:absolute;left:183.90px;top:518.36px" class="cls_028"><span class="cls_028">■</span><span class="cls_029">   Introducing Reactor</span></div>
<div style="position:absolute;left:306.98px;top:518.36px" class="cls_029"><span class="cls_029">241</span></div>
<div style="position:absolute;left:162.45px;top:536.33px" class="cls_027"><span class="cls_027">11</span></div>
<div style="position:absolute;left:183.90px;top:535.34px" class="cls_028"><span class="cls_028">■</span><span class="cls_029">   Developing reactive APIs</span></div>
<div style="position:absolute;left:328.04px;top:535.34px" class="cls_029"><span class="cls_029">269</span></div>
<div style="position:absolute;left:162.45px;top:553.34px" class="cls_027"><span class="cls_027">12</span></div>
<div style="position:absolute;left:183.90px;top:552.35px" class="cls_028"><span class="cls_028">■</span><span class="cls_029">   Persisting data reactively</span></div>
<div style="position:absolute;left:326.06px;top:552.35px" class="cls_029"><span class="cls_029">296</span></div>
<div style="position:absolute;left:266.40px;top:596.99px" class="cls_024"><span class="cls_024">iii</span></div>
<div style="position:absolute;left:213.00px;top:649.00px" class="cls_006"><span class="cls_006"> </span><a href="http://www.allitebooks.org/">www.allitebooks.com</a> </div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:3376px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background006.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_024"><span class="cls_024">iv</span></div>
<div style="position:absolute;left:229.44px;top:25.37px" class="cls_030"><span class="cls_030">BRIEF CONTENTS</span></div>
<div style="position:absolute;left:57.18px;top:49.33px" class="cls_025"><span class="cls_025">P</span><span class="cls_026">ART</span><span class="cls_025"> 4</span></div>
<div style="position:absolute;left:113.37px;top:49.33px" class="cls_025"><span class="cls_025">C</span><span class="cls_026">LOUD</span><span class="cls_025">-</span><span class="cls_026">NATIVE</span><span class="cls_025"> S</span><span class="cls_026">PRING</span></div>
<div style="position:absolute;left:431.36px;top:49.33px" class="cls_025"><span class="cls_025">321</span></div>
<div style="position:absolute;left:153.45px;top:74.33px" class="cls_027"><span class="cls_027">13</span></div>
<div style="position:absolute;left:174.90px;top:73.34px" class="cls_028"><span class="cls_028">■</span><span class="cls_029">   Discovering services</span></div>
<div style="position:absolute;left:295.30px;top:73.34px" class="cls_029"><span class="cls_029">323</span></div>
<div style="position:absolute;left:153.45px;top:91.31px" class="cls_027"><span class="cls_027">14</span></div>
<div style="position:absolute;left:174.90px;top:90.32px" class="cls_028"><span class="cls_028">■</span><span class="cls_029">   Managing configuration</span></div>
<div style="position:absolute;left:316.44px;top:90.32px" class="cls_029"><span class="cls_029">343</span></div>
<div style="position:absolute;left:153.45px;top:108.32px" class="cls_027"><span class="cls_027">15</span></div>
<div style="position:absolute;left:174.90px;top:107.33px" class="cls_028"><span class="cls_028">■</span><span class="cls_029">   Handling failure and latency</span></div>
<div style="position:absolute;left:337.49px;top:107.33px" class="cls_029"><span class="cls_029">376</span></div>
<div style="position:absolute;left:57.18px;top:131.32px" class="cls_025"><span class="cls_025">P</span><span class="cls_026">ART</span><span class="cls_025"> 5</span></div>
<div style="position:absolute;left:113.37px;top:131.32px" class="cls_025"><span class="cls_025">D</span><span class="cls_026">EPLOYED</span><span class="cls_025"> S</span><span class="cls_026">PRING</span></div>
<div style="position:absolute;left:431.38px;top:131.32px" class="cls_025"><span class="cls_025">393</span></div>
<div style="position:absolute;left:153.45px;top:156.32px" class="cls_027"><span class="cls_027">16</span></div>
<div style="position:absolute;left:174.90px;top:155.33px" class="cls_028"><span class="cls_028">■</span><span class="cls_029">   Working with Spring Boot Actuator</span></div>
<div style="position:absolute;left:369.59px;top:155.33px" class="cls_029"><span class="cls_029">395</span></div>
<div style="position:absolute;left:153.48px;top:173.33px" class="cls_027"><span class="cls_027">17</span></div>
<div style="position:absolute;left:174.90px;top:172.34px" class="cls_028"><span class="cls_028">■</span><span class="cls_029">   Administering Spring</span></div>
<div style="position:absolute;left:303.44px;top:172.34px" class="cls_029"><span class="cls_029">429</span></div>
<div style="position:absolute;left:153.45px;top:190.34px" class="cls_027"><span class="cls_027">18</span></div>
<div style="position:absolute;left:174.90px;top:189.35px" class="cls_028"><span class="cls_028">■</span><span class="cls_029">   Monitoring Spring with JMX</span></div>
<div style="position:absolute;left:337.37px;top:189.35px" class="cls_029"><span class="cls_029">446</span></div>
<div style="position:absolute;left:153.45px;top:207.32px" class="cls_027"><span class="cls_027">19</span></div>
<div style="position:absolute;left:174.90px;top:206.33px" class="cls_028"><span class="cls_028">■</span><span class="cls_029">   Deploying Spring</span></div>
<div style="position:absolute;left:284.11px;top:206.33px" class="cls_029"><span class="cls_029">454</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:4052px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background007.jpg" width="531" height="666"></div>
<div style="position:absolute;left:379.98px;top:229.97px" class="cls_014"><span class="cls_014">contents</span></div>
<div style="position:absolute;left:150.18px;top:276.83px" class="cls_031"><span class="cls_031">preface  xiii</span></div>
<div style="position:absolute;left:150.18px;top:288.35px" class="cls_031"><span class="cls_031">acknowledgments  xv</span></div>
<div style="position:absolute;left:150.18px;top:299.84px" class="cls_031"><span class="cls_031">about this book  xvii</span></div>
<div style="position:absolute;left:66.18px;top:323.17px" class="cls_032"><span class="cls_032">P</span><span class="cls_033">ART</span><span class="cls_032"> 1</span></div>
<div style="position:absolute;left:130.38px;top:323.17px" class="cls_032"><span class="cls_032">F</span><span class="cls_033">OUNDATIONAL</span><span class="cls_032"> S</span><span class="cls_033">PRING</span></div>
<div style="position:absolute;left:465.86px;top:323.17px" class="cls_032"><span class="cls_032">1</span></div>
<div style="position:absolute;left:138.18px;top:352.15px" class="cls_035"><span class="cls_035">Getting started with Spring</span></div>
<div style="position:absolute;left:291.62px;top:352.15px" class="cls_035"><span class="cls_035">3</span></div>
<div style="position:absolute;left:110.34px;top:343.51px" class="cls_034"><span class="cls_034">1</span></div>
<div style="position:absolute;left:147.90px;top:370.85px" class="cls_029"><span class="cls_029">1.1</span></div>
<div style="position:absolute;left:174.16px;top:370.85px" class="cls_029"><span class="cls_029">What is Spring?</span></div>
<div style="position:absolute;left:259.43px;top:370.85px" class="cls_029"><span class="cls_029">4</span></div>
<div style="position:absolute;left:147.90px;top:386.84px" class="cls_029"><span class="cls_029">1.2</span></div>
<div style="position:absolute;left:174.17px;top:386.84px" class="cls_029"><span class="cls_029">Initializing a Spring application</span></div>
<div style="position:absolute;left:336.31px;top:386.84px" class="cls_029"><span class="cls_029">6</span></div>
<div style="position:absolute;left:186.18px;top:403.16px" class="cls_036"><span class="cls_036">Initializing a Spring project with Spring Tool Suite</span></div>
<div style="position:absolute;left:393.70px;top:403.16px" class="cls_036"><span class="cls_036">7</span></div>
<div style="position:absolute;left:186.18px;top:415.16px" class="cls_036"><span class="cls_036">Examining the Spring project structure</span></div>
<div style="position:absolute;left:345.90px;top:415.16px" class="cls_036"><span class="cls_036">11</span></div>
<div style="position:absolute;left:147.90px;top:431.84px" class="cls_029"><span class="cls_029">1.3</span></div>
<div style="position:absolute;left:174.17px;top:431.84px" class="cls_029"><span class="cls_029">Writing a Spring application</span></div>
<div style="position:absolute;left:320.97px;top:431.84px" class="cls_029"><span class="cls_029">17</span></div>
<div style="position:absolute;left:186.18px;top:448.16px" class="cls_036"><span class="cls_036">Handling web requests</span></div>
<div style="position:absolute;left:283.92px;top:448.16px" class="cls_036"><span class="cls_036">17</span><span class="cls_037"> ■</span><span class="cls_036">  Defining the view</span></div>
<div style="position:absolute;left:385.14px;top:448.16px" class="cls_036"><span class="cls_036">19</span></div>
<div style="position:absolute;left:186.18px;top:460.16px" class="cls_036"><span class="cls_036">Testing the controller</span></div>
<div style="position:absolute;left:277.13px;top:460.16px" class="cls_036"><span class="cls_036">20</span><span class="cls_037"> ■</span><span class="cls_036">  Building and running the</span></div>
<div style="position:absolute;left:186.18px;top:472.16px" class="cls_036"><span class="cls_036">application</span></div>
<div style="position:absolute;left:240.15px;top:472.16px" class="cls_036"><span class="cls_036">21</span><span class="cls_037"> ■</span><span class="cls_036">  Getting to know Spring Boot DevTools</span></div>
<div style="position:absolute;left:421.32px;top:472.16px" class="cls_036"><span class="cls_036">23</span></div>
<div style="position:absolute;left:186.18px;top:484.16px" class="cls_036"><span class="cls_036">Let’s review</span></div>
<div style="position:absolute;left:240.95px;top:484.16px" class="cls_036"><span class="cls_036">25</span></div>
<div style="position:absolute;left:147.90px;top:500.84px" class="cls_029"><span class="cls_029">1.4</span></div>
<div style="position:absolute;left:174.17px;top:500.84px" class="cls_029"><span class="cls_029">Surveying the Spring landscape</span></div>
<div style="position:absolute;left:335.26px;top:500.84px" class="cls_029"><span class="cls_029">26</span></div>
<div style="position:absolute;left:186.18px;top:517.16px" class="cls_036"><span class="cls_036">The core Spring Framework</span></div>
<div style="position:absolute;left:301.31px;top:517.16px" class="cls_036"><span class="cls_036">26</span><span class="cls_037"> ■</span><span class="cls_036">  Spring Boot</span></div>
<div style="position:absolute;left:380.30px;top:517.16px" class="cls_036"><span class="cls_036">26</span></div>
<div style="position:absolute;left:186.18px;top:529.16px" class="cls_036"><span class="cls_036">Spring Data</span></div>
<div style="position:absolute;left:243.94px;top:529.16px" class="cls_036"><span class="cls_036">27</span><span class="cls_037"> ■</span><span class="cls_036">  Spring Security</span></div>
<div style="position:absolute;left:335.95px;top:529.16px" class="cls_036"><span class="cls_036">27</span><span class="cls_037"> ■</span><span class="cls_036">  Spring Integration</span></div>
<div style="position:absolute;left:186.18px;top:541.19px" class="cls_036"><span class="cls_036">and Spring Batch</span></div>
<div style="position:absolute;left:265.16px;top:541.19px" class="cls_036"><span class="cls_036">27</span><span class="cls_037"> ■</span><span class="cls_036">  Spring Cloud</span></div>
<div style="position:absolute;left:350.56px;top:541.19px" class="cls_036"><span class="cls_036">28</span></div>
<div style="position:absolute;left:268.11px;top:596.99px" class="cls_024"><span class="cls_024">v</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:4728px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background008.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_024"><span class="cls_024">vi</span></div>
<div style="position:absolute;left:241.59px;top:24.68px" class="cls_030"><span class="cls_030">CONTENTS</span></div>
<div style="position:absolute;left:129.18px;top:49.66px" class="cls_035"><span class="cls_035">Developing web applications</span></div>
<div style="position:absolute;left:290.43px;top:49.66px" class="cls_035"><span class="cls_035">29</span></div>
<div style="position:absolute;left:101.34px;top:41.02px" class="cls_034"><span class="cls_034">2</span></div>
<div style="position:absolute;left:138.90px;top:68.33px" class="cls_029"><span class="cls_029">2.1</span></div>
<div style="position:absolute;left:165.17px;top:68.33px" class="cls_029"><span class="cls_029">Displaying information</span></div>
<div style="position:absolute;left:286.70px;top:68.33px" class="cls_029"><span class="cls_029">30</span></div>
<div style="position:absolute;left:177.18px;top:84.65px" class="cls_036"><span class="cls_036">Establishing the domain</span></div>
<div style="position:absolute;left:280.89px;top:84.65px" class="cls_036"><span class="cls_036">31</span><span class="cls_037"> ■</span><span class="cls_036">  Creating a controller class</span></div>
<div style="position:absolute;left:414.50px;top:84.65px" class="cls_036"><span class="cls_036">32</span></div>
<div style="position:absolute;left:177.18px;top:96.65px" class="cls_036"><span class="cls_036">Designing the view</span></div>
<div style="position:absolute;left:259.88px;top:96.65px" class="cls_036"><span class="cls_036">35</span></div>
<div style="position:absolute;left:138.90px;top:113.33px" class="cls_029"><span class="cls_029">2.2</span></div>
<div style="position:absolute;left:165.17px;top:113.33px" class="cls_029"><span class="cls_029">Processing form submission</span></div>
<div style="position:absolute;left:308.91px;top:113.33px" class="cls_029"><span class="cls_029">40</span></div>
<div style="position:absolute;left:138.90px;top:129.35px" class="cls_029"><span class="cls_029">2.3</span></div>
<div style="position:absolute;left:165.17px;top:129.35px" class="cls_029"><span class="cls_029">Validating form input</span></div>
<div style="position:absolute;left:280.34px;top:129.35px" class="cls_029"><span class="cls_029">45</span></div>
<div style="position:absolute;left:177.18px;top:145.67px" class="cls_036"><span class="cls_036">Declaring validation rules</span></div>
<div style="position:absolute;left:288.75px;top:145.67px" class="cls_036"><span class="cls_036">46</span><span class="cls_037"> ■</span><span class="cls_036">  Performing validation at</span></div>
<div style="position:absolute;left:177.18px;top:157.67px" class="cls_036"><span class="cls_036">form binding</span></div>
<div style="position:absolute;left:237.76px;top:157.67px" class="cls_036"><span class="cls_036">48</span><span class="cls_037"> ■</span><span class="cls_036">  Displaying validation errors</span></div>
<div style="position:absolute;left:379.91px;top:157.67px" class="cls_036"><span class="cls_036">49</span></div>
<div style="position:absolute;left:138.90px;top:174.35px" class="cls_029"><span class="cls_029">2.4</span></div>
<div style="position:absolute;left:165.17px;top:174.35px" class="cls_029"><span class="cls_029">Working with view controllers</span></div>
<div style="position:absolute;left:318.63px;top:174.35px" class="cls_029"><span class="cls_029">51</span></div>
<div style="position:absolute;left:138.90px;top:190.34px" class="cls_029"><span class="cls_029">2.5</span></div>
<div style="position:absolute;left:165.16px;top:190.34px" class="cls_029"><span class="cls_029">Choosing a view template library</span></div>
<div style="position:absolute;left:331.92px;top:190.34px" class="cls_029"><span class="cls_029">52</span></div>
<div style="position:absolute;left:177.18px;top:206.66px" class="cls_036"><span class="cls_036">Caching templates</span></div>
<div style="position:absolute;left:257.71px;top:206.66px" class="cls_036"><span class="cls_036">54</span></div>
<div style="position:absolute;left:129.18px;top:225.64px" class="cls_035"><span class="cls_035">Working with data</span></div>
<div style="position:absolute;left:239.86px;top:225.64px" class="cls_035"><span class="cls_035">56</span></div>
<div style="position:absolute;left:101.34px;top:217.00px" class="cls_034"><span class="cls_034">3</span></div>
<div style="position:absolute;left:138.90px;top:244.34px" class="cls_029"><span class="cls_029">3.1</span></div>
<div style="position:absolute;left:165.17px;top:244.34px" class="cls_029"><span class="cls_029">Reading and writing data with JDBC</span></div>
<div style="position:absolute;left:348.89px;top:244.34px" class="cls_029"><span class="cls_029">57</span></div>
<div style="position:absolute;left:177.18px;top:260.66px" class="cls_036"><span class="cls_036">Adapting the domain for persistence</span></div>
<div style="position:absolute;left:325.73px;top:260.66px" class="cls_036"><span class="cls_036">59</span><span class="cls_037"> ■</span><span class="cls_036">  Working with</span></div>
<div style="position:absolute;left:177.18px;top:272.66px" class="cls_036"><span class="cls_036">JdbcTemplate</span></div>
<div style="position:absolute;left:238.56px;top:272.66px" class="cls_036"><span class="cls_036">60</span><span class="cls_037"> ■</span><span class="cls_036">  Defining a schema and preloading data</span></div>
<div style="position:absolute;left:426.06px;top:272.66px" class="cls_036"><span class="cls_036">64</span></div>
<div style="position:absolute;left:177.18px;top:284.66px" class="cls_036"><span class="cls_036">Inserting data</span></div>
<div style="position:absolute;left:242.31px;top:284.66px" class="cls_036"><span class="cls_036">66</span></div>
<div style="position:absolute;left:138.90px;top:301.34px" class="cls_029"><span class="cls_029">3.2</span></div>
<div style="position:absolute;left:165.17px;top:301.34px" class="cls_029"><span class="cls_029">Persisting data with Spring Data JPA</span></div>
<div style="position:absolute;left:348.64px;top:301.34px" class="cls_029"><span class="cls_029">75</span></div>
<div style="position:absolute;left:177.18px;top:317.66px" class="cls_036"><span class="cls_036">Adding Spring Data JPA to the project</span></div>
<div style="position:absolute;left:335.10px;top:317.66px" class="cls_036"><span class="cls_036">76</span><span class="cls_037"> ■</span><span class="cls_036">  Annotating the</span></div>
<div style="position:absolute;left:177.18px;top:329.66px" class="cls_036"><span class="cls_036">domain as entities</span></div>
<div style="position:absolute;left:257.55px;top:329.66px" class="cls_036"><span class="cls_036">76</span><span class="cls_037"> ■</span><span class="cls_036">  Declaring JPA repositories</span></div>
<div style="position:absolute;left:390.51px;top:329.66px" class="cls_036"><span class="cls_036">80</span></div>
<div style="position:absolute;left:177.18px;top:341.66px" class="cls_036"><span class="cls_036">Customizing JPA repositories</span></div>
<div style="position:absolute;left:297.87px;top:341.66px" class="cls_036"><span class="cls_036">81</span></div>
<div style="position:absolute;left:129.18px;top:360.67px" class="cls_035"><span class="cls_035">Securing Spring</span></div>
<div style="position:absolute;left:223.73px;top:360.67px" class="cls_035"><span class="cls_035">84</span></div>
<div style="position:absolute;left:101.34px;top:352.03px" class="cls_034"><span class="cls_034">4</span></div>
<div style="position:absolute;left:138.90px;top:379.34px" class="cls_029"><span class="cls_029">4.1</span></div>
<div style="position:absolute;left:165.17px;top:379.34px" class="cls_029"><span class="cls_029">Enabling Spring Security</span></div>
<div style="position:absolute;left:295.29px;top:379.34px" class="cls_029"><span class="cls_029">85</span></div>
<div style="position:absolute;left:138.90px;top:395.36px" class="cls_029"><span class="cls_029">4.2</span></div>
<div style="position:absolute;left:165.17px;top:395.36px" class="cls_029"><span class="cls_029">Configuring Spring Security</span></div>
<div style="position:absolute;left:310.62px;top:395.36px" class="cls_029"><span class="cls_029">86</span></div>
<div style="position:absolute;left:177.18px;top:411.68px" class="cls_036"><span class="cls_036">In-memory user store</span></div>
<div style="position:absolute;left:265.91px;top:411.68px" class="cls_036"><span class="cls_036">88</span><span class="cls_037"> ■</span><span class="cls_036"> JDBC-based user store</span></div>
<div style="position:absolute;left:382.72px;top:411.68px" class="cls_036"><span class="cls_036">89</span></div>
<div style="position:absolute;left:177.18px;top:423.68px" class="cls_036"><span class="cls_036">LDAP-backed user store</span></div>
<div style="position:absolute;left:277.93px;top:423.68px" class="cls_036"><span class="cls_036">92</span><span class="cls_037"> ■</span><span class="cls_036"> Customizing user</span></div>
<div style="position:absolute;left:177.18px;top:435.68px" class="cls_036"><span class="cls_036">authentication</span></div>
<div style="position:absolute;left:244.13px;top:435.68px" class="cls_036"><span class="cls_036">96</span></div>
<div style="position:absolute;left:138.90px;top:452.36px" class="cls_029"><span class="cls_029">4.3</span></div>
<div style="position:absolute;left:165.17px;top:452.36px" class="cls_029"><span class="cls_029">Securing web requests</span></div>
<div style="position:absolute;left:282.30px;top:452.36px" class="cls_029"><span class="cls_029">103</span></div>
<div style="position:absolute;left:177.18px;top:468.68px" class="cls_036"><span class="cls_036">Securing requests</span></div>
<div style="position:absolute;left:253.18px;top:468.68px" class="cls_036"><span class="cls_036">104</span><span class="cls_037"> ■</span><span class="cls_036">  Creating a custom login page</span></div>
<div style="position:absolute;left:404.71px;top:468.68px" class="cls_036"><span class="cls_036">106</span></div>
<div style="position:absolute;left:177.18px;top:480.68px" class="cls_036"><span class="cls_036">Logging out</span></div>
<div style="position:absolute;left:234.17px;top:480.68px" class="cls_036"><span class="cls_036">109</span><span class="cls_037"> ■</span><span class="cls_036">  Preventing cross-site request forgery</span></div>
<div style="position:absolute;left:406.91px;top:480.68px" class="cls_036"><span class="cls_036">109</span></div>
<div style="position:absolute;left:138.90px;top:497.36px" class="cls_029"><span class="cls_029">4.4</span></div>
<div style="position:absolute;left:165.16px;top:497.36px" class="cls_029"><span class="cls_029">Knowing your user</span></div>
<div style="position:absolute;left:266.03px;top:497.36px" class="cls_029"><span class="cls_029">110</span></div>
<div style="position:absolute;left:129.18px;top:520.66px" class="cls_035"><span class="cls_035">Working with configuration properties</span></div>
<div style="position:absolute;left:339.85px;top:520.66px" class="cls_035"><span class="cls_035">114</span></div>
<div style="position:absolute;left:101.34px;top:512.02px" class="cls_034"><span class="cls_034">5</span></div>
<div style="position:absolute;left:138.90px;top:539.36px" class="cls_029"><span class="cls_029">5.1</span></div>
<div style="position:absolute;left:165.17px;top:539.36px" class="cls_029"><span class="cls_029">Fine-tuning autoconfiguration</span></div>
<div style="position:absolute;left:321.43px;top:539.36px" class="cls_029"><span class="cls_029">115</span></div>
<div style="position:absolute;left:177.18px;top:555.68px" class="cls_036"><span class="cls_036">Understanding Spring’s environment abstraction</span></div>
<div style="position:absolute;left:376.86px;top:555.68px" class="cls_036"><span class="cls_036">116</span></div>
<div style="position:absolute;left:177.18px;top:567.68px" class="cls_036"><span class="cls_036">Configuring a data source</span></div>
<div style="position:absolute;left:289.11px;top:567.68px" class="cls_036"><span class="cls_036">117</span><span class="cls_037"> ■</span><span class="cls_036">  Configuring the embedded</span></div>
<div style="position:absolute;left:177.18px;top:579.68px" class="cls_036"><span class="cls_036">server</span></div>
<div style="position:absolute;left:208.95px;top:579.68px" class="cls_036"><span class="cls_036">119</span><span class="cls_037"> ■</span><span class="cls_036">  Configuring logging</span></div>
<div style="position:absolute;left:326.34px;top:579.68px" class="cls_036"><span class="cls_036">120</span><span class="cls_037"> ■</span><span class="cls_036">  Using special</span></div>
<div style="position:absolute;left:177.18px;top:591.68px" class="cls_036"><span class="cls_036">property values</span></div>
<div style="position:absolute;left:245.11px;top:591.68px" class="cls_036"><span class="cls_036">121</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:5404px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background009.jpg" width="531" height="666"></div>
<div style="position:absolute;left:250.59px;top:24.68px" class="cls_030"><span class="cls_030">CONTENTS</span></div>
<div style="position:absolute;left:464.91px;top:24.35px" class="cls_024"><span class="cls_024">vii</span></div>
<div style="position:absolute;left:147.90px;top:50.33px" class="cls_029"><span class="cls_029">5.2</span></div>
<div style="position:absolute;left:174.17px;top:50.33px" class="cls_029"><span class="cls_029">Creating your own configuration properties</span></div>
<div style="position:absolute;left:394.17px;top:50.33px" class="cls_029"><span class="cls_029">122</span></div>
<div style="position:absolute;left:186.18px;top:66.65px" class="cls_036"><span class="cls_036">Defining configuration properties holders</span></div>
<div style="position:absolute;left:354.07px;top:66.65px" class="cls_036"><span class="cls_036">124</span><span class="cls_037"> ■</span><span class="cls_036">  Declaring</span></div>
<div style="position:absolute;left:186.18px;top:78.65px" class="cls_036"><span class="cls_036">configuration property metadata</span></div>
<div style="position:absolute;left:320.91px;top:78.65px" class="cls_036"><span class="cls_036">126</span></div>
<div style="position:absolute;left:147.90px;top:95.33px" class="cls_029"><span class="cls_029">5.3</span></div>
<div style="position:absolute;left:174.17px;top:95.33px" class="cls_029"><span class="cls_029">Configuring with profiles</span></div>
<div style="position:absolute;left:305.77px;top:95.33px" class="cls_029"><span class="cls_029">129</span></div>
<div style="position:absolute;left:186.18px;top:111.65px" class="cls_036"><span class="cls_036">Defining profile-specific properties</span></div>
<div style="position:absolute;left:325.07px;top:111.65px" class="cls_036"><span class="cls_036">130</span><span class="cls_037"> ■</span><span class="cls_036">  Activating profiles</span></div>
<div style="position:absolute;left:434.58px;top:111.65px" class="cls_036"><span class="cls_036">131</span></div>
<div style="position:absolute;left:186.18px;top:123.65px" class="cls_036"><span class="cls_036">Conditionally creating beans with profiles</span></div>
<div style="position:absolute;left:356.63px;top:123.65px" class="cls_036"><span class="cls_036">132</span></div>
<div style="position:absolute;left:66.18px;top:147.64px" class="cls_032"><span class="cls_032">P</span><span class="cls_033">ART</span><span class="cls_032"> 2</span></div>
<div style="position:absolute;left:130.38px;top:147.64px" class="cls_032"><span class="cls_032">I</span><span class="cls_033">NTEGRATED</span><span class="cls_032"> S</span><span class="cls_033">PRING</span></div>
<div style="position:absolute;left:449.18px;top:147.64px" class="cls_032"><span class="cls_032">135</span></div>
<div style="position:absolute;left:138.18px;top:176.65px" class="cls_035"><span class="cls_035">Creating REST services</span></div>
<div style="position:absolute;left:271.96px;top:176.65px" class="cls_035"><span class="cls_035">137</span></div>
<div style="position:absolute;left:110.34px;top:168.01px" class="cls_034"><span class="cls_034">6</span></div>
<div style="position:absolute;left:147.90px;top:195.35px" class="cls_029"><span class="cls_029">6.1</span></div>
<div style="position:absolute;left:174.17px;top:195.35px" class="cls_029"><span class="cls_029">Writing RESTful controllers</span></div>
<div style="position:absolute;left:319.03px;top:195.35px" class="cls_029"><span class="cls_029">138</span></div>
<div style="position:absolute;left:186.18px;top:211.67px" class="cls_036"><span class="cls_036">Retrieving data from the server</span></div>
<div style="position:absolute;left:314.68px;top:211.67px" class="cls_036"><span class="cls_036">140</span><span class="cls_037"> ■</span><span class="cls_036">  Sending data to the</span></div>
<div style="position:absolute;left:186.18px;top:223.67px" class="cls_036"><span class="cls_036">server</span></div>
<div style="position:absolute;left:217.95px;top:223.67px" class="cls_036"><span class="cls_036">145</span><span class="cls_037"> ■</span><span class="cls_036">  Updating data on the server</span></div>
<div style="position:absolute;left:364.75px;top:223.67px" class="cls_036"><span class="cls_036">146</span><span class="cls_037"> ■</span><span class="cls_036">  Deleting data</span></div>
<div style="position:absolute;left:186.18px;top:235.67px" class="cls_036"><span class="cls_036">from the server</span></div>
<div style="position:absolute;left:251.97px;top:235.67px" class="cls_036"><span class="cls_036">148</span></div>
<div style="position:absolute;left:147.90px;top:252.35px" class="cls_029"><span class="cls_029">6.2</span></div>
<div style="position:absolute;left:174.17px;top:252.35px" class="cls_029"><span class="cls_029">Enabling hypermedia</span></div>
<div style="position:absolute;left:288.48px;top:252.35px" class="cls_029"><span class="cls_029">149</span></div>
<div style="position:absolute;left:186.18px;top:268.67px" class="cls_036"><span class="cls_036">Adding hyperlinks</span></div>
<div style="position:absolute;left:267.09px;top:268.67px" class="cls_036"><span class="cls_036">152</span><span class="cls_037"> ■</span><span class="cls_036">  Creating resource assemblers</span></div>
<div style="position:absolute;left:414.28px;top:268.67px" class="cls_036"><span class="cls_036">154</span></div>
<div style="position:absolute;left:186.18px;top:280.67px" class="cls_036"><span class="cls_036">Naming embedded relationships</span></div>
<div style="position:absolute;left:319.16px;top:280.67px" class="cls_036"><span class="cls_036">159</span></div>
<div style="position:absolute;left:147.90px;top:297.35px" class="cls_029"><span class="cls_029">6.3</span></div>
<div style="position:absolute;left:174.17px;top:297.35px" class="cls_029"><span class="cls_029">Enabling data-backed services</span></div>
<div style="position:absolute;left:327.34px;top:297.35px" class="cls_029"><span class="cls_029">160</span></div>
<div style="position:absolute;left:186.18px;top:313.67px" class="cls_036"><span class="cls_036">Adjusting resource paths and relation names</span></div>
<div style="position:absolute;left:369.10px;top:313.67px" class="cls_036"><span class="cls_036">162</span><span class="cls_037"> ■</span><span class="cls_036">  Paging and</span></div>
<div style="position:absolute;left:186.18px;top:325.67px" class="cls_036"><span class="cls_036">sorting</span></div>
<div style="position:absolute;left:222.73px;top:325.67px" class="cls_036"><span class="cls_036">164</span><span class="cls_037"> ■</span><span class="cls_036">  Adding custom endpoints</span></div>
<div style="position:absolute;left:360.10px;top:325.67px" class="cls_036"><span class="cls_036">165</span><span class="cls_037"> ■</span><span class="cls_036">  Adding custom</span></div>
<div style="position:absolute;left:186.18px;top:337.67px" class="cls_036"><span class="cls_036">hyperlinks to Spring Data endpoints</span></div>
<div style="position:absolute;left:335.51px;top:337.67px" class="cls_036"><span class="cls_036">167</span></div>
<div style="position:absolute;left:138.18px;top:357.67px" class="cls_035"><span class="cls_035">Consuming REST services</span></div>
<div style="position:absolute;left:284.60px;top:357.67px" class="cls_035"><span class="cls_035">169</span></div>
<div style="position:absolute;left:110.34px;top:349.03px" class="cls_034"><span class="cls_034">7</span></div>
<div style="position:absolute;left:147.90px;top:376.34px" class="cls_029"><span class="cls_029">7.1</span></div>
<div style="position:absolute;left:174.17px;top:376.34px" class="cls_029"><span class="cls_029">Consuming REST endpoints with RestTemplate</span></div>
<div style="position:absolute;left:413.47px;top:376.34px" class="cls_029"><span class="cls_029">170</span></div>
<div style="position:absolute;left:186.18px;top:392.66px" class="cls_036"><span class="cls_036">GETting resources</span></div>
<div style="position:absolute;left:266.94px;top:392.66px" class="cls_036"><span class="cls_036">172</span><span class="cls_037"> ■</span><span class="cls_036">  PUTting resources</span></div>
<div style="position:absolute;left:376.33px;top:392.66px" class="cls_036"><span class="cls_036">173</span></div>
<div style="position:absolute;left:186.18px;top:404.66px" class="cls_036"><span class="cls_036">DELETEing resources</span></div>
<div style="position:absolute;left:281.14px;top:404.66px" class="cls_036"><span class="cls_036">174</span><span class="cls_037"> ■</span><span class="cls_036">  POSTing resource data</span></div>
<div style="position:absolute;left:409.73px;top:404.66px" class="cls_036"><span class="cls_036">174</span></div>
<div style="position:absolute;left:147.90px;top:421.34px" class="cls_029"><span class="cls_029">7.2</span></div>
<div style="position:absolute;left:174.17px;top:421.34px" class="cls_029"><span class="cls_029">Navigating REST APIs with Traverson</span></div>
<div style="position:absolute;left:364.66px;top:421.34px" class="cls_029"><span class="cls_029">175</span></div>
<div style="position:absolute;left:138.18px;top:445.66px" class="cls_035"><span class="cls_035">Sending messages asynchronously</span></div>
<div style="position:absolute;left:322.05px;top:445.66px" class="cls_035"><span class="cls_035">178</span></div>
<div style="position:absolute;left:110.34px;top:437.02px" class="cls_034"><span class="cls_034">8</span></div>
<div style="position:absolute;left:147.90px;top:464.36px" class="cls_029"><span class="cls_029">8.1</span></div>
<div style="position:absolute;left:174.17px;top:464.36px" class="cls_029"><span class="cls_029">Sending messages with JMS</span></div>
<div style="position:absolute;left:315.90px;top:464.36px" class="cls_029"><span class="cls_029">179</span></div>
<div style="position:absolute;left:186.18px;top:480.68px" class="cls_036"><span class="cls_036">Setting up JMS</span></div>
<div style="position:absolute;left:254.98px;top:480.68px" class="cls_036"><span class="cls_036">179</span><span class="cls_037"> ■</span><span class="cls_036">  Sending messages with JmsTemplate</span></div>
<div style="position:absolute;left:432.69px;top:480.68px" class="cls_036"><span class="cls_036">181</span></div>
<div style="position:absolute;left:186.18px;top:492.68px" class="cls_036"><span class="cls_036">Receiving JMS messages</span></div>
<div style="position:absolute;left:288.69px;top:492.68px" class="cls_036"><span class="cls_036">188</span></div>
<div style="position:absolute;left:147.90px;top:509.36px" class="cls_029"><span class="cls_029">8.2</span></div>
<div style="position:absolute;left:174.16px;top:509.36px" class="cls_029"><span class="cls_029">Working with RabbitMQ and AMQP</span></div>
<div style="position:absolute;left:358.58px;top:509.36px" class="cls_029"><span class="cls_029">192</span></div>
<div style="position:absolute;left:186.18px;top:525.68px" class="cls_036"><span class="cls_036">Adding RabbitMQ to Spring</span></div>
<div style="position:absolute;left:307.12px;top:525.68px" class="cls_036"><span class="cls_036">193</span><span class="cls_037"> ■</span><span class="cls_036">  Sending messages with</span></div>
<div style="position:absolute;left:186.18px;top:537.68px" class="cls_036"><span class="cls_036">RabbitTemplate</span></div>
<div style="position:absolute;left:257.11px;top:537.68px" class="cls_036"><span class="cls_036">194</span><span class="cls_037"> ■</span><span class="cls_036">  Receiving message from RabbitMQ</span></div>
<div style="position:absolute;left:429.69px;top:537.68px" class="cls_036"><span class="cls_036">198</span></div>
<div style="position:absolute;left:147.90px;top:554.36px" class="cls_029"><span class="cls_029">8.3</span></div>
<div style="position:absolute;left:174.16px;top:554.36px" class="cls_029"><span class="cls_029">Messaging with Kafka</span></div>
<div style="position:absolute;left:287.49px;top:554.36px" class="cls_029"><span class="cls_029">202</span></div>
<div style="position:absolute;left:186.18px;top:570.68px" class="cls_036"><span class="cls_036">Setting up Spring for Kafka messaging</span></div>
<div style="position:absolute;left:345.68px;top:570.68px" class="cls_036"><span class="cls_036">203</span><span class="cls_037"> ■</span><span class="cls_036">  Sending messages</span></div>
<div style="position:absolute;left:186.18px;top:582.68px" class="cls_036"><span class="cls_036">with KafkaTemplate</span></div>
<div style="position:absolute;left:275.18px;top:582.68px" class="cls_036"><span class="cls_036">204</span><span class="cls_037"> ■</span><span class="cls_036">  Writing Kafka listeners</span></div>
<div style="position:absolute;left:403.73px;top:582.68px" class="cls_036"><span class="cls_036">206</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:6080px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background010.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_024"><span class="cls_024">viii</span></div>
<div style="position:absolute;left:241.59px;top:24.68px" class="cls_030"><span class="cls_030">CONTENTS</span></div>
<div style="position:absolute;left:129.18px;top:49.66px" class="cls_035"><span class="cls_035">Integrating Spring</span></div>
<div style="position:absolute;left:236.42px;top:49.66px" class="cls_035"><span class="cls_035">209</span></div>
<div style="position:absolute;left:101.34px;top:41.02px" class="cls_034"><span class="cls_034">9</span></div>
<div style="position:absolute;left:138.90px;top:70.34px" class="cls_029"><span class="cls_029">9.1</span></div>
<div style="position:absolute;left:165.17px;top:70.34px" class="cls_029"><span class="cls_029">Declaring a simple integration flow</span></div>
<div style="position:absolute;left:344.24px;top:70.34px" class="cls_029"><span class="cls_029">210</span></div>
<div style="position:absolute;left:177.18px;top:86.66px" class="cls_036"><span class="cls_036">Defining integration flows with XML</span></div>
<div style="position:absolute;left:331.86px;top:86.66px" class="cls_036"><span class="cls_036">211</span><span class="cls_037"> ■</span><span class="cls_036">  Configuring</span></div>
<div style="position:absolute;left:177.18px;top:98.66px" class="cls_036"><span class="cls_036">integration flows in Java</span></div>
<div style="position:absolute;left:283.34px;top:98.66px" class="cls_036"><span class="cls_036">213</span><span class="cls_037"> ■</span><span class="cls_036">  Using Spring Integration’s</span></div>
<div style="position:absolute;left:177.18px;top:110.66px" class="cls_036"><span class="cls_036">DSL configuration</span></div>
<div style="position:absolute;left:259.89px;top:110.66px" class="cls_036"><span class="cls_036">215</span></div>
<div style="position:absolute;left:138.90px;top:127.34px" class="cls_029"><span class="cls_029">9.2</span></div>
<div style="position:absolute;left:165.17px;top:127.34px" class="cls_029"><span class="cls_029">Surveying the Spring Integration landscape</span></div>
<div style="position:absolute;left:383.36px;top:127.34px" class="cls_029"><span class="cls_029">216</span></div>
<div style="position:absolute;left:177.18px;top:143.66px" class="cls_036"><span class="cls_036">Message channels</span></div>
<div style="position:absolute;left:255.72px;top:143.66px" class="cls_036"><span class="cls_036">217</span><span class="cls_037"> ■</span><span class="cls_036">  Filters</span></div>
<div style="position:absolute;left:317.58px;top:143.66px" class="cls_036"><span class="cls_036">219</span><span class="cls_037"> ■</span><span class="cls_036">  Transformers</span></div>
<div style="position:absolute;left:407.74px;top:143.66px" class="cls_036"><span class="cls_036">220</span></div>
<div style="position:absolute;left:177.18px;top:155.66px" class="cls_036"><span class="cls_036">Routers</span></div>
<div style="position:absolute;left:216.34px;top:155.66px" class="cls_036"><span class="cls_036">221</span><span class="cls_037"> ■</span><span class="cls_036">  Splitters</span></div>
<div style="position:absolute;left:285.75px;top:155.66px" class="cls_036"><span class="cls_036">223</span><span class="cls_037"> ■</span><span class="cls_036">  Service activators</span></div>
<div style="position:absolute;left:390.95px;top:155.66px" class="cls_036"><span class="cls_036">225</span></div>
<div style="position:absolute;left:177.18px;top:167.66px" class="cls_036"><span class="cls_036">Gateways</span></div>
<div style="position:absolute;left:223.74px;top:167.66px" class="cls_036"><span class="cls_036">227</span><span class="cls_037"> ■</span><span class="cls_036">  Channel adapters</span></div>
<div style="position:absolute;left:331.18px;top:167.66px" class="cls_036"><span class="cls_036">228</span><span class="cls_037"> ■</span><span class="cls_036">  Endpoint</span></div>
<div style="position:absolute;left:177.18px;top:179.66px" class="cls_036"><span class="cls_036">modules</span></div>
<div style="position:absolute;left:218.53px;top:179.66px" class="cls_036"><span class="cls_036">230</span></div>
<div style="position:absolute;left:138.90px;top:196.34px" class="cls_029"><span class="cls_029">9.3</span></div>
<div style="position:absolute;left:165.16px;top:196.34px" class="cls_029"><span class="cls_029">Creating an email integration flow</span></div>
<div style="position:absolute;left:340.51px;top:196.34px" class="cls_029"><span class="cls_029">231</span></div>
<div style="position:absolute;left:57.18px;top:227.65px" class="cls_032"><span class="cls_032">P</span><span class="cls_033">ART</span><span class="cls_032"> 3</span></div>
<div style="position:absolute;left:121.38px;top:227.65px" class="cls_032"><span class="cls_032">R</span><span class="cls_033">EACTIVE</span><span class="cls_032"> S</span><span class="cls_033">PRING</span></div>
<div style="position:absolute;left:440.18px;top:227.65px" class="cls_032"><span class="cls_032">239</span></div>
<div style="position:absolute;left:129.18px;top:259.66px" class="cls_035"><span class="cls_035">Introducing Reactor</span></div>
<div style="position:absolute;left:245.31px;top:259.66px" class="cls_035"><span class="cls_035">241</span></div>
<div style="position:absolute;left:85.50px;top:251.02px" class="cls_034"><span class="cls_034">10</span></div>
<div style="position:absolute;left:133.17px;top:280.34px" class="cls_029"><span class="cls_029">10.1</span></div>
<div style="position:absolute;left:165.15px;top:280.34px" class="cls_029"><span class="cls_029">Understanding reactive programming</span></div>
<div style="position:absolute;left:357.86px;top:280.34px" class="cls_029"><span class="cls_029">242</span></div>
<div style="position:absolute;left:177.18px;top:296.66px" class="cls_036"><span class="cls_036">Defining Reactive Streams</span></div>
<div style="position:absolute;left:288.48px;top:296.66px" class="cls_036"><span class="cls_036">243</span></div>
<div style="position:absolute;left:133.17px;top:313.34px" class="cls_029"><span class="cls_029">10.2</span></div>
<div style="position:absolute;left:165.15px;top:313.34px" class="cls_029"><span class="cls_029">Getting started with Reactor</span></div>
<div style="position:absolute;left:310.67px;top:313.34px" class="cls_029"><span class="cls_029">245</span></div>
<div style="position:absolute;left:177.18px;top:329.66px" class="cls_036"><span class="cls_036">Diagramming reactive flows</span></div>
<div style="position:absolute;left:295.28px;top:329.66px" class="cls_036"><span class="cls_036">246</span><span class="cls_037"> ■</span><span class="cls_036">  Adding Reactor</span></div>
<div style="position:absolute;left:177.18px;top:341.66px" class="cls_036"><span class="cls_036">dependencies</span></div>
<div style="position:absolute;left:236.55px;top:341.66px" class="cls_036"><span class="cls_036">247</span></div>
<div style="position:absolute;left:133.17px;top:358.34px" class="cls_029"><span class="cls_029">10.3</span></div>
<div style="position:absolute;left:165.15px;top:358.34px" class="cls_029"><span class="cls_029">Applying common reactive operations</span></div>
<div style="position:absolute;left:358.49px;top:358.34px" class="cls_029"><span class="cls_029">248</span></div>
<div style="position:absolute;left:177.18px;top:374.66px" class="cls_036"><span class="cls_036">Creating reactive types</span></div>
<div style="position:absolute;left:273.37px;top:374.66px" class="cls_036"><span class="cls_036">249</span><span class="cls_037"> ■</span><span class="cls_036">  Combining reactive types</span></div>
<div style="position:absolute;left:407.48px;top:374.66px" class="cls_036"><span class="cls_036">253</span></div>
<div style="position:absolute;left:177.18px;top:386.66px" class="cls_036"><span class="cls_036">Transforming and filtering reactive streams</span></div>
<div style="position:absolute;left:355.65px;top:386.66px" class="cls_036"><span class="cls_036">257</span><span class="cls_037"> ■</span><span class="cls_036">  Performing</span></div>
<div style="position:absolute;left:177.18px;top:398.66px" class="cls_036"><span class="cls_036">logic operations on reactive types</span></div>
<div style="position:absolute;left:311.95px;top:398.66px" class="cls_036"><span class="cls_036">266</span></div>
<div style="position:absolute;left:129.18px;top:421.66px" class="cls_035"><span class="cls_035">Developing reactive APIs</span></div>
<div style="position:absolute;left:271.20px;top:421.66px" class="cls_035"><span class="cls_035">269</span></div>
<div style="position:absolute;left:85.50px;top:413.02px" class="cls_034"><span class="cls_034">11</span></div>
<div style="position:absolute;left:133.17px;top:442.34px" class="cls_029"><span class="cls_029">11.1</span></div>
<div style="position:absolute;left:165.15px;top:442.34px" class="cls_029"><span class="cls_029">Working with Spring WebFlux</span></div>
<div style="position:absolute;left:321.03px;top:442.34px" class="cls_029"><span class="cls_029">269</span></div>
<div style="position:absolute;left:177.18px;top:458.66px" class="cls_036"><span class="cls_036">Introducing Spring WebFlux</span></div>
<div style="position:absolute;left:298.11px;top:458.66px" class="cls_036"><span class="cls_036">271</span><span class="cls_037"> ■</span><span class="cls_036">  Writing reactive</span></div>
<div style="position:absolute;left:177.18px;top:470.66px" class="cls_036"><span class="cls_036">controllers</span></div>
<div style="position:absolute;left:226.38px;top:470.66px" class="cls_036"><span class="cls_036">272</span></div>
<div style="position:absolute;left:133.17px;top:487.34px" class="cls_029"><span class="cls_029">11.2</span></div>
<div style="position:absolute;left:165.16px;top:487.34px" class="cls_029"><span class="cls_029">Defining functional request handlers</span></div>
<div style="position:absolute;left:353.31px;top:487.34px" class="cls_029"><span class="cls_029">276</span></div>
<div style="position:absolute;left:133.17px;top:503.36px" class="cls_029"><span class="cls_029">11.3</span></div>
<div style="position:absolute;left:165.15px;top:503.36px" class="cls_029"><span class="cls_029">Testing reactive controllers</span></div>
<div style="position:absolute;left:306.26px;top:503.36px" class="cls_029"><span class="cls_029">279</span></div>
<div style="position:absolute;left:177.18px;top:519.68px" class="cls_036"><span class="cls_036">Testing GET requests</span></div>
<div style="position:absolute;left:269.77px;top:519.68px" class="cls_036"><span class="cls_036">279</span><span class="cls_037"> ■</span><span class="cls_036">  Testing POST requests</span></div>
<div style="position:absolute;left:395.97px;top:519.68px" class="cls_036"><span class="cls_036">282</span></div>
<div style="position:absolute;left:177.18px;top:531.68px" class="cls_036"><span class="cls_036">Testing with a live server</span></div>
<div style="position:absolute;left:283.68px;top:531.68px" class="cls_036"><span class="cls_036">284</span></div>
<div style="position:absolute;left:133.17px;top:548.36px" class="cls_029"><span class="cls_029">11.4</span></div>
<div style="position:absolute;left:165.15px;top:548.36px" class="cls_029"><span class="cls_029">Consuming REST APIs reactively</span></div>
<div style="position:absolute;left:333.29px;top:548.36px" class="cls_029"><span class="cls_029">285</span></div>
<div style="position:absolute;left:177.18px;top:564.68px" class="cls_036"><span class="cls_036">GETting resources</span></div>
<div style="position:absolute;left:257.92px;top:564.68px" class="cls_036"><span class="cls_036">285</span><span class="cls_037"> ■</span><span class="cls_036">  Sending resources</span></div>
<div style="position:absolute;left:364.52px;top:564.68px" class="cls_036"><span class="cls_036">287</span></div>
<div style="position:absolute;left:177.18px;top:576.68px" class="cls_036"><span class="cls_036">Deleting resources</span></div>
<div style="position:absolute;left:255.11px;top:576.68px" class="cls_036"><span class="cls_036">288</span><span class="cls_037"> ■</span><span class="cls_036">  Handling errors</span></div>
<div style="position:absolute;left:356.31px;top:576.68px" class="cls_036"><span class="cls_036">289</span></div>
<div style="position:absolute;left:177.18px;top:588.68px" class="cls_036"><span class="cls_036">Exchanging requests</span></div>
<div style="position:absolute;left:266.14px;top:588.68px" class="cls_036"><span class="cls_036">290</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:6756px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background011.jpg" width="531" height="666"></div>
<div style="position:absolute;left:250.59px;top:24.68px" class="cls_030"><span class="cls_030">CONTENTS</span></div>
<div style="position:absolute;left:466.71px;top:24.35px" class="cls_024"><span class="cls_024">ix</span></div>
<div style="position:absolute;left:142.17px;top:50.33px" class="cls_029"><span class="cls_029">11.5</span></div>
<div style="position:absolute;left:174.15px;top:50.33px" class="cls_029"><span class="cls_029">Securing reactive web APIs</span></div>
<div style="position:absolute;left:313.29px;top:50.33px" class="cls_029"><span class="cls_029">292</span></div>
<div style="position:absolute;left:186.18px;top:66.65px" class="cls_036"><span class="cls_036">Configuring reactive web security</span></div>
<div style="position:absolute;left:323.74px;top:66.65px" class="cls_036"><span class="cls_036">292</span><span class="cls_037"> ■</span><span class="cls_036">  Configuring a reactive</span></div>
<div style="position:absolute;left:186.18px;top:78.65px" class="cls_036"><span class="cls_036">user details service</span></div>
<div style="position:absolute;left:266.93px;top:78.65px" class="cls_036"><span class="cls_036">294</span></div>
<div style="position:absolute;left:138.18px;top:97.66px" class="cls_035"><span class="cls_035">Persisting data reactively</span></div>
<div style="position:absolute;left:280.98px;top:97.66px" class="cls_035"><span class="cls_035">296</span></div>
<div style="position:absolute;left:94.50px;top:89.02px" class="cls_034"><span class="cls_034">12</span></div>
<div style="position:absolute;left:142.17px;top:116.33px" class="cls_029"><span class="cls_029">12.1</span></div>
<div style="position:absolute;left:174.16px;top:116.33px" class="cls_029"><span class="cls_029">Understanding Spring Data’s reactive story</span></div>
<div style="position:absolute;left:389.99px;top:116.33px" class="cls_029"><span class="cls_029">297</span></div>
<div style="position:absolute;left:186.18px;top:132.65px" class="cls_036"><span class="cls_036">Spring Data reactive distilled</span></div>
<div style="position:absolute;left:308.67px;top:132.65px" class="cls_036"><span class="cls_036">297</span><span class="cls_037"> ■</span><span class="cls_036">  Converting between</span></div>
<div style="position:absolute;left:186.18px;top:144.65px" class="cls_036"><span class="cls_036">reactive and non-reactive types</span></div>
<div style="position:absolute;left:313.89px;top:144.65px" class="cls_036"><span class="cls_036">298</span><span class="cls_037"> ■</span><span class="cls_036">  Developing reactive</span></div>
<div style="position:absolute;left:186.18px;top:156.65px" class="cls_036"><span class="cls_036">repositories</span></div>
<div style="position:absolute;left:238.14px;top:156.65px" class="cls_036"><span class="cls_036">300</span></div>
<div style="position:absolute;left:142.17px;top:173.33px" class="cls_029"><span class="cls_029">12.2</span></div>
<div style="position:absolute;left:174.15px;top:173.33px" class="cls_029"><span class="cls_029">Working with reactive Cassandra repositories</span></div>
<div style="position:absolute;left:399.86px;top:173.33px" class="cls_029"><span class="cls_029">300</span></div>
<div style="position:absolute;left:186.18px;top:189.65px" class="cls_036"><span class="cls_036">Enabling Spring Data Cassandra</span></div>
<div style="position:absolute;left:323.80px;top:189.65px" class="cls_036"><span class="cls_036">301</span><span class="cls_037"> ■</span><span class="cls_036">  Understanding Cassandra</span></div>
<div style="position:absolute;left:186.18px;top:201.65px" class="cls_036"><span class="cls_036">data modeling</span></div>
<div style="position:absolute;left:250.33px;top:201.65px" class="cls_036"><span class="cls_036">303</span><span class="cls_037"> ■</span><span class="cls_036">  Mapping domain types for Cassandra</span></div>
<div style="position:absolute;left:186.18px;top:213.65px" class="cls_036"><span class="cls_036">persistence</span></div>
<div style="position:absolute;left:234.95px;top:213.65px" class="cls_036"><span class="cls_036">304</span><span class="cls_037"> ■</span><span class="cls_036">  Writing reactive Cassandra repositories</span></div>
<div style="position:absolute;left:420.12px;top:213.65px" class="cls_036"><span class="cls_036">309</span></div>
<div style="position:absolute;left:142.17px;top:230.33px" class="cls_029"><span class="cls_029">12.3</span></div>
<div style="position:absolute;left:174.16px;top:230.33px" class="cls_029"><span class="cls_029">Writing reactive MongoDB repositories</span></div>
<div style="position:absolute;left:372.43px;top:230.33px" class="cls_029"><span class="cls_029">312</span></div>
<div style="position:absolute;left:186.18px;top:246.65px" class="cls_036"><span class="cls_036">Enabling Spring Data MongoDB</span></div>
<div style="position:absolute;left:324.69px;top:246.65px" class="cls_036"><span class="cls_036">312</span><span class="cls_037"> ■</span><span class="cls_036">  Mapping domain types</span></div>
<div style="position:absolute;left:186.18px;top:258.65px" class="cls_036"><span class="cls_036">to documents</span></div>
<div style="position:absolute;left:246.54px;top:258.65px" class="cls_036"><span class="cls_036">314</span><span class="cls_037"> ■</span><span class="cls_036">  Writing reactive MongoDB repository</span></div>
<div style="position:absolute;left:186.18px;top:270.65px" class="cls_036"><span class="cls_036">interfaces</span></div>
<div style="position:absolute;left:232.35px;top:270.65px" class="cls_036"><span class="cls_036">317</span></div>
<div style="position:absolute;left:66.18px;top:292.66px" class="cls_032"><span class="cls_032">P</span><span class="cls_033">ART</span><span class="cls_032"> 4</span></div>
<div style="position:absolute;left:130.38px;top:292.66px" class="cls_032"><span class="cls_032">C</span><span class="cls_033">LOUD</span><span class="cls_032">-</span><span class="cls_033">NATIVE</span><span class="cls_032"> S</span><span class="cls_033">PRING</span></div>
<div style="position:absolute;left:449.19px;top:292.66px" class="cls_032"><span class="cls_032">321</span></div>
<div style="position:absolute;left:138.18px;top:320.65px" class="cls_035"><span class="cls_035">Discovering services</span></div>
<div style="position:absolute;left:254.00px;top:320.65px" class="cls_035"><span class="cls_035">323</span></div>
<div style="position:absolute;left:94.50px;top:312.01px" class="cls_034"><span class="cls_034">13</span></div>
<div style="position:absolute;left:142.17px;top:339.35px" class="cls_029"><span class="cls_029">13.1</span></div>
<div style="position:absolute;left:174.15px;top:339.35px" class="cls_029"><span class="cls_029">Thinking in microservices</span></div>
<div style="position:absolute;left:309.31px;top:339.35px" class="cls_029"><span class="cls_029">324</span></div>
<div style="position:absolute;left:142.17px;top:355.34px" class="cls_029"><span class="cls_029">13.2</span></div>
<div style="position:absolute;left:174.16px;top:355.34px" class="cls_029"><span class="cls_029">Setting up a service registry</span></div>
<div style="position:absolute;left:315.50px;top:355.34px" class="cls_029"><span class="cls_029">326</span></div>
<div style="position:absolute;left:186.18px;top:371.66px" class="cls_036"><span class="cls_036">Configuring Eureka</span></div>
<div style="position:absolute;left:273.93px;top:371.66px" class="cls_036"><span class="cls_036">330</span><span class="cls_037"> ■</span><span class="cls_036">  Scaling Eureka</span></div>
<div style="position:absolute;left:371.32px;top:371.66px" class="cls_036"><span class="cls_036">333</span></div>
<div style="position:absolute;left:142.17px;top:388.34px" class="cls_029"><span class="cls_029">13.3</span></div>
<div style="position:absolute;left:174.15px;top:388.34px" class="cls_029"><span class="cls_029">Registering and discovering services</span></div>
<div style="position:absolute;left:356.80px;top:388.34px" class="cls_029"><span class="cls_029">334</span></div>
<div style="position:absolute;left:186.18px;top:404.66px" class="cls_036"><span class="cls_036">Configuring Eureka client properties</span></div>
<div style="position:absolute;left:336.35px;top:404.66px" class="cls_036"><span class="cls_036">335</span><span class="cls_037"> ■</span><span class="cls_036">  Consuming</span></div>
<div style="position:absolute;left:186.18px;top:416.66px" class="cls_036"><span class="cls_036">services</span></div>
<div style="position:absolute;left:224.35px;top:416.66px" class="cls_036"><span class="cls_036">337</span></div>
<div style="position:absolute;left:138.18px;top:435.67px" class="cls_035"><span class="cls_035">Managing configuration</span></div>
<div style="position:absolute;left:276.56px;top:435.67px" class="cls_035"><span class="cls_035">343</span></div>
<div style="position:absolute;left:94.50px;top:427.03px" class="cls_034"><span class="cls_034">14</span></div>
<div style="position:absolute;left:142.17px;top:454.34px" class="cls_029"><span class="cls_029">14.1</span></div>
<div style="position:absolute;left:174.15px;top:454.34px" class="cls_029"><span class="cls_029">Sharing configuration</span></div>
<div style="position:absolute;left:290.83px;top:454.34px" class="cls_029"><span class="cls_029">344</span></div>
<div style="position:absolute;left:142.17px;top:470.36px" class="cls_029"><span class="cls_029">14.2</span></div>
<div style="position:absolute;left:174.16px;top:470.36px" class="cls_029"><span class="cls_029">Running Config Server</span></div>
<div style="position:absolute;left:295.73px;top:470.36px" class="cls_029"><span class="cls_029">345</span></div>
<div style="position:absolute;left:186.18px;top:486.68px" class="cls_036"><span class="cls_036">Enabling Config Server</span></div>
<div style="position:absolute;left:286.28px;top:486.68px" class="cls_036"><span class="cls_036">346</span><span class="cls_037"> ■</span><span class="cls_036">  Populating the configuration</span></div>
<div style="position:absolute;left:186.18px;top:498.68px" class="cls_036"><span class="cls_036">repository</span></div>
<div style="position:absolute;left:232.35px;top:498.68px" class="cls_036"><span class="cls_036">349</span></div>
<div style="position:absolute;left:142.17px;top:515.36px" class="cls_029"><span class="cls_029">14.3</span></div>
<div style="position:absolute;left:174.15px;top:515.36px" class="cls_029"><span class="cls_029">Consuming shared configuration</span></div>
<div style="position:absolute;left:343.83px;top:515.36px" class="cls_029"><span class="cls_029">352</span></div>
<div style="position:absolute;left:142.17px;top:531.35px" class="cls_029"><span class="cls_029">14.4</span></div>
<div style="position:absolute;left:174.15px;top:531.35px" class="cls_029"><span class="cls_029">Serving application- and profile-specific properties</span></div>
<div style="position:absolute;left:426.42px;top:531.35px" class="cls_029"><span class="cls_029">353</span></div>
<div style="position:absolute;left:186.18px;top:547.67px" class="cls_036"><span class="cls_036">Serving application-specific properties</span></div>
<div style="position:absolute;left:340.52px;top:547.67px" class="cls_036"><span class="cls_036">354</span><span class="cls_037"> ■</span><span class="cls_036">  Serving properties</span></div>
<div style="position:absolute;left:186.18px;top:559.67px" class="cls_036"><span class="cls_036">from profiles</span></div>
<div style="position:absolute;left:243.78px;top:559.67px" class="cls_036"><span class="cls_036">355</span></div>
<div style="position:absolute;left:142.17px;top:576.35px" class="cls_029"><span class="cls_029">14.5</span></div>
<div style="position:absolute;left:174.15px;top:576.35px" class="cls_029"><span class="cls_029">Keeping configuration properties secret</span></div>
<div style="position:absolute;left:376.29px;top:576.35px" class="cls_029"><span class="cls_029">357</span></div>
<div style="position:absolute;left:186.18px;top:592.67px" class="cls_036"><span class="cls_036">Encrypting properties in Git</span></div>
<div style="position:absolute;left:303.50px;top:592.67px" class="cls_036"><span class="cls_036">357</span><span class="cls_037"> ■</span><span class="cls_036">  Storing secrets in Vault</span></div>
<div style="position:absolute;left:431.48px;top:592.67px" class="cls_036"><span class="cls_036">360</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:7432px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background012.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_024"><span class="cls_024">x</span></div>
<div style="position:absolute;left:241.59px;top:24.68px" class="cls_030"><span class="cls_030">CONTENTS</span></div>
<div style="position:absolute;left:133.17px;top:50.33px" class="cls_029"><span class="cls_029">14.6</span></div>
<div style="position:absolute;left:165.16px;top:50.33px" class="cls_029"><span class="cls_029">Refreshing configuration properties on the fly</span></div>
<div style="position:absolute;left:396.82px;top:50.33px" class="cls_029"><span class="cls_029">364</span></div>
<div style="position:absolute;left:177.18px;top:66.65px" class="cls_036"><span class="cls_036">Manually refreshing configuration properties</span></div>
<div style="position:absolute;left:360.66px;top:66.65px" class="cls_036"><span class="cls_036">365</span></div>
<div style="position:absolute;left:177.18px;top:78.65px" class="cls_036"><span class="cls_036">Automatically refreshing configuration properties</span></div>
<div style="position:absolute;left:376.04px;top:78.65px" class="cls_036"><span class="cls_036">367</span></div>
<div style="position:absolute;left:129.18px;top:98.65px" class="cls_035"><span class="cls_035">Handling failure and latency</span></div>
<div style="position:absolute;left:291.54px;top:98.65px" class="cls_035"><span class="cls_035">376</span></div>
<div style="position:absolute;left:85.50px;top:90.01px" class="cls_034"><span class="cls_034">15</span></div>
<div style="position:absolute;left:133.17px;top:117.32px" class="cls_029"><span class="cls_029">15.1</span></div>
<div style="position:absolute;left:165.15px;top:117.32px" class="cls_029"><span class="cls_029">Understanding circuit breakers</span></div>
<div style="position:absolute;left:325.81px;top:117.32px" class="cls_029"><span class="cls_029">376</span></div>
<div style="position:absolute;left:133.17px;top:133.34px" class="cls_029"><span class="cls_029">15.2</span></div>
<div style="position:absolute;left:165.15px;top:133.34px" class="cls_029"><span class="cls_029">Declaring circuit breakers</span></div>
<div style="position:absolute;left:300.08px;top:133.34px" class="cls_029"><span class="cls_029">378</span></div>
<div style="position:absolute;left:177.18px;top:149.66px" class="cls_036"><span class="cls_036">Mitigating latency</span></div>
<div style="position:absolute;left:258.71px;top:149.66px" class="cls_036"><span class="cls_036">381</span><span class="cls_037"> ■</span><span class="cls_036">  Managing circuit breaker</span></div>
<div style="position:absolute;left:177.18px;top:161.66px" class="cls_036"><span class="cls_036">thresholds</span></div>
<div style="position:absolute;left:225.34px;top:161.66px" class="cls_036"><span class="cls_036">382</span></div>
<div style="position:absolute;left:133.17px;top:178.34px" class="cls_029"><span class="cls_029">15.3</span></div>
<div style="position:absolute;left:165.15px;top:178.34px" class="cls_029"><span class="cls_029">Monitoring failures</span></div>
<div style="position:absolute;left:269.10px;top:178.34px" class="cls_029"><span class="cls_029">383</span></div>
<div style="position:absolute;left:177.18px;top:194.66px" class="cls_036"><span class="cls_036">Introducing the Hystrix dashboard</span></div>
<div style="position:absolute;left:320.53px;top:194.66px" class="cls_036"><span class="cls_036">384</span><span class="cls_037"> ■</span><span class="cls_036">  Understanding Hystrix</span></div>
<div style="position:absolute;left:177.18px;top:206.66px" class="cls_036"><span class="cls_036">thread pools</span></div>
<div style="position:absolute;left:233.59px;top:206.66px" class="cls_036"><span class="cls_036">387</span></div>
<div style="position:absolute;left:133.17px;top:223.34px" class="cls_029"><span class="cls_029">15.4</span></div>
<div style="position:absolute;left:165.15px;top:223.34px" class="cls_029"><span class="cls_029">Aggregating multiple Hystrix streams</span></div>
<div style="position:absolute;left:353.97px;top:223.34px" class="cls_029"><span class="cls_029">389</span></div>
<div style="position:absolute;left:57.18px;top:251.65px" class="cls_032"><span class="cls_032">P</span><span class="cls_033">ART</span><span class="cls_032"> 5</span></div>
<div style="position:absolute;left:121.38px;top:251.65px" class="cls_032"><span class="cls_032">D</span><span class="cls_033">EPLOYED</span><span class="cls_032"> S</span><span class="cls_033">PRING</span></div>
<div style="position:absolute;left:440.17px;top:251.65px" class="cls_032"><span class="cls_032">393</span></div>
<div style="position:absolute;left:129.18px;top:280.66px" class="cls_035"><span class="cls_035">Working with Spring Boot Actuator</span></div>
<div style="position:absolute;left:324.51px;top:280.66px" class="cls_035"><span class="cls_035">395</span></div>
<div style="position:absolute;left:85.50px;top:272.02px" class="cls_034"><span class="cls_034">16</span></div>
<div style="position:absolute;left:133.17px;top:299.33px" class="cls_029"><span class="cls_029">16.1</span></div>
<div style="position:absolute;left:165.15px;top:299.33px" class="cls_029"><span class="cls_029">Introducing Actuator</span></div>
<div style="position:absolute;left:278.34px;top:299.33px" class="cls_029"><span class="cls_029">396</span></div>
<div style="position:absolute;left:177.18px;top:315.68px" class="cls_036"><span class="cls_036">Configuring Actuator’s base path</span></div>
<div style="position:absolute;left:315.97px;top:315.68px" class="cls_036"><span class="cls_036">397</span><span class="cls_037"> ■</span><span class="cls_036">  Enabling and</span></div>
<div style="position:absolute;left:177.18px;top:327.68px" class="cls_036"><span class="cls_036">disabling Actuator endpoints</span></div>
<div style="position:absolute;left:299.52px;top:327.68px" class="cls_036"><span class="cls_036">398</span></div>
<div style="position:absolute;left:133.17px;top:344.33px" class="cls_029"><span class="cls_029">16.2</span></div>
<div style="position:absolute;left:165.16px;top:344.33px" class="cls_029"><span class="cls_029">Consuming Actuator endpoints</span></div>
<div style="position:absolute;left:326.99px;top:344.33px" class="cls_029"><span class="cls_029">399</span></div>
<div style="position:absolute;left:177.18px;top:360.68px" class="cls_036"><span class="cls_036">Fetching essential application information</span></div>
<div style="position:absolute;left:350.12px;top:360.68px" class="cls_036"><span class="cls_036">400</span><span class="cls_037"> ■</span><span class="cls_036">  Viewing</span></div>
<div style="position:absolute;left:177.18px;top:372.68px" class="cls_036"><span class="cls_036">configuration details</span></div>
<div style="position:absolute;left:267.49px;top:372.68px" class="cls_036"><span class="cls_036">403</span><span class="cls_037"> ■</span><span class="cls_036">  Viewing application activity</span></div>
<div style="position:absolute;left:414.91px;top:372.68px" class="cls_036"><span class="cls_036">411</span></div>
<div style="position:absolute;left:177.18px;top:384.68px" class="cls_036"><span class="cls_036">Tapping runtime metrics</span></div>
<div style="position:absolute;left:283.52px;top:384.68px" class="cls_036"><span class="cls_036">413</span></div>
<div style="position:absolute;left:133.17px;top:401.36px" class="cls_029"><span class="cls_029">16.3</span></div>
<div style="position:absolute;left:165.16px;top:401.36px" class="cls_029"><span class="cls_029">Customizing Actuator</span></div>
<div style="position:absolute;left:280.55px;top:401.36px" class="cls_029"><span class="cls_029">416</span></div>
<div style="position:absolute;left:177.18px;top:417.68px" class="cls_036"><span class="cls_036">Contributing information to the /info endpoint</span></div>
<div style="position:absolute;left:369.09px;top:417.68px" class="cls_036"><span class="cls_036">416</span></div>
<div style="position:absolute;left:177.18px;top:429.68px" class="cls_036"><span class="cls_036">Defining custom health indicators</span></div>
<div style="position:absolute;left:318.03px;top:429.68px" class="cls_036"><span class="cls_036">421</span><span class="cls_037"> ■</span><span class="cls_036">  Registering</span></div>
<div style="position:absolute;left:177.18px;top:441.68px" class="cls_036"><span class="cls_036">custom metrics</span></div>
<div style="position:absolute;left:243.12px;top:441.68px" class="cls_036"><span class="cls_036">422</span><span class="cls_037"> ■</span><span class="cls_036">  Creating custom endpoints</span></div>
<div style="position:absolute;left:384.87px;top:441.68px" class="cls_036"><span class="cls_036">424</span></div>
<div style="position:absolute;left:133.17px;top:458.36px" class="cls_029"><span class="cls_029">16.4</span></div>
<div style="position:absolute;left:165.16px;top:458.36px" class="cls_029"><span class="cls_029">Securing Actuator</span></div>
<div style="position:absolute;left:262.96px;top:458.36px" class="cls_029"><span class="cls_029">426</span></div>
<div style="position:absolute;left:129.18px;top:482.65px" class="cls_035"><span class="cls_035">Administering Spring</span></div>
<div style="position:absolute;left:252.28px;top:482.65px" class="cls_035"><span class="cls_035">429</span></div>
<div style="position:absolute;left:85.50px;top:474.01px" class="cls_034"><span class="cls_034">17</span></div>
<div style="position:absolute;left:133.17px;top:501.35px" class="cls_029"><span class="cls_029">17.1</span></div>
<div style="position:absolute;left:165.15px;top:501.35px" class="cls_029"><span class="cls_029">Using the Spring Boot Admin</span></div>
<div style="position:absolute;left:318.54px;top:501.35px" class="cls_029"><span class="cls_029">430</span></div>
<div style="position:absolute;left:177.18px;top:517.67px" class="cls_036"><span class="cls_036">Creating an Admin server</span></div>
<div style="position:absolute;left:287.81px;top:517.67px" class="cls_036"><span class="cls_036">430</span><span class="cls_037"> ■</span><span class="cls_036">  Registering Admin clients</span></div>
<div style="position:absolute;left:425.52px;top:517.67px" class="cls_036"><span class="cls_036">431</span></div>
<div style="position:absolute;left:133.17px;top:534.35px" class="cls_029"><span class="cls_029">17.2</span></div>
<div style="position:absolute;left:165.16px;top:534.35px" class="cls_029"><span class="cls_029">Exploring the Admin server</span></div>
<div style="position:absolute;left:309.37px;top:534.35px" class="cls_029"><span class="cls_029">435</span></div>
<div style="position:absolute;left:177.18px;top:550.67px" class="cls_036"><span class="cls_036">Viewing general application health and information</span></div>
<div style="position:absolute;left:388.84px;top:550.67px" class="cls_036"><span class="cls_036">436</span></div>
<div style="position:absolute;left:177.18px;top:562.67px" class="cls_036"><span class="cls_036">Watching key metrics</span></div>
<div style="position:absolute;left:268.11px;top:562.67px" class="cls_036"><span class="cls_036">437</span><span class="cls_037"> ■</span><span class="cls_036">  Examining environment</span></div>
<div style="position:absolute;left:177.18px;top:574.67px" class="cls_036"><span class="cls_036">properties</span></div>
<div style="position:absolute;left:223.54px;top:574.67px" class="cls_036"><span class="cls_036">438</span><span class="cls_037"> ■</span><span class="cls_036">  Viewing and setting logging levels</span></div>
<div style="position:absolute;left:393.10px;top:574.67px" class="cls_036"><span class="cls_036">439</span></div>
<div style="position:absolute;left:177.18px;top:586.67px" class="cls_036"><span class="cls_036">Monitoring threads</span></div>
<div style="position:absolute;left:262.32px;top:586.67px" class="cls_036"><span class="cls_036">440</span><span class="cls_037"> ■</span><span class="cls_036">  Tracing HTTP requests</span></div>
<div style="position:absolute;left:393.28px;top:586.67px" class="cls_036"><span class="cls_036">441</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:8108px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background013.jpg" width="531" height="666"></div>
<div style="position:absolute;left:250.59px;top:24.68px" class="cls_030"><span class="cls_030">CONTENTS</span></div>
<div style="position:absolute;left:466.71px;top:24.35px" class="cls_024"><span class="cls_024">xi</span></div>
<div style="position:absolute;left:142.17px;top:50.33px" class="cls_029"><span class="cls_029">17.3</span></div>
<div style="position:absolute;left:174.15px;top:50.33px" class="cls_029"><span class="cls_029">Securing the Admin server</span></div>
<div style="position:absolute;left:312.85px;top:50.33px" class="cls_029"><span class="cls_029">442</span></div>
<div style="position:absolute;left:186.18px;top:66.65px" class="cls_036"><span class="cls_036">Enabling login in the Admin server</span></div>
<div style="position:absolute;left:332.86px;top:66.65px" class="cls_036"><span class="cls_036">443</span><span class="cls_037"> ■</span><span class="cls_036">  Authenticating with</span></div>
<div style="position:absolute;left:186.18px;top:78.65px" class="cls_036"><span class="cls_036">the Actuator</span></div>
<div style="position:absolute;left:243.76px;top:78.65px" class="cls_036"><span class="cls_036">444</span></div>
<div style="position:absolute;left:138.18px;top:98.65px" class="cls_035"><span class="cls_035">Monitoring Spring with JMX</span></div>
<div style="position:absolute;left:300.57px;top:98.65px" class="cls_035"><span class="cls_035">446</span></div>
<div style="position:absolute;left:94.50px;top:90.01px" class="cls_034"><span class="cls_034">18</span></div>
<div style="position:absolute;left:142.17px;top:117.32px" class="cls_029"><span class="cls_029">18.1</span></div>
<div style="position:absolute;left:174.15px;top:117.32px" class="cls_029"><span class="cls_029">Working with Actuator MBeans</span></div>
<div style="position:absolute;left:335.01px;top:117.32px" class="cls_029"><span class="cls_029">446</span></div>
<div style="position:absolute;left:142.17px;top:133.34px" class="cls_029"><span class="cls_029">18.2</span></div>
<div style="position:absolute;left:174.15px;top:133.34px" class="cls_029"><span class="cls_029">Creating your own MBeans</span></div>
<div style="position:absolute;left:314.64px;top:133.34px" class="cls_029"><span class="cls_029">449</span></div>
<div style="position:absolute;left:142.17px;top:149.33px" class="cls_029"><span class="cls_029">18.3</span></div>
<div style="position:absolute;left:174.16px;top:149.33px" class="cls_029"><span class="cls_029">Sending notifications</span></div>
<div style="position:absolute;left:287.17px;top:149.33px" class="cls_029"><span class="cls_029">451</span></div>
<div style="position:absolute;left:138.18px;top:173.65px" class="cls_035"><span class="cls_035">Deploying Spring</span></div>
<div style="position:absolute;left:240.26px;top:173.65px" class="cls_035"><span class="cls_035">454</span></div>
<div style="position:absolute;left:94.50px;top:165.01px" class="cls_034"><span class="cls_034">19</span></div>
<div style="position:absolute;left:142.17px;top:192.35px" class="cls_029"><span class="cls_029">19.1</span></div>
<div style="position:absolute;left:174.15px;top:192.35px" class="cls_029"><span class="cls_029">Weighing deployment options</span></div>
<div style="position:absolute;left:329.96px;top:192.35px" class="cls_029"><span class="cls_029">455</span></div>
<div style="position:absolute;left:142.17px;top:208.34px" class="cls_029"><span class="cls_029">19.2</span></div>
<div style="position:absolute;left:174.15px;top:208.34px" class="cls_029"><span class="cls_029">Building and deploying WAR files</span></div>
<div style="position:absolute;left:347.08px;top:208.34px" class="cls_029"><span class="cls_029">456</span></div>
<div style="position:absolute;left:142.17px;top:224.33px" class="cls_029"><span class="cls_029">19.3</span></div>
<div style="position:absolute;left:174.15px;top:224.33px" class="cls_029"><span class="cls_029">Pushing JAR files to Cloud Foundry</span></div>
<div style="position:absolute;left:354.99px;top:224.33px" class="cls_029"><span class="cls_029">458</span></div>
<div style="position:absolute;left:142.17px;top:240.35px" class="cls_029"><span class="cls_029">19.4</span></div>
<div style="position:absolute;left:174.15px;top:240.35px" class="cls_029"><span class="cls_029">Running Spring Boot in a Docker container</span></div>
<div style="position:absolute;left:395.26px;top:240.35px" class="cls_029"><span class="cls_029">461</span></div>
<div style="position:absolute;left:142.17px;top:256.34px" class="cls_029"><span class="cls_029">19.5</span></div>
<div style="position:absolute;left:174.16px;top:256.34px" class="cls_029"><span class="cls_029">The end is where we begin</span></div>
<div style="position:absolute;left:312.91px;top:256.34px" class="cls_029"><span class="cls_029">465</span></div>
<div style="position:absolute;left:122.61px;top:288.35px" class="cls_038"><span class="cls_038">appendix   Bootstrapping Spring applications</span></div>
<div style="position:absolute;left:330.83px;top:288.35px" class="cls_038"><span class="cls_038">466</span></div>
<div style="position:absolute;left:174.18px;top:309.35px" class="cls_038"><span class="cls_038">index</span></div>
<div style="position:absolute;left:208.70px;top:309.35px" class="cls_038"><span class="cls_038">487</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:8784px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background014.jpg" width="531" height="666"></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:8784px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background015.jpg" width="531" height="666"></div>
<div style="position:absolute;left:394.98px;top:229.97px" class="cls_014"><span class="cls_014">preface</span></div>
<div style="position:absolute;left:102.18px;top:280.67px" class="cls_039"><span class="cls_039">After nearly 15 years of working with Spring and having written five editions of this</span></div>
<div style="position:absolute;left:102.18px;top:293.66px" class="cls_039"><span class="cls_039">book (not to mention </span><span class="cls_036">Spring Boot in Action</span><span class="cls_039">), you’d think that it’d be hard to come up</span></div>
<div style="position:absolute;left:102.18px;top:306.68px" class="cls_039"><span class="cls_039">with something exciting and new to say about Spring when writing the preface for this</span></div>
<div style="position:absolute;left:102.18px;top:319.67px" class="cls_039"><span class="cls_039">book. But nothing could be further from the truth!</span></div>
<div style="position:absolute;left:117.84px;top:332.66px" class="cls_039"><span class="cls_039">Every single release of Spring, Spring Boot, and all of the other projects in the</span></div>
<div style="position:absolute;left:102.18px;top:345.68px" class="cls_039"><span class="cls_039">Spring ecosystem unleashes some new amazing capabilities that rekindle the fun in</span></div>
<div style="position:absolute;left:102.18px;top:358.67px" class="cls_039"><span class="cls_039">developing applications. With Spring reaching a significant milestone with its 5.0</span></div>
<div style="position:absolute;left:102.18px;top:371.66px" class="cls_039"><span class="cls_039">release and Spring Boot releasing version 2.0, there’s so much more Spring to enjoy</span></div>
<div style="position:absolute;left:102.18px;top:384.68px" class="cls_039"><span class="cls_039">that it was a no-brainer to write another edition of </span><span class="cls_036">Spring in Action</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.44px;top:397.67px" class="cls_039"><span class="cls_039">The big story of Spring 5 is reactive programming support, including Spring Web-</span></div>
<div style="position:absolute;left:102.18px;top:410.66px" class="cls_039"><span class="cls_039">Flux, a brand new reactive web framework that borrows its programming model from</span></div>
<div style="position:absolute;left:102.18px;top:423.68px" class="cls_039"><span class="cls_039">Spring MVC, allowing developers to create web applications that scale better and make</span></div>
<div style="position:absolute;left:102.18px;top:436.67px" class="cls_039"><span class="cls_039">better use of fewer threads. Moving toward the backend of a Spring application, the lat-</span></div>
<div style="position:absolute;left:102.18px;top:449.66px" class="cls_039"><span class="cls_039">est edition of Spring Data enables the creation of reactive, non-blocking data reposito-</span></div>
<div style="position:absolute;left:102.18px;top:462.68px" class="cls_039"><span class="cls_039">ries. And all of this is built on top of Project Reactor, a Java library for working with</span></div>
<div style="position:absolute;left:102.18px;top:475.67px" class="cls_039"><span class="cls_039">reactive types.</span></div>
<div style="position:absolute;left:117.80px;top:488.66px" class="cls_039"><span class="cls_039">In addition to the new reactive programming features of Spring 5, Spring Boot 2</span></div>
<div style="position:absolute;left:102.18px;top:501.68px" class="cls_039"><span class="cls_039">now provides even more autoconfiguration support than ever before as well as a com-</span></div>
<div style="position:absolute;left:102.18px;top:514.67px" class="cls_039"><span class="cls_039">pletely reimagined Actuator for peeking into and manipulating a running application.</span></div>
<div style="position:absolute;left:117.02px;top:527.66px" class="cls_039"><span class="cls_039">What’s more, as developers look to break down their monolithic applications into</span></div>
<div style="position:absolute;left:102.18px;top:540.68px" class="cls_039"><span class="cls_039">discrete microservices, Spring Cloud provides facilities that make it easy to configure</span></div>
<div style="position:absolute;left:102.18px;top:553.67px" class="cls_039"><span class="cls_039">and discover microservices, as well as fortify them so they’re more resilient to failure.</span></div>
<div style="position:absolute;left:263.97px;top:596.99px" class="cls_024"><span class="cls_024">xiii</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:9460px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background016.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_024"><span class="cls_024">xiv</span></div>
<div style="position:absolute;left:244.08px;top:24.68px" class="cls_030"><span class="cls_030">PREFACE</span></div>
<div style="position:absolute;left:108.75px;top:50.66px" class="cls_039"><span class="cls_039">I’m happy to say that this fifth edition of Spring in Action covers all of this and</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">more! If you’re a seasoned veteran with Spring, </span><span class="cls_036">Spring in Action, Fifth Edition</span><span class="cls_039"> will be</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">your guide to everything new that Spring has to offer. On the other hand, if you’re</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">new to Spring, then there’s no better time than now to get in on the action and the</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">first few chapters will get you up and running in no time!</span></div>
<div style="position:absolute;left:107.55px;top:115.67px" class="cls_039"><span class="cls_039">It’s been an exciting 15 years of working with Spring. And now that I’ve written this</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">fifth edition of Spring in Action, I’m eager to share that excitement with you!</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:10136px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background017.jpg" width="531" height="666"></div>
<div style="position:absolute;left:273.18px;top:229.97px" class="cls_014"><span class="cls_014">acknowledgments</span></div>
<div style="position:absolute;left:102.18px;top:280.67px" class="cls_039"><span class="cls_039">One of the most amazing things that Spring and Spring Boot do is to automatically</span></div>
<div style="position:absolute;left:102.18px;top:293.66px" class="cls_039"><span class="cls_039">provide all of the foundational plumbing for an application, leaving you as a devel-</span></div>
<div style="position:absolute;left:102.18px;top:306.68px" class="cls_039"><span class="cls_039">oper to focus primarily on the logic that’s unique to your application. Unfortunately,</span></div>
<div style="position:absolute;left:102.18px;top:319.67px" class="cls_039"><span class="cls_039">no such magic exists for writing a book. Or does it?</span></div>
<div style="position:absolute;left:116.99px;top:332.66px" class="cls_039"><span class="cls_039">At Manning, there were several people working their magic to make sure that this</span></div>
<div style="position:absolute;left:102.18px;top:345.68px" class="cls_039"><span class="cls_039">book is the best it can possibly be. Many thanks in particular to Jenny Stout, my devel-</span></div>
<div style="position:absolute;left:102.18px;top:358.67px" class="cls_039"><span class="cls_039">opment editor, and to the production team, including project manager Janet Vail,</span></div>
<div style="position:absolute;left:102.18px;top:371.66px" class="cls_039"><span class="cls_039">copyeditors Andy Carroll and Frances Buran, and proofreaders Katie Tennant and</span></div>
<div style="position:absolute;left:102.18px;top:384.68px" class="cls_039"><span class="cls_039">Melody Dolab. Thanks, too, to technical proofer Joshua White who was thorough</span></div>
<div style="position:absolute;left:102.18px;top:397.67px" class="cls_039"><span class="cls_039">and helpful.</span></div>
<div style="position:absolute;left:116.48px;top:410.66px" class="cls_039"><span class="cls_039">Along the way, we got feedback from several peer reviewers who made sure that the</span></div>
<div style="position:absolute;left:102.18px;top:423.68px" class="cls_039"><span class="cls_039">book stayed on target and covered the right stuff. For this, my thanks goes to Andrea</span></div>
<div style="position:absolute;left:102.18px;top:436.67px" class="cls_039"><span class="cls_039">Barisone, Arnaldo Ayala, Bill Fly, Colin Joyce, Daniel Vaughan, David Witherspoon,</span></div>
<div style="position:absolute;left:102.18px;top:449.66px" class="cls_039"><span class="cls_039">Eddu Melendez, Iain Campbell, Jettro Coenradie, John Gunvaldson, Markus Matzker,</span></div>
<div style="position:absolute;left:102.18px;top:462.68px" class="cls_039"><span class="cls_039">Nick Rakochy, Nusry Firdousi, Piotr Kafel, Raphael Villela, Riccardo Noviello, Sergio</span></div>
<div style="position:absolute;left:102.18px;top:475.67px" class="cls_039"><span class="cls_039">Fernandez Gonzalez, Sergiy Pylypets, Thiago Presa, Thorsten Weber, Waldemar</span></div>
<div style="position:absolute;left:102.18px;top:488.66px" class="cls_039"><span class="cls_039">Modzelewski, Yagiz Erkan, and Željko Trogrli</span></div>
<div style="position:absolute;left:300.06px;top:488.66px" class="cls_039"><span class="cls_039">´.</span></div>
<div style="position:absolute;left:117.39px;top:501.68px" class="cls_039"><span class="cls_039">As always, there’d be absolutely no point in writing this book if it weren’t for the</span></div>
<div style="position:absolute;left:102.18px;top:514.67px" class="cls_039"><span class="cls_039">amazing work done by the members of the Spring engineering team. I’m amazed at</span></div>
<div style="position:absolute;left:102.18px;top:527.66px" class="cls_039"><span class="cls_039">what you’ve created and how we continue to change how software is developed.</span></div>
<div style="position:absolute;left:117.43px;top:540.68px" class="cls_039"><span class="cls_039">Many thanks to my fellow speakers on the No Fluff/Just Stuff tour. I continue to</span></div>
<div style="position:absolute;left:102.18px;top:553.67px" class="cls_039"><span class="cls_039">learn so much from every one of you. I especially want to thank Brian Sletten, Nate</span></div>
<div style="position:absolute;left:265.68px;top:596.99px" class="cls_024"><span class="cls_024">xv</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:10812px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background018.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_024"><span class="cls_024">xvi</span></div>
<div style="position:absolute;left:221.91px;top:24.68px" class="cls_030"><span class="cls_030">ACKNOWLEDGMENTS</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">Schutta, and Ken Kousen for conversations and emails about Spring that have helped</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">shape this book.</span></div>
<div style="position:absolute;left:107.77px;top:76.67px" class="cls_039"><span class="cls_039">Once again, I’d like to thank the Phoenicians. You know what you did.</span></div>
<div style="position:absolute;left:107.58px;top:89.66px" class="cls_039"><span class="cls_039">Finally, to my beautiful wife Raymie, the love of my life, my sweetest dream, and my</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">inspiration: Thank you for your encouragement and for putting up with another book</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">project. And to my sweet and wonderful girls, Maisy and Madi: I am so proud of you</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">and of the amazing young ladies you are becoming. I love all of you more than you</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">can imagine or I can possible express.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:11488px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background019.jpg" width="531" height="666"></div>
<div style="position:absolute;left:300.18px;top:229.97px" class="cls_014"><span class="cls_014">about this book</span></div>
<div style="position:absolute;left:102.18px;top:278.66px" class="cls_036"><span class="cls_036">Spring in Action, Fifth Edition</span><span class="cls_039"> was written to equip you to build amazing applications</span></div>
<div style="position:absolute;left:102.18px;top:291.68px" class="cls_039"><span class="cls_039">using the Spring Framework, Spring Boot, and a variety of ancillary members of the</span></div>
<div style="position:absolute;left:102.18px;top:304.67px" class="cls_039"><span class="cls_039">Spring ecosystem. It begins by showing you how to develop web-based, database-</span></div>
<div style="position:absolute;left:102.18px;top:317.66px" class="cls_039"><span class="cls_039">backed Java applications with Spring and Spring Boot. It then expands on the essen-</span></div>
<div style="position:absolute;left:102.18px;top:330.68px" class="cls_039"><span class="cls_039">tials by showing how to integrate with other applications, program using reactive</span></div>
<div style="position:absolute;left:102.18px;top:343.67px" class="cls_039"><span class="cls_039">types, and then break an application into discrete microservices. Finally, it discusses</span></div>
<div style="position:absolute;left:102.18px;top:356.66px" class="cls_039"><span class="cls_039">how to ready an application for deployment.</span></div>
<div style="position:absolute;left:116.78px;top:369.68px" class="cls_039"><span class="cls_039">Although all of the projects in the Spring ecosystem provide excellent documenta-</span></div>
<div style="position:absolute;left:102.18px;top:382.67px" class="cls_039"><span class="cls_039">tion, this book does something that none of the reference documents do: provide a</span></div>
<div style="position:absolute;left:102.18px;top:395.66px" class="cls_039"><span class="cls_039">hands-on, project-driven guide to bringing the elements of Spring together to build a</span></div>
<div style="position:absolute;left:102.18px;top:408.68px" class="cls_039"><span class="cls_039">real application.</span></div>
<div style="position:absolute;left:102.18px;top:428.83px" class="cls_040"><span class="cls_040">Who should read this book</span></div>
<div style="position:absolute;left:102.18px;top:446.66px" class="cls_036"><span class="cls_036">Spring in Action</span><span class="cls_039">, 5th edition is for Java developers who want to get started with Spring</span></div>
<div style="position:absolute;left:102.18px;top:459.68px" class="cls_039"><span class="cls_039">Boot and the Spring Framework as well as for seasoned Spring developers who want to</span></div>
<div style="position:absolute;left:102.18px;top:472.67px" class="cls_039"><span class="cls_039">go beyond the basics and learn the newest features of Spring.</span></div>
<div style="position:absolute;left:102.18px;top:492.85px" class="cls_040"><span class="cls_040">How this book is organized: a roadmap</span></div>
<div style="position:absolute;left:102.18px;top:510.68px" class="cls_039"><span class="cls_039">The book has 5 parts spanning 19 chapters. Part 1 covers the foundational topics of</span></div>
<div style="position:absolute;left:102.18px;top:523.67px" class="cls_039"><span class="cls_039">building Spring applications:</span></div>
<div style="position:absolute;left:117.78px;top:539.69px" class="cls_041"><span class="cls_041">■</span><span class="cls_039">   Chapter 1 introduces Spring and Spring Boot and how to initialize a Spring</span></div>
<div style="position:absolute;left:129.78px;top:552.68px" class="cls_039"><span class="cls_039">project. In this chapter, you’ll take the first steps toward building a Spring appli-</span></div>
<div style="position:absolute;left:129.78px;top:565.67px" class="cls_039"><span class="cls_039">cation that you’ll expand upon throughout the course of the book.</span></div>
<div style="position:absolute;left:263.16px;top:596.99px" class="cls_024"><span class="cls_024">xvii</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:12164px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background020.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_024"><span class="cls_024">xviii</span></div>
<div style="position:absolute;left:227.28px;top:24.68px" class="cls_030"><span class="cls_030">ABOUT THIS BOOK</span></div>
<div style="position:absolute;left:108.78px;top:50.66px" class="cls_041"><span class="cls_041">■</span><span class="cls_039">   Chapter 2 discusses building the web layer of an application using Spring MVC.</span></div>
<div style="position:absolute;left:120.78px;top:63.65px" class="cls_039"><span class="cls_039">In this chapter, you’ll build controllers that handle web requests and views that</span></div>
<div style="position:absolute;left:120.78px;top:76.67px" class="cls_039"><span class="cls_039">render information in the web browser.</span></div>
<div style="position:absolute;left:108.78px;top:90.65px" class="cls_041"><span class="cls_041">■</span><span class="cls_039">   Chapter 3 delves into the backend of a Spring application where data is per-</span></div>
<div style="position:absolute;left:120.78px;top:103.67px" class="cls_039"><span class="cls_039">sisted to a relational database.</span></div>
<div style="position:absolute;left:108.78px;top:117.65px" class="cls_041"><span class="cls_041">■</span><span class="cls_039">   In chapter 4, you’ll use Spring Security to authenticate users and prevent unau-</span></div>
<div style="position:absolute;left:120.78px;top:130.67px" class="cls_039"><span class="cls_039">thorized access to an application.</span></div>
<div style="position:absolute;left:108.78px;top:144.65px" class="cls_041"><span class="cls_041">■</span><span class="cls_039">   Chapter 5 reveals how to configure a Spring application using Spring Boot con-</span></div>
<div style="position:absolute;left:120.78px;top:157.67px" class="cls_039"><span class="cls_039">figuration properties. You’ll also learn how to selectively apply configuration</span></div>
<div style="position:absolute;left:120.78px;top:170.66px" class="cls_039"><span class="cls_039">using profiles.</span></div>
<div style="position:absolute;left:93.18px;top:188.66px" class="cls_039"><span class="cls_039">Part 2 covers topics that help integrate your Spring application with other applications:</span></div>
<div style="position:absolute;left:108.78px;top:205.67px" class="cls_041"><span class="cls_041">■</span><span class="cls_039">   Chapter 6 expands on the discussion of Spring MVC started in chapter 2 by</span></div>
<div style="position:absolute;left:120.78px;top:218.66px" class="cls_039"><span class="cls_039">looking at how to write REST APIs in Spring.</span></div>
<div style="position:absolute;left:108.78px;top:232.67px" class="cls_041"><span class="cls_041">■</span><span class="cls_039">   Chapter 7 turns the tables on chapter 6 to show how a Spring application can</span></div>
<div style="position:absolute;left:120.78px;top:245.66px" class="cls_039"><span class="cls_039">consume a REST API.</span></div>
<div style="position:absolute;left:108.78px;top:259.67px" class="cls_041"><span class="cls_041">■</span><span class="cls_039">   Chapter 8 looks at using asynchronous communication to enable a Spring</span></div>
<div style="position:absolute;left:120.78px;top:272.66px" class="cls_039"><span class="cls_039">application to both send and receive messages using the Java Message Service,</span></div>
<div style="position:absolute;left:120.78px;top:285.65px" class="cls_039"><span class="cls_039">RabbitMQ, or Kafka.</span></div>
<div style="position:absolute;left:108.78px;top:299.66px" class="cls_041"><span class="cls_041">■</span><span class="cls_039">   Chapter 9 discusses declarative application integration using the Spring Inte-</span></div>
<div style="position:absolute;left:120.78px;top:312.68px" class="cls_039"><span class="cls_039">gration project.</span></div>
<div style="position:absolute;left:93.18px;top:330.68px" class="cls_039"><span class="cls_039">Part 3 explores the exciting new support for reactive programming in Spring:</span></div>
<div style="position:absolute;left:108.78px;top:347.66px" class="cls_041"><span class="cls_041">■</span><span class="cls_039">   Chapter 10 introduces Project Reactor, the reactive programming library that</span></div>
<div style="position:absolute;left:120.78px;top:360.68px" class="cls_039"><span class="cls_039">underpins Spring 5’s reactive features.</span></div>
<div style="position:absolute;left:108.78px;top:374.66px" class="cls_041"><span class="cls_041">■</span><span class="cls_039">   Chapter 11 revisits REST API development, introducing Spring WebFlex, a new</span></div>
<div style="position:absolute;left:120.78px;top:387.68px" class="cls_039"><span class="cls_039">web framework that borrows much from Spring MVC while offering a new reac-</span></div>
<div style="position:absolute;left:120.78px;top:400.67px" class="cls_039"><span class="cls_039">tive model for web development.</span></div>
<div style="position:absolute;left:108.78px;top:414.68px" class="cls_041"><span class="cls_041">■</span><span class="cls_039">   Chapter 12 takes a look at writing reactive data persistence with Spring Data to</span></div>
<div style="position:absolute;left:120.78px;top:427.67px" class="cls_039"><span class="cls_039">read and write data to Cassandra and Mongo databases.</span></div>
<div style="position:absolute;left:93.18px;top:445.67px" class="cls_039"><span class="cls_039">Part 4 breaks down the monolithic application model, introducing you to Spring</span></div>
<div style="position:absolute;left:93.18px;top:458.66px" class="cls_039"><span class="cls_039">Cloud and microservice development:</span></div>
<div style="position:absolute;left:108.78px;top:475.67px" class="cls_041"><span class="cls_041">■</span><span class="cls_039">   Chapter 13 dives into service discovery, using Spring with Netflix’s Eureka regis-</span></div>
<div style="position:absolute;left:120.78px;top:488.66px" class="cls_039"><span class="cls_039">try to both register and discover Spring-based microservices.</span></div>
<div style="position:absolute;left:108.78px;top:502.67px" class="cls_041"><span class="cls_041">■</span><span class="cls_039">   Chapter 14 shows how to centralize application configuration in a configura-</span></div>
<div style="position:absolute;left:120.78px;top:515.66px" class="cls_039"><span class="cls_039">tion server that shares configuration across multiple microservices.</span></div>
<div style="position:absolute;left:108.78px;top:529.67px" class="cls_041"><span class="cls_041">■</span><span class="cls_039">   Chapter 15 introduces the circuit breaker pattern with Hystrix, enabling micro-</span></div>
<div style="position:absolute;left:120.78px;top:542.69px" class="cls_039"><span class="cls_039">services that are resilient in the face of failure.</span></div>
<div style="position:absolute;left:93.18px;top:560.69px" class="cls_039"><span class="cls_039">In part 5, you’ll ready an application for production and see how to deploy it:</span></div>
<div style="position:absolute;left:108.78px;top:577.67px" class="cls_041"><span class="cls_041">■</span><span class="cls_039">   Chapter 16 introduces the Spring Boot Actuator, an extension to Spring Boot</span></div>
<div style="position:absolute;left:120.78px;top:590.69px" class="cls_039"><span class="cls_039">that exposes the internals of a running Spring application as REST endpoints.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:12840px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background021.jpg" width="531" height="666"></div>
<div style="position:absolute;left:236.28px;top:24.68px" class="cls_030"><span class="cls_030">ABOUT THIS BOOK</span></div>
<div style="position:absolute;left:461.85px;top:24.35px" class="cls_024"><span class="cls_024">xix</span></div>
<div style="position:absolute;left:117.78px;top:50.66px" class="cls_041"><span class="cls_041">■</span><span class="cls_039">   In chapter 17 you’ll see how to use the Spring Boot Admin to put a user-friendly</span></div>
<div style="position:absolute;left:129.78px;top:63.65px" class="cls_039"><span class="cls_039">browser-based administrative application on top of the Actuator.</span></div>
<div style="position:absolute;left:117.78px;top:77.66px" class="cls_041"><span class="cls_041">■</span><span class="cls_039">   Chapter 18 discusses how to expose and consume Spring beans as JMX MBeans.</span></div>
<div style="position:absolute;left:117.78px;top:91.67px" class="cls_041"><span class="cls_041">■</span><span class="cls_039">   Finally, in chapter 19 you’ll see how to deploy your Spring application in a vari-</span></div>
<div style="position:absolute;left:129.78px;top:104.66px" class="cls_039"><span class="cls_039">ety of production environments.</span></div>
<div style="position:absolute;left:102.18px;top:122.66px" class="cls_039"><span class="cls_039">In general, developers new to Spring should start with chapter 1 and work through</span></div>
<div style="position:absolute;left:102.18px;top:135.65px" class="cls_039"><span class="cls_039">each chapter sequentially. Experienced Spring developers may prefer to jump in at</span></div>
<div style="position:absolute;left:102.18px;top:148.67px" class="cls_039"><span class="cls_039">any point that interests them. Even so, each chapter builds upon the previous chapter,</span></div>
<div style="position:absolute;left:102.18px;top:161.66px" class="cls_039"><span class="cls_039">so there may be some context missing if you dive into the middle of the book.</span></div>
<div style="position:absolute;left:102.18px;top:182.83px" class="cls_040"><span class="cls_040">About the code</span></div>
<div style="position:absolute;left:102.18px;top:200.66px" class="cls_039"><span class="cls_039">This book contains many examples of source code both in numbered listings and</span></div>
<div style="position:absolute;left:102.18px;top:213.65px" class="cls_039"><span class="cls_039">inline with normal text. In both cases, source code is formatted in a </span><span class="cls_042">fixed-width</span><span class="cls_039"> </span><span class="cls_042">font</span></div>
<div style="position:absolute;left:102.18px;top:226.67px" class="cls_042"><span class="cls_042">like</span><span class="cls_039"> </span><span class="cls_042">this</span><span class="cls_039"> to separate it from ordinary text. Sometimes code is also in </span><span class="cls_043">bold</span><span class="cls_039"> to high-</span></div>
<div style="position:absolute;left:102.18px;top:239.66px" class="cls_039"><span class="cls_039">light code that has changed from previous steps in the chapter, such as when a new</span></div>
<div style="position:absolute;left:102.18px;top:252.65px" class="cls_039"><span class="cls_039">feature adds to an existing line of code.</span></div>
<div style="position:absolute;left:117.96px;top:265.67px" class="cls_039"><span class="cls_039">In many cases the original source code has been reformatted; we’ve added line</span></div>
<div style="position:absolute;left:102.18px;top:278.66px" class="cls_039"><span class="cls_039">breaks and reworked indentation to accommodate the available page space in the</span></div>
<div style="position:absolute;left:102.18px;top:291.68px" class="cls_039"><span class="cls_039">book. In rare cases, even this was not enough, and listings include line-continuation</span></div>
<div style="position:absolute;left:102.18px;top:303.37px" class="cls_039"><span class="cls_039">markers (</span><span class="cls_044">➥</span><span class="cls_039">). Additionally, comments in the source code have often been removed</span></div>
<div style="position:absolute;left:102.18px;top:317.66px" class="cls_039"><span class="cls_039">from the listings when the code is described in the text. Code annotations accompany</span></div>
<div style="position:absolute;left:102.18px;top:330.68px" class="cls_039"><span class="cls_039">many of the listings, highlighting important concepts.</span></div>
<div style="position:absolute;left:116.85px;top:343.67px" class="cls_039"><span class="cls_039">Source code for the examples in this book is available for download from the pub-</span></div>
<div style="position:absolute;left:102.18px;top:356.66px" class="cls_039"><span class="cls_039">lisher’s website at </span><a href="http://www.manning.com/books/spring-in-action-fifth-edition">www.manning.com/books/spring-in-action-fifth-edition</a> <span class="cls_039"> as well as</span></div>
<div style="position:absolute;left:102.18px;top:369.68px" class="cls_039"><span class="cls_039">from the author’s GitHub account at </span><a href="http://github.com/habuma/spring-in-action-5-samples">github.com/habuma/spring-in-action-5-samples</a> <span class="cls_039">.</span></div>
<div style="position:absolute;left:102.18px;top:390.85px" class="cls_040"><span class="cls_040">Book forum</span></div>
<div style="position:absolute;left:102.18px;top:408.68px" class="cls_039"><span class="cls_039">Purchase of </span><span class="cls_036">Spring in Action</span><span class="cls_039">, 5th edition, includes free access to a private web forum</span></div>
<div style="position:absolute;left:102.18px;top:421.67px" class="cls_039"><span class="cls_039">run by Manning Publications where you can make comments about the book, ask</span></div>
<div style="position:absolute;left:102.18px;top:434.66px" class="cls_039"><span class="cls_039">technical questions, and receive help from the author and from other users. To access</span></div>
<div style="position:absolute;left:102.18px;top:447.68px" class="cls_039"><span class="cls_039">the forum, go to </span><a href="https://forums.manning.com/forums/spring-in-action-fifth-edition">https://forums.manning.com/forums/spring-in-action-fifth-edition</a> <span class="cls_039">.</span></div>
<div style="position:absolute;left:102.18px;top:460.67px" class="cls_039"><span class="cls_039">You can also learn more about Manning’s forums and the rules of conduct at </span><a href="https://forums.manning.com/forums/about">https://</a> </div>
<div style="position:absolute;left:102.18px;top:473.66px" class="cls_045"><span class="cls_045"> </span><a href="https://forums.manning.com/forums/about">forums.manning.com/forums/about</a> <span class="cls_039">.</span></div>
<div style="position:absolute;left:117.32px;top:486.68px" class="cls_039"><span class="cls_039">Manning’s commitment to our readers is to provide a venue where a meaningful</span></div>
<div style="position:absolute;left:102.18px;top:499.67px" class="cls_039"><span class="cls_039">dialogue between individual readers and between readers and the author can take</span></div>
<div style="position:absolute;left:102.18px;top:512.66px" class="cls_039"><span class="cls_039">place. It is not a commitment to any specific amount of participation on the part of</span></div>
<div style="position:absolute;left:102.18px;top:525.68px" class="cls_039"><span class="cls_039">the author, whose contribution to the forum remains voluntary (and unpaid). We sug-</span></div>
<div style="position:absolute;left:102.18px;top:538.67px" class="cls_039"><span class="cls_039">gest you try asking the author some challenging questions lest his interest stray! The</span></div>
<div style="position:absolute;left:102.18px;top:551.69px" class="cls_039"><span class="cls_039">forum and the archives of previous discussions will be accessible from the publisher’s</span></div>
<div style="position:absolute;left:102.18px;top:564.68px" class="cls_039"><span class="cls_039">website as long as the book is in print.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:13516px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background022.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_024"><span class="cls_024">xx</span></div>
<div style="position:absolute;left:227.28px;top:24.68px" class="cls_030"><span class="cls_030">ABOUT THIS BOOK</span></div>
<div style="position:absolute;left:93.18px;top:49.81px" class="cls_040"><span class="cls_040">Other online resources</span></div>
<div style="position:absolute;left:93.18px;top:67.67px" class="cls_039"><span class="cls_039">Need additional help?</span></div>
<div style="position:absolute;left:108.78px;top:84.65px" class="cls_041"><span class="cls_041">■</span><span class="cls_039">   The Spring website has several useful getting-started guides (some of which</span></div>
<div style="position:absolute;left:120.78px;top:97.67px" class="cls_039"><span class="cls_039">were written by the author of this book) at </span><a href="https://spring.io/guides">https://spring.io/guides</a> <span class="cls_039">.</span></div>
<div style="position:absolute;left:108.78px;top:111.65px" class="cls_041"><span class="cls_041">■</span><span class="cls_039">   The Spring tag at StackOverflow (</span><a href="https://stackoverflow.com/questions/tagged/spring">https://stackoverflow.com/questions/tagged/</a> </div>
<div style="position:absolute;left:120.78px;top:124.67px" class="cls_045"><span class="cls_045"> </span><a href="https://stackoverflow.com/questions/tagged/spring">spring</a> <span class="cls_039">) as well as the Spring Boot tag at StackOverflow are great places to ask</span></div>
<div style="position:absolute;left:120.78px;top:137.66px" class="cls_039"><span class="cls_039">questions and help others with Spring. Helping someone else with their Spring</span></div>
<div style="position:absolute;left:120.78px;top:150.65px" class="cls_039"><span class="cls_039">questions is a great way to learn Spring!</span></div>
<div style="position:absolute;left:93.18px;top:171.82px" class="cls_040"><span class="cls_040">About the author</span></div>
<div style="position:absolute;left:93.18px;top:189.65px" class="cls_039"><span class="cls_039">C</span><span class="cls_046">RAIG</span><span class="cls_039"> W</span><span class="cls_046">ALLS</span><span class="cls_039"> is a principal engineer with Pivotal. He’s a zealous promoter of the</span></div>
<div style="position:absolute;left:93.18px;top:202.67px" class="cls_039"><span class="cls_039">Spring Framework, speaking frequently at local user groups and conferences and writ-</span></div>
<div style="position:absolute;left:93.18px;top:215.66px" class="cls_039"><span class="cls_039">ing about Spring. When he’s not slinging code, Craig is planning his next trip to Dis-</span></div>
<div style="position:absolute;left:93.18px;top:228.65px" class="cls_039"><span class="cls_039">ney World or Disneyland and spending as much time as he can with his wife, two</span></div>
<div style="position:absolute;left:93.18px;top:241.67px" class="cls_039"><span class="cls_039">daughters, two birds, and three dogs.</span></div>
<div style="position:absolute;left:93.18px;top:262.84px" class="cls_040"><span class="cls_040">About the cover illustration</span></div>
<div style="position:absolute;left:93.18px;top:280.67px" class="cls_039"><span class="cls_039">The figure on the cover of </span><span class="cls_036">Spring in Action</span><span class="cls_039">, 5th edition, is “Le Caraco,” or an inhabi-</span></div>
<div style="position:absolute;left:93.18px;top:293.66px" class="cls_039"><span class="cls_039">tant of the province of Karak in southwest Jordan. Its capital is the city of Al-Karak, which</span></div>
<div style="position:absolute;left:93.18px;top:306.68px" class="cls_039"><span class="cls_039">boasts an ancient hilltop castle with magnificent views of the Dead Sea and surround-</span></div>
<div style="position:absolute;left:93.18px;top:319.67px" class="cls_039"><span class="cls_039">ing plains. The illustration is taken from a French travel book, </span><span class="cls_036">Encyclopédie des Voyages</span></div>
<div style="position:absolute;left:93.18px;top:332.66px" class="cls_039"><span class="cls_039">by J. G. St. Sauveur, published in 1796. Travel for pleasure was a relatively new phe-</span></div>
<div style="position:absolute;left:93.18px;top:345.68px" class="cls_039"><span class="cls_039">nomenon at the time and travel guides such as this one were popular, introducing</span></div>
<div style="position:absolute;left:93.18px;top:358.67px" class="cls_039"><span class="cls_039">both the tourist as well as the armchair traveler to the inhabitants of other regions of</span></div>
<div style="position:absolute;left:93.18px;top:371.66px" class="cls_039"><span class="cls_039">France and abroad.</span></div>
<div style="position:absolute;left:107.83px;top:384.68px" class="cls_039"><span class="cls_039">The diversity of the drawings in the </span><span class="cls_036">Encyclopédie des Voyages</span><span class="cls_039"> speaks vividly of the dis-</span></div>
<div style="position:absolute;left:93.18px;top:397.67px" class="cls_039"><span class="cls_039">tinctiveness and individuality of the world’s towns and provinces just two hundred</span></div>
<div style="position:absolute;left:93.18px;top:410.66px" class="cls_039"><span class="cls_039">years ago. This was a time when the dress codes of two regions separated by a few</span></div>
<div style="position:absolute;left:93.18px;top:423.68px" class="cls_039"><span class="cls_039">dozen miles identified people uniquely as belonging to one or the other. The travel</span></div>
<div style="position:absolute;left:93.18px;top:436.67px" class="cls_039"><span class="cls_039">guide brings to life a sense of isolation and distance of that period, and of every other</span></div>
<div style="position:absolute;left:93.18px;top:449.66px" class="cls_039"><span class="cls_039">historic period except our own hyperkinetic present.</span></div>
<div style="position:absolute;left:108.92px;top:462.68px" class="cls_039"><span class="cls_039">Dress codes have changed since then and the diversity by region, so rich at the</span></div>
<div style="position:absolute;left:93.18px;top:475.67px" class="cls_039"><span class="cls_039">time, has faded away. It is now often hard to tell the inhabitants of one continent from</span></div>
<div style="position:absolute;left:93.18px;top:488.66px" class="cls_039"><span class="cls_039">another. Perhaps, trying to view it optimistically, we have traded a cultural and visual</span></div>
<div style="position:absolute;left:93.18px;top:501.68px" class="cls_039"><span class="cls_039">diversity for a more varied personal life—or a more varied and interesting intellectual</span></div>
<div style="position:absolute;left:93.18px;top:514.67px" class="cls_039"><span class="cls_039">and technical life. We at Manning celebrate the inventiveness, the initiative, and the</span></div>
<div style="position:absolute;left:93.18px;top:527.66px" class="cls_039"><span class="cls_039">fun of the computer business with book covers based on the rich diversity of regional</span></div>
<div style="position:absolute;left:93.18px;top:540.68px" class="cls_039"><span class="cls_039">life two centuries ago brought back to life by the pictures from this travel guide.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:14192px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background023.jpg" width="531" height="666"></div>
<div style="position:absolute;left:388.38px;top:82.94px" class="cls_014"><span class="cls_014">Part 1</span></div>
<div style="position:absolute;left:229.38px;top:142.94px" class="cls_014"><span class="cls_014">Foundational Spring</span></div>
<div style="position:absolute;left:126.18px;top:215.61px" class="cls_047"><span class="cls_047">P</span></div>
<div style="position:absolute;left:145.38px;top:253.67px" class="cls_039"><span class="cls_039">art 1 of this book will get you started writing a Spring application, learning</span></div>
<div style="position:absolute;left:126.18px;top:266.66px" class="cls_039"><span class="cls_039">the foundations of Spring along the way.</span></div>
<div style="position:absolute;left:141.15px;top:279.65px" class="cls_039"><span class="cls_039">In chapter 1, I’ll give you a quick overview of Spring and Spring Boot essen-</span></div>
<div style="position:absolute;left:126.18px;top:292.67px" class="cls_039"><span class="cls_039">tials and show you how to initialize a Spring project as you work on building</span></div>
<div style="position:absolute;left:126.18px;top:305.66px" class="cls_039"><span class="cls_039">Taco Cloud, your first Spring application. In chapter 2, you’ll dig deeper into</span></div>
<div style="position:absolute;left:126.18px;top:318.68px" class="cls_039"><span class="cls_039">the Spring MCV and learn how to present model data in the browser and how to</span></div>
<div style="position:absolute;left:126.18px;top:331.67px" class="cls_039"><span class="cls_039">process and validate form input. You’ll also get some tips on choosing a view tem-</span></div>
<div style="position:absolute;left:126.18px;top:344.66px" class="cls_039"><span class="cls_039">plate library. You’ll add data persistence to the Taco Cloud application in chapter</span></div>
<div style="position:absolute;left:126.18px;top:357.68px" class="cls_039"><span class="cls_039">3. There, we’ll cover using Spring’s JDBC template, how to insert data, and how to</span></div>
<div style="position:absolute;left:126.18px;top:370.67px" class="cls_039"><span class="cls_039">declare JPA repositories with Spring Data. Chapter 4 covers security for your</span></div>
<div style="position:absolute;left:126.18px;top:383.66px" class="cls_039"><span class="cls_039">Spring application, including autoconfiguring Spring Security, defining custom</span></div>
<div style="position:absolute;left:126.18px;top:396.68px" class="cls_039"><span class="cls_039">user storage, customizing the login page, and securing against cross-site request</span></div>
<div style="position:absolute;left:126.18px;top:409.67px" class="cls_039"><span class="cls_039">forgery (CSRF) attacks. To close out part 1, we'll look at configuration properties</span></div>
<div style="position:absolute;left:126.18px;top:422.66px" class="cls_039"><span class="cls_039">in chapter 5. You’ll learn how to fine-tune autoconfigured beans, apply configura-</span></div>
<div style="position:absolute;left:126.18px;top:435.68px" class="cls_039"><span class="cls_039">tion properties to application components, and work with Spring profiles.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:14868px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background024.jpg" width="531" height="666"></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:14868px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background025.jpg" width="531" height="666"></div>
<div style="position:absolute;left:303.18px;top:111.83px" class="cls_014"><span class="cls_014">Getting started</span></div>
<div style="position:absolute;left:337.98px;top:143.84px" class="cls_014"><span class="cls_014">with Spring</span></div>
<div style="position:absolute;left:96.18px;top:262.84px" class="cls_049"><span class="cls_049">This chapter covers</span></div>
<div style="position:absolute;left:96.18px;top:281.54px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Spring and Spring Boot essentials</span></div>
<div style="position:absolute;left:96.18px;top:296.54px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Initializing a Spring project</span></div>
<div style="position:absolute;left:96.18px;top:311.54px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  An overview of the Spring landscape</span></div>
<div style="position:absolute;left:114.18px;top:379.55px" class="cls_039"><span class="cls_039">Although the Greek philosopher Heraclitus wasn’t well known as a software devel-</span></div>
<div style="position:absolute;left:114.18px;top:392.54px" class="cls_039"><span class="cls_039">oper, he seemed to have a good handle on the subject. He has been quoted as say-</span></div>
<div style="position:absolute;left:114.18px;top:405.53px" class="cls_039"><span class="cls_039">ing, “The only constant is change.” That statement captures a foundational truth of</span></div>
<div style="position:absolute;left:114.18px;top:418.55px" class="cls_039"><span class="cls_039">software development.</span></div>
<div style="position:absolute;left:128.69px;top:431.54px" class="cls_039"><span class="cls_039">The way we develop applications today is different than it was a year ago, 5 years</span></div>
<div style="position:absolute;left:114.18px;top:444.53px" class="cls_039"><span class="cls_039">ago, 10 years ago, and certainly 15 years ago, when an initial form of the Spring</span></div>
<div style="position:absolute;left:114.18px;top:457.55px" class="cls_039"><span class="cls_039">Framework was introduced in Rod Johnson’s book, </span><span class="cls_036">Expert One-on-One J2EE Design</span></div>
<div style="position:absolute;left:114.18px;top:470.54px" class="cls_036"><span class="cls_036">and Development</span><span class="cls_039"> (Wrox, 2002, </span><a href="https://shortener.manning.com/oVjy">http://mng.bz/oVjy</a> <span class="cls_039">).</span></div>
<div style="position:absolute;left:130.26px;top:483.56px" class="cls_039"><span class="cls_039">Back then, the most common types of applications developed were browser-</span></div>
<div style="position:absolute;left:114.18px;top:496.55px" class="cls_039"><span class="cls_039">based web applications, backed by relational databases. While that type of develop-</span></div>
<div style="position:absolute;left:114.18px;top:509.54px" class="cls_039"><span class="cls_039">ment is still relevant, and Spring is well equipped for those kinds of applications,</span></div>
<div style="position:absolute;left:114.18px;top:522.56px" class="cls_039"><span class="cls_039">we’re now also interested in developing applications composed of microservices</span></div>
<div style="position:absolute;left:114.18px;top:535.55px" class="cls_039"><span class="cls_039">destined for the cloud that persist data in a variety of databases. And a new interest</span></div>
<div style="position:absolute;left:114.18px;top:548.54px" class="cls_039"><span class="cls_039">in reactive programming aims to provide greater scalability and improved perfor-</span></div>
<div style="position:absolute;left:114.18px;top:561.56px" class="cls_039"><span class="cls_039">mance with non-blocking operations.</span></div>
<div style="position:absolute;left:273.84px;top:596.99px" class="cls_048"><span class="cls_048">3</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:15544px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background026.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">4</span></div>
<div style="position:absolute;left:190.50px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 1</span></div>
<div style="position:absolute;left:234.63px;top:24.35px" class="cls_055"><span class="cls_055">Getting started with Spring</span></div>
<div style="position:absolute;left:108.29px;top:50.66px" class="cls_039"><span class="cls_039">As software development evolved, the Spring Framework also changed to address</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">modern development concerns, including microservices and reactive programming.</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">Spring also set out to simplify its own development model by introducing Spring Boot.</span></div>
<div style="position:absolute;left:109.94px;top:89.66px" class="cls_039"><span class="cls_039">Whether you’re developing a simple database-backed web application or con-</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">structing a modern application built around microservices, Spring is the framework</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">that will help you achieve your goals. This chapter is your first step in a journey</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">through modern application development with Spring.</span></div>
<div style="position:absolute;left:57.18px;top:151.84px" class="cls_040"><span class="cls_040">1.1</span></div>
<div style="position:absolute;left:93.18px;top:151.84px" class="cls_040"><span class="cls_040">What is Spring?</span></div>
<div style="position:absolute;left:93.18px;top:171.17px" class="cls_039"><span class="cls_039">I know you’re probably itching to start writing a Spring application, and I assure you</span></div>
<div style="position:absolute;left:93.18px;top:184.16px" class="cls_039"><span class="cls_039">that before this chapter ends, you’ll have developed a simple one. But first, let me set</span></div>
<div style="position:absolute;left:93.18px;top:197.15px" class="cls_039"><span class="cls_039">the stage with a few basic Spring concepts that will help you understand what makes</span></div>
<div style="position:absolute;left:93.18px;top:210.17px" class="cls_039"><span class="cls_039">Spring tick.</span></div>
<div style="position:absolute;left:107.61px;top:223.16px" class="cls_039"><span class="cls_039">Any non-trivial application is composed of many components, each responsible for</span></div>
<div style="position:absolute;left:93.18px;top:236.15px" class="cls_039"><span class="cls_039">its own piece of the overall application functionality, coordinating with the other</span></div>
<div style="position:absolute;left:93.18px;top:249.17px" class="cls_039"><span class="cls_039">application elements to get the job done. When the application is run, those compo-</span></div>
<div style="position:absolute;left:93.18px;top:262.16px" class="cls_039"><span class="cls_039">nents somehow need to be created and introduced to each other.</span></div>
<div style="position:absolute;left:108.22px;top:275.15px" class="cls_039"><span class="cls_039">At its core, Spring offers a </span><span class="cls_036">container</span><span class="cls_039">, often referred to as the </span><span class="cls_036">Spring application con-</span></div>
<div style="position:absolute;left:93.18px;top:288.17px" class="cls_036"><span class="cls_036">text</span><span class="cls_039">, that creates and manages application components. These components, or </span><span class="cls_036">beans</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:93.18px;top:301.16px" class="cls_039"><span class="cls_039">are wired together inside the Spring application context to make a complete applica-</span></div>
<div style="position:absolute;left:93.18px;top:314.18px" class="cls_039"><span class="cls_039">tion, much like bricks, mortar, timber, nails, plumbing, and wiring are bound together</span></div>
<div style="position:absolute;left:93.18px;top:327.17px" class="cls_039"><span class="cls_039">to make a house.</span></div>
<div style="position:absolute;left:107.68px;top:340.16px" class="cls_039"><span class="cls_039">The act of wiring beans together is based on a pattern known as </span><span class="cls_036">dependency injection</span></div>
<div style="position:absolute;left:93.18px;top:353.18px" class="cls_039"><span class="cls_039">(DI). Rather than have components create and maintain the lifecycle of other beans</span></div>
<div style="position:absolute;left:93.18px;top:366.17px" class="cls_039"><span class="cls_039">that they depend on, a dependency-injected application relies on a separate entity</span></div>
<div style="position:absolute;left:93.18px;top:379.16px" class="cls_039"><span class="cls_039">(the container) to create and maintain all components and inject those into the beans</span></div>
<div style="position:absolute;left:93.18px;top:392.18px" class="cls_039"><span class="cls_039">that need them. This is done typically through constructor arguments or property</span></div>
<div style="position:absolute;left:93.18px;top:405.17px" class="cls_039"><span class="cls_039">accessor methods.</span></div>
<div style="position:absolute;left:108.74px;top:418.16px" class="cls_039"><span class="cls_039">For example, suppose that among an application’s many components, there are</span></div>
<div style="position:absolute;left:93.18px;top:431.18px" class="cls_039"><span class="cls_039">two that you’ll address: an inventory service (for fetching inventory levels) and a prod-</span></div>
<div style="position:absolute;left:93.18px;top:444.17px" class="cls_039"><span class="cls_039">uct service (for providing basic product information). The product service depends</span></div>
<div style="position:absolute;left:93.18px;top:457.16px" class="cls_039"><span class="cls_039">on the inventory service to be able to provide a complete set of information about</span></div>
<div style="position:absolute;left:93.18px;top:470.18px" class="cls_039"><span class="cls_039">products. Figure 1.1 illustrates the relationships between these beans and the Spring</span></div>
<div style="position:absolute;left:93.18px;top:483.17px" class="cls_039"><span class="cls_039">application context.</span></div>
<div style="position:absolute;left:107.98px;top:496.16px" class="cls_039"><span class="cls_039">On top of its core container, Spring and a full portfolio of related libraries offer a</span></div>
<div style="position:absolute;left:93.18px;top:509.18px" class="cls_039"><span class="cls_039">web framework, a variety of data persistence options, a security framework, integra-</span></div>
<div style="position:absolute;left:93.18px;top:522.17px" class="cls_039"><span class="cls_039">tion with other systems, runtime monitoring, microservice support, a reactive pro-</span></div>
<div style="position:absolute;left:93.18px;top:535.16px" class="cls_039"><span class="cls_039">gramming  model,  and  many  other  features  necessary  for  modern  application</span></div>
<div style="position:absolute;left:93.18px;top:548.18px" class="cls_039"><span class="cls_039">development.</span></div>
<div style="position:absolute;left:108.73px;top:561.17px" class="cls_039"><span class="cls_039">Historically, the way you would guide Spring’s application context to wire beans</span></div>
<div style="position:absolute;left:93.18px;top:574.19px" class="cls_039"><span class="cls_039">together was with one or more XML files that described the components and their</span></div>
<div style="position:absolute;left:93.18px;top:587.18px" class="cls_039"><span class="cls_039">relationship to other components. For example, the following XML declares two</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:16220px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background027.jpg" width="531" height="666"></div>
<div style="position:absolute;left:241.50px;top:24.35px" class="cls_055"><span class="cls_055">What is Spring?</span></div>
<div style="position:absolute;left:469.38px;top:24.35px" class="cls_052"><span class="cls_052">5</span></div>
<div style="position:absolute;left:179.87px;top:61.85px" class="cls_056"><span class="cls_056">Spring application context</span></div>
<div style="position:absolute;left:146.26px;top:94.29px" class="cls_057"><span class="cls_057">Inventory</span></div>
<div style="position:absolute;left:210.81px;top:92.58px" class="cls_057"><span class="cls_057">Injected into</span></div>
<div style="position:absolute;left:290.14px;top:94.29px" class="cls_057"><span class="cls_057">Product</span></div>
<div style="position:absolute;left:149.37px;top:102.69px" class="cls_057"><span class="cls_057">service</span></div>
<div style="position:absolute;left:290.97px;top:102.69px" class="cls_057"><span class="cls_057">service</span></div>
<div style="position:absolute;left:147.41px;top:187.27px" class="cls_058"><span class="cls_058">Other application components also managed by Spring</span></div>
<div style="position:absolute;left:102.18px;top:215.90px" class="cls_053"><span class="cls_053">Figure 1.1</span></div>
<div style="position:absolute;left:146.24px;top:215.90px" class="cls_053"><span class="cls_053">Application components are managed and injected into each</span></div>
<div style="position:absolute;left:102.18px;top:225.92px" class="cls_053"><span class="cls_053">other by the Spring application context.</span></div>
<div style="position:absolute;left:102.18px;top:257.33px" class="cls_039"><span class="cls_039">beans, an </span><span class="cls_059">InventoryService</span><span class="cls_039"> bean and a </span><span class="cls_059">ProductService</span><span class="cls_039"> bean, and wires the </span><span class="cls_059">Inven-</span></div>
<div style="position:absolute;left:102.18px;top:270.35px" class="cls_059"><span class="cls_059">toryService</span><span class="cls_039"> bean into </span><span class="cls_059">ProductService</span><span class="cls_039"> via a constructor argument:</span></div>
<div style="position:absolute;left:102.18px;top:290.03px" class="cls_060"><span class="cls_060">&lt;bean id="inventoryService"</span></div>
<div style="position:absolute;left:130.95px;top:300.02px" class="cls_060"><span class="cls_060">class="com.example.InventoryService" /&gt;</span></div>
<div style="position:absolute;left:102.18px;top:320.03px" class="cls_060"><span class="cls_060">&lt;bean id="productService"</span></div>
<div style="position:absolute;left:130.95px;top:330.02px" class="cls_060"><span class="cls_060">class="com.example.ProductService" /&gt;</span></div>
<div style="position:absolute;left:111.77px;top:340.01px" class="cls_060"><span class="cls_060">&lt;constructor-arg ref="inventoryService" /&gt;</span></div>
<div style="position:absolute;left:102.18px;top:350.03px" class="cls_061"><span class="cls_061">&lt;/bean&gt;</span></div>
<div style="position:absolute;left:102.18px;top:371.36px" class="cls_039"><span class="cls_039">In recent versions of Spring, however, a Java-based configuration is more common.</span></div>
<div style="position:absolute;left:102.18px;top:384.35px" class="cls_039"><span class="cls_039">The following Java-based configuration class is equivalent to the XML configuration:</span></div>
<div style="position:absolute;left:102.18px;top:404.03px" class="cls_060"><span class="cls_060">@Configuration</span></div>
<div style="position:absolute;left:102.18px;top:414.02px" class="cls_060"><span class="cls_060">public class ServiceConfiguration {</span></div>
<div style="position:absolute;left:111.78px;top:424.04px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:111.78px;top:434.03px" class="cls_060"><span class="cls_060">public InventoryService inventoryService() {</span></div>
<div style="position:absolute;left:121.38px;top:444.02px" class="cls_060"><span class="cls_060">return new InventoryService();</span></div>
<div style="position:absolute;left:111.78px;top:454.04px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:474.02px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:111.78px;top:484.04px" class="cls_060"><span class="cls_060">public ProductService productService() {</span></div>
<div style="position:absolute;left:121.38px;top:494.03px" class="cls_060"><span class="cls_060">return new ProductService(inventoryService());</span></div>
<div style="position:absolute;left:111.78px;top:504.02px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:514.04px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:535.34px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">@Configuration</span><span class="cls_039"> annotation indicates to Spring that this is a configuration class</span></div>
<div style="position:absolute;left:102.18px;top:548.36px" class="cls_039"><span class="cls_039">that will provide beans to the Spring application context. The configuration’s class meth-</span></div>
<div style="position:absolute;left:102.18px;top:561.35px" class="cls_039"><span class="cls_039">ods are annotated with </span><span class="cls_059">@Bean,</span><span class="cls_039"> indicating that the objects they return should be added</span></div>
<div style="position:absolute;left:102.18px;top:574.37px" class="cls_039"><span class="cls_039">as beans in the application context (where, by default, their respective bean IDs will</span></div>
<div style="position:absolute;left:102.18px;top:587.36px" class="cls_039"><span class="cls_039">be the same as the names of the methods that define them).</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:16896px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background028.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">6</span></div>
<div style="position:absolute;left:190.50px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 1</span></div>
<div style="position:absolute;left:234.63px;top:24.35px" class="cls_055"><span class="cls_055">Getting started with Spring</span></div>
<div style="position:absolute;left:109.83px;top:50.66px" class="cls_039"><span class="cls_039">Java-based configuration offers several benefits over XML-based configuration,</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">including greater type safety and improved refactorability. Even so, explicit configura-</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">tion with either Java or XML is only necessary if Spring is unable to automatically con-</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">figure the components.</span></div>
<div style="position:absolute;left:107.61px;top:102.65px" class="cls_039"><span class="cls_039">Automatic configuration has its roots in the Spring techniques known as </span><span class="cls_036">autowiring</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">and </span><span class="cls_036">component scanning</span><span class="cls_039">. With component scanning, Spring can automatically discover</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">components from an application’s classpath and create them as beans in the Spring</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">application context. With autowiring, Spring automatically injects the components</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_039"><span class="cls_039">with the other beans that they depend on.</span></div>
<div style="position:absolute;left:108.16px;top:167.66px" class="cls_039"><span class="cls_039">More recently, with the introduction of Spring Boot, automatic configuration has</span></div>
<div style="position:absolute;left:93.18px;top:180.65px" class="cls_039"><span class="cls_039">gone well beyond component scanning and autowiring. Spring Boot is an extension</span></div>
<div style="position:absolute;left:93.18px;top:193.67px" class="cls_039"><span class="cls_039">of the Spring Framework that offers several productivity enhancements. The most</span></div>
<div style="position:absolute;left:93.18px;top:206.66px" class="cls_039"><span class="cls_039">well-known of these enhancements is </span><span class="cls_036">autoconfiguration</span><span class="cls_039">, where Spring Boot can make</span></div>
<div style="position:absolute;left:93.18px;top:219.65px" class="cls_039"><span class="cls_039">reasonable guesses of what components need to be configured and wired together,</span></div>
<div style="position:absolute;left:93.18px;top:232.67px" class="cls_039"><span class="cls_039">based on entries in the classpath, environment variables, and other factors.</span></div>
<div style="position:absolute;left:107.88px;top:245.66px" class="cls_039"><span class="cls_039">I’d like to show you some example code that demonstrates autoconfiguration. But</span></div>
<div style="position:absolute;left:93.18px;top:258.65px" class="cls_039"><span class="cls_039">I can’t. You see, autoconfiguration is much like the wind. You can see the effects of it,</span></div>
<div style="position:absolute;left:93.18px;top:271.67px" class="cls_039"><span class="cls_039">but there’s no code that I can show you and say “Look! Here’s an example of autocon-</span></div>
<div style="position:absolute;left:93.18px;top:284.66px" class="cls_039"><span class="cls_039">figuration!” Stuff happens, components are enabled, and functionality is provided</span></div>
<div style="position:absolute;left:93.18px;top:297.68px" class="cls_039"><span class="cls_039">without writing code. It’s this lack of code that’s essential to autoconfiguration and</span></div>
<div style="position:absolute;left:93.18px;top:310.67px" class="cls_039"><span class="cls_039">what makes it so wonderful.</span></div>
<div style="position:absolute;left:109.03px;top:323.66px" class="cls_039"><span class="cls_039">Spring Boot autoconfiguration has dramatically reduced the amount of explicit</span></div>
<div style="position:absolute;left:93.18px;top:336.68px" class="cls_039"><span class="cls_039">configuration (whether with XML or Java) required to build an application. In fact, by</span></div>
<div style="position:absolute;left:93.18px;top:349.67px" class="cls_039"><span class="cls_039">the time you finish the example in this chapter, you’ll have a working Spring applica-</span></div>
<div style="position:absolute;left:93.18px;top:362.66px" class="cls_039"><span class="cls_039">tion that has only a single line of Spring configuration code!</span></div>
<div style="position:absolute;left:109.75px;top:375.68px" class="cls_039"><span class="cls_039">Spring Boot enhances Spring development so much that it’s hard to imagine</span></div>
<div style="position:absolute;left:93.18px;top:388.67px" class="cls_039"><span class="cls_039">developing Spring applications without it. For that reason, this book treats Spring and</span></div>
<div style="position:absolute;left:93.18px;top:401.66px" class="cls_039"><span class="cls_039">Spring Boot as if they were one and the same. We’ll use Spring Boot as much as possi-</span></div>
<div style="position:absolute;left:93.18px;top:414.68px" class="cls_039"><span class="cls_039">ble, and explicit configuration only when necessary. And, because Spring XML config-</span></div>
<div style="position:absolute;left:93.18px;top:427.67px" class="cls_039"><span class="cls_039">uration is the old-school way of working with Spring, we’ll focus primarily on Spring’s</span></div>
<div style="position:absolute;left:93.18px;top:440.66px" class="cls_039"><span class="cls_039">Java-based configuration.</span></div>
<div style="position:absolute;left:107.64px;top:453.68px" class="cls_039"><span class="cls_039">But enough of this chitchat, yakety-yak, and flimflam. This book’s title includes the</span></div>
<div style="position:absolute;left:93.18px;top:466.67px" class="cls_039"><span class="cls_039">phrase </span><span class="cls_036">in action</span><span class="cls_039">, so let’s get moving, and you can start writing your first application</span></div>
<div style="position:absolute;left:93.18px;top:479.66px" class="cls_039"><span class="cls_039">with Spring.</span></div>
<div style="position:absolute;left:57.18px;top:503.83px" class="cls_040"><span class="cls_040">1.2</span></div>
<div style="position:absolute;left:93.18px;top:503.83px" class="cls_040"><span class="cls_040">Initializing a Spring application</span></div>
<div style="position:absolute;left:93.18px;top:523.16px" class="cls_039"><span class="cls_039">Through the course of this book, you’ll create Taco Cloud, an online application</span></div>
<div style="position:absolute;left:93.18px;top:536.18px" class="cls_039"><span class="cls_039">for ordering the most wonderful food created by man—tacos. Of course, you’ll use</span></div>
<div style="position:absolute;left:93.18px;top:549.17px" class="cls_039"><span class="cls_039">Spring, Spring Boot, and a variety of related libraries and frameworks to achieve</span></div>
<div style="position:absolute;left:93.18px;top:562.19px" class="cls_039"><span class="cls_039">this goal.</span></div>
<div style="position:absolute;left:108.63px;top:575.18px" class="cls_039"><span class="cls_039">You’ll find several options for initializing a Spring application. Although I could</span></div>
<div style="position:absolute;left:93.18px;top:588.17px" class="cls_039"><span class="cls_039">walk you through the steps of manually creating a project directory structure and</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:17572px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background029.jpg" width="531" height="666"></div>
<div style="position:absolute;left:212.31px;top:24.35px" class="cls_055"><span class="cls_055">Initializing a Spring application</span></div>
<div style="position:absolute;left:469.38px;top:24.35px" class="cls_052"><span class="cls_052">7</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">defining a build specification, that’s wasted time—time better spent writing applica-</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">tion code. Therefore, you’re going to lean on the Spring Initializr to bootstrap your</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">application.</span></div>
<div style="position:absolute;left:118.25px;top:89.66px" class="cls_039"><span class="cls_039">The Spring Initializr is both a browser-based web application and a REST API,</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">which can produce a skeleton Spring project structure that you can flesh out with</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">whatever functionality you want. Several ways to use Spring Initializr follow:</span></div>
<div style="position:absolute;left:117.78px;top:132.65px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  From the web application at </span><a href="http://start.spring.io/">http://start.spring.io</a> </div>
<div style="position:absolute;left:117.78px;top:146.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  From the command line using the </span><span class="cls_059">curl</span><span class="cls_039"> command</span></div>
<div style="position:absolute;left:117.78px;top:160.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  From the command line using the Spring Boot command-line interface</span></div>
<div style="position:absolute;left:117.78px;top:174.65px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  When creating a new project with Spring Tool Suite</span></div>
<div style="position:absolute;left:117.78px;top:188.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  When creating a new project with IntelliJ IDEA</span></div>
<div style="position:absolute;left:117.78px;top:202.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  When creating a new project with NetBeans</span></div>
<div style="position:absolute;left:102.18px;top:220.67px" class="cls_039"><span class="cls_039">Rather than spend several pages of this chapter talking about each one of these options,</span></div>
<div style="position:absolute;left:102.18px;top:233.66px" class="cls_039"><span class="cls_039">I’ve collected those details in the appendix. In this chapter, and throughout this book,</span></div>
<div style="position:absolute;left:102.18px;top:246.65px" class="cls_039"><span class="cls_039">I’ll show you how to create a new project using my favorite option: Spring Initializr</span></div>
<div style="position:absolute;left:102.18px;top:259.67px" class="cls_039"><span class="cls_039">support in the Spring Tool Suite.</span></div>
<div style="position:absolute;left:117.04px;top:272.66px" class="cls_039"><span class="cls_039">As its name suggests, Spring Tool Suite is a fantastic Spring development environ-</span></div>
<div style="position:absolute;left:102.18px;top:285.65px" class="cls_039"><span class="cls_039">ment. But it also offers a handy Spring Boot Dashboard feature that (at least at the</span></div>
<div style="position:absolute;left:102.18px;top:298.67px" class="cls_039"><span class="cls_039">time I write this) isn’t available in any of the other IDE options.</span></div>
<div style="position:absolute;left:116.49px;top:311.66px" class="cls_039"><span class="cls_039">If you’re not a Spring Tool Suite user, that’s fine; we can still be friends. Hop over</span></div>
<div style="position:absolute;left:102.18px;top:324.68px" class="cls_039"><span class="cls_039">to the appendix and substitute the Initializr option that suits you best for the</span></div>
<div style="position:absolute;left:102.18px;top:337.67px" class="cls_039"><span class="cls_039">instructions in the following sections. But know that throughout this book, I may</span></div>
<div style="position:absolute;left:102.18px;top:350.66px" class="cls_039"><span class="cls_039">occasionally reference features specific to Spring Tool Suite, such as the Spring Boot</span></div>
<div style="position:absolute;left:102.18px;top:363.68px" class="cls_039"><span class="cls_039">Dashboard. If you’re not using Spring Tool Suite, you’ll need to adapt those instruc-</span></div>
<div style="position:absolute;left:102.18px;top:376.67px" class="cls_039"><span class="cls_039">tions to fit your IDE.</span></div>
<div style="position:absolute;left:66.18px;top:398.48px" class="cls_063"><span class="cls_063">1.2.1</span></div>
<div style="position:absolute;left:102.18px;top:398.48px" class="cls_063"><span class="cls_063">Initializing a Spring project with Spring Tool Suite</span></div>
<div style="position:absolute;left:102.18px;top:415.67px" class="cls_039"><span class="cls_039">To get started with a new Spring project in Spring Tool Suite, go to the File menu and</span></div>
<div style="position:absolute;left:102.18px;top:428.66px" class="cls_039"><span class="cls_039">select New, and then Spring Starter Project. Figure 1.2 shows the menu structure to</span></div>
<div style="position:absolute;left:102.18px;top:441.68px" class="cls_039"><span class="cls_039">look for.</span></div>
<div style="position:absolute;left:102.18px;top:535.49px" class="cls_053"><span class="cls_053">Figure 1.2</span></div>
<div style="position:absolute;left:146.79px;top:535.49px" class="cls_053"><span class="cls_053">Starting a new project with the Initializr in Spring Tool Suite</span></div>
<div style="position:absolute;left:102.18px;top:564.92px" class="cls_039"><span class="cls_039">Once you select Spring Starter Project, a new project wizard dialog (figure 1.3) appears.</span></div>
<div style="position:absolute;left:102.18px;top:577.94px" class="cls_039"><span class="cls_039">The first page in the wizard asks you for some general project information, such as the</span></div>
<div style="position:absolute;left:102.18px;top:590.93px" class="cls_039"><span class="cls_039">project name, description, and other essential information. If you’re familiar with the</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:18248px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background030.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">8</span></div>
<div style="position:absolute;left:190.50px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 1</span></div>
<div style="position:absolute;left:234.63px;top:24.35px" class="cls_055"><span class="cls_055">Getting started with Spring</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">contents of a Maven pom.xml file, you’ll recognize most of the fields as items that end</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">up in a Maven build specification. For the Taco Cloud application, fill in the dialog as</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">shown in figure 1.3, and then click Next.</span></div>
<div style="position:absolute;left:57.18px;top:429.29px" class="cls_053"><span class="cls_053">Figure 1.3</span></div>
<div style="position:absolute;left:101.78px;top:429.29px" class="cls_053"><span class="cls_053">Specifying general project information for the Taco Cloud application</span></div>
<div style="position:absolute;left:93.18px;top:467.24px" class="cls_039"><span class="cls_039">The next page in the wizard lets you select dependencies to add to your project (see</span></div>
<div style="position:absolute;left:93.18px;top:480.26px" class="cls_039"><span class="cls_039">figure 1.4). Notice that near the top of the dialog, you can select which version of</span></div>
<div style="position:absolute;left:93.18px;top:493.25px" class="cls_039"><span class="cls_039">Spring Boot you want to base your project on. This defaults to the most current ver-</span></div>
<div style="position:absolute;left:93.18px;top:506.24px" class="cls_039"><span class="cls_039">sion available. It’s generally a good idea to leave it as is unless you need to target a</span></div>
<div style="position:absolute;left:93.18px;top:519.26px" class="cls_039"><span class="cls_039">different version.</span></div>
<div style="position:absolute;left:108.84px;top:532.25px" class="cls_039"><span class="cls_039">As for the dependencies themselves, you can either expand the various sections</span></div>
<div style="position:absolute;left:93.18px;top:545.24px" class="cls_039"><span class="cls_039">and seek out the desired dependencies manually, or search for them in the search box</span></div>
<div style="position:absolute;left:93.18px;top:558.26px" class="cls_039"><span class="cls_039">at the top of the Available list. For the Taco Cloud application, you’ll start with the</span></div>
<div style="position:absolute;left:93.18px;top:571.25px" class="cls_039"><span class="cls_039">dependencies shown in figure 1.4.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:18924px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background031.jpg" width="531" height="666"></div>
<div style="position:absolute;left:212.31px;top:24.35px" class="cls_055"><span class="cls_055">Initializing a Spring application</span></div>
<div style="position:absolute;left:469.38px;top:24.35px" class="cls_052"><span class="cls_052">9</span></div>
<div style="position:absolute;left:102.18px;top:480.38px" class="cls_053"><span class="cls_053">Figure 1.4</span></div>
<div style="position:absolute;left:146.78px;top:480.38px" class="cls_053"><span class="cls_053">Choosing starter dependencies</span></div>
<div style="position:absolute;left:102.18px;top:517.16px" class="cls_039"><span class="cls_039">At this point, you can click Finish to generate the project and add it to your work-</span></div>
<div style="position:absolute;left:102.18px;top:530.18px" class="cls_039"><span class="cls_039">space. But if you’re feeling slightly adventurous, click Next one more time to see the</span></div>
<div style="position:absolute;left:102.18px;top:543.17px" class="cls_039"><span class="cls_039">final page of the new starter project wizard, as shown in figure 1.5.</span></div>
<div style="position:absolute;left:120.04px;top:556.16px" class="cls_039"><span class="cls_039">By default, the new project wizard makes a call to the Spring Initializr at</span></div>
<div style="position:absolute;left:102.18px;top:569.18px" class="cls_045"><span class="cls_045"> </span><a href="http://start.spring.io/">http://start.spring.io</a> <span class="cls_039"> to generate the project. Generally, there’s no need to override</span></div>
<div style="position:absolute;left:102.18px;top:582.17px" class="cls_039"><span class="cls_039">this default, which is why you could have clicked Finish on the second page of the</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:19600px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background032.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">10</span></div>
<div style="position:absolute;left:190.50px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 1</span></div>
<div style="position:absolute;left:234.63px;top:24.35px" class="cls_055"><span class="cls_055">Getting started with Spring</span></div>
<div style="position:absolute;left:57.18px;top:487.88px" class="cls_053"><span class="cls_053">Figure 1.5</span></div>
<div style="position:absolute;left:101.78px;top:487.88px" class="cls_053"><span class="cls_053">Optionally specifying an alternate Initializr address</span></div>
<div style="position:absolute;left:93.18px;top:520.94px" class="cls_039"><span class="cls_039">wizard. But if for some reason you’re hosting your own clone of Initializr (perhaps a</span></div>
<div style="position:absolute;left:93.18px;top:533.93px" class="cls_039"><span class="cls_039">local copy on your own machine or a customized clone running inside your company</span></div>
<div style="position:absolute;left:93.18px;top:546.92px" class="cls_039"><span class="cls_039">firewall), then you’ll want to change the Base Url field to point to your Initializr</span></div>
<div style="position:absolute;left:93.18px;top:559.94px" class="cls_039"><span class="cls_039">instance before clicking Finish.</span></div>
<div style="position:absolute;left:108.97px;top:572.93px" class="cls_039"><span class="cls_039">After you click Finish, the project is downloaded from the Initializr and loaded</span></div>
<div style="position:absolute;left:93.18px;top:585.92px" class="cls_039"><span class="cls_039">into your workspace. Wait a few moments for it to load and build, and then you’ll be</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:20276px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background033.jpg" width="531" height="666"></div>
<div style="position:absolute;left:212.31px;top:24.35px" class="cls_055"><span class="cls_055">Initializing a Spring application</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">11</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">ready to start developing application functionality. But first, let’s take a look at what</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">the Initializr gave you.</span></div>
<div style="position:absolute;left:66.18px;top:85.49px" class="cls_063"><span class="cls_063">1.2.2</span></div>
<div style="position:absolute;left:102.18px;top:85.49px" class="cls_063"><span class="cls_063">Examining the Spring project structure</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">After the project loads in the IDE, expand it to see what it contains. Figure 1.6 shows</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">the expanded Taco Cloud project in Spring Tool Suite.</span></div>
<div style="position:absolute;left:102.18px;top:363.77px" class="cls_053"><span class="cls_053">Figure 1.6</span></div>
<div style="position:absolute;left:146.78px;top:363.77px" class="cls_053"><span class="cls_053">The initial Spring project structure as shown in Spring</span></div>
<div style="position:absolute;left:102.18px;top:373.79px" class="cls_053"><span class="cls_053">Tool Suite</span></div>
<div style="position:absolute;left:102.18px;top:407.66px" class="cls_039"><span class="cls_039">You may recognize this as a typical Maven or Gradle project structure, where applica-</span></div>
<div style="position:absolute;left:102.18px;top:420.68px" class="cls_039"><span class="cls_039">tion source code is placed under src/main/java, test code is placed under src/test/java,</span></div>
<div style="position:absolute;left:102.18px;top:433.67px" class="cls_039"><span class="cls_039">and non-Java resources are placed under src/main/resources. Within that project</span></div>
<div style="position:absolute;left:102.18px;top:446.66px" class="cls_039"><span class="cls_039">structure, you’ll want to take note of these items:</span></div>
<div style="position:absolute;left:117.78px;top:463.67px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> mvnw</span><span class="cls_039"> and </span><span class="cls_059">mvnw.cmd</span><span class="cls_039">—These are Maven wrapper scripts. You can use these scripts</span></div>
<div style="position:absolute;left:129.78px;top:476.66px" class="cls_039"><span class="cls_039">to build your project even if you don’t have Maven installed on your machine.</span></div>
<div style="position:absolute;left:117.78px;top:490.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  pom.xml—This is the Maven build specification. We’ll look deeper into this</span></div>
<div style="position:absolute;left:129.78px;top:503.66px" class="cls_039"><span class="cls_039">in a moment.</span></div>
<div style="position:absolute;left:117.78px;top:517.67px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> TacoCloudApplication.java</span><span class="cls_039">—This is the Spring Boot main class that boot-</span></div>
<div style="position:absolute;left:129.78px;top:530.66px" class="cls_039"><span class="cls_039">straps the project. We’ll take a closer look at this class in a moment.</span></div>
<div style="position:absolute;left:117.78px;top:544.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  application.properties—This file is initially empty, but offers a place where you</span></div>
<div style="position:absolute;left:129.78px;top:557.69px" class="cls_039"><span class="cls_039">can specify configuration properties. We’ll tinker with this file a little in this</span></div>
<div style="position:absolute;left:129.78px;top:570.68px" class="cls_039"><span class="cls_039">chapter, but I’ll postpone a detailed explanation of configuration properties to</span></div>
<div style="position:absolute;left:129.78px;top:583.67px" class="cls_039"><span class="cls_039">chapter 5.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:20952px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background034.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">12</span></div>
<div style="position:absolute;left:190.50px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 1</span></div>
<div style="position:absolute;left:234.63px;top:24.35px" class="cls_055"><span class="cls_055">Getting started with Spring</span></div>
<div style="position:absolute;left:108.78px;top:50.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  static—This folder is where you can place any static content (images, stylesheets,</span></div>
<div style="position:absolute;left:120.78px;top:63.65px" class="cls_039"><span class="cls_039">JavaScript, and so forth) that you want to serve to the browser. It’s initially</span></div>
<div style="position:absolute;left:120.78px;top:76.67px" class="cls_039"><span class="cls_039">empty.</span></div>
<div style="position:absolute;left:108.78px;top:90.65px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  templates—This folder is where you’ll place template files that will be used to</span></div>
<div style="position:absolute;left:120.78px;top:103.67px" class="cls_039"><span class="cls_039">render content to the browser. It’s initially empty, but you’ll add a Thymeleaf</span></div>
<div style="position:absolute;left:120.78px;top:116.66px" class="cls_039"><span class="cls_039">template soon.</span></div>
<div style="position:absolute;left:108.78px;top:130.67px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> TacoCloudApplicationTests.java</span><span class="cls_039">—This is a simple test class that ensures that</span></div>
<div style="position:absolute;left:120.78px;top:143.66px" class="cls_039"><span class="cls_039">the Spring application context loads successfully. You’ll add more tests to the</span></div>
<div style="position:absolute;left:120.78px;top:156.65px" class="cls_039"><span class="cls_039">mix as you develop the application.</span></div>
<div style="position:absolute;left:93.18px;top:176.66px" class="cls_039"><span class="cls_039">As the Taco Cloud application grows, you’ll fill in this barebones project structure</span></div>
<div style="position:absolute;left:93.18px;top:189.65px" class="cls_039"><span class="cls_039">with Java code, images, stylesheets, tests, and other collateral that will make your proj-</span></div>
<div style="position:absolute;left:93.18px;top:202.67px" class="cls_039"><span class="cls_039">ect more complete. But in the meantime, let’s dig a little deeper into a few of the</span></div>
<div style="position:absolute;left:93.18px;top:215.66px" class="cls_039"><span class="cls_039">items that Spring Initializr provided.</span></div>
<div style="position:absolute;left:93.18px;top:233.84px" class="cls_064"><span class="cls_064">E</span><span class="cls_065">XPLORING</span><span class="cls_064"> </span><span class="cls_065">THE</span><span class="cls_064"> </span><span class="cls_065">BUILD</span><span class="cls_064"> </span><span class="cls_065">SPECIFICATION</span></div>
<div style="position:absolute;left:93.18px;top:246.17px" class="cls_039"><span class="cls_039">When you filled out the Initializr form, you specified that your project should be built</span></div>
<div style="position:absolute;left:93.18px;top:259.16px" class="cls_039"><span class="cls_039">with Maven. Therefore, the Spring Initializr gave you a pom.xml file already popu-</span></div>
<div style="position:absolute;left:93.18px;top:272.15px" class="cls_039"><span class="cls_039">lated with the choices you made. The following listing shows the entire pom.xml file</span></div>
<div style="position:absolute;left:93.18px;top:285.17px" class="cls_039"><span class="cls_039">provided by the Initializr.</span></div>
<div style="position:absolute;left:105.18px;top:311.90px" class="cls_066"><span class="cls_066">Listing 1.1</span></div>
<div style="position:absolute;left:157.27px;top:311.90px" class="cls_066"><span class="cls_066">The initial Maven build specification</span></div>
<div style="position:absolute;left:93.18px;top:331.73px" class="cls_060"><span class="cls_060">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></div>
<div style="position:absolute;left:93.18px;top:341.75px" class="cls_060"><span class="cls_060">&lt;project xmlns="</span><a href="http://maven.apache.org/pom/4.0.0" "="">http://maven.apache.org/POM/4.0.0"</a> </div>
<div style="position:absolute;left:102.78px;top:351.74px" class="cls_060"><span class="cls_060">xmlns:xsi="</span><a href="http://www.w3.org/2001/xmlschema-instance" "="">http://www.w3.org/2001/XMLSchema-instance"</a> </div>
<div style="position:absolute;left:102.78px;top:361.73px" class="cls_060"><span class="cls_060">xsi:schemaLocation="</span><a href="http://maven.apache.org/pom/4.0.0/">http://maven.apache.org/POM/4.0.0</a> </div>
<div style="position:absolute;left:141.15px;top:371.75px" class="cls_060"><span class="cls_060"> </span><a href="http://maven.apache.org/xsd/maven-4.0.0.xsd" "="">http://maven.apache.org/xsd/maven-4.0.0.xsd"</a>&gt;</div>
<div style="position:absolute;left:102.78px;top:381.74px" class="cls_060"><span class="cls_060">&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span></div>
<div style="position:absolute;left:102.78px;top:401.75px" class="cls_060"><span class="cls_060">&lt;groupId&gt;sia&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:411.74px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;taco-cloud&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:421.76px" class="cls_060"><span class="cls_060">&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span></div>
<div style="position:absolute;left:102.77px;top:431.75px" class="cls_060"><span class="cls_060">&lt;packaging&gt;jar&lt;/packaging&gt;</span></div>
<div style="position:absolute;left:307.26px;top:431.36px" class="cls_067"><span class="cls_067">JAR packaging</span></div>
<div style="position:absolute;left:102.78px;top:451.76px" class="cls_060"><span class="cls_060">&lt;name&gt;taco-cloud&lt;/name&gt;</span></div>
<div style="position:absolute;left:102.78px;top:461.75px" class="cls_060"><span class="cls_060">&lt;description&gt;Taco Cloud Example&lt;/description&gt;</span></div>
<div style="position:absolute;left:102.78px;top:481.76px" class="cls_060"><span class="cls_060">&lt;parent&gt;</span></div>
<div style="position:absolute;left:112.38px;top:491.75px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:112.38px;top:501.74px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:112.37px;top:511.76px" class="cls_060"><span class="cls_060">&lt;version&gt;2.0.4.RELEASE&lt;/version&gt;</span></div>
<div style="position:absolute;left:384.42px;top:511.37px" class="cls_067"><span class="cls_067">Spring Boot version</span></div>
<div style="position:absolute;left:112.38px;top:521.75px" class="cls_060"><span class="cls_060">&lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;</span></div>
<div style="position:absolute;left:102.78px;top:531.74px" class="cls_060"><span class="cls_060">&lt;/parent&gt;</span></div>
<div style="position:absolute;left:102.78px;top:551.75px" class="cls_060"><span class="cls_060">&lt;properties&gt;</span></div>
<div style="position:absolute;left:112.38px;top:561.74px" class="cls_060"><span class="cls_060">&lt;project.build.sourceEncoding&gt;</span></div>
<div style="position:absolute;left:131.55px;top:571.76px" class="cls_060"><span class="cls_060">UTF-8&lt;/project.build.sourceEncoding&gt;</span></div>
<div style="position:absolute;left:112.38px;top:581.75px" class="cls_060"><span class="cls_060">&lt;project.reporting.outputEncoding&gt;</span></div>
<div style="position:absolute;left:131.55px;top:591.74px" class="cls_060"><span class="cls_060">UTF-8&lt;/project.reporting.outputEncoding&gt;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:21628px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background035.jpg" width="531" height="666"></div>
<div style="position:absolute;left:212.31px;top:24.35px" class="cls_055"><span class="cls_055">Initializing a Spring application</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">13</span></div>
<div style="position:absolute;left:121.38px;top:51.32px" class="cls_060"><span class="cls_060">&lt;java.version&gt;1.8&lt;/java.version&gt;</span></div>
<div style="position:absolute;left:111.78px;top:61.34px" class="cls_060"><span class="cls_060">&lt;/properties&gt;</span></div>
<div style="position:absolute;left:361.20px;top:73.46px" class="cls_067"><span class="cls_067">Starter</span></div>
<div style="position:absolute;left:111.78px;top:81.32px" class="cls_060"><span class="cls_060">&lt;dependencies&gt;</span></div>
<div style="position:absolute;left:361.20px;top:82.94px" class="cls_067"><span class="cls_067">dependencies</span></div>
<div style="position:absolute;left:121.37px;top:91.34px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:130.95px;top:101.33px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:130.95px;top:111.32px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:121.38px;top:121.34px" class="cls_060"><span class="cls_060">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:121.38px;top:131.33px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:130.95px;top:141.35px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:130.95px;top:151.34px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:121.38px;top:161.33px" class="cls_060"><span class="cls_060">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:121.38px;top:171.35px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:130.95px;top:181.34px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:130.95px;top:191.33px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:130.95px;top:201.35px" class="cls_060"><span class="cls_060">&lt;scope&gt;runtime&lt;/scope&gt;</span></div>
<div style="position:absolute;left:121.38px;top:211.34px" class="cls_060"><span class="cls_060">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:121.38px;top:231.35px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:130.95px;top:241.34px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:130.95px;top:251.33px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:130.95px;top:261.35px" class="cls_060"><span class="cls_060">&lt;scope&gt;test&lt;/scope&gt;</span></div>
<div style="position:absolute;left:121.38px;top:271.34px" class="cls_060"><span class="cls_060">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:121.38px;top:291.35px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:130.95px;top:301.34px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.seleniumhq.selenium&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:130.95px;top:311.33px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;selenium-java&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:140.55px;top:321.35px" class="cls_060"><span class="cls_060">&lt;scope&gt;test&lt;/scope&gt;</span></div>
<div style="position:absolute;left:121.38px;top:331.34px" class="cls_060"><span class="cls_060">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:126.15px;top:351.35px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:140.55px;top:361.34px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.seleniumhq.selenium&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:140.55px;top:371.33px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;htmlunit-driver&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:140.55px;top:381.35px" class="cls_060"><span class="cls_060">&lt;scope&gt;test&lt;/scope&gt;</span></div>
<div style="position:absolute;left:130.95px;top:391.34px" class="cls_060"><span class="cls_060">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:111.78px;top:401.36px" class="cls_060"><span class="cls_060">&lt;/dependencies&gt;</span></div>
<div style="position:absolute;left:111.78px;top:421.34px" class="cls_060"><span class="cls_060">&lt;build&gt;</span></div>
<div style="position:absolute;left:374.07px;top:423.47px" class="cls_067"><span class="cls_067">Spring Boot</span></div>
<div style="position:absolute;left:121.38px;top:431.36px" class="cls_060"><span class="cls_060">&lt;plugins&gt;</span></div>
<div style="position:absolute;left:374.07px;top:432.98px" class="cls_067"><span class="cls_067">plugin</span></div>
<div style="position:absolute;left:130.96px;top:441.35px" class="cls_060"><span class="cls_060">&lt;plugin&gt;</span></div>
<div style="position:absolute;left:140.55px;top:451.34px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:140.55px;top:461.36px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:130.95px;top:471.35px" class="cls_060"><span class="cls_060">&lt;/plugin&gt;</span></div>
<div style="position:absolute;left:121.38px;top:481.34px" class="cls_060"><span class="cls_060">&lt;/plugins&gt;</span></div>
<div style="position:absolute;left:111.78px;top:491.36px" class="cls_060"><span class="cls_060">&lt;/build&gt;</span></div>
<div style="position:absolute;left:102.18px;top:511.34px" class="cls_061"><span class="cls_061">&lt;/project&gt;</span></div>
<div style="position:absolute;left:102.18px;top:534.68px" class="cls_039"><span class="cls_039">The first noteworthy item in the pom.xml file is the </span><span class="cls_059">&lt;packaging&gt;</span><span class="cls_039"> element. You chose</span></div>
<div style="position:absolute;left:102.18px;top:547.67px" class="cls_039"><span class="cls_039">to build your application as an executable JAR file, as opposed to a WAR file. This is</span></div>
<div style="position:absolute;left:102.18px;top:560.66px" class="cls_039"><span class="cls_039">probably one of the most curious choices you’ll make, especially for a web application.</span></div>
<div style="position:absolute;left:102.18px;top:573.68px" class="cls_039"><span class="cls_039">After all, traditional Java web applications are packaged as WAR files, leaving JAR files</span></div>
<div style="position:absolute;left:102.18px;top:586.67px" class="cls_039"><span class="cls_039">the packaging of choice for libraries and the occasional desktop UI application.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:22304px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background036.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">14</span></div>
<div style="position:absolute;left:190.50px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 1</span></div>
<div style="position:absolute;left:234.63px;top:24.35px" class="cls_055"><span class="cls_055">Getting started with Spring</span></div>
<div style="position:absolute;left:107.52px;top:50.66px" class="cls_039"><span class="cls_039">The choice of JAR packaging is a cloud-minded choice. Whereas WAR files are per-</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">fectly suitable for deploying to a traditional Java application server, they’re not a natu-</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">ral fit for most cloud platforms. Although some cloud platforms (such as Cloud</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">Foundry) are capable of deploying and running WAR files, all Java cloud platforms</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">are capable of running an executable JAR file. Therefore, the Spring Initializr defaults</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">to JAR packaging unless you tell it to do otherwise.</span></div>
<div style="position:absolute;left:108.91px;top:128.66px" class="cls_039"><span class="cls_039">If you intend to deploy your application to a traditional Java application server,</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">then you’ll need to choose WAR packaging and include a web initializer class. We’ll</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_039"><span class="cls_039">look at how to build WAR files in more detail in chapter 2.</span></div>
<div style="position:absolute;left:109.44px;top:167.66px" class="cls_039"><span class="cls_039">Next, take note of the </span><span class="cls_059">&lt;parent&gt;</span><span class="cls_039"> element and, more specifically, its </span><span class="cls_059">&lt;version&gt;</span></div>
<div style="position:absolute;left:93.18px;top:180.65px" class="cls_039"><span class="cls_039">child. This specifies that your project has </span><span class="cls_059">spring-boot-starter-parent</span><span class="cls_039"> as its parent</span></div>
<div style="position:absolute;left:93.18px;top:193.67px" class="cls_039"><span class="cls_039">POM. Among other things, this parent POM provides dependency management for</span></div>
<div style="position:absolute;left:93.18px;top:206.66px" class="cls_039"><span class="cls_039">several libraries commonly used in Spring projects. For those libraries covered by the</span></div>
<div style="position:absolute;left:93.18px;top:219.65px" class="cls_039"><span class="cls_039">parent POM, you won’t have to specify a version, as it’s inherited from the parent. The</span></div>
<div style="position:absolute;left:93.18px;top:232.67px" class="cls_039"><span class="cls_039">version, </span><span class="cls_059">2.0.4.RELEASE</span><span class="cls_039">, indicates that you’re using Spring Boot 2.0.4 and, thus, will</span></div>
<div style="position:absolute;left:93.18px;top:245.66px" class="cls_039"><span class="cls_039">inherit dependency management as defined by that version of Spring Boot.</span></div>
<div style="position:absolute;left:108.20px;top:258.65px" class="cls_039"><span class="cls_039">While we’re on the subject of dependencies, note that there are three dependen-</span></div>
<div style="position:absolute;left:93.18px;top:271.67px" class="cls_039"><span class="cls_039">cies declared under the </span><span class="cls_059">&lt;dependencies&gt;</span><span class="cls_039"> element. The first two should look somewhat</span></div>
<div style="position:absolute;left:93.18px;top:284.66px" class="cls_039"><span class="cls_039">familiar to you. They correspond directly to the </span><span class="cls_059">Web</span><span class="cls_039"> and </span><span class="cls_059">Thymeleaf</span><span class="cls_039"> dependencies that</span></div>
<div style="position:absolute;left:93.18px;top:297.68px" class="cls_039"><span class="cls_039">you selected before clicking the Finish button in the Spring Tool Suite new project</span></div>
<div style="position:absolute;left:93.18px;top:310.67px" class="cls_039"><span class="cls_039">wizard. The third dependency is one that provides a lot of helpful testing capabilities.</span></div>
<div style="position:absolute;left:93.18px;top:323.66px" class="cls_039"><span class="cls_039">You didn’t have to check a box for it to be included because the Spring Initializr</span></div>
<div style="position:absolute;left:93.18px;top:336.68px" class="cls_039"><span class="cls_039">assumes (hopefully, correctly) that you’ll be writing tests.</span></div>
<div style="position:absolute;left:108.08px;top:349.67px" class="cls_039"><span class="cls_039">You may also notice that all three dependencies have the word </span><span class="cls_036">starter</span><span class="cls_039"> in their arti-</span></div>
<div style="position:absolute;left:93.18px;top:362.66px" class="cls_039"><span class="cls_039">fact ID. Spring Boot starter dependencies are special in that they typically don’t have</span></div>
<div style="position:absolute;left:93.18px;top:375.68px" class="cls_039"><span class="cls_039">any library code themselves, but instead transitively pull in other libraries. These</span></div>
<div style="position:absolute;left:93.18px;top:388.67px" class="cls_039"><span class="cls_039">starter dependencies offer three primary benefits:</span></div>
<div style="position:absolute;left:108.78px;top:405.68px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Your build file will be significantly smaller and easier to manage because you</span></div>
<div style="position:absolute;left:120.78px;top:418.67px" class="cls_039"><span class="cls_039">won’t need to declare a dependency on every library you might need.</span></div>
<div style="position:absolute;left:108.78px;top:432.68px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  You’re able to think of your dependencies in terms of what capabilities they</span></div>
<div style="position:absolute;left:120.78px;top:445.67px" class="cls_039"><span class="cls_039">provide, rather than in terms of library names. If you’re developing a web appli-</span></div>
<div style="position:absolute;left:120.78px;top:458.66px" class="cls_039"><span class="cls_039">cation, you’ll add the web starter dependency rather than a laundry list of indi-</span></div>
<div style="position:absolute;left:120.78px;top:471.68px" class="cls_039"><span class="cls_039">vidual libraries that enable you to write a web application.</span></div>
<div style="position:absolute;left:108.78px;top:485.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  You’re freed from the burden of worry about library versions. You can trust that</span></div>
<div style="position:absolute;left:120.78px;top:498.68px" class="cls_039"><span class="cls_039">for a given version of Spring Boot, the versions of the libraries brought in tran-</span></div>
<div style="position:absolute;left:120.78px;top:511.67px" class="cls_039"><span class="cls_039">sitively will be compatible. You only need to worry about which version of</span></div>
<div style="position:absolute;left:120.78px;top:524.66px" class="cls_039"><span class="cls_039">Spring Boot you’re using.</span></div>
<div style="position:absolute;left:93.18px;top:542.66px" class="cls_039"><span class="cls_039">Finally, the build specification ends with the Spring Boot plugin. This plugin performs</span></div>
<div style="position:absolute;left:93.18px;top:555.68px" class="cls_039"><span class="cls_039">a few important functions:</span></div>
<div style="position:absolute;left:108.78px;top:572.69px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  It provides a Maven goal that enables you to run the application using Maven.</span></div>
<div style="position:absolute;left:120.78px;top:585.68px" class="cls_039"><span class="cls_039">You’ll try out this goal in section 1.3.4.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:22980px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background037.jpg" width="531" height="666"></div>
<div style="position:absolute;left:212.31px;top:24.35px" class="cls_055"><span class="cls_055">Initializing a Spring application</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">15</span></div>
<div style="position:absolute;left:117.78px;top:50.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  It ensures that all dependency libraries are included within the executable JAR</span></div>
<div style="position:absolute;left:129.78px;top:63.65px" class="cls_039"><span class="cls_039">file and available on the runtime classpath.</span></div>
<div style="position:absolute;left:117.78px;top:77.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  It produces a manifest file in the JAR file that denotes the bootstrap class</span></div>
<div style="position:absolute;left:129.78px;top:90.65px" class="cls_039"><span class="cls_039">(</span><span class="cls_059">TacoCloudApplication</span><span class="cls_039">, in your case) as the main class for the executable JAR.</span></div>
<div style="position:absolute;left:102.18px;top:108.65px" class="cls_039"><span class="cls_039">Speaking of the bootstrap class, let’s open it up and take a closer look.</span></div>
<div style="position:absolute;left:102.18px;top:126.83px" class="cls_064"><span class="cls_064">B</span><span class="cls_065">OOTSTRAPPING</span><span class="cls_064"> </span><span class="cls_065">THE</span><span class="cls_064"> </span><span class="cls_065">APPLICATION</span></div>
<div style="position:absolute;left:102.18px;top:139.16px" class="cls_039"><span class="cls_039">Because you’ll be running the application from an executable JAR, it’s important to</span></div>
<div style="position:absolute;left:102.18px;top:152.15px" class="cls_039"><span class="cls_039">have a main class that will be executed when that JAR file is run. You’ll also need at</span></div>
<div style="position:absolute;left:102.18px;top:165.17px" class="cls_039"><span class="cls_039">least a minimal amount of Spring configuration to bootstrap the application. That’s</span></div>
<div style="position:absolute;left:102.18px;top:178.16px" class="cls_039"><span class="cls_039">what you’ll find in the </span><span class="cls_059">TacoCloudApplication</span><span class="cls_039"> class, shown in the following listing.</span></div>
<div style="position:absolute;left:114.18px;top:201.89px" class="cls_066"><span class="cls_066">Listing 1.2</span></div>
<div style="position:absolute;left:166.26px;top:201.89px" class="cls_066"><span class="cls_066">The Taco Cloud bootstrap class</span></div>
<div style="position:absolute;left:102.18px;top:221.75px" class="cls_060"><span class="cls_060">package tacos;</span></div>
<div style="position:absolute;left:102.18px;top:241.73px" class="cls_060"><span class="cls_060">import org.springframework.boot.SpringApplication;</span></div>
<div style="position:absolute;left:102.18px;top:251.75px" class="cls_060"><span class="cls_060">import org.springframework.boot.autoconfigure.SpringBootApplication;</span></div>
<div style="position:absolute;left:102.18px;top:271.73px" class="cls_060"><span class="cls_060">@SpringBootApplication</span></div>
<div style="position:absolute;left:321.21px;top:275.21px" class="cls_067"><span class="cls_067">Spring Boot</span></div>
<div style="position:absolute;left:102.18px;top:281.75px" class="cls_060"><span class="cls_060">public class TacoCloudApplication {</span></div>
<div style="position:absolute;left:321.21px;top:284.72px" class="cls_067"><span class="cls_067">application</span></div>
<div style="position:absolute;left:111.78px;top:301.73px" class="cls_060"><span class="cls_060">public static void main(String[] args) {</span></div>
<div style="position:absolute;left:121.36px;top:311.75px" class="cls_060"><span class="cls_060">SpringApplication.run(TacoCloudApplication.class, args);</span></div>
<div style="position:absolute;left:429.21px;top:315.23px" class="cls_067"><span class="cls_067">Runs the</span></div>
<div style="position:absolute;left:111.78px;top:321.74px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:429.21px;top:324.71px" class="cls_067"><span class="cls_067">application</span></div>
<div style="position:absolute;left:102.18px;top:341.75px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:363.08px" class="cls_039"><span class="cls_039">Although there’s little code in </span><span class="cls_059">TacoCloudApplication</span><span class="cls_039">, what’s there packs quite a</span></div>
<div style="position:absolute;left:102.18px;top:376.07px" class="cls_039"><span class="cls_039">punch. One of the most powerful lines of code is also one of the shortest. The</span></div>
<div style="position:absolute;left:102.18px;top:389.06px" class="cls_059"><span class="cls_059">@SpringBootApplication</span><span class="cls_039"> annotation clearly signifies that this is a Spring Boot appli-</span></div>
<div style="position:absolute;left:102.18px;top:402.08px" class="cls_039"><span class="cls_039">cation. But there’s more to </span><span class="cls_059">@SpringBootApplication</span><span class="cls_039"> than meets the eye.</span></div>
<div style="position:absolute;left:118.23px;top:415.07px" class="cls_059"><span class="cls_059">@SpringBootApplication</span><span class="cls_039"> is a composite application that combines three other</span></div>
<div style="position:absolute;left:102.18px;top:428.06px" class="cls_039"><span class="cls_039">annotations:</span></div>
<div style="position:absolute;left:117.78px;top:446.57px" class="cls_062"><span class="cls_062"></span></div>
<div style="position:absolute;left:129.78px;top:445.07px" class="cls_059"><span class="cls_059">@SpringBootConfiguration</span><span class="cls_039">—Designates this class as a configuration class.</span></div>
<div style="position:absolute;left:129.78px;top:458.06px" class="cls_039"><span class="cls_039">Although there’s not much configuration in the class yet, you can add Java-</span></div>
<div style="position:absolute;left:129.78px;top:471.08px" class="cls_039"><span class="cls_039">based Spring Framework configuration to this class if you need to. This annota-</span></div>
<div style="position:absolute;left:129.78px;top:484.07px" class="cls_039"><span class="cls_039">tion is, in fact, a specialized form of the </span><span class="cls_059">@Configuration</span><span class="cls_039"> annotation.</span></div>
<div style="position:absolute;left:117.78px;top:499.58px" class="cls_062"><span class="cls_062"></span></div>
<div style="position:absolute;left:129.78px;top:498.08px" class="cls_059"><span class="cls_059">@EnableAutoConfiguration</span><span class="cls_039">—Enables Spring Boot automatic configuration.</span></div>
<div style="position:absolute;left:129.78px;top:511.07px" class="cls_039"><span class="cls_039">We’ll talk more about autoconfiguration later. For now, know that this annota-</span></div>
<div style="position:absolute;left:129.78px;top:524.06px" class="cls_039"><span class="cls_039">tion tells Spring Boot to automatically configure any components that it thinks</span></div>
<div style="position:absolute;left:129.78px;top:537.08px" class="cls_039"><span class="cls_039">you’ll need.</span></div>
<div style="position:absolute;left:117.78px;top:552.59px" class="cls_062"><span class="cls_062"></span></div>
<div style="position:absolute;left:129.78px;top:551.09px" class="cls_059"><span class="cls_059">@ComponentScan</span><span class="cls_039">—Enables component scanning. This lets you declare other</span></div>
<div style="position:absolute;left:129.78px;top:564.08px" class="cls_039"><span class="cls_039">classes with annotations like </span><span class="cls_059">@Component</span><span class="cls_039">, </span><span class="cls_059">@Controller</span><span class="cls_039">, </span><span class="cls_059">@Service</span><span class="cls_039">, and others,</span></div>
<div style="position:absolute;left:129.78px;top:577.07px" class="cls_039"><span class="cls_039">to have Spring automatically discover them and register them as components in</span></div>
<div style="position:absolute;left:129.78px;top:590.09px" class="cls_039"><span class="cls_039">the Spring application context.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:23656px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background038.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">16</span></div>
<div style="position:absolute;left:190.50px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 1</span></div>
<div style="position:absolute;left:234.63px;top:24.35px" class="cls_055"><span class="cls_055">Getting started with Spring</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">The other important piece of </span><span class="cls_059">TacoCloudApplication</span><span class="cls_039"> is the </span><span class="cls_059">main()</span><span class="cls_039"> method. This is the</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">method that will be run when the JAR file is executed. For the most part, this method is</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">boilerplate code; every Spring Boot application you write will have a method similar or</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">identical to this one (class name differences notwithstanding).</span></div>
<div style="position:absolute;left:108.30px;top:102.65px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">main()</span><span class="cls_039"> method calls a static </span><span class="cls_059">run()</span><span class="cls_039"> method on the </span><span class="cls_059">SpringApplication</span><span class="cls_039"> class,</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">which performs the actual bootstrapping of the application, creating the Spring appli-</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">cation context. The two parameters passed to the </span><span class="cls_059">run()</span><span class="cls_039"> method are a configuration</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">class and the command-line arguments. Although it’s not necessary that the configu-</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_039"><span class="cls_039">ration class passed to </span><span class="cls_059">run()</span><span class="cls_039"> be the same as the bootstrap class, this is the most conve-</span></div>
<div style="position:absolute;left:93.18px;top:167.66px" class="cls_039"><span class="cls_039">nient and typical choice.</span></div>
<div style="position:absolute;left:107.99px;top:180.65px" class="cls_039"><span class="cls_039">Chances are you won’t need to change anything in the bootstrap class. For simple</span></div>
<div style="position:absolute;left:93.18px;top:193.67px" class="cls_039"><span class="cls_039">applications, you might find it convenient to configure one or two other components</span></div>
<div style="position:absolute;left:93.18px;top:206.66px" class="cls_039"><span class="cls_039">in the bootstrap class, but for most applications, you’re better off creating a separate</span></div>
<div style="position:absolute;left:93.18px;top:219.65px" class="cls_039"><span class="cls_039">configuration class for anything that isn’t autoconfigured. You’ll define several config-</span></div>
<div style="position:absolute;left:93.18px;top:232.67px" class="cls_039"><span class="cls_039">uration classes throughout the course of this book, so stay tuned for details.</span></div>
<div style="position:absolute;left:93.18px;top:250.85px" class="cls_064"><span class="cls_064">T</span><span class="cls_065">ESTING</span><span class="cls_064"> </span><span class="cls_065">THE</span><span class="cls_064"> </span><span class="cls_065">APPLICATION</span></div>
<div style="position:absolute;left:93.18px;top:263.15px" class="cls_039"><span class="cls_039">Testing is an important part of software development. Recognizing this, the Spring</span></div>
<div style="position:absolute;left:93.18px;top:276.17px" class="cls_039"><span class="cls_039">Initializr gives you a test class to get started. The following listing shows the baseline</span></div>
<div style="position:absolute;left:93.18px;top:289.16px" class="cls_039"><span class="cls_039">test class.</span></div>
<div style="position:absolute;left:105.18px;top:315.89px" class="cls_066"><span class="cls_066">Listing 1.3</span></div>
<div style="position:absolute;left:157.27px;top:315.89px" class="cls_066"><span class="cls_066">A baseline application test</span></div>
<div style="position:absolute;left:93.18px;top:335.75px" class="cls_060"><span class="cls_060">package tacos;</span></div>
<div style="position:absolute;left:93.18px;top:355.73px" class="cls_060"><span class="cls_060">import org.junit.Test;</span></div>
<div style="position:absolute;left:93.18px;top:365.75px" class="cls_060"><span class="cls_060">import org.junit.runner.RunWith;</span></div>
<div style="position:absolute;left:93.18px;top:375.74px" class="cls_060"><span class="cls_060">import org.springframework.boot.test.context.SpringBootTest;</span></div>
<div style="position:absolute;left:93.18px;top:385.76px" class="cls_060"><span class="cls_060">import org.springframework.test.context.junit4.SpringRunner;</span></div>
<div style="position:absolute;left:342.39px;top:399.53px" class="cls_067"><span class="cls_067">Uses the</span></div>
<div style="position:absolute;left:93.18px;top:405.74px" class="cls_060"><span class="cls_060">@RunWith(SpringRunner.class)</span></div>
<div style="position:absolute;left:342.39px;top:409.04px" class="cls_067"><span class="cls_067">Spring runner</span></div>
<div style="position:absolute;left:93.18px;top:415.76px" class="cls_060"><span class="cls_060">@SpringBootTest</span></div>
<div style="position:absolute;left:93.18px;top:425.75px" class="cls_060"><span class="cls_060">public class TacoCloudApplicationTests {</span></div>
<div style="position:absolute;left:310.50px;top:428.72px" class="cls_067"><span class="cls_067">A Spring</span></div>
<div style="position:absolute;left:310.50px;top:438.23px" class="cls_067"><span class="cls_067">Boot test</span></div>
<div style="position:absolute;left:102.78px;top:445.76px" class="cls_060"><span class="cls_060">@Test</span></div>
<div style="position:absolute;left:102.78px;top:455.75px" class="cls_060"><span class="cls_060">public void contextLoads() {</span></div>
<div style="position:absolute;left:265.05px;top:452.48px" class="cls_067"><span class="cls_067">The test</span></div>
<div style="position:absolute;left:265.05px;top:461.96px" class="cls_067"><span class="cls_067">method</span></div>
<div style="position:absolute;left:102.78px;top:465.74px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:485.75px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:509.06px" class="cls_039"><span class="cls_039">There’s not much to be seen in </span><span class="cls_059">TacoCloudApplicationTests</span><span class="cls_039">: the one test method in</span></div>
<div style="position:absolute;left:93.18px;top:522.08px" class="cls_039"><span class="cls_039">the class is empty. Even so, this test class does perform an essential check to ensure</span></div>
<div style="position:absolute;left:93.18px;top:535.07px" class="cls_039"><span class="cls_039">that the Spring application context can be loaded successfully. If you make any</span></div>
<div style="position:absolute;left:93.18px;top:548.06px" class="cls_039"><span class="cls_039">changes that prevent the Spring application context from being created, this test fails,</span></div>
<div style="position:absolute;left:93.18px;top:561.08px" class="cls_039"><span class="cls_039">and you can react by fixing the problem.</span></div>
<div style="position:absolute;left:107.92px;top:574.07px" class="cls_039"><span class="cls_039">Also notice the class annotated with </span><span class="cls_059">@RunWith(SpringRunner.class)</span><span class="cls_039">. </span><span class="cls_059">@RunWith</span><span class="cls_039"> is</span></div>
<div style="position:absolute;left:93.18px;top:587.09px" class="cls_039"><span class="cls_039">a JUnit annotation, providing a test runner that guides JUnit in running a test. Think</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:24332px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background039.jpg" width="531" height="666"></div>
<div style="position:absolute;left:218.40px;top:24.35px" class="cls_055"><span class="cls_055">Writing a Spring application</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">17</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">of it as applying a plugin to JUnit to provide custom testing behavior. In this case,</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">JUnit is given </span><span class="cls_059">SpringRunner</span><span class="cls_039">, a Spring-provided test runner that provides for the cre-</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">ation of a Spring application context that the test will run against.</span></div>
<div style="position:absolute;left:102.18px;top:96.83px" class="cls_064"><span class="cls_064">A </span><span class="cls_065">TEST</span><span class="cls_064"> </span><span class="cls_065">RUNNER</span><span class="cls_064"> </span><span class="cls_065">BY</span><span class="cls_064"> </span><span class="cls_065">ANY</span><span class="cls_064"> </span><span class="cls_065">OTHER</span><span class="cls_064"> </span><span class="cls_065">NAME</span><span class="cls_064">...</span></div>
<div style="position:absolute;left:102.18px;top:110.15px" class="cls_039"><span class="cls_039">If you’re already familiar with writing Spring tests or are maybe looking at some exist-</span></div>
<div style="position:absolute;left:102.18px;top:123.17px" class="cls_039"><span class="cls_039">ing Spring-based test classes, you may have seen a test runner named </span><span class="cls_059">SpringJUnit4-</span></div>
<div style="position:absolute;left:102.18px;top:136.16px" class="cls_059"><span class="cls_059">ClassRunner</span><span class="cls_039">. </span><span class="cls_059"> SpringRunner</span><span class="cls_039">  is  an  alias  for </span><span class="cls_059"> SpringJUnit4ClassRunner</span><span class="cls_039">,  and  was</span></div>
<div style="position:absolute;left:102.18px;top:149.15px" class="cls_039"><span class="cls_039">introduced in Spring 4.3 to remove the association with a specific version of JUnit (for</span></div>
<div style="position:absolute;left:102.18px;top:162.17px" class="cls_039"><span class="cls_039">example, JUnit 4). And there’s no denying that the alias is easier to read and type.</span></div>
<div style="position:absolute;left:117.42px;top:175.16px" class="cls_059"><span class="cls_059">@SpringBootTest</span><span class="cls_039"> tells JUnit to bootstrap the test with Spring Boot capabilities.</span></div>
<div style="position:absolute;left:102.18px;top:188.15px" class="cls_039"><span class="cls_039">For now, it’s enough to think of this as the test class equivalent of calling </span><span class="cls_059">Spring-</span></div>
<div style="position:absolute;left:102.27px;top:201.17px" class="cls_059"><span class="cls_059">Application.run()</span><span class="cls_039"> in a </span><span class="cls_059">main()</span><span class="cls_039"> method. Over the course of this book, you’ll see</span></div>
<div style="position:absolute;left:102.18px;top:214.16px" class="cls_059"><span class="cls_059">@SpringBootTest</span><span class="cls_039"> several times, and we’ll uncover some of its power.</span></div>
<div style="position:absolute;left:117.65px;top:227.15px" class="cls_039"><span class="cls_039">Finally, there’s the test method itself. Although </span><span class="cls_059">@RunWith(SpringRunner.class)</span></div>
<div style="position:absolute;left:102.18px;top:240.17px" class="cls_039"><span class="cls_039">and </span><span class="cls_059">@SpringBootTest</span><span class="cls_039"> are tasked to load the Spring application context for the test,</span></div>
<div style="position:absolute;left:102.18px;top:253.16px" class="cls_039"><span class="cls_039">they won’t have anything to do if there aren’t any test methods. Even without any</span></div>
<div style="position:absolute;left:102.18px;top:266.15px" class="cls_039"><span class="cls_039">assertions or code of any kind, this empty test method will prompt the two annotations</span></div>
<div style="position:absolute;left:102.18px;top:279.17px" class="cls_039"><span class="cls_039">to do their job and load the Spring application context. If there are any problems in</span></div>
<div style="position:absolute;left:102.18px;top:292.16px" class="cls_039"><span class="cls_039">doing so, the test fails.</span></div>
<div style="position:absolute;left:117.21px;top:305.18px" class="cls_039"><span class="cls_039">At this point, we’ve concluded our review of the code provided by the Spring Ini-</span></div>
<div style="position:absolute;left:102.18px;top:318.17px" class="cls_039"><span class="cls_039">tializr. You’ve seen some of the boilerplate foundation that you can use to develop a</span></div>
<div style="position:absolute;left:102.18px;top:331.16px" class="cls_039"><span class="cls_039">Spring application, but you still haven’t written a single line of code. Now it’s time to</span></div>
<div style="position:absolute;left:102.18px;top:344.18px" class="cls_039"><span class="cls_039">fire up your IDE, dust off your keyboard, and add some custom code to the Taco</span></div>
<div style="position:absolute;left:102.18px;top:357.17px" class="cls_039"><span class="cls_039">Cloud application.</span></div>
<div style="position:absolute;left:66.18px;top:382.33px" class="cls_040"><span class="cls_040">1.3</span></div>
<div style="position:absolute;left:102.18px;top:382.33px" class="cls_040"><span class="cls_040">Writing a Spring application</span></div>
<div style="position:absolute;left:102.18px;top:401.66px" class="cls_039"><span class="cls_039">Because you’re just getting started, we’ll start off with a relatively small change to</span></div>
<div style="position:absolute;left:102.18px;top:414.68px" class="cls_039"><span class="cls_039">the Taco Cloud application, but one that will demonstrate a lot of Spring’s good-</span></div>
<div style="position:absolute;left:102.18px;top:427.67px" class="cls_039"><span class="cls_039">ness. It seems appropriate that as you’re just starting, the first feature you’ll add to</span></div>
<div style="position:absolute;left:102.18px;top:440.66px" class="cls_039"><span class="cls_039">the Taco Cloud application is a homepage. As you add the homepage, you’ll create</span></div>
<div style="position:absolute;left:102.18px;top:453.68px" class="cls_039"><span class="cls_039">two code artifacts:</span></div>
<div style="position:absolute;left:117.78px;top:472.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  A controller class that handles requests for the homepage</span></div>
<div style="position:absolute;left:117.78px;top:486.68px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  A view template that defines what the homepage looks like</span></div>
<div style="position:absolute;left:102.18px;top:506.66px" class="cls_039"><span class="cls_039">And because testing is important, you’ll also write a simple test class to test the home-</span></div>
<div style="position:absolute;left:102.18px;top:519.68px" class="cls_039"><span class="cls_039">page. But first things first ... let’s write that controller.</span></div>
<div style="position:absolute;left:66.18px;top:544.49px" class="cls_063"><span class="cls_063">1.3.1</span></div>
<div style="position:absolute;left:102.18px;top:544.49px" class="cls_063"><span class="cls_063">Handling web requests</span></div>
<div style="position:absolute;left:102.18px;top:562.19px" class="cls_039"><span class="cls_039">Spring comes with a powerful web framework known as Spring MVC. At the center of</span></div>
<div style="position:absolute;left:102.18px;top:575.18px" class="cls_039"><span class="cls_039">Spring MVC is the concept of a </span><span class="cls_036">controller</span><span class="cls_039">, a class that handles requests and responds</span></div>
<div style="position:absolute;left:102.18px;top:588.17px" class="cls_039"><span class="cls_039">with information of some sort. In the case of a browser-facing application, a controller</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:25008px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background040.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">18</span></div>
<div style="position:absolute;left:190.50px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 1</span></div>
<div style="position:absolute;left:234.63px;top:24.35px" class="cls_055"><span class="cls_055">Getting started with Spring</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">responds by optionally populating model data and passing the request on to a view to</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">produce HTML that’s returned to the browser.</span></div>
<div style="position:absolute;left:108.93px;top:76.67px" class="cls_039"><span class="cls_039">You’re going to learn a lot about Spring MVC in chapter 2. But for now, you’ll</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">write a simple controller class that handles requests for the root path (for example, </span><span class="cls_059">/</span><span class="cls_039">)</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">and forwards those requests to the homepage view without populating any model</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">data. The following listing shows the simple controller class.</span></div>
<div style="position:absolute;left:105.18px;top:139.37px" class="cls_066"><span class="cls_066">Listing 1.4</span></div>
<div style="position:absolute;left:157.26px;top:139.37px" class="cls_066"><span class="cls_066">The homepage controller</span></div>
<div style="position:absolute;left:93.18px;top:159.23px" class="cls_060"><span class="cls_060">package tacos;</span></div>
<div style="position:absolute;left:93.18px;top:179.24px" class="cls_060"><span class="cls_060">import org.springframework.stereotype.Controller;</span></div>
<div style="position:absolute;left:93.18px;top:189.23px" class="cls_060"><span class="cls_060">import org.springframework.web.bind.annotation.GetMapping;</span></div>
<div style="position:absolute;left:93.18px;top:209.24px" class="cls_060"><span class="cls_060">@Controller</span></div>
<div style="position:absolute;left:269.52px;top:209.12px" class="cls_067"><span class="cls_067">The controller</span></div>
<div style="position:absolute;left:93.18px;top:219.23px" class="cls_060"><span class="cls_060">public class HomeController {</span></div>
<div style="position:absolute;left:250.50px;top:233.96px" class="cls_067"><span class="cls_067">Handles requests</span></div>
<div style="position:absolute;left:102.78px;top:239.24px" class="cls_060"><span class="cls_060">@GetMapping("/")</span></div>
<div style="position:absolute;left:250.50px;top:243.47px" class="cls_067"><span class="cls_067">for the root path /</span></div>
<div style="position:absolute;left:102.78px;top:249.23px" class="cls_060"><span class="cls_060">public String home() {</span></div>
<div style="position:absolute;left:112.38px;top:259.25px" class="cls_060"><span class="cls_060">return "home";</span></div>
<div style="position:absolute;left:236.22px;top:262.52px" class="cls_067"><span class="cls_067">Returns the</span></div>
<div style="position:absolute;left:102.78px;top:269.24px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:236.22px;top:272.03px" class="cls_067"><span class="cls_067">view name</span></div>
<div style="position:absolute;left:93.18px;top:289.25px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:310.58px" class="cls_039"><span class="cls_039">As you can see, this class is annotated with </span><span class="cls_059">@Controller</span><span class="cls_039">. On its own, </span><span class="cls_059">@Controller</span></div>
<div style="position:absolute;left:93.18px;top:323.57px" class="cls_039"><span class="cls_039">doesn’t do much. Its primary purpose is to identify this class as a component for com-</span></div>
<div style="position:absolute;left:93.18px;top:336.56px" class="cls_039"><span class="cls_039">ponent scanning. Because </span><span class="cls_059">HomeController</span><span class="cls_039"> is annotated with </span><span class="cls_059">@Controller</span><span class="cls_039">, Spring’s</span></div>
<div style="position:absolute;left:93.18px;top:349.58px" class="cls_039"><span class="cls_039">component scanning automatically discovers it and creates an instance of </span><span class="cls_059">Home-</span></div>
<div style="position:absolute;left:93.18px;top:362.57px" class="cls_059"><span class="cls_059">Controller</span><span class="cls_039"> as a bean in the Spring application context.</span></div>
<div style="position:absolute;left:109.60px;top:375.56px" class="cls_039"><span class="cls_039">In fact, a handful of other annotations (including </span><span class="cls_059">@Component</span><span class="cls_039">, </span><span class="cls_059">@Service</span><span class="cls_039">, and</span></div>
<div style="position:absolute;left:93.18px;top:388.58px" class="cls_059"><span class="cls_059">@Repository</span><span class="cls_039">) serve a purpose similar to </span><span class="cls_059">@Controller</span><span class="cls_039">. You could have just as effec-</span></div>
<div style="position:absolute;left:93.18px;top:401.57px" class="cls_039"><span class="cls_039">tively annotated </span><span class="cls_059">HomeController</span><span class="cls_039"> with any of those other annotations, and it would</span></div>
<div style="position:absolute;left:93.18px;top:414.56px" class="cls_039"><span class="cls_039">have still worked the same. The choice of </span><span class="cls_059">@Controller</span><span class="cls_039"> is, however, more descriptive</span></div>
<div style="position:absolute;left:93.18px;top:427.58px" class="cls_039"><span class="cls_039">of this component’s role in the application.</span></div>
<div style="position:absolute;left:108.39px;top:440.57px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">home()</span><span class="cls_039"> method is as simple as controller methods come. It’s annotated with</span></div>
<div style="position:absolute;left:93.18px;top:453.56px" class="cls_059"><span class="cls_059">@GetMapping</span><span class="cls_039"> to indicate that if an HTTP GET request is received for the root path /,</span></div>
<div style="position:absolute;left:93.18px;top:466.58px" class="cls_039"><span class="cls_039">then this method should handle that request. It does so by doing nothing more than</span></div>
<div style="position:absolute;left:93.18px;top:479.57px" class="cls_039"><span class="cls_039">returning a </span><span class="cls_059">String</span><span class="cls_039"> value of </span><span class="cls_059">home</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:109.09px;top:492.56px" class="cls_039"><span class="cls_039">This value is interpreted as the logical name of a view. How that view is imple-</span></div>
<div style="position:absolute;left:93.18px;top:505.58px" class="cls_039"><span class="cls_039">mented depends on a few factors, but because Thymeleaf is in your classpath, you can</span></div>
<div style="position:absolute;left:93.18px;top:518.57px" class="cls_039"><span class="cls_039">define that template with Thymeleaf.</span></div>
<div style="position:absolute;left:93.18px;top:536.75px" class="cls_064"><span class="cls_064">W</span><span class="cls_065">HY</span><span class="cls_064"> T</span><span class="cls_065">HYMELEAF</span><span class="cls_064">?</span></div>
<div style="position:absolute;left:93.18px;top:549.08px" class="cls_039"><span class="cls_039">You may be wondering why you chose Thymeleaf for a template engine. Why not JSP?</span></div>
<div style="position:absolute;left:93.18px;top:562.07px" class="cls_039"><span class="cls_039">Why not FreeMarker? Why not one of several other options?</span></div>
<div style="position:absolute;left:107.54px;top:575.09px" class="cls_039"><span class="cls_039">Put simply, I had to choose something, and I like Thymeleaf and generally prefer it</span></div>
<div style="position:absolute;left:93.18px;top:588.08px" class="cls_039"><span class="cls_039">over those other options. And even though JSP may seem like an obvious choice,</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:25684px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background041.jpg" width="531" height="666"></div>
<div style="position:absolute;left:218.40px;top:24.35px" class="cls_055"><span class="cls_055">Writing a Spring application</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">19</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">there are some challenges to overcome when using JSP with Spring Boot. I didn’t want</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">to go down that rabbit hole in chapter 1. Hang tight. We’ll look at other template</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">options, including JSP, in chapter 2.</span></div>
<div style="position:absolute;left:118.44px;top:89.66px" class="cls_039"><span class="cls_039">The template name is derived from the logical view name by prefixing it with</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">/templates/ and postfixing it with .html. The resulting path for the template is</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">/templates/home.html. Therefore, you’ll need to place the template in your project</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">at /src/main/resources/templates/home.html. Let’s create that template now.</span></div>
<div style="position:absolute;left:66.18px;top:150.47px" class="cls_063"><span class="cls_063">1.3.2</span></div>
<div style="position:absolute;left:102.18px;top:150.47px" class="cls_063"><span class="cls_063">Defining the view</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">In the interest of keeping your homepage simple, it should do nothing more than wel-</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">come users to the site. The next listing shows the basic Thymeleaf template that</span></div>
<div style="position:absolute;left:102.18px;top:193.67px" class="cls_039"><span class="cls_039">defines the Taco Cloud homepage.</span></div>
<div style="position:absolute;left:114.18px;top:217.40px" class="cls_066"><span class="cls_066">Listing 1.5</span></div>
<div style="position:absolute;left:166.26px;top:217.40px" class="cls_066"><span class="cls_066">The Taco Cloud homepage template</span></div>
<div style="position:absolute;left:102.18px;top:237.23px" class="cls_060"><span class="cls_060">&lt;!DOCTYPE html&gt;</span></div>
<div style="position:absolute;left:102.18px;top:247.25px" class="cls_060"><span class="cls_060">&lt;html xmlns="</span><a href="http://www.w3.org/1999/xhtml" "="">http://www.w3.org/1999/xhtml"</a> </div>
<div style="position:absolute;left:130.95px;top:257.24px" class="cls_060"><span class="cls_060">xmlns:th="</span><a href="http://www.thymeleaf.org/" "="">http://www.thymeleaf.org"</a>&gt;</div>
<div style="position:absolute;left:111.78px;top:267.23px" class="cls_060"><span class="cls_060">&lt;head&gt;</span></div>
<div style="position:absolute;left:121.38px;top:277.25px" class="cls_060"><span class="cls_060">&lt;title&gt;Taco Cloud&lt;/title&gt;</span></div>
<div style="position:absolute;left:111.78px;top:287.24px" class="cls_060"><span class="cls_060">&lt;/head&gt;</span></div>
<div style="position:absolute;left:111.78px;top:307.25px" class="cls_060"><span class="cls_060">&lt;body&gt;</span></div>
<div style="position:absolute;left:121.38px;top:317.24px" class="cls_060"><span class="cls_060">&lt;h1&gt;Welcome to...&lt;/h1&gt;</span></div>
<div style="position:absolute;left:121.38px;top:327.23px" class="cls_060"><span class="cls_060">&lt;img th:src="@{/images/TacoCloud.png}"/&gt;</span></div>
<div style="position:absolute;left:111.78px;top:337.25px" class="cls_060"><span class="cls_060">&lt;/body&gt;</span></div>
<div style="position:absolute;left:102.18px;top:347.24px" class="cls_061"><span class="cls_061">&lt;/html&gt;</span></div>
<div style="position:absolute;left:102.18px;top:368.57px" class="cls_039"><span class="cls_039">There’s not much to discuss with regard to this template. The only notable line of</span></div>
<div style="position:absolute;left:102.18px;top:381.56px" class="cls_039"><span class="cls_039">code is the one with the </span><span class="cls_059">&lt;img&gt;</span><span class="cls_039"> tag to display the Taco Cloud logo. It uses a Thymeleaf</span></div>
<div style="position:absolute;left:102.18px;top:394.58px" class="cls_059"><span class="cls_059">th:src</span><span class="cls_039"> attribute and an </span><span class="cls_059">@{...}</span><span class="cls_039"> expression to reference the image with a context-</span></div>
<div style="position:absolute;left:102.18px;top:407.57px" class="cls_039"><span class="cls_039">relative path. Aside from that, it’s not much more than a Hello World page.</span></div>
<div style="position:absolute;left:117.40px;top:420.56px" class="cls_039"><span class="cls_039">But let’s talk about that image a bit more. I’ll leave it up to you to define a Taco</span></div>
<div style="position:absolute;left:102.18px;top:433.58px" class="cls_039"><span class="cls_039">Cloud logo that you like. You’ll need to make sure you place it at the right place</span></div>
<div style="position:absolute;left:102.18px;top:446.57px" class="cls_039"><span class="cls_039">within the project.</span></div>
<div style="position:absolute;left:117.58px;top:459.56px" class="cls_039"><span class="cls_039">The image is referenced with the context-relative path /images/TacoCloud.png.</span></div>
<div style="position:absolute;left:102.18px;top:472.58px" class="cls_039"><span class="cls_039">As you’ll recall from our review of the project structure, static content such as images</span></div>
<div style="position:absolute;left:102.18px;top:485.57px" class="cls_039"><span class="cls_039">is kept in the /src/main/resources/static folder. That means that the Taco Cloud</span></div>
<div style="position:absolute;left:102.18px;top:498.56px" class="cls_039"><span class="cls_039">logo image must also reside within the project at /src/main/resources/static/images/</span></div>
<div style="position:absolute;left:102.18px;top:511.58px" class="cls_039"><span class="cls_039">TacoCloud.png.</span></div>
<div style="position:absolute;left:117.20px;top:524.57px" class="cls_039"><span class="cls_039">Now that you’ve got a controller to handle requests for the homepage and a view</span></div>
<div style="position:absolute;left:102.18px;top:537.56px" class="cls_039"><span class="cls_039">template to render the homepage, you’re almost ready to fire up the application and</span></div>
<div style="position:absolute;left:102.18px;top:550.58px" class="cls_039"><span class="cls_039">see it in action. But first, let’s see how you can write a test against the controller.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:26360px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background042.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">20</span></div>
<div style="position:absolute;left:190.50px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 1</span></div>
<div style="position:absolute;left:234.63px;top:24.35px" class="cls_055"><span class="cls_055">Getting started with Spring</span></div>
<div style="position:absolute;left:57.18px;top:50.48px" class="cls_063"><span class="cls_063">1.3.3</span></div>
<div style="position:absolute;left:93.18px;top:50.48px" class="cls_063"><span class="cls_063">Testing the controller</span></div>
<div style="position:absolute;left:93.18px;top:67.67px" class="cls_039"><span class="cls_039">Testing web applications can be tricky when making assertions against the content of</span></div>
<div style="position:absolute;left:93.18px;top:80.66px" class="cls_039"><span class="cls_039">an HTML page. Fortunately, Spring comes with some powerful test support that</span></div>
<div style="position:absolute;left:93.18px;top:93.65px" class="cls_039"><span class="cls_039">makes testing a web application easy.</span></div>
<div style="position:absolute;left:108.70px;top:106.67px" class="cls_039"><span class="cls_039">For the purposes of the homepage, you’ll write a test that’s comparable in com-</span></div>
<div style="position:absolute;left:93.18px;top:119.66px" class="cls_039"><span class="cls_039">plexity to the homepage itself. Your test will perform an HTTP GET request for the</span></div>
<div style="position:absolute;left:93.18px;top:132.65px" class="cls_039"><span class="cls_039">root path / and expect a successful result where the view name is home and the result-</span></div>
<div style="position:absolute;left:93.18px;top:145.67px" class="cls_039"><span class="cls_039">ing content contains the phrase “Welcome to...”. The following should do the trick.</span></div>
<div style="position:absolute;left:105.18px;top:172.37px" class="cls_066"><span class="cls_066">Listing 1.6</span></div>
<div style="position:absolute;left:157.26px;top:172.37px" class="cls_066"><span class="cls_066">A test for the homepage controller</span></div>
<div style="position:absolute;left:93.18px;top:192.23px" class="cls_060"><span class="cls_060">package tacos;</span></div>
<div style="position:absolute;left:93.18px;top:214.25px" class="cls_060"><span class="cls_060">import static org.hamcrest.Matchers.containsString;</span></div>
<div style="position:absolute;left:93.18px;top:224.24px" class="cls_060"><span class="cls_060">import static</span></div>
<div style="position:absolute;left:117.18px;top:234.23px" class="cls_060"><span class="cls_060">org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;</span></div>
<div style="position:absolute;left:93.18px;top:244.25px" class="cls_060"><span class="cls_060">import static</span></div>
<div style="position:absolute;left:117.18px;top:254.24px" class="cls_060"><span class="cls_060">org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;</span></div>
<div style="position:absolute;left:93.18px;top:264.23px" class="cls_060"><span class="cls_060">import static</span></div>
<div style="position:absolute;left:117.18px;top:274.25px" class="cls_060"><span class="cls_060">org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;</span></div>
<div style="position:absolute;left:93.18px;top:284.24px" class="cls_060"><span class="cls_060">import static</span></div>
<div style="position:absolute;left:117.18px;top:294.23px" class="cls_060"><span class="cls_060">org.springframework.test.web.servlet.result.MockMvcResultMatchers.view;</span></div>
<div style="position:absolute;left:93.18px;top:316.25px" class="cls_060"><span class="cls_060">import org.junit.Test;</span></div>
<div style="position:absolute;left:93.18px;top:326.24px" class="cls_060"><span class="cls_060">import org.junit.runner.RunWith;</span></div>
<div style="position:absolute;left:93.18px;top:336.23px" class="cls_060"><span class="cls_060">import org.springframework.beans.factory.annotation.Autowired;</span></div>
<div style="position:absolute;left:93.18px;top:346.25px" class="cls_060"><span class="cls_060">import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;</span></div>
<div style="position:absolute;left:93.18px;top:356.24px" class="cls_060"><span class="cls_060">import org.springframework.test.context.junit4.SpringRunner;</span></div>
<div style="position:absolute;left:93.18px;top:366.23px" class="cls_060"><span class="cls_060">import org.springframework.test.web.servlet.MockMvc;</span></div>
<div style="position:absolute;left:93.18px;top:388.25px" class="cls_060"><span class="cls_060">@RunWith(SpringRunner.class)</span></div>
<div style="position:absolute;left:93.18px;top:398.24px" class="cls_060"><span class="cls_060">@WebMvcTest(HomeController.class)</span></div>
<div style="position:absolute;left:291.93px;top:401.54px" class="cls_067"><span class="cls_067">Web test for</span></div>
<div style="position:absolute;left:93.18px;top:408.26px" class="cls_060"><span class="cls_060">public class HomeControllerTest {</span></div>
<div style="position:absolute;left:291.93px;top:411.05px" class="cls_067"><span class="cls_067">HomeController</span></div>
<div style="position:absolute;left:102.45px;top:430.25px" class="cls_060"><span class="cls_060">@Autowired</span></div>
<div style="position:absolute;left:102.46px;top:440.24px" class="cls_060"><span class="cls_060">private MockMvc mockMvc;</span></div>
<div style="position:absolute;left:273.00px;top:439.88px" class="cls_067"><span class="cls_067">Injects MockMvc</span></div>
<div style="position:absolute;left:102.45px;top:462.26px" class="cls_060"><span class="cls_060">@Test</span></div>
<div style="position:absolute;left:102.43px;top:472.25px" class="cls_060"><span class="cls_060">public void testHomePage() throws Exception {</span></div>
<div style="position:absolute;left:111.72px;top:482.24px" class="cls_060"><span class="cls_060">mockMvc.perform(get("/"))</span></div>
<div style="position:absolute;left:341.55px;top:481.88px" class="cls_067"><span class="cls_067">Performs GET /</span></div>
<div style="position:absolute;left:120.99px;top:504.26px" class="cls_060"><span class="cls_060">.andExpect(status().isOk())</span></div>
<div style="position:absolute;left:294.42px;top:503.87px" class="cls_067"><span class="cls_067">Expects HTTP 200</span></div>
<div style="position:absolute;left:120.99px;top:526.25px" class="cls_060"><span class="cls_060">.andExpect(view().name("home"))</span></div>
<div style="position:absolute;left:315.84px;top:525.89px" class="cls_067"><span class="cls_067">Expects home view</span></div>
<div style="position:absolute;left:120.99px;top:548.24px" class="cls_060"><span class="cls_060">.andExpect(content().string(</span></div>
<div style="position:absolute;left:341.55px;top:547.88px" class="cls_067"><span class="cls_067">Expects Welcome to...</span></div>
<div style="position:absolute;left:139.56px;top:558.26px" class="cls_060"><span class="cls_060">containsString("Welcome to...")));</span></div>
<div style="position:absolute;left:102.45px;top:568.25px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:588.26px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:27036px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background043.jpg" width="531" height="666"></div>
<div style="position:absolute;left:218.40px;top:24.35px" class="cls_055"><span class="cls_055">Writing a Spring application</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">21</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">The first thing you might notice about this test is that it differs slightly from the </span><span class="cls_059">Taco-</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_059"><span class="cls_059">CloudApplicationTests</span><span class="cls_039"> class with regard to the annotations applied to it. Instead of</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_059"><span class="cls_059">@SpringBootTest</span><span class="cls_039"> markup, </span><span class="cls_059">HomeControllerTest</span><span class="cls_039"> is annotated with </span><span class="cls_059">@WebMvcTest</span><span class="cls_039">. This</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">is a special test annotation provided by Spring Boot that arranges for the test to run in</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">the context of a Spring MVC application. More specifically, in this case, it arranges for</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_059"><span class="cls_059">HomeController</span><span class="cls_039"> to be registered in Spring MVC so that you can throw requests</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">against it.</span></div>
<div style="position:absolute;left:118.74px;top:141.65px" class="cls_059"><span class="cls_059">@WebMvcTest</span><span class="cls_039"> also sets up Spring support for testing Spring MVC. Although it</span></div>
<div style="position:absolute;left:102.18px;top:154.67px" class="cls_039"><span class="cls_039">could be made to start a server, mocking the mechanics of Spring MVC is sufficient for</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">your purposes. The test class is injected with a </span><span class="cls_059">MockMvc</span><span class="cls_039"> object for the test to drive the</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">mockup.</span></div>
<div style="position:absolute;left:118.38px;top:193.67px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">testHomePage()</span><span class="cls_039"> method defines the test you want to perform against the</span></div>
<div style="position:absolute;left:102.18px;top:206.66px" class="cls_039"><span class="cls_039">homepage. It starts with the </span><span class="cls_059">MockMvc</span><span class="cls_039"> object to perform an HTTP GET request for /</span></div>
<div style="position:absolute;left:102.18px;top:219.65px" class="cls_039"><span class="cls_039">(the root path). From that request, it sets the following expectations:</span></div>
<div style="position:absolute;left:117.78px;top:235.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  The response should have an HTTP 200 (OK) status.</span></div>
<div style="position:absolute;left:117.78px;top:249.65px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  The view should have a logical name of home.</span></div>
<div style="position:absolute;left:117.78px;top:263.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  The rendered view should contain the text “Welcome to</span></div>
<div style="position:absolute;left:384.29px;top:263.66px" class="cls_039"><span class="cls_039">”</span></div>
<div style="position:absolute;left:102.18px;top:281.66px" class="cls_039"><span class="cls_039">If, after the </span><span class="cls_059">MockMvc</span><span class="cls_039"> object performs the request, any of those expectations aren’t</span></div>
<div style="position:absolute;left:102.18px;top:294.68px" class="cls_039"><span class="cls_039">met, then the test fails. But your controller and view template are written to satisfy</span></div>
<div style="position:absolute;left:102.18px;top:307.67px" class="cls_039"><span class="cls_039">those expectations, so the test should pass with flying colors—or at least with some</span></div>
<div style="position:absolute;left:102.18px;top:320.66px" class="cls_039"><span class="cls_039">shade of green indicating a passing test.</span></div>
<div style="position:absolute;left:116.68px;top:333.68px" class="cls_039"><span class="cls_039">The controller has been written, the view template created, and you have a passing</span></div>
<div style="position:absolute;left:102.18px;top:346.67px" class="cls_039"><span class="cls_039">test. It seems that you’ve implemented the homepage successfully. But even though</span></div>
<div style="position:absolute;left:102.18px;top:359.66px" class="cls_039"><span class="cls_039">the test passes, there’s something slightly more satisfying with seeing the results in a</span></div>
<div style="position:absolute;left:102.18px;top:372.68px" class="cls_039"><span class="cls_039">browser. After all, that’s how Taco Cloud customers are going to see it. Let’s build the</span></div>
<div style="position:absolute;left:102.18px;top:385.67px" class="cls_039"><span class="cls_039">application and run it.</span></div>
<div style="position:absolute;left:66.18px;top:406.49px" class="cls_063"><span class="cls_063">1.3.4</span></div>
<div style="position:absolute;left:102.18px;top:406.49px" class="cls_063"><span class="cls_063">Building and running the application</span></div>
<div style="position:absolute;left:102.18px;top:423.68px" class="cls_039"><span class="cls_039">Just as there are several ways to initialize a Spring application, there are several ways to</span></div>
<div style="position:absolute;left:102.18px;top:436.67px" class="cls_039"><span class="cls_039">run one. If you like, you can flip over to the appendix to read about some of the more</span></div>
<div style="position:absolute;left:102.18px;top:449.66px" class="cls_039"><span class="cls_039">common ways to run a Spring Boot application.</span></div>
<div style="position:absolute;left:117.30px;top:462.68px" class="cls_039"><span class="cls_039">Because you chose to use Spring Tool Suite to initialize and work on the project,</span></div>
<div style="position:absolute;left:102.18px;top:475.67px" class="cls_039"><span class="cls_039">you have a handy feature called the Spring Boot Dashboard available to help you run</span></div>
<div style="position:absolute;left:102.18px;top:488.66px" class="cls_039"><span class="cls_039">your application inside the IDE. The Spring Boot Dashboard appears as a tab, typi-</span></div>
<div style="position:absolute;left:102.18px;top:501.68px" class="cls_039"><span class="cls_039">cally near the bottom left of the IDE window. Figure 1.7 shows an annotated screen-</span></div>
<div style="position:absolute;left:102.18px;top:514.67px" class="cls_039"><span class="cls_039">shot of the Spring Boot Dashboard.</span></div>
<div style="position:absolute;left:118.14px;top:527.66px" class="cls_039"><span class="cls_039">I don’t want to spend much time going over everything the Spring Boot Dash-</span></div>
<div style="position:absolute;left:102.18px;top:540.68px" class="cls_039"><span class="cls_039">board does, although figure 1.7 covers some of the most useful details. The important</span></div>
<div style="position:absolute;left:102.18px;top:553.67px" class="cls_039"><span class="cls_039">thing to know right now is how to use it to run the Taco Cloud application. Make sure</span></div>
<div style="position:absolute;left:102.18px;top:566.69px" class="cls_039"><span class="cls_039">taco-cloud application is highlighted in the list of projects (it’s the only application</span></div>
<div style="position:absolute;left:102.18px;top:579.68px" class="cls_039"><span class="cls_039">shown in figure 1.7), and then click the start button (the left-most button with both a</span></div>
<div style="position:absolute;left:102.18px;top:592.67px" class="cls_039"><span class="cls_039">green triangle and a red square). The application should start right up.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:27712px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background044.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">22</span></div>
<div style="position:absolute;left:190.50px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 1</span></div>
<div style="position:absolute;left:234.63px;top:24.35px" class="cls_055"><span class="cls_055">Getting started with Spring</span></div>
<div style="position:absolute;left:306.78px;top:51.28px" class="cls_068"><span class="cls_068">Opens a web browser</span></div>
<div style="position:absolute;left:213.28px;top:54.28px" class="cls_068"><span class="cls_068">Starts/restarts the</span></div>
<div style="position:absolute;left:318.31px;top:60.78px" class="cls_068"><span class="cls_068">on the running</span></div>
<div style="position:absolute;left:213.28px;top:63.78px" class="cls_068"><span class="cls_068">selected project</span></div>
<div style="position:absolute;left:325.13px;top:70.28px" class="cls_068"><span class="cls_068">application</span></div>
<div style="position:absolute;left:213.28px;top:73.28px" class="cls_068"><span class="cls_068">in debug mode</span></div>
<div style="position:absolute;left:282.75px;top:78.78px" class="cls_068"><span class="cls_068">Stops the</span></div>
<div style="position:absolute;left:361.70px;top:85.07px" class="cls_068"><span class="cls_068">Opens the console</span></div>
<div style="position:absolute;left:163.35px;top:89.59px" class="cls_068"><span class="cls_068">Starts/restarts the</span></div>
<div style="position:absolute;left:271.34px;top:88.28px" class="cls_068"><span class="cls_068">selected project</span></div>
<div style="position:absolute;left:367.48px;top:94.57px" class="cls_068"><span class="cls_068">on the running</span></div>
<div style="position:absolute;left:167.88px;top:99.09px" class="cls_068"><span class="cls_068">selected project</span></div>
<div style="position:absolute;left:374.30px;top:104.08px" class="cls_068"><span class="cls_068">application</span></div>
<div style="position:absolute;left:104.10px;top:214.43px" class="cls_068"><span class="cls_068">List of</span></div>
<div style="position:absolute;left:93.66px;top:223.93px" class="cls_068"><span class="cls_068">Spring Boot</span></div>
<div style="position:absolute;left:191.40px;top:223.51px" class="cls_068"><span class="cls_068">Indicates that the</span></div>
<div style="position:absolute;left:307.93px;top:223.51px" class="cls_068"><span class="cls_068">Indicates that the</span></div>
<div style="position:absolute;left:100.74px;top:233.43px" class="cls_068"><span class="cls_068">projects</span></div>
<div style="position:absolute;left:181.05px;top:233.01px" class="cls_068"><span class="cls_068">project has Spring Boot</span></div>
<div style="position:absolute;left:304.61px;top:233.01px" class="cls_068"><span class="cls_068">running application</span></div>
<div style="position:absolute;left:192.40px;top:242.51px" class="cls_068"><span class="cls_068">DevTools enabled</span></div>
<div style="position:absolute;left:295.64px;top:242.51px" class="cls_068"><span class="cls_068">is listening on port 8080</span></div>
<div style="position:absolute;left:93.18px;top:324.68px" class="cls_053"><span class="cls_053">Figure 1.7</span></div>
<div style="position:absolute;left:137.78px;top:324.68px" class="cls_053"><span class="cls_053">Highlights of the Spring Boot Dashboard</span></div>
<div style="position:absolute;left:93.18px;top:358.07px" class="cls_039"><span class="cls_039">As the application starts, you’ll see some Spring ASCII art fly by in the console, fol-</span></div>
<div style="position:absolute;left:93.18px;top:371.06px" class="cls_039"><span class="cls_039">lowed by some log entries describing the steps as the application starts. Before the log-</span></div>
<div style="position:absolute;left:93.18px;top:384.05px" class="cls_039"><span class="cls_039">ging stops, you’ll see a log entry saying Tomcat started on port(s): 8080 (http), which</span></div>
<div style="position:absolute;left:93.18px;top:397.07px" class="cls_039"><span class="cls_039">means that you’re ready to point your web browser at the homepage to see the fruits</span></div>
<div style="position:absolute;left:93.18px;top:410.06px" class="cls_039"><span class="cls_039">of your labor.</span></div>
<div style="position:absolute;left:107.78px;top:423.05px" class="cls_039"><span class="cls_039">Wait a minute. Tomcat started? When did you deploy the application to Tomcat?</span></div>
<div style="position:absolute;left:108.12px;top:436.07px" class="cls_039"><span class="cls_039">Spring Boot applications tend to bring everything they need with them and don’t</span></div>
<div style="position:absolute;left:93.18px;top:449.06px" class="cls_039"><span class="cls_039">need to be deployed to some application server. You never deployed your application</span></div>
<div style="position:absolute;left:93.18px;top:462.05px" class="cls_039"><span class="cls_039">to Tomcat ... Tomcat is a part of your application! (I’ll describe the details of how</span></div>
<div style="position:absolute;left:93.18px;top:475.07px" class="cls_039"><span class="cls_039">Tomcat became part of your application in section 1.3.6.)</span></div>
<div style="position:absolute;left:109.91px;top:488.06px" class="cls_039"><span class="cls_039">Now that the application has started, point your web browser to http:</span><span class="cls_045">//</span><span class="cls_039">local-</span></div>
<div style="position:absolute;left:93.18px;top:501.08px" class="cls_039"><span class="cls_039">host:8080 (or click the globe button in the Spring Boot Dashboard) and you should</span></div>
<div style="position:absolute;left:93.18px;top:514.07px" class="cls_039"><span class="cls_039">see something like figure 1.8. Your results may be different if you designed your own</span></div>
<div style="position:absolute;left:93.18px;top:527.06px" class="cls_039"><span class="cls_039">logo image. But it shouldn’t vary much from what you see in figure 1.8.</span></div>
<div style="position:absolute;left:107.80px;top:540.08px" class="cls_039"><span class="cls_039">It may not be much to look at. But this isn’t exactly a book on graphic design. The</span></div>
<div style="position:absolute;left:93.18px;top:553.07px" class="cls_039"><span class="cls_039">humble appearance of the homepage is more than sufficient for now. And it provides</span></div>
<div style="position:absolute;left:93.18px;top:566.06px" class="cls_039"><span class="cls_039">you a solid start on getting to know Spring.</span></div>
<div style="position:absolute;left:108.36px;top:579.08px" class="cls_039"><span class="cls_039">One thing I’ve glossed over up until now is DevTools. You selected it as a depen-</span></div>
<div style="position:absolute;left:93.18px;top:592.07px" class="cls_039"><span class="cls_039">dency when initializing your project. It appears as a dependency in the produced</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:28388px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background045.jpg" width="531" height="666"></div>
<div style="position:absolute;left:218.40px;top:24.35px" class="cls_055"><span class="cls_055">Writing a Spring application</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">23</span></div>
<div style="position:absolute;left:102.18px;top:266.81px" class="cls_053"><span class="cls_053">Figure 1.8</span></div>
<div style="position:absolute;left:146.78px;top:266.81px" class="cls_053"><span class="cls_053">The Taco Cloud homepage</span></div>
<div style="position:absolute;left:102.18px;top:301.28px" class="cls_039"><span class="cls_039">pom.xml file. And the Spring Boot Dashboard even shows that the project has</span></div>
<div style="position:absolute;left:102.18px;top:314.27px" class="cls_039"><span class="cls_039">DevTools enabled. But what is DevTools, and what does it do for you? Let’s take a</span></div>
<div style="position:absolute;left:102.18px;top:327.26px" class="cls_039"><span class="cls_039">quick survey of a couple of DevTools’ most useful features.</span></div>
<div style="position:absolute;left:66.18px;top:349.10px" class="cls_063"><span class="cls_063">1.3.5</span></div>
<div style="position:absolute;left:102.18px;top:349.10px" class="cls_063"><span class="cls_063">Getting to know Spring Boot DevTools</span></div>
<div style="position:absolute;left:102.18px;top:366.29px" class="cls_039"><span class="cls_039">As its name suggests, DevTools provides Spring developers with some handy develop-</span></div>
<div style="position:absolute;left:102.18px;top:379.28px" class="cls_039"><span class="cls_039">ment-time tools. Among those are</span></div>
<div style="position:absolute;left:117.78px;top:396.29px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Automatic application restart when code changes</span></div>
<div style="position:absolute;left:117.78px;top:410.27px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Automatic browser refresh when browser-destined resources (such as templates,</span></div>
<div style="position:absolute;left:129.78px;top:423.29px" class="cls_039"><span class="cls_039">JavaScript, stylesheets, and so on) change</span></div>
<div style="position:absolute;left:117.78px;top:437.27px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Automatic disable of template caches</span></div>
<div style="position:absolute;left:117.78px;top:451.28px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Built in H2 Console if the H2 database is in use</span></div>
<div style="position:absolute;left:102.18px;top:469.28px" class="cls_039"><span class="cls_039">It’s important to understand that DevTools isn’t an IDE plugin, nor does it require</span></div>
<div style="position:absolute;left:102.18px;top:482.27px" class="cls_039"><span class="cls_039">that you use a specific IDE. It works equally well in Spring Tool Suite, IntelliJ IDEA,</span></div>
<div style="position:absolute;left:102.18px;top:495.29px" class="cls_039"><span class="cls_039">and NetBeans. Furthermore, because it’s only intended for development purposes, it’s</span></div>
<div style="position:absolute;left:102.18px;top:508.28px" class="cls_039"><span class="cls_039">smart enough to disable itself when deploying in a production setting. (We’ll discuss</span></div>
<div style="position:absolute;left:102.18px;top:521.27px" class="cls_039"><span class="cls_039">how it does this when you get around to deploying your application in chapter 19.)</span></div>
<div style="position:absolute;left:102.18px;top:534.29px" class="cls_039"><span class="cls_039">For now, let’s focus on the most useful features of Spring Boot DevTools, starting with</span></div>
<div style="position:absolute;left:102.18px;top:547.28px" class="cls_039"><span class="cls_039">automatic application restart.</span></div>
<div style="position:absolute;left:102.18px;top:565.46px" class="cls_064"><span class="cls_064">A</span><span class="cls_065">UTOMATIC</span><span class="cls_064"> </span><span class="cls_065">APPLICATION</span><span class="cls_064"> </span><span class="cls_065">RESTART</span></div>
<div style="position:absolute;left:102.18px;top:577.79px" class="cls_039"><span class="cls_039">With DevTools as part of your project, you’ll be able to make changes to Java code and</span></div>
<div style="position:absolute;left:102.18px;top:590.78px" class="cls_039"><span class="cls_039">properties files in the project and see those changes applied after a brief moment.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:29064px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background046.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">24</span></div>
<div style="position:absolute;left:190.50px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 1</span></div>
<div style="position:absolute;left:234.63px;top:24.35px" class="cls_055"><span class="cls_055">Getting started with Spring</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">DevTools monitors for changes, and when it sees something has changed, it automati-</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">cally restarts the application.</span></div>
<div style="position:absolute;left:108.25px;top:76.67px" class="cls_039"><span class="cls_039">More precisely, when DevTools is in play, the application is loaded into two sepa-</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">rate class loaders in the Java virtual machine (JVM). One class loader is loaded with</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">your Java code, property files, and pretty much anything that’s in the src/main/ path</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">of the project. These are items that are likely to change frequently. The other class</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">loader is loaded with dependency libraries, which aren’t likely to change as often.</span></div>
<div style="position:absolute;left:107.64px;top:141.65px" class="cls_039"><span class="cls_039">When a change is detected, DevTools reloads only the class loader containing your</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_039"><span class="cls_039">project code and restarts the Spring application context, but leaves the other class</span></div>
<div style="position:absolute;left:93.18px;top:167.66px" class="cls_039"><span class="cls_039">loader and the JVM intact. Although subtle, this strategy affords a small reduction in</span></div>
<div style="position:absolute;left:93.18px;top:180.65px" class="cls_039"><span class="cls_039">the time it takes to start the application.</span></div>
<div style="position:absolute;left:107.67px;top:193.67px" class="cls_039"><span class="cls_039">The downside of this strategy is that changes to dependencies won’t be available in</span></div>
<div style="position:absolute;left:93.18px;top:206.66px" class="cls_039"><span class="cls_039">automatic restarts. That’s because the class loader containing dependency libraries</span></div>
<div style="position:absolute;left:93.18px;top:219.65px" class="cls_039"><span class="cls_039">isn’t automatically reloaded. This means that any time you add, change, or remove a</span></div>
<div style="position:absolute;left:93.18px;top:232.67px" class="cls_039"><span class="cls_039">dependency in your build specification, you’ll need to do a hard restart of the applica-</span></div>
<div style="position:absolute;left:93.18px;top:245.66px" class="cls_039"><span class="cls_039">tion for those changes to take effect.</span></div>
<div style="position:absolute;left:93.18px;top:263.84px" class="cls_064"><span class="cls_064">A</span><span class="cls_065">UTOMATIC</span><span class="cls_064"> </span><span class="cls_065">BROWSER</span><span class="cls_064"> </span><span class="cls_065">REFRESH</span><span class="cls_064"> </span><span class="cls_065">AND</span><span class="cls_064"> </span><span class="cls_065">TEMPLATE</span><span class="cls_064"> </span><span class="cls_065">CACHE</span><span class="cls_064"> </span><span class="cls_065">DISABLE</span></div>
<div style="position:absolute;left:93.18px;top:276.17px" class="cls_039"><span class="cls_039">By default, template options such as Thymeleaf and FreeMarker are configured to</span></div>
<div style="position:absolute;left:93.18px;top:289.16px" class="cls_039"><span class="cls_039">cache the results of template parsing so that templates don’t need to be reparsed</span></div>
<div style="position:absolute;left:93.18px;top:302.18px" class="cls_039"><span class="cls_039">with every request they serve. This is great in production, as it buys a bit of perfor-</span></div>
<div style="position:absolute;left:93.18px;top:315.17px" class="cls_039"><span class="cls_039">mance benefit.</span></div>
<div style="position:absolute;left:108.87px;top:328.16px" class="cls_039"><span class="cls_039">Cached templates, however, are not so great at development time. Cached tem-</span></div>
<div style="position:absolute;left:93.18px;top:341.18px" class="cls_039"><span class="cls_039">plates make it impossible to make changes to the templates while the application is</span></div>
<div style="position:absolute;left:93.18px;top:354.17px" class="cls_039"><span class="cls_039">running and see the results after refreshing the browser. Even if you’ve made changes,</span></div>
<div style="position:absolute;left:93.18px;top:367.16px" class="cls_039"><span class="cls_039">the cached template will still be in use until you restart the application.</span></div>
<div style="position:absolute;left:107.49px;top:380.18px" class="cls_039"><span class="cls_039">DevTools addresses this issue by automatically disabling all template caching. Make</span></div>
<div style="position:absolute;left:93.18px;top:393.17px" class="cls_039"><span class="cls_039">as many changes as you want to your templates and know that you’re only a browser</span></div>
<div style="position:absolute;left:93.18px;top:406.16px" class="cls_039"><span class="cls_039">refresh away from seeing the results.</span></div>
<div style="position:absolute;left:108.06px;top:419.18px" class="cls_039"><span class="cls_039">But if you’re like me, you don’t even want to be burdened with the effort of click-</span></div>
<div style="position:absolute;left:93.18px;top:432.17px" class="cls_039"><span class="cls_039">ing the browser’s refresh button. It’d be much nicer if you could make the changes</span></div>
<div style="position:absolute;left:93.18px;top:445.16px" class="cls_039"><span class="cls_039">and witness the results in the browser immediately. Fortunately, DevTools has some-</span></div>
<div style="position:absolute;left:93.18px;top:458.18px" class="cls_039"><span class="cls_039">thing special for those of us who are too lazy to click a refresh button.</span></div>
<div style="position:absolute;left:109.36px;top:471.17px" class="cls_039"><span class="cls_039">When DevTools is in play, it automatically enables a LiveReload (</span><a href="http://livereload.com/">http://livere-</a> </div>
<div style="position:absolute;left:93.18px;top:484.16px" class="cls_045"><span class="cls_045"> </span><a href="http://livereload.com/">load.com/</a> <span class="cls_039">) server along with your application. By itself, the LiveReload server isn’t</span></div>
<div style="position:absolute;left:93.18px;top:497.18px" class="cls_039"><span class="cls_039">very useful. But when coupled with a corresponding LiveReload browser plugin, it</span></div>
<div style="position:absolute;left:93.18px;top:510.17px" class="cls_039"><span class="cls_039">causes your browser to automatically refresh when changes are made to templates,</span></div>
<div style="position:absolute;left:93.18px;top:523.16px" class="cls_039"><span class="cls_039">images, stylesheets, JavaScript, and so on—in fact, almost anything that ends up being</span></div>
<div style="position:absolute;left:93.18px;top:536.18px" class="cls_039"><span class="cls_039">served to your browser.</span></div>
<div style="position:absolute;left:108.11px;top:549.17px" class="cls_039"><span class="cls_039">LiveReload has browser plugins for Google Chrome, Safari, and Firefox browsers.</span></div>
<div style="position:absolute;left:93.18px;top:562.19px" class="cls_039"><span class="cls_039">(Sorry, Internet Explorer and Edge fans.) Visit </span><a href="http://livereload.com/extensions/">http://livereload.com/extensions/</a> <span class="cls_039"> to</span></div>
<div style="position:absolute;left:93.18px;top:575.18px" class="cls_039"><span class="cls_039">find information on how to install LiveReload for your browser.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:29740px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background047.jpg" width="531" height="666"></div>
<div style="position:absolute;left:218.40px;top:24.35px" class="cls_055"><span class="cls_055">Writing a Spring application</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">25</span></div>
<div style="position:absolute;left:102.18px;top:50.84px" class="cls_064"><span class="cls_064">B</span><span class="cls_065">UILT</span><span class="cls_064"> </span><span class="cls_065">IN</span><span class="cls_064"> H2 C</span><span class="cls_065">ONSOLE</span></div>
<div style="position:absolute;left:102.18px;top:63.17px" class="cls_039"><span class="cls_039">Although your project doesn’t yet use a database, that will change in chapter 3. If you</span></div>
<div style="position:absolute;left:102.18px;top:76.16px" class="cls_039"><span class="cls_039">choose to use the H2 database for development, DevTools will also automatically</span></div>
<div style="position:absolute;left:102.18px;top:89.15px" class="cls_039"><span class="cls_039">enable an H2 Console that you can access from your web browser. You only need to</span></div>
<div style="position:absolute;left:102.18px;top:102.17px" class="cls_039"><span class="cls_039">point your web browser to </span><a href="http://localhost:8080/h2-console">http://localhost:8080/h2-console</a> <span class="cls_039"> to gain insight into the</span></div>
<div style="position:absolute;left:102.18px;top:115.16px" class="cls_039"><span class="cls_039">data your application is working with.</span></div>
<div style="position:absolute;left:117.60px;top:128.15px" class="cls_039"><span class="cls_039">At this point, you’ve written a complete, albeit simple, Spring application. You’ll</span></div>
<div style="position:absolute;left:102.18px;top:141.17px" class="cls_039"><span class="cls_039">expand on it throughout the course of the book. But now is a good time to step back</span></div>
<div style="position:absolute;left:102.18px;top:154.16px" class="cls_039"><span class="cls_039">and review what you’ve accomplished and how Spring played a part.</span></div>
<div style="position:absolute;left:66.18px;top:178.97px" class="cls_063"><span class="cls_063">1.3.6</span></div>
<div style="position:absolute;left:102.18px;top:178.97px" class="cls_063"><span class="cls_063">Let’s review</span></div>
<div style="position:absolute;left:102.18px;top:196.67px" class="cls_039"><span class="cls_039">Think back on how you got to this point. In short, these are the steps you’ve taken to</span></div>
<div style="position:absolute;left:102.18px;top:209.66px" class="cls_039"><span class="cls_039">build your Spring-based Taco Cloud application:</span></div>
<div style="position:absolute;left:117.78px;top:226.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  You created an initial project structure using Spring Initializr.</span></div>
<div style="position:absolute;left:117.78px;top:240.65px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  You wrote a controller class to handle the homepage request.</span></div>
<div style="position:absolute;left:117.78px;top:254.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  You defined a view template to render the homepage.</span></div>
<div style="position:absolute;left:117.78px;top:268.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  You wrote a simple test class to prove out your work.</span></div>
<div style="position:absolute;left:102.18px;top:286.67px" class="cls_039"><span class="cls_039">Seems pretty straightforward, doesn’t it? With the exception of the first step to boot-</span></div>
<div style="position:absolute;left:102.18px;top:299.66px" class="cls_039"><span class="cls_039">strap the project, each action you’ve taken has been keenly focused on achieving the</span></div>
<div style="position:absolute;left:102.18px;top:312.68px" class="cls_039"><span class="cls_039">goal of producing a homepage.</span></div>
<div style="position:absolute;left:118.08px;top:325.67px" class="cls_039"><span class="cls_039">In fact, almost every line of code you’ve written is aimed toward that goal. Not</span></div>
<div style="position:absolute;left:102.18px;top:338.66px" class="cls_039"><span class="cls_039">counting Java </span><span class="cls_059">import</span><span class="cls_039"> statements, I count only two lines of code in your controller</span></div>
<div style="position:absolute;left:102.18px;top:351.68px" class="cls_039"><span class="cls_039">class and no lines in the view template that are Spring-specific. And although the bulk</span></div>
<div style="position:absolute;left:102.18px;top:364.67px" class="cls_039"><span class="cls_039">of the test class utilizes Spring testing support, it seems a little less invasive in the con-</span></div>
<div style="position:absolute;left:102.18px;top:377.66px" class="cls_039"><span class="cls_039">text of a test.</span></div>
<div style="position:absolute;left:118.29px;top:390.68px" class="cls_039"><span class="cls_039">That’s an important benefit of developing with Spring. You can focus on the</span></div>
<div style="position:absolute;left:102.18px;top:403.67px" class="cls_039"><span class="cls_039">code that meets the requirements of an application rather than on satisfying the</span></div>
<div style="position:absolute;left:102.18px;top:416.66px" class="cls_039"><span class="cls_039">demands of a framework. Although you’ll no doubt need to write some framework-</span></div>
<div style="position:absolute;left:102.18px;top:429.68px" class="cls_039"><span class="cls_039">specific code from time to time, it’ll usually be only a small fraction of your code-</span></div>
<div style="position:absolute;left:102.18px;top:442.67px" class="cls_039"><span class="cls_039">base. As I said before, Spring (with Spring Boot) can be considered the </span><span class="cls_036">frameworkless</span></div>
<div style="position:absolute;left:102.18px;top:455.66px" class="cls_036"><span class="cls_036">framework</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.59px;top:468.68px" class="cls_039"><span class="cls_039">How does this even work? What is Spring doing behind the scenes to make sure</span></div>
<div style="position:absolute;left:102.18px;top:481.67px" class="cls_039"><span class="cls_039">your application needs are met? To understand what Spring is doing, let’s start by</span></div>
<div style="position:absolute;left:102.18px;top:494.66px" class="cls_039"><span class="cls_039">looking at the build specification.</span></div>
<div style="position:absolute;left:117.35px;top:507.68px" class="cls_039"><span class="cls_039">In the pom.xml file, you declared a dependency on the </span><span class="cls_059">Web</span><span class="cls_039"> and </span><span class="cls_059">Thymeleaf</span><span class="cls_039"> start-</span></div>
<div style="position:absolute;left:102.18px;top:520.67px" class="cls_039"><span class="cls_039">ers. These two dependencies transitively brought in a handful of other dependencies,</span></div>
<div style="position:absolute;left:102.18px;top:533.66px" class="cls_039"><span class="cls_039">including</span></div>
<div style="position:absolute;left:117.78px;top:550.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Spring’s MVC framework</span></div>
<div style="position:absolute;left:117.78px;top:564.68px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Embedded Tomcat</span></div>
<div style="position:absolute;left:117.78px;top:578.69px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Thymeleaf and the Thymeleaf layout dialect</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:30416px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background048.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">26</span></div>
<div style="position:absolute;left:190.50px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 1</span></div>
<div style="position:absolute;left:234.63px;top:24.35px" class="cls_055"><span class="cls_055">Getting started with Spring</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">It also brought Spring Boot’s autoconfiguration library along for the ride. When</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">the application starts, Spring Boot autoconfiguration detects those libraries and</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">automatically</span></div>
<div style="position:absolute;left:108.78px;top:93.65px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Configures the beans in the Spring application context to enable Spring MVC</span></div>
<div style="position:absolute;left:108.78px;top:107.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Configures the embedded Tomcat server in the Spring application context</span></div>
<div style="position:absolute;left:108.78px;top:121.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Configures a Thymeleaf view resolver for rendering Spring MVC views with</span></div>
<div style="position:absolute;left:120.78px;top:134.66px" class="cls_039"><span class="cls_039">Thymeleaf templates</span></div>
<div style="position:absolute;left:93.18px;top:152.66px" class="cls_039"><span class="cls_039">In short, autoconfiguration does all the grunt work, leaving you to focus on writing</span></div>
<div style="position:absolute;left:93.18px;top:165.65px" class="cls_039"><span class="cls_039">code that implements your application functionality. That’s a pretty sweet arrange-</span></div>
<div style="position:absolute;left:93.18px;top:178.67px" class="cls_039"><span class="cls_039">ment, if you ask me!</span></div>
<div style="position:absolute;left:107.44px;top:191.66px" class="cls_039"><span class="cls_039">Your Spring journey has just begun. The Taco Cloud application only touched on a</span></div>
<div style="position:absolute;left:93.18px;top:204.65px" class="cls_039"><span class="cls_039">small portion of what Spring has to offer. Before you take your next step, let’s survey</span></div>
<div style="position:absolute;left:93.18px;top:217.67px" class="cls_039"><span class="cls_039">the Spring landscape and see what landmarks you’ll encounter on your journey.</span></div>
<div style="position:absolute;left:57.18px;top:238.84px" class="cls_040"><span class="cls_040">1.4</span></div>
<div style="position:absolute;left:93.18px;top:238.84px" class="cls_040"><span class="cls_040">Surveying the Spring landscape</span></div>
<div style="position:absolute;left:93.18px;top:256.67px" class="cls_039"><span class="cls_039">To get an idea of the Spring landscape, look no further than the enormous list of</span></div>
<div style="position:absolute;left:93.18px;top:269.66px" class="cls_039"><span class="cls_039">checkboxes on the full version of the Spring Initializr web form. It lists over 100</span></div>
<div style="position:absolute;left:93.18px;top:282.65px" class="cls_039"><span class="cls_039">dependency choices, so I won’t try to list them all here or to provide a screenshot.</span></div>
<div style="position:absolute;left:93.18px;top:295.67px" class="cls_039"><span class="cls_039">But I encourage you to take a look. In the meantime, I’ll mention a few of the</span></div>
<div style="position:absolute;left:93.18px;top:308.66px" class="cls_039"><span class="cls_039">highlights.</span></div>
<div style="position:absolute;left:57.18px;top:329.48px" class="cls_063"><span class="cls_063">1.4.1</span></div>
<div style="position:absolute;left:93.18px;top:329.48px" class="cls_063"><span class="cls_063">The core Spring Framework</span></div>
<div style="position:absolute;left:93.18px;top:346.67px" class="cls_039"><span class="cls_039">As you might expect, the core Spring Framework is the foundation of everything else</span></div>
<div style="position:absolute;left:93.18px;top:359.66px" class="cls_039"><span class="cls_039">in the Spring universe. It provides the core container and dependency injection</span></div>
<div style="position:absolute;left:93.18px;top:372.68px" class="cls_039"><span class="cls_039">framework. But it also provides a few other essential features.</span></div>
<div style="position:absolute;left:108.01px;top:385.67px" class="cls_039"><span class="cls_039">Among these is Spring MVC, Spring’s web framework. You’ve already seen how to</span></div>
<div style="position:absolute;left:93.18px;top:398.66px" class="cls_039"><span class="cls_039">use Spring MVC to write a controller class to handle web requests. What you’ve not yet</span></div>
<div style="position:absolute;left:93.18px;top:411.68px" class="cls_039"><span class="cls_039">seen, however, is that Spring MVC can also be used to create REST APIs that produce</span></div>
<div style="position:absolute;left:93.18px;top:424.67px" class="cls_039"><span class="cls_039">non-HTML output. We’re going to dig more into Spring MVC in chapter 2 and then</span></div>
<div style="position:absolute;left:93.18px;top:437.66px" class="cls_039"><span class="cls_039">take another look at how to use it to create REST APIs in chapter 6.</span></div>
<div style="position:absolute;left:107.68px;top:450.68px" class="cls_039"><span class="cls_039">The core Spring Framework also offers some elemental data persistence support,</span></div>
<div style="position:absolute;left:93.18px;top:463.67px" class="cls_039"><span class="cls_039">specifically template-based JDBC support. You’ll see how to use </span><span class="cls_059">JdbcTemplate</span><span class="cls_039"> in</span></div>
<div style="position:absolute;left:93.18px;top:476.66px" class="cls_039"><span class="cls_039">chapter 3.</span></div>
<div style="position:absolute;left:108.49px;top:489.68px" class="cls_039"><span class="cls_039">In the most recent version of Spring (5.0.8), support was added for reactive-style</span></div>
<div style="position:absolute;left:93.18px;top:502.67px" class="cls_039"><span class="cls_039">programming, including a new reactive web framework called Spring WebFlux that</span></div>
<div style="position:absolute;left:93.18px;top:515.66px" class="cls_039"><span class="cls_039">borrows heavily from Spring MVC. You’ll look at Spring’s reactive programming</span></div>
<div style="position:absolute;left:93.18px;top:528.68px" class="cls_039"><span class="cls_039">model in part 3 and Spring WebFlux specifically in chapter 10.</span></div>
<div style="position:absolute;left:57.18px;top:549.50px" class="cls_063"><span class="cls_063">1.4.2</span></div>
<div style="position:absolute;left:93.18px;top:549.50px" class="cls_063"><span class="cls_063">Spring Boot</span></div>
<div style="position:absolute;left:93.18px;top:566.69px" class="cls_039"><span class="cls_039">We’ve already seen many of the benefits of Spring Boot, including starter dependen-</span></div>
<div style="position:absolute;left:93.18px;top:579.68px" class="cls_039"><span class="cls_039">cies and autoconfiguration. Be certain that we’ll use as much of Spring Boot as possi-</span></div>
<div style="position:absolute;left:93.18px;top:592.67px" class="cls_039"><span class="cls_039">ble throughout this book and avoid any form of explicit configuration, unless it’s</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:31092px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background049.jpg" width="531" height="666"></div>
<div style="position:absolute;left:214.29px;top:24.35px" class="cls_055"><span class="cls_055">Surveying the Spring landscape</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">27</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">absolutely necessary. But in addition to starter dependencies and autoconfiguration,</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">Spring Boot also offers a handful of other useful features:</span></div>
<div style="position:absolute;left:117.78px;top:80.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  The Actuator provides runtime insight into the inner workings of an applica-</span></div>
<div style="position:absolute;left:129.78px;top:93.65px" class="cls_039"><span class="cls_039">tion, including metrics, thread dump information, application health, and envi-</span></div>
<div style="position:absolute;left:129.78px;top:106.67px" class="cls_039"><span class="cls_039">ronment properties available to the application.</span></div>
<div style="position:absolute;left:117.78px;top:120.65px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Flexible specification of environment properties.</span></div>
<div style="position:absolute;left:117.78px;top:134.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Additional testing support on top of the testing assistance found in the core</span></div>
<div style="position:absolute;left:129.78px;top:147.65px" class="cls_039"><span class="cls_039">framework.</span></div>
<div style="position:absolute;left:102.18px;top:165.65px" class="cls_039"><span class="cls_039">What’s more, Spring Boot offers an alternative programming model based on Groovy</span></div>
<div style="position:absolute;left:102.18px;top:178.67px" class="cls_039"><span class="cls_039">scripts that’s called the Spring Boot CLI (command-line interface). With the Spring</span></div>
<div style="position:absolute;left:102.18px;top:191.66px" class="cls_039"><span class="cls_039">Boot CLI, you can write entire applications as a collection of Groovy scripts and run</span></div>
<div style="position:absolute;left:102.18px;top:204.65px" class="cls_039"><span class="cls_039">them from the command line. We won’t spend much time with the Spring Boot CLI,</span></div>
<div style="position:absolute;left:102.18px;top:217.67px" class="cls_039"><span class="cls_039">but we’ll touch on it on occasion when it fits our needs.</span></div>
<div style="position:absolute;left:116.53px;top:230.66px" class="cls_039"><span class="cls_039">Spring Boot has become such an integral part of Spring development; I can’t imag-</span></div>
<div style="position:absolute;left:102.18px;top:243.65px" class="cls_039"><span class="cls_039">ine developing a Spring application without it. Consequently, this book takes a Spring</span></div>
<div style="position:absolute;left:102.18px;top:256.67px" class="cls_039"><span class="cls_039">Boot-centric view, and you might catch me using the word </span><span class="cls_036">Spring</span><span class="cls_039"> when I’m referring</span></div>
<div style="position:absolute;left:102.18px;top:269.66px" class="cls_039"><span class="cls_039">to something that Spring Boot is doing.</span></div>
<div style="position:absolute;left:66.18px;top:294.50px" class="cls_063"><span class="cls_063">1.4.3</span></div>
<div style="position:absolute;left:102.18px;top:294.50px" class="cls_063"><span class="cls_063">Spring Data</span></div>
<div style="position:absolute;left:102.18px;top:312.17px" class="cls_039"><span class="cls_039">Although the core Spring Framework comes with basic data persistence support,</span></div>
<div style="position:absolute;left:102.18px;top:325.16px" class="cls_039"><span class="cls_039">Spring Data provides something quite amazing: the ability to define your application’s</span></div>
<div style="position:absolute;left:102.18px;top:338.18px" class="cls_039"><span class="cls_039">data repositories as simple Java interfaces, using a naming convention when defining</span></div>
<div style="position:absolute;left:102.18px;top:351.17px" class="cls_039"><span class="cls_039">methods to drive how data is stored and retrieved.</span></div>
<div style="position:absolute;left:117.66px;top:364.16px" class="cls_039"><span class="cls_039">What’s more, Spring Data is capable of working with a several different kinds of</span></div>
<div style="position:absolute;left:102.18px;top:377.18px" class="cls_039"><span class="cls_039">databases, including relational (JPA), document (Mongo), graph (Neo4j), and others.</span></div>
<div style="position:absolute;left:102.18px;top:390.17px" class="cls_039"><span class="cls_039">You’ll use Spring Data to help create repositories for the Taco Cloud application in</span></div>
<div style="position:absolute;left:102.18px;top:403.16px" class="cls_039"><span class="cls_039">chapter 3.</span></div>
<div style="position:absolute;left:66.18px;top:428.00px" class="cls_063"><span class="cls_063">1.4.4</span></div>
<div style="position:absolute;left:102.18px;top:428.00px" class="cls_063"><span class="cls_063">Spring Security</span></div>
<div style="position:absolute;left:102.18px;top:445.67px" class="cls_039"><span class="cls_039">Application security has always been an important topic, and it seems to become</span></div>
<div style="position:absolute;left:102.18px;top:458.66px" class="cls_039"><span class="cls_039">more important every day. Fortunately, Spring has a robust security framework in</span></div>
<div style="position:absolute;left:102.18px;top:471.68px" class="cls_039"><span class="cls_039">Spring Security.</span></div>
<div style="position:absolute;left:117.70px;top:484.67px" class="cls_039"><span class="cls_039">Spring Security addresses a broad range of application security needs, including</span></div>
<div style="position:absolute;left:102.18px;top:497.66px" class="cls_039"><span class="cls_039">authentication, authorization, and API security. Although the scope of Spring Security</span></div>
<div style="position:absolute;left:102.18px;top:510.68px" class="cls_039"><span class="cls_039">is too large to be properly covered in this book, we’ll touch on some of the most com-</span></div>
<div style="position:absolute;left:102.18px;top:523.67px" class="cls_039"><span class="cls_039">mon use cases in chapters 4 and 12.</span></div>
<div style="position:absolute;left:66.18px;top:548.51px" class="cls_063"><span class="cls_063">1.4.5</span></div>
<div style="position:absolute;left:102.18px;top:548.51px" class="cls_063"><span class="cls_063">Spring Integration and Spring Batch</span></div>
<div style="position:absolute;left:102.18px;top:566.18px" class="cls_039"><span class="cls_039">At some point, most applications will need to integrate with other applications or</span></div>
<div style="position:absolute;left:102.18px;top:579.17px" class="cls_039"><span class="cls_039">even with other components of the same application. Several patterns of application</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:31768px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background050.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">28</span></div>
<div style="position:absolute;left:190.50px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 1</span></div>
<div style="position:absolute;left:234.63px;top:24.35px" class="cls_055"><span class="cls_055">Getting started with Spring</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">integration have emerged to address these needs. Spring Integration and Spring</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">Batch provide the implementation of these patterns for Spring-based applications.</span></div>
<div style="position:absolute;left:108.63px;top:76.67px" class="cls_039"><span class="cls_039">Spring Integration addresses real-time integration where data is processed as it’s</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">made available. In contrast, Spring Batch addresses batched integration where data is</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">allowed to collect for a time until some trigger (perhaps a time trigger) signals that it’s</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">time for the batch of data to be processed. You’ll explore both Spring Batch and</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">Spring Integration in chapter 9.</span></div>
<div style="position:absolute;left:57.18px;top:150.47px" class="cls_063"><span class="cls_063">1.4.6</span></div>
<div style="position:absolute;left:93.18px;top:150.47px" class="cls_063"><span class="cls_063">Spring Cloud</span></div>
<div style="position:absolute;left:93.18px;top:167.66px" class="cls_039"><span class="cls_039">As I’m writing this, the application development world is entering a new era where</span></div>
<div style="position:absolute;left:93.18px;top:180.65px" class="cls_039"><span class="cls_039">we’ll no longer develop our applications as single deployment unit monoliths and will</span></div>
<div style="position:absolute;left:93.18px;top:193.67px" class="cls_039"><span class="cls_039">instead compose applications from several individual deployment units known as</span></div>
<div style="position:absolute;left:93.18px;top:206.66px" class="cls_036"><span class="cls_036">microservices</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:108.66px;top:219.65px" class="cls_039"><span class="cls_039">Microservices are a hot topic, addressing several practical development and run-</span></div>
<div style="position:absolute;left:93.18px;top:232.67px" class="cls_039"><span class="cls_039">time concerns. In doing so, however, they bring to fore their own challenges. Those</span></div>
<div style="position:absolute;left:93.18px;top:245.66px" class="cls_039"><span class="cls_039">challenges are met head-on by Spring Cloud, a collection of projects for developing</span></div>
<div style="position:absolute;left:93.18px;top:258.65px" class="cls_039"><span class="cls_039">cloud-native applications with Spring.</span></div>
<div style="position:absolute;left:108.47px;top:271.67px" class="cls_039"><span class="cls_039">Spring Cloud covers a lot of ground, and it’d be impossible to cover it all in this</span></div>
<div style="position:absolute;left:93.18px;top:284.66px" class="cls_039"><span class="cls_039">book. We’ll look at some of the most common components of Spring Cloud in chap-</span></div>
<div style="position:absolute;left:93.18px;top:297.68px" class="cls_039"><span class="cls_039">ters 13, 14, and 15. For a more complete discussion of Spring Cloud, I suggest taking a</span></div>
<div style="position:absolute;left:93.18px;top:310.67px" class="cls_039"><span class="cls_039">look at </span><span class="cls_036">Spring Microservices in Action</span><span class="cls_039"> by John Carnell (Manning, 2017, </span><a href="http://www.manning.com/books/spring-microservices-in-action">www.manning</a> </div>
<div style="position:absolute;left:93.18px;top:323.66px" class="cls_045"><span class="cls_045"> </span><a href="http://www.manning.com/books/spring-microservices-in-action">.com/books/spring-microservices-in-action</a> <span class="cls_039">).</span></div>
<div style="position:absolute;left:93.18px;top:344.83px" class="cls_040"><span class="cls_040">Summary</span></div>
<div style="position:absolute;left:108.78px;top:363.17px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Spring aims to make developer challenges easy, like creating web applications,</span></div>
<div style="position:absolute;left:120.78px;top:376.16px" class="cls_039"><span class="cls_039">working with databases, securing applications, and microservices.</span></div>
<div style="position:absolute;left:108.78px;top:390.17px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Spring Boot builds on top of Spring to make Spring even easier with simplified</span></div>
<div style="position:absolute;left:120.78px;top:403.16px" class="cls_039"><span class="cls_039">dependency management, automatic configuration, and runtime insights.</span></div>
<div style="position:absolute;left:108.78px;top:417.17px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Spring applications can be initialized using the Spring Initializr, which is web-</span></div>
<div style="position:absolute;left:120.78px;top:430.16px" class="cls_039"><span class="cls_039">based and supported natively in most Java development environments.</span></div>
<div style="position:absolute;left:108.78px;top:444.17px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  The components, commonly referred to as beans, in a Spring application con-</span></div>
<div style="position:absolute;left:120.78px;top:457.16px" class="cls_039"><span class="cls_039">text can be declared explicitly with Java or XML, discovered by component</span></div>
<div style="position:absolute;left:120.78px;top:470.18px" class="cls_039"><span class="cls_039">scanning, or automatically configured with Spring Boot autoconfiguration.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:32444px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background051.jpg" width="531" height="666"></div>
<div style="position:absolute;left:296.58px;top:111.83px" class="cls_014"><span class="cls_014">Developing web</span></div>
<div style="position:absolute;left:331.98px;top:143.84px" class="cls_014"><span class="cls_014">applications</span></div>
<div style="position:absolute;left:96.18px;top:264.85px" class="cls_049"><span class="cls_049">This chapter covers</span></div>
<div style="position:absolute;left:96.18px;top:283.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Presenting model data in the browser</span></div>
<div style="position:absolute;left:96.18px;top:298.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Processing and validating form input</span></div>
<div style="position:absolute;left:96.18px;top:313.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Choosing a view template library</span></div>
<div style="position:absolute;left:114.18px;top:383.54px" class="cls_039"><span class="cls_039">First impressions are important. Curb appeal can sell a house long before the</span></div>
<div style="position:absolute;left:114.18px;top:396.53px" class="cls_039"><span class="cls_039">home buyer enters the door. A car’s cherry paint job will turn more heads than</span></div>
<div style="position:absolute;left:114.18px;top:409.55px" class="cls_039"><span class="cls_039">what’s under the hood. And literature is replete with stories of love at first sight.</span></div>
<div style="position:absolute;left:114.18px;top:422.54px" class="cls_039"><span class="cls_039">What’s inside is very important, but what’s outside—what’s seen first—is important.</span></div>
<div style="position:absolute;left:129.54px;top:435.53px" class="cls_039"><span class="cls_039">The applications you’ll build with Spring will do all kinds of things, including</span></div>
<div style="position:absolute;left:114.18px;top:448.55px" class="cls_039"><span class="cls_039">crunching data, reading information from a database, and interacting with other</span></div>
<div style="position:absolute;left:114.18px;top:461.54px" class="cls_039"><span class="cls_039">applications. But the first impression your application users will get comes from the</span></div>
<div style="position:absolute;left:114.18px;top:474.56px" class="cls_039"><span class="cls_039">user interface. And in many applications, that UI is a web application presented in</span></div>
<div style="position:absolute;left:114.18px;top:487.55px" class="cls_039"><span class="cls_039">a browser.</span></div>
<div style="position:absolute;left:128.57px;top:500.54px" class="cls_039"><span class="cls_039">In chapter 1, you created your first Spring MVC controller to display your applica-</span></div>
<div style="position:absolute;left:114.18px;top:513.56px" class="cls_039"><span class="cls_039">tion homepage. But Spring MVC can do far more than simply display static content.</span></div>
<div style="position:absolute;left:114.18px;top:526.55px" class="cls_039"><span class="cls_039">In this chapter, you’ll develop the first major bit of functionality in your Taco Cloud</span></div>
<div style="position:absolute;left:114.18px;top:539.54px" class="cls_039"><span class="cls_039">application—the ability to design custom tacos. In doing so, you’ll dig deeper into</span></div>
<div style="position:absolute;left:114.18px;top:552.56px" class="cls_039"><span class="cls_039">Spring MVC, and you’ll see how to display model data and process form input.</span></div>
<div style="position:absolute;left:271.50px;top:596.99px" class="cls_048"><span class="cls_048">29</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:33120px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background052.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">30</span></div>
<div style="position:absolute;left:187.80px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 2</span></div>
<div style="position:absolute;left:231.93px;top:24.35px" class="cls_055"><span class="cls_055">Developing web applications</span></div>
<div style="position:absolute;left:57.18px;top:49.81px" class="cls_040"><span class="cls_040">2.1</span></div>
<div style="position:absolute;left:93.18px;top:49.81px" class="cls_040"><span class="cls_040">Displaying information</span></div>
<div style="position:absolute;left:93.18px;top:67.67px" class="cls_039"><span class="cls_039">Fundamentally, Taco Cloud is a place where you can order tacos online. But more</span></div>
<div style="position:absolute;left:93.18px;top:80.66px" class="cls_039"><span class="cls_039">than that, Taco Cloud wants to enable its customers to express their creative side and</span></div>
<div style="position:absolute;left:93.18px;top:93.65px" class="cls_039"><span class="cls_039">to design custom tacos from a rich palette of ingredients.</span></div>
<div style="position:absolute;left:107.50px;top:106.67px" class="cls_039"><span class="cls_039">Therefore, the Taco Cloud web application needs a page that displays the selection</span></div>
<div style="position:absolute;left:93.18px;top:119.66px" class="cls_039"><span class="cls_039">of ingredients for taco artists to choose from. The ingredient choices may change at</span></div>
<div style="position:absolute;left:93.18px;top:132.65px" class="cls_039"><span class="cls_039">any time, so they shouldn’t be hardcoded into an HTML page. Rather, the list of avail-</span></div>
<div style="position:absolute;left:93.18px;top:145.67px" class="cls_039"><span class="cls_039">able ingredients should be fetched from a database and handed over to the page to be</span></div>
<div style="position:absolute;left:93.18px;top:158.66px" class="cls_039"><span class="cls_039">displayed to the customer.</span></div>
<div style="position:absolute;left:108.36px;top:171.65px" class="cls_039"><span class="cls_039">In a Spring web application, it’s a controller’s job to fetch and process data. And</span></div>
<div style="position:absolute;left:93.18px;top:184.67px" class="cls_039"><span class="cls_039">it’s a view’s job to render that data into HTML that will be displayed in the browser.</span></div>
<div style="position:absolute;left:93.18px;top:197.66px" class="cls_039"><span class="cls_039">You’re going to create the following components in support of the taco creation page:</span></div>
<div style="position:absolute;left:108.78px;top:214.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  A domain class that defines the properties of a taco ingredient</span></div>
<div style="position:absolute;left:108.78px;top:228.65px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  A Spring MVC controller class that fetches ingredient information and passes it</span></div>
<div style="position:absolute;left:120.78px;top:241.67px" class="cls_039"><span class="cls_039">along to the view</span></div>
<div style="position:absolute;left:108.78px;top:255.65px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  A view template that renders a list of ingredients in the user’s browser</span></div>
<div style="position:absolute;left:93.18px;top:273.65px" class="cls_039"><span class="cls_039">The relationship between these components is illustrated in figure 2.1.</span></div>
<div style="position:absolute;left:384.48px;top:336.17px" class="cls_057"><span class="cls_057">Taco</span></div>
<div style="position:absolute;left:286.17px;top:343.89px" class="cls_057"><span class="cls_057">Request</span></div>
<div style="position:absolute;left:381.56px;top:345.17px" class="cls_057"><span class="cls_057">design</span></div>
<div style="position:absolute;left:377.48px;top:354.17px" class="cls_057"><span class="cls_057">controller</span></div>
<div style="position:absolute;left:147.56px;top:393.96px" class="cls_057"><span class="cls_057">Web browser</span></div>
<div style="position:absolute;left:374.50px;top:403.46px" class="cls_057"><span class="cls_057">Ingredients</span></div>
<div style="position:absolute;left:378.78px;top:422.59px" class="cls_057"><span class="cls_057">Request</span></div>
<div style="position:absolute;left:290.74px;top:443.08px" class="cls_057"><span class="cls_057">HTML</span></div>
<div style="position:absolute;left:381.17px;top:485.32px" class="cls_057"><span class="cls_057">Design</span></div>
<div style="position:absolute;left:385.06px;top:494.32px" class="cls_057"><span class="cls_057">view</span></div>
<div style="position:absolute;left:93.18px;top:514.49px" class="cls_053"><span class="cls_053">Figure 2.1</span></div>
<div style="position:absolute;left:137.78px;top:514.49px" class="cls_053"><span class="cls_053">A typical Spring MVC request flow</span></div>
<div style="position:absolute;left:93.18px;top:549.59px" class="cls_039"><span class="cls_039">Because this chapter focuses on Spring’s web framework, we’ll defer any of the data-</span></div>
<div style="position:absolute;left:93.18px;top:562.61px" class="cls_039"><span class="cls_039">base stuff to chapter 3. For now, the controller will be solely responsible for providing</span></div>
<div style="position:absolute;left:93.18px;top:575.60px" class="cls_039"><span class="cls_039">the ingredients to the view. In chapter 3, you’ll rework the controller to collaborate</span></div>
<div style="position:absolute;left:93.18px;top:588.62px" class="cls_039"><span class="cls_039">with a repository that fetches ingredients data from a database.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:33796px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background053.jpg" width="531" height="666"></div>
<div style="position:absolute;left:228.66px;top:24.35px" class="cls_055"><span class="cls_055">Displaying information</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">31</span></div>
<div style="position:absolute;left:117.48px;top:50.66px" class="cls_039"><span class="cls_039">Before you write the controller and view, let’s hammer out the domain type that</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">represents an ingredient. This will establish a foundation on which you can develop</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">your web components.</span></div>
<div style="position:absolute;left:66.18px;top:98.48px" class="cls_063"><span class="cls_063">2.1.1</span></div>
<div style="position:absolute;left:102.18px;top:98.48px" class="cls_063"><span class="cls_063">Establishing the domain</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">An application’s domain is the subject area that it addresses—the ideas and concepts</span></div>
<div style="position:absolute;left:102.18px;top:128.48px" class="cls_039"><span class="cls_039">that influence the understanding of the application.</span><span class="cls_069"><sup>1</sup></span><span class="cls_039"> In the Taco Cloud application,</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">the domain includes such objects as taco designs, the ingredients that those designs</span></div>
<div style="position:absolute;left:102.18px;top:154.67px" class="cls_039"><span class="cls_039">are composed of, customers, and taco orders placed by the customers. To get started,</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">we’ll focus on taco ingredients.</span></div>
<div style="position:absolute;left:116.82px;top:180.65px" class="cls_039"><span class="cls_039">In your domain, taco ingredients are fairly simple objects. Each has a name as well</span></div>
<div style="position:absolute;left:102.18px;top:193.67px" class="cls_039"><span class="cls_039">as a type so that it can be visually categorized (proteins, cheeses, sauces, and so on).</span></div>
<div style="position:absolute;left:102.18px;top:206.66px" class="cls_039"><span class="cls_039">Each also has an ID by which it can easily and unambiguously be referenced. The fol-</span></div>
<div style="position:absolute;left:102.18px;top:219.65px" class="cls_039"><span class="cls_039">lowing </span><span class="cls_059">Ingredient</span><span class="cls_039"> class defines the domain object you need.</span></div>
<div style="position:absolute;left:114.18px;top:243.38px" class="cls_066"><span class="cls_066">Listing 2.1</span></div>
<div style="position:absolute;left:166.28px;top:243.38px" class="cls_066"><span class="cls_066">Defining taco ingredients</span></div>
<div style="position:absolute;left:102.18px;top:263.24px" class="cls_060"><span class="cls_060">package tacos;</span></div>
<div style="position:absolute;left:102.18px;top:283.25px" class="cls_060"><span class="cls_060">import lombok.Data;</span></div>
<div style="position:absolute;left:102.18px;top:293.24px" class="cls_060"><span class="cls_060">import lombok.RequiredArgsConstructor;</span></div>
<div style="position:absolute;left:102.18px;top:313.25px" class="cls_060"><span class="cls_060">@Data</span></div>
<div style="position:absolute;left:102.18px;top:323.24px" class="cls_060"><span class="cls_060">@RequiredArgsConstructor</span></div>
<div style="position:absolute;left:102.18px;top:333.23px" class="cls_060"><span class="cls_060">public class Ingredient {</span></div>
<div style="position:absolute;left:111.78px;top:353.24px" class="cls_060"><span class="cls_060">private final String id;</span></div>
<div style="position:absolute;left:111.78px;top:363.23px" class="cls_060"><span class="cls_060">private final String name;</span></div>
<div style="position:absolute;left:111.78px;top:373.25px" class="cls_060"><span class="cls_060">private final Type type;</span></div>
<div style="position:absolute;left:111.78px;top:393.26px" class="cls_060"><span class="cls_060">public static enum Type {</span></div>
<div style="position:absolute;left:121.38px;top:403.25px" class="cls_060"><span class="cls_060">WRAP, PROTEIN, VEGGIES, CHEESE, SAUCE</span></div>
<div style="position:absolute;left:111.78px;top:413.24px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:433.25px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:456.56px" class="cls_039"><span class="cls_039">As you can see, this is a run-of-the-mill Java domain class, defining the three proper-</span></div>
<div style="position:absolute;left:102.18px;top:469.58px" class="cls_039"><span class="cls_039">ties needed to describe an ingredient. Perhaps the most unusual thing about the</span></div>
<div style="position:absolute;left:102.18px;top:482.57px" class="cls_059"><span class="cls_059">Ingredient</span><span class="cls_039"> class as defined in listing 2.1 is that it seems to be missing the usual set of</span></div>
<div style="position:absolute;left:102.18px;top:495.56px" class="cls_039"><span class="cls_039">getter and setter methods, not to mention useful methods like </span><span class="cls_059">equals()</span><span class="cls_039">, </span><span class="cls_059">hashCode()</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:102.18px;top:508.58px" class="cls_059"><span class="cls_059">toString()</span><span class="cls_039">, and others.</span></div>
<div style="position:absolute;left:116.67px;top:521.57px" class="cls_039"><span class="cls_039">You don’t see them in the listing partly to save space, but also because you’re using</span></div>
<div style="position:absolute;left:102.18px;top:534.56px" class="cls_039"><span class="cls_039">an amazing library called Lombok to automatically generate those methods at run-</span></div>
<div style="position:absolute;left:102.18px;top:547.58px" class="cls_039"><span class="cls_039">time. In fact, the </span><span class="cls_059">@Data</span><span class="cls_039"> annotation at the class level is provided by Lombok and tells</span></div>
<div style="position:absolute;left:66.18px;top:583.01px" class="cls_070"><span class="cls_070">1</span></div>
<div style="position:absolute;left:75.18px;top:583.19px" class="cls_071"><span class="cls_071">For a much more in-depth discussion of application domains, I suggest Eric Evans’ </span><span class="cls_072">Domain-Driven Design</span></div>
<div style="position:absolute;left:75.18px;top:592.67px" class="cls_071"><span class="cls_071">(Addison-Wesley Professional, 2003).</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:34472px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background054.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">32</span></div>
<div style="position:absolute;left:187.80px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 2</span></div>
<div style="position:absolute;left:231.93px;top:24.35px" class="cls_055"><span class="cls_055">Developing web applications</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">Lombok to generate all of those missing methods as well as a constructor that accepts</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">all </span><span class="cls_059">final</span><span class="cls_039"> properties as arguments. By using Lombok, you can keep the code for</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_059"><span class="cls_059">Ingredient</span><span class="cls_039"> slim and trim.</span></div>
<div style="position:absolute;left:108.93px;top:89.66px" class="cls_039"><span class="cls_039">Lombok isn’t a Spring library, but it’s so incredibly useful that I find it hard to</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">develop without it. And it’s a lifesaver when I need to keep code examples in a book</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">short and sweet.</span></div>
<div style="position:absolute;left:108.57px;top:128.66px" class="cls_039"><span class="cls_039">To use Lombok, you’ll need to add it as a dependency in your project. If you’re</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">using Spring Tool Suite, it’s an easy matter of right-clicking on the pom.xml file and</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_039"><span class="cls_039">selecting Edit Starters from the Spring context menu option. The same selection of</span></div>
<div style="position:absolute;left:93.18px;top:167.66px" class="cls_039"><span class="cls_039">dependencies you were given in chapter 1 (in figure 1.4) will appear, giving you a</span></div>
<div style="position:absolute;left:93.18px;top:180.65px" class="cls_039"><span class="cls_039">chance to add or change your selected dependencies. Find the Lombok choice, make</span></div>
<div style="position:absolute;left:93.18px;top:193.67px" class="cls_039"><span class="cls_039">sure it’s checked, and click OK; Spring Tool Suite will automatically add it to your</span></div>
<div style="position:absolute;left:93.18px;top:206.66px" class="cls_039"><span class="cls_039">build specification.</span></div>
<div style="position:absolute;left:107.78px;top:219.65px" class="cls_039"><span class="cls_039">Alternatively, you can manually add it with the following entry in pom.xml:</span></div>
<div style="position:absolute;left:93.18px;top:239.33px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:249.35px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:259.34px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;lombok&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:269.33px" class="cls_060"><span class="cls_060">&lt;optional&gt;true&lt;/optional&gt;</span></div>
<div style="position:absolute;left:93.18px;top:279.35px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:93.18px;top:300.68px" class="cls_039"><span class="cls_039">This dependency will provide you with Lombok annotations (such as </span><span class="cls_059">@Data</span><span class="cls_039">) at devel-</span></div>
<div style="position:absolute;left:93.18px;top:313.67px" class="cls_039"><span class="cls_039">opment time and with automatic method generation at runtime. But you’ll also need</span></div>
<div style="position:absolute;left:93.18px;top:326.66px" class="cls_039"><span class="cls_039">to add Lombok as an extension in your IDE, or your IDE will complain with errors</span></div>
<div style="position:absolute;left:93.18px;top:339.68px" class="cls_039"><span class="cls_039">about missing methods and </span><span class="cls_059">final</span><span class="cls_039"> properties that aren’t being set. Visit </span><a href="https://projectlombok.org/">https://pro-</a> </div>
<div style="position:absolute;left:93.18px;top:352.67px" class="cls_045"><span class="cls_045"> </span><a href="https://projectlombok.org/">jectlombok.org/</a> <span class="cls_039"> to find out how to install Lombok in your IDE of choice.</span></div>
<div style="position:absolute;left:107.80px;top:365.66px" class="cls_039"><span class="cls_039">I think you’ll find Lombok to be very useful, but know that it’s optional. You don’t</span></div>
<div style="position:absolute;left:93.18px;top:378.68px" class="cls_039"><span class="cls_039">need it to develop Spring applications, so if you’d rather not use it, feel free to write</span></div>
<div style="position:absolute;left:93.18px;top:391.67px" class="cls_039"><span class="cls_039">those missing methods by hand. Go ahead ... I’ll wait. When you finish, you’ll add</span></div>
<div style="position:absolute;left:93.18px;top:404.66px" class="cls_039"><span class="cls_039">some controllers to handle web requests in your application.</span></div>
<div style="position:absolute;left:57.18px;top:426.50px" class="cls_063"><span class="cls_063">2.1.2</span></div>
<div style="position:absolute;left:93.18px;top:426.50px" class="cls_063"><span class="cls_063">Creating a controller class</span></div>
<div style="position:absolute;left:93.18px;top:443.66px" class="cls_039"><span class="cls_039">Controllers are the major players in Spring’s MVC framework. Their primary job is to</span></div>
<div style="position:absolute;left:93.18px;top:456.68px" class="cls_039"><span class="cls_039">handle HTTP requests and either hand a request off to a view to render HTML</span></div>
<div style="position:absolute;left:93.18px;top:469.67px" class="cls_039"><span class="cls_039">(browser-displayed) or write data directly to the body of a response (RESTful). In this</span></div>
<div style="position:absolute;left:93.18px;top:482.66px" class="cls_039"><span class="cls_039">chapter, we’re focusing on the kinds of controllers that use views to produce content</span></div>
<div style="position:absolute;left:93.18px;top:495.68px" class="cls_039"><span class="cls_039">for web browsers. When we get to chapter 6, we’ll look at writing controllers that han-</span></div>
<div style="position:absolute;left:93.18px;top:508.67px" class="cls_039"><span class="cls_039">dle requests in a REST API.</span></div>
<div style="position:absolute;left:108.18px;top:521.66px" class="cls_039"><span class="cls_039">For the Taco Cloud application, you need a simple controller that will do the fol-</span></div>
<div style="position:absolute;left:93.18px;top:534.68px" class="cls_039"><span class="cls_039">lowing:</span></div>
<div style="position:absolute;left:108.78px;top:551.69px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Handle HTTP </span><span class="cls_059">GET</span><span class="cls_039"> requests where the request path is /design</span></div>
<div style="position:absolute;left:108.78px;top:565.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Build a list of ingredients</span></div>
<div style="position:absolute;left:108.78px;top:579.68px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Hand the request and the ingredient data off to a view template to be rendered</span></div>
<div style="position:absolute;left:120.78px;top:592.67px" class="cls_039"><span class="cls_039">as HTML and sent to the requesting web browser</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:35148px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background055.jpg" width="531" height="666"></div>
<div style="position:absolute;left:228.66px;top:24.35px" class="cls_055"><span class="cls_055">Displaying information</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">33</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">The following </span><span class="cls_059">DesignTacoController</span><span class="cls_039"> class addresses those requirements.</span></div>
<div style="position:absolute;left:114.18px;top:74.39px" class="cls_066"><span class="cls_066">Listing 2.2</span></div>
<div style="position:absolute;left:166.27px;top:74.39px" class="cls_066"><span class="cls_066">The beginnings of a Spring controller class</span></div>
<div style="position:absolute;left:102.18px;top:94.22px" class="cls_060"><span class="cls_060">package tacos.web;</span></div>
<div style="position:absolute;left:102.18px;top:114.23px" class="cls_060"><span class="cls_060">import java.util.Arrays;</span></div>
<div style="position:absolute;left:102.18px;top:124.25px" class="cls_060"><span class="cls_060">import java.util.List;</span></div>
<div style="position:absolute;left:102.18px;top:134.24px" class="cls_060"><span class="cls_060">import java.util.stream.Collectors;</span></div>
<div style="position:absolute;left:102.18px;top:154.25px" class="cls_060"><span class="cls_060">import javax.validation.Valid;</span></div>
<div style="position:absolute;left:102.18px;top:174.23px" class="cls_060"><span class="cls_060">import org.springframework.stereotype.Controller;</span></div>
<div style="position:absolute;left:102.18px;top:184.25px" class="cls_060"><span class="cls_060">import org.springframework.ui.Model;</span></div>
<div style="position:absolute;left:102.18px;top:194.24px" class="cls_060"><span class="cls_060">import org.springframework.validation.Errors;</span></div>
<div style="position:absolute;left:102.18px;top:204.23px" class="cls_060"><span class="cls_060">import org.springframework.web.bind.annotation.GetMapping;</span></div>
<div style="position:absolute;left:102.18px;top:214.25px" class="cls_060"><span class="cls_060">import org.springframework.web.bind.annotation.PostMapping;</span></div>
<div style="position:absolute;left:102.18px;top:224.24px" class="cls_060"><span class="cls_060">import org.springframework.web.bind.annotation.RequestMapping;</span></div>
<div style="position:absolute;left:102.18px;top:244.25px" class="cls_060"><span class="cls_060">import lombok.extern.slf4j.Slf4j;</span></div>
<div style="position:absolute;left:102.18px;top:254.24px" class="cls_060"><span class="cls_060">import tacos.Taco;</span></div>
<div style="position:absolute;left:102.18px;top:264.23px" class="cls_060"><span class="cls_060">import tacos.Ingredient;</span></div>
<div style="position:absolute;left:102.18px;top:274.25px" class="cls_060"><span class="cls_060">import tacos.Ingredient.Type;</span></div>
<div style="position:absolute;left:102.18px;top:294.23px" class="cls_060"><span class="cls_060">@Slf4j</span></div>
<div style="position:absolute;left:102.18px;top:304.25px" class="cls_060"><span class="cls_060">@Controller</span></div>
<div style="position:absolute;left:102.18px;top:314.24px" class="cls_060"><span class="cls_060">@RequestMapping("/design")</span></div>
<div style="position:absolute;left:102.18px;top:324.23px" class="cls_060"><span class="cls_060">public class DesignTacoController {</span></div>
<div style="position:absolute;left:111.78px;top:342.23px" class="cls_060"><span class="cls_060">@GetMapping</span></div>
<div style="position:absolute;left:111.78px;top:352.25px" class="cls_060"><span class="cls_060">public String showDesignForm(Model model) {</span></div>
<div style="position:absolute;left:121.38px;top:362.24px" class="cls_060"><span class="cls_060">List&lt;Ingredient&gt; ingredients = Arrays.asList(</span></div>
<div style="position:absolute;left:130.96px;top:372.23px" class="cls_060"><span class="cls_060">new Ingredient("FLTO", "Flour Tortilla", Type.WRAP),</span></div>
<div style="position:absolute;left:130.96px;top:382.25px" class="cls_060"><span class="cls_060">new Ingredient("COTO", "Corn Tortilla", Type.WRAP),</span></div>
<div style="position:absolute;left:130.96px;top:392.24px" class="cls_060"><span class="cls_060">new Ingredient("GRBF", "Ground Beef", Type.PROTEIN),</span></div>
<div style="position:absolute;left:130.96px;top:402.26px" class="cls_060"><span class="cls_060">new Ingredient("CARN", "Carnitas", Type.PROTEIN),</span></div>
<div style="position:absolute;left:130.96px;top:412.25px" class="cls_060"><span class="cls_060">new Ingredient("TMTO", "Diced Tomatoes", Type.VEGGIES),</span></div>
<div style="position:absolute;left:130.96px;top:422.24px" class="cls_060"><span class="cls_060">new Ingredient("LETC", "Lettuce", Type.VEGGIES),</span></div>
<div style="position:absolute;left:130.96px;top:432.26px" class="cls_060"><span class="cls_060">new Ingredient("CHED", "Cheddar", Type.CHEESE),</span></div>
<div style="position:absolute;left:130.96px;top:442.25px" class="cls_060"><span class="cls_060">new Ingredient("JACK", "Monterrey Jack", Type.CHEESE),</span></div>
<div style="position:absolute;left:130.96px;top:452.24px" class="cls_060"><span class="cls_060">new Ingredient("SLSA", "Salsa", Type.SAUCE),</span></div>
<div style="position:absolute;left:130.96px;top:462.26px" class="cls_060"><span class="cls_060">new Ingredient("SRCR", "Sour Cream", Type.SAUCE)</span></div>
<div style="position:absolute;left:121.38px;top:472.25px" class="cls_060"><span class="cls_060">);</span></div>
<div style="position:absolute;left:121.38px;top:490.25px" class="cls_060"><span class="cls_060">Type[] types = Ingredient.Type.values();</span></div>
<div style="position:absolute;left:121.38px;top:500.24px" class="cls_060"><span class="cls_060">for (Type type : types) {</span></div>
<div style="position:absolute;left:130.95px;top:510.26px" class="cls_060"><span class="cls_060">model.addAttribute(type.toString().toLowerCase(),</span></div>
<div style="position:absolute;left:150.15px;top:520.25px" class="cls_060"><span class="cls_060">filterByType(ingredients, type));</span></div>
<div style="position:absolute;left:121.38px;top:530.24px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:121.38px;top:548.24px" class="cls_060"><span class="cls_060">model.addAttribute("design", new Taco());</span></div>
<div style="position:absolute;left:121.38px;top:566.24px" class="cls_060"><span class="cls_060">return "design";</span></div>
<div style="position:absolute;left:111.78px;top:576.26px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:594.26px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:35824px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background056.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">34</span></div>
<div style="position:absolute;left:187.80px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 2</span></div>
<div style="position:absolute;left:231.93px;top:24.35px" class="cls_055"><span class="cls_055">Developing web applications</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">The first thing to note about </span><span class="cls_059">DesignTacoController</span><span class="cls_039"> is the set of annotations applied</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">at the class level. The first, </span><span class="cls_059">@Slf4j</span><span class="cls_039">, is a Lombok-provided annotation that, at runtime,</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">will automatically generate an SLF4J (Simple Logging Facade for Java, </span><a href="https://www.slf4j.org/">https://www</a> </div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_045"><span class="cls_045"> </span><a href="https://www.slf4j.org/">.slf4j.org/</a> <span class="cls_039">) </span><span class="cls_059">Logger</span><span class="cls_039"> in the class. This modest annotation has the same effect as if you</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">were to explicitly add the following lines within the class:</span></div>
<div style="position:absolute;left:93.18px;top:122.33px" class="cls_060"><span class="cls_060">private static final org.slf4j.Logger log =</span></div>
<div style="position:absolute;left:112.38px;top:132.35px" class="cls_061"><span class="cls_061">org.slf4j.LoggerFactory.getLogger(DesignTacoController.class);</span></div>
<div style="position:absolute;left:93.18px;top:153.65px" class="cls_039"><span class="cls_039">You’ll make use of this </span><span class="cls_059">Logger</span><span class="cls_039"> a little later.</span></div>
<div style="position:absolute;left:110.38px;top:166.67px" class="cls_039"><span class="cls_039">The next annotation applied to </span><span class="cls_059">DesignTacoController</span><span class="cls_039"> is </span><span class="cls_059">@Controller</span><span class="cls_039">. This</span></div>
<div style="position:absolute;left:93.18px;top:179.66px" class="cls_039"><span class="cls_039">annotation serves to identify this class as a controller and to mark it as a candidate for</span></div>
<div style="position:absolute;left:93.18px;top:192.65px" class="cls_039"><span class="cls_039">component scanning, so that Spring will discover it and automatically create an</span></div>
<div style="position:absolute;left:93.18px;top:205.67px" class="cls_039"><span class="cls_039">instance of </span><span class="cls_059">DesignTacoController</span><span class="cls_039"> as a bean in the Spring application context.</span></div>
<div style="position:absolute;left:108.75px;top:218.66px" class="cls_059"><span class="cls_059">DesignTacoController</span><span class="cls_039"> is also annotated with </span><span class="cls_059">@RequestMapping</span><span class="cls_039">. The </span><span class="cls_059">@Request-</span></div>
<div style="position:absolute;left:93.18px;top:231.65px" class="cls_059"><span class="cls_059">Mapping</span><span class="cls_039"> annotation, when applied at the class level, specifies the kind of requests that</span></div>
<div style="position:absolute;left:93.18px;top:244.67px" class="cls_039"><span class="cls_039">this controller handles. In this case, it specifies that </span><span class="cls_059">DesignTacoController</span><span class="cls_039"> will han-</span></div>
<div style="position:absolute;left:93.18px;top:257.66px" class="cls_039"><span class="cls_039">dle requests whose path begins with /design.</span></div>
<div style="position:absolute;left:93.18px;top:275.84px" class="cls_064"><span class="cls_064">H</span><span class="cls_065">ANDLING</span><span class="cls_064"> </span><span class="cls_065">A</span><span class="cls_064"> GET </span><span class="cls_065">REQUEST</span></div>
<div style="position:absolute;left:93.18px;top:288.17px" class="cls_039"><span class="cls_039">The class-level </span><span class="cls_059">@RequestMapping</span><span class="cls_039"> specification is refined with the </span><span class="cls_059">@GetMapping</span><span class="cls_039"> annota-</span></div>
<div style="position:absolute;left:93.18px;top:301.16px" class="cls_039"><span class="cls_039">tion that adorns the </span><span class="cls_059">showDesignForm()</span><span class="cls_039"> method. </span><span class="cls_059">@GetMapping</span><span class="cls_039">, paired with the class-</span></div>
<div style="position:absolute;left:93.18px;top:314.18px" class="cls_039"><span class="cls_039">level </span><span class="cls_059">@RequestMapping</span><span class="cls_039">, specifies that when an HTTP GET request is received for</span></div>
<div style="position:absolute;left:93.18px;top:327.17px" class="cls_039"><span class="cls_039">/design, </span><span class="cls_059">showDesignForm()</span><span class="cls_039"> will be called to handle the request.</span></div>
<div style="position:absolute;left:107.94px;top:340.16px" class="cls_059"><span class="cls_059">@GetMapping</span><span class="cls_039"> is a relatively new annotation, having been introduced in Spring 4.3.</span></div>
<div style="position:absolute;left:93.18px;top:353.18px" class="cls_039"><span class="cls_039">Prior to Spring 4.3, you might have used a method-level </span><span class="cls_059">@RequestMapping</span><span class="cls_039"> annota-</span></div>
<div style="position:absolute;left:93.18px;top:366.17px" class="cls_039"><span class="cls_039">tion instead:</span></div>
<div style="position:absolute;left:93.18px;top:388.85px" class="cls_061"><span class="cls_061">@RequestMapping(method=RequestMethod.GET)</span></div>
<div style="position:absolute;left:93.18px;top:409.16px" class="cls_039"><span class="cls_039">Clearly, </span><span class="cls_059">@GetMapping</span><span class="cls_039"> is more succinct and specific to the HTTP method that it targets.</span></div>
<div style="position:absolute;left:93.18px;top:422.18px" class="cls_059"><span class="cls_059">@GetMapping</span><span class="cls_039"> is just one member of a family of request-mapping annotations. Table 2.1</span></div>
<div style="position:absolute;left:93.18px;top:435.17px" class="cls_039"><span class="cls_039">lists all of the request-mapping annotations available in Spring MVC.</span></div>
<div style="position:absolute;left:93.18px;top:457.85px" class="cls_053"><span class="cls_053">Table 2.1</span></div>
<div style="position:absolute;left:134.90px;top:457.85px" class="cls_053"><span class="cls_053">Spring MVC request-mapping annotations</span></div>
<div style="position:absolute;left:134.19px;top:478.85px" class="cls_073"><span class="cls_073">Annotation</span></div>
<div style="position:absolute;left:285.15px;top:478.85px" class="cls_073"><span class="cls_073">Description</span></div>
<div style="position:absolute;left:99.18px;top:497.84px" class="cls_060"><span class="cls_060">@RequestMapping</span></div>
<div style="position:absolute;left:223.38px;top:497.84px" class="cls_074"><span class="cls_074">General-purpose request handling</span></div>
<div style="position:absolute;left:99.18px;top:514.85px" class="cls_060"><span class="cls_060">@GetMapping</span></div>
<div style="position:absolute;left:223.38px;top:514.85px" class="cls_074"><span class="cls_074">Handles HTTP GET requests</span></div>
<div style="position:absolute;left:99.18px;top:531.86px" class="cls_060"><span class="cls_060">@PostMapping</span></div>
<div style="position:absolute;left:223.38px;top:531.86px" class="cls_074"><span class="cls_074">Handles HTTP POST requests</span></div>
<div style="position:absolute;left:99.18px;top:548.84px" class="cls_060"><span class="cls_060">@PutMapping</span></div>
<div style="position:absolute;left:223.38px;top:548.84px" class="cls_074"><span class="cls_074">Handles HTTP PUT requests</span></div>
<div style="position:absolute;left:99.18px;top:565.85px" class="cls_060"><span class="cls_060">@DeleteMapping</span></div>
<div style="position:absolute;left:223.38px;top:565.85px" class="cls_074"><span class="cls_074">Handles HTTP DELETE requests</span></div>
<div style="position:absolute;left:99.18px;top:582.86px" class="cls_060"><span class="cls_060">@PatchMapping</span></div>
<div style="position:absolute;left:223.38px;top:582.86px" class="cls_074"><span class="cls_074">Handles HTTP PATCH requests</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:36500px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background057.jpg" width="531" height="666"></div>
<div style="position:absolute;left:228.66px;top:24.35px" class="cls_055"><span class="cls_055">Displaying information</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">35</span></div>
<div style="position:absolute;left:114.18px;top:62.48px" class="cls_075"><span class="cls_075">Making the right thing the easy thing</span></div>
<div style="position:absolute;left:114.18px;top:76.34px" class="cls_076"><span class="cls_076">It’s always a good idea to be as specific as possible when declaring request map-</span></div>
<div style="position:absolute;left:114.18px;top:87.32px" class="cls_076"><span class="cls_076">pings on your controller methods. At the very least, this means declaring both a path</span></div>
<div style="position:absolute;left:114.18px;top:98.33px" class="cls_076"><span class="cls_076">(or inheriting a path from the class-level </span><span class="cls_059">@RequestMapping</span><span class="cls_076">) and which HTTP method</span></div>
<div style="position:absolute;left:114.18px;top:109.34px" class="cls_076"><span class="cls_076">it will handle.</span></div>
<div style="position:absolute;left:114.18px;top:127.34px" class="cls_076"><span class="cls_076">The lengthier </span><span class="cls_059">@RequestMapping(method=RequestMethod.GET)</span><span class="cls_076"> made it tempting to</span></div>
<div style="position:absolute;left:114.18px;top:138.35px" class="cls_076"><span class="cls_076">take the lazy way out and leave off the </span><span class="cls_059">method</span><span class="cls_076"> attribute. Thanks to Spring 4.3’s new</span></div>
<div style="position:absolute;left:114.18px;top:149.33px" class="cls_076"><span class="cls_076">mapping annotations, the right thing to do is also the easy thing to do—with less typing.</span></div>
<div style="position:absolute;left:114.18px;top:167.33px" class="cls_076"><span class="cls_076">The new request-mapping annotations have all of the same attributes as </span><span class="cls_059">@Request-</span></div>
<div style="position:absolute;left:114.18px;top:178.34px" class="cls_059"><span class="cls_059">Mapping</span><span class="cls_076">, so you can use them anywhere you’d otherwise use </span><span class="cls_059">@RequestMapping</span><span class="cls_076">.</span></div>
<div style="position:absolute;left:114.18px;top:196.34px" class="cls_076"><span class="cls_076">Generally, I prefer to only use </span><span class="cls_059">@RequestMapping</span><span class="cls_076"> at the class level to specify the base</span></div>
<div style="position:absolute;left:114.18px;top:207.35px" class="cls_076"><span class="cls_076">path. I use the more specific </span><span class="cls_059">@GetMapping</span><span class="cls_076">, </span><span class="cls_059">@PostMapping</span><span class="cls_076">, and so on, on each of</span></div>
<div style="position:absolute;left:114.18px;top:218.33px" class="cls_076"><span class="cls_076">the handler methods.</span></div>
<div style="position:absolute;left:102.18px;top:249.65px" class="cls_039"><span class="cls_039">Now that you know that the </span><span class="cls_059">showDesignForm()</span><span class="cls_039"> method will handle the request, let’s</span></div>
<div style="position:absolute;left:102.18px;top:262.67px" class="cls_039"><span class="cls_039">look at the method body to see how it ticks. The bulk of the method constructs a list of</span></div>
<div style="position:absolute;left:102.18px;top:275.66px" class="cls_059"><span class="cls_059">Ingredient</span><span class="cls_039"> objects. The list is hardcoded for now. When we get to chapter 3, you’ll</span></div>
<div style="position:absolute;left:102.18px;top:288.65px" class="cls_039"><span class="cls_039">pull the list of available taco ingredients from a database.</span></div>
<div style="position:absolute;left:116.69px;top:301.67px" class="cls_039"><span class="cls_039">Once the list of ingredients is ready, the next few lines of </span><span class="cls_059">showDesignForm()</span><span class="cls_039"> filters</span></div>
<div style="position:absolute;left:102.18px;top:314.66px" class="cls_039"><span class="cls_039">the list by ingredient type. A list of ingredient types is then added as an attribute to the</span></div>
<div style="position:absolute;left:102.18px;top:327.68px" class="cls_059"><span class="cls_059">Model</span><span class="cls_039"> object that’s passed into </span><span class="cls_059">showDesignForm()</span><span class="cls_039">. </span><span class="cls_059">Model</span><span class="cls_039"> is an object that ferries data</span></div>
<div style="position:absolute;left:102.18px;top:340.67px" class="cls_039"><span class="cls_039">between a controller and whatever view is charged with rendering that data. Ulti-</span></div>
<div style="position:absolute;left:102.18px;top:353.66px" class="cls_039"><span class="cls_039">mately, data that’s placed in </span><span class="cls_059">Model</span><span class="cls_039"> attributes is copied into the servlet response attri-</span></div>
<div style="position:absolute;left:102.18px;top:366.68px" class="cls_039"><span class="cls_039">butes, where the view can find them. The </span><span class="cls_059">showDesignForm()</span><span class="cls_039"> method concludes by</span></div>
<div style="position:absolute;left:102.18px;top:379.67px" class="cls_039"><span class="cls_039">returning </span><span class="cls_059">"design"</span><span class="cls_039">, which is the logical name of the view that will be used to render</span></div>
<div style="position:absolute;left:102.18px;top:392.66px" class="cls_039"><span class="cls_039">the model to the browser.</span></div>
<div style="position:absolute;left:117.57px;top:405.68px" class="cls_039"><span class="cls_039">Your </span><span class="cls_059">DesignTacoController</span><span class="cls_039"> is really starting to take shape. If you were to run</span></div>
<div style="position:absolute;left:102.18px;top:418.67px" class="cls_039"><span class="cls_039">the application now and point your browser at the /design path, the </span><span class="cls_059">DesignTaco-</span></div>
<div style="position:absolute;left:102.18px;top:431.66px" class="cls_059"><span class="cls_059">Controller</span><span class="cls_039">’s </span><span class="cls_059">showDesignForm()</span><span class="cls_039"> would be engaged, fetching data from the reposi-</span></div>
<div style="position:absolute;left:102.18px;top:444.68px" class="cls_039"><span class="cls_039">tory and placing it in the model before passing the request on to the view. But</span></div>
<div style="position:absolute;left:102.18px;top:457.67px" class="cls_039"><span class="cls_039">because you haven’t defined the view yet, the request would take a horrible turn,</span></div>
<div style="position:absolute;left:102.18px;top:470.66px" class="cls_039"><span class="cls_039">resulting in an HTTP 404 (Not Found) error. To fix that, let’s switch our attention</span></div>
<div style="position:absolute;left:102.18px;top:483.68px" class="cls_039"><span class="cls_039">to the view where the data will be decorated with HTML to be presented in the</span></div>
<div style="position:absolute;left:102.18px;top:496.67px" class="cls_039"><span class="cls_039">user’s web browser.</span></div>
<div style="position:absolute;left:66.18px;top:518.51px" class="cls_063"><span class="cls_063">2.1.3</span></div>
<div style="position:absolute;left:102.18px;top:518.51px" class="cls_063"><span class="cls_063">Designing the view</span></div>
<div style="position:absolute;left:102.18px;top:535.67px" class="cls_039"><span class="cls_039">After the controller is finished with its work, it’s time for the view to get going. Spring</span></div>
<div style="position:absolute;left:102.18px;top:548.69px" class="cls_039"><span class="cls_039">offers several great options for defining views, including JavaServer Pages (JSP),</span></div>
<div style="position:absolute;left:102.18px;top:561.68px" class="cls_039"><span class="cls_039">Thymeleaf, FreeMarker, Mustache, and Groovy-based templates. For now, we’ll use</span></div>
<div style="position:absolute;left:102.18px;top:574.67px" class="cls_039"><span class="cls_039">Thymeleaf, the choice we made in chapter 1 when starting the project. We’ll consider</span></div>
<div style="position:absolute;left:102.18px;top:587.69px" class="cls_039"><span class="cls_039">a few of the other options in section 2.5.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:37176px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background058.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">36</span></div>
<div style="position:absolute;left:187.80px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 2</span></div>
<div style="position:absolute;left:231.93px;top:24.35px" class="cls_055"><span class="cls_055">Developing web applications</span></div>
<div style="position:absolute;left:108.36px;top:50.66px" class="cls_039"><span class="cls_039">In order to use Thymeleaf, you need to add another dependency to your project</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">build. The following </span><span class="cls_059">&lt;dependency&gt;</span><span class="cls_039"> entry uses Spring Boot’s Thymeleaf starter to</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">make Thymeleaf available for rendering the view you’re about to create:</span></div>
<div style="position:absolute;left:93.18px;top:96.32px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:106.34px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:116.33px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:93.18px;top:126.35px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:93.18px;top:147.65px" class="cls_039"><span class="cls_039">At runtime, Spring Boot autoconfiguration will see that Thymeleaf is in the classpath</span></div>
<div style="position:absolute;left:93.18px;top:160.67px" class="cls_039"><span class="cls_039">and will automatically create the beans that support Thymeleaf views for Spring MVC.</span></div>
<div style="position:absolute;left:107.64px;top:173.66px" class="cls_039"><span class="cls_039">View libraries such as Thymeleaf are designed to be decoupled from any particular</span></div>
<div style="position:absolute;left:93.18px;top:186.65px" class="cls_039"><span class="cls_039">web framework. As such, they’re unaware of Spring’s model abstraction and are</span></div>
<div style="position:absolute;left:93.18px;top:199.67px" class="cls_039"><span class="cls_039">unable to work with the data that the controller places in </span><span class="cls_059">Model</span><span class="cls_039">. But they can work</span></div>
<div style="position:absolute;left:93.18px;top:212.66px" class="cls_039"><span class="cls_039">with servlet request attributes. Therefore, before Spring hands the request over to a</span></div>
<div style="position:absolute;left:93.18px;top:225.65px" class="cls_039"><span class="cls_039">view, it copies the model data into request attributes that Thymeleaf and other view-</span></div>
<div style="position:absolute;left:93.18px;top:238.67px" class="cls_039"><span class="cls_039">templating options have ready access to.</span></div>
<div style="position:absolute;left:108.24px;top:251.66px" class="cls_039"><span class="cls_039">Thymeleaf templates are just HTML with some additional element attributes that</span></div>
<div style="position:absolute;left:93.18px;top:264.65px" class="cls_039"><span class="cls_039">guide a template in rendering request data. For example, if there were a request attri-</span></div>
<div style="position:absolute;left:93.18px;top:277.67px" class="cls_039"><span class="cls_039">bute whose key is </span><span class="cls_059">"message"</span><span class="cls_039">, and you wanted it to be rendered into an HTML </span><span class="cls_059">&lt;p&gt;</span><span class="cls_039"> tag</span></div>
<div style="position:absolute;left:93.18px;top:290.66px" class="cls_039"><span class="cls_039">by Thymeleaf, you’d write the following in your Thymeleaf template:</span></div>
<div style="position:absolute;left:93.18px;top:313.34px" class="cls_061"><span class="cls_061">&lt;p th:text="${message}"&gt;placeholder message&lt;/p&gt;</span></div>
<div style="position:absolute;left:93.18px;top:333.68px" class="cls_039"><span class="cls_039">When the template is rendered into HTML, the body of the </span><span class="cls_059">&lt;p&gt;</span><span class="cls_039"> element will be</span></div>
<div style="position:absolute;left:93.18px;top:346.67px" class="cls_039"><span class="cls_039">replaced with the value of the servlet request attribute whose key is </span><span class="cls_059">"message"</span><span class="cls_039">. The</span></div>
<div style="position:absolute;left:93.18px;top:359.66px" class="cls_059"><span class="cls_059">th:text</span><span class="cls_039"> attribute is a Thymeleaf-namespaced attribute that performs the replace-</span></div>
<div style="position:absolute;left:93.18px;top:372.68px" class="cls_039"><span class="cls_039">ment. The </span><span class="cls_059">${}</span><span class="cls_039"> operator tells it to use the value of a request attribute (</span><span class="cls_059">"message"</span><span class="cls_039">, in</span></div>
<div style="position:absolute;left:93.18px;top:385.67px" class="cls_039"><span class="cls_039">this case).</span></div>
<div style="position:absolute;left:108.10px;top:398.66px" class="cls_039"><span class="cls_039">Thymeleaf also offers another attribute, </span><span class="cls_059">th:each</span><span class="cls_039">, that iterates over a collection of</span></div>
<div style="position:absolute;left:93.18px;top:411.68px" class="cls_039"><span class="cls_039">elements, rendering the HTML once for each item in the collection. This will come in</span></div>
<div style="position:absolute;left:93.18px;top:424.67px" class="cls_039"><span class="cls_039">handy as you design your view to list taco ingredients from the model. For example, to</span></div>
<div style="position:absolute;left:93.18px;top:437.66px" class="cls_039"><span class="cls_039">render just the list of "</span><span class="cls_059">wrap"</span><span class="cls_039"> ingredients, you can use the following snippet of HTML:</span></div>
<div style="position:absolute;left:93.18px;top:457.34px" class="cls_060"><span class="cls_060">&lt;h3&gt;Designate your wrap:&lt;/h3&gt;</span></div>
<div style="position:absolute;left:93.18px;top:467.36px" class="cls_060"><span class="cls_060">&lt;div th:each="ingredient : ${wrap}"&gt;</span></div>
<div style="position:absolute;left:102.78px;top:477.35px" class="cls_060"><span class="cls_060">&lt;input name="ingredients" type="checkbox" th:value="${ingredient.id}" /&gt;</span></div>
<div style="position:absolute;left:102.78px;top:487.34px" class="cls_060"><span class="cls_060">&lt;span th:text="${ingredient.name}"&gt;INGREDIENT&lt;/span&gt;&lt;br/&gt;</span></div>
<div style="position:absolute;left:93.18px;top:497.36px" class="cls_061"><span class="cls_061">&lt;/div&gt;</span></div>
<div style="position:absolute;left:93.18px;top:518.66px" class="cls_039"><span class="cls_039">Here, you use the </span><span class="cls_059">th:each</span><span class="cls_039"> attribute on the </span><span class="cls_059">&lt;div&gt;</span><span class="cls_039"> tag to repeat rendering of the </span><span class="cls_059">&lt;div&gt;</span></div>
<div style="position:absolute;left:93.18px;top:531.68px" class="cls_039"><span class="cls_039">once for each item in the collection found in the </span><span class="cls_059">wrap</span><span class="cls_039"> request attribute. On each iter-</span></div>
<div style="position:absolute;left:93.18px;top:544.67px" class="cls_039"><span class="cls_039">ation, the ingredient item is bound to a Thymeleaf variable named </span><span class="cls_059">ingredient</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:108.05px;top:557.69px" class="cls_039"><span class="cls_039">Inside the </span><span class="cls_059">&lt;div&gt;</span><span class="cls_039"> element, there’s a check box </span><span class="cls_059">&lt;input&gt;</span><span class="cls_039"> element and a </span><span class="cls_059">&lt;span&gt;</span><span class="cls_039"> ele-</span></div>
<div style="position:absolute;left:93.18px;top:570.68px" class="cls_039"><span class="cls_039">ment to provide a label for the check box. The check box uses Thymeleaf’s </span><span class="cls_059">th:value</span></div>
<div style="position:absolute;left:93.18px;top:583.67px" class="cls_039"><span class="cls_039">to set the rendered </span><span class="cls_059">&lt;input&gt;</span><span class="cls_039"> element’s </span><span class="cls_059">value</span><span class="cls_039"> attribute to the value found in the</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:37852px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background059.jpg" width="531" height="666"></div>
<div style="position:absolute;left:228.66px;top:24.35px" class="cls_055"><span class="cls_055">Displaying information</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">37</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">ingredient’s </span><span class="cls_059">id</span><span class="cls_039"> property. The </span><span class="cls_059">&lt;span&gt;</span><span class="cls_039"> element uses </span><span class="cls_059">th:text</span><span class="cls_039"> to replace the </span><span class="cls_059">"INGREDIENT"</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">placeholder text with the value of the ingredient’s </span><span class="cls_059">name</span><span class="cls_039"> property.</span></div>
<div style="position:absolute;left:117.94px;top:76.67px" class="cls_039"><span class="cls_039">When rendered with actual model data, one iteration of that </span><span class="cls_059">&lt;div&gt;</span><span class="cls_039"> loop might</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">look like this:</span></div>
<div style="position:absolute;left:102.18px;top:109.34px" class="cls_060"><span class="cls_060">&lt;div&gt;</span></div>
<div style="position:absolute;left:111.78px;top:119.33px" class="cls_060"><span class="cls_060">&lt;input name="ingredients" type="checkbox" value="FLTO" /&gt;</span></div>
<div style="position:absolute;left:111.78px;top:129.35px" class="cls_060"><span class="cls_060">&lt;span&gt;Flour Tortilla&lt;/span&gt;&lt;br/&gt;</span></div>
<div style="position:absolute;left:102.18px;top:139.34px" class="cls_061"><span class="cls_061">&lt;/div&gt;</span></div>
<div style="position:absolute;left:102.18px;top:160.67px" class="cls_039"><span class="cls_039">Ultimately, the preceding Thymeleaf snippet is just part of a larger HTML form</span></div>
<div style="position:absolute;left:102.18px;top:173.66px" class="cls_039"><span class="cls_039">through which your taco artist users will submit their tasty creations. The complete</span></div>
<div style="position:absolute;left:102.18px;top:186.65px" class="cls_039"><span class="cls_039">Thymeleaf template, including all ingredient types and the form, is shown in the fol-</span></div>
<div style="position:absolute;left:102.18px;top:199.67px" class="cls_039"><span class="cls_039">lowing listing.</span></div>
<div style="position:absolute;left:114.18px;top:223.40px" class="cls_066"><span class="cls_066">Listing 2.3</span></div>
<div style="position:absolute;left:166.28px;top:223.40px" class="cls_066"><span class="cls_066">The complete design-a-taco page</span></div>
<div style="position:absolute;left:102.18px;top:243.23px" class="cls_060"><span class="cls_060">&lt;!DOCTYPE html&gt;</span></div>
<div style="position:absolute;left:102.18px;top:253.25px" class="cls_060"><span class="cls_060">&lt;html xmlns="</span><a href="http://www.w3.org/1999/xhtml" "="">http://www.w3.org/1999/xhtml"</a> </div>
<div style="position:absolute;left:130.95px;top:263.24px" class="cls_060"><span class="cls_060">xmlns:th="</span><a href="http://www.thymeleaf.org/" "="">http://www.thymeleaf.org"</a>&gt;</div>
<div style="position:absolute;left:111.78px;top:273.23px" class="cls_060"><span class="cls_060">&lt;head&gt;</span></div>
<div style="position:absolute;left:121.38px;top:283.25px" class="cls_060"><span class="cls_060">&lt;title&gt;Taco Cloud&lt;/title&gt;</span></div>
<div style="position:absolute;left:121.38px;top:293.24px" class="cls_060"><span class="cls_060">&lt;link rel="stylesheet" th:href="@{/styles.css}" /&gt;</span></div>
<div style="position:absolute;left:111.78px;top:303.23px" class="cls_060"><span class="cls_060">&lt;/head&gt;</span></div>
<div style="position:absolute;left:111.78px;top:323.24px" class="cls_060"><span class="cls_060">&lt;body&gt;</span></div>
<div style="position:absolute;left:121.38px;top:333.23px" class="cls_060"><span class="cls_060">&lt;h1&gt;Design your taco!&lt;/h1&gt;</span></div>
<div style="position:absolute;left:121.38px;top:343.25px" class="cls_060"><span class="cls_060">&lt;img th:src="@{/images/TacoCloud.png}"/&gt;</span></div>
<div style="position:absolute;left:121.38px;top:363.23px" class="cls_060"><span class="cls_060">&lt;form method="POST" th:object="${design}"&gt;</span></div>
<div style="position:absolute;left:121.38px;top:373.25px" class="cls_060"><span class="cls_060">&lt;div class="grid"&gt;</span></div>
<div style="position:absolute;left:130.96px;top:383.24px" class="cls_060"><span class="cls_060">&lt;div class="ingredient-group" id="wraps"&gt;</span></div>
<div style="position:absolute;left:130.96px;top:393.26px" class="cls_060"><span class="cls_060">&lt;h3&gt;Designate your wrap:&lt;/h3&gt;</span></div>
<div style="position:absolute;left:130.96px;top:403.25px" class="cls_060"><span class="cls_060">&lt;div th:each="ingredient : ${wrap}"&gt;</span></div>
<div style="position:absolute;left:139.08px;top:413.24px" class="cls_060"><span class="cls_060">&lt;input name="ingredients" type="checkbox" th:value="${ingredient.id}"</span></div>
<div style="position:absolute;left:126.18px;top:423.26px" class="cls_060"><span class="cls_060">/&gt;</span></div>
<div style="position:absolute;left:140.55px;top:433.25px" class="cls_060"><span class="cls_060">&lt;span th:text="${ingredient.name}"&gt;INGREDIENT&lt;/span&gt;&lt;br/&gt;</span></div>
<div style="position:absolute;left:130.95px;top:443.24px" class="cls_060"><span class="cls_060">&lt;/div&gt;</span></div>
<div style="position:absolute;left:130.95px;top:453.26px" class="cls_060"><span class="cls_060">&lt;/div&gt;</span></div>
<div style="position:absolute;left:130.96px;top:473.24px" class="cls_060"><span class="cls_060">&lt;div class="ingredient-group" id="proteins"&gt;</span></div>
<div style="position:absolute;left:130.96px;top:483.26px" class="cls_060"><span class="cls_060">&lt;h3&gt;Pick your protein:&lt;/h3&gt;</span></div>
<div style="position:absolute;left:130.96px;top:493.25px" class="cls_060"><span class="cls_060">&lt;div th:each="ingredient : ${protein}"&gt;</span></div>
<div style="position:absolute;left:139.08px;top:503.24px" class="cls_060"><span class="cls_060">&lt;input name="ingredients" type="checkbox" th:value="${ingredient.id}"</span></div>
<div style="position:absolute;left:126.18px;top:513.26px" class="cls_060"><span class="cls_060">/&gt;</span></div>
<div style="position:absolute;left:140.55px;top:523.25px" class="cls_060"><span class="cls_060">&lt;span th:text="${ingredient.name}"&gt;INGREDIENT&lt;/span&gt;&lt;br/&gt;</span></div>
<div style="position:absolute;left:130.95px;top:533.24px" class="cls_060"><span class="cls_060">&lt;/div&gt;</span></div>
<div style="position:absolute;left:130.95px;top:543.26px" class="cls_060"><span class="cls_060">&lt;/div&gt;</span></div>
<div style="position:absolute;left:130.96px;top:563.24px" class="cls_060"><span class="cls_060">&lt;div class="ingredient-group" id="cheeses"&gt;</span></div>
<div style="position:absolute;left:130.96px;top:573.26px" class="cls_060"><span class="cls_060">&lt;h3&gt;Choose your cheese:&lt;/h3&gt;</span></div>
<div style="position:absolute;left:130.96px;top:583.25px" class="cls_060"><span class="cls_060">&lt;div th:each="ingredient : ${cheese}"&gt;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:38528px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background060.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">38</span></div>
<div style="position:absolute;left:187.80px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 2</span></div>
<div style="position:absolute;left:231.93px;top:24.35px" class="cls_055"><span class="cls_055">Developing web applications</span></div>
<div style="position:absolute;left:130.08px;top:51.32px" class="cls_060"><span class="cls_060">&lt;input name="ingredients" type="checkbox" th:value="${ingredient.id}"</span></div>
<div style="position:absolute;left:117.18px;top:61.34px" class="cls_060"><span class="cls_060">/&gt;</span></div>
<div style="position:absolute;left:131.55px;top:71.33px" class="cls_060"><span class="cls_060">&lt;span th:text="${ingredient.name}"&gt;INGREDIENT&lt;/span&gt;&lt;br/&gt;</span></div>
<div style="position:absolute;left:121.95px;top:81.32px" class="cls_060"><span class="cls_060">&lt;/div&gt;</span></div>
<div style="position:absolute;left:121.95px;top:91.34px" class="cls_060"><span class="cls_060">&lt;/div&gt;</span></div>
<div style="position:absolute;left:121.96px;top:111.32px" class="cls_060"><span class="cls_060">&lt;div class="ingredient-group" id="veggies"&gt;</span></div>
<div style="position:absolute;left:121.96px;top:121.34px" class="cls_060"><span class="cls_060">&lt;h3&gt;Determine your veggies:&lt;/h3&gt;</span></div>
<div style="position:absolute;left:121.96px;top:131.33px" class="cls_060"><span class="cls_060">&lt;div th:each="ingredient : ${veggies}"&gt;</span></div>
<div style="position:absolute;left:130.08px;top:141.35px" class="cls_060"><span class="cls_060">&lt;input name="ingredients" type="checkbox" th:value="${ingredient.id}"</span></div>
<div style="position:absolute;left:117.18px;top:151.34px" class="cls_060"><span class="cls_060">/&gt;</span></div>
<div style="position:absolute;left:131.55px;top:161.33px" class="cls_060"><span class="cls_060">&lt;span th:text="${ingredient.name}"&gt;INGREDIENT&lt;/span&gt;&lt;br/&gt;</span></div>
<div style="position:absolute;left:121.95px;top:171.35px" class="cls_060"><span class="cls_060">&lt;/div&gt;</span></div>
<div style="position:absolute;left:121.95px;top:181.34px" class="cls_060"><span class="cls_060">&lt;/div&gt;</span></div>
<div style="position:absolute;left:121.96px;top:201.35px" class="cls_060"><span class="cls_060">&lt;div class="ingredient-group" id="sauces"&gt;</span></div>
<div style="position:absolute;left:121.93px;top:211.34px" class="cls_060"><span class="cls_060">&lt;h3&gt;Select your sauce:&lt;/h3&gt;</span></div>
<div style="position:absolute;left:121.96px;top:221.33px" class="cls_060"><span class="cls_060">&lt;div th:each="ingredient : ${sauce}"&gt;</span></div>
<div style="position:absolute;left:130.08px;top:231.35px" class="cls_060"><span class="cls_060">&lt;input name="ingredients" type="checkbox" th:value="${ingredient.id}"</span></div>
<div style="position:absolute;left:117.18px;top:241.34px" class="cls_060"><span class="cls_060">/&gt;</span></div>
<div style="position:absolute;left:131.55px;top:251.33px" class="cls_060"><span class="cls_060">&lt;span th:text="${ingredient.name}"&gt;INGREDIENT&lt;/span&gt;&lt;br/&gt;</span></div>
<div style="position:absolute;left:121.95px;top:261.35px" class="cls_060"><span class="cls_060">&lt;/div&gt;</span></div>
<div style="position:absolute;left:121.95px;top:271.34px" class="cls_060"><span class="cls_060">&lt;/div&gt;</span></div>
<div style="position:absolute;left:121.95px;top:281.33px" class="cls_060"><span class="cls_060">&lt;/div&gt;</span></div>
<div style="position:absolute;left:121.95px;top:301.34px" class="cls_060"><span class="cls_060">&lt;div&gt;</span></div>
<div style="position:absolute;left:121.96px;top:331.34px" class="cls_060"><span class="cls_060">&lt;h3&gt;Name your taco creation:&lt;/h3&gt;</span></div>
<div style="position:absolute;left:121.96px;top:341.33px" class="cls_060"><span class="cls_060">&lt;input type="text" th:field="*{name}"/&gt;</span></div>
<div style="position:absolute;left:121.95px;top:351.35px" class="cls_060"><span class="cls_060">&lt;br/&gt;</span></div>
<div style="position:absolute;left:121.96px;top:371.33px" class="cls_060"><span class="cls_060">&lt;button&gt;Submit your taco&lt;/button&gt;</span></div>
<div style="position:absolute;left:121.95px;top:381.35px" class="cls_060"><span class="cls_060">&lt;/div&gt;</span></div>
<div style="position:absolute;left:112.38px;top:391.34px" class="cls_060"><span class="cls_060">&lt;/form&gt;</span></div>
<div style="position:absolute;left:102.78px;top:401.36px" class="cls_060"><span class="cls_060">&lt;/body&gt;</span></div>
<div style="position:absolute;left:93.18px;top:411.35px" class="cls_061"><span class="cls_061">&lt;/html&gt;</span></div>
<div style="position:absolute;left:93.18px;top:432.68px" class="cls_039"><span class="cls_039">As you can see, you repeat the </span><span class="cls_059">&lt;div&gt;</span><span class="cls_039"> snippet for each of the types of ingredients. And</span></div>
<div style="position:absolute;left:93.18px;top:445.67px" class="cls_039"><span class="cls_039">you include a Submit button and field where the user can name their creation.</span></div>
<div style="position:absolute;left:108.82px;top:458.66px" class="cls_039"><span class="cls_039">It’s also worth noting that the complete template includes the Taco Cloud logo</span></div>
<div style="position:absolute;left:93.18px;top:471.47px" class="cls_039"><span class="cls_039">image and a </span><span class="cls_059">&lt;link&gt;</span><span class="cls_039"> reference to a stylesheet.</span><span class="cls_069"><sup>2</sup></span><span class="cls_039"> In both cases, Thymeleaf’s </span><span class="cls_059">@{}</span><span class="cls_039"> operator</span></div>
<div style="position:absolute;left:93.18px;top:484.67px" class="cls_039"><span class="cls_039">is used to produce a context-relative path to the static artifacts that they’re referenc-</span></div>
<div style="position:absolute;left:93.18px;top:497.66px" class="cls_039"><span class="cls_039">ing. As you learned in chapter 1, static content in a Spring Boot application is served</span></div>
<div style="position:absolute;left:93.18px;top:510.68px" class="cls_039"><span class="cls_039">from the /static directory at the root of the classpath.</span></div>
<div style="position:absolute;left:107.76px;top:523.67px" class="cls_039"><span class="cls_039">Now that your controller and view are complete, you can fire up the application to</span></div>
<div style="position:absolute;left:93.18px;top:536.66px" class="cls_039"><span class="cls_039">see the fruits of your labor. There are many ways to run a Spring Boot application. In</span></div>
<div style="position:absolute;left:93.18px;top:549.68px" class="cls_039"><span class="cls_039">chapter 1, I showed you how to run the application by first building it into an executable</span></div>
<div style="position:absolute;left:57.18px;top:583.01px" class="cls_070"><span class="cls_070">2</span></div>
<div style="position:absolute;left:66.18px;top:583.19px" class="cls_071"><span class="cls_071">The contents of the stylesheet aren’t relevant to our discussion; it only contains styling to present the ingre-</span></div>
<div style="position:absolute;left:66.18px;top:592.67px" class="cls_071"><span class="cls_071">dients in two columns instead of one long list of ingredients.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:39204px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background061.jpg" width="531" height="666"></div>
<div style="position:absolute;left:228.66px;top:24.35px" class="cls_055"><span class="cls_055">Displaying information</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">39</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">JAR file and then running the JAR with </span><span class="cls_059">java</span><span class="cls_039"> </span><span class="cls_059">-jar</span><span class="cls_039">. I also showed how you can run the</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">application directly from the build with </span><span class="cls_059">mvn</span><span class="cls_039"> </span><span class="cls_059">spring-boot:run</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.42px;top:76.67px" class="cls_039"><span class="cls_039">No matter how you fire up the Taco Cloud application, once it starts, point your</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">browser to </span><a href="http://localhost:8080/design">http://localhost:8080/design</a> <span class="cls_039">. You should see a page that looks something</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">like figure 2.2.</span></div>
<div style="position:absolute;left:102.18px;top:523.97px" class="cls_053"><span class="cls_053">Figure 2.2</span></div>
<div style="position:absolute;left:146.79px;top:523.97px" class="cls_053"><span class="cls_053">The rendered taco design page</span></div>
<div style="position:absolute;left:102.18px;top:562.88px" class="cls_039"><span class="cls_039">It’s looking good! A taco artist visiting your site is presented with a form containing a</span></div>
<div style="position:absolute;left:102.18px;top:575.90px" class="cls_039"><span class="cls_039">palette of taco ingredients from which they can create their masterpiece. But what</span></div>
<div style="position:absolute;left:102.18px;top:588.89px" class="cls_039"><span class="cls_039">happens when they click the Submit Your Taco button?</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:39880px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background062.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">40</span></div>
<div style="position:absolute;left:187.80px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 2</span></div>
<div style="position:absolute;left:231.93px;top:24.35px" class="cls_055"><span class="cls_055">Developing web applications</span></div>
<div style="position:absolute;left:108.15px;top:50.66px" class="cls_039"><span class="cls_039">Your </span><span class="cls_059">DesignTacoController</span><span class="cls_039"> isn’t yet ready to accept taco creations. If the design</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">form is submitted, the user will be presented with an error. (Specifically, it will be an</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">HTTP 405 error: Request Method “POST” Not Supported.) Let’s fix that by writing</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">some more controller code that handles form submission.</span></div>
<div style="position:absolute;left:57.18px;top:110.83px" class="cls_040"><span class="cls_040">2.2</span></div>
<div style="position:absolute;left:93.18px;top:110.83px" class="cls_040"><span class="cls_040">Processing form submission</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">If you take another look at the </span><span class="cls_059">&lt;form&gt;</span><span class="cls_039"> tag in your view, you can see that its </span><span class="cls_059">method</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">attribute is set to </span><span class="cls_059">POST</span><span class="cls_039">. Moreover, the </span><span class="cls_059">&lt;form&gt;</span><span class="cls_039"> doesn’t declare an </span><span class="cls_059">action</span><span class="cls_039"> attribute. This</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_039"><span class="cls_039">means that when the form is submitted, the browser will gather up all the data in the</span></div>
<div style="position:absolute;left:93.18px;top:167.66px" class="cls_039"><span class="cls_039">form and send it to the server in an HTTP POST request to the same path for which a</span></div>
<div style="position:absolute;left:93.18px;top:180.65px" class="cls_039"><span class="cls_039">GET request displayed the form—the /design path.</span></div>
<div style="position:absolute;left:109.07px;top:193.67px" class="cls_039"><span class="cls_039">Therefore, you need a controller handler method on the receiving end of that</span></div>
<div style="position:absolute;left:93.18px;top:206.66px" class="cls_039"><span class="cls_039">POST request. You need to write a new handler method in </span><span class="cls_059">DesignTacoController</span></div>
<div style="position:absolute;left:93.18px;top:219.65px" class="cls_039"><span class="cls_039">that handles a POST request for /design.</span></div>
<div style="position:absolute;left:109.74px;top:232.67px" class="cls_039"><span class="cls_039">In listing 2.2, you used the </span><span class="cls_059">@GetMapping</span><span class="cls_039"> annotation to specify that the </span><span class="cls_059">show-</span></div>
<div style="position:absolute;left:93.18px;top:245.66px" class="cls_059"><span class="cls_059">DesignForm()</span><span class="cls_039"> method should handle HTTP GET requests for /design. Just like </span><span class="cls_059">@Get-</span></div>
<div style="position:absolute;left:93.18px;top:258.65px" class="cls_059"><span class="cls_059">Mapping</span><span class="cls_039"> handles GET requests, you can use </span><span class="cls_059">@PostMapping</span><span class="cls_039"> to handle POST requests.</span></div>
<div style="position:absolute;left:93.18px;top:271.67px" class="cls_039"><span class="cls_039">For handling taco design submissions, add the </span><span class="cls_059">processDesign()</span><span class="cls_039"> method in the fol-</span></div>
<div style="position:absolute;left:93.18px;top:284.66px" class="cls_039"><span class="cls_039">lowing listing to </span><span class="cls_059">DesignTacoController</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:105.18px;top:308.66px" class="cls_066"><span class="cls_066">Listing 2.4</span></div>
<div style="position:absolute;left:157.26px;top:308.27px" class="cls_066"><span class="cls_066">Handling POST requests with </span><span class="cls_077">@PostMapping</span></div>
<div style="position:absolute;left:93.18px;top:328.64px" class="cls_060"><span class="cls_060">@PostMapping</span></div>
<div style="position:absolute;left:93.18px;top:338.63px" class="cls_060"><span class="cls_060">public String processDesign(Design design) {</span></div>
<div style="position:absolute;left:102.77px;top:348.65px" class="cls_060"><span class="cls_060">// Save the taco design...</span></div>
<div style="position:absolute;left:102.77px;top:358.64px" class="cls_060"><span class="cls_060">// We'll do this in chapter 3</span></div>
<div style="position:absolute;left:102.78px;top:368.63px" class="cls_060"><span class="cls_060">log.info("Processing design: " + design);</span></div>
<div style="position:absolute;left:102.78px;top:388.64px" class="cls_060"><span class="cls_060">return "redirect:/orders/current";</span></div>
<div style="position:absolute;left:93.18px;top:398.66px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:419.96px" class="cls_039"><span class="cls_039">As applied to the </span><span class="cls_059">processDesign()</span><span class="cls_039"> method, </span><span class="cls_059">@PostMapping</span><span class="cls_039"> coordinates with the class-</span></div>
<div style="position:absolute;left:93.18px;top:432.98px" class="cls_039"><span class="cls_039">level</span></div>
<div style="position:absolute;left:119.46px;top:432.98px" class="cls_059"><span class="cls_059">@RequestMapping</span><span class="cls_039">  to  indicate  that </span><span class="cls_059"> processDesign()</span><span class="cls_039">  should  handle  POST</span></div>
<div style="position:absolute;left:93.18px;top:445.97px" class="cls_039"><span class="cls_039">requests for /design. This is precisely what you need to process a taco artist’s submit-</span></div>
<div style="position:absolute;left:93.18px;top:458.96px" class="cls_039"><span class="cls_039">ted creations.</span></div>
<div style="position:absolute;left:108.58px;top:471.98px" class="cls_039"><span class="cls_039">When the form is submitted, the fields in the form are bound to properties of a</span></div>
<div style="position:absolute;left:93.18px;top:484.97px" class="cls_059"><span class="cls_059">Taco</span><span class="cls_039"> object (whose class is shown in the next listing) that’s passed as a parameter into</span></div>
<div style="position:absolute;left:93.18px;top:497.96px" class="cls_059"><span class="cls_059">processDesign()</span><span class="cls_039">. From there, the </span><span class="cls_059">processDesign()</span><span class="cls_039"> method can do whatever it wants</span></div>
<div style="position:absolute;left:93.18px;top:510.98px" class="cls_039"><span class="cls_039">with the </span><span class="cls_059">Taco</span><span class="cls_039"> object.</span></div>
<div style="position:absolute;left:105.18px;top:537.71px" class="cls_066"><span class="cls_066">Listing 2.5</span></div>
<div style="position:absolute;left:157.26px;top:537.71px" class="cls_066"><span class="cls_066">A domain object defining a taco design</span></div>
<div style="position:absolute;left:93.18px;top:557.54px" class="cls_060"><span class="cls_060">package tacos;</span></div>
<div style="position:absolute;left:93.18px;top:567.56px" class="cls_060"><span class="cls_060">import java.util.List;</span></div>
<div style="position:absolute;left:93.18px;top:577.55px" class="cls_060"><span class="cls_060">import lombok.Data;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:40556px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background063.jpg" width="531" height="666"></div>
<div style="position:absolute;left:221.64px;top:24.35px" class="cls_055"><span class="cls_055">Processing form submission</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">41</span></div>
<div style="position:absolute;left:102.18px;top:51.32px" class="cls_060"><span class="cls_060">@Data</span></div>
<div style="position:absolute;left:102.18px;top:61.34px" class="cls_060"><span class="cls_060">public class Taco {</span></div>
<div style="position:absolute;left:111.78px;top:81.32px" class="cls_060"><span class="cls_060">private String name;</span></div>
<div style="position:absolute;left:111.78px;top:91.34px" class="cls_060"><span class="cls_060">private List&lt;String&gt; ingredients;</span></div>
<div style="position:absolute;left:102.18px;top:111.32px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:135.65px" class="cls_039"><span class="cls_039">As you can see, </span><span class="cls_059">Taco</span><span class="cls_039"> is a straightforward Java domain object with a couple of proper-</span></div>
<div style="position:absolute;left:102.18px;top:148.67px" class="cls_039"><span class="cls_039">ties. Like </span><span class="cls_059">Ingredient</span><span class="cls_039">, the </span><span class="cls_059">Taco</span><span class="cls_039"> class is annotated with </span><span class="cls_059">@Data</span><span class="cls_039"> to automatically generate</span></div>
<div style="position:absolute;left:102.18px;top:161.66px" class="cls_039"><span class="cls_039">essential JavaBean methods for you at runtime.</span></div>
<div style="position:absolute;left:116.91px;top:174.65px" class="cls_039"><span class="cls_039">If you look back at the form in listing 2.3, you’ll see several </span><span class="cls_059">checkbox</span><span class="cls_039"> elements, all</span></div>
<div style="position:absolute;left:102.18px;top:187.67px" class="cls_039"><span class="cls_039">with the name </span><span class="cls_059">ingredients</span><span class="cls_039">, and a text input element named </span><span class="cls_059">name</span><span class="cls_039">. Those fields in the</span></div>
<div style="position:absolute;left:102.18px;top:200.66px" class="cls_039"><span class="cls_039">form correspond directly to the </span><span class="cls_059">ingredients</span><span class="cls_039"> and </span><span class="cls_059">name</span><span class="cls_039"> properties of the </span><span class="cls_059">Taco</span><span class="cls_039"> class.</span></div>
<div style="position:absolute;left:117.66px;top:213.65px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">Name</span><span class="cls_039"> field on the form only needs to capture a simple textual value. Thus</span></div>
<div style="position:absolute;left:102.18px;top:226.67px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">name</span><span class="cls_039"> property of </span><span class="cls_059">Taco</span><span class="cls_039"> is of type </span><span class="cls_059">String</span><span class="cls_039">. The ingredients check boxes also have</span></div>
<div style="position:absolute;left:102.18px;top:239.66px" class="cls_039"><span class="cls_039">textual values, but because zero or many of them may be selected, the </span><span class="cls_059">ingredients</span></div>
<div style="position:absolute;left:102.18px;top:252.65px" class="cls_039"><span class="cls_039">property that they’re bound to is a </span><span class="cls_059">List&lt;String&gt;</span><span class="cls_039"> that will capture each of the cho-</span></div>
<div style="position:absolute;left:102.18px;top:265.67px" class="cls_039"><span class="cls_039">sen ingredients.</span></div>
<div style="position:absolute;left:116.81px;top:278.66px" class="cls_039"><span class="cls_039">For now, the </span><span class="cls_059">processDesign()</span><span class="cls_039"> method does nothing with the </span><span class="cls_059">Taco</span><span class="cls_039"> object. In fact,</span></div>
<div style="position:absolute;left:102.18px;top:291.65px" class="cls_039"><span class="cls_039">it doesn’t do much of anything at all. That’s OK. In chapter 3, you’ll add some per-</span></div>
<div style="position:absolute;left:102.18px;top:304.67px" class="cls_039"><span class="cls_039">sistence logic that will save the submitted </span><span class="cls_059">Taco</span><span class="cls_039"> to a database.</span></div>
<div style="position:absolute;left:117.63px;top:317.66px" class="cls_039"><span class="cls_039">Just as with the </span><span class="cls_059">showDesignForm()</span><span class="cls_039"> method, </span><span class="cls_059">processDesign()</span><span class="cls_039"> finishes by return-</span></div>
<div style="position:absolute;left:102.18px;top:330.68px" class="cls_039"><span class="cls_039">ing a </span><span class="cls_059">String</span><span class="cls_039"> value. And just like </span><span class="cls_059">showDesignForm()</span><span class="cls_039">, the value returned indicates a</span></div>
<div style="position:absolute;left:102.18px;top:343.67px" class="cls_039"><span class="cls_039">view that will be shown to the user. But what’s different is that the value returned from</span></div>
<div style="position:absolute;left:102.18px;top:356.66px" class="cls_059"><span class="cls_059">processDesign()</span><span class="cls_039"> is prefixed with </span><span class="cls_059">"redirect:"</span><span class="cls_039">, indicating that this is a redirect view.</span></div>
<div style="position:absolute;left:102.18px;top:369.68px" class="cls_039"><span class="cls_039">More specifically, it indicates that after </span><span class="cls_059">processDesign()</span><span class="cls_039"> completes, the user’s browser</span></div>
<div style="position:absolute;left:102.18px;top:382.67px" class="cls_039"><span class="cls_039">should be redirected to the relative path /order/current.</span></div>
<div style="position:absolute;left:117.16px;top:395.66px" class="cls_039"><span class="cls_039">The idea is that after creating a taco, the user will be redirected to an order form</span></div>
<div style="position:absolute;left:102.18px;top:408.68px" class="cls_039"><span class="cls_039">from which they can place an order to have their taco creations delivered. But you</span></div>
<div style="position:absolute;left:102.18px;top:421.67px" class="cls_039"><span class="cls_039">don’t yet have a controller that will handle a request for /orders/current.</span></div>
<div style="position:absolute;left:119.38px;top:434.66px" class="cls_039"><span class="cls_039">Given what you now know about </span><span class="cls_059">@Controller</span><span class="cls_039">, </span><span class="cls_059">@RequestMapping</span><span class="cls_039">, and </span><span class="cls_059">@Get-</span></div>
<div style="position:absolute;left:102.18px;top:447.68px" class="cls_059"><span class="cls_059">Mapping</span><span class="cls_039">, you can easily create such a controller. It might look something like the fol-</span></div>
<div style="position:absolute;left:102.18px;top:460.67px" class="cls_039"><span class="cls_039">lowing listing.</span></div>
<div style="position:absolute;left:114.18px;top:484.40px" class="cls_066"><span class="cls_066">Listing 2.6</span></div>
<div style="position:absolute;left:166.26px;top:484.40px" class="cls_066"><span class="cls_066">A controller to present a taco order form</span></div>
<div style="position:absolute;left:102.18px;top:504.26px" class="cls_060"><span class="cls_060">package tacos.web;</span></div>
<div style="position:absolute;left:102.18px;top:514.25px" class="cls_060"><span class="cls_060">import javax.validation.Valid;</span></div>
<div style="position:absolute;left:102.18px;top:524.24px" class="cls_060"><span class="cls_060">import org.springframework.stereotype.Controller;</span></div>
<div style="position:absolute;left:102.18px;top:534.26px" class="cls_060"><span class="cls_060">import org.springframework.ui.Model;</span></div>
<div style="position:absolute;left:102.18px;top:544.25px" class="cls_060"><span class="cls_060">import org.springframework.validation.Errors;</span></div>
<div style="position:absolute;left:102.18px;top:554.24px" class="cls_060"><span class="cls_060">import org.springframework.web.bind.annotation.GetMapping;</span></div>
<div style="position:absolute;left:102.18px;top:564.26px" class="cls_060"><span class="cls_060">import org.springframework.web.bind.annotation.RequestMapping;</span></div>
<div style="position:absolute;left:102.18px;top:574.25px" class="cls_060"><span class="cls_060">import lombok.extern.slf4j.Slf4j;</span></div>
<div style="position:absolute;left:102.18px;top:584.24px" class="cls_060"><span class="cls_060">import tacos.Order;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:41232px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background064.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">42</span></div>
<div style="position:absolute;left:187.80px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 2</span></div>
<div style="position:absolute;left:231.93px;top:24.35px" class="cls_055"><span class="cls_055">Developing web applications</span></div>
<div style="position:absolute;left:93.18px;top:51.32px" class="cls_060"><span class="cls_060">@Slf4j</span></div>
<div style="position:absolute;left:93.18px;top:61.34px" class="cls_060"><span class="cls_060">@Controller</span></div>
<div style="position:absolute;left:93.18px;top:71.33px" class="cls_060"><span class="cls_060">@RequestMapping("/orders")</span></div>
<div style="position:absolute;left:93.18px;top:81.32px" class="cls_060"><span class="cls_060">public class OrderController {</span></div>
<div style="position:absolute;left:102.78px;top:101.33px" class="cls_060"><span class="cls_060">@GetMapping("/current")</span></div>
<div style="position:absolute;left:102.78px;top:111.32px" class="cls_060"><span class="cls_060">public String orderForm(Model model) {</span></div>
<div style="position:absolute;left:112.38px;top:121.34px" class="cls_060"><span class="cls_060">model.addAttribute("order", new Order());</span></div>
<div style="position:absolute;left:112.38px;top:131.33px" class="cls_060"><span class="cls_060">return "orderForm";</span></div>
<div style="position:absolute;left:102.78px;top:141.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:161.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:182.66px" class="cls_039"><span class="cls_039">Once again, you use Lombok’s </span><span class="cls_059">@Slf4j</span><span class="cls_039"> annotation to create a free SLF4J </span><span class="cls_059">Logger</span></div>
<div style="position:absolute;left:93.18px;top:195.65px" class="cls_039"><span class="cls_039">object at runtime. You’ll use this </span><span class="cls_059">Logger</span><span class="cls_039"> in a moment to log the details of the order</span></div>
<div style="position:absolute;left:93.18px;top:208.67px" class="cls_039"><span class="cls_039">that’s submitted.</span></div>
<div style="position:absolute;left:109.05px;top:221.66px" class="cls_039"><span class="cls_039">The class-level </span><span class="cls_059">@RequestMapping</span><span class="cls_039"> specifies that any request-handling methods in</span></div>
<div style="position:absolute;left:93.18px;top:234.65px" class="cls_039"><span class="cls_039">this controller will handle requests whose path begins with /orders. When combined</span></div>
<div style="position:absolute;left:93.18px;top:247.67px" class="cls_039"><span class="cls_039">with the method-level </span><span class="cls_059">@GetMapping</span><span class="cls_039">, it specifies that the </span><span class="cls_059">orderForm()</span><span class="cls_039"> method will han-</span></div>
<div style="position:absolute;left:93.18px;top:260.66px" class="cls_039"><span class="cls_039">dle HTTP GET requests for /orders/current.</span></div>
<div style="position:absolute;left:107.92px;top:273.65px" class="cls_039"><span class="cls_039">As for the </span><span class="cls_059">orderForm()</span><span class="cls_039"> method itself, it’s extremely basic, only returning a logical</span></div>
<div style="position:absolute;left:93.18px;top:286.67px" class="cls_039"><span class="cls_039">view name of </span><span class="cls_059">orderForm</span><span class="cls_039">. Once you have a way to persist taco creations to a database in</span></div>
<div style="position:absolute;left:93.18px;top:299.66px" class="cls_039"><span class="cls_039">chapter 3, you’ll revisit this method and modify it to populate the model with a list of</span></div>
<div style="position:absolute;left:93.18px;top:312.68px" class="cls_059"><span class="cls_059">Taco</span><span class="cls_039"> objects to be placed in the order.</span></div>
<div style="position:absolute;left:107.85px;top:325.67px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">orderForm</span><span class="cls_039"> view is provided by a Thymeleaf template named orderForm.html,</span></div>
<div style="position:absolute;left:93.18px;top:338.66px" class="cls_039"><span class="cls_039">which is shown next.</span></div>
<div style="position:absolute;left:105.18px;top:362.39px" class="cls_066"><span class="cls_066">Listing 2.7</span></div>
<div style="position:absolute;left:157.27px;top:362.39px" class="cls_066"><span class="cls_066">A taco order form view</span></div>
<div style="position:absolute;left:93.18px;top:382.25px" class="cls_060"><span class="cls_060">&lt;!DOCTYPE html&gt;</span></div>
<div style="position:absolute;left:93.18px;top:392.24px" class="cls_060"><span class="cls_060">&lt;html xmlns="</span><a href="http://www.w3.org/1999/xhtml" "="">http://www.w3.org/1999/xhtml"</a> </div>
<div style="position:absolute;left:121.95px;top:402.26px" class="cls_060"><span class="cls_060">xmlns:th="</span><a href="http://www.thymeleaf.org/" "="">http://www.thymeleaf.org"</a>&gt;</div>
<div style="position:absolute;left:102.78px;top:412.25px" class="cls_060"><span class="cls_060">&lt;head&gt;</span></div>
<div style="position:absolute;left:112.38px;top:422.24px" class="cls_060"><span class="cls_060">&lt;title&gt;Taco Cloud&lt;/title&gt;</span></div>
<div style="position:absolute;left:112.38px;top:432.26px" class="cls_060"><span class="cls_060">&lt;link rel="stylesheet" th:href="@{/styles.css}" /&gt;</span></div>
<div style="position:absolute;left:102.78px;top:442.25px" class="cls_060"><span class="cls_060">&lt;/head&gt;</span></div>
<div style="position:absolute;left:102.78px;top:462.26px" class="cls_060"><span class="cls_060">&lt;body&gt;</span></div>
<div style="position:absolute;left:112.38px;top:482.24px" class="cls_060"><span class="cls_060">&lt;form method="POST" th:action="@{/orders}" th:object="${order}"&gt;</span></div>
<div style="position:absolute;left:121.96px;top:492.26px" class="cls_060"><span class="cls_060">&lt;h1&gt;Order your taco creations!&lt;/h1&gt;</span></div>
<div style="position:absolute;left:121.96px;top:512.24px" class="cls_060"><span class="cls_060">&lt;img th:src="@{/images/TacoCloud.png}"/&gt;</span></div>
<div style="position:absolute;left:121.95px;top:522.26px" class="cls_060"><span class="cls_060">&lt;a th:href="@{/design}" id="another"&gt;Design another taco&lt;/a&gt;&lt;br/&gt;</span></div>
<div style="position:absolute;left:121.96px;top:542.24px" class="cls_060"><span class="cls_060">&lt;div th:if="${#fields.hasErrors()}"&gt;</span></div>
<div style="position:absolute;left:131.56px;top:552.26px" class="cls_060"><span class="cls_060">&lt;span class="validationError"&gt;</span></div>
<div style="position:absolute;left:131.55px;top:562.25px" class="cls_060"><span class="cls_060">Please correct the problems below and resubmit.</span></div>
<div style="position:absolute;left:131.55px;top:572.24px" class="cls_060"><span class="cls_060">&lt;/span&gt;</span></div>
<div style="position:absolute;left:121.95px;top:582.26px" class="cls_060"><span class="cls_060">&lt;/div&gt;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:41908px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background065.jpg" width="531" height="666"></div>
<div style="position:absolute;left:221.64px;top:24.35px" class="cls_055"><span class="cls_055">Processing form submission</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">43</span></div>
<div style="position:absolute;left:130.95px;top:51.32px" class="cls_060"><span class="cls_060">&lt;h3&gt;Deliver my taco masterpieces to...&lt;/h3&gt;</span></div>
<div style="position:absolute;left:130.94px;top:61.34px" class="cls_060"><span class="cls_060">&lt;label for="name"&gt;Name: &lt;/label&gt;</span></div>
<div style="position:absolute;left:130.96px;top:71.33px" class="cls_060"><span class="cls_060">&lt;input type="text" th:field="*{name}"/&gt;</span></div>
<div style="position:absolute;left:130.95px;top:81.32px" class="cls_060"><span class="cls_060">&lt;br/&gt;</span></div>
<div style="position:absolute;left:130.94px;top:101.33px" class="cls_060"><span class="cls_060">&lt;label for="street"&gt;Street address: &lt;/label&gt;</span></div>
<div style="position:absolute;left:130.96px;top:111.32px" class="cls_060"><span class="cls_060">&lt;input type="text" th:field="*{street}"/&gt;</span></div>
<div style="position:absolute;left:130.95px;top:121.34px" class="cls_060"><span class="cls_060">&lt;br/&gt;</span></div>
<div style="position:absolute;left:130.94px;top:141.35px" class="cls_060"><span class="cls_060">&lt;label for="city"&gt;City: &lt;/label&gt;</span></div>
<div style="position:absolute;left:130.96px;top:151.34px" class="cls_060"><span class="cls_060">&lt;input type="text" th:field="*{city}"/&gt;</span></div>
<div style="position:absolute;left:130.95px;top:161.33px" class="cls_060"><span class="cls_060">&lt;br/&gt;</span></div>
<div style="position:absolute;left:130.96px;top:181.34px" class="cls_060"><span class="cls_060">&lt;label for="state"&gt;State: &lt;/label&gt;</span></div>
<div style="position:absolute;left:130.96px;top:191.33px" class="cls_060"><span class="cls_060">&lt;input type="text" th:field="*{state}"/&gt;</span></div>
<div style="position:absolute;left:130.95px;top:201.35px" class="cls_060"><span class="cls_060">&lt;br/&gt;</span></div>
<div style="position:absolute;left:130.96px;top:221.33px" class="cls_060"><span class="cls_060">&lt;label for="zip"&gt;Zip code: &lt;/label&gt;</span></div>
<div style="position:absolute;left:130.96px;top:231.35px" class="cls_060"><span class="cls_060">&lt;input type="text" th:field="*{zip}"/&gt;</span></div>
<div style="position:absolute;left:130.95px;top:241.34px" class="cls_060"><span class="cls_060">&lt;br/&gt;</span></div>
<div style="position:absolute;left:130.96px;top:261.35px" class="cls_060"><span class="cls_060">&lt;h3&gt;Here's how I'll pay...&lt;/h3&gt;</span></div>
<div style="position:absolute;left:130.97px;top:271.34px" class="cls_060"><span class="cls_060">&lt;label for="ccNumber"&gt;Credit Card #: &lt;/label&gt;</span></div>
<div style="position:absolute;left:130.96px;top:281.33px" class="cls_060"><span class="cls_060">&lt;input type="text" th:field="*{ccNumber}"/&gt;</span></div>
<div style="position:absolute;left:130.95px;top:291.35px" class="cls_060"><span class="cls_060">&lt;br/&gt;</span></div>
<div style="position:absolute;left:130.96px;top:311.33px" class="cls_060"><span class="cls_060">&lt;label for="ccExpiration"&gt;Expiration: &lt;/label&gt;</span></div>
<div style="position:absolute;left:130.96px;top:321.35px" class="cls_060"><span class="cls_060">&lt;input type="text" th:field="*{ccExpiration}"/&gt;</span></div>
<div style="position:absolute;left:130.95px;top:331.34px" class="cls_060"><span class="cls_060">&lt;br/&gt;</span></div>
<div style="position:absolute;left:130.94px;top:351.35px" class="cls_060"><span class="cls_060">&lt;label for="ccCVV"&gt;CVV: &lt;/label&gt;</span></div>
<div style="position:absolute;left:130.96px;top:361.34px" class="cls_060"><span class="cls_060">&lt;input type="text" th:field="*{ccCVV}"/&gt;</span></div>
<div style="position:absolute;left:130.95px;top:371.33px" class="cls_060"><span class="cls_060">&lt;br/&gt;</span></div>
<div style="position:absolute;left:130.96px;top:391.34px" class="cls_060"><span class="cls_060">&lt;input type="submit" value="Submit order"/&gt;</span></div>
<div style="position:absolute;left:121.38px;top:401.36px" class="cls_060"><span class="cls_060">&lt;/form&gt;</span></div>
<div style="position:absolute;left:111.78px;top:421.34px" class="cls_060"><span class="cls_060">&lt;/body&gt;</span></div>
<div style="position:absolute;left:102.18px;top:431.36px" class="cls_061"><span class="cls_061">&lt;/html&gt;</span></div>
<div style="position:absolute;left:102.18px;top:454.67px" class="cls_039"><span class="cls_039">For the most part, the </span><span class="cls_059">orderForm.html</span><span class="cls_039"> view is typical HTML/Thymeleaf content, with</span></div>
<div style="position:absolute;left:102.18px;top:467.66px" class="cls_039"><span class="cls_039">very little of note. But notice that the </span><span class="cls_059">&lt;form&gt;</span><span class="cls_039"> tag here is different from the </span><span class="cls_059">&lt;form&gt;</span><span class="cls_039"> tag</span></div>
<div style="position:absolute;left:102.18px;top:480.68px" class="cls_039"><span class="cls_039">used in listing 2.3 in that it also specifies a form action. Without an action specified,</span></div>
<div style="position:absolute;left:102.18px;top:493.67px" class="cls_039"><span class="cls_039">the form would submit an HTTP POST request back to the same URL that presented</span></div>
<div style="position:absolute;left:102.18px;top:506.66px" class="cls_039"><span class="cls_039">the form. But here, you specify that the form should be POSTed to /orders (using</span></div>
<div style="position:absolute;left:102.18px;top:519.68px" class="cls_039"><span class="cls_039">Thymeleaf’s </span><span class="cls_059">@{…}</span><span class="cls_039"> operator for a context-relative path).</span></div>
<div style="position:absolute;left:116.76px;top:532.67px" class="cls_039"><span class="cls_039">Therefore, you’re going to need to add another method to your </span><span class="cls_059">OrderController</span></div>
<div style="position:absolute;left:102.18px;top:545.66px" class="cls_039"><span class="cls_039">class that handles POST requests for /orders. You won’t have a way to persist orders</span></div>
<div style="position:absolute;left:102.18px;top:558.68px" class="cls_039"><span class="cls_039">until the next chapter, so you’ll keep it simple here—something like what you see in</span></div>
<div style="position:absolute;left:102.18px;top:571.67px" class="cls_039"><span class="cls_039">the next listing.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:42584px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background066.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">44</span></div>
<div style="position:absolute;left:187.80px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 2</span></div>
<div style="position:absolute;left:231.93px;top:24.35px" class="cls_055"><span class="cls_055">Developing web applications</span></div>
<div style="position:absolute;left:105.18px;top:54.38px" class="cls_066"><span class="cls_066">Listing 2.8</span></div>
<div style="position:absolute;left:157.28px;top:54.38px" class="cls_066"><span class="cls_066">Handling a taco order submission</span></div>
<div style="position:absolute;left:93.18px;top:73.22px" class="cls_060"><span class="cls_060">@PostMapping</span></div>
<div style="position:absolute;left:93.18px;top:83.24px" class="cls_060"><span class="cls_060">public String processOrder(Order order) {</span></div>
<div style="position:absolute;left:102.78px;top:93.23px" class="cls_060"><span class="cls_060">log.info("Order submitted: " + order);</span></div>
<div style="position:absolute;left:102.78px;top:103.22px" class="cls_060"><span class="cls_060">return "redirect:/";</span></div>
<div style="position:absolute;left:93.18px;top:113.24px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:136.55px" class="cls_039"><span class="cls_039">When the </span><span class="cls_059">processOrder()</span><span class="cls_039"> method is called to handle a submitted order, it’s given an</span></div>
<div style="position:absolute;left:93.18px;top:149.57px" class="cls_059"><span class="cls_059">Order</span><span class="cls_039"> object whose properties are bound to the submitted form fields. </span><span class="cls_059">Order</span><span class="cls_039">, much</span></div>
<div style="position:absolute;left:93.18px;top:162.56px" class="cls_039"><span class="cls_039">like </span><span class="cls_059">Taco</span><span class="cls_039">, is a fairly straightforward class that carries order information.</span></div>
<div style="position:absolute;left:105.18px;top:186.29px" class="cls_066"><span class="cls_066">Listing 2.9</span></div>
<div style="position:absolute;left:157.26px;top:186.29px" class="cls_066"><span class="cls_066">A domain object for taco orders</span></div>
<div style="position:absolute;left:93.18px;top:206.15px" class="cls_060"><span class="cls_060">package tacos;</span></div>
<div style="position:absolute;left:93.18px;top:216.14px" class="cls_060"><span class="cls_060">import javax.validation.constraints.Digits;</span></div>
<div style="position:absolute;left:93.18px;top:226.13px" class="cls_060"><span class="cls_060">import javax.validation.constraints.Pattern;</span></div>
<div style="position:absolute;left:93.18px;top:236.15px" class="cls_060"><span class="cls_060">import org.hibernate.validator.constraints.CreditCardNumber;</span></div>
<div style="position:absolute;left:93.18px;top:246.14px" class="cls_060"><span class="cls_060">import org.hibernate.validator.constraints.NotBlank;</span></div>
<div style="position:absolute;left:93.18px;top:256.13px" class="cls_060"><span class="cls_060">import lombok.Data;</span></div>
<div style="position:absolute;left:93.18px;top:276.14px" class="cls_060"><span class="cls_060">@Data</span></div>
<div style="position:absolute;left:93.18px;top:286.13px" class="cls_060"><span class="cls_060">public class Order {</span></div>
<div style="position:absolute;left:102.77px;top:306.14px" class="cls_060"><span class="cls_060">private String name;</span></div>
<div style="position:absolute;left:102.77px;top:316.13px" class="cls_060"><span class="cls_060">private String street;</span></div>
<div style="position:absolute;left:102.77px;top:326.15px" class="cls_060"><span class="cls_060">private String city;</span></div>
<div style="position:absolute;left:102.77px;top:336.14px" class="cls_060"><span class="cls_060">private String state;</span></div>
<div style="position:absolute;left:102.77px;top:346.13px" class="cls_060"><span class="cls_060">private String zip;</span></div>
<div style="position:absolute;left:102.77px;top:356.15px" class="cls_060"><span class="cls_060">private String ccNumber;</span></div>
<div style="position:absolute;left:102.77px;top:366.14px" class="cls_060"><span class="cls_060">private String ccExpiration;</span></div>
<div style="position:absolute;left:102.77px;top:376.13px" class="cls_060"><span class="cls_060">private String ccCVV;</span></div>
<div style="position:absolute;left:93.18px;top:396.14px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:419.48px" class="cls_039"><span class="cls_039">Now that you’ve developed an </span><span class="cls_059">OrderController</span><span class="cls_039"> and the order form view, you’re</span></div>
<div style="position:absolute;left:93.18px;top:432.47px" class="cls_039"><span class="cls_039">ready to try it out. Open your browser to </span><a href="http://localhost:8080/design">http://localhost:8080/design</a> <span class="cls_039">, select some</span></div>
<div style="position:absolute;left:93.18px;top:445.46px" class="cls_039"><span class="cls_039">ingredients for your taco, and click the Submit Your Taco button. You should see a</span></div>
<div style="position:absolute;left:93.18px;top:458.48px" class="cls_039"><span class="cls_039">form similar to what’s shown in figure 2.3.</span></div>
<div style="position:absolute;left:107.58px;top:471.47px" class="cls_039"><span class="cls_039">Fill in some fields in the form, and press the Submit Order button. As you do, keep</span></div>
<div style="position:absolute;left:93.18px;top:484.46px" class="cls_039"><span class="cls_039">an eye on the application logs to see your order information. When I tried it, the log</span></div>
<div style="position:absolute;left:93.18px;top:497.48px" class="cls_039"><span class="cls_039">entry looked something like this (reformatted to fit the width of this page):</span></div>
<div style="position:absolute;left:93.18px;top:517.16px" class="cls_060"><span class="cls_060">Order submitted: Order(name=Craig Walls,street1=1234 7th Street,</span></div>
<div style="position:absolute;left:117.18px;top:527.15px" class="cls_060"><span class="cls_060">city=Somewhere, state=Who knows?, zip=zipzap, ccNumber=Who can guess?,</span></div>
<div style="position:absolute;left:93.18px;top:537.14px" class="cls_061"><span class="cls_061">ccExpiration=Some day, ccCVV=See-vee-vee)</span></div>
<div style="position:absolute;left:93.18px;top:560.48px" class="cls_039"><span class="cls_039">If you look carefully at the log entry from my test order, you can see that although the</span></div>
<div style="position:absolute;left:93.18px;top:573.47px" class="cls_059"><span class="cls_059">processOrder()</span><span class="cls_039"> method did its job and handled the form submission, it let a little bit</span></div>
<div style="position:absolute;left:93.18px;top:586.49px" class="cls_039"><span class="cls_039">of bad information get in. Most of the fields in the form contained data that couldn’t</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:43260px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background067.jpg" width="531" height="666"></div>
<div style="position:absolute;left:231.09px;top:24.35px" class="cls_055"><span class="cls_055">Validating form input</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">45</span></div>
<div style="position:absolute;left:102.18px;top:445.22px" class="cls_053"><span class="cls_053">Figure 2.3</span></div>
<div style="position:absolute;left:146.78px;top:445.22px" class="cls_053"><span class="cls_053">The taco order form</span></div>
<div style="position:absolute;left:102.18px;top:475.40px" class="cls_039"><span class="cls_039">possibly be correct. Let’s add some validation to ensure that the data provided at least</span></div>
<div style="position:absolute;left:102.18px;top:488.39px" class="cls_039"><span class="cls_039">resembles the kind of information required.</span></div>
<div style="position:absolute;left:66.18px;top:509.56px" class="cls_040"><span class="cls_040">2.3</span></div>
<div style="position:absolute;left:102.18px;top:509.56px" class="cls_040"><span class="cls_040">Validating form input</span></div>
<div style="position:absolute;left:102.18px;top:527.39px" class="cls_039"><span class="cls_039">When designing a new taco creation, what if the user selects no ingredients or fails to</span></div>
<div style="position:absolute;left:102.18px;top:540.38px" class="cls_039"><span class="cls_039">specify a name for their creation? When submitting the order, what if they fail to fill in</span></div>
<div style="position:absolute;left:102.18px;top:553.40px" class="cls_039"><span class="cls_039">the required address fields? Or what if they enter a value into the credit card field that</span></div>
<div style="position:absolute;left:102.18px;top:566.39px" class="cls_039"><span class="cls_039">isn’t even a valid credit card number?</span></div>
<div style="position:absolute;left:117.57px;top:579.38px" class="cls_039"><span class="cls_039">As things stand now, nothing will stop the user from creating a taco without any</span></div>
<div style="position:absolute;left:102.18px;top:592.40px" class="cls_039"><span class="cls_039">ingredients or with an empty delivery address, or even submitting the lyrics to their</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:43936px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background068.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">46</span></div>
<div style="position:absolute;left:187.80px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 2</span></div>
<div style="position:absolute;left:231.93px;top:24.35px" class="cls_055"><span class="cls_055">Developing web applications</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">favorite song as the credit card number. That’s because you haven’t yet specified how</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">those fields should be validated.</span></div>
<div style="position:absolute;left:107.61px;top:76.67px" class="cls_039"><span class="cls_039">One way to perform form validation is to litter the </span><span class="cls_059">processDesign()</span><span class="cls_039"> and </span><span class="cls_059">process-</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_059"><span class="cls_059">Order()</span><span class="cls_039"> methods with a bunch of </span><span class="cls_059">if</span><span class="cls_039">/</span><span class="cls_059">then</span><span class="cls_039"> blocks, checking each and every field to</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">ensure that it meets the appropriate validation rules. But that would be cumbersome</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">and difficult to read and debug.</span></div>
<div style="position:absolute;left:108.78px;top:128.66px" class="cls_039"><span class="cls_039">Fortunately, Spring supports Java’s Bean Validation API (also known as JSR-303;</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_045"><span class="cls_045"> </span><a href="https://jcp.org/en/jsr/detail?id=303">https://jcp.org/en/jsr/detail?id=303</a> <span class="cls_039">). This makes it easy to declare validation rules</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_039"><span class="cls_039">as opposed to explicitly writing declaration logic in your application code. And with</span></div>
<div style="position:absolute;left:93.18px;top:167.66px" class="cls_039"><span class="cls_039">Spring Boot, you don’t need to do anything special to add validation libraries to your</span></div>
<div style="position:absolute;left:93.18px;top:180.65px" class="cls_039"><span class="cls_039">project, because the Validation API and the Hibernate implementation of the Valida-</span></div>
<div style="position:absolute;left:93.18px;top:193.67px" class="cls_039"><span class="cls_039">tion API are automatically added to the project as transient dependencies of Spring</span></div>
<div style="position:absolute;left:93.18px;top:206.66px" class="cls_039"><span class="cls_039">Boot’s web starter.</span></div>
<div style="position:absolute;left:107.78px;top:219.65px" class="cls_039"><span class="cls_039">To apply validation in Spring MVC, you need to</span></div>
<div style="position:absolute;left:108.78px;top:236.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Declare validation rules on the class that is to be validated: specifically, the</span></div>
<div style="position:absolute;left:120.78px;top:249.65px" class="cls_059"><span class="cls_059">Taco</span><span class="cls_039"> class.</span></div>
<div style="position:absolute;left:108.78px;top:263.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Specify that validation should be performed in the controller methods that</span></div>
<div style="position:absolute;left:120.78px;top:276.65px" class="cls_039"><span class="cls_039">require validation: specifically, the </span><span class="cls_059">DesignTacoController</span><span class="cls_039">’s </span><span class="cls_059">processDesign()</span></div>
<div style="position:absolute;left:120.78px;top:289.67px" class="cls_039"><span class="cls_039">method and </span><span class="cls_059">OrderController</span><span class="cls_039">’s </span><span class="cls_059">processOrder()</span><span class="cls_039"> method.</span></div>
<div style="position:absolute;left:108.78px;top:303.68px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Modify the form views to display validation errors.</span></div>
<div style="position:absolute;left:93.18px;top:321.68px" class="cls_039"><span class="cls_039">The Validation API offers several annotations that can be placed on properties of</span></div>
<div style="position:absolute;left:93.18px;top:334.67px" class="cls_039"><span class="cls_039">domain objects to declare validation rules. Hibernate’s implementation of the Valida-</span></div>
<div style="position:absolute;left:93.18px;top:347.66px" class="cls_039"><span class="cls_039">tion API adds even more validation annotations. Let’s see how you can apply a few of</span></div>
<div style="position:absolute;left:93.18px;top:360.68px" class="cls_039"><span class="cls_039">these annotations to validate a submitted </span><span class="cls_059">Taco</span><span class="cls_039"> or </span><span class="cls_059">Order</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:57.18px;top:386.48px" class="cls_063"><span class="cls_063">2.3.1</span></div>
<div style="position:absolute;left:93.18px;top:386.48px" class="cls_063"><span class="cls_063">Declaring validation rules</span></div>
<div style="position:absolute;left:93.18px;top:404.18px" class="cls_039"><span class="cls_039">For the </span><span class="cls_059">Taco</span><span class="cls_039"> class, you want to ensure that the </span><span class="cls_059">name</span><span class="cls_039"> property isn’t empty or </span><span class="cls_059">null</span><span class="cls_039"> and</span></div>
<div style="position:absolute;left:93.18px;top:417.17px" class="cls_039"><span class="cls_039">that the list of selected ingredients has at least one item. The following listing shows</span></div>
<div style="position:absolute;left:93.18px;top:430.16px" class="cls_039"><span class="cls_039">an updated </span><span class="cls_059">Taco</span><span class="cls_039"> class that uses </span><span class="cls_059">@NotNull</span><span class="cls_039"> and </span><span class="cls_059">@Size</span><span class="cls_039"> to declare those validation rules.</span></div>
<div style="position:absolute;left:105.18px;top:457.16px" class="cls_066"><span class="cls_066">Listing 2.10</span></div>
<div style="position:absolute;left:162.68px;top:456.77px" class="cls_066"><span class="cls_066">Adding validation to the </span><span class="cls_077">Taco</span><span class="cls_066"> domain class</span></div>
<div style="position:absolute;left:93.18px;top:477.14px" class="cls_060"><span class="cls_060">package tacos;</span></div>
<div style="position:absolute;left:93.18px;top:487.16px" class="cls_060"><span class="cls_060">import java.util.List;</span></div>
<div style="position:absolute;left:93.18px;top:497.15px" class="cls_060"><span class="cls_060">import javax.validation.constraints.NotNull;</span></div>
<div style="position:absolute;left:93.18px;top:507.14px" class="cls_060"><span class="cls_060">import javax.validation.constraints.Size;</span></div>
<div style="position:absolute;left:93.18px;top:517.16px" class="cls_060"><span class="cls_060">import lombok.Data;</span></div>
<div style="position:absolute;left:93.18px;top:537.14px" class="cls_060"><span class="cls_060">@Data</span></div>
<div style="position:absolute;left:93.18px;top:547.16px" class="cls_060"><span class="cls_060">public class Taco {</span></div>
<div style="position:absolute;left:102.78px;top:567.14px" class="cls_060"><span class="cls_060">@NotNull</span></div>
<div style="position:absolute;left:102.78px;top:577.16px" class="cls_060"><span class="cls_060">@Size(min=5, message="Name must be at least 5 characters long")</span></div>
<div style="position:absolute;left:102.76px;top:587.15px" class="cls_060"><span class="cls_060">private String name;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:44612px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background069.jpg" width="531" height="666"></div>
<div style="position:absolute;left:231.09px;top:24.35px" class="cls_055"><span class="cls_055">Validating form input</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">47</span></div>
<div style="position:absolute;left:111.78px;top:51.32px" class="cls_060"><span class="cls_060">@Size(min=1, message="You must choose at least 1 ingredient")</span></div>
<div style="position:absolute;left:111.78px;top:61.34px" class="cls_060"><span class="cls_060">private List&lt;String&gt; ingredients;</span></div>
<div style="position:absolute;left:102.18px;top:81.32px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:104.66px" class="cls_039"><span class="cls_039">You’ll notice that in addition to requiring that the </span><span class="cls_059">name</span><span class="cls_039"> property isn’t </span><span class="cls_059">null</span><span class="cls_039">, you</span></div>
<div style="position:absolute;left:102.18px;top:117.65px" class="cls_039"><span class="cls_039">declare that it should have a value that’s at least 5 characters in length.</span></div>
<div style="position:absolute;left:117.57px;top:130.67px" class="cls_039"><span class="cls_039">When it comes to declaring validation on submitted taco orders, you must apply</span></div>
<div style="position:absolute;left:102.18px;top:143.66px" class="cls_039"><span class="cls_039">annotations to the </span><span class="cls_059">Order</span><span class="cls_039"> class. For the address properties, you only want to be sure</span></div>
<div style="position:absolute;left:102.18px;top:156.65px" class="cls_039"><span class="cls_039">that the user doesn’t leave any of the fields blank. For that, you’ll use Hibernate Vali-</span></div>
<div style="position:absolute;left:102.18px;top:169.67px" class="cls_039"><span class="cls_039">dator’s </span><span class="cls_059">@NotBlank</span><span class="cls_039"> annotation.</span></div>
<div style="position:absolute;left:117.71px;top:182.66px" class="cls_039"><span class="cls_039">Validation of the payment fields, however, is a bit more exotic. You need to not</span></div>
<div style="position:absolute;left:102.18px;top:195.65px" class="cls_039"><span class="cls_039">only ensure that the </span><span class="cls_059">ccNumber</span><span class="cls_039"> property isn’t empty, but that it contains a value that</span></div>
<div style="position:absolute;left:102.18px;top:208.67px" class="cls_039"><span class="cls_039">could be a valid credit card number. The </span><span class="cls_059">ccExpiration</span><span class="cls_039"> property must conform to</span></div>
<div style="position:absolute;left:102.18px;top:221.66px" class="cls_039"><span class="cls_039">a format of MM/YY (two-digit month and year). And the </span><span class="cls_059">ccCVV</span><span class="cls_039"> property needs to be a</span></div>
<div style="position:absolute;left:102.18px;top:234.65px" class="cls_039"><span class="cls_039">three-digit number. To achieve this kind of validation, you need to use a few other Java</span></div>
<div style="position:absolute;left:102.18px;top:247.67px" class="cls_039"><span class="cls_039">Bean Validation API annotations and borrow a validation annotation from the Hiber-</span></div>
<div style="position:absolute;left:102.18px;top:260.66px" class="cls_039"><span class="cls_039">nate Validator collection of annotations. The following listing shows the changes</span></div>
<div style="position:absolute;left:102.18px;top:273.65px" class="cls_039"><span class="cls_039">needed to validate the </span><span class="cls_059">Order</span><span class="cls_039"> class.</span></div>
<div style="position:absolute;left:114.18px;top:300.38px" class="cls_066"><span class="cls_066">Listing 2.11</span></div>
<div style="position:absolute;left:171.68px;top:300.38px" class="cls_066"><span class="cls_066">Validating order fields</span></div>
<div style="position:absolute;left:102.18px;top:320.24px" class="cls_060"><span class="cls_060">package tacos;</span></div>
<div style="position:absolute;left:102.18px;top:330.23px" class="cls_060"><span class="cls_060">import javax.validation.constraints.Digits;</span></div>
<div style="position:absolute;left:102.18px;top:340.25px" class="cls_060"><span class="cls_060">import javax.validation.constraints.Pattern;</span></div>
<div style="position:absolute;left:102.18px;top:350.24px" class="cls_060"><span class="cls_060">import org.hibernate.validator.constraints.CreditCardNumber;</span></div>
<div style="position:absolute;left:102.18px;top:360.23px" class="cls_060"><span class="cls_060">import javax.validation.constraints.NotBlank;</span></div>
<div style="position:absolute;left:102.18px;top:370.25px" class="cls_060"><span class="cls_060">import lombok.Data;</span></div>
<div style="position:absolute;left:102.18px;top:390.26px" class="cls_060"><span class="cls_060">@Data</span></div>
<div style="position:absolute;left:102.18px;top:400.25px" class="cls_060"><span class="cls_060">public class Order {</span></div>
<div style="position:absolute;left:111.78px;top:420.26px" class="cls_060"><span class="cls_060">@NotBlank(message="Name is required")</span></div>
<div style="position:absolute;left:111.78px;top:430.25px" class="cls_060"><span class="cls_060">private String name;</span></div>
<div style="position:absolute;left:111.78px;top:450.26px" class="cls_060"><span class="cls_060">@NotBlank(message="Street is required")</span></div>
<div style="position:absolute;left:111.78px;top:460.25px" class="cls_060"><span class="cls_060">private String street;</span></div>
<div style="position:absolute;left:111.78px;top:480.26px" class="cls_060"><span class="cls_060">@NotBlank(message="City is required")</span></div>
<div style="position:absolute;left:111.78px;top:490.25px" class="cls_060"><span class="cls_060">private String city;</span></div>
<div style="position:absolute;left:111.76px;top:510.26px" class="cls_060"><span class="cls_060">@NotBlank(message="State is required")</span></div>
<div style="position:absolute;left:111.78px;top:520.25px" class="cls_060"><span class="cls_060">private String state;</span></div>
<div style="position:absolute;left:111.77px;top:540.26px" class="cls_060"><span class="cls_060">@NotBlank(message="Zip code is required")</span></div>
<div style="position:absolute;left:111.78px;top:550.25px" class="cls_060"><span class="cls_060">private String zip;</span></div>
<div style="position:absolute;left:111.78px;top:570.26px" class="cls_060"><span class="cls_060">@CreditCardNumber(message="Not a valid credit card number")</span></div>
<div style="position:absolute;left:111.78px;top:580.25px" class="cls_060"><span class="cls_060">private String ccNumber;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:45288px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background070.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">48</span></div>
<div style="position:absolute;left:187.80px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 2</span></div>
<div style="position:absolute;left:231.93px;top:24.35px" class="cls_055"><span class="cls_055">Developing web applications</span></div>
<div style="position:absolute;left:102.78px;top:51.32px" class="cls_060"><span class="cls_060">@Pattern(regexp="^(0[1-9]|1[0-2])([\\/])([1-9][0-9])$",</span></div>
<div style="position:absolute;left:145.96px;top:61.34px" class="cls_060"><span class="cls_060">message="Must be formatted MM/YY")</span></div>
<div style="position:absolute;left:102.77px;top:71.33px" class="cls_060"><span class="cls_060">private String ccExpiration;</span></div>
<div style="position:absolute;left:102.78px;top:91.34px" class="cls_060"><span class="cls_060">@Digits(integer=3, fraction=0, message="Invalid CVV")</span></div>
<div style="position:absolute;left:102.76px;top:101.33px" class="cls_060"><span class="cls_060">private String ccCVV;</span></div>
<div style="position:absolute;left:93.18px;top:121.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:142.67px" class="cls_039"><span class="cls_039">As you can see, the </span><span class="cls_059">ccNumber</span><span class="cls_039"> property is annotated with </span><span class="cls_059">@CreditCardNumber</span><span class="cls_039">. This</span></div>
<div style="position:absolute;left:93.18px;top:155.66px" class="cls_039"><span class="cls_039">annotation declares that the property’s value must be a valid credit card number that</span></div>
<div style="position:absolute;left:93.18px;top:168.65px" class="cls_039"><span class="cls_039">passes the Luhn algorithm check (</span><a href="https://en.wikipedia.org/wiki/Luhn_algorithm">https://en.wikipedia.org/wiki/Luhn_algorithm</a> <span class="cls_039">).</span></div>
<div style="position:absolute;left:93.18px;top:181.67px" class="cls_039"><span class="cls_039">This prevents user mistakes and deliberately bad data but doesn’t guarantee that the</span></div>
<div style="position:absolute;left:93.18px;top:194.66px" class="cls_039"><span class="cls_039">credit card number is actually assigned to an account or that the account can be used</span></div>
<div style="position:absolute;left:93.18px;top:207.65px" class="cls_039"><span class="cls_039">for charging.</span></div>
<div style="position:absolute;left:107.53px;top:220.67px" class="cls_039"><span class="cls_039">Unfortunately, there’s no ready-made annotation for validating the MM/YY format</span></div>
<div style="position:absolute;left:93.18px;top:233.66px" class="cls_039"><span class="cls_039">of the </span><span class="cls_059">ccExpiration</span><span class="cls_039"> property. I’ve applied the </span><span class="cls_059">@Pattern</span><span class="cls_039"> annotation, providing it with</span></div>
<div style="position:absolute;left:93.18px;top:246.65px" class="cls_039"><span class="cls_039">a regular expression that ensures that the property value adheres to the desired for-</span></div>
<div style="position:absolute;left:93.18px;top:259.67px" class="cls_039"><span class="cls_039">mat. If you’re wondering how to decipher the regular expression, I encourage you to</span></div>
<div style="position:absolute;left:93.18px;top:272.66px" class="cls_039"><span class="cls_039">check out the many online regular expression guides, including </span><a href="http://www.regular-expressions.info/">http://www.regular-</a> </div>
<div style="position:absolute;left:93.18px;top:285.65px" class="cls_045"><span class="cls_045"> </span><a href="http://www.regular-expressions.info/">expressions.info/</a> <span class="cls_039">. Regular expression syntax is a dark art and certainly outside the</span></div>
<div style="position:absolute;left:93.18px;top:298.67px" class="cls_039"><span class="cls_039">scope of this book.</span></div>
<div style="position:absolute;left:107.70px;top:311.66px" class="cls_039"><span class="cls_039">Finally, the </span><span class="cls_059">ccCVV</span><span class="cls_039"> property is annotated with </span><span class="cls_059">@Digits</span><span class="cls_039"> to ensure that the value con-</span></div>
<div style="position:absolute;left:93.18px;top:324.68px" class="cls_039"><span class="cls_039">tains exactly three numeric digits.</span></div>
<div style="position:absolute;left:108.04px;top:337.67px" class="cls_039"><span class="cls_039">All of the validation annotations include a </span><span class="cls_059">message</span><span class="cls_039"> attribute that defines the mes-</span></div>
<div style="position:absolute;left:93.18px;top:350.66px" class="cls_039"><span class="cls_039">sage you’ll display to the user if the information they enter doesn’t meet the require-</span></div>
<div style="position:absolute;left:93.18px;top:363.68px" class="cls_039"><span class="cls_039">ments of the declared validation rules.</span></div>
<div style="position:absolute;left:57.18px;top:388.49px" class="cls_063"><span class="cls_063">2.3.2</span></div>
<div style="position:absolute;left:93.18px;top:388.49px" class="cls_063"><span class="cls_063">Performing validation at form binding</span></div>
<div style="position:absolute;left:93.18px;top:406.16px" class="cls_039"><span class="cls_039">Now that you’ve declared how a </span><span class="cls_059">Taco</span><span class="cls_039"> and </span><span class="cls_059">Order</span><span class="cls_039"> should be validated, we need to</span></div>
<div style="position:absolute;left:93.18px;top:419.18px" class="cls_039"><span class="cls_039">revisit each of the controllers, specifying that validation should be performed when</span></div>
<div style="position:absolute;left:93.18px;top:432.17px" class="cls_039"><span class="cls_039">the forms are POSTed to their respective handler methods.</span></div>
<div style="position:absolute;left:107.54px;top:445.16px" class="cls_039"><span class="cls_039">To validate a submitted </span><span class="cls_059">Taco</span><span class="cls_039">, you need to add the Java Bean Validation API’s </span><span class="cls_059">@Valid</span></div>
<div style="position:absolute;left:93.18px;top:458.18px" class="cls_039"><span class="cls_039">annotation to the </span><span class="cls_059">Taco</span><span class="cls_039"> argument of </span><span class="cls_059">DesignTacoController</span><span class="cls_039">’s </span><span class="cls_059">processDesign()</span><span class="cls_039"> method.</span></div>
<div style="position:absolute;left:105.18px;top:482.15px" class="cls_066"><span class="cls_066">Listing 2.12</span></div>
<div style="position:absolute;left:162.66px;top:481.76px" class="cls_066"><span class="cls_066">Validating a POSTed </span><span class="cls_077">Taco</span></div>
<div style="position:absolute;left:93.18px;top:502.16px" class="cls_060"><span class="cls_060">@PostMapping</span></div>
<div style="position:absolute;left:93.18px;top:512.15px" class="cls_060"><span class="cls_060">public String processDesign(@Valid Taco design, Errors errors) {</span></div>
<div style="position:absolute;left:102.77px;top:522.14px" class="cls_060"><span class="cls_060">if (errors.hasErrors()) {</span></div>
<div style="position:absolute;left:112.38px;top:532.16px" class="cls_060"><span class="cls_060">return "design";</span></div>
<div style="position:absolute;left:102.78px;top:542.15px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.77px;top:562.16px" class="cls_060"><span class="cls_060">// Save the taco design...</span></div>
<div style="position:absolute;left:102.77px;top:572.15px" class="cls_060"><span class="cls_060">// We'll do this in chapter 3</span></div>
<div style="position:absolute;left:102.78px;top:582.14px" class="cls_060"><span class="cls_060">log.info("Processing design: " + design);</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:45964px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background071.jpg" width="531" height="666"></div>
<div style="position:absolute;left:231.09px;top:24.35px" class="cls_055"><span class="cls_055">Validating form input</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">49</span></div>
<div style="position:absolute;left:111.78px;top:51.32px" class="cls_060"><span class="cls_060">return "redirect:/orders/current";</span></div>
<div style="position:absolute;left:102.18px;top:61.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:82.67px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">@Valid</span><span class="cls_039"> annotation tells Spring MVC to perform validation on the submitted </span><span class="cls_059">Taco</span></div>
<div style="position:absolute;left:102.18px;top:95.66px" class="cls_039"><span class="cls_039">object after it’s bound to the submitted form data and before the </span><span class="cls_059">processDesign()</span></div>
<div style="position:absolute;left:102.18px;top:108.65px" class="cls_039"><span class="cls_039">method is called. If there are any validation errors, the details of those errors will be</span></div>
<div style="position:absolute;left:102.18px;top:121.67px" class="cls_039"><span class="cls_039">captured in an </span><span class="cls_059">Errors</span><span class="cls_039"> object that’s passed into </span><span class="cls_059">processDesign()</span><span class="cls_039">. The first few lines</span></div>
<div style="position:absolute;left:102.18px;top:134.66px" class="cls_039"><span class="cls_039">of </span><span class="cls_059">processDesign()</span><span class="cls_039"> consult the </span><span class="cls_059">Errors</span><span class="cls_039"> object, asking its </span><span class="cls_059">hasErrors()</span><span class="cls_039"> method if</span></div>
<div style="position:absolute;left:102.18px;top:147.65px" class="cls_039"><span class="cls_039">there are any validation errors. If there are, the method concludes without processing</span></div>
<div style="position:absolute;left:102.18px;top:160.67px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">Taco</span><span class="cls_039"> and returns the </span><span class="cls_059">"design"</span><span class="cls_039"> view name so that the form is redisplayed.</span></div>
<div style="position:absolute;left:116.70px;top:173.66px" class="cls_039"><span class="cls_039">To perform validation on submitted </span><span class="cls_059">Order</span><span class="cls_039"> objects, similar changes are also required</span></div>
<div style="position:absolute;left:102.18px;top:186.65px" class="cls_039"><span class="cls_039">in the </span><span class="cls_059">processOrder()</span><span class="cls_039"> method of </span><span class="cls_059">OrderController</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:114.18px;top:210.65px" class="cls_066"><span class="cls_066">Listing 2.13</span></div>
<div style="position:absolute;left:171.66px;top:210.26px" class="cls_066"><span class="cls_066">Validating a POSTed </span><span class="cls_077">Order</span></div>
<div style="position:absolute;left:102.18px;top:230.63px" class="cls_060"><span class="cls_060">@PostMapping</span></div>
<div style="position:absolute;left:102.18px;top:240.65px" class="cls_060"><span class="cls_060">public String processOrder(@Valid Order order, Errors errors) {</span></div>
<div style="position:absolute;left:111.77px;top:250.64px" class="cls_060"><span class="cls_060">if (errors.hasErrors()) {</span></div>
<div style="position:absolute;left:121.38px;top:260.63px" class="cls_060"><span class="cls_060">return "orderForm";</span></div>
<div style="position:absolute;left:111.78px;top:270.65px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.77px;top:290.63px" class="cls_060"><span class="cls_060">log.info("Order submitted: " + order);</span></div>
<div style="position:absolute;left:111.78px;top:300.65px" class="cls_060"><span class="cls_060">return "redirect:/";</span></div>
<div style="position:absolute;left:102.18px;top:310.64px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:331.97px" class="cls_039"><span class="cls_039">In both cases, the method will be allowed to process the submitted data if there are no</span></div>
<div style="position:absolute;left:102.18px;top:344.96px" class="cls_039"><span class="cls_039">validation errors. If there are validation errors, the request will be forwarded to the</span></div>
<div style="position:absolute;left:102.18px;top:357.98px" class="cls_039"><span class="cls_039">form view to give the user a chance to correct their mistakes.</span></div>
<div style="position:absolute;left:116.80px;top:370.97px" class="cls_039"><span class="cls_039">But how will the user know what mistakes require correction? Unless you call out</span></div>
<div style="position:absolute;left:102.18px;top:383.96px" class="cls_039"><span class="cls_039">the errors on the form, the user will be left guessing about how to successfully sub-</span></div>
<div style="position:absolute;left:102.18px;top:396.98px" class="cls_039"><span class="cls_039">mit the form.</span></div>
<div style="position:absolute;left:66.18px;top:418.79px" class="cls_063"><span class="cls_063">2.3.3</span></div>
<div style="position:absolute;left:102.18px;top:418.79px" class="cls_063"><span class="cls_063">Displaying validation errors</span></div>
<div style="position:absolute;left:102.18px;top:435.98px" class="cls_039"><span class="cls_039">Thymeleaf offers convenient access to the </span><span class="cls_059">Errors</span><span class="cls_039"> object via the </span><span class="cls_059">fields</span><span class="cls_039"> property and</span></div>
<div style="position:absolute;left:102.18px;top:448.97px" class="cls_039"><span class="cls_039">with its </span><span class="cls_059">th:errors</span><span class="cls_039"> attribute. For example, to display validation errors on the credit</span></div>
<div style="position:absolute;left:102.18px;top:461.96px" class="cls_039"><span class="cls_039">card number field, you can add a </span><span class="cls_059">&lt;span&gt;</span><span class="cls_039"> element that uses these error references to</span></div>
<div style="position:absolute;left:102.18px;top:474.98px" class="cls_039"><span class="cls_039">the order form template, as follows.</span></div>
<div style="position:absolute;left:114.18px;top:498.71px" class="cls_066"><span class="cls_066">Listing 2.14</span></div>
<div style="position:absolute;left:171.68px;top:498.71px" class="cls_066"><span class="cls_066">Displaying validation errors</span></div>
<div style="position:absolute;left:102.18px;top:518.54px" class="cls_060"><span class="cls_060">&lt;label for="ccNumber"&gt;Credit Card #: &lt;/label&gt;</span></div>
<div style="position:absolute;left:102.18px;top:528.56px" class="cls_060"><span class="cls_060">&lt;input type="text" th:field="*{ccNumber}"/&gt;</span></div>
<div style="position:absolute;left:102.18px;top:538.55px" class="cls_060"><span class="cls_060">&lt;span class="validationError"</span></div>
<div style="position:absolute;left:130.95px;top:548.54px" class="cls_060"><span class="cls_060">th:if="${#fields.hasErrors('ccNumber')}"</span></div>
<div style="position:absolute;left:130.96px;top:558.56px" class="cls_061"><span class="cls_061">th:errors="*{ccNumber}"&gt;CC Num Error&lt;/span&gt;</span></div>
<div style="position:absolute;left:102.18px;top:578.87px" class="cls_039"><span class="cls_039">Aside from a </span><span class="cls_059">class</span><span class="cls_039"> attribute that can be used to style the error so that it catches the</span></div>
<div style="position:absolute;left:102.18px;top:591.89px" class="cls_039"><span class="cls_039">user’s attention, the </span><span class="cls_059">&lt;span&gt;</span><span class="cls_039"> element uses a </span><span class="cls_059">th:if</span><span class="cls_039"> attribute to decide whether or not</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:46640px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background072.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">50</span></div>
<div style="position:absolute;left:187.80px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 2</span></div>
<div style="position:absolute;left:231.93px;top:24.35px" class="cls_055"><span class="cls_055">Developing web applications</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">to display the </span><span class="cls_059">&lt;span&gt;</span><span class="cls_039">. The </span><span class="cls_059">fields</span><span class="cls_039"> property’s </span><span class="cls_059">hasErrors()</span><span class="cls_039"> method checks if there are</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">any errors in the </span><span class="cls_059">ccNumber</span><span class="cls_039"> field. If so, the </span><span class="cls_059">&lt;span&gt;</span><span class="cls_039"> will be rendered.</span></div>
<div style="position:absolute;left:108.99px;top:76.67px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">th:errors</span><span class="cls_039"> attribute references the </span><span class="cls_059">ccNumber</span><span class="cls_039"> field and, assuming there are</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">errors for that field, it will replace the placeholder content of the </span><span class="cls_059">&lt;span&gt;</span><span class="cls_039"> element with</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">the validation message.</span></div>
<div style="position:absolute;left:108.76px;top:115.67px" class="cls_039"><span class="cls_039">If you were to sprinkle similar </span><span class="cls_059">&lt;span&gt;</span><span class="cls_039"> tags around the order form for the other</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">fields, you might see a form that looks like figure 2.4 when you submit invalid informa-</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">tion. The errors indicate that the name, city, and ZIP code fields have been left blank,</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_039"><span class="cls_039">and that all of the payment fields fail to meet the validation criteria.</span></div>
<div style="position:absolute;left:93.18px;top:574.31px" class="cls_053"><span class="cls_053">Figure 2.4</span></div>
<div style="position:absolute;left:137.78px;top:574.31px" class="cls_053"><span class="cls_053">Validation errors displayed on the order form</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:47316px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background073.jpg" width="531" height="666"></div>
<div style="position:absolute;left:216.78px;top:24.35px" class="cls_055"><span class="cls_055">Working with view controllers</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">51</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">Now your Taco Cloud controllers not only display and capture input, but they</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">also validate that the information meets some basic validation rules. Let’s step back</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">and reconsider the </span><span class="cls_059">HomeController</span><span class="cls_039"> from chapter 1, looking at an alternative</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">implementation.</span></div>
<div style="position:absolute;left:66.18px;top:110.83px" class="cls_040"><span class="cls_040">2.4</span></div>
<div style="position:absolute;left:102.18px;top:110.83px" class="cls_040"><span class="cls_040">Working with view controllers</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">Thus far, you’ve written three controllers for the Taco Cloud application. Although</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">each controller serves a distinct purpose in the functionality of the application, they</span></div>
<div style="position:absolute;left:102.18px;top:154.67px" class="cls_039"><span class="cls_039">all pretty much follow the same programming model:</span></div>
<div style="position:absolute;left:117.78px;top:171.65px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  They’re all annotated with </span><span class="cls_059">@Controller</span><span class="cls_039"> to indicate that they’re controller</span></div>
<div style="position:absolute;left:129.78px;top:184.67px" class="cls_039"><span class="cls_039">classes that should be automatically discovered by Spring component scanning</span></div>
<div style="position:absolute;left:129.78px;top:197.66px" class="cls_039"><span class="cls_039">and instantiated as beans in the Spring application context.</span></div>
<div style="position:absolute;left:117.78px;top:211.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  All but </span><span class="cls_059">HomeController</span><span class="cls_039"> are annotated with </span><span class="cls_059">@RequestMapping</span><span class="cls_039"> at the class level</span></div>
<div style="position:absolute;left:129.78px;top:224.66px" class="cls_039"><span class="cls_039">to define a baseline request pattern that the controller will handle.</span></div>
<div style="position:absolute;left:117.78px;top:238.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  They all have one or more methods that are annotated with </span><span class="cls_059">@GetMapping</span><span class="cls_039"> or</span></div>
<div style="position:absolute;left:129.78px;top:251.66px" class="cls_059"><span class="cls_059">@PostMapping</span><span class="cls_039"> to provide specifics on which methods should handle which</span></div>
<div style="position:absolute;left:129.78px;top:264.65px" class="cls_039"><span class="cls_039">kinds of requests.</span></div>
<div style="position:absolute;left:102.18px;top:282.65px" class="cls_039"><span class="cls_039">Most of the controllers you’ll write will follow that pattern. But when a controller is</span></div>
<div style="position:absolute;left:102.18px;top:295.67px" class="cls_039"><span class="cls_039">simple enough that it doesn’t populate a model or process input—as is the case with</span></div>
<div style="position:absolute;left:102.18px;top:308.66px" class="cls_039"><span class="cls_039">your </span><span class="cls_059">HomeController</span><span class="cls_039">—there’s another way that you can define the controller. Have a</span></div>
<div style="position:absolute;left:102.18px;top:321.68px" class="cls_039"><span class="cls_039">look at the next listing to see how you can declare a view controller—a controller that</span></div>
<div style="position:absolute;left:102.18px;top:334.67px" class="cls_039"><span class="cls_039">does nothing but forward the request to a view.</span></div>
<div style="position:absolute;left:114.18px;top:358.40px" class="cls_066"><span class="cls_066">Listing 2.15</span></div>
<div style="position:absolute;left:171.68px;top:358.40px" class="cls_066"><span class="cls_066">Declaring a view controller</span></div>
<div style="position:absolute;left:102.18px;top:378.26px" class="cls_060"><span class="cls_060">package tacos.web;</span></div>
<div style="position:absolute;left:102.18px;top:398.24px" class="cls_060"><span class="cls_060">import org.springframework.context.annotation.Configuration;</span></div>
<div style="position:absolute;left:102.18px;top:408.26px" class="cls_060"><span class="cls_060">import</span></div>
<div style="position:absolute;left:126.18px;top:418.25px" class="cls_060"><span class="cls_060">org.springframework.web.servlet.config.annotation.ViewControllerRegistry</span></div>
<div style="position:absolute;left:126.18px;top:428.24px" class="cls_060"><span class="cls_060">;</span></div>
<div style="position:absolute;left:102.18px;top:438.26px" class="cls_060"><span class="cls_060">import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span></div>
<div style="position:absolute;left:102.18px;top:458.24px" class="cls_060"><span class="cls_060">@Configuration</span></div>
<div style="position:absolute;left:102.18px;top:468.26px" class="cls_060"><span class="cls_060">public class WebConfig implements WebMvcConfigurer {</span></div>
<div style="position:absolute;left:111.78px;top:488.24px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:111.78px;top:498.26px" class="cls_060"><span class="cls_060">public void addViewControllers(ViewControllerRegistry registry) {</span></div>
<div style="position:absolute;left:121.38px;top:508.25px" class="cls_060"><span class="cls_060">registry.addViewController("/").setViewName("home");</span></div>
<div style="position:absolute;left:111.78px;top:518.24px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:538.25px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:559.58px" class="cls_039"><span class="cls_039">The most significant thing to notice about </span><span class="cls_059">@WebConfig</span><span class="cls_039"> is that it implements the </span><span class="cls_059">Web-</span></div>
<div style="position:absolute;left:102.18px;top:572.57px" class="cls_059"><span class="cls_059">MvcConfigurer</span><span class="cls_039"> interface. </span><span class="cls_059">WebMvcConfigurer</span><span class="cls_039"> defines several methods for configuring</span></div>
<div style="position:absolute;left:102.18px;top:585.59px" class="cls_039"><span class="cls_039">Spring MVC. Even though it’s an interface, it provides default implementations of all</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:47992px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background074.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">52</span></div>
<div style="position:absolute;left:187.80px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 2</span></div>
<div style="position:absolute;left:231.93px;top:24.35px" class="cls_055"><span class="cls_055">Developing web applications</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">the methods, so you only need to override the methods you need. In this case, you</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">override </span><span class="cls_059">addViewControllers()</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:108.09px;top:76.67px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">addViewControllers()</span><span class="cls_039"> method is given a </span><span class="cls_059">ViewControllerRegistry</span><span class="cls_039"> that you</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">can use to register one or more view controllers. Here, you call </span><span class="cls_059">addViewController()</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">on the registry, passing in </span><span class="cls_059">"/"</span><span class="cls_039">, which is the path for which your view controller will</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">handle GET requests. That method returns a </span><span class="cls_059">ViewControllerRegistration</span><span class="cls_039"> object,</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">on which you immediately call </span><span class="cls_059">setViewName()</span><span class="cls_039"> to specify </span><span class="cls_059">home</span><span class="cls_039"> as the view that a</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">request for </span><span class="cls_059">"/"</span><span class="cls_039"> should be forwarded to.</span></div>
<div style="position:absolute;left:107.63px;top:154.67px" class="cls_039"><span class="cls_039">And just like that, you’ve been able to replace </span><span class="cls_059">HomeController</span><span class="cls_039"> with a few lines in a</span></div>
<div style="position:absolute;left:93.18px;top:167.66px" class="cls_039"><span class="cls_039">configuration class. You can now delete </span><span class="cls_059">HomeController</span><span class="cls_039">, and the application should</span></div>
<div style="position:absolute;left:93.18px;top:180.65px" class="cls_039"><span class="cls_039">still behave as it did before. The only other change required is to revisit </span><span class="cls_059">Home-</span></div>
<div style="position:absolute;left:93.27px;top:193.67px" class="cls_059"><span class="cls_059">ControllerTest</span><span class="cls_039"> from chapter 1, removing the reference to </span><span class="cls_059">HomeController</span><span class="cls_039"> from the</span></div>
<div style="position:absolute;left:93.18px;top:206.66px" class="cls_059"><span class="cls_059">@WebMvcTest</span><span class="cls_039"> annotation, so that the test class will compile without errors.</span></div>
<div style="position:absolute;left:107.89px;top:219.65px" class="cls_039"><span class="cls_039">Here, you’ve created a new </span><span class="cls_059">WebConfig</span><span class="cls_039"> configuration class to house the view con-</span></div>
<div style="position:absolute;left:93.18px;top:232.67px" class="cls_039"><span class="cls_039">troller declaration. But any configuration class can implement </span><span class="cls_059">WebMvcConfigurer</span></div>
<div style="position:absolute;left:93.18px;top:245.66px" class="cls_039"><span class="cls_039">and override the </span><span class="cls_059">addViewController</span><span class="cls_039"> method. For instance, you could have added</span></div>
<div style="position:absolute;left:93.18px;top:258.65px" class="cls_039"><span class="cls_039">the same view controller declaration to the bootstrap </span><span class="cls_059">TacoCloudApplication</span><span class="cls_039"> class</span></div>
<div style="position:absolute;left:93.18px;top:271.67px" class="cls_039"><span class="cls_039">like this:</span></div>
<div style="position:absolute;left:93.18px;top:293.33px" class="cls_060"><span class="cls_060">@SpringBootApplication</span></div>
<div style="position:absolute;left:93.18px;top:303.35px" class="cls_060"><span class="cls_060">public class TacoCloudApplication implements WebMvcConfigurer {</span></div>
<div style="position:absolute;left:102.78px;top:323.33px" class="cls_060"><span class="cls_060">public static void main(String[] args) {</span></div>
<div style="position:absolute;left:112.35px;top:333.35px" class="cls_060"><span class="cls_060">SpringApplication.run(TacoCloudApplication.class, args);</span></div>
<div style="position:absolute;left:102.78px;top:343.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.78px;top:363.35px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:102.78px;top:373.34px" class="cls_060"><span class="cls_060">public void addViewControllers(ViewControllerRegistry registry) {</span></div>
<div style="position:absolute;left:112.38px;top:383.36px" class="cls_060"><span class="cls_060">registry.addViewController("/").setViewName("home");</span></div>
<div style="position:absolute;left:102.78px;top:393.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:413.36px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:436.67px" class="cls_039"><span class="cls_039">By extending an existing configuration class, you can avoid creating a new configura-</span></div>
<div style="position:absolute;left:93.18px;top:449.66px" class="cls_039"><span class="cls_039">tion class, keeping your project artifact count down. But I tend to prefer creating a</span></div>
<div style="position:absolute;left:93.18px;top:462.68px" class="cls_039"><span class="cls_039">new configuration class for each kind of configuration (web, data, security, and so</span></div>
<div style="position:absolute;left:93.18px;top:475.67px" class="cls_039"><span class="cls_039">on), keeping the application bootstrap configuration clean and simple.</span></div>
<div style="position:absolute;left:108.54px;top:488.66px" class="cls_039"><span class="cls_039">Speaking of view controllers, and more generically the views that controllers for-</span></div>
<div style="position:absolute;left:93.18px;top:501.68px" class="cls_039"><span class="cls_039">ward requests to, so far you’ve been using Thymeleaf for all of your views. I like</span></div>
<div style="position:absolute;left:93.18px;top:514.67px" class="cls_039"><span class="cls_039">Thymeleaf a lot, but maybe you prefer a different template model for your application</span></div>
<div style="position:absolute;left:93.18px;top:527.66px" class="cls_039"><span class="cls_039">views. Let’s have a look at Spring’s many supported view options.</span></div>
<div style="position:absolute;left:57.18px;top:552.85px" class="cls_040"><span class="cls_040">2.5</span></div>
<div style="position:absolute;left:93.18px;top:552.85px" class="cls_040"><span class="cls_040">Choosing a view template library</span></div>
<div style="position:absolute;left:93.18px;top:572.18px" class="cls_039"><span class="cls_039">For the most part, your choice of a view template library is a matter of personal taste.</span></div>
<div style="position:absolute;left:93.18px;top:585.17px" class="cls_039"><span class="cls_039">Spring is very flexible and supports many common templating options. With only a</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:48668px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background075.jpg" width="531" height="666"></div>
<div style="position:absolute;left:211.05px;top:24.35px" class="cls_055"><span class="cls_055">Choosing a view template library</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">53</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">few small exceptions, the template library you choose will itself have no idea that it’s</span></div>
<div style="position:absolute;left:102.18px;top:63.47px" class="cls_039"><span class="cls_039">even working with Spring.</span><span class="cls_069"><sup>3</sup></span></div>
<div style="position:absolute;left:116.36px;top:76.67px" class="cls_039"><span class="cls_039">Table 2.2 catalogs the template options supported by Spring Boot autoconfiguration.</span></div>
<div style="position:absolute;left:102.18px;top:99.32px" class="cls_053"><span class="cls_053">Table 2.2</span></div>
<div style="position:absolute;left:143.91px;top:99.32px" class="cls_053"><span class="cls_053">Supported template options</span></div>
<div style="position:absolute;left:144.09px;top:120.32px" class="cls_073"><span class="cls_073">Template</span></div>
<div style="position:absolute;left:289.92px;top:120.32px" class="cls_073"><span class="cls_073">Spring Boot starter dependency</span></div>
<div style="position:absolute;left:108.18px;top:139.34px" class="cls_074"><span class="cls_074">FreeMarker</span></div>
<div style="position:absolute;left:228.27px;top:139.34px" class="cls_060"><span class="cls_060">spring-boot-starter-freemarker</span></div>
<div style="position:absolute;left:108.18px;top:156.35px" class="cls_074"><span class="cls_074">Groovy Templates</span></div>
<div style="position:absolute;left:228.27px;top:156.35px" class="cls_060"><span class="cls_060">spring-boot-starter-groovy-templates</span></div>
<div style="position:absolute;left:108.18px;top:173.33px" class="cls_074"><span class="cls_074">JavaServer Pages (JSP)</span></div>
<div style="position:absolute;left:228.31px;top:173.33px" class="cls_074"><span class="cls_074">None (provided by Tomcat or Jetty)</span></div>
<div style="position:absolute;left:108.18px;top:190.34px" class="cls_074"><span class="cls_074">Mustache</span></div>
<div style="position:absolute;left:228.27px;top:190.34px" class="cls_060"><span class="cls_060">spring-boot-starter-mustache</span></div>
<div style="position:absolute;left:108.18px;top:207.35px" class="cls_074"><span class="cls_074">Thymeleaf</span></div>
<div style="position:absolute;left:228.27px;top:207.35px" class="cls_060"><span class="cls_060">spring-boot-starter-thymeleaf</span></div>
<div style="position:absolute;left:102.18px;top:235.67px" class="cls_039"><span class="cls_039">Generally speaking, you select the view template library you want, add it as a depen-</span></div>
<div style="position:absolute;left:102.18px;top:248.66px" class="cls_039"><span class="cls_039">dency in your build, and start writing templates in the /templates directory (under</span></div>
<div style="position:absolute;left:102.18px;top:261.65px" class="cls_039"><span class="cls_039">the src/main/resources directory in a Maven- or Gradle-built project). Spring Boot</span></div>
<div style="position:absolute;left:102.18px;top:274.67px" class="cls_039"><span class="cls_039">will detect your chosen template library and automatically configure the components</span></div>
<div style="position:absolute;left:102.18px;top:287.66px" class="cls_039"><span class="cls_039">required for it to serve views for your Spring MVC controllers.</span></div>
<div style="position:absolute;left:117.04px;top:300.68px" class="cls_039"><span class="cls_039">You’ve already done this with Thymeleaf for the Taco Cloud application. In chap-</span></div>
<div style="position:absolute;left:102.18px;top:313.67px" class="cls_039"><span class="cls_039">ter 1, you selected the Thymeleaf check box when initializing the project. This resulted</span></div>
<div style="position:absolute;left:102.18px;top:326.66px" class="cls_039"><span class="cls_039">in Spring Boot’s Thymeleaf starter being included in the pom.xml file. When the appli-</span></div>
<div style="position:absolute;left:102.18px;top:339.68px" class="cls_039"><span class="cls_039">cation starts up, Spring Boot autoconfiguration detects the presence of Thymeleaf and</span></div>
<div style="position:absolute;left:102.18px;top:352.67px" class="cls_039"><span class="cls_039">automatically configures the Thymeleaf beans for you. All you had to do was start writ-</span></div>
<div style="position:absolute;left:102.18px;top:365.66px" class="cls_039"><span class="cls_039">ing templates in /templates.</span></div>
<div style="position:absolute;left:116.53px;top:378.68px" class="cls_039"><span class="cls_039">If you’d rather use a different template library, you simply select it at project initial-</span></div>
<div style="position:absolute;left:102.18px;top:391.67px" class="cls_039"><span class="cls_039">ization or edit your existing project build to include the newly chosen template</span></div>
<div style="position:absolute;left:102.18px;top:404.66px" class="cls_039"><span class="cls_039">library.</span></div>
<div style="position:absolute;left:116.90px;top:417.68px" class="cls_039"><span class="cls_039">For example, let’s say you wanted to use Mustache instead of Thymeleaf. No prob-</span></div>
<div style="position:absolute;left:102.18px;top:430.67px" class="cls_039"><span class="cls_039">lem. Just visit the project pom.xml file and replace this,</span></div>
<div style="position:absolute;left:102.18px;top:450.35px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:111.78px;top:460.34px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:111.78px;top:470.36px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:102.18px;top:480.35px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:102.18px;top:501.68px" class="cls_039"><span class="cls_039">with this:</span></div>
<div style="position:absolute;left:102.18px;top:521.36px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:111.78px;top:531.35px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:111.78px;top:541.34px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-boot-starter-mustache&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:102.18px;top:551.36px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:66.18px;top:592.49px" class="cls_070"><span class="cls_070">3</span></div>
<div style="position:absolute;left:75.18px;top:592.67px" class="cls_071"><span class="cls_071">One such exception is Thymeleaf’s Spring Security dialect, which we’ll talk about in chapter 4.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:49344px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background076.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">54</span></div>
<div style="position:absolute;left:187.80px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 2</span></div>
<div style="position:absolute;left:231.93px;top:24.35px" class="cls_055"><span class="cls_055">Developing web applications</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">Of course, you’d need to make sure that you write all the templates with Mustache syn-</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">tax instead of Thymeleaf tags. The specifics of working with Mustache (or any of the</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">template language choices) is well outside of the scope of this book, but to give you an</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">idea of what to expect, here’s a snippet from a Mustache template that will render one</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">of the ingredient groups in the taco design form:</span></div>
<div style="position:absolute;left:93.18px;top:124.34px" class="cls_060"><span class="cls_060">&lt;h3&gt;Designate your wrap:&lt;/h3&gt;</span></div>
<div style="position:absolute;left:93.18px;top:134.33px" class="cls_060"><span class="cls_060">{{#wrap}}</span></div>
<div style="position:absolute;left:93.18px;top:144.35px" class="cls_060"><span class="cls_060">&lt;div&gt;</span></div>
<div style="position:absolute;left:102.78px;top:154.34px" class="cls_060"><span class="cls_060">&lt;input name="ingredients" type="checkbox" value="{{id}}" /&gt;</span></div>
<div style="position:absolute;left:102.78px;top:164.33px" class="cls_060"><span class="cls_060">&lt;span&gt;{{name}}&lt;/span&gt;&lt;br/&gt;</span></div>
<div style="position:absolute;left:93.18px;top:174.35px" class="cls_060"><span class="cls_060">&lt;/div&gt;</span></div>
<div style="position:absolute;left:93.18px;top:184.34px" class="cls_061"><span class="cls_061">{{/wrap}}</span></div>
<div style="position:absolute;left:93.18px;top:207.65px" class="cls_039"><span class="cls_039">This is the Mustache equivalent of the Thymeleaf snippet in section 2.1.3. The</span></div>
<div style="position:absolute;left:93.18px;top:220.67px" class="cls_059"><span class="cls_059">{{#wrap}}</span><span class="cls_039"> block (which concludes with </span><span class="cls_059">{{/wrap}}</span><span class="cls_039">) iterates through a collection in</span></div>
<div style="position:absolute;left:93.18px;top:233.66px" class="cls_039"><span class="cls_039">the request attribute whose key is </span><span class="cls_059">wrap</span><span class="cls_039"> and renders the embedded HTML for each</span></div>
<div style="position:absolute;left:93.18px;top:246.65px" class="cls_039"><span class="cls_039">item. The </span><span class="cls_059">{{id}}</span><span class="cls_039"> and </span><span class="cls_059">{{name}}</span><span class="cls_039"> tags reference the </span><span class="cls_059">id</span><span class="cls_039"> and </span><span class="cls_059">name</span><span class="cls_039"> properties of the item</span></div>
<div style="position:absolute;left:93.18px;top:259.67px" class="cls_039"><span class="cls_039">(which should be an </span><span class="cls_059">Ingredient</span><span class="cls_039">).</span></div>
<div style="position:absolute;left:108.61px;top:272.66px" class="cls_039"><span class="cls_039">You’ll notice in table 2.2 that JSP doesn’t require any special dependency in the</span></div>
<div style="position:absolute;left:93.18px;top:285.65px" class="cls_039"><span class="cls_039">build. That’s because the servlet container itself (Tomcat by default) implements</span></div>
<div style="position:absolute;left:93.18px;top:298.67px" class="cls_039"><span class="cls_039">the JSP specification, thus requiring no further dependencies.</span></div>
<div style="position:absolute;left:108.25px;top:311.66px" class="cls_039"><span class="cls_039">But there’s a gotcha if you choose to use JSP. As it turns out, Java servlet contain-</span></div>
<div style="position:absolute;left:93.18px;top:324.68px" class="cls_039"><span class="cls_039">ers—including embedded Tomcat and Jetty containers—usually look for JSPs some-</span></div>
<div style="position:absolute;left:93.18px;top:337.67px" class="cls_039"><span class="cls_039">where under /WEB-INF. But if you’re building your application as an executable JAR</span></div>
<div style="position:absolute;left:93.18px;top:350.66px" class="cls_039"><span class="cls_039">file, there’s no way to satisfy that requirement. Therefore, JSP is only an option if</span></div>
<div style="position:absolute;left:93.18px;top:363.68px" class="cls_039"><span class="cls_039">you’re building your application as a WAR file and deploying it in a traditional servlet</span></div>
<div style="position:absolute;left:93.18px;top:376.67px" class="cls_039"><span class="cls_039">container. If you’re building an executable JAR file, you must choose Thymeleaf,</span></div>
<div style="position:absolute;left:93.18px;top:389.66px" class="cls_039"><span class="cls_039">FreeMarker, or one of the other options in table 2.2.</span></div>
<div style="position:absolute;left:57.18px;top:414.50px" class="cls_063"><span class="cls_063">2.5.1</span></div>
<div style="position:absolute;left:93.18px;top:414.50px" class="cls_063"><span class="cls_063">Caching templates</span></div>
<div style="position:absolute;left:93.18px;top:432.17px" class="cls_039"><span class="cls_039">By default, templates are only parsed once, when they’re first used, and the results</span></div>
<div style="position:absolute;left:93.18px;top:445.16px" class="cls_039"><span class="cls_039">of that parse are cached for subsequent use. This is a great feature for production,</span></div>
<div style="position:absolute;left:93.18px;top:458.18px" class="cls_039"><span class="cls_039">as it prevents redundant template parsing on each request and thus improves</span></div>
<div style="position:absolute;left:93.18px;top:471.17px" class="cls_039"><span class="cls_039">performance.</span></div>
<div style="position:absolute;left:108.21px;top:484.16px" class="cls_039"><span class="cls_039">That feature is not so awesome at development time, however. Let’s say you fire</span></div>
<div style="position:absolute;left:93.18px;top:497.18px" class="cls_039"><span class="cls_039">up your application and hit the taco design page and decide to make a few changes</span></div>
<div style="position:absolute;left:93.18px;top:510.17px" class="cls_039"><span class="cls_039">to it. When you refresh your web browser, you’ll still be shown the original version.</span></div>
<div style="position:absolute;left:93.18px;top:523.16px" class="cls_039"><span class="cls_039">The only way you can see your changes is to restart the application, which is quite</span></div>
<div style="position:absolute;left:93.18px;top:536.18px" class="cls_039"><span class="cls_039">inconvenient.</span></div>
<div style="position:absolute;left:108.19px;top:549.17px" class="cls_039"><span class="cls_039">Fortunately, there’s a way to disable caching. All you need to do is set a template-</span></div>
<div style="position:absolute;left:93.18px;top:562.19px" class="cls_039"><span class="cls_039">appropriate caching property to </span><span class="cls_059">false</span><span class="cls_039">. Table 2.3 lists the caching properties for each</span></div>
<div style="position:absolute;left:93.18px;top:575.18px" class="cls_039"><span class="cls_039">of the supported template libraries.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:50020px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background077.jpg" width="531" height="666"></div>
<div style="position:absolute;left:253.20px;top:24.35px" class="cls_055"><span class="cls_055">Summary</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">55</span></div>
<div style="position:absolute;left:102.18px;top:51.32px" class="cls_053"><span class="cls_053">Table 2.3</span></div>
<div style="position:absolute;left:143.91px;top:51.32px" class="cls_053"><span class="cls_053">Properties to enable/disable template caching</span></div>
<div style="position:absolute;left:141.24px;top:72.32px" class="cls_073"><span class="cls_073">Template</span></div>
<div style="position:absolute;left:279.09px;top:72.32px" class="cls_073"><span class="cls_073">Cache enable property</span></div>
<div style="position:absolute;left:108.18px;top:91.34px" class="cls_074"><span class="cls_074">FreeMarker</span></div>
<div style="position:absolute;left:227.34px;top:91.34px" class="cls_060"><span class="cls_060">spring.freemarker.cache</span></div>
<div style="position:absolute;left:108.18px;top:108.32px" class="cls_074"><span class="cls_074">Groovy Templates</span></div>
<div style="position:absolute;left:227.34px;top:108.32px" class="cls_060"><span class="cls_060">spring.groovy.template.cache</span></div>
<div style="position:absolute;left:108.18px;top:125.33px" class="cls_074"><span class="cls_074">Mustache</span></div>
<div style="position:absolute;left:227.34px;top:125.33px" class="cls_060"><span class="cls_060">spring.mustache.cache</span></div>
<div style="position:absolute;left:108.18px;top:142.34px" class="cls_074"><span class="cls_074">Thymeleaf</span></div>
<div style="position:absolute;left:227.34px;top:142.34px" class="cls_060"><span class="cls_060">spring.thymeleaf.cache</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">By default, all of these properties are set to </span><span class="cls_059">true</span><span class="cls_039"> to enable caching. You can disable</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">caching for your chosen template engine by setting its cache property to </span><span class="cls_059">false</span><span class="cls_039">. For</span></div>
<div style="position:absolute;left:102.18px;top:193.67px" class="cls_039"><span class="cls_039">example, to disable Thymeleaf caching, add the following line in application.properties:</span></div>
<div style="position:absolute;left:102.18px;top:216.35px" class="cls_061"><span class="cls_061">spring.thymeleaf.cache=false</span></div>
<div style="position:absolute;left:102.18px;top:236.66px" class="cls_039"><span class="cls_039">The only catch is that you’ll want to be sure to remove this line (or set it to </span><span class="cls_059">true</span><span class="cls_039">)</span></div>
<div style="position:absolute;left:102.18px;top:249.65px" class="cls_039"><span class="cls_039">before you deploy your application to production. One option is to set the property in</span></div>
<div style="position:absolute;left:102.18px;top:262.67px" class="cls_039"><span class="cls_039">a profile. (We’ll talk about profiles in chapter 5.)</span></div>
<div style="position:absolute;left:116.52px;top:275.66px" class="cls_039"><span class="cls_039">A much simpler option is to use Spring Boot’s DevTools, as we opted to do in chap-</span></div>
<div style="position:absolute;left:102.18px;top:288.65px" class="cls_039"><span class="cls_039">ter 1. Among the many helpful bits of development-time help offered by DevTools, it</span></div>
<div style="position:absolute;left:102.18px;top:301.67px" class="cls_039"><span class="cls_039">will disable caching for all template libraries but will disable itself (and thus reenable</span></div>
<div style="position:absolute;left:102.18px;top:314.66px" class="cls_039"><span class="cls_039">template caching) when your application is deployed.</span></div>
<div style="position:absolute;left:102.18px;top:335.83px" class="cls_040"><span class="cls_040">Summary</span></div>
<div style="position:absolute;left:117.78px;top:354.17px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Spring offers a powerful web framework called Spring MVC that can be used to</span></div>
<div style="position:absolute;left:129.78px;top:367.16px" class="cls_039"><span class="cls_039">develop the web frontend for a Spring application.</span></div>
<div style="position:absolute;left:117.78px;top:381.17px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Spring MVC is annotation-based, enabling the declaration of request-handling</span></div>
<div style="position:absolute;left:129.78px;top:394.16px" class="cls_039"><span class="cls_039">methods with annotations such as </span><span class="cls_059">@RequestMapping</span><span class="cls_039">, </span><span class="cls_059">@GetMapping</span><span class="cls_039">, and </span><span class="cls_059">@Post-</span></div>
<div style="position:absolute;left:129.78px;top:407.18px" class="cls_059"><span class="cls_059">Mapping</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.78px;top:421.16px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Most request-handling methods conclude by returning the logical name of a</span></div>
<div style="position:absolute;left:129.78px;top:434.18px" class="cls_039"><span class="cls_039">view, such as a Thymeleaf template, to which the request (along with any model</span></div>
<div style="position:absolute;left:129.78px;top:447.17px" class="cls_039"><span class="cls_039">data) is forwarded.</span></div>
<div style="position:absolute;left:117.78px;top:461.18px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Spring MVC supports validation through the Java Bean Validation API and</span></div>
<div style="position:absolute;left:129.78px;top:474.17px" class="cls_039"><span class="cls_039">implementations of the Validation API such as Hibernate Validator.</span></div>
<div style="position:absolute;left:117.78px;top:488.18px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  View controllers can be used to handle HTTP GET requests for which no</span></div>
<div style="position:absolute;left:129.78px;top:501.17px" class="cls_039"><span class="cls_039">model data or processing is required.</span></div>
<div style="position:absolute;left:117.78px;top:515.18px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  In addition to Thymeleaf, Spring supports a variety of view options, including</span></div>
<div style="position:absolute;left:129.78px;top:528.17px" class="cls_039"><span class="cls_039">FreeMarker, Groovy Templates, and Mustache.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:50696px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background078.jpg" width="531" height="666"></div>
<div style="position:absolute;left:242.58px;top:111.83px" class="cls_014"><span class="cls_014">Working with data</span></div>
<div style="position:absolute;left:84.18px;top:264.85px" class="cls_049"><span class="cls_049">This chapter covers</span></div>
<div style="position:absolute;left:84.18px;top:283.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Using Spring’s </span><span class="cls_078">JdbcTemplate</span></div>
<div style="position:absolute;left:84.18px;top:298.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Inserting data with </span><span class="cls_078">SimpleJdbcInsert</span></div>
<div style="position:absolute;left:84.18px;top:313.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Declaring JPA repositories with Spring Data</span></div>
<div style="position:absolute;left:102.18px;top:383.54px" class="cls_039"><span class="cls_039">Most applications offer more than just a pretty face. Although the user interface</span></div>
<div style="position:absolute;left:102.18px;top:396.53px" class="cls_039"><span class="cls_039">may provide interaction with an application, it’s the data it presents and stores that</span></div>
<div style="position:absolute;left:102.18px;top:409.55px" class="cls_039"><span class="cls_039">separates applications from static websites.</span></div>
<div style="position:absolute;left:117.94px;top:422.54px" class="cls_039"><span class="cls_039">In the Taco Cloud application, you need to be able to maintain information</span></div>
<div style="position:absolute;left:102.18px;top:435.53px" class="cls_039"><span class="cls_039">about ingredients, tacos, and orders. Without a database to store this information,</span></div>
<div style="position:absolute;left:102.18px;top:448.55px" class="cls_039"><span class="cls_039">the application wouldn’t be able to progress much further than what you devel-</span></div>
<div style="position:absolute;left:102.18px;top:461.54px" class="cls_039"><span class="cls_039">oped in chapter 2.</span></div>
<div style="position:absolute;left:116.82px;top:474.53px" class="cls_039"><span class="cls_039">In this chapter, you’re going to add data persistence to the Taco Cloud applica-</span></div>
<div style="position:absolute;left:102.18px;top:487.55px" class="cls_039"><span class="cls_039">tion. You’ll start by using Spring support for JDBC (Java Database Connectivity) to</span></div>
<div style="position:absolute;left:102.18px;top:500.54px" class="cls_039"><span class="cls_039">eliminate boilerplate code. Then you’ll rework the data repositories to work with</span></div>
<div style="position:absolute;left:102.18px;top:513.56px" class="cls_039"><span class="cls_039">the JPA (Java Persistence API), eliminating even more code.</span></div>
<div style="position:absolute;left:259.50px;top:596.99px" class="cls_024"><span class="cls_024">56</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:51372px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background079.jpg" width="531" height="666"></div>
<div style="position:absolute;left:203.13px;top:24.35px" class="cls_055"><span class="cls_055">Reading and writing data with JDBC</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">57</span></div>
<div style="position:absolute;left:66.18px;top:49.81px" class="cls_040"><span class="cls_040">3.1</span></div>
<div style="position:absolute;left:102.18px;top:49.81px" class="cls_040"><span class="cls_040">Reading and writing data with JDBC</span></div>
<div style="position:absolute;left:102.18px;top:67.67px" class="cls_039"><span class="cls_039">For decades, relational databases and SQL have enjoyed their position as the leading</span></div>
<div style="position:absolute;left:102.18px;top:80.66px" class="cls_039"><span class="cls_039">choice for data persistence. Even though many alternative database types have emerged</span></div>
<div style="position:absolute;left:102.18px;top:93.65px" class="cls_039"><span class="cls_039">in recent years, the relational database is still a top choice for a general-purpose data</span></div>
<div style="position:absolute;left:102.18px;top:106.67px" class="cls_039"><span class="cls_039">store and will not likely be usurped from its position any time soon.</span></div>
<div style="position:absolute;left:119.34px;top:119.66px" class="cls_039"><span class="cls_039">When it comes to working with relational data, Java developers have several</span></div>
<div style="position:absolute;left:102.18px;top:132.65px" class="cls_039"><span class="cls_039">options. The two most common choices are JDBC and the JPA. Spring supports both</span></div>
<div style="position:absolute;left:102.18px;top:145.67px" class="cls_039"><span class="cls_039">of these with abstractions, making working with either JDBC or JPA easier than it</span></div>
<div style="position:absolute;left:102.18px;top:158.66px" class="cls_039"><span class="cls_039">would be without Spring. In this section, we’ll focus on how Spring supports JDBC,</span></div>
<div style="position:absolute;left:102.18px;top:171.65px" class="cls_039"><span class="cls_039">and then we’ll look at Spring support for JPA in section 3.2.</span></div>
<div style="position:absolute;left:116.53px;top:184.67px" class="cls_039"><span class="cls_039">Spring JDBC support is rooted in the </span><span class="cls_059">JdbcTemplate</span><span class="cls_039"> class. </span><span class="cls_059">JdbcTemplate</span><span class="cls_039"> provides a</span></div>
<div style="position:absolute;left:102.18px;top:197.66px" class="cls_039"><span class="cls_039">means by which developers can perform SQL operations against a relational database</span></div>
<div style="position:absolute;left:102.18px;top:210.65px" class="cls_039"><span class="cls_039">without all the ceremony and boilerplate typically required when working with JDBC.</span></div>
<div style="position:absolute;left:117.87px;top:223.67px" class="cls_039"><span class="cls_039">To gain an appreciation of what </span><span class="cls_059">JdbcTemplate</span><span class="cls_039"> does, let’s start by looking at an</span></div>
<div style="position:absolute;left:102.18px;top:236.66px" class="cls_039"><span class="cls_039">example of how to perform a simple query in Java without </span><span class="cls_059">JdbcTemplate</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:114.18px;top:260.66px" class="cls_066"><span class="cls_066">Listing 3.1</span></div>
<div style="position:absolute;left:166.27px;top:260.27px" class="cls_066"><span class="cls_066">Querying a database without </span><span class="cls_077">JdbcTemplate</span></div>
<div style="position:absolute;left:102.18px;top:280.64px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:102.18px;top:290.63px" class="cls_060"><span class="cls_060">public Ingredient findOne(String id) {</span></div>
<div style="position:absolute;left:111.78px;top:300.65px" class="cls_060"><span class="cls_060">Connection connection = null;</span></div>
<div style="position:absolute;left:111.77px;top:310.64px" class="cls_060"><span class="cls_060">PreparedStatement statement = null;</span></div>
<div style="position:absolute;left:111.78px;top:320.63px" class="cls_060"><span class="cls_060">ResultSet resultSet = null;</span></div>
<div style="position:absolute;left:111.78px;top:330.65px" class="cls_060"><span class="cls_060">try {</span></div>
<div style="position:absolute;left:121.38px;top:340.64px" class="cls_060"><span class="cls_060">connection = dataSource.getConnection();</span></div>
<div style="position:absolute;left:121.38px;top:350.63px" class="cls_060"><span class="cls_060">statement = connection.prepareStatement(</span></div>
<div style="position:absolute;left:140.57px;top:360.65px" class="cls_060"><span class="cls_060">"select id, name, type from Ingredient");</span></div>
<div style="position:absolute;left:121.38px;top:370.64px" class="cls_060"><span class="cls_060">statement.setString(1, id);</span></div>
<div style="position:absolute;left:121.38px;top:380.63px" class="cls_060"><span class="cls_060">resultSet = statement.executeQuery();</span></div>
<div style="position:absolute;left:121.38px;top:390.65px" class="cls_060"><span class="cls_060">Ingredient ingredient = null;</span></div>
<div style="position:absolute;left:121.38px;top:400.64px" class="cls_060"><span class="cls_060">if(resultSet.next()) {</span></div>
<div style="position:absolute;left:130.96px;top:410.66px" class="cls_060"><span class="cls_060">ingredient = new Ingredient(</span></div>
<div style="position:absolute;left:150.15px;top:420.65px" class="cls_060"><span class="cls_060">resultSet.getString("id"),</span></div>
<div style="position:absolute;left:150.15px;top:430.64px" class="cls_060"><span class="cls_060">resultSet.getString("name"),</span></div>
<div style="position:absolute;left:150.15px;top:440.66px" class="cls_060"><span class="cls_060">Ingredient.Type.valueOf(resultSet.getString("type")));</span></div>
<div style="position:absolute;left:121.38px;top:450.65px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:121.38px;top:460.64px" class="cls_060"><span class="cls_060">return ingredient;</span></div>
<div style="position:absolute;left:111.78px;top:470.66px" class="cls_060"><span class="cls_060">} catch (SQLException e) {</span></div>
<div style="position:absolute;left:121.38px;top:480.65px" class="cls_060"><span class="cls_060">// ??? What should be done here ???</span></div>
<div style="position:absolute;left:111.78px;top:490.64px" class="cls_060"><span class="cls_060">} finally {</span></div>
<div style="position:absolute;left:121.37px;top:500.66px" class="cls_060"><span class="cls_060">if (resultSet != null) {</span></div>
<div style="position:absolute;left:130.95px;top:510.65px" class="cls_060"><span class="cls_060">try {</span></div>
<div style="position:absolute;left:140.55px;top:520.64px" class="cls_060"><span class="cls_060">resultSet.close();</span></div>
<div style="position:absolute;left:130.96px;top:530.66px" class="cls_060"><span class="cls_060">} catch (SQLException e) {}</span></div>
<div style="position:absolute;left:121.38px;top:540.65px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:121.37px;top:550.64px" class="cls_060"><span class="cls_060">if (statement != null) {</span></div>
<div style="position:absolute;left:130.95px;top:560.66px" class="cls_060"><span class="cls_060">try {</span></div>
<div style="position:absolute;left:140.55px;top:570.65px" class="cls_060"><span class="cls_060">statement.close();</span></div>
<div style="position:absolute;left:130.96px;top:580.64px" class="cls_060"><span class="cls_060">} catch (SQLException e) {}</span></div>
<div style="position:absolute;left:121.38px;top:590.66px" class="cls_060"><span class="cls_060">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:52048px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background080.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">58</span></div>
<div style="position:absolute;left:205.32px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 3</span></div>
<div style="position:absolute;left:249.45px;top:24.35px" class="cls_055"><span class="cls_055">Working with data</span></div>
<div style="position:absolute;left:112.38px;top:51.32px" class="cls_060"><span class="cls_060">if (connection != null) {</span></div>
<div style="position:absolute;left:121.95px;top:61.34px" class="cls_060"><span class="cls_060">try {</span></div>
<div style="position:absolute;left:131.55px;top:71.33px" class="cls_060"><span class="cls_060">connection.close();</span></div>
<div style="position:absolute;left:121.96px;top:81.32px" class="cls_060"><span class="cls_060">} catch (SQLException e) {}</span></div>
<div style="position:absolute;left:112.38px;top:91.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.78px;top:101.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.78px;top:111.32px" class="cls_060"><span class="cls_060">return null;</span></div>
<div style="position:absolute;left:93.18px;top:121.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:142.67px" class="cls_039"><span class="cls_039">I assure you that somewhere in listing 3.1 there are a couple of lines that query the</span></div>
<div style="position:absolute;left:93.18px;top:155.66px" class="cls_039"><span class="cls_039">database for ingredients. But I’ll bet you had a hard time spotting that query needle in</span></div>
<div style="position:absolute;left:93.18px;top:168.65px" class="cls_039"><span class="cls_039">the JDBC haystack. It’s surrounded by code that creates a connection, creates a state-</span></div>
<div style="position:absolute;left:93.18px;top:181.67px" class="cls_039"><span class="cls_039">ment, and cleans up by closing the connection, statement, and result set.</span></div>
<div style="position:absolute;left:108.28px;top:194.66px" class="cls_039"><span class="cls_039">To make matters worse, any number of things could go wrong when creating the</span></div>
<div style="position:absolute;left:93.18px;top:207.65px" class="cls_039"><span class="cls_039">connection or the statement, or when performing the query. This requires that you</span></div>
<div style="position:absolute;left:93.18px;top:220.67px" class="cls_039"><span class="cls_039">catch a </span><span class="cls_059">SQLException</span><span class="cls_039">, which may or may not be helpful in figuring out what went</span></div>
<div style="position:absolute;left:93.18px;top:233.66px" class="cls_039"><span class="cls_039">wrong or how to address the problem.</span></div>
<div style="position:absolute;left:108.63px;top:246.65px" class="cls_059"><span class="cls_059">SQLException</span><span class="cls_039"> is a checked exception, which requires handling in a catch block.</span></div>
<div style="position:absolute;left:93.18px;top:259.67px" class="cls_039"><span class="cls_039">But the most common problems, such as failure to create a connection to the data-</span></div>
<div style="position:absolute;left:93.18px;top:272.66px" class="cls_039"><span class="cls_039">base or a mistyped query, can’t possibly be addressed in a catch block and are likely to</span></div>
<div style="position:absolute;left:93.18px;top:285.65px" class="cls_039"><span class="cls_039">be rethrown for handling upstream. In contrast, consider the methods that use </span><span class="cls_059">Jdbc-</span></div>
<div style="position:absolute;left:93.18px;top:298.67px" class="cls_059"><span class="cls_059">Template</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:105.18px;top:322.67px" class="cls_066"><span class="cls_066">Listing 3.2</span></div>
<div style="position:absolute;left:157.28px;top:322.28px" class="cls_066"><span class="cls_066">Querying a database with </span><span class="cls_077">JdbcTemplate</span></div>
<div style="position:absolute;left:93.18px;top:342.65px" class="cls_060"><span class="cls_060">private JdbcTemplate jdbc;</span></div>
<div style="position:absolute;left:93.18px;top:362.63px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:93.18px;top:372.65px" class="cls_060"><span class="cls_060">public Ingredient findOne(String id) {</span></div>
<div style="position:absolute;left:102.78px;top:382.64px" class="cls_060"><span class="cls_060">return jdbc.queryForObject(</span></div>
<div style="position:absolute;left:121.97px;top:392.66px" class="cls_060"><span class="cls_060">"select id, name, type from Ingredient where id=?",</span></div>
<div style="position:absolute;left:121.95px;top:402.65px" class="cls_060"><span class="cls_060">this::mapRowToIngredient, id);</span></div>
<div style="position:absolute;left:93.18px;top:412.64px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:432.65px" class="cls_060"><span class="cls_060">private Ingredient mapRowToIngredient(ResultSet rs, int rowNum)</span></div>
<div style="position:absolute;left:112.38px;top:442.64px" class="cls_060"><span class="cls_060">throws SQLException {</span></div>
<div style="position:absolute;left:102.78px;top:452.66px" class="cls_060"><span class="cls_060">return new Ingredient(</span></div>
<div style="position:absolute;left:121.95px;top:462.65px" class="cls_060"><span class="cls_060">rs.getString("id"),</span></div>
<div style="position:absolute;left:121.95px;top:472.64px" class="cls_060"><span class="cls_060">rs.getString("name"),</span></div>
<div style="position:absolute;left:121.95px;top:482.66px" class="cls_060"><span class="cls_060">Ingredient.Type.valueOf(rs.getString("type")));</span></div>
<div style="position:absolute;left:93.18px;top:492.65px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:513.98px" class="cls_039"><span class="cls_039">The code in listing 3.2 is clearly much simpler than the raw JDBC example in listing 3.1;</span></div>
<div style="position:absolute;left:93.18px;top:526.97px" class="cls_039"><span class="cls_039">there aren’t any statements or connections being created. And, after the method is</span></div>
<div style="position:absolute;left:93.18px;top:539.96px" class="cls_039"><span class="cls_039">finished, there isn’t any cleanup of those objects. Finally, there isn’t any handling of</span></div>
<div style="position:absolute;left:93.18px;top:552.98px" class="cls_039"><span class="cls_039">exceptions that can’t properly be handled in a catch block. What’s left is code that’s</span></div>
<div style="position:absolute;left:93.18px;top:565.97px" class="cls_039"><span class="cls_039">focused solely on performing a query (the call to </span><span class="cls_059">JdbcTemplate</span><span class="cls_039">’s </span><span class="cls_059">queryForObject()</span></div>
<div style="position:absolute;left:93.18px;top:578.99px" class="cls_039"><span class="cls_039">method) and mapping the results to an </span><span class="cls_059">Ingredient</span><span class="cls_039"> object (in the </span><span class="cls_059">mapRowTo-</span></div>
<div style="position:absolute;left:93.27px;top:591.98px" class="cls_059"><span class="cls_059">Ingredient()</span><span class="cls_039"> method).</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:52724px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background081.jpg" width="531" height="666"></div>
<div style="position:absolute;left:203.13px;top:24.35px" class="cls_055"><span class="cls_055">Reading and writing data with JDBC</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">59</span></div>
<div style="position:absolute;left:116.95px;top:50.66px" class="cls_039"><span class="cls_039">The code in listing 3.2 is a snippet of what you need to do to use </span><span class="cls_059">JdbcTemplate</span><span class="cls_039"> to</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">persist and read data in the Taco Cloud application. Let’s take the next steps neces-</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">sary to outfit the application with JDBC persistence. We’ll start by making a few tweaks</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">to the domain objects.</span></div>
<div style="position:absolute;left:66.18px;top:111.47px" class="cls_063"><span class="cls_063">3.1.1</span></div>
<div style="position:absolute;left:102.18px;top:111.47px" class="cls_063"><span class="cls_063">Adapting the domain for persistence</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">When persisting objects to a database, it’s generally a good idea to have one field that</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">uniquely identifies the object. Your </span><span class="cls_059">Ingredient</span><span class="cls_039"> class already has an </span><span class="cls_059">id</span><span class="cls_039"> field, but you</span></div>
<div style="position:absolute;left:102.18px;top:154.67px" class="cls_039"><span class="cls_039">need to add </span><span class="cls_059">id</span><span class="cls_039"> fields to both </span><span class="cls_059">Taco</span><span class="cls_039"> and </span><span class="cls_059">Order</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:116.79px;top:167.66px" class="cls_039"><span class="cls_039">Moreover, it might be useful to know when a </span><span class="cls_059">Taco</span><span class="cls_039"> is created and when an </span><span class="cls_059">Order</span><span class="cls_039"> is</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">placed. You’ll also need to add a field to each object to capture the date and time that</span></div>
<div style="position:absolute;left:102.18px;top:193.67px" class="cls_039"><span class="cls_039">the objects are saved. The following listing shows the new </span><span class="cls_059">id</span><span class="cls_039"> and </span><span class="cls_059">createdAt</span><span class="cls_039"> fields</span></div>
<div style="position:absolute;left:102.18px;top:206.66px" class="cls_039"><span class="cls_039">needed in the </span><span class="cls_059">Taco</span><span class="cls_039"> class.</span></div>
<div style="position:absolute;left:114.18px;top:230.66px" class="cls_066"><span class="cls_066">Listing 3.3</span></div>
<div style="position:absolute;left:166.27px;top:230.27px" class="cls_066"><span class="cls_066">Adding ID and timestamp fields to the </span><span class="cls_077">Taco</span><span class="cls_066"> class</span></div>
<div style="position:absolute;left:102.18px;top:250.64px" class="cls_060"><span class="cls_060">@Data</span></div>
<div style="position:absolute;left:102.18px;top:260.63px" class="cls_060"><span class="cls_060">public class Taco {</span></div>
<div style="position:absolute;left:111.78px;top:280.64px" class="cls_060"><span class="cls_060">private Long id;</span></div>
<div style="position:absolute;left:111.78px;top:300.65px" class="cls_060"><span class="cls_060">private Date createdAt;</span></div>
<div style="position:absolute;left:102.18px;top:340.64px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:361.97px" class="cls_039"><span class="cls_039">Because you use Lombok to automatically generate accessor methods at runtime,</span></div>
<div style="position:absolute;left:102.18px;top:374.96px" class="cls_039"><span class="cls_039">there’s no need to do anything more than declare the </span><span class="cls_059">id</span><span class="cls_039"> and </span><span class="cls_059">createdAt</span><span class="cls_039"> properties.</span></div>
<div style="position:absolute;left:102.18px;top:387.98px" class="cls_039"><span class="cls_039">They’ll have appropriate getter and setter methods as needed at runtime. Similar</span></div>
<div style="position:absolute;left:102.18px;top:400.97px" class="cls_039"><span class="cls_039">changes are required in the </span><span class="cls_059">Order</span><span class="cls_039"> class, as shown here:</span></div>
<div style="position:absolute;left:102.18px;top:420.65px" class="cls_060"><span class="cls_060">@Data</span></div>
<div style="position:absolute;left:102.18px;top:430.64px" class="cls_060"><span class="cls_060">public class Order {</span></div>
<div style="position:absolute;left:111.78px;top:450.65px" class="cls_060"><span class="cls_060">private Long id;</span></div>
<div style="position:absolute;left:111.78px;top:470.66px" class="cls_060"><span class="cls_060">private Date placedAt;</span></div>
<div style="position:absolute;left:102.18px;top:510.65px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:531.98px" class="cls_039"><span class="cls_039">Again, Lombok automatically generates the accessor methods, so these are the only</span></div>
<div style="position:absolute;left:102.18px;top:544.97px" class="cls_039"><span class="cls_039">changes required in </span><span class="cls_059">Order</span><span class="cls_039">. (If for some reason you choose not to use Lombok, you’ll</span></div>
<div style="position:absolute;left:102.18px;top:557.99px" class="cls_039"><span class="cls_039">need to write these methods yourself.)</span></div>
<div style="position:absolute;left:118.24px;top:570.98px" class="cls_039"><span class="cls_039">Your domain classes are now ready for persistence. Let’s see how to use </span><span class="cls_059">Jdbc-</span></div>
<div style="position:absolute;left:102.18px;top:583.97px" class="cls_059"><span class="cls_059">Template</span><span class="cls_039"> to read and write them to a database.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:53400px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background082.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">60</span></div>
<div style="position:absolute;left:205.32px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 3</span></div>
<div style="position:absolute;left:249.45px;top:24.35px" class="cls_055"><span class="cls_055">Working with data</span></div>
<div style="position:absolute;left:57.18px;top:50.48px" class="cls_063"><span class="cls_063">3.1.2</span></div>
<div style="position:absolute;left:93.18px;top:50.48px" class="cls_063"><span class="cls_063">Working with JdbcTemplate</span></div>
<div style="position:absolute;left:93.18px;top:67.67px" class="cls_039"><span class="cls_039">Before you can start using </span><span class="cls_059">JdbcTemplate</span><span class="cls_039">, you need to add it to your project classpath.</span></div>
<div style="position:absolute;left:93.18px;top:80.66px" class="cls_039"><span class="cls_039">This can easily be accomplished by adding Spring Boot’s JDBC starter dependency to</span></div>
<div style="position:absolute;left:93.18px;top:93.65px" class="cls_039"><span class="cls_039">the build:</span></div>
<div style="position:absolute;left:93.18px;top:113.33px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:123.35px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:133.34px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:93.18px;top:143.33px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:93.18px;top:164.66px" class="cls_039"><span class="cls_039">You’re also going to need a database where your data will be stored. For development</span></div>
<div style="position:absolute;left:93.18px;top:177.65px" class="cls_039"><span class="cls_039">purposes, an embedded database will be just fine. I favor the H2 embedded database,</span></div>
<div style="position:absolute;left:93.18px;top:190.67px" class="cls_039"><span class="cls_039">so I’ve added the following dependency to the build:</span></div>
<div style="position:absolute;left:93.18px;top:210.35px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:220.34px" class="cls_060"><span class="cls_060">&lt;groupId&gt;com.h2database&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:230.33px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;h2&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:240.35px" class="cls_060"><span class="cls_060">&lt;scope&gt;runtime&lt;/scope&gt;</span></div>
<div style="position:absolute;left:93.18px;top:250.34px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:93.18px;top:271.67px" class="cls_039"><span class="cls_039">Later, you’ll see how to configure the application to use an external database. But for</span></div>
<div style="position:absolute;left:93.18px;top:284.66px" class="cls_039"><span class="cls_039">now, let’s move on to writing a repository that fetches and saves </span><span class="cls_059">Ingredient</span><span class="cls_039"> data.</span></div>
<div style="position:absolute;left:93.18px;top:302.84px" class="cls_064"><span class="cls_064">D</span><span class="cls_065">EFINING</span><span class="cls_064"> JDBC </span><span class="cls_065">REPOSITORIES</span></div>
<div style="position:absolute;left:93.18px;top:315.17px" class="cls_039"><span class="cls_039">Your </span><span class="cls_059">Ingredient</span><span class="cls_039"> repository needs to perform these operations:</span></div>
<div style="position:absolute;left:108.78px;top:332.18px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Query for all ingredients into a collection of </span><span class="cls_059">Ingredient</span><span class="cls_039"> objects</span></div>
<div style="position:absolute;left:108.78px;top:346.16px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Query for a single </span><span class="cls_059">Ingredient</span><span class="cls_039"> by its </span><span class="cls_059">id</span></div>
<div style="position:absolute;left:108.78px;top:360.17px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Save an </span><span class="cls_059">Ingredient</span><span class="cls_039"> object</span></div>
<div style="position:absolute;left:93.18px;top:378.17px" class="cls_039"><span class="cls_039">The following </span><span class="cls_059">IngredientRepository</span><span class="cls_039"> interface defines those three operations as</span></div>
<div style="position:absolute;left:93.18px;top:391.16px" class="cls_039"><span class="cls_039">method declarations:</span></div>
<div style="position:absolute;left:93.18px;top:410.84px" class="cls_060"><span class="cls_060">package tacos.data;</span></div>
<div style="position:absolute;left:93.18px;top:430.85px" class="cls_060"><span class="cls_060">import tacos.Ingredient;</span></div>
<div style="position:absolute;left:93.18px;top:450.86px" class="cls_060"><span class="cls_060">public interface IngredientRepository {</span></div>
<div style="position:absolute;left:102.78px;top:470.84px" class="cls_060"><span class="cls_060">Iterable&lt;Ingredient&gt; findAll();</span></div>
<div style="position:absolute;left:102.78px;top:490.85px" class="cls_060"><span class="cls_060">Ingredient findOne(String id);</span></div>
<div style="position:absolute;left:102.78px;top:510.86px" class="cls_060"><span class="cls_060">Ingredient save(Ingredient ingredient);</span></div>
<div style="position:absolute;left:93.18px;top:530.84px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:552.17px" class="cls_039"><span class="cls_039">Although the interface captures the essence of what you need an ingredient reposi-</span></div>
<div style="position:absolute;left:93.18px;top:565.19px" class="cls_039"><span class="cls_039">tory to do, you’ll still need to write an implementation of </span><span class="cls_059">IngredientRepository</span><span class="cls_039"> that</span></div>
<div style="position:absolute;left:93.18px;top:578.18px" class="cls_039"><span class="cls_039">uses </span><span class="cls_059">JdbcTemplate</span><span class="cls_039"> to query the database. The code shown next is the first step in writ-</span></div>
<div style="position:absolute;left:93.18px;top:591.17px" class="cls_039"><span class="cls_039">ing that implementation.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:54076px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background083.jpg" width="531" height="666"></div>
<div style="position:absolute;left:203.13px;top:24.35px" class="cls_055"><span class="cls_055">Reading and writing data with JDBC</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">61</span></div>
<div style="position:absolute;left:114.18px;top:54.65px" class="cls_066"><span class="cls_066">Listing 3.4</span></div>
<div style="position:absolute;left:166.27px;top:54.26px" class="cls_066"><span class="cls_066">Beginning an ingredient repository with </span><span class="cls_077">JdbcTemplate</span></div>
<div style="position:absolute;left:102.18px;top:73.64px" class="cls_060"><span class="cls_060">package tacos.data;</span></div>
<div style="position:absolute;left:102.18px;top:93.62px" class="cls_060"><span class="cls_060">import org.springframework.beans.factory.annotation.Autowired;</span></div>
<div style="position:absolute;left:102.18px;top:103.64px" class="cls_060"><span class="cls_060">import org.springframework.jdbc.core.JdbcTemplate;</span></div>
<div style="position:absolute;left:102.18px;top:113.63px" class="cls_060"><span class="cls_060">import org.springframework.jdbc.core.RowMapper;</span></div>
<div style="position:absolute;left:102.18px;top:123.62px" class="cls_060"><span class="cls_060">import org.springframework.stereotype.Repository;</span></div>
<div style="position:absolute;left:102.18px;top:143.63px" class="cls_060"><span class="cls_060">import tacos.Ingredient;</span></div>
<div style="position:absolute;left:102.18px;top:163.64px" class="cls_060"><span class="cls_060">@Repository</span></div>
<div style="position:absolute;left:102.18px;top:173.63px" class="cls_060"><span class="cls_060">public class JdbcIngredientRepository</span></div>
<div style="position:absolute;left:121.38px;top:183.65px" class="cls_060"><span class="cls_060">implements IngredientRepository {</span></div>
<div style="position:absolute;left:111.78px;top:203.63px" class="cls_060"><span class="cls_060">private JdbcTemplate jdbc;</span></div>
<div style="position:absolute;left:111.78px;top:233.63px" class="cls_060"><span class="cls_060">@Autowired</span></div>
<div style="position:absolute;left:111.78px;top:243.65px" class="cls_060"><span class="cls_060">public JdbcIngredientRepository(JdbcTemplate jdbc) {</span></div>
<div style="position:absolute;left:121.38px;top:253.64px" class="cls_060"><span class="cls_060">this.jdbc = jdbc;</span></div>
<div style="position:absolute;left:111.78px;top:263.63px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:303.65px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:323.96px" class="cls_039"><span class="cls_039">As you can see, </span><span class="cls_059">JdbcIngredientRepository</span><span class="cls_039"> is annotated with </span><span class="cls_059">@Repository</span><span class="cls_039">. This</span></div>
<div style="position:absolute;left:102.18px;top:336.98px" class="cls_039"><span class="cls_039">annotation is one of a handful of stereotype annotations that Spring defines, includ-</span></div>
<div style="position:absolute;left:102.18px;top:349.97px" class="cls_039"><span class="cls_039">ing </span><span class="cls_059">@Controller</span><span class="cls_039"> and </span><span class="cls_059">@Component</span><span class="cls_039">. By annotating </span><span class="cls_059">JdbcIngredientRepository</span><span class="cls_039"> with</span></div>
<div style="position:absolute;left:102.18px;top:362.96px" class="cls_059"><span class="cls_059">@Repository</span><span class="cls_039">, you declare that it should be automatically discovered by Spring compo-</span></div>
<div style="position:absolute;left:102.18px;top:375.98px" class="cls_039"><span class="cls_039">nent scanning and instantiated as a bean in the Spring application context.</span></div>
<div style="position:absolute;left:116.91px;top:388.97px" class="cls_039"><span class="cls_039">When Spring creates the </span><span class="cls_059">JdbcIngredientRepository</span><span class="cls_039"> bean, it injects it with </span><span class="cls_059">Jdbc-</span></div>
<div style="position:absolute;left:102.18px;top:401.96px" class="cls_059"><span class="cls_059">Template</span><span class="cls_039"> via the </span><span class="cls_059">@Autowired</span><span class="cls_039"> annotated construction. The constructor assigns</span></div>
<div style="position:absolute;left:102.18px;top:414.98px" class="cls_059"><span class="cls_059">JdbcTemplate</span><span class="cls_039"> to an instance variable that will be used in other methods to query and</span></div>
<div style="position:absolute;left:102.18px;top:427.97px" class="cls_039"><span class="cls_039">insert into the database. Speaking of those other methods, let’s take a look at the</span></div>
<div style="position:absolute;left:102.18px;top:440.96px" class="cls_039"><span class="cls_039">implementations of </span><span class="cls_059">findAll()</span><span class="cls_039"> and </span><span class="cls_059">findById()</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:114.18px;top:464.96px" class="cls_066"><span class="cls_066">Listing 3.5</span></div>
<div style="position:absolute;left:166.26px;top:464.57px" class="cls_066"><span class="cls_066">Querying the database with </span><span class="cls_077">JdbcTemplate</span></div>
<div style="position:absolute;left:102.18px;top:484.94px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:102.18px;top:494.96px" class="cls_060"><span class="cls_060">public Iterable&lt;Ingredient&gt; findAll() {</span></div>
<div style="position:absolute;left:111.78px;top:504.95px" class="cls_060"><span class="cls_060">return jdbc.query("select id, name, type from Ingredient",</span></div>
<div style="position:absolute;left:130.95px;top:514.94px" class="cls_060"><span class="cls_060">this::mapRowToIngredient);</span></div>
<div style="position:absolute;left:102.18px;top:524.96px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:544.94px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:102.18px;top:554.96px" class="cls_060"><span class="cls_060">public Ingredient findOne(String id) {</span></div>
<div style="position:absolute;left:111.78px;top:564.95px" class="cls_060"><span class="cls_060">return jdbc.queryForObject(</span></div>
<div style="position:absolute;left:130.96px;top:574.94px" class="cls_060"><span class="cls_060">"select id, name, type from Ingredient where id=?",</span></div>
<div style="position:absolute;left:130.96px;top:584.96px" class="cls_060"><span class="cls_060">this::mapRowToIngredient, id);</span></div>
<div style="position:absolute;left:102.18px;top:594.95px" class="cls_060"><span class="cls_060">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:54752px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background084.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">62</span></div>
<div style="position:absolute;left:205.32px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 3</span></div>
<div style="position:absolute;left:249.45px;top:24.35px" class="cls_055"><span class="cls_055">Working with data</span></div>
<div style="position:absolute;left:93.18px;top:51.32px" class="cls_060"><span class="cls_060">private Ingredient mapRowToIngredient(ResultSet rs, int rowNum)</span></div>
<div style="position:absolute;left:112.38px;top:61.34px" class="cls_060"><span class="cls_060">throws SQLException {</span></div>
<div style="position:absolute;left:102.78px;top:71.33px" class="cls_060"><span class="cls_060">return new Ingredient(</span></div>
<div style="position:absolute;left:121.95px;top:81.32px" class="cls_060"><span class="cls_060">rs.getString("id"),</span></div>
<div style="position:absolute;left:121.95px;top:91.34px" class="cls_060"><span class="cls_060">rs.getString("name"),</span></div>
<div style="position:absolute;left:121.95px;top:101.33px" class="cls_060"><span class="cls_060">Ingredient.Type.valueOf(rs.getString("type")));</span></div>
<div style="position:absolute;left:93.18px;top:111.32px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:131.66px" class="cls_039"><span class="cls_039">Both </span><span class="cls_059">findAll()</span><span class="cls_039"> and </span><span class="cls_059">findById()</span><span class="cls_039"> use </span><span class="cls_059">JdbcTemplate</span><span class="cls_039"> in a similar way. The </span><span class="cls_059">findAll()</span></div>
<div style="position:absolute;left:93.18px;top:144.65px" class="cls_039"><span class="cls_039">method, expecting to return a collection of objects, uses </span><span class="cls_059">JdbcTemplate</span><span class="cls_039">’s </span><span class="cls_059">query()</span></div>
<div style="position:absolute;left:93.18px;top:157.67px" class="cls_039"><span class="cls_039">method. The </span><span class="cls_059">query()</span><span class="cls_039"> method accepts the SQL for the query as well as an implemen-</span></div>
<div style="position:absolute;left:93.18px;top:170.66px" class="cls_039"><span class="cls_039">tation of Spring’s </span><span class="cls_059">RowMapper</span><span class="cls_039"> for the purpose of mapping each row in the result set to</span></div>
<div style="position:absolute;left:93.18px;top:183.65px" class="cls_039"><span class="cls_039">an object. </span><span class="cls_059">findAll()</span><span class="cls_039"> also accepts as its final argument(s) a list of any parameters</span></div>
<div style="position:absolute;left:93.18px;top:196.67px" class="cls_039"><span class="cls_039">required in the query. But, in this case, there aren’t any required parameters.</span></div>
<div style="position:absolute;left:108.51px;top:209.66px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">findById()</span><span class="cls_039"> method only expects to return a single </span><span class="cls_059">Ingredient</span><span class="cls_039"> object, so it</span></div>
<div style="position:absolute;left:93.18px;top:222.65px" class="cls_039"><span class="cls_039">uses the </span><span class="cls_059">queryForObject()</span><span class="cls_039"> method of </span><span class="cls_059">JdbcTemplate</span><span class="cls_039"> instead of </span><span class="cls_059">query()</span><span class="cls_039">. </span><span class="cls_059">queryFor-</span></div>
<div style="position:absolute;left:93.18px;top:235.67px" class="cls_059"><span class="cls_059">Object()</span><span class="cls_039"> works much like </span><span class="cls_059">query()</span><span class="cls_039"> except that it returns a single object instead of a</span></div>
<div style="position:absolute;left:93.18px;top:248.66px" class="cls_059"><span class="cls_059">List</span><span class="cls_039"> of objects. In this case, it’s given the query to perform, a </span><span class="cls_059">RowMapper</span><span class="cls_039">, and the </span><span class="cls_059">id</span></div>
<div style="position:absolute;left:93.18px;top:261.65px" class="cls_039"><span class="cls_039">of </span><span class="cls_059">Ingredient</span><span class="cls_039"> to fetch, which is used in place of the </span><span class="cls_059">?</span><span class="cls_039"> in the query.</span></div>
<div style="position:absolute;left:108.61px;top:274.67px" class="cls_039"><span class="cls_039">As shown in listing 3.5, the </span><span class="cls_059">RowMapper</span><span class="cls_039"> parameter for both </span><span class="cls_059">findAll()</span><span class="cls_039"> and </span><span class="cls_059">find-</span></div>
<div style="position:absolute;left:93.18px;top:287.66px" class="cls_059"><span class="cls_059">ById()</span><span class="cls_039"> is given as a method reference to the </span><span class="cls_059">mapRowToIngredient()</span><span class="cls_039"> method. Java 8’s</span></div>
<div style="position:absolute;left:93.18px;top:300.68px" class="cls_039"><span class="cls_039">method references and lambdas are convenient when working with </span><span class="cls_059">JdbcTemplate</span><span class="cls_039"> as</span></div>
<div style="position:absolute;left:93.18px;top:313.67px" class="cls_039"><span class="cls_039">an alternative to an explicit </span><span class="cls_059">RowMapper</span><span class="cls_039"> implementation. But if for some reason you</span></div>
<div style="position:absolute;left:93.18px;top:326.66px" class="cls_039"><span class="cls_039">want or need an explicit </span><span class="cls_059">RowMapper</span><span class="cls_039">, then the following implementation of </span><span class="cls_059">findAll()</span></div>
<div style="position:absolute;left:93.18px;top:339.68px" class="cls_039"><span class="cls_039">shows how to do that:</span></div>
<div style="position:absolute;left:93.18px;top:359.33px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:93.18px;top:369.35px" class="cls_060"><span class="cls_060">public Ingredient findOne(String id) {</span></div>
<div style="position:absolute;left:102.78px;top:379.34px" class="cls_060"><span class="cls_060">return jdbc.queryForObject(</span></div>
<div style="position:absolute;left:121.97px;top:389.36px" class="cls_060"><span class="cls_060">"select id, name, type from Ingredient where id=?",</span></div>
<div style="position:absolute;left:121.96px;top:399.35px" class="cls_060"><span class="cls_060">new RowMapper&lt;Ingredient&gt;() {</span></div>
<div style="position:absolute;left:131.57px;top:409.34px" class="cls_060"><span class="cls_060">public Ingredient mapRow(ResultSet rs, int rowNum)</span></div>
<div style="position:absolute;left:150.76px;top:419.36px" class="cls_060"><span class="cls_060">throws SQLException {</span></div>
<div style="position:absolute;left:141.12px;top:429.35px" class="cls_060"><span class="cls_060">return new Ingredient(</span></div>
<div style="position:absolute;left:160.35px;top:439.34px" class="cls_060"><span class="cls_060">rs.getString("id"),</span></div>
<div style="position:absolute;left:160.35px;top:449.36px" class="cls_060"><span class="cls_060">rs.getString("name"),</span></div>
<div style="position:absolute;left:160.35px;top:459.35px" class="cls_060"><span class="cls_060">Ingredient.Type.valueOf(rs.getString("type")));</span></div>
<div style="position:absolute;left:131.55px;top:469.34px" class="cls_060"><span class="cls_060">};</span></div>
<div style="position:absolute;left:121.95px;top:479.36px" class="cls_060"><span class="cls_060">}, id);</span></div>
<div style="position:absolute;left:93.18px;top:489.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:509.66px" class="cls_039"><span class="cls_039">Reading data from a database is only part of the story. At some point, data must be</span></div>
<div style="position:absolute;left:93.18px;top:522.68px" class="cls_039"><span class="cls_039">written to the database so that it can be read. So let’s see about implementing the</span></div>
<div style="position:absolute;left:93.18px;top:535.67px" class="cls_059"><span class="cls_059">save()</span><span class="cls_039"> method.</span></div>
<div style="position:absolute;left:93.18px;top:553.85px" class="cls_064"><span class="cls_064">I</span><span class="cls_065">NSERTING</span><span class="cls_064"> </span><span class="cls_065">A</span><span class="cls_064"> </span><span class="cls_065">ROW</span></div>
<div style="position:absolute;left:93.18px;top:566.18px" class="cls_059"><span class="cls_059">JdbcTemplate</span><span class="cls_039">’s </span><span class="cls_059">update()</span><span class="cls_039"> method can be used for any query that writes or updates</span></div>
<div style="position:absolute;left:93.18px;top:579.17px" class="cls_039"><span class="cls_039">data in the database. And, as shown in the following listing, it can be used to insert</span></div>
<div style="position:absolute;left:93.18px;top:592.19px" class="cls_039"><span class="cls_039">data into the database.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:55428px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background085.jpg" width="531" height="666"></div>
<div style="position:absolute;left:203.13px;top:24.35px" class="cls_055"><span class="cls_055">Reading and writing data with JDBC</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">63</span></div>
<div style="position:absolute;left:114.18px;top:54.65px" class="cls_066"><span class="cls_066">Listing 3.6</span></div>
<div style="position:absolute;left:166.27px;top:54.26px" class="cls_066"><span class="cls_066">Inserting data with </span><span class="cls_077">JdbcTemplate</span></div>
<div style="position:absolute;left:102.18px;top:73.64px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:102.18px;top:83.63px" class="cls_060"><span class="cls_060">public Ingredient save(Ingredient ingredient) {</span></div>
<div style="position:absolute;left:111.78px;top:93.62px" class="cls_060"><span class="cls_060">jdbc.update(</span></div>
<div style="position:absolute;left:130.95px;top:103.64px" class="cls_060"><span class="cls_060">"insert into Ingredient (id, name, type) values (?, ?, ?)",</span></div>
<div style="position:absolute;left:130.95px;top:113.63px" class="cls_060"><span class="cls_060">ingredient.getId(),</span></div>
<div style="position:absolute;left:130.95px;top:123.62px" class="cls_060"><span class="cls_060">ingredient.getName(),</span></div>
<div style="position:absolute;left:130.95px;top:133.64px" class="cls_060"><span class="cls_060">ingredient.getType().toString());</span></div>
<div style="position:absolute;left:111.78px;top:143.63px" class="cls_060"><span class="cls_060">return ingredient;</span></div>
<div style="position:absolute;left:102.18px;top:153.65px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:174.95px" class="cls_039"><span class="cls_039">Because it isn’t necessary to map </span><span class="cls_059">ResultSet</span><span class="cls_039"> data to an object, the </span><span class="cls_059">update()</span><span class="cls_039"> method is</span></div>
<div style="position:absolute;left:102.18px;top:187.97px" class="cls_039"><span class="cls_039">much simpler than </span><span class="cls_059">query()</span><span class="cls_039"> or </span><span class="cls_059">queryForObject()</span><span class="cls_039">. It only requires a </span><span class="cls_059">String</span><span class="cls_039"> contain-</span></div>
<div style="position:absolute;left:102.18px;top:200.96px" class="cls_039"><span class="cls_039">ing the SQL to perform as well as values to assign to any query parameters. In this</span></div>
<div style="position:absolute;left:102.18px;top:213.95px" class="cls_039"><span class="cls_039">case, the query has three parameters, which correspond to the final three parameters</span></div>
<div style="position:absolute;left:102.18px;top:226.97px" class="cls_039"><span class="cls_039">of the </span><span class="cls_059">save()</span><span class="cls_039">method, providing the ingredient’s ID, name, and type.</span></div>
<div style="position:absolute;left:118.23px;top:239.96px" class="cls_039"><span class="cls_039">With </span><span class="cls_059">JdbcIngredientRepository</span><span class="cls_039"> complete, you can now inject it into </span><span class="cls_059">Design-</span></div>
<div style="position:absolute;left:102.18px;top:252.95px" class="cls_059"><span class="cls_059">TacoController</span><span class="cls_039"> and use it to provide a list of </span><span class="cls_059">Ingredient</span><span class="cls_039"> objects instead of using</span></div>
<div style="position:absolute;left:102.18px;top:265.97px" class="cls_039"><span class="cls_039">hardcoded values (as you did in chapter 2). The changes to </span><span class="cls_059">DesignTacoController</span></div>
<div style="position:absolute;left:102.18px;top:278.96px" class="cls_039"><span class="cls_039">are shown next.</span></div>
<div style="position:absolute;left:114.18px;top:302.69px" class="cls_066"><span class="cls_066">Listing 3.7</span></div>
<div style="position:absolute;left:166.27px;top:302.69px" class="cls_066"><span class="cls_066">Injecting and using a repository in the controller</span></div>
<div style="position:absolute;left:102.18px;top:322.55px" class="cls_060"><span class="cls_060">@Controller</span></div>
<div style="position:absolute;left:102.18px;top:332.54px" class="cls_060"><span class="cls_060">@RequestMapping("/design")</span></div>
<div style="position:absolute;left:102.18px;top:342.53px" class="cls_060"><span class="cls_060">@SessionAttributes("order")</span></div>
<div style="position:absolute;left:102.18px;top:352.55px" class="cls_060"><span class="cls_060">public class DesignTacoController {</span></div>
<div style="position:absolute;left:111.78px;top:371.54px" class="cls_060"><span class="cls_060">private final IngredientRepository ingredientRepo;</span></div>
<div style="position:absolute;left:111.78px;top:390.56px" class="cls_060"><span class="cls_060">@Autowired</span></div>
<div style="position:absolute;left:111.77px;top:400.55px" class="cls_060"><span class="cls_060">public DesignTacoController(IngredientRepository ingredientRepo) {</span></div>
<div style="position:absolute;left:121.38px;top:410.54px" class="cls_060"><span class="cls_060">this.ingredientRepo = ingredientRepo;</span></div>
<div style="position:absolute;left:111.78px;top:420.56px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:436.55px" class="cls_060"><span class="cls_060">@GetMapping</span></div>
<div style="position:absolute;left:111.78px;top:446.54px" class="cls_060"><span class="cls_060">public String showDesignForm(Model model) {</span></div>
<div style="position:absolute;left:121.38px;top:456.56px" class="cls_060"><span class="cls_060">List&lt;Ingredient&gt; ingredients = new ArrayList&lt;&gt;();</span></div>
<div style="position:absolute;left:121.36px;top:466.55px" class="cls_060"><span class="cls_060">ingredientRepo.findAll().forEach(i -&gt; ingredients.add(i));</span></div>
<div style="position:absolute;left:121.38px;top:486.56px" class="cls_060"><span class="cls_060">Type[] types = Ingredient.Type.values();</span></div>
<div style="position:absolute;left:121.38px;top:496.55px" class="cls_060"><span class="cls_060">for (Type type : types) {</span></div>
<div style="position:absolute;left:130.95px;top:506.54px" class="cls_060"><span class="cls_060">model.addAttribute(type.toString().toLowerCase(),</span></div>
<div style="position:absolute;left:150.15px;top:516.56px" class="cls_060"><span class="cls_060">filterByType(ingredients, type));</span></div>
<div style="position:absolute;left:121.38px;top:526.55px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:121.38px;top:544.55px" class="cls_060"><span class="cls_060">return "design";</span></div>
<div style="position:absolute;left:111.78px;top:554.54px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:594.56px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:56104px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background086.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">64</span></div>
<div style="position:absolute;left:205.32px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 3</span></div>
<div style="position:absolute;left:249.45px;top:24.35px" class="cls_055"><span class="cls_055">Working with data</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">Notice that the second line of the </span><span class="cls_059">showDesignForm()</span><span class="cls_039"> method now makes a call to</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">the injected </span><span class="cls_059">IngredientRepository</span><span class="cls_039">’s </span><span class="cls_059">findAll()</span><span class="cls_039"> method. The </span><span class="cls_059">findAll()</span><span class="cls_039"> method</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">fetches all the ingredients from the database before filtering them into distinct types</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">in the model.</span></div>
<div style="position:absolute;left:109.61px;top:102.65px" class="cls_039"><span class="cls_039">You’re almost ready to fire up the application and try these changes out. But</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">before you can start reading data from the </span><span class="cls_059">Ingredient</span><span class="cls_039"> table referenced in the que-</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">ries, you should probably create that table and populate it with some ingredient data.</span></div>
<div style="position:absolute;left:57.18px;top:154.49px" class="cls_063"><span class="cls_063">3.1.3</span></div>
<div style="position:absolute;left:93.18px;top:154.49px" class="cls_063"><span class="cls_063">Defining a schema and preloading data</span></div>
<div style="position:absolute;left:93.18px;top:172.16px" class="cls_039"><span class="cls_039">Aside from the </span><span class="cls_059">Ingredient</span><span class="cls_039"> table, you’re also going to need some tables that hold</span></div>
<div style="position:absolute;left:93.18px;top:185.15px" class="cls_039"><span class="cls_039">order and design information. Figure 3.1 illustrates the tables you’ll need, as well as</span></div>
<div style="position:absolute;left:93.18px;top:198.17px" class="cls_039"><span class="cls_039">the relationships between those tables.</span></div>
<div style="position:absolute;left:203.79px;top:227.24px" class="cls_079"><span class="cls_079">Taco_Order_Tacos</span></div>
<div style="position:absolute;left:192.22px;top:233.62px" class="cls_080"><span class="cls_080">*</span></div>
<div style="position:absolute;left:276.87px;top:233.62px" class="cls_080"><span class="cls_080">*</span></div>
<div style="position:absolute;left:112.69px;top:238.22px" class="cls_079"><span class="cls_079">Taco_Order</span></div>
<div style="position:absolute;left:201.75px;top:240.58px" class="cls_057"><span class="cls_057">tacoOrder: bigint,</span></div>
<div style="position:absolute;left:97.98px;top:251.55px" class="cls_057"><span class="cls_057">id: identity</span></div>
<div style="position:absolute;left:201.75px;top:249.58px" class="cls_057"><span class="cls_057">taco: bigint</span></div>
<div style="position:absolute;left:97.98px;top:260.55px" class="cls_057"><span class="cls_057">deliveryName: varchar</span></div>
<div style="position:absolute;left:330.20px;top:261.23px" class="cls_079"><span class="cls_079">Taco</span></div>
<div style="position:absolute;left:97.98px;top:269.55px" class="cls_057"><span class="cls_057">deliveryStreet: varchar</span></div>
<div style="position:absolute;left:305.53px;top:274.63px" class="cls_057"><span class="cls_057">id: identity</span></div>
<div style="position:absolute;left:97.98px;top:278.55px" class="cls_057"><span class="cls_057">deliveryCity: varchar</span></div>
<div style="position:absolute;left:305.53px;top:283.63px" class="cls_057"><span class="cls_057">name: varchar</span></div>
<div style="position:absolute;left:97.98px;top:287.55px" class="cls_057"><span class="cls_057">deliveryState: varchar</span></div>
<div style="position:absolute;left:305.53px;top:292.63px" class="cls_057"><span class="cls_057">createdAt: timestamp</span></div>
<div style="position:absolute;left:97.98px;top:296.55px" class="cls_057"><span class="cls_057">deliveryZip: varchar</span></div>
<div style="position:absolute;left:97.98px;top:305.55px" class="cls_057"><span class="cls_057">ccNumber: varchar</span></div>
<div style="position:absolute;left:206.26px;top:305.34px" class="cls_079"><span class="cls_079">Taco_Ingredients</span></div>
<div style="position:absolute;left:275.09px;top:300.37px" class="cls_080"><span class="cls_080">*</span></div>
<div style="position:absolute;left:97.98px;top:314.55px" class="cls_057"><span class="cls_057">ccExpiration: varchar</span></div>
<div style="position:absolute;left:203.82px;top:318.72px" class="cls_057"><span class="cls_057">taco: bigint,</span></div>
<div style="position:absolute;left:97.98px;top:323.55px" class="cls_057"><span class="cls_057">ccCVV: varchar</span></div>
<div style="position:absolute;left:275.09px;top:321.29px" class="cls_080"><span class="cls_080">*</span></div>
<div style="position:absolute;left:203.73px;top:327.72px" class="cls_057"><span class="cls_057">ingredient: varchar</span></div>
<div style="position:absolute;left:97.98px;top:332.55px" class="cls_057"><span class="cls_057">placedAt: timestamp</span></div>
<div style="position:absolute;left:317.35px;top:344.13px" class="cls_079"><span class="cls_079">Ingredient</span></div>
<div style="position:absolute;left:312.62px;top:357.45px" class="cls_057"><span class="cls_057">id: varchar</span></div>
<div style="position:absolute;left:312.63px;top:366.46px" class="cls_057"><span class="cls_057">name: varchar</span></div>
<div style="position:absolute;left:312.98px;top:375.56px" class="cls_057"><span class="cls_057">type: varchar</span></div>
<div style="position:absolute;left:93.18px;top:398.81px" class="cls_053"><span class="cls_053">Figure 3.1</span></div>
<div style="position:absolute;left:137.79px;top:398.81px" class="cls_053"><span class="cls_053">The tables for the Taco Cloud schema</span></div>
<div style="position:absolute;left:93.18px;top:433.91px" class="cls_039"><span class="cls_039">The tables in figure 3.1 serve the following purposes:</span></div>
<div style="position:absolute;left:108.78px;top:452.93px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> Ingredient</span><span class="cls_039">—Holds ingredient information</span></div>
<div style="position:absolute;left:108.78px;top:466.91px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> Taco</span><span class="cls_039">—Holds essential information about a taco design</span></div>
<div style="position:absolute;left:108.78px;top:480.92px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> Taco_Ingredients</span><span class="cls_039">—Contains one or more rows for each row in </span><span class="cls_059">Taco</span><span class="cls_039">, mapping</span></div>
<div style="position:absolute;left:120.78px;top:493.91px" class="cls_039"><span class="cls_039">the taco to the ingredients for that taco</span></div>
<div style="position:absolute;left:108.78px;top:507.92px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> Taco_Order</span><span class="cls_039">—Holds essential order details</span></div>
<div style="position:absolute;left:108.78px;top:521.93px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> Taco_Order_Tacos</span><span class="cls_039">—Contains one or more rows for each row in </span><span class="cls_059">Taco_Order</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:120.78px;top:534.92px" class="cls_039"><span class="cls_039">mapping the order to the tacos in the order</span></div>
<div style="position:absolute;left:93.18px;top:554.93px" class="cls_039"><span class="cls_039">The next listing shows the SQL that creates the tables.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:56780px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background087.jpg" width="531" height="666"></div>
<div style="position:absolute;left:203.13px;top:24.35px" class="cls_055"><span class="cls_055">Reading and writing data with JDBC</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">65</span></div>
<div style="position:absolute;left:114.18px;top:54.38px" class="cls_066"><span class="cls_066">Listing 3.8</span></div>
<div style="position:absolute;left:166.26px;top:54.38px" class="cls_066"><span class="cls_066">Defining the Taco Cloud schema</span></div>
<div style="position:absolute;left:102.18px;top:73.22px" class="cls_060"><span class="cls_060">create table if not exists Ingredient (</span></div>
<div style="position:absolute;left:111.77px;top:83.24px" class="cls_060"><span class="cls_060">id varchar(4) not null,</span></div>
<div style="position:absolute;left:111.78px;top:93.23px" class="cls_060"><span class="cls_060">name varchar(25) not null,</span></div>
<div style="position:absolute;left:111.78px;top:103.22px" class="cls_060"><span class="cls_060">type varchar(10) not null</span></div>
<div style="position:absolute;left:102.18px;top:113.24px" class="cls_060"><span class="cls_060">);</span></div>
<div style="position:absolute;left:102.18px;top:133.25px" class="cls_060"><span class="cls_060">create table if not exists Taco (</span></div>
<div style="position:absolute;left:111.76px;top:143.24px" class="cls_060"><span class="cls_060">id identity,</span></div>
<div style="position:absolute;left:111.78px;top:153.23px" class="cls_060"><span class="cls_060">name varchar(50) not null,</span></div>
<div style="position:absolute;left:111.78px;top:163.25px" class="cls_060"><span class="cls_060">createdAt timestamp not null</span></div>
<div style="position:absolute;left:102.18px;top:173.24px" class="cls_060"><span class="cls_060">);</span></div>
<div style="position:absolute;left:102.18px;top:193.25px" class="cls_060"><span class="cls_060">create table if not exists Taco_Ingredients (</span></div>
<div style="position:absolute;left:111.77px;top:203.24px" class="cls_060"><span class="cls_060">taco bigint not null,</span></div>
<div style="position:absolute;left:111.78px;top:213.23px" class="cls_060"><span class="cls_060">ingredient varchar(4) not null</span></div>
<div style="position:absolute;left:102.18px;top:223.25px" class="cls_060"><span class="cls_060">);</span></div>
<div style="position:absolute;left:102.18px;top:243.23px" class="cls_060"><span class="cls_060">alter table Taco_Ingredients</span></div>
<div style="position:absolute;left:121.38px;top:253.25px" class="cls_060"><span class="cls_060">add foreign key (taco) references Taco(id);</span></div>
<div style="position:absolute;left:102.18px;top:263.24px" class="cls_060"><span class="cls_060">alter table Taco_Ingredients</span></div>
<div style="position:absolute;left:121.38px;top:273.23px" class="cls_060"><span class="cls_060">add foreign key (ingredient) references Ingredient(id);</span></div>
<div style="position:absolute;left:102.18px;top:293.24px" class="cls_060"><span class="cls_060">create table if not exists Taco_Order (</span></div>
<div style="position:absolute;left:111.76px;top:303.23px" class="cls_060"><span class="cls_060">id identity,</span></div>
<div style="position:absolute;left:121.38px;top:313.25px" class="cls_060"><span class="cls_060">deliveryName varchar(50) not null,</span></div>
<div style="position:absolute;left:121.38px;top:323.24px" class="cls_060"><span class="cls_060">deliveryStreet varchar(50) not null,</span></div>
<div style="position:absolute;left:121.38px;top:333.23px" class="cls_060"><span class="cls_060">deliveryCity varchar(50) not null,</span></div>
<div style="position:absolute;left:121.36px;top:343.25px" class="cls_060"><span class="cls_060">deliveryState varchar(2) not null,</span></div>
<div style="position:absolute;left:121.38px;top:353.24px" class="cls_060"><span class="cls_060">deliveryZip varchar(10) not null,</span></div>
<div style="position:absolute;left:121.38px;top:363.23px" class="cls_060"><span class="cls_060">ccNumber varchar(16) not null,</span></div>
<div style="position:absolute;left:121.38px;top:373.25px" class="cls_060"><span class="cls_060">ccExpiration varchar(5) not null,</span></div>
<div style="position:absolute;left:121.38px;top:383.24px" class="cls_060"><span class="cls_060">ccCVV varchar(3) not null,</span></div>
<div style="position:absolute;left:121.38px;top:393.26px" class="cls_060"><span class="cls_060">placedAt timestamp not null</span></div>
<div style="position:absolute;left:102.18px;top:403.25px" class="cls_060"><span class="cls_060">);</span></div>
<div style="position:absolute;left:102.18px;top:423.26px" class="cls_060"><span class="cls_060">create table if not exists Taco_Order_Tacos (</span></div>
<div style="position:absolute;left:111.78px;top:433.25px" class="cls_060"><span class="cls_060">tacoOrder bigint not null,</span></div>
<div style="position:absolute;left:111.77px;top:443.24px" class="cls_060"><span class="cls_060">taco bigint not null</span></div>
<div style="position:absolute;left:102.18px;top:453.26px" class="cls_060"><span class="cls_060">);</span></div>
<div style="position:absolute;left:102.18px;top:473.24px" class="cls_060"><span class="cls_060">alter table Taco_Order_Tacos</span></div>
<div style="position:absolute;left:121.38px;top:483.26px" class="cls_060"><span class="cls_060">add foreign key (tacoOrder) references Taco_Order(id);</span></div>
<div style="position:absolute;left:102.18px;top:493.25px" class="cls_060"><span class="cls_060">alter table Taco_Order_Tacos</span></div>
<div style="position:absolute;left:121.38px;top:503.24px" class="cls_061"><span class="cls_061">add foreign key (taco) references Taco(id);</span></div>
<div style="position:absolute;left:102.18px;top:524.57px" class="cls_039"><span class="cls_039">The big question is where to put this schema definition. As it turns out, Spring Boot</span></div>
<div style="position:absolute;left:102.18px;top:537.56px" class="cls_039"><span class="cls_039">answers that question.</span></div>
<div style="position:absolute;left:117.43px;top:550.58px" class="cls_039"><span class="cls_039">If there’s a file named schema.sql in the root of the application’s classpath, then</span></div>
<div style="position:absolute;left:102.18px;top:563.57px" class="cls_039"><span class="cls_039">the SQL in that file will be executed against the database when the application starts.</span></div>
<div style="position:absolute;left:102.18px;top:576.59px" class="cls_039"><span class="cls_039">Therefore, you should place the contents of listing 3.8 in your project as a file named</span></div>
<div style="position:absolute;left:102.18px;top:589.58px" class="cls_039"><span class="cls_039">schema.sql in the src/main/resources folder.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:57456px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background088.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">66</span></div>
<div style="position:absolute;left:205.32px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 3</span></div>
<div style="position:absolute;left:249.45px;top:24.35px" class="cls_055"><span class="cls_055">Working with data</span></div>
<div style="position:absolute;left:109.32px;top:50.66px" class="cls_039"><span class="cls_039">You also need to preload the database with some ingredient data. Fortunately,</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">Spring Boot will also execute a file named data.sql from the root of the classpath when</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">the application starts. Therefore, you can load the database with ingredient data using</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">the insert statements in the next listing, placed in src/main/resources/data.sql.</span></div>
<div style="position:absolute;left:105.18px;top:116.39px" class="cls_066"><span class="cls_066">Listing 3.9</span></div>
<div style="position:absolute;left:157.26px;top:116.39px" class="cls_066"><span class="cls_066">Preloading the database</span></div>
<div style="position:absolute;left:93.18px;top:136.25px" class="cls_060"><span class="cls_060">delete from Taco_Order_Tacos;</span></div>
<div style="position:absolute;left:93.18px;top:146.24px" class="cls_060"><span class="cls_060">delete from Taco_Ingredients;</span></div>
<div style="position:absolute;left:93.18px;top:156.23px" class="cls_060"><span class="cls_060">delete from Taco;</span></div>
<div style="position:absolute;left:93.18px;top:166.25px" class="cls_060"><span class="cls_060">delete from Taco_Order;</span></div>
<div style="position:absolute;left:93.18px;top:186.23px" class="cls_060"><span class="cls_060">delete from Ingredient;</span></div>
<div style="position:absolute;left:93.18px;top:196.25px" class="cls_060"><span class="cls_060">insert into Ingredient (id, name, type)</span></div>
<div style="position:absolute;left:169.96px;top:206.24px" class="cls_060"><span class="cls_060">values ('FLTO', 'Flour Tortilla', 'WRAP');</span></div>
<div style="position:absolute;left:93.18px;top:216.23px" class="cls_060"><span class="cls_060">insert into Ingredient (id, name, type)</span></div>
<div style="position:absolute;left:169.96px;top:226.25px" class="cls_060"><span class="cls_060">values ('COTO', 'Corn Tortilla', 'WRAP');</span></div>
<div style="position:absolute;left:93.18px;top:236.24px" class="cls_060"><span class="cls_060">insert into Ingredient (id, name, type)</span></div>
<div style="position:absolute;left:169.96px;top:246.23px" class="cls_060"><span class="cls_060">values ('GRBF', 'Ground Beef', 'PROTEIN');</span></div>
<div style="position:absolute;left:93.18px;top:256.25px" class="cls_060"><span class="cls_060">insert into Ingredient (id, name, type)</span></div>
<div style="position:absolute;left:169.96px;top:266.24px" class="cls_060"><span class="cls_060">values ('CARN', 'Carnitas', 'PROTEIN');</span></div>
<div style="position:absolute;left:93.18px;top:276.23px" class="cls_060"><span class="cls_060">insert into Ingredient (id, name, type)</span></div>
<div style="position:absolute;left:169.96px;top:286.25px" class="cls_060"><span class="cls_060">values ('TMTO', 'Diced Tomatoes', 'VEGGIES');</span></div>
<div style="position:absolute;left:93.18px;top:296.24px" class="cls_060"><span class="cls_060">insert into Ingredient (id, name, type)</span></div>
<div style="position:absolute;left:169.96px;top:306.23px" class="cls_060"><span class="cls_060">values ('LETC', 'Lettuce', 'VEGGIES');</span></div>
<div style="position:absolute;left:93.18px;top:316.25px" class="cls_060"><span class="cls_060">insert into Ingredient (id, name, type)</span></div>
<div style="position:absolute;left:169.96px;top:326.24px" class="cls_060"><span class="cls_060">values ('CHED', 'Cheddar', 'CHEESE');</span></div>
<div style="position:absolute;left:93.18px;top:336.23px" class="cls_060"><span class="cls_060">insert into Ingredient (id, name, type)</span></div>
<div style="position:absolute;left:169.96px;top:346.25px" class="cls_060"><span class="cls_060">values ('JACK', 'Monterrey Jack', 'CHEESE');</span></div>
<div style="position:absolute;left:93.18px;top:356.24px" class="cls_060"><span class="cls_060">insert into Ingredient (id, name, type)</span></div>
<div style="position:absolute;left:169.96px;top:366.23px" class="cls_060"><span class="cls_060">values ('SLSA', 'Salsa', 'SAUCE');</span></div>
<div style="position:absolute;left:93.18px;top:376.25px" class="cls_060"><span class="cls_060">insert into Ingredient (id, name, type)</span></div>
<div style="position:absolute;left:169.96px;top:386.24px" class="cls_061"><span class="cls_061">values ('SRCR', 'Sour Cream', 'SAUCE');</span></div>
<div style="position:absolute;left:93.18px;top:409.58px" class="cls_039"><span class="cls_039">Even though you’ve only developed a repository for ingredient data, you can fire up</span></div>
<div style="position:absolute;left:93.18px;top:422.57px" class="cls_039"><span class="cls_039">the Taco Cloud application at this point and visit the design page to see </span><span class="cls_059">JdbcIngredi-</span></div>
<div style="position:absolute;left:93.18px;top:435.56px" class="cls_059"><span class="cls_059">entRepository</span><span class="cls_039"> in action. Go ahead ... give it a try. When you get back, you’ll write the</span></div>
<div style="position:absolute;left:93.18px;top:448.58px" class="cls_039"><span class="cls_039">repositories for persisting </span><span class="cls_059">Taco</span><span class="cls_039">, </span><span class="cls_059">Order</span><span class="cls_039">, and data.</span></div>
<div style="position:absolute;left:57.18px;top:474.41px" class="cls_063"><span class="cls_063">3.1.4</span></div>
<div style="position:absolute;left:93.18px;top:474.41px" class="cls_063"><span class="cls_063">Inserting data</span></div>
<div style="position:absolute;left:93.18px;top:492.08px" class="cls_039"><span class="cls_039">You’ve already had a glimpse into how to use </span><span class="cls_059">JdbcTemplate</span><span class="cls_039"> to write data to the data-</span></div>
<div style="position:absolute;left:93.18px;top:505.07px" class="cls_039"><span class="cls_039">base. The </span><span class="cls_059">save()</span><span class="cls_039"> method in </span><span class="cls_059">JdbcIngredientRepository</span><span class="cls_039"> used the </span><span class="cls_059">update()</span><span class="cls_039"> method</span></div>
<div style="position:absolute;left:93.18px;top:518.06px" class="cls_039"><span class="cls_039">of </span><span class="cls_059">JdbcTemplate</span><span class="cls_039"> to save </span><span class="cls_059">Ingredient</span><span class="cls_039"> objects to the database.</span></div>
<div style="position:absolute;left:108.38px;top:531.08px" class="cls_039"><span class="cls_039">Although that was a good first example, it was perhaps a bit too simple. As you’ll</span></div>
<div style="position:absolute;left:93.18px;top:544.07px" class="cls_039"><span class="cls_039">soon see, saving data can be more involved than what </span><span class="cls_059">JdbcIngredientRepository</span></div>
<div style="position:absolute;left:93.18px;top:557.09px" class="cls_039"><span class="cls_039">needed. Two ways to save data with </span><span class="cls_059">JdbcTemplate</span><span class="cls_039"> include the following:</span></div>
<div style="position:absolute;left:108.78px;top:574.07px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Directly, using the </span><span class="cls_059">update()</span><span class="cls_039"> method</span></div>
<div style="position:absolute;left:108.78px;top:588.08px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Using the </span><span class="cls_059">SimpleJdbcInsert</span><span class="cls_039"> wrapper class</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:58132px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background089.jpg" width="531" height="666"></div>
<div style="position:absolute;left:203.13px;top:24.35px" class="cls_055"><span class="cls_055">Reading and writing data with JDBC</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">67</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">Let’s first see how to use the </span><span class="cls_059">update()</span><span class="cls_039"> method when the persistence needs are more</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">complex than what was required to save an </span><span class="cls_059">Ingredient</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:102.18px;top:81.83px" class="cls_064"><span class="cls_064">S</span><span class="cls_065">AVING</span><span class="cls_064"> </span><span class="cls_065">DATA</span><span class="cls_064"> </span><span class="cls_065">WITH</span><span class="cls_064"> J</span><span class="cls_065">DBC</span><span class="cls_064">T</span><span class="cls_065">EMPLATE</span></div>
<div style="position:absolute;left:102.18px;top:94.16px" class="cls_039"><span class="cls_039">For now, the only thing that the taco and order repositories need to do is to save their</span></div>
<div style="position:absolute;left:102.18px;top:107.15px" class="cls_039"><span class="cls_039">respective objects. To save </span><span class="cls_059">Taco</span><span class="cls_039"> objects, the </span><span class="cls_059">TacoRepository</span><span class="cls_039"> declares a </span><span class="cls_059">save()</span><span class="cls_039"> method</span></div>
<div style="position:absolute;left:102.18px;top:120.17px" class="cls_039"><span class="cls_039">like this:</span></div>
<div style="position:absolute;left:102.18px;top:139.85px" class="cls_060"><span class="cls_060">package tacos.data;</span></div>
<div style="position:absolute;left:102.18px;top:159.83px" class="cls_060"><span class="cls_060">import tacos.Taco;</span></div>
<div style="position:absolute;left:102.18px;top:179.84px" class="cls_060"><span class="cls_060">public interface TacoRepository</span></div>
<div style="position:absolute;left:260.53px;top:179.84px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:111.78px;top:199.85px" class="cls_060"><span class="cls_060">Taco save(Taco design);</span></div>
<div style="position:absolute;left:102.18px;top:219.83px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:241.16px" class="cls_039"><span class="cls_039">Similarly, </span><span class="cls_059">OrderRepository</span><span class="cls_039"> also declares a </span><span class="cls_059">save()</span><span class="cls_039"> method:</span></div>
<div style="position:absolute;left:102.18px;top:260.84px" class="cls_060"><span class="cls_060">package tacos.data;</span></div>
<div style="position:absolute;left:102.18px;top:280.85px" class="cls_060"><span class="cls_060">import tacos.Order;</span></div>
<div style="position:absolute;left:102.18px;top:300.83px" class="cls_060"><span class="cls_060">public interface OrderRepository {</span></div>
<div style="position:absolute;left:111.78px;top:320.84px" class="cls_060"><span class="cls_060">Order save(Order order);</span></div>
<div style="position:absolute;left:102.18px;top:340.85px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:362.18px" class="cls_039"><span class="cls_039">Seems simple enough, right? Not so quick. Saving a taco design requires that you also</span></div>
<div style="position:absolute;left:102.18px;top:375.17px" class="cls_039"><span class="cls_039">save the ingredients associated with that taco to the </span><span class="cls_059">Taco_Ingredients</span><span class="cls_039"> table. Like-</span></div>
<div style="position:absolute;left:102.18px;top:388.16px" class="cls_039"><span class="cls_039">wise, saving an order requires that you also save the tacos associated with the order to</span></div>
<div style="position:absolute;left:102.18px;top:401.18px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">Taco_Order_Tacos</span><span class="cls_039"> table. This makes saving tacos and orders a bit more challeng-</span></div>
<div style="position:absolute;left:102.18px;top:414.17px" class="cls_039"><span class="cls_039">ing than what was required to save an ingredient.</span></div>
<div style="position:absolute;left:117.75px;top:427.16px" class="cls_039"><span class="cls_039">To implement </span><span class="cls_059">TacoRepository</span><span class="cls_039">, you need a </span><span class="cls_059">save()</span><span class="cls_039"> method that starts by saving</span></div>
<div style="position:absolute;left:102.18px;top:440.18px" class="cls_039"><span class="cls_039">the essential taco design details (for example, the name and time of creation), and</span></div>
<div style="position:absolute;left:102.18px;top:453.17px" class="cls_039"><span class="cls_039">then inserts one row into </span><span class="cls_059">Taco_Ingredients</span><span class="cls_039"> for each ingredient in the </span><span class="cls_059">Taco</span><span class="cls_039"> object.</span></div>
<div style="position:absolute;left:102.18px;top:466.16px" class="cls_039"><span class="cls_039">The following listing shows the complete </span><span class="cls_059">JdbcTacoRepository</span><span class="cls_039"> class.</span></div>
<div style="position:absolute;left:114.18px;top:490.16px" class="cls_066"><span class="cls_066">Listing 3.10</span></div>
<div style="position:absolute;left:171.67px;top:489.77px" class="cls_066"><span class="cls_066">Implementing </span><span class="cls_077">TacoRepository</span><span class="cls_066"> with </span><span class="cls_077">JdbcTemplate</span></div>
<div style="position:absolute;left:102.18px;top:510.14px" class="cls_060"><span class="cls_060">package tacos.data;</span></div>
<div style="position:absolute;left:102.18px;top:530.15px" class="cls_060"><span class="cls_060">import java.sql.Timestamp;</span></div>
<div style="position:absolute;left:102.18px;top:540.14px" class="cls_060"><span class="cls_060">import java.sql.Types;</span></div>
<div style="position:absolute;left:102.18px;top:550.16px" class="cls_060"><span class="cls_060">import java.util.Arrays;</span></div>
<div style="position:absolute;left:102.18px;top:560.15px" class="cls_060"><span class="cls_060">import java.util.Date;</span></div>
<div style="position:absolute;left:102.18px;top:580.16px" class="cls_060"><span class="cls_060">import org.springframework.jdbc.core.JdbcTemplate;</span></div>
<div style="position:absolute;left:102.18px;top:590.15px" class="cls_060"><span class="cls_060">import org.springframework.jdbc.core.PreparedStatementCreator;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:58808px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background090.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">68</span></div>
<div style="position:absolute;left:205.32px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 3</span></div>
<div style="position:absolute;left:249.45px;top:24.35px" class="cls_055"><span class="cls_055">Working with data</span></div>
<div style="position:absolute;left:93.18px;top:51.32px" class="cls_060"><span class="cls_060">import org.springframework.jdbc.core.PreparedStatementCreatorFactory;</span></div>
<div style="position:absolute;left:93.18px;top:61.34px" class="cls_060"><span class="cls_060">import org.springframework.jdbc.support.GeneratedKeyHolder;</span></div>
<div style="position:absolute;left:93.18px;top:71.33px" class="cls_060"><span class="cls_060">import org.springframework.jdbc.support.KeyHolder;</span></div>
<div style="position:absolute;left:93.18px;top:81.32px" class="cls_060"><span class="cls_060">import org.springframework.stereotype.Repository;</span></div>
<div style="position:absolute;left:93.18px;top:101.33px" class="cls_060"><span class="cls_060">import tacos.Ingredient;</span></div>
<div style="position:absolute;left:93.18px;top:111.32px" class="cls_060"><span class="cls_060">import tacos.Taco;</span></div>
<div style="position:absolute;left:93.18px;top:131.33px" class="cls_060"><span class="cls_060">@Repository</span></div>
<div style="position:absolute;left:93.18px;top:141.35px" class="cls_060"><span class="cls_060">public class JdbcTacoRepository implements TacoRepository {</span></div>
<div style="position:absolute;left:102.78px;top:161.33px" class="cls_060"><span class="cls_060">private JdbcTemplate jdbc;</span></div>
<div style="position:absolute;left:102.78px;top:181.34px" class="cls_060"><span class="cls_060">public JdbcTacoRepository(JdbcTemplate jdbc) {</span></div>
<div style="position:absolute;left:112.38px;top:191.33px" class="cls_060"><span class="cls_060">this.jdbc = jdbc;</span></div>
<div style="position:absolute;left:102.78px;top:201.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.78px;top:221.33px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:102.77px;top:231.35px" class="cls_060"><span class="cls_060">public Taco save(Taco taco) {</span></div>
<div style="position:absolute;left:112.38px;top:241.34px" class="cls_060"><span class="cls_060">long tacoId = saveTacoInfo(taco);</span></div>
<div style="position:absolute;left:112.38px;top:251.33px" class="cls_060"><span class="cls_060">taco.setId(tacoId);</span></div>
<div style="position:absolute;left:112.38px;top:261.35px" class="cls_060"><span class="cls_060">for (Ingredient ingredient : taco.getIngredients()) {</span></div>
<div style="position:absolute;left:121.95px;top:271.34px" class="cls_060"><span class="cls_060">saveIngredientToTaco(ingredient, tacoId);</span></div>
<div style="position:absolute;left:112.38px;top:281.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:112.38px;top:301.34px" class="cls_060"><span class="cls_060">return taco;</span></div>
<div style="position:absolute;left:102.78px;top:311.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.78px;top:331.34px" class="cls_060"><span class="cls_060">private long saveTacoInfo(Taco taco) {</span></div>
<div style="position:absolute;left:112.38px;top:341.33px" class="cls_060"><span class="cls_060">taco.setCreatedAt(new Date());</span></div>
<div style="position:absolute;left:112.38px;top:351.35px" class="cls_060"><span class="cls_060">PreparedStatementCreator psc =</span></div>
<div style="position:absolute;left:131.55px;top:361.34px" class="cls_060"><span class="cls_060">new PreparedStatementCreatorFactory(</span></div>
<div style="position:absolute;left:150.74px;top:371.33px" class="cls_060"><span class="cls_060">"insert into Taco (name, createdAt) values (?, ?)",</span></div>
<div style="position:absolute;left:150.76px;top:381.35px" class="cls_060"><span class="cls_060">Types.VARCHAR, Types.TIMESTAMP</span></div>
<div style="position:absolute;left:131.55px;top:391.34px" class="cls_060"><span class="cls_060">).newPreparedStatementCreator(</span></div>
<div style="position:absolute;left:150.75px;top:401.36px" class="cls_060"><span class="cls_060">Arrays.asList(</span></div>
<div style="position:absolute;left:169.95px;top:411.35px" class="cls_060"><span class="cls_060">taco.getName(),</span></div>
<div style="position:absolute;left:169.95px;top:421.34px" class="cls_060"><span class="cls_060">new Timestamp(taco.getCreatedAt().getTime())));</span></div>
<div style="position:absolute;left:112.36px;top:441.35px" class="cls_060"><span class="cls_060">KeyHolder keyHolder = new GeneratedKeyHolder();</span></div>
<div style="position:absolute;left:112.38px;top:451.34px" class="cls_060"><span class="cls_060">jdbc.update(psc, keyHolder);</span></div>
<div style="position:absolute;left:112.38px;top:471.35px" class="cls_060"><span class="cls_060">return keyHolder.getKey().longValue();</span></div>
<div style="position:absolute;left:102.78px;top:481.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.78px;top:501.35px" class="cls_060"><span class="cls_060">private void saveIngredientToTaco(</span></div>
<div style="position:absolute;left:141.16px;top:511.34px" class="cls_060"><span class="cls_060">Ingredient ingredient, long tacoId) {</span></div>
<div style="position:absolute;left:112.38px;top:521.36px" class="cls_060"><span class="cls_060">jdbc.update(</span></div>
<div style="position:absolute;left:131.57px;top:531.35px" class="cls_060"><span class="cls_060">"insert into Taco_Ingredients (taco, ingredient) " +</span></div>
<div style="position:absolute;left:131.56px;top:541.34px" class="cls_060"><span class="cls_060">"values (?, ?)",</span></div>
<div style="position:absolute;left:131.55px;top:551.36px" class="cls_060"><span class="cls_060">tacoId, ingredient.getId());</span></div>
<div style="position:absolute;left:102.78px;top:561.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:581.36px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:59484px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background091.jpg" width="531" height="666"></div>
<div style="position:absolute;left:203.13px;top:24.35px" class="cls_055"><span class="cls_055">Reading and writing data with JDBC</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">69</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">As you can see, the </span><span class="cls_059">save()</span><span class="cls_039"> method starts by calling the private </span><span class="cls_059">saveTacoInfo()</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">method, and then uses the taco ID returned from that method to call </span><span class="cls_059">saveIngredient-</span></div>
<div style="position:absolute;left:102.27px;top:76.67px" class="cls_059"><span class="cls_059">ToTaco()</span><span class="cls_039">, which saves each ingredient. The devil is in the details of </span><span class="cls_059">saveTacoInfo()</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.06px;top:89.66px" class="cls_039"><span class="cls_039">When you insert a row into </span><span class="cls_059">Taco</span><span class="cls_039">, you need to know the ID generated by the data-</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">base so that you can reference it in each of the ingredients. The </span><span class="cls_059">update()</span><span class="cls_039"> method,</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">used when saving ingredient data, doesn’t help you get at the generated ID, so you</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">need a different </span><span class="cls_059">update()</span><span class="cls_039"> method here.</span></div>
<div style="position:absolute;left:116.79px;top:141.65px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">update()</span><span class="cls_039"> method you need accepts a </span><span class="cls_059">PreparedStatementCreator</span><span class="cls_039"> and a </span><span class="cls_059">Key-</span></div>
<div style="position:absolute;left:102.18px;top:154.67px" class="cls_059"><span class="cls_059">Holder</span><span class="cls_039">. It’s the </span><span class="cls_059">KeyHolder</span><span class="cls_039"> that will provide the generated taco ID. But in order to use</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">it, you must also create a </span><span class="cls_059">PreparedStatementCreator</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.45px;top:180.65px" class="cls_039"><span class="cls_039">As you can see from listing 3.10, creating a </span><span class="cls_059">PreparedStatementCreator</span><span class="cls_039"> is non-</span></div>
<div style="position:absolute;left:102.18px;top:193.67px" class="cls_039"><span class="cls_039">trivial. Start by creating a </span><span class="cls_059">PreparedStatementCreatorFactory</span><span class="cls_039">, giving it the SQL you</span></div>
<div style="position:absolute;left:102.18px;top:206.66px" class="cls_039"><span class="cls_039">want to execute, as well as the types of each query parameter. Then call </span><span class="cls_059">newPrepared-</span></div>
<div style="position:absolute;left:102.18px;top:219.65px" class="cls_059"><span class="cls_059">StatementCreator()</span><span class="cls_039"> on that factory, passing in the values needed in the query parame-</span></div>
<div style="position:absolute;left:102.18px;top:232.67px" class="cls_039"><span class="cls_039">ters to produce the </span><span class="cls_059">PreparedStatementCreator</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.78px;top:245.66px" class="cls_039"><span class="cls_039">With a </span><span class="cls_059">PreparedStatementCreator</span><span class="cls_039"> in hand, you can call </span><span class="cls_059">update()</span><span class="cls_039">, passing in</span></div>
<div style="position:absolute;left:102.18px;top:258.65px" class="cls_059"><span class="cls_059">PreparedStatementCreator</span><span class="cls_039"> and </span><span class="cls_059">KeyHolder</span><span class="cls_039"> (in this case, a </span><span class="cls_059">GeneratedKeyHolder</span></div>
<div style="position:absolute;left:102.18px;top:271.67px" class="cls_039"><span class="cls_039">instance). Once the </span><span class="cls_059">update()</span><span class="cls_039"> is finished, you can return the taco ID by returning</span></div>
<div style="position:absolute;left:102.18px;top:284.66px" class="cls_059"><span class="cls_059">keyHolder.getKey()</span><span class="cls_039">.</span><span class="cls_059">longValue()</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:116.97px;top:297.68px" class="cls_039"><span class="cls_039">Back in </span><span class="cls_059">save()</span><span class="cls_039">, cycle through each </span><span class="cls_059">Ingredient</span><span class="cls_039"> in </span><span class="cls_059">Taco</span><span class="cls_039">, calling </span><span class="cls_059">saveIngredient-</span></div>
<div style="position:absolute;left:102.18px;top:310.67px" class="cls_059"><span class="cls_059">ToTaco()</span><span class="cls_039">. The </span><span class="cls_059">saveIngredientToTaco()</span><span class="cls_039"> method uses the simpler form of </span><span class="cls_059">update()</span></div>
<div style="position:absolute;left:102.18px;top:323.66px" class="cls_039"><span class="cls_039">to save ingredient references to the </span><span class="cls_059">Taco_Ingredients</span><span class="cls_039"> table.</span></div>
<div style="position:absolute;left:116.82px;top:336.68px" class="cls_039"><span class="cls_039">All that’s left to do with </span><span class="cls_059">TacoRepository</span><span class="cls_039"> is to inject it into </span><span class="cls_059">DesignTacoController</span></div>
<div style="position:absolute;left:102.18px;top:349.67px" class="cls_039"><span class="cls_039">and use it when saving tacos. The following listing shows the changes necessary for</span></div>
<div style="position:absolute;left:102.18px;top:362.66px" class="cls_039"><span class="cls_039">injecting the repository.</span></div>
<div style="position:absolute;left:114.18px;top:386.66px" class="cls_066"><span class="cls_066">Listing 3.11</span></div>
<div style="position:absolute;left:171.68px;top:386.27px" class="cls_066"><span class="cls_066">Injecting and using </span><span class="cls_077">TacoRepository</span></div>
<div style="position:absolute;left:102.18px;top:406.64px" class="cls_060"><span class="cls_060">@Controller</span></div>
<div style="position:absolute;left:102.18px;top:416.66px" class="cls_060"><span class="cls_060">@RequestMapping("/design")</span></div>
<div style="position:absolute;left:102.18px;top:426.65px" class="cls_060"><span class="cls_060">@SessionAttributes("order")</span></div>
<div style="position:absolute;left:102.18px;top:436.64px" class="cls_060"><span class="cls_060">public class DesignTacoController {</span></div>
<div style="position:absolute;left:111.78px;top:455.66px" class="cls_060"><span class="cls_060">private final IngredientRepository ingredientRepo;</span></div>
<div style="position:absolute;left:111.78px;top:474.65px" class="cls_060"><span class="cls_060">private TacoRepository designRepo;</span></div>
<div style="position:absolute;left:111.78px;top:493.64px" class="cls_060"><span class="cls_060">@Autowired</span></div>
<div style="position:absolute;left:111.78px;top:503.66px" class="cls_060"><span class="cls_060">public DesignTacoController(</span></div>
<div style="position:absolute;left:140.55px;top:513.65px" class="cls_060"><span class="cls_060">IngredientRepository ingredientRepo,</span></div>
<div style="position:absolute;left:140.56px;top:523.64px" class="cls_060"><span class="cls_060">TacoRepository designRepo) {</span></div>
<div style="position:absolute;left:121.38px;top:533.66px" class="cls_060"><span class="cls_060">this.ingredientRepo = ingredientRepo;</span></div>
<div style="position:absolute;left:121.38px;top:543.65px" class="cls_060"><span class="cls_060">this.designRepo = designRepo;</span></div>
<div style="position:absolute;left:111.78px;top:553.64px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:593.66px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:60160px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background092.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">70</span></div>
<div style="position:absolute;left:205.32px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 3</span></div>
<div style="position:absolute;left:249.45px;top:24.35px" class="cls_055"><span class="cls_055">Working with data</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">As you can see, the constructor takes both an </span><span class="cls_059">IngredientRepository</span><span class="cls_039"> and a </span><span class="cls_059">Taco-</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_059"><span class="cls_059">Repository</span><span class="cls_039">. It assigns both to instance variables so that they can be used in the </span><span class="cls_059">show-</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_059"><span class="cls_059">DesignForm()</span><span class="cls_039"> and </span><span class="cls_059">processDesign()</span><span class="cls_039"> methods.</span></div>
<div style="position:absolute;left:108.96px;top:89.66px" class="cls_039"><span class="cls_039">Speaking of the </span><span class="cls_059">processDesign()</span><span class="cls_039"> method, its changes are a bit more extensive</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">than the changes you made to </span><span class="cls_059">showDesignForm()</span><span class="cls_039">. The next listing shows the new</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_059"><span class="cls_059">processDesign()</span><span class="cls_039"> method.</span></div>
<div style="position:absolute;left:105.18px;top:142.37px" class="cls_066"><span class="cls_066">Listing 3.12</span></div>
<div style="position:absolute;left:162.67px;top:142.37px" class="cls_066"><span class="cls_066">Saving taco designs and linking them to orders</span></div>
<div style="position:absolute;left:93.18px;top:162.23px" class="cls_060"><span class="cls_060">@Controller</span></div>
<div style="position:absolute;left:93.18px;top:172.25px" class="cls_060"><span class="cls_060">@RequestMapping("/design")</span></div>
<div style="position:absolute;left:93.18px;top:182.24px" class="cls_060"><span class="cls_060">@SessionAttributes("order")</span></div>
<div style="position:absolute;left:93.18px;top:192.23px" class="cls_060"><span class="cls_060">public class DesignTacoController {</span></div>
<div style="position:absolute;left:102.78px;top:214.25px" class="cls_060"><span class="cls_060">@ModelAttribute(name = "order")</span></div>
<div style="position:absolute;left:102.78px;top:224.24px" class="cls_060"><span class="cls_060">public Order order() {</span></div>
<div style="position:absolute;left:112.38px;top:234.23px" class="cls_060"><span class="cls_060">return new Order();</span></div>
<div style="position:absolute;left:102.78px;top:244.25px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.78px;top:266.24px" class="cls_060"><span class="cls_060">@ModelAttribute(name = "taco")</span></div>
<div style="position:absolute;left:102.78px;top:276.23px" class="cls_060"><span class="cls_060">public Taco taco() {</span></div>
<div style="position:absolute;left:112.38px;top:286.25px" class="cls_060"><span class="cls_060">return new Taco();</span></div>
<div style="position:absolute;left:102.78px;top:296.24px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.78px;top:316.25px" class="cls_060"><span class="cls_060">@PostMapping</span></div>
<div style="position:absolute;left:102.78px;top:326.24px" class="cls_060"><span class="cls_060">public String processDesign(</span></div>
<div style="position:absolute;left:121.96px;top:336.23px" class="cls_060"><span class="cls_060">@Valid Taco design, Errors errors,</span></div>
<div style="position:absolute;left:121.96px;top:346.25px" class="cls_060"><span class="cls_060">@ModelAttribute Order order) {</span></div>
<div style="position:absolute;left:112.38px;top:366.23px" class="cls_060"><span class="cls_060">if (errors.hasErrors()) {</span></div>
<div style="position:absolute;left:121.95px;top:376.25px" class="cls_060"><span class="cls_060">return "design";</span></div>
<div style="position:absolute;left:112.38px;top:386.24px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:112.36px;top:406.25px" class="cls_060"><span class="cls_060">Taco saved = designRepo.save(design);</span></div>
<div style="position:absolute;left:112.38px;top:416.24px" class="cls_060"><span class="cls_060">order.addDesign(saved);</span></div>
<div style="position:absolute;left:112.38px;top:436.25px" class="cls_060"><span class="cls_060">return "redirect:/orders/current";</span></div>
<div style="position:absolute;left:102.78px;top:446.24px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:486.26px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:509.57px" class="cls_039"><span class="cls_039">The first thing you’ll notice about the code in listing 3.12 is that </span><span class="cls_059">DesignTaco-</span></div>
<div style="position:absolute;left:93.27px;top:522.56px" class="cls_059"><span class="cls_059">Controller</span><span class="cls_039"> is now annotated with </span><span class="cls_059">@SessionAttributes("order")</span><span class="cls_039"> and that it has a</span></div>
<div style="position:absolute;left:93.18px;top:535.58px" class="cls_039"><span class="cls_039">new </span><span class="cls_059">@ModelAttribute</span><span class="cls_039"> annotated method, </span><span class="cls_059">order()</span><span class="cls_039">. As with the </span><span class="cls_059">taco()</span><span class="cls_039"> method, the</span></div>
<div style="position:absolute;left:93.18px;top:548.57px" class="cls_059"><span class="cls_059">@ModelAttribute</span><span class="cls_039"> annotation on </span><span class="cls_059">order()</span><span class="cls_039"> ensures that an </span><span class="cls_059">Order</span><span class="cls_039"> object will be created</span></div>
<div style="position:absolute;left:93.18px;top:561.59px" class="cls_039"><span class="cls_039">in the model. But unlike the </span><span class="cls_059">Taco</span><span class="cls_039"> object in the session, you need the order to be</span></div>
<div style="position:absolute;left:93.18px;top:574.58px" class="cls_039"><span class="cls_039">present across multiple requests so that you can create multiple tacos and add them</span></div>
<div style="position:absolute;left:93.18px;top:587.57px" class="cls_039"><span class="cls_039">to the order. The class-level </span><span class="cls_059">@SessionAttributes</span><span class="cls_039"> annotation specifies any model</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:60836px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background093.jpg" width="531" height="666"></div>
<div style="position:absolute;left:203.13px;top:24.35px" class="cls_055"><span class="cls_055">Reading and writing data with JDBC</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">71</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">objects like the order attribute that should be kept in session and available across</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">multiple requests.</span></div>
<div style="position:absolute;left:118.01px;top:76.67px" class="cls_039"><span class="cls_039">The real processing of a taco design happens in the </span><span class="cls_059">processDesign()</span><span class="cls_039"> method,</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">which now accepts an </span><span class="cls_059">Order</span><span class="cls_039"> object as a parameter, in addition to </span><span class="cls_059">Taco</span><span class="cls_039"> and </span><span class="cls_059">Errors</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">objects. The </span><span class="cls_059">Order</span><span class="cls_039"> parameter is annotated with </span><span class="cls_059">@ModelAttribute</span><span class="cls_039"> to indicate that its</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">value should come from the model and that Spring MVC shouldn’t attempt to bind</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">request parameters to it.</span></div>
<div style="position:absolute;left:118.65px;top:141.65px" class="cls_039"><span class="cls_039">After checking for validation errors, </span><span class="cls_059">processDesign()</span><span class="cls_039"> uses the injected </span><span class="cls_059">Taco-</span></div>
<div style="position:absolute;left:102.18px;top:154.67px" class="cls_059"><span class="cls_059">Repository</span><span class="cls_039"> to save the taco. It then adds the </span><span class="cls_059">Taco</span><span class="cls_039"> object to the </span><span class="cls_059">Order</span><span class="cls_039"> that’s kept in</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">the session.</span></div>
<div style="position:absolute;left:116.55px;top:180.65px" class="cls_039"><span class="cls_039">In fact, the </span><span class="cls_059">Order</span><span class="cls_039"> object remains in the session and isn’t saved to the database until</span></div>
<div style="position:absolute;left:102.18px;top:193.67px" class="cls_039"><span class="cls_039">the user completes and submits the order form. At that point, </span><span class="cls_059">OrderController</span></div>
<div style="position:absolute;left:102.18px;top:206.66px" class="cls_039"><span class="cls_039">needs to call out to an implementation of </span><span class="cls_059">OrderRepository</span><span class="cls_039"> to save the order. Let’s</span></div>
<div style="position:absolute;left:102.18px;top:219.65px" class="cls_039"><span class="cls_039">write that implementation.</span></div>
<div style="position:absolute;left:102.18px;top:237.83px" class="cls_064"><span class="cls_064">I</span><span class="cls_065">NSERTING</span><span class="cls_064"> </span><span class="cls_065">DATA</span><span class="cls_064"> </span><span class="cls_065">WITH</span><span class="cls_064"> S</span><span class="cls_065">IMPLE</span><span class="cls_064">J</span><span class="cls_065">DBC</span><span class="cls_064">I</span><span class="cls_065">NSERT</span></div>
<div style="position:absolute;left:102.18px;top:250.16px" class="cls_039"><span class="cls_039">You’ll recall that saving a taco involved not only saving the taco’s name and creation</span></div>
<div style="position:absolute;left:102.18px;top:263.15px" class="cls_039"><span class="cls_039">time to the </span><span class="cls_059">Taco</span><span class="cls_039"> table, but also saving a reference to the ingredients associated with the</span></div>
<div style="position:absolute;left:102.18px;top:276.17px" class="cls_039"><span class="cls_039">taco to the </span><span class="cls_059">Taco_Ingredients</span><span class="cls_039"> table. And you’ll also recall that this required you to know</span></div>
<div style="position:absolute;left:102.18px;top:289.16px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">Taco</span><span class="cls_039">’s ID, which you obtained using </span><span class="cls_059">KeyHolder</span><span class="cls_039"> and </span><span class="cls_059">PreparedStatementCreator</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.45px;top:302.18px" class="cls_039"><span class="cls_039">When it comes to saving orders, a similar circumstance exists. You must not only</span></div>
<div style="position:absolute;left:102.18px;top:315.17px" class="cls_039"><span class="cls_039">save the order data to the </span><span class="cls_059">Taco_Order</span><span class="cls_039"> table, but also references to each taco in the</span></div>
<div style="position:absolute;left:102.18px;top:328.16px" class="cls_039"><span class="cls_039">order to the </span><span class="cls_059">Taco_Order_Tacos</span><span class="cls_039"> table. But rather than use the cumbersome </span><span class="cls_059">Prepared-</span></div>
<div style="position:absolute;left:102.27px;top:341.18px" class="cls_059"><span class="cls_059">StatementCreator</span><span class="cls_039">, allow me to introduce you to </span><span class="cls_059">SimpleJdbcInsert</span><span class="cls_039">, an object that</span></div>
<div style="position:absolute;left:102.18px;top:354.17px" class="cls_039"><span class="cls_039">wraps </span><span class="cls_059">JdbcTemplate</span><span class="cls_039"> to make it easier to insert data into a table.</span></div>
<div style="position:absolute;left:116.93px;top:367.16px" class="cls_039"><span class="cls_039">You’ll start by creating </span><span class="cls_059">JdbcOrderRepository</span><span class="cls_039">, an implementation of </span><span class="cls_059">OrderRepos-</span></div>
<div style="position:absolute;left:102.18px;top:380.18px" class="cls_059"><span class="cls_059">itory</span><span class="cls_039">. But before you write the </span><span class="cls_059">save()</span><span class="cls_039"> method implementation, let’s focus on the</span></div>
<div style="position:absolute;left:102.18px;top:393.17px" class="cls_039"><span class="cls_039">constructor, where you’ll create a couple of instances of </span><span class="cls_059">SimpleJdbcInsert</span><span class="cls_039"> for insert-</span></div>
<div style="position:absolute;left:102.18px;top:406.16px" class="cls_039"><span class="cls_039">ing values into the </span><span class="cls_059">Taco_Order</span><span class="cls_039"> and </span><span class="cls_059">Taco_Order_Tacos</span><span class="cls_039"> tables. The following listing</span></div>
<div style="position:absolute;left:102.18px;top:419.18px" class="cls_039"><span class="cls_039">shows </span><span class="cls_059">JdbcOrderRepository</span><span class="cls_039"> (without the </span><span class="cls_059">save()</span><span class="cls_039"> method).</span></div>
<div style="position:absolute;left:114.18px;top:443.15px" class="cls_066"><span class="cls_066">Listing 3.13</span></div>
<div style="position:absolute;left:171.66px;top:442.76px" class="cls_066"><span class="cls_066">Creating a </span><span class="cls_077">SimpleJdbcInsert</span><span class="cls_066"> from a </span><span class="cls_077">JdbcTemplate</span></div>
<div style="position:absolute;left:102.18px;top:463.16px" class="cls_060"><span class="cls_060">package tacos.data;</span></div>
<div style="position:absolute;left:102.18px;top:483.14px" class="cls_060"><span class="cls_060">import java.util.Date;</span></div>
<div style="position:absolute;left:102.18px;top:493.16px" class="cls_060"><span class="cls_060">import java.util.HashMap;</span></div>
<div style="position:absolute;left:102.18px;top:503.15px" class="cls_060"><span class="cls_060">import java.util.List;</span></div>
<div style="position:absolute;left:102.18px;top:513.14px" class="cls_060"><span class="cls_060">import java.util.Map;</span></div>
<div style="position:absolute;left:102.18px;top:533.15px" class="cls_060"><span class="cls_060">import org.springframework.beans.factory.annotation.Autowired;</span></div>
<div style="position:absolute;left:102.18px;top:543.14px" class="cls_060"><span class="cls_060">import org.springframework.jdbc.core.JdbcTemplate;</span></div>
<div style="position:absolute;left:102.18px;top:553.16px" class="cls_060"><span class="cls_060">import org.springframework.jdbc.core.simple.SimpleJdbcInsert;</span></div>
<div style="position:absolute;left:102.18px;top:563.15px" class="cls_060"><span class="cls_060">import org.springframework.stereotype.Repository;</span></div>
<div style="position:absolute;left:102.18px;top:583.16px" class="cls_060"><span class="cls_060">import com.fasterxml.jackson.databind.ObjectMapper;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:61512px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background094.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">72</span></div>
<div style="position:absolute;left:205.32px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 3</span></div>
<div style="position:absolute;left:249.45px;top:24.35px" class="cls_055"><span class="cls_055">Working with data</span></div>
<div style="position:absolute;left:93.18px;top:51.32px" class="cls_060"><span class="cls_060">import tacos.Taco;</span></div>
<div style="position:absolute;left:93.18px;top:61.34px" class="cls_060"><span class="cls_060">import tacos.Order;</span></div>
<div style="position:absolute;left:93.18px;top:81.32px" class="cls_060"><span class="cls_060">@Repository</span></div>
<div style="position:absolute;left:93.18px;top:91.34px" class="cls_060"><span class="cls_060">public class JdbcOrderRepository implements OrderRepository {</span></div>
<div style="position:absolute;left:102.78px;top:111.32px" class="cls_060"><span class="cls_060">private SimpleJdbcInsert orderInserter;</span></div>
<div style="position:absolute;left:102.78px;top:121.34px" class="cls_060"><span class="cls_060">private SimpleJdbcInsert orderTacoInserter;</span></div>
<div style="position:absolute;left:102.78px;top:131.33px" class="cls_060"><span class="cls_060">private ObjectMapper objectMapper;</span></div>
<div style="position:absolute;left:102.78px;top:151.34px" class="cls_060"><span class="cls_060">@Autowired</span></div>
<div style="position:absolute;left:102.77px;top:161.33px" class="cls_060"><span class="cls_060">public JdbcOrderRepository(JdbcTemplate jdbc) {</span></div>
<div style="position:absolute;left:112.38px;top:171.35px" class="cls_060"><span class="cls_060">this.orderInserter = new SimpleJdbcInsert(jdbc)</span></div>
<div style="position:absolute;left:131.55px;top:181.34px" class="cls_060"><span class="cls_060">.withTableName("Taco_Order")</span></div>
<div style="position:absolute;left:131.55px;top:191.33px" class="cls_060"><span class="cls_060">.usingGeneratedKeyColumns("id");</span></div>
<div style="position:absolute;left:112.38px;top:211.34px" class="cls_060"><span class="cls_060">this.orderTacoInserter = new SimpleJdbcInsert(jdbc)</span></div>
<div style="position:absolute;left:131.55px;top:221.33px" class="cls_060"><span class="cls_060">.withTableName("Taco_Order_Tacos");</span></div>
<div style="position:absolute;left:112.38px;top:241.34px" class="cls_060"><span class="cls_060">this.objectMapper = new ObjectMapper();</span></div>
<div style="position:absolute;left:102.78px;top:251.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:291.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:312.68px" class="cls_039"><span class="cls_039">Like </span><span class="cls_059"> JdbcTacoRepository</span><span class="cls_039">, </span><span class="cls_059"> JdbcOrderRepository</span><span class="cls_039">  is  injected  with</span></div>
<div style="position:absolute;left:403.77px;top:313.68px" class="cls_059"><span class="cls_059">JdbcTemplate</span></div>
<div style="position:absolute;left:93.18px;top:325.67px" class="cls_039"><span class="cls_039">through its constructor. But instead of assigning </span><span class="cls_059">JdbcTemplate</span><span class="cls_039"> directly to an instance</span></div>
<div style="position:absolute;left:93.18px;top:338.66px" class="cls_039"><span class="cls_039">variable, the constructor uses it to construct a couple of </span><span class="cls_059">SimpleJdbcInsert</span><span class="cls_039"> instances.</span></div>
<div style="position:absolute;left:107.56px;top:351.68px" class="cls_039"><span class="cls_039">The first instance, which is assigned to the </span><span class="cls_059">orderInserter</span><span class="cls_039"> instance variable, is con-</span></div>
<div style="position:absolute;left:93.18px;top:364.67px" class="cls_039"><span class="cls_039">figured to work with the </span><span class="cls_059">Taco_Order</span><span class="cls_039"> table and to assume that the </span><span class="cls_059">id</span><span class="cls_039"> property will be</span></div>
<div style="position:absolute;left:93.18px;top:377.66px" class="cls_039"><span class="cls_039">provided or generated by the database. The second instance, assigned to </span><span class="cls_059">order-</span></div>
<div style="position:absolute;left:93.18px;top:390.68px" class="cls_059"><span class="cls_059">TacoInserter</span><span class="cls_039">, is configured to work with the </span><span class="cls_059">Taco_Order_Tacos</span><span class="cls_039"> table but makes no</span></div>
<div style="position:absolute;left:93.18px;top:403.67px" class="cls_039"><span class="cls_039">claims about how any IDs will be generated in that table.</span></div>
<div style="position:absolute;left:108.21px;top:416.66px" class="cls_039"><span class="cls_039">The constructor also creates an instance of Jackson’s </span><span class="cls_059">ObjectMapper</span><span class="cls_039"> and assigns it</span></div>
<div style="position:absolute;left:93.18px;top:429.68px" class="cls_039"><span class="cls_039">to an instance variable. Although Jackson is intended for JSON processing, you’ll see</span></div>
<div style="position:absolute;left:93.18px;top:442.67px" class="cls_039"><span class="cls_039">in a moment how you’ll repurpose it to help you as you save orders and their associ-</span></div>
<div style="position:absolute;left:93.18px;top:455.66px" class="cls_039"><span class="cls_039">ated tacos.</span></div>
<div style="position:absolute;left:109.32px;top:468.68px" class="cls_039"><span class="cls_039">Now let’s take a look at how the </span><span class="cls_059">save()</span><span class="cls_039"> method uses the </span><span class="cls_059">SimpleJdbcInsert</span></div>
<div style="position:absolute;left:93.18px;top:481.67px" class="cls_039"><span class="cls_039">instances. The next listing shows the </span><span class="cls_059">save()</span><span class="cls_039"> method, as well as a couple of private</span></div>
<div style="position:absolute;left:93.18px;top:494.66px" class="cls_039"><span class="cls_039">methods that </span><span class="cls_059">save()</span><span class="cls_039"> delegates for the real work.</span></div>
<div style="position:absolute;left:105.18px;top:518.66px" class="cls_066"><span class="cls_066">Listing 3.14</span></div>
<div style="position:absolute;left:162.68px;top:518.27px" class="cls_066"><span class="cls_066">Using </span><span class="cls_077">SimpleJdbcInsert</span><span class="cls_066"> to insert data</span></div>
<div style="position:absolute;left:102.78px;top:538.64px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:102.78px;top:548.66px" class="cls_060"><span class="cls_060">public Order save(Order order) {</span></div>
<div style="position:absolute;left:112.38px;top:558.65px" class="cls_060"><span class="cls_060">order.setPlacedAt(new Date());</span></div>
<div style="position:absolute;left:112.36px;top:568.64px" class="cls_060"><span class="cls_060">long orderId = saveOrderDetails(order);</span></div>
<div style="position:absolute;left:112.38px;top:578.66px" class="cls_060"><span class="cls_060">order.setId(orderId);</span></div>
<div style="position:absolute;left:112.38px;top:588.65px" class="cls_060"><span class="cls_060">List&lt;Taco&gt; tacos = order.getTacos();</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:62188px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background095.jpg" width="531" height="666"></div>
<div style="position:absolute;left:203.13px;top:24.35px" class="cls_055"><span class="cls_055">Reading and writing data with JDBC</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">73</span></div>
<div style="position:absolute;left:121.38px;top:51.32px" class="cls_060"><span class="cls_060">for (Taco taco : tacos) {</span></div>
<div style="position:absolute;left:130.95px;top:61.34px" class="cls_060"><span class="cls_060">saveTacoToOrder(taco, orderId);</span></div>
<div style="position:absolute;left:121.38px;top:71.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:121.38px;top:91.34px" class="cls_060"><span class="cls_060">return order;</span></div>
<div style="position:absolute;left:111.78px;top:101.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:121.34px" class="cls_060"><span class="cls_060">private long saveOrderDetails(Order order) {</span></div>
<div style="position:absolute;left:121.38px;top:131.33px" class="cls_060"><span class="cls_060">@SuppressWarnings("unchecked")</span></div>
<div style="position:absolute;left:121.38px;top:141.35px" class="cls_060"><span class="cls_060">Map&lt;String, Object&gt; values =</span></div>
<div style="position:absolute;left:140.55px;top:151.34px" class="cls_060"><span class="cls_060">objectMapper.convertValue(order, Map.class);</span></div>
<div style="position:absolute;left:121.38px;top:161.33px" class="cls_060"><span class="cls_060">values.put("placedAt", order.getPlacedAt());</span></div>
<div style="position:absolute;left:121.38px;top:181.34px" class="cls_060"><span class="cls_060">long orderId =</span></div>
<div style="position:absolute;left:140.55px;top:191.33px" class="cls_060"><span class="cls_060">orderInserter</span></div>
<div style="position:absolute;left:159.75px;top:201.35px" class="cls_060"><span class="cls_060">.executeAndReturnKey(values)</span></div>
<div style="position:absolute;left:159.75px;top:211.34px" class="cls_060"><span class="cls_060">.longValue();</span></div>
<div style="position:absolute;left:121.38px;top:221.33px" class="cls_060"><span class="cls_060">return orderId;</span></div>
<div style="position:absolute;left:111.78px;top:231.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.77px;top:251.33px" class="cls_060"><span class="cls_060">private void saveTacoToOrder(Taco taco, long orderId) {</span></div>
<div style="position:absolute;left:121.38px;top:261.35px" class="cls_060"><span class="cls_060">Map&lt;String, Object&gt; values = new HashMap&lt;&gt;();</span></div>
<div style="position:absolute;left:121.38px;top:271.34px" class="cls_060"><span class="cls_060">values.put("tacoOrder", orderId);</span></div>
<div style="position:absolute;left:121.38px;top:281.33px" class="cls_060"><span class="cls_060">values.put("taco", taco.getId());</span></div>
<div style="position:absolute;left:121.38px;top:291.35px" class="cls_060"><span class="cls_060">orderTacoInserter.execute(values);</span></div>
<div style="position:absolute;left:111.78px;top:301.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:322.67px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">save()</span><span class="cls_039"> method doesn’t actually save anything. It defines the flow for saving an</span></div>
<div style="position:absolute;left:102.18px;top:335.66px" class="cls_059"><span class="cls_059">Order</span><span class="cls_039"> and its associated </span><span class="cls_059">Taco</span><span class="cls_039"> objects, and delegates the persistence work to </span><span class="cls_059">save-</span></div>
<div style="position:absolute;left:102.18px;top:348.68px" class="cls_059"><span class="cls_059">OrderDetails()</span><span class="cls_039"> and </span><span class="cls_059">saveTacoToOrder()</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:118.53px;top:361.67px" class="cls_059"><span class="cls_059">SimpleJdbcInsert</span><span class="cls_039"> has a couple of useful methods for executing the insert:</span></div>
<div style="position:absolute;left:102.18px;top:374.66px" class="cls_059"><span class="cls_059">execute()</span><span class="cls_039"> and </span><span class="cls_059">executeAndReturnKey()</span><span class="cls_039">. Both accept a </span><span class="cls_059">Map&lt;String,</span><span class="cls_039"> </span><span class="cls_059">Object&gt;</span><span class="cls_039">, where</span></div>
<div style="position:absolute;left:102.18px;top:387.68px" class="cls_039"><span class="cls_039">the map keys correspond to the column names in the table the data is inserted into.</span></div>
<div style="position:absolute;left:102.18px;top:400.67px" class="cls_039"><span class="cls_039">The map values are inserted into those columns.</span></div>
<div style="position:absolute;left:117.24px;top:413.66px" class="cls_039"><span class="cls_039">It’s easy to create such a </span><span class="cls_059">Map</span><span class="cls_039"> by copying the values from </span><span class="cls_059">Order</span><span class="cls_039"> into entries of the</span></div>
<div style="position:absolute;left:102.18px;top:426.68px" class="cls_059"><span class="cls_059">Map</span><span class="cls_039">. But </span><span class="cls_059">Order</span><span class="cls_039"> has several properties, and those properties all share the same name</span></div>
<div style="position:absolute;left:102.18px;top:439.67px" class="cls_039"><span class="cls_039">with the columns that they’re going into. Because of that, in </span><span class="cls_059">saveOrderDetails()</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:102.18px;top:452.66px" class="cls_039"><span class="cls_039">I’ve decided to use Jackson’s </span><span class="cls_059">ObjectMapper</span><span class="cls_039"> and its </span><span class="cls_059">convertValue()</span><span class="cls_039"> method to con-</span></div>
<div style="position:absolute;left:102.18px;top:465.47px" class="cls_039"><span class="cls_039">vert an </span><span class="cls_059">Order</span><span class="cls_039"> into a </span><span class="cls_059">Map</span><span class="cls_039">.</span><span class="cls_069"><sup>1</sup></span><span class="cls_039"> Once the </span><span class="cls_059">Map</span><span class="cls_039"> is created, you’ll set the </span><span class="cls_059">placedAt</span><span class="cls_039"> entry to the</span></div>
<div style="position:absolute;left:102.18px;top:478.67px" class="cls_039"><span class="cls_039">value of the </span><span class="cls_059">Order</span><span class="cls_039"> object’s </span><span class="cls_059">placedAt</span><span class="cls_039"> property. This is necessary because </span><span class="cls_059">Object-</span></div>
<div style="position:absolute;left:102.18px;top:491.66px" class="cls_059"><span class="cls_059">Mapper</span><span class="cls_039"> would otherwise convert the </span><span class="cls_059">Date</span><span class="cls_039"> property into a </span><span class="cls_059">long</span><span class="cls_039">, which is incompatible</span></div>
<div style="position:absolute;left:102.18px;top:504.68px" class="cls_039"><span class="cls_039">with the </span><span class="cls_059">placedAt</span><span class="cls_039"> field in the </span><span class="cls_059">Taco_Order</span><span class="cls_039"> table.</span></div>
<div style="position:absolute;left:117.26px;top:517.67px" class="cls_039"><span class="cls_039">With a </span><span class="cls_059">Map</span><span class="cls_039"> full of order data ready, you can now call </span><span class="cls_059">executeAndReturnKey()</span><span class="cls_039"> on</span></div>
<div style="position:absolute;left:102.18px;top:530.66px" class="cls_059"><span class="cls_059">orderInserter</span><span class="cls_039">. This saves the order information to the </span><span class="cls_059">Taco_Order</span><span class="cls_039"> table and returns</span></div>
<div style="position:absolute;left:66.18px;top:563.99px" class="cls_070"><span class="cls_070">1</span></div>
<div style="position:absolute;left:75.18px;top:564.17px" class="cls_071"><span class="cls_071">I’ll admit that this is a hackish use of </span><span class="cls_060">ObjectMapper</span><span class="cls_071">, but you already have Jackson in the classpath; Spring</span></div>
<div style="position:absolute;left:75.18px;top:573.18px" class="cls_071"><span class="cls_071">Boot’s web starter brings it in. Also, using </span><span class="cls_060">ObjectMapper</span><span class="cls_071"> to map an object into a </span><span class="cls_059">Map</span><span class="cls_071"> is much easier than</span></div>
<div style="position:absolute;left:75.18px;top:582.69px" class="cls_071"><span class="cls_071">copying each property from the object into the </span><span class="cls_059">Map</span><span class="cls_071">. Feel free to replace the use of </span><span class="cls_060">ObjectMapper</span><span class="cls_071"> with any</span></div>
<div style="position:absolute;left:75.18px;top:592.17px" class="cls_071"><span class="cls_071">code you prefer that builds the </span><span class="cls_059">Map</span><span class="cls_071"> you’ll give to the inserter objects.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:62864px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background096.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">74</span></div>
<div style="position:absolute;left:205.32px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 3</span></div>
<div style="position:absolute;left:249.45px;top:24.35px" class="cls_055"><span class="cls_055">Working with data</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">the database-generated ID as a </span><span class="cls_059">Number</span><span class="cls_039"> object, which a call to </span><span class="cls_059">longValue()</span><span class="cls_039"> converts to</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">a </span><span class="cls_059">long</span><span class="cls_039"> returned from the method.</span></div>
<div style="position:absolute;left:110.13px;top:76.67px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">saveTacoToOrder()</span><span class="cls_039"> method is significantly simpler. Rather than use the</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_059"><span class="cls_059">ObjectMapper</span><span class="cls_039"> to convert an object to a </span><span class="cls_059">Map</span><span class="cls_039">, you create the </span><span class="cls_059">Map</span><span class="cls_039"> and set the appropri-</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">ate values. Once again, the map keys correspond to column names in the table. A sim-</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">ple call to the </span><span class="cls_059">orderTacoInserter</span><span class="cls_039">’s </span><span class="cls_059">execute()</span><span class="cls_039"> method performs the insert.</span></div>
<div style="position:absolute;left:107.61px;top:128.66px" class="cls_039"><span class="cls_039">Now you can inject </span><span class="cls_059">OrderRepository</span><span class="cls_039"> into </span><span class="cls_059">OrderController</span><span class="cls_039"> and start using it. The</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">following listing shows the complete </span><span class="cls_059">OrderController</span><span class="cls_039">, including the changes to use</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_039"><span class="cls_039">an injected </span><span class="cls_059">OrderRepository</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:105.18px;top:181.64px" class="cls_066"><span class="cls_066">Listing 3.15</span></div>
<div style="position:absolute;left:162.68px;top:181.25px" class="cls_066"><span class="cls_066">Using an </span><span class="cls_077">OrderRepository</span><span class="cls_066"> in </span><span class="cls_077">OrderController</span></div>
<div style="position:absolute;left:93.18px;top:201.65px" class="cls_060"><span class="cls_060">package tacos.web;</span></div>
<div style="position:absolute;left:93.18px;top:211.64px" class="cls_060"><span class="cls_060">import javax.validation.Valid;</span></div>
<div style="position:absolute;left:93.18px;top:231.65px" class="cls_060"><span class="cls_060">import org.springframework.stereotype.Controller;</span></div>
<div style="position:absolute;left:93.18px;top:241.64px" class="cls_060"><span class="cls_060">import org.springframework.validation.Errors;</span></div>
<div style="position:absolute;left:93.18px;top:251.63px" class="cls_060"><span class="cls_060">import org.springframework.web.bind.annotation.GetMapping;</span></div>
<div style="position:absolute;left:93.18px;top:261.65px" class="cls_060"><span class="cls_060">import org.springframework.web.bind.annotation.PostMapping;</span></div>
<div style="position:absolute;left:93.18px;top:271.64px" class="cls_060"><span class="cls_060">import org.springframework.web.bind.annotation.RequestMapping;</span></div>
<div style="position:absolute;left:93.18px;top:281.63px" class="cls_060"><span class="cls_060">import org.springframework.web.bind.annotation.SessionAttributes;</span></div>
<div style="position:absolute;left:93.18px;top:291.65px" class="cls_060"><span class="cls_060">import org.springframework.web.bind.support.SessionStatus;</span></div>
<div style="position:absolute;left:93.18px;top:311.63px" class="cls_060"><span class="cls_060">import tacos.Order;</span></div>
<div style="position:absolute;left:93.18px;top:321.65px" class="cls_060"><span class="cls_060">import tacos.data.OrderRepository;</span></div>
<div style="position:absolute;left:93.18px;top:341.63px" class="cls_060"><span class="cls_060">@Controller</span></div>
<div style="position:absolute;left:93.18px;top:351.65px" class="cls_060"><span class="cls_060">@RequestMapping("/orders")</span></div>
<div style="position:absolute;left:93.18px;top:361.64px" class="cls_060"><span class="cls_060">@SessionAttributes("order")</span></div>
<div style="position:absolute;left:93.18px;top:371.63px" class="cls_060"><span class="cls_060">public class OrderController {</span></div>
<div style="position:absolute;left:102.78px;top:391.64px" class="cls_060"><span class="cls_060">private OrderRepository orderRepo;</span></div>
<div style="position:absolute;left:102.78px;top:411.65px" class="cls_060"><span class="cls_060">public OrderController(OrderRepository orderRepo) {</span></div>
<div style="position:absolute;left:112.38px;top:421.64px" class="cls_060"><span class="cls_060">this.orderRepo = orderRepo;</span></div>
<div style="position:absolute;left:102.78px;top:431.66px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.78px;top:451.64px" class="cls_060"><span class="cls_060">@GetMapping("/current")</span></div>
<div style="position:absolute;left:102.78px;top:461.66px" class="cls_060"><span class="cls_060">public String orderForm() {</span></div>
<div style="position:absolute;left:112.38px;top:471.65px" class="cls_060"><span class="cls_060">return "orderForm";</span></div>
<div style="position:absolute;left:102.78px;top:481.64px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.78px;top:501.65px" class="cls_060"><span class="cls_060">@PostMapping</span></div>
<div style="position:absolute;left:102.77px;top:511.64px" class="cls_060"><span class="cls_060">public String processOrder(@Valid Order order, Errors errors,</span></div>
<div style="position:absolute;left:232.33px;top:521.66px" class="cls_060"><span class="cls_060">SessionStatus sessionStatus) {</span></div>
<div style="position:absolute;left:112.38px;top:531.65px" class="cls_060"><span class="cls_060">if (errors.hasErrors()) {</span></div>
<div style="position:absolute;left:121.95px;top:541.64px" class="cls_060"><span class="cls_060">return "orderForm";</span></div>
<div style="position:absolute;left:112.38px;top:551.66px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:112.38px;top:571.64px" class="cls_060"><span class="cls_060">orderRepo.save(order);</span></div>
<div style="position:absolute;left:112.38px;top:581.66px" class="cls_060"><span class="cls_060">sessionStatus.setComplete();</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:63540px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background097.jpg" width="531" height="666"></div>
<div style="position:absolute;left:203.04px;top:24.35px" class="cls_055"><span class="cls_055">Persisting data with Spring Data JPA</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">75</span></div>
<div style="position:absolute;left:121.38px;top:51.32px" class="cls_060"><span class="cls_060">return "redirect:/";</span></div>
<div style="position:absolute;left:111.78px;top:61.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:81.32px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">Aside from injecting </span><span class="cls_059">OrderRepository</span><span class="cls_039"> into the controller, the only significant changes</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">in </span><span class="cls_059">OrderController</span><span class="cls_039"> are in the </span><span class="cls_059">processOrder()</span><span class="cls_039"> method. Here, the </span><span class="cls_059">Order</span><span class="cls_039"> object sub-</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">mitted in the form (which also happens to be the same </span><span class="cls_059">Order</span><span class="cls_039"> object maintained in</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">session) is saved via the </span><span class="cls_059">save()</span><span class="cls_039"> method on the injected </span><span class="cls_059">OrderRepository</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.24px;top:154.67px" class="cls_039"><span class="cls_039">Once the order is saved, you don’t need it hanging around in a session anymore.</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">In fact, if you don’t clean it out, the order remains in session, including its associated</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">tacos, and the next order will start with whatever tacos the old order contained.</span></div>
<div style="position:absolute;left:102.18px;top:193.67px" class="cls_039"><span class="cls_039">Therefore, the </span><span class="cls_059">processOrder()</span><span class="cls_039"> method asks for a </span><span class="cls_059">SessionStatus</span><span class="cls_039"> parameter and</span></div>
<div style="position:absolute;left:102.18px;top:206.66px" class="cls_039"><span class="cls_039">calls its </span><span class="cls_059">setComplete()</span><span class="cls_039"> method to reset the session.</span></div>
<div style="position:absolute;left:117.17px;top:219.65px" class="cls_039"><span class="cls_039">All of the JDBC persistence code is in place. Now you can fire up the Taco Cloud</span></div>
<div style="position:absolute;left:102.18px;top:232.67px" class="cls_039"><span class="cls_039">application and try it out. Feel free to create as many tacos and as many orders as</span></div>
<div style="position:absolute;left:102.18px;top:245.66px" class="cls_039"><span class="cls_039">you’d like.</span></div>
<div style="position:absolute;left:118.38px;top:258.65px" class="cls_039"><span class="cls_039">You might also find it helpful to dig around in the database. Because you’re</span></div>
<div style="position:absolute;left:102.18px;top:271.67px" class="cls_039"><span class="cls_039">using H2 as your embedded database, and because you have Spring Boot DevTools in</span></div>
<div style="position:absolute;left:102.18px;top:284.66px" class="cls_039"><span class="cls_039">place, you should be able to point your browser to </span><a href="http://localhost:8080/h2-console">http://localhost:8080/h2-console</a> </div>
<div style="position:absolute;left:102.18px;top:297.68px" class="cls_039"><span class="cls_039">to see the H2 Console. The default credentials should get you in, although you’ll</span></div>
<div style="position:absolute;left:102.18px;top:310.67px" class="cls_039"><span class="cls_039">need to be sure that the JDBC URL field is set to </span><span class="cls_059">jdbc:h2:mem:testdb</span><span class="cls_039">. Once logged</span></div>
<div style="position:absolute;left:102.18px;top:323.66px" class="cls_039"><span class="cls_039">in, you should be able to issue any query you like against the tables in the Taco</span></div>
<div style="position:absolute;left:102.18px;top:336.68px" class="cls_039"><span class="cls_039">Cloud schema.</span></div>
<div style="position:absolute;left:117.90px;top:349.67px" class="cls_039"><span class="cls_039">Spring’s </span><span class="cls_059">JdbcTemplate</span><span class="cls_039">, along with </span><span class="cls_059">SimpleJdbcInsert</span><span class="cls_039">, makes working with rela-</span></div>
<div style="position:absolute;left:102.18px;top:362.66px" class="cls_039"><span class="cls_039">tional databases significantly simpler than plain vanilla JDBC. But you may find that</span></div>
<div style="position:absolute;left:102.18px;top:375.68px" class="cls_039"><span class="cls_039">JPA makes it even easier. Let’s rewind your work and see how to use Spring Data to</span></div>
<div style="position:absolute;left:102.18px;top:388.67px" class="cls_039"><span class="cls_039">make data persistence even easier.</span></div>
<div style="position:absolute;left:66.18px;top:413.83px" class="cls_040"><span class="cls_040">3.2</span></div>
<div style="position:absolute;left:102.18px;top:413.83px" class="cls_040"><span class="cls_040">Persisting data with Spring Data JPA</span></div>
<div style="position:absolute;left:102.18px;top:433.16px" class="cls_039"><span class="cls_039">The Spring Data project is a rather large umbrella project comprised of several sub-</span></div>
<div style="position:absolute;left:102.18px;top:446.18px" class="cls_039"><span class="cls_039">projects, most of which are focused on data persistence with a variety of different data-</span></div>
<div style="position:absolute;left:102.18px;top:459.17px" class="cls_039"><span class="cls_039">base types. A few of the most popular Spring Data projects include these:</span></div>
<div style="position:absolute;left:117.78px;top:478.16px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Spring Data JPA</span><span class="cls_039">—JPA persistence against a relational database</span></div>
<div style="position:absolute;left:117.78px;top:492.17px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Spring Data MongoDB</span><span class="cls_039">—Persistence to a Mongo document database</span></div>
<div style="position:absolute;left:117.78px;top:506.18px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Spring Data Neo4j</span><span class="cls_039">—Persistence to a Neo4j graph database</span></div>
<div style="position:absolute;left:117.78px;top:520.16px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Spring Data Redis</span><span class="cls_039">—Persistence to a Redis key-value store</span></div>
<div style="position:absolute;left:117.78px;top:534.17px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Spring Data Cassandra</span><span class="cls_039">—Persistence to a Cassandra database</span></div>
<div style="position:absolute;left:102.18px;top:554.18px" class="cls_039"><span class="cls_039">One of the most interesting and useful features provided by Spring Data for all of</span></div>
<div style="position:absolute;left:102.18px;top:567.17px" class="cls_039"><span class="cls_039">these projects is the ability to automatically create repositories, based on a repository</span></div>
<div style="position:absolute;left:102.18px;top:580.19px" class="cls_039"><span class="cls_039">specification interface.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:64216px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background098.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">76</span></div>
<div style="position:absolute;left:205.32px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 3</span></div>
<div style="position:absolute;left:249.45px;top:24.35px" class="cls_055"><span class="cls_055">Working with data</span></div>
<div style="position:absolute;left:107.46px;top:50.66px" class="cls_039"><span class="cls_039">To see how Spring Data works, you’re going to start over, replacing the JDBC-based</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">repositories from earlier in this chapter with repositories created by Spring Data JPA.</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">But first, you need to add Spring Data JPA to the project build.</span></div>
<div style="position:absolute;left:57.18px;top:102.47px" class="cls_063"><span class="cls_063">3.2.1</span></div>
<div style="position:absolute;left:93.18px;top:102.47px" class="cls_063"><span class="cls_063">Adding Spring Data JPA to the project</span></div>
<div style="position:absolute;left:93.18px;top:120.17px" class="cls_039"><span class="cls_039">Spring Data JPA is available to Spring Boot applications with the JPA starter. This</span></div>
<div style="position:absolute;left:93.18px;top:133.16px" class="cls_039"><span class="cls_039">starter dependency not only brings in Spring Data JPA, but also transitively includes</span></div>
<div style="position:absolute;left:93.18px;top:146.15px" class="cls_039"><span class="cls_039">Hibernate as the JPA implementation:</span></div>
<div style="position:absolute;left:93.18px;top:168.83px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:178.85px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:188.84px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:93.18px;top:198.83px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:93.18px;top:222.17px" class="cls_039"><span class="cls_039">If you want to use a different JPA implementation, then you’ll need to, at least,</span></div>
<div style="position:absolute;left:93.18px;top:235.16px" class="cls_039"><span class="cls_039">exclude the Hibernate dependency and include the JPA library of your choice. For</span></div>
<div style="position:absolute;left:93.18px;top:248.15px" class="cls_039"><span class="cls_039">example, to use EclipseLink instead of Hibernate, you’ll need to alter the build</span></div>
<div style="position:absolute;left:93.18px;top:261.17px" class="cls_039"><span class="cls_039">as follows:</span></div>
<div style="position:absolute;left:93.18px;top:283.85px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:293.84px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:303.83px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:313.85px" class="cls_060"><span class="cls_060">&lt;exclusions&gt;</span></div>
<div style="position:absolute;left:112.38px;top:323.84px" class="cls_060"><span class="cls_060">&lt;exclusion&gt;</span></div>
<div style="position:absolute;left:121.95px;top:333.83px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;hibernate-entitymanager&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:121.95px;top:343.85px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.hibernate&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:112.38px;top:353.84px" class="cls_060"><span class="cls_060">&lt;/exclusion&gt;</span></div>
<div style="position:absolute;left:102.78px;top:363.83px" class="cls_060"><span class="cls_060">&lt;/exclusions&gt;</span></div>
<div style="position:absolute;left:93.18px;top:373.85px" class="cls_060"><span class="cls_060">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:93.18px;top:383.84px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:393.86px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.eclipse.persistence&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:403.85px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;eclipselink&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:413.84px" class="cls_060"><span class="cls_060">&lt;version&gt;2.5.2&lt;/version&gt;</span></div>
<div style="position:absolute;left:93.18px;top:423.86px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:93.18px;top:447.17px" class="cls_039"><span class="cls_039">Note that there may be other changes required, depending on your choice of JPA</span></div>
<div style="position:absolute;left:93.18px;top:460.16px" class="cls_039"><span class="cls_039">implementation. Consult the documentation for your chosen JPA implementation for</span></div>
<div style="position:absolute;left:93.18px;top:473.18px" class="cls_039"><span class="cls_039">details. Now let’s revisit your domain objects and annotate them for JPA persistence.</span></div>
<div style="position:absolute;left:57.18px;top:499.01px" class="cls_063"><span class="cls_063">3.2.2</span></div>
<div style="position:absolute;left:93.18px;top:499.01px" class="cls_063"><span class="cls_063">Annotating the domain as entities</span></div>
<div style="position:absolute;left:93.18px;top:516.68px" class="cls_039"><span class="cls_039">As you’ll soon see, Spring Data does some amazing things when it comes to creat-</span></div>
<div style="position:absolute;left:93.18px;top:529.67px" class="cls_039"><span class="cls_039">ing repositories. But unfortunately, it doesn’t help much when it comes to annotat-</span></div>
<div style="position:absolute;left:93.18px;top:542.66px" class="cls_039"><span class="cls_039">ing your domain objects with JPA mapping annotations. You’ll need to open up</span></div>
<div style="position:absolute;left:93.18px;top:555.68px" class="cls_039"><span class="cls_039">the</span><span class="cls_059"> Ingredient</span><span class="cls_039">, </span><span class="cls_059">Taco</span><span class="cls_039">, and </span><span class="cls_059">Order</span><span class="cls_039"> classes and throw in a few annotations. First up is the</span></div>
<div style="position:absolute;left:93.18px;top:568.67px" class="cls_059"><span class="cls_059">Ingredient</span><span class="cls_039"> class.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:64892px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background099.jpg" width="531" height="666"></div>
<div style="position:absolute;left:203.04px;top:24.35px" class="cls_055"><span class="cls_055">Persisting data with Spring Data JPA</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">77</span></div>
<div style="position:absolute;left:114.18px;top:54.65px" class="cls_066"><span class="cls_066">Listing 3.16</span></div>
<div style="position:absolute;left:171.67px;top:54.26px" class="cls_066"><span class="cls_066">Annotating </span><span class="cls_077">Ingredient</span><span class="cls_066"> for JPA persistence</span></div>
<div style="position:absolute;left:102.18px;top:73.64px" class="cls_060"><span class="cls_060">package tacos;</span></div>
<div style="position:absolute;left:102.18px;top:93.62px" class="cls_060"><span class="cls_060">import javax.persistence.Entity;</span></div>
<div style="position:absolute;left:102.18px;top:103.64px" class="cls_060"><span class="cls_060">import javax.persistence.Id;</span></div>
<div style="position:absolute;left:102.18px;top:123.62px" class="cls_060"><span class="cls_060">import lombok.AccessLevel;</span></div>
<div style="position:absolute;left:102.18px;top:133.64px" class="cls_060"><span class="cls_060">import lombok.Data;</span></div>
<div style="position:absolute;left:102.18px;top:143.63px" class="cls_060"><span class="cls_060">import lombok.NoArgsConstructor;</span></div>
<div style="position:absolute;left:102.18px;top:153.65px" class="cls_060"><span class="cls_060">import lombok.RequiredArgsConstructor;</span></div>
<div style="position:absolute;left:102.18px;top:173.63px" class="cls_060"><span class="cls_060">@Data</span></div>
<div style="position:absolute;left:102.18px;top:183.65px" class="cls_060"><span class="cls_060">@RequiredArgsConstructor</span></div>
<div style="position:absolute;left:102.18px;top:193.64px" class="cls_060"><span class="cls_060">@NoArgsConstructor(access=AccessLevel.PRIVATE, force=true)</span></div>
<div style="position:absolute;left:102.18px;top:203.63px" class="cls_060"><span class="cls_060">@Entity</span></div>
<div style="position:absolute;left:102.18px;top:213.65px" class="cls_060"><span class="cls_060">public class Ingredient {</span></div>
<div style="position:absolute;left:111.78px;top:233.63px" class="cls_060"><span class="cls_060">@Id</span></div>
<div style="position:absolute;left:111.78px;top:243.65px" class="cls_060"><span class="cls_060">private final String id;</span></div>
<div style="position:absolute;left:111.78px;top:253.64px" class="cls_060"><span class="cls_060">private final String name;</span></div>
<div style="position:absolute;left:111.78px;top:263.63px" class="cls_060"><span class="cls_060">private final Type type;</span></div>
<div style="position:absolute;left:111.78px;top:283.64px" class="cls_060"><span class="cls_060">public static enum Type {</span></div>
<div style="position:absolute;left:121.38px;top:293.63px" class="cls_060"><span class="cls_060">WRAP, PROTEIN, VEGGIES, CHEESE, SAUCE</span></div>
<div style="position:absolute;left:111.78px;top:303.65px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:323.63px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:344.96px" class="cls_039"><span class="cls_039">In order to declare this as a JPA entity, </span><span class="cls_059">Ingredient</span><span class="cls_039"> must be annotated with </span><span class="cls_059">@Entity</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:102.18px;top:357.98px" class="cls_039"><span class="cls_039">And its </span><span class="cls_059">id</span><span class="cls_039"> property must be annotated with </span><span class="cls_059">@Id</span><span class="cls_039"> to designate it as the property that will</span></div>
<div style="position:absolute;left:102.18px;top:370.97px" class="cls_039"><span class="cls_039">uniquely identify the entity in the database.</span></div>
<div style="position:absolute;left:117.89px;top:383.96px" class="cls_039"><span class="cls_039">In addition to the JPA-specific annotations, you’ll also note that you’ve added a</span></div>
<div style="position:absolute;left:102.18px;top:396.98px" class="cls_059"><span class="cls_059">@NoArgsConstructor</span><span class="cls_039"> annotation at the class level. JPA requires that entities have a no-</span></div>
<div style="position:absolute;left:102.18px;top:409.97px" class="cls_039"><span class="cls_039">arguments constructor, so Lombok’s </span><span class="cls_059">@NoArgsConstructor</span><span class="cls_039"> does that for you. You</span></div>
<div style="position:absolute;left:102.18px;top:422.96px" class="cls_039"><span class="cls_039">don’t want to be able to use it, though, so you make it </span><span class="cls_059">private</span><span class="cls_039"> by setting the access</span></div>
<div style="position:absolute;left:102.18px;top:435.98px" class="cls_039"><span class="cls_039">attribute to </span><span class="cls_059">AccessLevel.PRIVATE</span><span class="cls_039">. And because there are </span><span class="cls_059">final</span><span class="cls_039"> properties that must</span></div>
<div style="position:absolute;left:102.18px;top:448.97px" class="cls_039"><span class="cls_039">be set, you also set the </span><span class="cls_059">force</span><span class="cls_039"> attribute to </span><span class="cls_059">true</span><span class="cls_039">, which results in the Lombok-generated</span></div>
<div style="position:absolute;left:102.18px;top:461.96px" class="cls_039"><span class="cls_039">constructor setting them to </span><span class="cls_059">null</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.24px;top:474.98px" class="cls_039"><span class="cls_039">You also add a </span><span class="cls_059">@RequiredArgsConstructor</span><span class="cls_039">. The </span><span class="cls_059">@Data</span><span class="cls_039"> implicitly adds a required</span></div>
<div style="position:absolute;left:102.18px;top:487.97px" class="cls_039"><span class="cls_039">arguments constructor, but when a </span><span class="cls_059">@NoArgsConstructor</span><span class="cls_039"> is used, that constructor gets</span></div>
<div style="position:absolute;left:102.18px;top:500.96px" class="cls_039"><span class="cls_039">removed. An explicit </span><span class="cls_059">@RequiredArgsConstructor</span><span class="cls_039"> ensures that you’ll still have a</span></div>
<div style="position:absolute;left:102.18px;top:513.98px" class="cls_039"><span class="cls_039">required arguments constructor in addition to the </span><span class="cls_059">private</span><span class="cls_039"> no-arguments constructor.</span></div>
<div style="position:absolute;left:116.76px;top:526.97px" class="cls_039"><span class="cls_039">Now let’s move on to the </span><span class="cls_059">Taco</span><span class="cls_039"> class and see how to annotate it as a JPA entity.</span></div>
<div style="position:absolute;left:114.18px;top:550.97px" class="cls_066"><span class="cls_066">Listing 3.17</span></div>
<div style="position:absolute;left:171.67px;top:550.58px" class="cls_066"><span class="cls_066">Annotating </span><span class="cls_077">Taco</span><span class="cls_066"> as an entity</span></div>
<div style="position:absolute;left:102.18px;top:570.95px" class="cls_060"><span class="cls_060">package tacos;</span></div>
<div style="position:absolute;left:102.18px;top:580.94px" class="cls_060"><span class="cls_060">import java.util.Date;</span></div>
<div style="position:absolute;left:102.18px;top:590.96px" class="cls_060"><span class="cls_060">import java.util.List;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:65568px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background100.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">78</span></div>
<div style="position:absolute;left:205.32px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 3</span></div>
<div style="position:absolute;left:249.45px;top:24.35px" class="cls_055"><span class="cls_055">Working with data</span></div>
<div style="position:absolute;left:93.18px;top:51.32px" class="cls_060"><span class="cls_060">import javax.persistence.Entity;</span></div>
<div style="position:absolute;left:93.18px;top:61.34px" class="cls_060"><span class="cls_060">import javax.persistence.GeneratedValue;</span></div>
<div style="position:absolute;left:93.18px;top:71.33px" class="cls_060"><span class="cls_060">import javax.persistence.GenerationType;</span></div>
<div style="position:absolute;left:93.18px;top:81.32px" class="cls_060"><span class="cls_060">import javax.persistence.Id;</span></div>
<div style="position:absolute;left:93.18px;top:91.34px" class="cls_060"><span class="cls_060">import javax.persistence.ManyToMany;</span></div>
<div style="position:absolute;left:93.18px;top:101.33px" class="cls_060"><span class="cls_060">import javax.persistence.OneToMany;</span></div>
<div style="position:absolute;left:93.18px;top:111.32px" class="cls_060"><span class="cls_060">import javax.persistence.PrePersist;</span></div>
<div style="position:absolute;left:93.18px;top:121.34px" class="cls_060"><span class="cls_060">import javax.validation.constraints.NotNull;</span></div>
<div style="position:absolute;left:93.18px;top:131.33px" class="cls_060"><span class="cls_060">import javax.validation.constraints.Size;</span></div>
<div style="position:absolute;left:93.18px;top:151.34px" class="cls_060"><span class="cls_060">import lombok.Data;</span></div>
<div style="position:absolute;left:93.18px;top:171.35px" class="cls_060"><span class="cls_060">@Data</span></div>
<div style="position:absolute;left:93.18px;top:181.34px" class="cls_060"><span class="cls_060">@Entity</span></div>
<div style="position:absolute;left:93.18px;top:191.33px" class="cls_060"><span class="cls_060">public class Taco {</span></div>
<div style="position:absolute;left:102.78px;top:213.35px" class="cls_060"><span class="cls_060">@Id</span></div>
<div style="position:absolute;left:102.78px;top:223.34px" class="cls_060"><span class="cls_060">@GeneratedValue(strategy=GenerationType.AUTO)</span></div>
<div style="position:absolute;left:102.78px;top:233.33px" class="cls_060"><span class="cls_060">private Long id;</span></div>
<div style="position:absolute;left:102.78px;top:255.35px" class="cls_060"><span class="cls_060">@NotNull</span></div>
<div style="position:absolute;left:102.78px;top:265.34px" class="cls_060"><span class="cls_060">@Size(min=5, message="Name must be at least 5 characters long")</span></div>
<div style="position:absolute;left:102.76px;top:275.33px" class="cls_060"><span class="cls_060">private String name;</span></div>
<div style="position:absolute;left:102.78px;top:295.34px" class="cls_060"><span class="cls_060">private Date createdAt;</span></div>
<div style="position:absolute;left:102.78px;top:315.35px" class="cls_060"><span class="cls_060">@ManyToMany(targetEntity=Ingredient.class)</span></div>
<div style="position:absolute;left:102.78px;top:325.34px" class="cls_060"><span class="cls_060">@Size(min=1, message="You must choose at least 1 ingredient")</span></div>
<div style="position:absolute;left:102.78px;top:335.33px" class="cls_060"><span class="cls_060">private List&lt;Ingredient&gt; ingredients;</span></div>
<div style="position:absolute;left:102.78px;top:357.35px" class="cls_060"><span class="cls_060">@PrePersist</span></div>
<div style="position:absolute;left:102.78px;top:367.34px" class="cls_060"><span class="cls_060">void createdAt() {</span></div>
<div style="position:absolute;left:112.38px;top:377.33px" class="cls_060"><span class="cls_060">this.createdAt = new Date();</span></div>
<div style="position:absolute;left:102.78px;top:387.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:397.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:420.68px" class="cls_039"><span class="cls_039">As with </span><span class="cls_059">Ingredient</span><span class="cls_039">, the </span><span class="cls_059">Taco</span><span class="cls_039"> class is now annotated with </span><span class="cls_059">@Entity</span><span class="cls_039"> and has its </span><span class="cls_059">id</span><span class="cls_039"> prop-</span></div>
<div style="position:absolute;left:93.18px;top:433.67px" class="cls_039"><span class="cls_039">erty annotated with </span><span class="cls_059">@Id</span><span class="cls_039">. Because you’re relying on the database to automatically</span></div>
<div style="position:absolute;left:93.18px;top:446.66px" class="cls_039"><span class="cls_039">generate the ID value, you also annotate the </span><span class="cls_059">id</span><span class="cls_039"> property with </span><span class="cls_059">@GeneratedValue</span><span class="cls_039">, spec-</span></div>
<div style="position:absolute;left:93.18px;top:459.68px" class="cls_039"><span class="cls_039">ifying a </span><span class="cls_059">strategy</span><span class="cls_039"> of </span><span class="cls_059">AUTO</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:107.95px;top:472.67px" class="cls_039"><span class="cls_039">To declare the relationship between a </span><span class="cls_059">Taco</span><span class="cls_039"> and its associated </span><span class="cls_059">Ingredient</span><span class="cls_039"> list, you</span></div>
<div style="position:absolute;left:93.18px;top:485.66px" class="cls_039"><span class="cls_039">annotate </span><span class="cls_059">ingredients</span><span class="cls_039"> with </span><span class="cls_059">@ManyToMany</span><span class="cls_039">. A </span><span class="cls_059">Taco</span><span class="cls_039"> can have many </span><span class="cls_059">Ingredient</span><span class="cls_039"> objects,</span></div>
<div style="position:absolute;left:93.18px;top:498.68px" class="cls_039"><span class="cls_039">and an </span><span class="cls_059">Ingredient</span><span class="cls_039"> can be a part of many </span><span class="cls_059">Taco</span><span class="cls_039">s.</span></div>
<div style="position:absolute;left:107.58px;top:511.67px" class="cls_039"><span class="cls_039">You’ll also notice that there’s a new method, </span><span class="cls_059">createdAt()</span><span class="cls_039">, which is annotated with</span></div>
<div style="position:absolute;left:93.18px;top:524.66px" class="cls_059"><span class="cls_059">@PrePersist</span><span class="cls_039">. You’ll use this to set the </span><span class="cls_059">createdAt</span><span class="cls_039"> property to the current date and</span></div>
<div style="position:absolute;left:93.18px;top:537.68px" class="cls_039"><span class="cls_039">time before </span><span class="cls_059">Taco</span><span class="cls_039"> is persisted. Finally, let’s annotate the </span><span class="cls_059">Order</span><span class="cls_039"> object as an entity. The</span></div>
<div style="position:absolute;left:93.18px;top:550.67px" class="cls_039"><span class="cls_039">next listing shows the new </span><span class="cls_059">Order</span><span class="cls_039"> class.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:66244px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background101.jpg" width="531" height="666"></div>
<div style="position:absolute;left:203.04px;top:24.35px" class="cls_055"><span class="cls_055">Persisting data with Spring Data JPA</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">79</span></div>
<div style="position:absolute;left:114.18px;top:54.65px" class="cls_066"><span class="cls_066">Listing 3.18</span></div>
<div style="position:absolute;left:171.67px;top:54.26px" class="cls_066"><span class="cls_066">Annotating </span><span class="cls_077">Order</span><span class="cls_066"> as a JPA entity</span></div>
<div style="position:absolute;left:102.18px;top:73.64px" class="cls_060"><span class="cls_060">package tacos;</span></div>
<div style="position:absolute;left:102.18px;top:83.63px" class="cls_060"><span class="cls_060">import java.io.Serializable;</span></div>
<div style="position:absolute;left:102.18px;top:93.62px" class="cls_060"><span class="cls_060">import java.util.ArrayList;</span></div>
<div style="position:absolute;left:102.18px;top:103.64px" class="cls_060"><span class="cls_060">import java.util.Date;</span></div>
<div style="position:absolute;left:102.18px;top:113.63px" class="cls_060"><span class="cls_060">import java.util.List;</span></div>
<div style="position:absolute;left:102.18px;top:133.64px" class="cls_060"><span class="cls_060">import javax.persistence.Entity;</span></div>
<div style="position:absolute;left:102.18px;top:143.63px" class="cls_060"><span class="cls_060">import javax.persistence.GeneratedValue;</span></div>
<div style="position:absolute;left:102.18px;top:153.65px" class="cls_060"><span class="cls_060">import javax.persistence.GenerationType;</span></div>
<div style="position:absolute;left:102.18px;top:163.64px" class="cls_060"><span class="cls_060">import javax.persistence.Id;</span></div>
<div style="position:absolute;left:102.18px;top:173.63px" class="cls_060"><span class="cls_060">import javax.persistence.ManyToMany;</span></div>
<div style="position:absolute;left:102.18px;top:183.65px" class="cls_060"><span class="cls_060">import javax.persistence.OneToMany;</span></div>
<div style="position:absolute;left:102.18px;top:193.64px" class="cls_060"><span class="cls_060">import javax.persistence.PrePersist;</span></div>
<div style="position:absolute;left:102.18px;top:203.63px" class="cls_060"><span class="cls_060">import javax.persistence.Table;</span></div>
<div style="position:absolute;left:102.18px;top:213.65px" class="cls_060"><span class="cls_060">import javax.validation.constraints.Digits;</span></div>
<div style="position:absolute;left:102.18px;top:223.64px" class="cls_060"><span class="cls_060">import javax.validation.constraints.Pattern;</span></div>
<div style="position:absolute;left:102.18px;top:233.63px" class="cls_060"><span class="cls_060">import org.hibernate.validator.constraints.CreditCardNumber;</span></div>
<div style="position:absolute;left:102.18px;top:243.65px" class="cls_060"><span class="cls_060">import org.hibernate.validator.constraints.NotBlank;</span></div>
<div style="position:absolute;left:102.18px;top:253.64px" class="cls_060"><span class="cls_060">import lombok.Data;</span></div>
<div style="position:absolute;left:102.18px;top:273.65px" class="cls_060"><span class="cls_060">@Data</span></div>
<div style="position:absolute;left:102.18px;top:283.64px" class="cls_060"><span class="cls_060">@Entity</span></div>
<div style="position:absolute;left:102.18px;top:293.63px" class="cls_060"><span class="cls_060">@Table(name="Taco_Order")</span></div>
<div style="position:absolute;left:102.18px;top:303.65px" class="cls_060"><span class="cls_060">public class Order implements Serializable {</span></div>
<div style="position:absolute;left:111.78px;top:323.63px" class="cls_060"><span class="cls_060">private static final long serialVersionUID = 1L;</span></div>
<div style="position:absolute;left:111.78px;top:343.64px" class="cls_060"><span class="cls_060">@Id</span></div>
<div style="position:absolute;left:111.78px;top:353.63px" class="cls_060"><span class="cls_060">@GeneratedValue(strategy=GenerationType.AUTO)</span></div>
<div style="position:absolute;left:111.78px;top:363.65px" class="cls_060"><span class="cls_060">private Long id;</span></div>
<div style="position:absolute;left:111.78px;top:383.63px" class="cls_060"><span class="cls_060">private Date placedAt;</span></div>
<div style="position:absolute;left:111.78px;top:423.65px" class="cls_060"><span class="cls_060">@ManyToMany(targetEntity=Taco.class)</span></div>
<div style="position:absolute;left:111.78px;top:433.64px" class="cls_060"><span class="cls_060">private List&lt;Taco&gt; tacos = new ArrayList&lt;&gt;();</span></div>
<div style="position:absolute;left:111.78px;top:453.65px" class="cls_060"><span class="cls_060">public void addDesign(Taco design) {</span></div>
<div style="position:absolute;left:121.38px;top:463.64px" class="cls_060"><span class="cls_060">this.tacos.add(design);</span></div>
<div style="position:absolute;left:111.78px;top:473.66px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:493.64px" class="cls_060"><span class="cls_060">@PrePersist</span></div>
<div style="position:absolute;left:111.76px;top:503.66px" class="cls_060"><span class="cls_060">void placedAt() {</span></div>
<div style="position:absolute;left:121.36px;top:513.65px" class="cls_060"><span class="cls_060">this.placedAt = new Date();</span></div>
<div style="position:absolute;left:111.78px;top:523.64px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:543.65px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:564.98px" class="cls_039"><span class="cls_039">As you can see, the changes to </span><span class="cls_059">Order</span><span class="cls_039"> closely mirror the changes to </span><span class="cls_059">Taco</span><span class="cls_039">. But there’s</span></div>
<div style="position:absolute;left:102.18px;top:577.97px" class="cls_039"><span class="cls_039">one new annotation at the class level: </span><span class="cls_059">@Table</span><span class="cls_039">. This specifies that </span><span class="cls_059">Order</span><span class="cls_039"> entities should</span></div>
<div style="position:absolute;left:102.18px;top:590.99px" class="cls_039"><span class="cls_039">be persisted to a table named </span><span class="cls_059">Taco_Order</span><span class="cls_039"> in the database.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:66920px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background102.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">80</span></div>
<div style="position:absolute;left:205.32px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 3</span></div>
<div style="position:absolute;left:249.45px;top:24.35px" class="cls_055"><span class="cls_055">Working with data</span></div>
<div style="position:absolute;left:107.88px;top:50.66px" class="cls_039"><span class="cls_039">Although you could have used this annotation on any of the entities, it’s necessary</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">with </span><span class="cls_059">Order</span><span class="cls_039">. Without it, JPA would default to persisting the entities to a table named</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_059"><span class="cls_059">Order</span><span class="cls_039">, but </span><span class="cls_036">order</span><span class="cls_039"> is a reserved word in SQL and would cause problems. Now that the</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">entities are properly annotated, it’s time to write your repositories.</span></div>
<div style="position:absolute;left:57.18px;top:111.47px" class="cls_063"><span class="cls_063">3.2.3</span></div>
<div style="position:absolute;left:93.18px;top:111.47px" class="cls_063"><span class="cls_063">Declaring JPA repositories</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">In the JDBC versions of the repositories, you explicitly declared the methods you</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">wanted the repository to provide. But with Spring Data, you can extend the </span><span class="cls_059">Crud-</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_059"><span class="cls_059">Repository</span><span class="cls_039"> interface instead. For example, here’s the new </span><span class="cls_059">IngredientRepository</span></div>
<div style="position:absolute;left:93.18px;top:167.66px" class="cls_039"><span class="cls_039">interface:</span></div>
<div style="position:absolute;left:93.18px;top:187.34px" class="cls_060"><span class="cls_060">package tacos.data;</span></div>
<div style="position:absolute;left:93.18px;top:207.35px" class="cls_060"><span class="cls_060">import org.springframework.data.repository.CrudRepository;</span></div>
<div style="position:absolute;left:93.18px;top:227.33px" class="cls_060"><span class="cls_060">import tacos.Ingredient;</span></div>
<div style="position:absolute;left:93.18px;top:247.34px" class="cls_060"><span class="cls_060">public interface IngredientRepository</span></div>
<div style="position:absolute;left:136.33px;top:257.33px" class="cls_060"><span class="cls_060">extends CrudRepository&lt;Ingredient, String&gt; {</span></div>
<div style="position:absolute;left:93.18px;top:277.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:298.67px" class="cls_059"><span class="cls_059">CrudRepository</span><span class="cls_039"> declares about a dozen methods for CRUD (create, read, update,</span></div>
<div style="position:absolute;left:93.18px;top:311.66px" class="cls_039"><span class="cls_039">delete) operations. Notice that it’s parameterized, with the first parameter being the</span></div>
<div style="position:absolute;left:93.18px;top:324.68px" class="cls_039"><span class="cls_039">entity type the repository is to persist, and the second parameter being the type of the</span></div>
<div style="position:absolute;left:93.18px;top:337.67px" class="cls_039"><span class="cls_039">entity ID property. For </span><span class="cls_059">IngredientRepository</span><span class="cls_039">, the parameters should be </span><span class="cls_059">Ingredient</span></div>
<div style="position:absolute;left:93.18px;top:350.66px" class="cls_039"><span class="cls_039">and </span><span class="cls_059">String</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:107.77px;top:363.68px" class="cls_039"><span class="cls_039">You can similarly define the </span><span class="cls_059">TacoRepository</span><span class="cls_039"> like this:</span></div>
<div style="position:absolute;left:93.18px;top:383.36px" class="cls_060"><span class="cls_060">package tacos.data;</span></div>
<div style="position:absolute;left:93.18px;top:403.34px" class="cls_060"><span class="cls_060">import org.springframework.data.repository.CrudRepository;</span></div>
<div style="position:absolute;left:93.18px;top:423.35px" class="cls_060"><span class="cls_060">import tacos.Taco;</span></div>
<div style="position:absolute;left:93.18px;top:443.36px" class="cls_060"><span class="cls_060">public interface TacoRepository</span></div>
<div style="position:absolute;left:136.34px;top:453.35px" class="cls_060"><span class="cls_060">extends CrudRepository&lt;Taco, Long&gt; {</span></div>
<div style="position:absolute;left:93.18px;top:473.36px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:494.66px" class="cls_039"><span class="cls_039">The only significant differences between </span><span class="cls_059">IngredientRepository</span><span class="cls_039"> and </span><span class="cls_059">TacoRepository</span></div>
<div style="position:absolute;left:93.18px;top:507.68px" class="cls_039"><span class="cls_039">are the parameters to </span><span class="cls_059">CrudRepository</span><span class="cls_039">. Here, they’re set to </span><span class="cls_059">Taco</span><span class="cls_039"> and </span><span class="cls_059">Long</span><span class="cls_039"> to specify</span></div>
<div style="position:absolute;left:93.18px;top:520.67px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">Taco</span><span class="cls_039"> entity (and its ID type) as the unit of persistence for this repository interface.</span></div>
<div style="position:absolute;left:93.18px;top:533.66px" class="cls_039"><span class="cls_039">Finally, the same changes can be applied to </span><span class="cls_059">OrderRepository</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:553.34px" class="cls_060"><span class="cls_060">package tacos.data;</span></div>
<div style="position:absolute;left:93.18px;top:573.35px" class="cls_060"><span class="cls_060">import org.springframework.data.repository.CrudRepository;</span></div>
<div style="position:absolute;left:93.18px;top:593.36px" class="cls_060"><span class="cls_060">import tacos.Order;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:67596px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background103.jpg" width="531" height="666"></div>
<div style="position:absolute;left:203.04px;top:24.35px" class="cls_055"><span class="cls_055">Persisting data with Spring Data JPA</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">81</span></div>
<div style="position:absolute;left:102.18px;top:51.32px" class="cls_060"><span class="cls_060">public interface OrderRepository</span></div>
<div style="position:absolute;left:145.36px;top:61.34px" class="cls_060"><span class="cls_060">extends CrudRepository&lt;Order, Long&gt; {</span></div>
<div style="position:absolute;left:102.18px;top:81.32px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:104.66px" class="cls_039"><span class="cls_039">And now you have your three repositories. You might be thinking that you need to</span></div>
<div style="position:absolute;left:102.18px;top:117.65px" class="cls_039"><span class="cls_039">write the implementations for all three, including the dozen methods for each imple-</span></div>
<div style="position:absolute;left:102.18px;top:130.67px" class="cls_039"><span class="cls_039">mentation. But that’s the good news about Spring Data JPA—there’s no need to write</span></div>
<div style="position:absolute;left:102.18px;top:143.66px" class="cls_039"><span class="cls_039">an implementation! When the application starts, Spring Data JPA automatically gener-</span></div>
<div style="position:absolute;left:102.18px;top:156.65px" class="cls_039"><span class="cls_039">ates an implementation on the fly. This means the repositories are ready to use from</span></div>
<div style="position:absolute;left:102.18px;top:169.67px" class="cls_039"><span class="cls_039">the get-go. Just inject them into the controllers like you did for the JDBC-based imple-</span></div>
<div style="position:absolute;left:102.18px;top:182.66px" class="cls_039"><span class="cls_039">mentations, and you’re done.</span></div>
<div style="position:absolute;left:116.50px;top:195.65px" class="cls_039"><span class="cls_039">The methods provided by </span><span class="cls_059">CrudRepository</span><span class="cls_039"> are great for general-purpose persistence</span></div>
<div style="position:absolute;left:102.18px;top:208.67px" class="cls_039"><span class="cls_039">of entities. But what if you have some requirements beyond basic persistence? Let’s see</span></div>
<div style="position:absolute;left:102.18px;top:221.66px" class="cls_039"><span class="cls_039">how to customize the repositories to perform queries unique to your domain.</span></div>
<div style="position:absolute;left:66.18px;top:246.50px" class="cls_063"><span class="cls_063">3.2.4</span></div>
<div style="position:absolute;left:102.18px;top:246.50px" class="cls_063"><span class="cls_063">Customizing JPA repositories</span></div>
<div style="position:absolute;left:102.18px;top:264.17px" class="cls_039"><span class="cls_039">Imagine that in addition to the basic CRUD operations provided by </span><span class="cls_059">CrudRepository</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:102.18px;top:277.16px" class="cls_039"><span class="cls_039">you also need to fetch all the orders delivered to a given ZIP code. As it turns out,</span></div>
<div style="position:absolute;left:102.18px;top:290.15px" class="cls_039"><span class="cls_039">this can easily be addressed by adding the following method declaration to </span><span class="cls_059">Order-</span></div>
<div style="position:absolute;left:102.18px;top:303.17px" class="cls_059"><span class="cls_059">Repository</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:102.18px;top:325.85px" class="cls_061"><span class="cls_061">List&lt;Order&gt; findByDeliveryZip(String deliveryZip);</span></div>
<div style="position:absolute;left:102.18px;top:349.16px" class="cls_039"><span class="cls_039">When generating the repository implementation, Spring Data examines any methods</span></div>
<div style="position:absolute;left:102.18px;top:362.18px" class="cls_039"><span class="cls_039">in the repository interface, parses the method name, and attempts to understand the</span></div>
<div style="position:absolute;left:102.18px;top:375.17px" class="cls_039"><span class="cls_039">method’s purpose in the context of the persisted object (an </span><span class="cls_059">Order</span><span class="cls_039">, in this case). In</span></div>
<div style="position:absolute;left:102.18px;top:388.16px" class="cls_039"><span class="cls_039">essence, Spring Data defines a sort of miniature domain-specific language (DSL)</span></div>
<div style="position:absolute;left:102.18px;top:401.18px" class="cls_039"><span class="cls_039">where persistence details are expressed in repository method signatures.</span></div>
<div style="position:absolute;left:117.95px;top:414.17px" class="cls_039"><span class="cls_039">Spring Data knows that this method is intended to find </span><span class="cls_059">Orders</span><span class="cls_039">, because you’ve</span></div>
<div style="position:absolute;left:102.18px;top:427.16px" class="cls_039"><span class="cls_039">parameterized </span><span class="cls_059">CrudRepository</span><span class="cls_039"> with </span><span class="cls_059">Order</span><span class="cls_039">. The method name, </span><span class="cls_059">findByDelivery-</span></div>
<div style="position:absolute;left:102.18px;top:440.18px" class="cls_059"><span class="cls_059">Zip()</span><span class="cls_039">, makes it clear that this method should find all </span><span class="cls_059">Order</span><span class="cls_039"> entities by matching their</span></div>
<div style="position:absolute;left:102.18px;top:453.17px" class="cls_059"><span class="cls_059">deliveryZip</span><span class="cls_039"> property with the value passed in as a parameter to the method.</span></div>
<div style="position:absolute;left:116.94px;top:466.16px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">findByDeliveryZip()</span><span class="cls_039"> method is simple enough, but Spring Data can handle</span></div>
<div style="position:absolute;left:102.18px;top:479.18px" class="cls_039"><span class="cls_039">even more-interesting method names as well. Repository methods are composed of a</span></div>
<div style="position:absolute;left:102.18px;top:492.17px" class="cls_039"><span class="cls_039">verb, an optional subject, the word </span><span class="cls_036">By</span><span class="cls_039">, and a predicate. In the case of </span><span class="cls_059">findByDelivery-</span></div>
<div style="position:absolute;left:102.27px;top:505.16px" class="cls_059"><span class="cls_059">Zip()</span><span class="cls_039">, the verb is </span><span class="cls_036">find</span><span class="cls_039"> and the predicate is </span><span class="cls_036">DeliveryZip</span><span class="cls_039">; the subject isn’t specified and is</span></div>
<div style="position:absolute;left:102.18px;top:518.18px" class="cls_039"><span class="cls_039">implied to be an </span><span class="cls_059">Order</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.45px;top:531.17px" class="cls_039"><span class="cls_039">Let’s consider another, more complex example. Suppose that you need to query</span></div>
<div style="position:absolute;left:102.18px;top:544.19px" class="cls_039"><span class="cls_039">for all orders delivered to a given ZIP code within a given date range. In that case, the</span></div>
<div style="position:absolute;left:102.18px;top:557.18px" class="cls_039"><span class="cls_039">following method, when added to </span><span class="cls_059">OrderRepository</span><span class="cls_039">, might prove useful:</span></div>
<div style="position:absolute;left:102.18px;top:576.86px" class="cls_060"><span class="cls_060">List&lt;Order&gt; readOrdersByDeliveryZipAndPlacedAtBetween(</span></div>
<div style="position:absolute;left:130.95px;top:586.85px" class="cls_061"><span class="cls_061">String deliveryZip, Date startDate, Date endDate);</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:68272px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background104.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">82</span></div>
<div style="position:absolute;left:205.32px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 3</span></div>
<div style="position:absolute;left:249.45px;top:24.35px" class="cls_055"><span class="cls_055">Working with data</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">Figure 3.2 illustrates how Spring Data parses and understands the </span><span class="cls_059">readOrdersBy-</span></div>
<div style="position:absolute;left:93.33px;top:63.65px" class="cls_059"><span class="cls_059">DeliveryZipAndPlacedAtBetween()</span><span class="cls_039"> method when generating the repository implemen-</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">tation. As you can see, the verb in </span><span class="cls_059">readOrdersByDeliveryZipAndPlacedAtBetween()</span><span class="cls_039"> is</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">read. Spring Data also understands find, read, and get as synonymous for fetching one</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">or more entities. Alternatively, you can also use count as the verb if you only want the</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">method to return an int with the count of matching entities.</span></div>
<div style="position:absolute;left:194.00px;top:139.34px" class="cls_081"><span class="cls_081">Signifies the start of</span></div>
<div style="position:absolute;left:194.08px;top:148.84px" class="cls_081"><span class="cls_081">properties to match</span></div>
<div style="position:absolute;left:102.17px;top:153.92px" class="cls_081"><span class="cls_081">This method will read</span></div>
<div style="position:absolute;left:288.04px;top:153.92px" class="cls_081"><span class="cls_081">The value must fall</span></div>
<div style="position:absolute;left:93.64px;top:163.42px" class="cls_081"><span class="cls_081">data (“get” and “find” are</span></div>
<div style="position:absolute;left:289.12px;top:163.42px" class="cls_081"><span class="cls_081">between the given</span></div>
<div style="position:absolute;left:107.04px;top:172.92px" class="cls_081"><span class="cls_081">also allowed here).</span></div>
<div style="position:absolute;left:309.37px;top:172.93px" class="cls_081"><span class="cls_081">values.</span></div>
<div style="position:absolute;left:252.52px;top:184.00px" class="cls_081"><span class="cls_081">...and...</span></div>
<div style="position:absolute;left:162.45px;top:205.12px" class="cls_082"><span class="cls_082">readOrdersByDeliveryZipAndPlacedAtBetween()</span></div>
<div style="position:absolute;left:169.55px;top:231.18px" class="cls_081"><span class="cls_081">Match .deliveryZip or</span></div>
<div style="position:absolute;left:270.75px;top:231.18px" class="cls_081"><span class="cls_081">Match .placedAt or</span></div>
<div style="position:absolute;left:169.43px;top:240.68px" class="cls_081"><span class="cls_081">.delivery.zip property</span></div>
<div style="position:absolute;left:270.15px;top:240.68px" class="cls_081"><span class="cls_081">.placed.at property</span></div>
<div style="position:absolute;left:93.18px;top:260.90px" class="cls_053"><span class="cls_053">Figure 3.2</span></div>
<div style="position:absolute;left:137.78px;top:260.90px" class="cls_053"><span class="cls_053">Spring Data parses repository method signatures to</span></div>
<div style="position:absolute;left:93.18px;top:270.92px" class="cls_053"><span class="cls_053">determine the query that should be performed.</span></div>
<div style="position:absolute;left:93.18px;top:305.33px" class="cls_039"><span class="cls_039">Although the subject of the method is optional, here it says </span><span class="cls_059">Orders</span><span class="cls_039">. Spring Data</span></div>
<div style="position:absolute;left:93.18px;top:318.35px" class="cls_039"><span class="cls_039">ignores most words in a subject, so you could name the method </span><span class="cls_059">readPuppiesBy...</span></div>
<div style="position:absolute;left:93.18px;top:331.34px" class="cls_039"><span class="cls_039">and it would still find </span><span class="cls_059">Order</span><span class="cls_039"> entities, as that is the type that </span><span class="cls_059">CrudRepository</span><span class="cls_039"> is param-</span></div>
<div style="position:absolute;left:93.18px;top:344.36px" class="cls_039"><span class="cls_039">eterized with.</span></div>
<div style="position:absolute;left:107.76px;top:357.35px" class="cls_039"><span class="cls_039">The predicate follows the word </span><span class="cls_059">By</span><span class="cls_039"> in the method name and is the most interesting</span></div>
<div style="position:absolute;left:93.18px;top:370.34px" class="cls_039"><span class="cls_039">part of the method signature. In this case, the predicate refers to two </span><span class="cls_059">Order</span><span class="cls_039"> proper-</span></div>
<div style="position:absolute;left:93.18px;top:383.36px" class="cls_039"><span class="cls_039">ties: </span><span class="cls_059">deliveryZip</span><span class="cls_039"> and </span><span class="cls_059">placedAt</span><span class="cls_039">. The </span><span class="cls_059">deliveryZip</span><span class="cls_039"> property must be equal to the</span></div>
<div style="position:absolute;left:93.18px;top:396.35px" class="cls_039"><span class="cls_039">value passed into the first parameter of the method. The keyword </span><span class="cls_059">Between</span><span class="cls_039"> indicates</span></div>
<div style="position:absolute;left:93.18px;top:409.34px" class="cls_039"><span class="cls_039">that the value of </span><span class="cls_059">deliveryZip</span><span class="cls_039"> must fall between the values passed into the last two</span></div>
<div style="position:absolute;left:93.18px;top:422.36px" class="cls_039"><span class="cls_039">parameters of the method.</span></div>
<div style="position:absolute;left:109.03px;top:435.35px" class="cls_039"><span class="cls_039">In addition to an implicit </span><span class="cls_059">Equals</span><span class="cls_039"> operation and the </span><span class="cls_059">Between</span><span class="cls_039"> operation, Spring</span></div>
<div style="position:absolute;left:93.18px;top:448.34px" class="cls_039"><span class="cls_039">Data method signatures can also include any of these operators:</span></div>
<div style="position:absolute;left:108.78px;top:465.35px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> IsAfter</span><span class="cls_039">, </span><span class="cls_059">After</span><span class="cls_039">, </span><span class="cls_059">IsGreaterThan</span><span class="cls_039">, </span><span class="cls_059">GreaterThan</span></div>
<div style="position:absolute;left:108.78px;top:479.36px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> IsGreaterThanEqual</span><span class="cls_039">, </span><span class="cls_059">GreaterThanEqual</span></div>
<div style="position:absolute;left:108.78px;top:493.34px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> IsBefore</span><span class="cls_039">, </span><span class="cls_059">Before</span><span class="cls_039">, </span><span class="cls_059">IsLessThan</span><span class="cls_039">, </span><span class="cls_059">LessThan</span></div>
<div style="position:absolute;left:108.78px;top:507.35px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> IsLessThanEqual</span><span class="cls_039">, </span><span class="cls_059">LessThanEqual</span></div>
<div style="position:absolute;left:108.78px;top:521.36px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> IsBetween</span><span class="cls_039">, </span><span class="cls_059">Between</span></div>
<div style="position:absolute;left:108.78px;top:535.34px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> IsNull</span><span class="cls_039">, </span><span class="cls_059">Null</span></div>
<div style="position:absolute;left:108.78px;top:549.35px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> IsNotNull</span><span class="cls_039">, </span><span class="cls_059">NotNull</span></div>
<div style="position:absolute;left:108.78px;top:563.36px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> IsIn</span><span class="cls_039">, </span><span class="cls_059">In</span></div>
<div style="position:absolute;left:108.78px;top:577.37px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> IsNotIn</span><span class="cls_039">, </span><span class="cls_059">NotIn</span></div>
<div style="position:absolute;left:108.78px;top:591.35px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> IsStartingWith</span><span class="cls_039">, </span><span class="cls_059">StartingWith</span><span class="cls_039">, </span><span class="cls_059">StartsWith</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:68948px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background105.jpg" width="531" height="666"></div>
<div style="position:absolute;left:253.20px;top:24.35px" class="cls_055"><span class="cls_055">Summary</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">83</span></div>
<div style="position:absolute;left:117.78px;top:50.66px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> IsEndingWith</span><span class="cls_039">, </span><span class="cls_059">EndingWith</span><span class="cls_039">, </span><span class="cls_059">EndsWith</span></div>
<div style="position:absolute;left:117.78px;top:64.67px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> IsContaining</span><span class="cls_039">, </span><span class="cls_059">Containing</span><span class="cls_039">, </span><span class="cls_059">Contains</span></div>
<div style="position:absolute;left:117.78px;top:78.65px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> IsLike</span><span class="cls_039">, </span><span class="cls_059">Like</span></div>
<div style="position:absolute;left:117.78px;top:92.66px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> IsNotLike</span><span class="cls_039">, </span><span class="cls_059">NotLike</span></div>
<div style="position:absolute;left:117.78px;top:106.67px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> IsTrue</span><span class="cls_039">, </span><span class="cls_059">True</span></div>
<div style="position:absolute;left:117.78px;top:120.65px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> IsFalse</span><span class="cls_039">, </span><span class="cls_059">False</span></div>
<div style="position:absolute;left:117.78px;top:134.66px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> Is</span><span class="cls_039">, </span><span class="cls_059">Equals</span></div>
<div style="position:absolute;left:117.78px;top:148.67px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> IsNot</span><span class="cls_039">, </span><span class="cls_059">Not</span></div>
<div style="position:absolute;left:117.78px;top:162.65px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> IgnoringCase</span><span class="cls_039">, </span><span class="cls_059">IgnoresCase</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">As alternatives for </span><span class="cls_059">IgnoringCase</span><span class="cls_039"> and </span><span class="cls_059">IgnoresCase</span><span class="cls_039">, you can place either </span><span class="cls_059">AllIgnoring-</span></div>
<div style="position:absolute;left:102.27px;top:193.67px" class="cls_059"><span class="cls_059">Case</span><span class="cls_039"> or </span><span class="cls_059">AllIgnoresCase</span><span class="cls_039"> on the method to ignore case for all </span><span class="cls_059">String</span><span class="cls_039"> comparisons.</span></div>
<div style="position:absolute;left:102.18px;top:206.66px" class="cls_039"><span class="cls_039">For example, consider the following method:</span></div>
<div style="position:absolute;left:102.18px;top:226.34px" class="cls_060"><span class="cls_060">List&lt;Order&gt; findByDeliveryToAndDeliveryCityAllIgnoresCase(</span></div>
<div style="position:absolute;left:140.56px;top:236.33px" class="cls_061"><span class="cls_061">String deliveryTo, String deliveryCity);</span></div>
<div style="position:absolute;left:102.18px;top:257.66px" class="cls_039"><span class="cls_039">Finally, you can also place </span><span class="cls_059">OrderBy</span><span class="cls_039"> at the end of the method name to sort the results</span></div>
<div style="position:absolute;left:102.18px;top:270.65px" class="cls_039"><span class="cls_039">by a specified column. For example, to order by the </span><span class="cls_059">deliveryTo</span><span class="cls_039"> property:</span></div>
<div style="position:absolute;left:102.18px;top:293.33px" class="cls_061"><span class="cls_061">List&lt;Order&gt; findByDeliveryCityOrderByDeliveryTo(String city);</span></div>
<div style="position:absolute;left:102.18px;top:313.67px" class="cls_039"><span class="cls_039">Although the naming convention can be useful for relatively simple queries, it doesn’t</span></div>
<div style="position:absolute;left:102.18px;top:326.66px" class="cls_039"><span class="cls_039">take much imagination to see that method names could get out of hand for more-</span></div>
<div style="position:absolute;left:102.18px;top:339.68px" class="cls_039"><span class="cls_039">complex queries. In that case, feel free to name the method anything you want and</span></div>
<div style="position:absolute;left:102.18px;top:352.67px" class="cls_039"><span class="cls_039">annotate it with </span><span class="cls_059">@Query</span><span class="cls_039"> to explicitly specify the query to be performed when the</span></div>
<div style="position:absolute;left:102.18px;top:365.66px" class="cls_039"><span class="cls_039">method is called, as this example shows:</span></div>
<div style="position:absolute;left:102.18px;top:385.34px" class="cls_060"><span class="cls_060">@Query("Order o where o.deliveryCity='Seattle'")</span></div>
<div style="position:absolute;left:102.18px;top:395.36px" class="cls_061"><span class="cls_061">List&lt;Order&gt; readOrdersDeliveredInSeattle();</span></div>
<div style="position:absolute;left:102.18px;top:416.66px" class="cls_039"><span class="cls_039">In this simple usage of </span><span class="cls_059">@Query</span><span class="cls_039">, you ask for all orders delivered in Seattle. But you can</span></div>
<div style="position:absolute;left:102.18px;top:429.68px" class="cls_039"><span class="cls_039">use </span><span class="cls_059">@Query</span><span class="cls_039"> to perform virtually any query you can dream up, even when it’s difficult</span></div>
<div style="position:absolute;left:102.18px;top:442.67px" class="cls_039"><span class="cls_039">or impossible to achieve the query by following the naming convention.</span></div>
<div style="position:absolute;left:102.18px;top:463.84px" class="cls_040"><span class="cls_040">Summary</span></div>
<div style="position:absolute;left:117.78px;top:482.18px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Spring’s </span><span class="cls_059">JdbcTemplate</span><span class="cls_039"> greatly simplifies working with JDBC.</span></div>
<div style="position:absolute;left:117.78px;top:496.16px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> PreparedStatementCreator</span><span class="cls_039"> and </span><span class="cls_059">KeyHolder</span><span class="cls_039"> can be used together when you</span></div>
<div style="position:absolute;left:129.78px;top:509.18px" class="cls_039"><span class="cls_039">need to know the value of a database-generated ID.</span></div>
<div style="position:absolute;left:117.78px;top:523.16px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  For easy execution of data inserts, use </span><span class="cls_059">SimpleJdbcInsert</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.78px;top:537.17px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Spring Data JPA makes JPA persistence as easy as writing a repository interface.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:69624px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background106.jpg" width="531" height="666"></div>
<div style="position:absolute;left:276.18px;top:111.83px" class="cls_014"><span class="cls_014">Securing Spring</span></div>
<div style="position:absolute;left:84.18px;top:264.85px" class="cls_049"><span class="cls_049">This chapter covers</span></div>
<div style="position:absolute;left:84.18px;top:283.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Autoconfiguring Spring Security</span></div>
<div style="position:absolute;left:84.18px;top:298.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Defining custom user storage</span></div>
<div style="position:absolute;left:84.18px;top:313.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Customizing the login page</span></div>
<div style="position:absolute;left:84.18px;top:328.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Securing against CSRF attacks</span></div>
<div style="position:absolute;left:84.18px;top:343.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Knowing your user</span></div>
<div style="position:absolute;left:102.18px;top:413.54px" class="cls_039"><span class="cls_039">Have you ever noticed that most people in television sitcoms don’t lock their</span></div>
<div style="position:absolute;left:102.18px;top:426.53px" class="cls_039"><span class="cls_039">doors? In the days of </span><span class="cls_036">Leave it to Beaver</span><span class="cls_039">, it wasn’t so unusual for people to leave their</span></div>
<div style="position:absolute;left:102.18px;top:439.55px" class="cls_039"><span class="cls_039">doors unlocked. But it seems crazy that in a day when we’re concerned with privacy</span></div>
<div style="position:absolute;left:102.18px;top:452.54px" class="cls_039"><span class="cls_039">and security, we see television characters enabling unhindered access to their apart-</span></div>
<div style="position:absolute;left:102.18px;top:465.53px" class="cls_039"><span class="cls_039">ments and homes.</span></div>
<div style="position:absolute;left:116.62px;top:478.55px" class="cls_039"><span class="cls_039">Information is probably the most valuable item we now have; crooks are looking</span></div>
<div style="position:absolute;left:102.18px;top:491.54px" class="cls_039"><span class="cls_039">for ways to steal our data and identities by sneaking into unsecured applications. As</span></div>
<div style="position:absolute;left:102.18px;top:504.56px" class="cls_039"><span class="cls_039">software developers, we must take steps to protect the information that resides in</span></div>
<div style="position:absolute;left:102.18px;top:517.55px" class="cls_039"><span class="cls_039">our applications. Whether it’s an email account protected with a username-password</span></div>
<div style="position:absolute;left:102.18px;top:530.54px" class="cls_039"><span class="cls_039">pair or a brokerage account protected with a trading PIN, security is a crucial aspect</span></div>
<div style="position:absolute;left:102.18px;top:543.56px" class="cls_039"><span class="cls_039">of most applications.</span></div>
<div style="position:absolute;left:259.50px;top:596.99px" class="cls_024"><span class="cls_024">84</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:70300px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background107.jpg" width="531" height="666"></div>
<div style="position:absolute;left:225.78px;top:24.35px" class="cls_055"><span class="cls_055">Enabling Spring Security</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">85</span></div>
<div style="position:absolute;left:66.18px;top:49.81px" class="cls_040"><span class="cls_040">4.1</span></div>
<div style="position:absolute;left:102.18px;top:49.81px" class="cls_040"><span class="cls_040">Enabling Spring Security</span></div>
<div style="position:absolute;left:102.18px;top:67.67px" class="cls_039"><span class="cls_039">The very first step in securing your Spring application is to add the Spring Boot secu-</span></div>
<div style="position:absolute;left:102.18px;top:80.66px" class="cls_039"><span class="cls_039">rity starter dependency to your build. In the project’s pom.xml file, add the following</span></div>
<div style="position:absolute;left:102.18px;top:93.65px" class="cls_059"><span class="cls_059">&lt;dependency&gt;</span><span class="cls_039"> entry:</span></div>
<div style="position:absolute;left:102.18px;top:113.33px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:121.38px;top:123.32px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:121.38px;top:133.34px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:102.18px;top:143.33px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:102.18px;top:164.66px" class="cls_039"><span class="cls_039">If you’re using Spring Tool Suite, this is even easier. Right-click on the pom.xml file and</span></div>
<div style="position:absolute;left:102.18px;top:177.65px" class="cls_039"><span class="cls_039">select Edit Starters from the Spring context menu. The Starter Dependencies dialog box</span></div>
<div style="position:absolute;left:102.18px;top:190.67px" class="cls_039"><span class="cls_039">will appear. Check the Security entry under the Core category, as shown in figure 4.1.</span></div>
<div style="position:absolute;left:102.18px;top:595.55px" class="cls_053"><span class="cls_053">Figure 4.1</span></div>
<div style="position:absolute;left:146.79px;top:595.55px" class="cls_053"><span class="cls_053">Adding the security starter with Spring Tool Suite</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:70976px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background108.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">86</span></div>
<div style="position:absolute;left:210.90px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 4</span></div>
<div style="position:absolute;left:255.03px;top:24.35px" class="cls_055"><span class="cls_055">Securing Spring</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">Believe it or not, that dependency is the only thing that’s required to secure an appli-</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">cation. When the application starts, autoconfiguration will detect that Spring Security</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">is in the classpath and will set up some basic security configuration.</span></div>
<div style="position:absolute;left:108.32px;top:89.66px" class="cls_039"><span class="cls_039">If you want to try it out, fire up the application and try to visit the homepage (or</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">any page for that matter). You’ll be prompted for authentication with an HTTP basic</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">authentication dialog box. To get past it, you’ll need to provide a username and pass-</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">word. The username is </span><span class="cls_036">user</span><span class="cls_039">. As for the password, it’s randomly generated and written</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">to the application log file. The log entry will look something like this:</span></div>
<div style="position:absolute;left:93.18px;top:164.33px" class="cls_061"><span class="cls_061">Using default security password: 087cfc6a-027d-44bc-95d7-cbb3a798a1ea</span></div>
<div style="position:absolute;left:93.18px;top:184.67px" class="cls_039"><span class="cls_039">Assuming you enter the username and password correctly, you’ll be granted access to</span></div>
<div style="position:absolute;left:93.18px;top:197.66px" class="cls_039"><span class="cls_039">the application.</span></div>
<div style="position:absolute;left:107.68px;top:210.65px" class="cls_039"><span class="cls_039">It seems that securing Spring applications is pretty easy work. With the Taco Cloud</span></div>
<div style="position:absolute;left:93.18px;top:223.67px" class="cls_039"><span class="cls_039">application secured, I suppose I could end this chapter now and move on to the next</span></div>
<div style="position:absolute;left:93.18px;top:236.66px" class="cls_039"><span class="cls_039">topic. But before we get ahead of ourselves, let’s consider what kind of security auto-</span></div>
<div style="position:absolute;left:93.18px;top:249.65px" class="cls_039"><span class="cls_039">configuration has provided.</span></div>
<div style="position:absolute;left:108.45px;top:262.67px" class="cls_039"><span class="cls_039">By doing nothing more than adding the security starter to the project build, you</span></div>
<div style="position:absolute;left:93.18px;top:275.66px" class="cls_039"><span class="cls_039">get the following security features:</span></div>
<div style="position:absolute;left:108.78px;top:292.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  All HTTP request paths require authentication.</span></div>
<div style="position:absolute;left:108.78px;top:306.68px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  No specific roles or authorities are required.</span></div>
<div style="position:absolute;left:108.78px;top:320.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  There’s no login page.</span></div>
<div style="position:absolute;left:108.78px;top:334.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Authentication is prompted with HTTP basic authentication.</span></div>
<div style="position:absolute;left:108.78px;top:348.68px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  There’s only one user; the username is </span><span class="cls_036">user</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:93.18px;top:366.68px" class="cls_039"><span class="cls_039">This is a good start, but I think that the security needs of most applications (Taco</span></div>
<div style="position:absolute;left:93.18px;top:379.67px" class="cls_039"><span class="cls_039">Cloud included) will be quite different from these rudimentary security features.</span></div>
<div style="position:absolute;left:107.65px;top:392.66px" class="cls_039"><span class="cls_039">You have more work to do if you’re going to properly secure the Taco Cloud appli-</span></div>
<div style="position:absolute;left:93.18px;top:405.68px" class="cls_039"><span class="cls_039">cation. You’ll need to </span><span class="cls_036">at least</span><span class="cls_039"> configure Spring Security to do the following:</span></div>
<div style="position:absolute;left:108.78px;top:422.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Prompt for authentication with a login page, instead of an HTTP basic dialog box.</span></div>
<div style="position:absolute;left:108.78px;top:436.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Provide for multiple users, and enable a registration page so new Taco Cloud</span></div>
<div style="position:absolute;left:120.78px;top:449.66px" class="cls_039"><span class="cls_039">customers can sign up.</span></div>
<div style="position:absolute;left:108.78px;top:463.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Apply different security rules for different request paths. The homepage and</span></div>
<div style="position:absolute;left:120.78px;top:476.66px" class="cls_039"><span class="cls_039">registration pages, for example, shouldn’t require authentication at all.</span></div>
<div style="position:absolute;left:93.18px;top:494.66px" class="cls_039"><span class="cls_039">To meet your security needs for Taco Cloud, you’ll have to write some explicit config-</span></div>
<div style="position:absolute;left:93.18px;top:507.68px" class="cls_039"><span class="cls_039">uration, overriding what autoconfiguration has given you. You’ll start by configuring a</span></div>
<div style="position:absolute;left:93.18px;top:520.67px" class="cls_039"><span class="cls_039">proper user store so that you can have more than one user.</span></div>
<div style="position:absolute;left:57.18px;top:541.84px" class="cls_040"><span class="cls_040">4.2</span></div>
<div style="position:absolute;left:93.18px;top:541.84px" class="cls_040"><span class="cls_040">Configuring Spring Security</span></div>
<div style="position:absolute;left:93.18px;top:559.67px" class="cls_039"><span class="cls_039">Over the years there have been several ways of configuring Spring Security, including</span></div>
<div style="position:absolute;left:93.18px;top:572.69px" class="cls_039"><span class="cls_039">lengthy XML-based configuration. Fortunately, several recent versions of Spring Secu-</span></div>
<div style="position:absolute;left:93.18px;top:585.68px" class="cls_039"><span class="cls_039">rity have supported Java-based configuration, which is much easier to read and write.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:71652px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background109.jpg" width="531" height="666"></div>
<div style="position:absolute;left:220.74px;top:24.35px" class="cls_055"><span class="cls_055">Configuring Spring Security</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">87</span></div>
<div style="position:absolute;left:116.82px;top:50.66px" class="cls_039"><span class="cls_039">Before this chapter is finished, you’ll have configured all of your Taco Cloud secu-</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">rity needs in Java-based Spring Security configuration. But to get started, you’ll ease</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">into it by writing the barebones configuration class shown in the following listing.</span></div>
<div style="position:absolute;left:114.18px;top:100.37px" class="cls_066"><span class="cls_066">Listing 4.1</span></div>
<div style="position:absolute;left:166.26px;top:100.37px" class="cls_066"><span class="cls_066">A barebones configuration class for Spring Security</span></div>
<div style="position:absolute;left:102.18px;top:120.23px" class="cls_060"><span class="cls_060">package tacos.security;</span></div>
<div style="position:absolute;left:102.18px;top:140.24px" class="cls_060"><span class="cls_060">import org.springframework.context.annotation.Bean;</span></div>
<div style="position:absolute;left:102.18px;top:150.23px" class="cls_060"><span class="cls_060">import org.springframework.context.annotation.Configuration;</span></div>
<div style="position:absolute;left:102.18px;top:160.25px" class="cls_060"><span class="cls_060">import org.springframework.security.config.annotation.web</span></div>
<div style="position:absolute;left:217.32px;top:170.24px" class="cls_060"><span class="cls_060">.configuration.EnableWebSecurity;</span></div>
<div style="position:absolute;left:102.18px;top:180.23px" class="cls_060"><span class="cls_060">import org.springframework.security.config.annotation.web</span></div>
<div style="position:absolute;left:198.13px;top:190.25px" class="cls_060"><span class="cls_060">.configuration.WebSecurityConfigurerAdapter;</span></div>
<div style="position:absolute;left:102.18px;top:210.23px" class="cls_060"><span class="cls_060">@Configuration</span></div>
<div style="position:absolute;left:102.18px;top:220.25px" class="cls_060"><span class="cls_060">@EnableWebSecurity</span></div>
<div style="position:absolute;left:102.18px;top:230.24px" class="cls_060"><span class="cls_060">public class SecurityConfig extends WebSecurityConfigurerAdapter {</span></div>
<div style="position:absolute;left:102.18px;top:250.25px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:271.55px" class="cls_039"><span class="cls_039">What does this barebones security configuration do for you? Well, not much, but it</span></div>
<div style="position:absolute;left:102.18px;top:284.57px" class="cls_039"><span class="cls_039">does move you a step closer to the security functionality you need. If you attempt to</span></div>
<div style="position:absolute;left:102.18px;top:297.56px" class="cls_039"><span class="cls_039">hit the Taco Cloud homepage again, you’ll still be prompted to sign in. But instead of</span></div>
<div style="position:absolute;left:102.18px;top:310.58px" class="cls_039"><span class="cls_039">being prompted with an HTTP basic authentication dialog box, you’ll be shown a</span></div>
<div style="position:absolute;left:102.18px;top:323.57px" class="cls_039"><span class="cls_039">login form like the one in figure 4.2.</span></div>
<div style="position:absolute;left:102.18px;top:594.44px" class="cls_053"><span class="cls_053">Figure 4.2</span></div>
<div style="position:absolute;left:146.78px;top:594.44px" class="cls_053"><span class="cls_053">Spring Security gives you a plain login page for free.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:72328px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background110.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">88</span></div>
<div style="position:absolute;left:210.90px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 4</span></div>
<div style="position:absolute;left:255.03px;top:24.35px" class="cls_055"><span class="cls_055">Securing Spring</span></div>
<div style="position:absolute;left:105.18px;top:50.66px" class="cls_083"><span class="cls_083">TIP</span><span class="cls_039">  Going incognito: You may find it useful to set your browser to private or</span></div>
<div style="position:absolute;left:105.18px;top:62.66px" class="cls_039"><span class="cls_039">incognito mode when manually testing security. This will ensure that you</span></div>
<div style="position:absolute;left:105.18px;top:74.66px" class="cls_039"><span class="cls_039">have a fresh session each time you open a private/incognito window. You’ll</span></div>
<div style="position:absolute;left:105.18px;top:86.66px" class="cls_039"><span class="cls_039">have to sign in to the application each time, but you can be assured that any</span></div>
<div style="position:absolute;left:105.18px;top:98.66px" class="cls_039"><span class="cls_039">changes you’ve made in security are applied, and that there aren’t any rem-</span></div>
<div style="position:absolute;left:105.18px;top:110.66px" class="cls_039"><span class="cls_039">nants of an older session preventing you from seeing your changes.</span></div>
<div style="position:absolute;left:93.18px;top:130.67px" class="cls_039"><span class="cls_039">This is a small improvement—prompting for login with a web page (even if it is rather</span></div>
<div style="position:absolute;left:93.18px;top:143.66px" class="cls_039"><span class="cls_039">plain in appearance) is always more user-friendly than an HTTP basic dialog box.</span></div>
<div style="position:absolute;left:93.18px;top:156.65px" class="cls_039"><span class="cls_039">You’ll customize the login page in section 4.3.2. The current task at hand, however, is</span></div>
<div style="position:absolute;left:93.18px;top:169.67px" class="cls_039"><span class="cls_039">to configure a user store that can handle more than one user.</span></div>
<div style="position:absolute;left:108.22px;top:182.66px" class="cls_039"><span class="cls_039">As it turns out, Spring Security offers several options for configuring a user store,</span></div>
<div style="position:absolute;left:93.18px;top:195.65px" class="cls_039"><span class="cls_039">including these:</span></div>
<div style="position:absolute;left:108.78px;top:212.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  An in-memory user store</span></div>
<div style="position:absolute;left:108.78px;top:226.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  A JDBC-based user store</span></div>
<div style="position:absolute;left:108.78px;top:240.65px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  An LDAP-backed user store</span></div>
<div style="position:absolute;left:108.78px;top:254.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  A custom user details service</span></div>
<div style="position:absolute;left:93.18px;top:272.66px" class="cls_039"><span class="cls_039">No matter which user store you choose, you can configure it by overriding a </span><span class="cls_059">configure()</span></div>
<div style="position:absolute;left:93.18px;top:285.65px" class="cls_039"><span class="cls_039">method defined in the </span><span class="cls_059">WebSecurityConfigurerAdapter</span><span class="cls_039"> configuration base class. To</span></div>
<div style="position:absolute;left:93.18px;top:298.67px" class="cls_039"><span class="cls_039">get started, you’ll add the following method override to the </span><span class="cls_059">SecurityConfig</span><span class="cls_039"> class:</span></div>
<div style="position:absolute;left:93.18px;top:318.35px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:93.18px;top:328.34px" class="cls_060"><span class="cls_060">protected void configure(AuthenticationManagerBuilder auth)</span></div>
<div style="position:absolute;left:112.38px;top:338.33px" class="cls_060"><span class="cls_060">throws Exception {</span></div>
<div style="position:absolute;left:93.18px;top:378.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:399.68px" class="cls_039"><span class="cls_039">Now you just need to replace those ellipses with code that uses the given </span><span class="cls_059">Authentica-</span></div>
<div style="position:absolute;left:93.18px;top:412.67px" class="cls_059"><span class="cls_059">tionManagerBuilder</span><span class="cls_039"> to specify how users will be looked up during authentication.</span></div>
<div style="position:absolute;left:93.18px;top:425.66px" class="cls_039"><span class="cls_039">First up, you’ll try the in-memory user store.</span></div>
<div style="position:absolute;left:57.18px;top:450.50px" class="cls_063"><span class="cls_063">4.2.1</span></div>
<div style="position:absolute;left:93.18px;top:450.50px" class="cls_063"><span class="cls_063">In-memory user store</span></div>
<div style="position:absolute;left:93.18px;top:468.17px" class="cls_039"><span class="cls_039">One place where user information can be kept is in memory. Suppose you have only a</span></div>
<div style="position:absolute;left:93.18px;top:481.16px" class="cls_039"><span class="cls_039">handful of users, none of which are likely to change. In that case, it may be simple</span></div>
<div style="position:absolute;left:93.18px;top:494.18px" class="cls_039"><span class="cls_039">enough to define those users as part of the security configuration.</span></div>
<div style="position:absolute;left:110.10px;top:507.17px" class="cls_039"><span class="cls_039">For example, the next listing shows how to configure two users, </span><span class="cls_059">"buzz"</span><span class="cls_039"> and</span></div>
<div style="position:absolute;left:93.18px;top:520.16px" class="cls_059"><span class="cls_059">"woody"</span><span class="cls_039">, in an in-memory user store.</span></div>
<div style="position:absolute;left:105.18px;top:543.89px" class="cls_066"><span class="cls_066">Listing 4.2</span></div>
<div style="position:absolute;left:157.27px;top:543.89px" class="cls_066"><span class="cls_066">Defining users in an in-memory user store</span></div>
<div style="position:absolute;left:93.18px;top:563.75px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:93.18px;top:573.74px" class="cls_060"><span class="cls_060">protected void configure(AuthenticationManagerBuilder auth)</span></div>
<div style="position:absolute;left:112.38px;top:583.76px" class="cls_060"><span class="cls_060">throws Exception {</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:73004px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background111.jpg" width="531" height="666"></div>
<div style="position:absolute;left:220.74px;top:24.35px" class="cls_055"><span class="cls_055">Configuring Spring Security</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">89</span></div>
<div style="position:absolute;left:111.78px;top:51.32px" class="cls_060"><span class="cls_060">auth</span></div>
<div style="position:absolute;left:121.38px;top:61.34px" class="cls_060"><span class="cls_060">.inMemoryAuthentication()</span></div>
<div style="position:absolute;left:130.95px;top:71.33px" class="cls_060"><span class="cls_060">.withUser("buzz")</span></div>
<div style="position:absolute;left:140.55px;top:81.32px" class="cls_060"><span class="cls_060">.password("infinity")</span></div>
<div style="position:absolute;left:140.55px;top:91.34px" class="cls_060"><span class="cls_060">.authorities("ROLE_USER")</span></div>
<div style="position:absolute;left:130.95px;top:101.33px" class="cls_060"><span class="cls_060">.and()</span></div>
<div style="position:absolute;left:130.95px;top:111.32px" class="cls_060"><span class="cls_060">.withUser("woody")</span></div>
<div style="position:absolute;left:140.55px;top:121.34px" class="cls_060"><span class="cls_060">.password("bullseye")</span></div>
<div style="position:absolute;left:140.55px;top:131.33px" class="cls_060"><span class="cls_060">.authorities("ROLE_USER");</span></div>
<div style="position:absolute;left:102.18px;top:151.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:172.67px" class="cls_039"><span class="cls_039">As you can see, </span><span class="cls_059">AuthenticationManagerBuilder</span><span class="cls_039"> employs a builder-style API to con-</span></div>
<div style="position:absolute;left:102.18px;top:185.66px" class="cls_039"><span class="cls_039">figure authentication details. In this case, a call to the </span><span class="cls_059">inMemoryAuthentication()</span></div>
<div style="position:absolute;left:102.18px;top:198.65px" class="cls_039"><span class="cls_039">method gives you an opportunity to specify user information directly in the security</span></div>
<div style="position:absolute;left:102.18px;top:211.67px" class="cls_039"><span class="cls_039">configuration itself.</span></div>
<div style="position:absolute;left:118.21px;top:224.66px" class="cls_039"><span class="cls_039">Each call to </span><span class="cls_059">withUser()</span><span class="cls_039"> starts the configuration for a user. The value given to</span></div>
<div style="position:absolute;left:102.18px;top:237.65px" class="cls_059"><span class="cls_059">withUser()</span><span class="cls_039"> is the username, whereas the password and granted authorities are speci-</span></div>
<div style="position:absolute;left:102.18px;top:250.67px" class="cls_039"><span class="cls_039">fied with the </span><span class="cls_059">password()</span><span class="cls_039"> and </span><span class="cls_059">authorities()</span><span class="cls_039"> methods. As shown in listing 4.2, both</span></div>
<div style="position:absolute;left:102.18px;top:263.66px" class="cls_039"><span class="cls_039">users are granted </span><span class="cls_059">ROLE_USER</span><span class="cls_039"> authority. User buzz is configured to have </span><span class="cls_036">infinity</span><span class="cls_039"> as their</span></div>
<div style="position:absolute;left:102.18px;top:276.65px" class="cls_039"><span class="cls_039">password. Likewise, woody’s password is </span><span class="cls_036">bullseye</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:118.14px;top:289.67px" class="cls_039"><span class="cls_039">The in-memory user store is convenient for testing purposes or for very simple</span></div>
<div style="position:absolute;left:102.18px;top:302.66px" class="cls_039"><span class="cls_039">applications, but it doesn’t allow for easy editing of users. If you need to add, remove,</span></div>
<div style="position:absolute;left:102.18px;top:315.68px" class="cls_039"><span class="cls_039">or change a user, you’ll have to make the necessary changes and then rebuild and</span></div>
<div style="position:absolute;left:102.18px;top:328.67px" class="cls_039"><span class="cls_039">redeploy the application.</span></div>
<div style="position:absolute;left:116.80px;top:341.66px" class="cls_039"><span class="cls_039">For the Taco Cloud application, you want customers to be able to register with the</span></div>
<div style="position:absolute;left:102.18px;top:354.68px" class="cls_039"><span class="cls_039">application and manage their own user accounts. That doesn’t fit with the limitations</span></div>
<div style="position:absolute;left:102.18px;top:367.67px" class="cls_039"><span class="cls_039">of the in-memory user store, so let’s take a look at another option that allows for a</span></div>
<div style="position:absolute;left:102.18px;top:380.66px" class="cls_039"><span class="cls_039">database-backed user store.</span></div>
<div style="position:absolute;left:66.18px;top:402.50px" class="cls_063"><span class="cls_063">4.2.2</span></div>
<div style="position:absolute;left:102.18px;top:402.50px" class="cls_063"><span class="cls_063">JDBC-based user store</span></div>
<div style="position:absolute;left:102.18px;top:419.66px" class="cls_039"><span class="cls_039">User information is often maintained in a relational database, and a JDBC-based user</span></div>
<div style="position:absolute;left:102.18px;top:432.68px" class="cls_039"><span class="cls_039">store seems appropriate. The following listing shows how to configure Spring Security</span></div>
<div style="position:absolute;left:102.18px;top:445.67px" class="cls_039"><span class="cls_039">to authenticate against user information kept in a relational database with JDBC.</span></div>
<div style="position:absolute;left:114.18px;top:469.40px" class="cls_066"><span class="cls_066">Listing 4.3</span></div>
<div style="position:absolute;left:166.26px;top:469.40px" class="cls_066"><span class="cls_066">Authenticating against a JDBC-based user store</span></div>
<div style="position:absolute;left:102.18px;top:489.26px" class="cls_060"><span class="cls_060">@Autowired</span></div>
<div style="position:absolute;left:102.18px;top:499.25px" class="cls_060"><span class="cls_060">DataSource dataSource;</span></div>
<div style="position:absolute;left:102.18px;top:517.25px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:102.18px;top:527.24px" class="cls_060"><span class="cls_060">protected void configure(AuthenticationManagerBuilder auth)</span></div>
<div style="position:absolute;left:121.38px;top:537.26px" class="cls_060"><span class="cls_060">throws Exception {</span></div>
<div style="position:absolute;left:111.78px;top:555.26px" class="cls_060"><span class="cls_060">auth</span></div>
<div style="position:absolute;left:121.38px;top:565.25px" class="cls_060"><span class="cls_060">.jdbcAuthentication()</span></div>
<div style="position:absolute;left:130.95px;top:575.24px" class="cls_060"><span class="cls_060">.dataSource(dataSource);</span></div>
<div style="position:absolute;left:102.18px;top:595.25px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:73680px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background112.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">90</span></div>
<div style="position:absolute;left:210.90px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 4</span></div>
<div style="position:absolute;left:255.03px;top:24.35px" class="cls_055"><span class="cls_055">Securing Spring</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">This implementation of </span><span class="cls_059">configure()</span><span class="cls_039"> calls </span><span class="cls_059">jdbcAuthentication()</span><span class="cls_039"> on the given</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_059"><span class="cls_059">AuthenticationManagerBuilder</span><span class="cls_039">. From there, you must also set the </span><span class="cls_059">DataSource</span><span class="cls_039"> so</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">that it knows how to access the database. The </span><span class="cls_059">DataSource</span><span class="cls_039"> used here is provided by the</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">magic of autowiring.</span></div>
<div style="position:absolute;left:93.18px;top:107.84px" class="cls_064"><span class="cls_064">O</span><span class="cls_065">VERRIDING</span><span class="cls_064"> </span><span class="cls_065">THE</span><span class="cls_064"> </span><span class="cls_065">DEFAULT</span><span class="cls_064"> </span><span class="cls_065">USER</span><span class="cls_064"> </span><span class="cls_065">QUERIES</span></div>
<div style="position:absolute;left:93.18px;top:120.17px" class="cls_039"><span class="cls_039">Although this minimal configuration will work, it makes some assumptions about your</span></div>
<div style="position:absolute;left:93.18px;top:133.16px" class="cls_039"><span class="cls_039">database schema. It expects that certain tables exist where user data will be kept. More</span></div>
<div style="position:absolute;left:93.18px;top:146.15px" class="cls_039"><span class="cls_039">specifically, the following snippet of code from Spring Security’s internals shows the</span></div>
<div style="position:absolute;left:93.18px;top:159.17px" class="cls_039"><span class="cls_039">SQL queries that will be performed when looking up user details:</span></div>
<div style="position:absolute;left:93.18px;top:178.85px" class="cls_060"><span class="cls_060">public static final String DEF_USERS_BY_USERNAME_QUERY =</span></div>
<div style="position:absolute;left:131.54px;top:188.84px" class="cls_060"><span class="cls_060">"select username,password,enabled " +</span></div>
<div style="position:absolute;left:131.56px;top:198.83px" class="cls_060"><span class="cls_060">"from users " +</span></div>
<div style="position:absolute;left:131.56px;top:208.85px" class="cls_060"><span class="cls_060">"where username = ?";</span></div>
<div style="position:absolute;left:93.18px;top:218.84px" class="cls_060"><span class="cls_060">public static final String DEF_AUTHORITIES_BY_USERNAME_QUERY =</span></div>
<div style="position:absolute;left:131.56px;top:228.83px" class="cls_060"><span class="cls_060">"select username,authority " +</span></div>
<div style="position:absolute;left:131.56px;top:238.85px" class="cls_060"><span class="cls_060">"from authorities " +</span></div>
<div style="position:absolute;left:131.56px;top:248.84px" class="cls_060"><span class="cls_060">"where username = ?";</span></div>
<div style="position:absolute;left:93.18px;top:258.83px" class="cls_060"><span class="cls_060">public static final String DEF_GROUP_AUTHORITIES_BY_USERNAME_QUERY =</span></div>
<div style="position:absolute;left:131.57px;top:268.85px" class="cls_060"><span class="cls_060">"select g.id, g.group_name, ga.authority " +</span></div>
<div style="position:absolute;left:131.55px;top:278.84px" class="cls_060"><span class="cls_060">"from groups g, group_members gm, group_authorities ga " +</span></div>
<div style="position:absolute;left:131.57px;top:288.83px" class="cls_060"><span class="cls_060">"where gm.username = ? " +</span></div>
<div style="position:absolute;left:131.57px;top:298.85px" class="cls_060"><span class="cls_060">"and g.id = ga.group_id " +</span></div>
<div style="position:absolute;left:131.56px;top:308.84px" class="cls_061"><span class="cls_061">"and g.id = gm.group_id";</span></div>
<div style="position:absolute;left:93.18px;top:328.16px" class="cls_039"><span class="cls_039">The first query retrieves a user’s username, password, and whether or not they’re</span></div>
<div style="position:absolute;left:93.18px;top:341.18px" class="cls_039"><span class="cls_039">enabled. This information is used to authenticate the user. The next query looks up</span></div>
<div style="position:absolute;left:93.18px;top:354.17px" class="cls_039"><span class="cls_039">the user’s granted authorities for authorization purposes, and the final query looks</span></div>
<div style="position:absolute;left:93.18px;top:367.16px" class="cls_039"><span class="cls_039">up authorities granted to a user as a member of a group.</span></div>
<div style="position:absolute;left:107.63px;top:380.18px" class="cls_039"><span class="cls_039">If you’re OK with defining and populating tables in your database that satisfy those</span></div>
<div style="position:absolute;left:93.18px;top:393.17px" class="cls_039"><span class="cls_039">queries, there’s not much else for you to do. But chances are your database doesn’t</span></div>
<div style="position:absolute;left:93.18px;top:406.16px" class="cls_039"><span class="cls_039">look anything like this, and you’ll want more control over the queries. In that case,</span></div>
<div style="position:absolute;left:93.18px;top:419.18px" class="cls_039"><span class="cls_039">you can configure your own queries.</span></div>
<div style="position:absolute;left:105.18px;top:441.89px" class="cls_066"><span class="cls_066">Listing 4.4</span></div>
<div style="position:absolute;left:157.27px;top:441.89px" class="cls_066"><span class="cls_066">Customizing user detail queries</span></div>
<div style="position:absolute;left:93.18px;top:461.75px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:93.18px;top:471.74px" class="cls_060"><span class="cls_060">protected void configure(AuthenticationManagerBuilder auth)</span></div>
<div style="position:absolute;left:112.38px;top:481.76px" class="cls_060"><span class="cls_060">throws Exception {</span></div>
<div style="position:absolute;left:102.78px;top:497.75px" class="cls_060"><span class="cls_060">auth</span></div>
<div style="position:absolute;left:112.38px;top:507.74px" class="cls_060"><span class="cls_060">.jdbcAuthentication()</span></div>
<div style="position:absolute;left:121.95px;top:517.76px" class="cls_060"><span class="cls_060">.dataSource(dataSource)</span></div>
<div style="position:absolute;left:121.95px;top:527.75px" class="cls_060"><span class="cls_060">.usersByUsernameQuery(</span></div>
<div style="position:absolute;left:141.16px;top:537.74px" class="cls_060"><span class="cls_060">"select username, password, enabled from Users " +</span></div>
<div style="position:absolute;left:141.13px;top:547.76px" class="cls_060"><span class="cls_060">"where username=?")</span></div>
<div style="position:absolute;left:121.95px;top:557.75px" class="cls_060"><span class="cls_060">.authoritiesByUsernameQuery(</span></div>
<div style="position:absolute;left:141.16px;top:567.74px" class="cls_060"><span class="cls_060">"select username, authority from UserAuthorities " +</span></div>
<div style="position:absolute;left:141.13px;top:577.76px" class="cls_060"><span class="cls_060">"where username=?");</span></div>
<div style="position:absolute;left:93.18px;top:593.75px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:74356px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background113.jpg" width="531" height="666"></div>
<div style="position:absolute;left:220.74px;top:24.35px" class="cls_055"><span class="cls_055">Configuring Spring Security</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">91</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">In this case, you only override the authentication and basic authorization queries. But</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">you can also override the group authorities query by calling </span><span class="cls_059">groupAuthoritiesBy-</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_059"><span class="cls_059">Username()</span><span class="cls_039"> with a custom query.</span></div>
<div style="position:absolute;left:116.53px;top:89.66px" class="cls_039"><span class="cls_039">When replacing the default SQL queries with those of your own design, it’s import-</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">ant to adhere to the basic contract of the queries. All of them take the username as</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">their only parameter. The authentication query selects the username, password, and</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">enabled status. The authorities query selects zero or more rows containing the user-</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">name and a granted authority. The group authorities query selects zero or more rows,</span></div>
<div style="position:absolute;left:102.18px;top:154.67px" class="cls_039"><span class="cls_039">each with a group ID, a group name, and an authority.</span></div>
<div style="position:absolute;left:102.18px;top:172.85px" class="cls_064"><span class="cls_064">W</span><span class="cls_065">ORKING</span><span class="cls_064"> </span><span class="cls_065">WITH</span><span class="cls_064"> </span><span class="cls_065">ENCODED</span><span class="cls_064"> </span><span class="cls_065">PASSWORDS</span></div>
<div style="position:absolute;left:102.18px;top:185.15px" class="cls_039"><span class="cls_039">Focusing on the authentication query, you can see that user passwords are expected to</span></div>
<div style="position:absolute;left:102.18px;top:198.17px" class="cls_039"><span class="cls_039">be stored in the database. The only problem with this is that if the passwords are</span></div>
<div style="position:absolute;left:102.18px;top:211.16px" class="cls_039"><span class="cls_039">stored in plain text, they’re subject to the prying eyes of a hacker. But if you encode</span></div>
<div style="position:absolute;left:102.18px;top:224.15px" class="cls_039"><span class="cls_039">the passwords in the database, authentication will fail because it won’t match the</span></div>
<div style="position:absolute;left:102.18px;top:237.17px" class="cls_039"><span class="cls_039">plaintext password submitted by the user.</span></div>
<div style="position:absolute;left:117.83px;top:250.16px" class="cls_039"><span class="cls_039">To remedy this problem, you need to specify a password encoder by calling the</span></div>
<div style="position:absolute;left:102.18px;top:263.15px" class="cls_059"><span class="cls_059">passwordEncoder()</span><span class="cls_039"> method:</span></div>
<div style="position:absolute;left:102.18px;top:282.83px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:102.18px;top:292.85px" class="cls_060"><span class="cls_060">protected void configure(AuthenticationManagerBuilder auth)</span></div>
<div style="position:absolute;left:121.38px;top:302.84px" class="cls_060"><span class="cls_060">throws Exception {</span></div>
<div style="position:absolute;left:111.78px;top:322.85px" class="cls_060"><span class="cls_060">auth</span></div>
<div style="position:absolute;left:121.38px;top:332.84px" class="cls_060"><span class="cls_060">.jdbcAuthentication()</span></div>
<div style="position:absolute;left:130.95px;top:342.83px" class="cls_060"><span class="cls_060">.dataSource(dataSource)</span></div>
<div style="position:absolute;left:130.95px;top:352.85px" class="cls_060"><span class="cls_060">.usersByUsernameQuery(</span></div>
<div style="position:absolute;left:150.15px;top:362.84px" class="cls_060"><span class="cls_060">"select username, password, enabled from Users " +</span></div>
<div style="position:absolute;left:150.15px;top:372.83px" class="cls_060"><span class="cls_060">"where username=?")</span></div>
<div style="position:absolute;left:130.95px;top:382.85px" class="cls_060"><span class="cls_060">.authoritiesByUsernameQuery(</span></div>
<div style="position:absolute;left:150.14px;top:392.84px" class="cls_060"><span class="cls_060">"select username, authority from UserAuthorities " +</span></div>
<div style="position:absolute;left:150.15px;top:402.86px" class="cls_060"><span class="cls_060">"where username=?")</span></div>
<div style="position:absolute;left:130.95px;top:412.85px" class="cls_060"><span class="cls_060">.passwordEncoder(new StandardPasswordEncoder("53cr3t");</span></div>
<div style="position:absolute;left:102.18px;top:432.86px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:456.17px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">passwordEncoder()</span><span class="cls_039"> method accepts any implementation of Spring Security’s</span></div>
<div style="position:absolute;left:102.18px;top:469.16px" class="cls_059"><span class="cls_059">PasswordEncoder</span><span class="cls_039"> interface. Spring Security’s cryptography module includes several</span></div>
<div style="position:absolute;left:102.18px;top:482.18px" class="cls_039"><span class="cls_039">such implementations:</span></div>
<div style="position:absolute;left:117.78px;top:499.16px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> BCryptPasswordEncoder</span><span class="cls_039">—Applies bcrypt strong hashing encryption</span></div>
<div style="position:absolute;left:117.78px;top:513.17px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> NoOpPasswordEncoder</span><span class="cls_039">—Applies no encoding</span></div>
<div style="position:absolute;left:117.78px;top:527.18px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> Pbkdf2PasswordEncoder</span><span class="cls_039">—Applies PBKDF2 encryption</span></div>
<div style="position:absolute;left:117.78px;top:541.16px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> SCryptPasswordEncoder</span><span class="cls_039">—Applies scrypt hashing encryption</span></div>
<div style="position:absolute;left:117.78px;top:555.17px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> StandardPasswordEncoder</span><span class="cls_039">—Applies SHA-256 hashing encryption</span></div>
<div style="position:absolute;left:102.18px;top:573.17px" class="cls_039"><span class="cls_039">The preceding code uses </span><span class="cls_059">StandardPasswordEncoder</span><span class="cls_039">. But you can choose any of the</span></div>
<div style="position:absolute;left:102.18px;top:586.19px" class="cls_039"><span class="cls_039">other implementations or even provide your own custom implementation if none of</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:75032px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background114.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">92</span></div>
<div style="position:absolute;left:210.90px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 4</span></div>
<div style="position:absolute;left:255.03px;top:24.35px" class="cls_055"><span class="cls_055">Securing Spring</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">the out-of-the-box implementations meet your needs. The </span><span class="cls_059">PasswordEncoder</span><span class="cls_039"> interface</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">is rather simple:</span></div>
<div style="position:absolute;left:93.18px;top:83.33px" class="cls_060"><span class="cls_060">public interface PasswordEncoder {</span></div>
<div style="position:absolute;left:102.78px;top:93.32px" class="cls_060"><span class="cls_060">String encode(CharSequence rawPassword);</span></div>
<div style="position:absolute;left:102.78px;top:103.34px" class="cls_060"><span class="cls_060">boolean matches(CharSequence rawPassword, String encodedPassword);</span></div>
<div style="position:absolute;left:93.18px;top:113.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:132.65px" class="cls_039"><span class="cls_039">No matter which password encoder you use, it’s important to understand that the</span></div>
<div style="position:absolute;left:93.18px;top:145.67px" class="cls_039"><span class="cls_039">password in the database is never decoded. Instead, the password that the user enters</span></div>
<div style="position:absolute;left:93.18px;top:158.66px" class="cls_039"><span class="cls_039">at login is encoded using the same algorithm, and it’s then compared with the</span></div>
<div style="position:absolute;left:93.18px;top:171.65px" class="cls_039"><span class="cls_039">encoded password in the database. That comparison is performed in the </span><span class="cls_059">Password-</span></div>
<div style="position:absolute;left:93.18px;top:184.67px" class="cls_059"><span class="cls_059">Encoder</span><span class="cls_039">’s </span><span class="cls_059">matches()</span><span class="cls_039"> method.</span></div>
<div style="position:absolute;left:108.72px;top:197.66px" class="cls_039"><span class="cls_039">Ultimately, you’ll maintain Taco Cloud user data in a database. Rather than use</span></div>
<div style="position:absolute;left:93.18px;top:210.65px" class="cls_059"><span class="cls_059">jdbcAuthentication()</span><span class="cls_039">, however, I’ve got another authentication option in mind. But</span></div>
<div style="position:absolute;left:93.18px;top:223.67px" class="cls_039"><span class="cls_039">before we go there, let’s look at how you can configure Spring Security to rely on</span></div>
<div style="position:absolute;left:93.18px;top:236.66px" class="cls_039"><span class="cls_039">another common source of user data: a user store accessed with LDAP (Lightweight</span></div>
<div style="position:absolute;left:93.18px;top:249.65px" class="cls_039"><span class="cls_039">Directory Access Protocol).</span></div>
<div style="position:absolute;left:57.18px;top:270.50px" class="cls_063"><span class="cls_063">4.2.3</span></div>
<div style="position:absolute;left:93.18px;top:270.50px" class="cls_063"><span class="cls_063">LDAP-backed user store</span></div>
<div style="position:absolute;left:93.18px;top:287.66px" class="cls_039"><span class="cls_039">To configure Spring Security for LDAP-based authentication, you can use the </span><span class="cls_059">ldap-</span></div>
<div style="position:absolute;left:93.33px;top:300.68px" class="cls_059"><span class="cls_059">Authentication()</span><span class="cls_039"> method. This method is the LDAP analog to </span><span class="cls_059">jdbcAuthentication()</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:93.18px;top:313.67px" class="cls_039"><span class="cls_039">The following </span><span class="cls_059">configure()</span><span class="cls_039"> method shows a simple configuration for LDAP authen-</span></div>
<div style="position:absolute;left:93.18px;top:326.66px" class="cls_039"><span class="cls_039">tication:</span></div>
<div style="position:absolute;left:93.18px;top:345.35px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:93.18px;top:355.34px" class="cls_060"><span class="cls_060">protected void configure(AuthenticationManagerBuilder auth)</span></div>
<div style="position:absolute;left:112.38px;top:365.33px" class="cls_060"><span class="cls_060">throws Exception {</span></div>
<div style="position:absolute;left:102.78px;top:375.35px" class="cls_060"><span class="cls_060">auth</span></div>
<div style="position:absolute;left:112.38px;top:385.34px" class="cls_060"><span class="cls_060">.ldapAuthentication()</span></div>
<div style="position:absolute;left:121.95px;top:395.36px" class="cls_060"><span class="cls_060">.userSearchFilter("(uid={0})")</span></div>
<div style="position:absolute;left:121.95px;top:405.35px" class="cls_060"><span class="cls_060">.groupSearchFilter("member={0}");</span></div>
<div style="position:absolute;left:93.18px;top:415.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:434.66px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">userSearchFilter()</span><span class="cls_039"> and </span><span class="cls_059">groupSearchFilter()</span><span class="cls_039"> methods are used to provide fil-</span></div>
<div style="position:absolute;left:93.18px;top:447.68px" class="cls_039"><span class="cls_039">ters for the base LDAP queries, which are used to search for users and groups. By</span></div>
<div style="position:absolute;left:93.18px;top:460.67px" class="cls_039"><span class="cls_039">default, the base queries for both users and groups are empty, indicating that the</span></div>
<div style="position:absolute;left:93.18px;top:473.66px" class="cls_039"><span class="cls_039">search will be done from the root of the LDAP hierarchy. But you can change that by</span></div>
<div style="position:absolute;left:93.18px;top:486.68px" class="cls_039"><span class="cls_039">specifying a query base:</span></div>
<div style="position:absolute;left:93.18px;top:505.34px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:93.18px;top:515.36px" class="cls_060"><span class="cls_060">protected void configure(AuthenticationManagerBuilder auth)</span></div>
<div style="position:absolute;left:112.38px;top:525.35px" class="cls_060"><span class="cls_060">throws Exception {</span></div>
<div style="position:absolute;left:102.78px;top:535.34px" class="cls_060"><span class="cls_060">auth</span></div>
<div style="position:absolute;left:112.38px;top:545.36px" class="cls_060"><span class="cls_060">.ldapAuthentication()</span></div>
<div style="position:absolute;left:121.95px;top:555.35px" class="cls_060"><span class="cls_060">.userSearchBase("ou=people")</span></div>
<div style="position:absolute;left:121.95px;top:565.34px" class="cls_060"><span class="cls_060">.userSearchFilter("(uid={0})")</span></div>
<div style="position:absolute;left:121.95px;top:575.36px" class="cls_060"><span class="cls_060">.groupSearchBase("ou=groups")</span></div>
<div style="position:absolute;left:121.95px;top:585.35px" class="cls_060"><span class="cls_060">.groupSearchFilter("member={0}");</span></div>
<div style="position:absolute;left:93.18px;top:595.34px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:75708px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background115.jpg" width="531" height="666"></div>
<div style="position:absolute;left:220.74px;top:24.35px" class="cls_055"><span class="cls_055">Configuring Spring Security</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">93</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">userSearchBase()</span><span class="cls_039"> method provides a base query for finding users. Likewise, the</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_059"><span class="cls_059">groupSearchBase()</span><span class="cls_039"> method specifies the base query for finding groups. Rather than</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">search from the root, this example specifies that users be searched for where the orga-</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">nizational unit is </span><span class="cls_059">people</span><span class="cls_039">. Groups should be searched for where the organizational</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">unit is </span><span class="cls_059">groups</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:102.18px;top:120.83px" class="cls_064"><span class="cls_064">C</span><span class="cls_065">ONFIGURING</span><span class="cls_064"> </span><span class="cls_065">PASSWORD</span><span class="cls_064"> </span><span class="cls_065">COMPARISON</span></div>
<div style="position:absolute;left:102.18px;top:133.16px" class="cls_039"><span class="cls_039">The default strategy for authenticating against LDAP is to perform a bind operation,</span></div>
<div style="position:absolute;left:102.18px;top:146.15px" class="cls_039"><span class="cls_039">authenticating the user directly to the LDAP server. Another option is to perform a</span></div>
<div style="position:absolute;left:102.18px;top:159.17px" class="cls_039"><span class="cls_039">comparison operation. This involves sending the entered password to the LDAP direc-</span></div>
<div style="position:absolute;left:102.18px;top:172.16px" class="cls_039"><span class="cls_039">tory and asking the server to compare the password against a user’s password attri-</span></div>
<div style="position:absolute;left:102.18px;top:185.15px" class="cls_039"><span class="cls_039">bute. Because the comparison is done within the LDAP server, the actual password</span></div>
<div style="position:absolute;left:102.18px;top:198.17px" class="cls_039"><span class="cls_039">remains secret.</span></div>
<div style="position:absolute;left:117.40px;top:211.16px" class="cls_039"><span class="cls_039">If you’d rather authenticate by doing a password comparison, you can declare so</span></div>
<div style="position:absolute;left:102.18px;top:224.15px" class="cls_039"><span class="cls_039">with the </span><span class="cls_059">passwordCompare()</span><span class="cls_039"> method:</span></div>
<div style="position:absolute;left:102.18px;top:243.83px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:102.18px;top:253.85px" class="cls_060"><span class="cls_060">protected void configure(AuthenticationManagerBuilder auth)</span></div>
<div style="position:absolute;left:121.38px;top:263.84px" class="cls_060"><span class="cls_060">throws Exception {</span></div>
<div style="position:absolute;left:111.78px;top:273.83px" class="cls_060"><span class="cls_060">auth</span></div>
<div style="position:absolute;left:121.38px;top:283.85px" class="cls_060"><span class="cls_060">.ldapAuthentication()</span></div>
<div style="position:absolute;left:130.95px;top:293.84px" class="cls_060"><span class="cls_060">.userSearchBase("ou=people")</span></div>
<div style="position:absolute;left:130.95px;top:303.83px" class="cls_060"><span class="cls_060">.userSearchFilter("(uid={0})")</span></div>
<div style="position:absolute;left:130.95px;top:313.85px" class="cls_060"><span class="cls_060">.groupSearchBase("ou=groups")</span></div>
<div style="position:absolute;left:130.95px;top:323.84px" class="cls_060"><span class="cls_060">.groupSearchFilter("member={0}")</span></div>
<div style="position:absolute;left:130.95px;top:333.83px" class="cls_060"><span class="cls_060">.passwordCompare();</span></div>
<div style="position:absolute;left:102.18px;top:343.85px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:365.18px" class="cls_039"><span class="cls_039">By default, the password given in the login form will be compared with the value of the</span></div>
<div style="position:absolute;left:102.18px;top:378.17px" class="cls_059"><span class="cls_059">userPassword</span><span class="cls_039"> attribute in the user’s LDAP entry. If the password is kept in a different</span></div>
<div style="position:absolute;left:102.18px;top:391.16px" class="cls_039"><span class="cls_039">attribute, you can specify the password attribute’s name with </span><span class="cls_059">passwordAttribute()</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:102.18px;top:410.84px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:102.18px;top:420.86px" class="cls_060"><span class="cls_060">protected void configure(AuthenticationManagerBuilder auth)</span></div>
<div style="position:absolute;left:121.38px;top:430.85px" class="cls_060"><span class="cls_060">throws Exception {</span></div>
<div style="position:absolute;left:111.78px;top:440.84px" class="cls_060"><span class="cls_060">auth</span></div>
<div style="position:absolute;left:121.38px;top:450.86px" class="cls_060"><span class="cls_060">.ldapAuthentication()</span></div>
<div style="position:absolute;left:130.95px;top:460.85px" class="cls_060"><span class="cls_060">.userSearchBase("ou=people")</span></div>
<div style="position:absolute;left:130.95px;top:470.84px" class="cls_060"><span class="cls_060">.userSearchFilter("(uid={0})")</span></div>
<div style="position:absolute;left:130.95px;top:480.86px" class="cls_060"><span class="cls_060">.groupSearchBase("ou=groups")</span></div>
<div style="position:absolute;left:130.95px;top:490.85px" class="cls_060"><span class="cls_060">.groupSearchFilter("member={0}")</span></div>
<div style="position:absolute;left:130.95px;top:500.84px" class="cls_060"><span class="cls_060">.passwordCompare()</span></div>
<div style="position:absolute;left:130.95px;top:510.86px" class="cls_060"><span class="cls_060">.passwordEncoder(new BCryptPasswordEncoder())</span></div>
<div style="position:absolute;left:130.95px;top:520.85px" class="cls_060"><span class="cls_060">.passwordAttribute("passcode");</span></div>
<div style="position:absolute;left:102.18px;top:530.84px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:552.17px" class="cls_039"><span class="cls_039">In this example, you specify that the </span><span class="cls_059">passcode</span><span class="cls_039"> attribute is what should be compared</span></div>
<div style="position:absolute;left:102.18px;top:565.19px" class="cls_039"><span class="cls_039">with the given password. Moreover, you also specify a password encoder. It’s nice that</span></div>
<div style="position:absolute;left:102.18px;top:578.18px" class="cls_039"><span class="cls_039">the actual password is kept secret on the server when doing server-side password com-</span></div>
<div style="position:absolute;left:102.18px;top:591.17px" class="cls_039"><span class="cls_039">parison. But the attempted password is still passed across the wire to the LDAP server</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:76384px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background116.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">94</span></div>
<div style="position:absolute;left:210.90px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 4</span></div>
<div style="position:absolute;left:255.03px;top:24.35px" class="cls_055"><span class="cls_055">Securing Spring</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">and could be intercepted by a hacker. To prevent that, you can specify an encryption</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">strategy by calling the </span><span class="cls_059">passwordEncoder()</span><span class="cls_039"> method.</span></div>
<div style="position:absolute;left:109.16px;top:76.67px" class="cls_039"><span class="cls_039">In the preceding example, passwords are encrypted using the </span><span class="cls_059">bcrypt</span><span class="cls_039"> password</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">hashing function. This assumes that the passwords are also encrypted using </span><span class="cls_059">bcrypt</span><span class="cls_039"> in</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">the LDAP server.</span></div>
<div style="position:absolute;left:93.18px;top:120.83px" class="cls_064"><span class="cls_064">R</span><span class="cls_065">EFERRING</span><span class="cls_064"> </span><span class="cls_065">TO</span><span class="cls_064"> </span><span class="cls_065">A</span><span class="cls_064"> </span><span class="cls_065">REMOTE</span><span class="cls_064"> LDAP </span><span class="cls_065">SERVER</span></div>
<div style="position:absolute;left:93.18px;top:133.16px" class="cls_039"><span class="cls_039">The one thing I’ve left out until now is where the LDAP server and data actually reside.</span></div>
<div style="position:absolute;left:93.18px;top:146.15px" class="cls_039"><span class="cls_039">You’ve been happily configuring Spring to authenticate against an LDAP server, but</span></div>
<div style="position:absolute;left:93.18px;top:159.17px" class="cls_039"><span class="cls_039">where is that server?</span></div>
<div style="position:absolute;left:107.80px;top:172.16px" class="cls_039"><span class="cls_039">By default, Spring Security’s LDAP authentication assumes that the LDAP server is</span></div>
<div style="position:absolute;left:93.18px;top:185.15px" class="cls_039"><span class="cls_039">listening on port 33389 on localhost. But if your LDAP server is on another machine,</span></div>
<div style="position:absolute;left:93.18px;top:198.17px" class="cls_039"><span class="cls_039">you can use the </span><span class="cls_059">contextSource()</span><span class="cls_039"> method to configure the location:</span></div>
<div style="position:absolute;left:93.18px;top:217.85px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:93.18px;top:227.84px" class="cls_060"><span class="cls_060">protected void configure(AuthenticationManagerBuilder auth)</span></div>
<div style="position:absolute;left:112.38px;top:237.83px" class="cls_060"><span class="cls_060">throws Exception {</span></div>
<div style="position:absolute;left:102.78px;top:247.85px" class="cls_060"><span class="cls_060">auth</span></div>
<div style="position:absolute;left:112.38px;top:257.84px" class="cls_060"><span class="cls_060">.ldapAuthentication()</span></div>
<div style="position:absolute;left:121.95px;top:267.83px" class="cls_060"><span class="cls_060">.userSearchBase("ou=people")</span></div>
<div style="position:absolute;left:121.95px;top:277.85px" class="cls_060"><span class="cls_060">.userSearchFilter("(uid={0})")</span></div>
<div style="position:absolute;left:121.95px;top:287.84px" class="cls_060"><span class="cls_060">.groupSearchBase("ou=groups")</span></div>
<div style="position:absolute;left:121.95px;top:297.83px" class="cls_060"><span class="cls_060">.groupSearchFilter("member={0}")</span></div>
<div style="position:absolute;left:121.95px;top:307.85px" class="cls_060"><span class="cls_060">.passwordCompare()</span></div>
<div style="position:absolute;left:121.95px;top:317.84px" class="cls_060"><span class="cls_060">.passwordEncoder(new BCryptPasswordEncoder())</span></div>
<div style="position:absolute;left:121.95px;top:327.83px" class="cls_060"><span class="cls_060">.passwordAttribute("passcode")</span></div>
<div style="position:absolute;left:121.95px;top:337.85px" class="cls_060"><span class="cls_060">.contextSource()</span></div>
<div style="position:absolute;left:131.55px;top:347.84px" class="cls_060"><span class="cls_060">.url("ldap://tacocloud.com:389/dc=tacocloud,dc=com");</span></div>
<div style="position:absolute;left:93.18px;top:357.83px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:379.16px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">contextSource()</span><span class="cls_039"> method returns a </span><span class="cls_059">ContextSourceBuilder</span><span class="cls_039">, which, among other</span></div>
<div style="position:absolute;left:93.18px;top:392.18px" class="cls_039"><span class="cls_039">things, offers the </span><span class="cls_059">url()</span><span class="cls_039"> method, which lets you specify the location of the LDAP server.</span></div>
<div style="position:absolute;left:93.18px;top:410.36px" class="cls_064"><span class="cls_064">C</span><span class="cls_065">ONFIGURING</span><span class="cls_064"> </span><span class="cls_065">AN</span><span class="cls_064"> </span><span class="cls_065">EMBEDDED</span><span class="cls_064"> LDAP </span><span class="cls_065">SERVER</span></div>
<div style="position:absolute;left:93.18px;top:422.66px" class="cls_039"><span class="cls_039">If you don’t happen to have an LDAP server lying around waiting to be authenticated</span></div>
<div style="position:absolute;left:93.18px;top:435.68px" class="cls_039"><span class="cls_039">against, Spring Security can provide an embedded LDAP server for you. Instead of set-</span></div>
<div style="position:absolute;left:93.18px;top:448.67px" class="cls_039"><span class="cls_039">ting the URL to a remote LDAP server, you can specify the root suffix for the embed-</span></div>
<div style="position:absolute;left:93.18px;top:461.66px" class="cls_039"><span class="cls_039">ded server via the </span><span class="cls_059">root()</span><span class="cls_039"> method:</span></div>
<div style="position:absolute;left:93.18px;top:481.34px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:93.18px;top:491.36px" class="cls_060"><span class="cls_060">protected void configure(AuthenticationManagerBuilder auth)</span></div>
<div style="position:absolute;left:112.38px;top:501.35px" class="cls_060"><span class="cls_060">throws Exception {</span></div>
<div style="position:absolute;left:102.78px;top:511.34px" class="cls_060"><span class="cls_060">auth</span></div>
<div style="position:absolute;left:112.38px;top:521.36px" class="cls_060"><span class="cls_060">.ldapAuthentication()</span></div>
<div style="position:absolute;left:121.95px;top:531.35px" class="cls_060"><span class="cls_060">.userSearchBase("ou=people")</span></div>
<div style="position:absolute;left:121.95px;top:541.34px" class="cls_060"><span class="cls_060">.userSearchFilter("(uid={0})")</span></div>
<div style="position:absolute;left:121.95px;top:551.36px" class="cls_060"><span class="cls_060">.groupSearchBase("ou=groups")</span></div>
<div style="position:absolute;left:121.95px;top:561.35px" class="cls_060"><span class="cls_060">.groupSearchFilter("member={0}")</span></div>
<div style="position:absolute;left:121.95px;top:571.34px" class="cls_060"><span class="cls_060">.passwordCompare()</span></div>
<div style="position:absolute;left:121.95px;top:581.36px" class="cls_060"><span class="cls_060">.passwordEncoder(new BCryptPasswordEncoder())</span></div>
<div style="position:absolute;left:121.95px;top:591.35px" class="cls_060"><span class="cls_060">.passwordAttribute("passcode")</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:77060px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background117.jpg" width="531" height="666"></div>
<div style="position:absolute;left:220.74px;top:24.35px" class="cls_055"><span class="cls_055">Configuring Spring Security</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">95</span></div>
<div style="position:absolute;left:130.95px;top:51.32px" class="cls_060"><span class="cls_060">.contextSource()</span></div>
<div style="position:absolute;left:140.55px;top:61.34px" class="cls_060"><span class="cls_060">.root("dc=tacocloud,dc=com");</span></div>
<div style="position:absolute;left:102.18px;top:71.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:93.65px" class="cls_039"><span class="cls_039">When the LDAP server starts, it will attempt to load data from any LDIF files that it</span></div>
<div style="position:absolute;left:102.18px;top:106.67px" class="cls_039"><span class="cls_039">can find in the classpath. LDIF (LDAP Data Interchange Format) is a standard way of</span></div>
<div style="position:absolute;left:102.18px;top:119.66px" class="cls_039"><span class="cls_039">representing LDAP data in a plain text file. Each record is composed of one or more</span></div>
<div style="position:absolute;left:102.18px;top:132.65px" class="cls_039"><span class="cls_039">lines, each containing a </span><span class="cls_059">name:value</span><span class="cls_039"> pair. Records are separated from each other by</span></div>
<div style="position:absolute;left:102.18px;top:145.67px" class="cls_039"><span class="cls_039">blank lines.</span></div>
<div style="position:absolute;left:117.51px;top:158.66px" class="cls_039"><span class="cls_039">If you’d rather that Spring not rummage through your classpath looking for any</span></div>
<div style="position:absolute;left:102.18px;top:171.65px" class="cls_039"><span class="cls_039">LDIF files it can find, you can be more explicit about which LDIF file gets loaded by</span></div>
<div style="position:absolute;left:102.18px;top:184.67px" class="cls_039"><span class="cls_039">calling the </span><span class="cls_059">ldif()</span><span class="cls_039"> method:</span></div>
<div style="position:absolute;left:102.18px;top:204.35px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:102.18px;top:214.34px" class="cls_060"><span class="cls_060">protected void configure(AuthenticationManagerBuilder auth)</span></div>
<div style="position:absolute;left:121.38px;top:224.33px" class="cls_060"><span class="cls_060">throws Exception {</span></div>
<div style="position:absolute;left:111.78px;top:234.35px" class="cls_060"><span class="cls_060">auth</span></div>
<div style="position:absolute;left:121.38px;top:244.34px" class="cls_060"><span class="cls_060">.ldapAuthentication()</span></div>
<div style="position:absolute;left:130.95px;top:254.33px" class="cls_060"><span class="cls_060">.userSearchBase("ou=people")</span></div>
<div style="position:absolute;left:130.95px;top:264.35px" class="cls_060"><span class="cls_060">.userSearchFilter("(uid={0})")</span></div>
<div style="position:absolute;left:130.95px;top:274.34px" class="cls_060"><span class="cls_060">.groupSearchBase("ou=groups")</span></div>
<div style="position:absolute;left:130.95px;top:284.33px" class="cls_060"><span class="cls_060">.groupSearchFilter("member={0}")</span></div>
<div style="position:absolute;left:130.95px;top:294.35px" class="cls_060"><span class="cls_060">.passwordCompare()</span></div>
<div style="position:absolute;left:130.95px;top:304.34px" class="cls_060"><span class="cls_060">.passwordEncoder(new BCryptPasswordEncoder())</span></div>
<div style="position:absolute;left:130.95px;top:314.33px" class="cls_060"><span class="cls_060">.passwordAttribute("passcode")</span></div>
<div style="position:absolute;left:130.95px;top:324.35px" class="cls_060"><span class="cls_060">.contextSource()</span></div>
<div style="position:absolute;left:140.55px;top:334.34px" class="cls_060"><span class="cls_060">.root("dc=tacocloud,dc=com")</span></div>
<div style="position:absolute;left:140.55px;top:344.33px" class="cls_060"><span class="cls_060">.ldif("classpath:users.ldif");</span></div>
<div style="position:absolute;left:102.18px;top:354.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:375.68px" class="cls_039"><span class="cls_039">Here, you specifically ask the LDAP server to load its content from the users.ldif file at</span></div>
<div style="position:absolute;left:102.18px;top:388.67px" class="cls_039"><span class="cls_039">the root of the classpath. In case you’re curious, here’s an LDIF file that you could use</span></div>
<div style="position:absolute;left:102.18px;top:401.66px" class="cls_039"><span class="cls_039">to load the embedded LDAP server with user data:</span></div>
<div style="position:absolute;left:102.18px;top:422.36px" class="cls_060"><span class="cls_060">dn: ou=groups,dc=tacocloud,dc=com</span></div>
<div style="position:absolute;left:102.18px;top:432.35px" class="cls_060"><span class="cls_060">objectclass: top</span></div>
<div style="position:absolute;left:102.18px;top:442.34px" class="cls_060"><span class="cls_060">objectclass: organizationalUnit</span></div>
<div style="position:absolute;left:102.18px;top:452.36px" class="cls_060"><span class="cls_060">ou: groups</span></div>
<div style="position:absolute;left:102.18px;top:462.35px" class="cls_060"><span class="cls_060">dn: ou=people,dc=tacocloud,dc=com</span></div>
<div style="position:absolute;left:102.18px;top:472.34px" class="cls_060"><span class="cls_060">objectclass: top</span></div>
<div style="position:absolute;left:102.18px;top:482.36px" class="cls_060"><span class="cls_060">objectclass: organizationalUnit</span></div>
<div style="position:absolute;left:102.18px;top:492.35px" class="cls_060"><span class="cls_060">ou: people</span></div>
<div style="position:absolute;left:102.18px;top:502.34px" class="cls_060"><span class="cls_060">dn: uid=buzz,ou=people,dc=tacocloud,dc=com</span></div>
<div style="position:absolute;left:102.18px;top:512.36px" class="cls_060"><span class="cls_060">objectclass: top</span></div>
<div style="position:absolute;left:102.18px;top:522.35px" class="cls_060"><span class="cls_060">objectclass: person</span></div>
<div style="position:absolute;left:102.18px;top:532.34px" class="cls_060"><span class="cls_060">objectclass: organizationalPerson</span></div>
<div style="position:absolute;left:102.18px;top:542.36px" class="cls_060"><span class="cls_060">objectclass: inetOrgPerson</span></div>
<div style="position:absolute;left:102.18px;top:552.35px" class="cls_060"><span class="cls_060">cn: Buzz Lightyear</span></div>
<div style="position:absolute;left:102.18px;top:562.34px" class="cls_060"><span class="cls_060">sn: Lightyear</span></div>
<div style="position:absolute;left:102.18px;top:572.36px" class="cls_060"><span class="cls_060">uid: buzz</span></div>
<div style="position:absolute;left:102.18px;top:582.35px" class="cls_060"><span class="cls_060">userPassword: password</span></div>
<div style="position:absolute;left:102.18px;top:592.34px" class="cls_060"><span class="cls_060">dn: cn=tacocloud,ou=groups,dc=tacocloud,dc=com</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:77736px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background118.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">96</span></div>
<div style="position:absolute;left:210.90px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 4</span></div>
<div style="position:absolute;left:255.03px;top:24.35px" class="cls_055"><span class="cls_055">Securing Spring</span></div>
<div style="position:absolute;left:93.18px;top:51.32px" class="cls_060"><span class="cls_060">objectclass: top</span></div>
<div style="position:absolute;left:93.18px;top:61.34px" class="cls_060"><span class="cls_060">objectclass: groupOfNames</span></div>
<div style="position:absolute;left:93.18px;top:71.33px" class="cls_060"><span class="cls_060">cn: tacocloud</span></div>
<div style="position:absolute;left:93.18px;top:81.32px" class="cls_061"><span class="cls_061">member: uid=buzz,ou=people,dc=tacocloud,dc=com</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">Spring Security’s built-in user stores are convenient and cover some common use cases.</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">But the Taco Cloud application needs something a bit special. When the out-of-the-box</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">user stores don’t meet your needs, you’ll need to create and configure a custom user</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">details service.</span></div>
<div style="position:absolute;left:57.18px;top:163.49px" class="cls_063"><span class="cls_063">4.2.4</span></div>
<div style="position:absolute;left:93.18px;top:163.49px" class="cls_063"><span class="cls_063">Customizing user authentication</span></div>
<div style="position:absolute;left:93.18px;top:180.65px" class="cls_039"><span class="cls_039">In the last chapter, you settled on using Spring Data JPA as your persistence option for</span></div>
<div style="position:absolute;left:93.18px;top:193.67px" class="cls_039"><span class="cls_039">all taco, ingredient, and order data. It would thus make sense to persist user data in</span></div>
<div style="position:absolute;left:93.18px;top:206.66px" class="cls_039"><span class="cls_039">the same way. If you do so, the data will ultimately reside in a relational database, so</span></div>
<div style="position:absolute;left:93.18px;top:219.65px" class="cls_039"><span class="cls_039">you could use JDBC-based authentication. But it’d be even better to leverage the</span></div>
<div style="position:absolute;left:93.18px;top:232.67px" class="cls_039"><span class="cls_039">Spring Data repository used to store users.</span></div>
<div style="position:absolute;left:108.48px;top:245.66px" class="cls_039"><span class="cls_039">First things first, though. Let’s create the domain object and repository interface</span></div>
<div style="position:absolute;left:93.18px;top:258.65px" class="cls_039"><span class="cls_039">that represents and persists user information.</span></div>
<div style="position:absolute;left:93.18px;top:276.83px" class="cls_064"><span class="cls_064">D</span><span class="cls_065">EFINING</span><span class="cls_064"> </span><span class="cls_065">THE</span><span class="cls_064"> </span><span class="cls_065">USER</span><span class="cls_064"> </span><span class="cls_065">DOMAIN</span><span class="cls_064"> </span><span class="cls_065">AND</span><span class="cls_064"> </span><span class="cls_065">PERSISTENCE</span></div>
<div style="position:absolute;left:93.18px;top:289.16px" class="cls_039"><span class="cls_039">When Taco Cloud customers register with the application, they’ll need to provide more</span></div>
<div style="position:absolute;left:93.18px;top:302.18px" class="cls_039"><span class="cls_039">than just a username and password. They’ll also give you their full name, address, and</span></div>
<div style="position:absolute;left:93.18px;top:315.17px" class="cls_039"><span class="cls_039">phone number. This information can be used for a variety of purposes, including pre-</span></div>
<div style="position:absolute;left:93.18px;top:328.16px" class="cls_039"><span class="cls_039">populating the order form (not to mention potential marketing opportunities).</span></div>
<div style="position:absolute;left:107.77px;top:341.18px" class="cls_039"><span class="cls_039">To capture all of that information, you’ll create a </span><span class="cls_059">User</span><span class="cls_039"> class, as follows.</span></div>
<div style="position:absolute;left:105.18px;top:364.88px" class="cls_066"><span class="cls_066">Listing 4.5</span></div>
<div style="position:absolute;left:157.28px;top:364.88px" class="cls_066"><span class="cls_066">Defining a user entity</span></div>
<div style="position:absolute;left:93.18px;top:384.74px" class="cls_060"><span class="cls_060">package tacos;</span></div>
<div style="position:absolute;left:93.18px;top:394.76px" class="cls_060"><span class="cls_060">import java.util.Arrays;</span></div>
<div style="position:absolute;left:93.18px;top:404.75px" class="cls_060"><span class="cls_060">import java.util.Collection;</span></div>
<div style="position:absolute;left:93.18px;top:414.74px" class="cls_060"><span class="cls_060">import javax.persistence.Entity;</span></div>
<div style="position:absolute;left:93.18px;top:424.76px" class="cls_060"><span class="cls_060">import javax.persistence.GeneratedValue;</span></div>
<div style="position:absolute;left:93.18px;top:434.75px" class="cls_060"><span class="cls_060">import javax.persistence.GenerationType;</span></div>
<div style="position:absolute;left:93.18px;top:444.74px" class="cls_060"><span class="cls_060">import javax.persistence.Id;</span></div>
<div style="position:absolute;left:93.18px;top:454.76px" class="cls_060"><span class="cls_060">import org.springframework.security.core.GrantedAuthority;</span></div>
<div style="position:absolute;left:93.18px;top:464.75px" class="cls_060"><span class="cls_060">import org.springframework.security.core.authority.</span></div>
<div style="position:absolute;left:294.67px;top:474.74px" class="cls_060"><span class="cls_060">SimpleGrantedAuthority;</span></div>
<div style="position:absolute;left:93.18px;top:484.76px" class="cls_060"><span class="cls_060">import org.springframework.security.core.userdetails.UserDetails;</span></div>
<div style="position:absolute;left:93.18px;top:494.75px" class="cls_060"><span class="cls_060">import lombok.AccessLevel;</span></div>
<div style="position:absolute;left:93.18px;top:504.74px" class="cls_060"><span class="cls_060">import lombok.Data;</span></div>
<div style="position:absolute;left:93.18px;top:514.76px" class="cls_060"><span class="cls_060">import lombok.NoArgsConstructor;</span></div>
<div style="position:absolute;left:93.18px;top:524.75px" class="cls_060"><span class="cls_060">import lombok.RequiredArgsConstructor;</span></div>
<div style="position:absolute;left:93.18px;top:544.76px" class="cls_060"><span class="cls_060">@Entity</span></div>
<div style="position:absolute;left:93.18px;top:554.75px" class="cls_060"><span class="cls_060">@Data</span></div>
<div style="position:absolute;left:93.18px;top:564.74px" class="cls_060"><span class="cls_060">@NoArgsConstructor(access=AccessLevel.PRIVATE, force=true)</span></div>
<div style="position:absolute;left:93.18px;top:574.76px" class="cls_060"><span class="cls_060">@RequiredArgsConstructor</span></div>
<div style="position:absolute;left:93.18px;top:584.75px" class="cls_060"><span class="cls_060">public class User implements UserDetails {</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:78412px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background119.jpg" width="531" height="666"></div>
<div style="position:absolute;left:220.74px;top:24.35px" class="cls_055"><span class="cls_055">Configuring Spring Security</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">97</span></div>
<div style="position:absolute;left:111.78px;top:51.32px" class="cls_060"><span class="cls_060">private static final long serialVersionUID = 1L;</span></div>
<div style="position:absolute;left:111.78px;top:71.33px" class="cls_060"><span class="cls_060">@Id</span></div>
<div style="position:absolute;left:111.78px;top:81.32px" class="cls_060"><span class="cls_060">@GeneratedValue(strategy=GenerationType.AUTO)</span></div>
<div style="position:absolute;left:111.78px;top:91.34px" class="cls_060"><span class="cls_060">private Long id;</span></div>
<div style="position:absolute;left:111.78px;top:107.33px" class="cls_060"><span class="cls_060">private final String username;</span></div>
<div style="position:absolute;left:111.78px;top:117.32px" class="cls_060"><span class="cls_060">private final String password;</span></div>
<div style="position:absolute;left:111.78px;top:127.34px" class="cls_060"><span class="cls_060">private final String fullname;</span></div>
<div style="position:absolute;left:111.78px;top:137.33px" class="cls_060"><span class="cls_060">private final String street;</span></div>
<div style="position:absolute;left:111.78px;top:147.35px" class="cls_060"><span class="cls_060">private final String city;</span></div>
<div style="position:absolute;left:111.78px;top:157.34px" class="cls_060"><span class="cls_060">private final String state;</span></div>
<div style="position:absolute;left:111.78px;top:167.33px" class="cls_060"><span class="cls_060">private final String zip;</span></div>
<div style="position:absolute;left:111.78px;top:177.35px" class="cls_060"><span class="cls_060">private final String phoneNumber;</span></div>
<div style="position:absolute;left:111.78px;top:195.35px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:111.77px;top:205.34px" class="cls_060"><span class="cls_060">public Collection&lt;? extends GrantedAuthority&gt; getAuthorities() {</span></div>
<div style="position:absolute;left:121.38px;top:215.33px" class="cls_060"><span class="cls_060">return Arrays.asList(new SimpleGrantedAuthority("ROLE_USER"));</span></div>
<div style="position:absolute;left:111.78px;top:225.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:243.35px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:111.78px;top:253.34px" class="cls_060"><span class="cls_060">public boolean isAccountNonExpired() {</span></div>
<div style="position:absolute;left:121.38px;top:263.33px" class="cls_060"><span class="cls_060">return true;</span></div>
<div style="position:absolute;left:111.78px;top:273.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:291.35px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:111.78px;top:301.34px" class="cls_060"><span class="cls_060">public boolean isAccountNonLocked() {</span></div>
<div style="position:absolute;left:121.38px;top:311.33px" class="cls_060"><span class="cls_060">return true;</span></div>
<div style="position:absolute;left:111.78px;top:321.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:341.33px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:111.78px;top:351.35px" class="cls_060"><span class="cls_060">public boolean isCredentialsNonExpired() {</span></div>
<div style="position:absolute;left:121.38px;top:361.34px" class="cls_060"><span class="cls_060">return true;</span></div>
<div style="position:absolute;left:111.78px;top:371.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:391.34px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:111.78px;top:401.36px" class="cls_060"><span class="cls_060">public boolean isEnabled() {</span></div>
<div style="position:absolute;left:121.38px;top:411.35px" class="cls_060"><span class="cls_060">return true;</span></div>
<div style="position:absolute;left:111.78px;top:421.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:441.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:462.68px" class="cls_039"><span class="cls_039">You’ve no doubt noticed that the </span><span class="cls_059">User</span><span class="cls_039"> class is a bit more involved than any of the</span></div>
<div style="position:absolute;left:102.18px;top:475.67px" class="cls_039"><span class="cls_039">other entities defined in chapter 3. In addition to defining a handful of properties,</span></div>
<div style="position:absolute;left:102.18px;top:488.66px" class="cls_059"><span class="cls_059">User</span><span class="cls_039"> also implements the </span><span class="cls_059">UserDetails</span><span class="cls_039"> interface from Spring Security.</span></div>
<div style="position:absolute;left:117.50px;top:501.68px" class="cls_039"><span class="cls_039">Implementations of </span><span class="cls_059">UserDetails</span><span class="cls_039"> will provide some essential user information to</span></div>
<div style="position:absolute;left:102.18px;top:514.67px" class="cls_039"><span class="cls_039">the framework, such as what authorities are granted to the user and whether the user’s</span></div>
<div style="position:absolute;left:102.18px;top:527.66px" class="cls_039"><span class="cls_039">account is enabled or not.</span></div>
<div style="position:absolute;left:117.33px;top:540.68px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">getAuthorities()</span><span class="cls_039"> method should return a collection of authorities granted</span></div>
<div style="position:absolute;left:102.18px;top:553.67px" class="cls_039"><span class="cls_039">to the user. The various </span><span class="cls_059">is___Expired()</span><span class="cls_039"> methods return a </span><span class="cls_059">boolean</span><span class="cls_039"> to indicate whether</span></div>
<div style="position:absolute;left:102.18px;top:566.69px" class="cls_039"><span class="cls_039">or not the user’s account is enabled or expired.</span></div>
<div style="position:absolute;left:117.86px;top:579.68px" class="cls_039"><span class="cls_039">For your </span><span class="cls_059">User</span><span class="cls_039"> entity, the </span><span class="cls_059">getAuthorities()</span><span class="cls_039"> method simply returns a collection</span></div>
<div style="position:absolute;left:102.18px;top:592.67px" class="cls_039"><span class="cls_039">indicating that all users will have been granted </span><span class="cls_059">ROLE_USER</span><span class="cls_039"> authority. And, at least for</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:79088px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background120.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">98</span></div>
<div style="position:absolute;left:210.90px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 4</span></div>
<div style="position:absolute;left:255.03px;top:24.35px" class="cls_055"><span class="cls_055">Securing Spring</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">now, Taco Cloud has no need to disable users, so all of the </span><span class="cls_059">is___Expired()</span><span class="cls_039"> methods</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">return </span><span class="cls_059">true</span><span class="cls_039"> to indicate that the users are active.</span></div>
<div style="position:absolute;left:107.78px;top:76.67px" class="cls_039"><span class="cls_039">With the </span><span class="cls_059">User</span><span class="cls_039"> entity defined, you now can define the repository interface:</span></div>
<div style="position:absolute;left:93.18px;top:96.32px" class="cls_060"><span class="cls_060">package tacos.data;</span></div>
<div style="position:absolute;left:93.18px;top:106.34px" class="cls_060"><span class="cls_060">import org.springframework.data.repository.CrudRepository;</span></div>
<div style="position:absolute;left:93.18px;top:116.33px" class="cls_060"><span class="cls_060">import tacos.User;</span></div>
<div style="position:absolute;left:93.18px;top:136.34px" class="cls_060"><span class="cls_060">public interface UserRepository extends CrudRepository&lt;User, Long&gt; {</span></div>
<div style="position:absolute;left:102.78px;top:156.35px" class="cls_060"><span class="cls_060">User findByUsername(String username);</span></div>
<div style="position:absolute;left:93.18px;top:176.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:197.66px" class="cls_039"><span class="cls_039">In addition to the CRUD operations provided by extending </span><span class="cls_059">CrudRepository</span><span class="cls_039">, </span><span class="cls_059">User-</span></div>
<div style="position:absolute;left:93.18px;top:210.65px" class="cls_059"><span class="cls_059">Repository</span><span class="cls_039"> defines a </span><span class="cls_059">findByUsername()</span><span class="cls_039"> method that you’ll use in the user details ser-</span></div>
<div style="position:absolute;left:93.18px;top:223.67px" class="cls_039"><span class="cls_039">vice to look up a </span><span class="cls_059">User</span><span class="cls_039"> by their username.</span></div>
<div style="position:absolute;left:107.56px;top:236.66px" class="cls_039"><span class="cls_039">As you learned in chapter 3, Spring Data JPA will automatically generate the imple-</span></div>
<div style="position:absolute;left:93.18px;top:249.65px" class="cls_039"><span class="cls_039">mentation of this interface at runtime. Therefore, you’re now ready to write a custom</span></div>
<div style="position:absolute;left:93.18px;top:262.67px" class="cls_039"><span class="cls_039">user details service that uses this repository.</span></div>
<div style="position:absolute;left:93.18px;top:280.85px" class="cls_064"><span class="cls_064">C</span><span class="cls_065">REATING</span><span class="cls_064"> </span><span class="cls_065">A</span><span class="cls_064"> </span><span class="cls_065">USER</span><span class="cls_064">-</span><span class="cls_065">DETAILS</span><span class="cls_064"> </span><span class="cls_065">SERVICE</span></div>
<div style="position:absolute;left:93.18px;top:293.15px" class="cls_039"><span class="cls_039">Spring Security’s </span><span class="cls_059">UserDetailsService</span><span class="cls_039"> is a rather straightforward interface:</span></div>
<div style="position:absolute;left:93.18px;top:312.83px" class="cls_060"><span class="cls_060">public interface UserDetailsService {</span></div>
<div style="position:absolute;left:102.78px;top:322.85px" class="cls_060"><span class="cls_060">UserDetails loadUserByUsername(String username)</span></div>
<div style="position:absolute;left:193.94px;top:332.84px" class="cls_060"><span class="cls_060">throws UsernameNotFoundException;</span></div>
<div style="position:absolute;left:93.18px;top:342.83px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:364.16px" class="cls_039"><span class="cls_039">As you can see, implementations of this interface are given a user’s username and are</span></div>
<div style="position:absolute;left:93.18px;top:377.18px" class="cls_039"><span class="cls_039">expected to either return a </span><span class="cls_059">UserDetails</span><span class="cls_039"> object or throw a </span><span class="cls_059">UsernameNotFoundException</span></div>
<div style="position:absolute;left:93.18px;top:390.17px" class="cls_039"><span class="cls_039">if the given username doesn’t turn up any results.</span></div>
<div style="position:absolute;left:108.78px;top:403.16px" class="cls_039"><span class="cls_039">Because your </span><span class="cls_059">User</span><span class="cls_039"> class implements </span><span class="cls_059">UserDetails</span><span class="cls_039">, and because </span><span class="cls_059">UserRepository</span></div>
<div style="position:absolute;left:93.18px;top:416.18px" class="cls_039"><span class="cls_039">provides a </span><span class="cls_059">findByUsername()</span><span class="cls_039"> method, they’re perfectly suitable for use in a custom</span></div>
<div style="position:absolute;left:93.18px;top:429.17px" class="cls_059"><span class="cls_059">UserDetailsService</span><span class="cls_039"> implementation. The following listing shows the user details ser-</span></div>
<div style="position:absolute;left:93.18px;top:442.16px" class="cls_039"><span class="cls_039">vice you’ll use in the Taco Cloud application.</span></div>
<div style="position:absolute;left:105.18px;top:465.89px" class="cls_066"><span class="cls_066">Listing 4.6</span></div>
<div style="position:absolute;left:157.28px;top:465.89px" class="cls_066"><span class="cls_066">Defining a custom user details service</span></div>
<div style="position:absolute;left:93.18px;top:484.76px" class="cls_060"><span class="cls_060">package tacos.security;</span></div>
<div style="position:absolute;left:93.18px;top:494.75px" class="cls_060"><span class="cls_060">import org.springframework.beans.factory.annotation.Autowired;</span></div>
<div style="position:absolute;left:93.18px;top:504.74px" class="cls_060"><span class="cls_060">import org.springframework.security.core.userdetails.UserDetails;</span></div>
<div style="position:absolute;left:93.18px;top:514.76px" class="cls_060"><span class="cls_060">import org.springframework.security.core.userdetails.</span></div>
<div style="position:absolute;left:313.86px;top:524.75px" class="cls_060"><span class="cls_060">UserDetailsService;</span></div>
<div style="position:absolute;left:93.18px;top:534.74px" class="cls_060"><span class="cls_060">import org.springframework.security.core.userdetails.</span></div>
<div style="position:absolute;left:280.31px;top:544.76px" class="cls_060"><span class="cls_060">UsernameNotFoundException;</span></div>
<div style="position:absolute;left:93.18px;top:554.75px" class="cls_060"><span class="cls_060">import org.springframework.stereotype.Service;</span></div>
<div style="position:absolute;left:93.18px;top:574.76px" class="cls_060"><span class="cls_060">import tacos.User;</span></div>
<div style="position:absolute;left:93.18px;top:584.75px" class="cls_060"><span class="cls_060">import tacos.data.UserRepository;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:79764px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background121.jpg" width="531" height="666"></div>
<div style="position:absolute;left:220.74px;top:24.35px" class="cls_055"><span class="cls_055">Configuring Spring Security</span></div>
<div style="position:absolute;left:464.73px;top:24.35px" class="cls_052"><span class="cls_052">99</span></div>
<div style="position:absolute;left:102.18px;top:51.32px" class="cls_060"><span class="cls_060">@Service</span></div>
<div style="position:absolute;left:102.18px;top:61.34px" class="cls_060"><span class="cls_060">public class UserRepositoryUserDetailsService</span></div>
<div style="position:absolute;left:140.56px;top:71.33px" class="cls_060"><span class="cls_060">implements UserDetailsService {</span></div>
<div style="position:absolute;left:111.78px;top:91.34px" class="cls_060"><span class="cls_060">private UserRepository userRepo;</span></div>
<div style="position:absolute;left:111.78px;top:111.32px" class="cls_060"><span class="cls_060">@Autowired</span></div>
<div style="position:absolute;left:111.77px;top:121.34px" class="cls_060"><span class="cls_060">public UserRepositoryUserDetailsService(UserRepository userRepo) {</span></div>
<div style="position:absolute;left:121.36px;top:131.33px" class="cls_060"><span class="cls_060">this.userRepo = userRepo;</span></div>
<div style="position:absolute;left:111.78px;top:141.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:161.33px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:111.78px;top:171.35px" class="cls_060"><span class="cls_060">public UserDetails loadUserByUsername(String username)</span></div>
<div style="position:absolute;left:130.96px;top:181.34px" class="cls_060"><span class="cls_060">throws UsernameNotFoundException {</span></div>
<div style="position:absolute;left:121.38px;top:191.33px" class="cls_060"><span class="cls_060">User user = userRepo.findByUsername(username);</span></div>
<div style="position:absolute;left:121.38px;top:201.35px" class="cls_060"><span class="cls_060">if (user != null) {</span></div>
<div style="position:absolute;left:130.95px;top:211.34px" class="cls_060"><span class="cls_060">return user;</span></div>
<div style="position:absolute;left:121.38px;top:221.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:121.38px;top:231.35px" class="cls_060"><span class="cls_060">throw new UsernameNotFoundException(</span></div>
<div style="position:absolute;left:198.11px;top:241.34px" class="cls_060"><span class="cls_060">"User '" + username + "' not found");</span></div>
<div style="position:absolute;left:111.78px;top:251.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:271.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:292.67px" class="cls_059"><span class="cls_059">UserRepositoryUserDetailsService</span><span class="cls_039"> is injected with an instance of </span><span class="cls_059">UserRepository</span></div>
<div style="position:absolute;left:102.18px;top:305.66px" class="cls_039"><span class="cls_039">through its constructor. Then, in its </span><span class="cls_059">loadByUsername()</span><span class="cls_039"> method, it calls </span><span class="cls_059">findByUser-</span></div>
<div style="position:absolute;left:102.18px;top:318.68px" class="cls_059"><span class="cls_059">name()</span><span class="cls_039"> on the </span><span class="cls_059">UserRepository</span><span class="cls_039"> to look up a </span><span class="cls_059">User</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:118.53px;top:331.67px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">loadByUsername()</span><span class="cls_039"> method has one simple rule: it must never return </span><span class="cls_059">null</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:102.18px;top:344.66px" class="cls_039"><span class="cls_039">Therefore, if the call to </span><span class="cls_059">findByUsername()</span><span class="cls_039"> returns </span><span class="cls_059">null</span><span class="cls_039">, </span><span class="cls_059">loadByUsername()</span><span class="cls_039"> will throw a</span></div>
<div style="position:absolute;left:102.18px;top:357.68px" class="cls_059"><span class="cls_059">UsernameNotFoundException</span><span class="cls_039">. Otherwise, the </span><span class="cls_059">User</span><span class="cls_039"> that was found will be returned.</span></div>
<div style="position:absolute;left:116.88px;top:370.67px" class="cls_039"><span class="cls_039">You’ll notice that </span><span class="cls_059">UserRepositoryUserDetailsService</span><span class="cls_039"> is annotated with </span><span class="cls_059">@Service</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:102.18px;top:383.66px" class="cls_039"><span class="cls_039">This is another one of Spring’s stereotype annotations that flag it for inclusion in Spring’s</span></div>
<div style="position:absolute;left:102.18px;top:396.68px" class="cls_039"><span class="cls_039">component scanning, so there’s no need to explicitly declare this class as a bean.</span></div>
<div style="position:absolute;left:102.18px;top:409.67px" class="cls_039"><span class="cls_039">Spring will automatically discover it and instantiate it as a bean.</span></div>
<div style="position:absolute;left:118.63px;top:422.66px" class="cls_039"><span class="cls_039">You do, however, still need to configure your custom user details service with</span></div>
<div style="position:absolute;left:102.18px;top:435.68px" class="cls_039"><span class="cls_039">Spring Security. Therefore, you’ll return to the </span><span class="cls_059">configure()</span><span class="cls_039"> method once more:</span></div>
<div style="position:absolute;left:102.18px;top:455.36px" class="cls_060"><span class="cls_060">@Autowired</span></div>
<div style="position:absolute;left:102.18px;top:465.35px" class="cls_060"><span class="cls_060">private UserDetailsService userDetailsService;</span></div>
<div style="position:absolute;left:102.18px;top:485.36px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:102.18px;top:495.35px" class="cls_060"><span class="cls_060">protected void configure(AuthenticationManagerBuilder auth)</span></div>
<div style="position:absolute;left:121.38px;top:505.34px" class="cls_060"><span class="cls_060">throws Exception {</span></div>
<div style="position:absolute;left:111.78px;top:525.35px" class="cls_060"><span class="cls_060">auth</span></div>
<div style="position:absolute;left:121.38px;top:535.34px" class="cls_060"><span class="cls_060">.userDetailsService(userDetailsService);</span></div>
<div style="position:absolute;left:102.18px;top:555.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:576.68px" class="cls_039"><span class="cls_039">This time, you simply make a call to the </span><span class="cls_059">userDetailsService()</span><span class="cls_039"> method, passing in</span></div>
<div style="position:absolute;left:102.18px;top:589.67px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">UserDetailsService</span><span class="cls_039"> instance that has been autowired into </span><span class="cls_059">SecurityConfig</span><span class="cls_039">.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:80440px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background122.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">100</span></div>
<div style="position:absolute;left:210.90px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 4</span></div>
<div style="position:absolute;left:255.03px;top:24.35px" class="cls_055"><span class="cls_055">Securing Spring</span></div>
<div style="position:absolute;left:108.85px;top:50.66px" class="cls_039"><span class="cls_039">As with JDBC-based authentication, you can (and should) also configure a pass-</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">word encoder so that the password can be encoded in the database. You’ll do this by</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">first declaring a bean of type </span><span class="cls_059">PasswordEncoder</span><span class="cls_039"> and then injecting it into your user</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">details service configuration by calling </span><span class="cls_059">passwordEncoder()</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:111.32px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:93.18px;top:121.34px" class="cls_060"><span class="cls_060">public PasswordEncoder encoder() {</span></div>
<div style="position:absolute;left:102.78px;top:131.33px" class="cls_060"><span class="cls_060">return new StandardPasswordEncoder("53cr3t");</span></div>
<div style="position:absolute;left:93.18px;top:141.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:161.33px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:93.18px;top:171.35px" class="cls_060"><span class="cls_060">protected void configure(AuthenticationManagerBuilder auth)</span></div>
<div style="position:absolute;left:112.38px;top:181.34px" class="cls_060"><span class="cls_060">throws Exception {</span></div>
<div style="position:absolute;left:102.78px;top:201.35px" class="cls_060"><span class="cls_060">auth</span></div>
<div style="position:absolute;left:112.38px;top:211.34px" class="cls_060"><span class="cls_060">.userDetailsService(userDetailsService)</span></div>
<div style="position:absolute;left:112.38px;top:221.33px" class="cls_060"><span class="cls_060">.passwordEncoder(encoder());</span></div>
<div style="position:absolute;left:93.18px;top:241.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:264.65px" class="cls_039"><span class="cls_039">It’s important that we discuss the last line in the </span><span class="cls_059">configure()</span><span class="cls_039"> method. It would appear</span></div>
<div style="position:absolute;left:93.18px;top:277.67px" class="cls_039"><span class="cls_039">that you call the </span><span class="cls_059">encoder()</span><span class="cls_039"> method and pass its return value to </span><span class="cls_059">passwordEncoder()</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:93.18px;top:290.66px" class="cls_039"><span class="cls_039">In reality, however, because the </span><span class="cls_059">encoder()</span><span class="cls_039"> method is annotated with </span><span class="cls_059">@Bean</span><span class="cls_039">, it will</span></div>
<div style="position:absolute;left:93.18px;top:303.68px" class="cls_039"><span class="cls_039">be used to declare a </span><span class="cls_059">PasswordEncoder</span><span class="cls_039"> bean in the Spring application context. Any</span></div>
<div style="position:absolute;left:93.18px;top:316.67px" class="cls_039"><span class="cls_039">calls to </span><span class="cls_059">encoder()</span><span class="cls_039">will then be intercepted to return the bean instance from the</span></div>
<div style="position:absolute;left:93.18px;top:329.66px" class="cls_039"><span class="cls_039">application context.</span></div>
<div style="position:absolute;left:107.62px;top:342.68px" class="cls_039"><span class="cls_039">Now that you have a custom user details service that reads user information via a JPA</span></div>
<div style="position:absolute;left:93.18px;top:355.67px" class="cls_039"><span class="cls_039">repository, you just need a way to get users into the database in the first place. You need</span></div>
<div style="position:absolute;left:93.18px;top:368.66px" class="cls_039"><span class="cls_039">to create a registration page for Taco Cloud patrons to register with the application.</span></div>
<div style="position:absolute;left:93.18px;top:386.84px" class="cls_064"><span class="cls_064">R</span><span class="cls_065">EGISTERING</span><span class="cls_064"> </span><span class="cls_065">USERS</span></div>
<div style="position:absolute;left:93.18px;top:399.17px" class="cls_039"><span class="cls_039">Although Spring Security handles many aspects of security, it really isn’t directly</span></div>
<div style="position:absolute;left:93.18px;top:412.16px" class="cls_039"><span class="cls_039">involved in the process of user registration, so you’re going to rely on a little bit of</span></div>
<div style="position:absolute;left:93.18px;top:425.18px" class="cls_039"><span class="cls_039">Spring MVC to handle that task. The </span><span class="cls_059">RegistrationController</span><span class="cls_039"> class in the following</span></div>
<div style="position:absolute;left:93.18px;top:438.17px" class="cls_039"><span class="cls_039">listing presents and processes registration forms.</span></div>
<div style="position:absolute;left:105.18px;top:464.90px" class="cls_066"><span class="cls_066">Listing 4.7</span></div>
<div style="position:absolute;left:157.27px;top:464.90px" class="cls_066"><span class="cls_066">A user registration controller</span></div>
<div style="position:absolute;left:93.18px;top:484.76px" class="cls_060"><span class="cls_060">package tacos.security;</span></div>
<div style="position:absolute;left:93.18px;top:494.75px" class="cls_060"><span class="cls_060">import org.springframework.security.crypto.password.PasswordEncoder;</span></div>
<div style="position:absolute;left:93.18px;top:504.74px" class="cls_060"><span class="cls_060">import org.springframework.stereotype.Controller;</span></div>
<div style="position:absolute;left:93.18px;top:514.76px" class="cls_060"><span class="cls_060">import org.springframework.web.bind.annotation.GetMapping;</span></div>
<div style="position:absolute;left:93.18px;top:524.75px" class="cls_060"><span class="cls_060">import org.springframework.web.bind.annotation.PostMapping;</span></div>
<div style="position:absolute;left:93.18px;top:534.74px" class="cls_060"><span class="cls_060">import org.springframework.web.bind.annotation.RequestMapping;</span></div>
<div style="position:absolute;left:93.18px;top:544.76px" class="cls_060"><span class="cls_060">import tacos.data.UserRepository;</span></div>
<div style="position:absolute;left:93.18px;top:564.74px" class="cls_060"><span class="cls_060">@Controller</span></div>
<div style="position:absolute;left:93.18px;top:574.76px" class="cls_060"><span class="cls_060">@RequestMapping("/register")</span></div>
<div style="position:absolute;left:93.18px;top:584.75px" class="cls_060"><span class="cls_060">public class RegistrationController {</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:81116px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background123.jpg" width="531" height="666"></div>
<div style="position:absolute;left:220.74px;top:24.35px" class="cls_055"><span class="cls_055">Configuring Spring Security</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">101</span></div>
<div style="position:absolute;left:111.78px;top:51.32px" class="cls_060"><span class="cls_060">private UserRepository userRepo;</span></div>
<div style="position:absolute;left:111.78px;top:61.34px" class="cls_060"><span class="cls_060">private PasswordEncoder passwordEncoder;</span></div>
<div style="position:absolute;left:111.78px;top:81.32px" class="cls_060"><span class="cls_060">public RegistrationController(</span></div>
<div style="position:absolute;left:130.96px;top:91.34px" class="cls_060"><span class="cls_060">UserRepository userRepo, PasswordEncoder passwordEncoder) {</span></div>
<div style="position:absolute;left:121.36px;top:101.33px" class="cls_060"><span class="cls_060">this.userRepo = userRepo;</span></div>
<div style="position:absolute;left:121.38px;top:111.32px" class="cls_060"><span class="cls_060">this.passwordEncoder = passwordEncoder;</span></div>
<div style="position:absolute;left:111.78px;top:121.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:141.35px" class="cls_060"><span class="cls_060">@GetMapping</span></div>
<div style="position:absolute;left:111.78px;top:151.34px" class="cls_060"><span class="cls_060">public String registerForm() {</span></div>
<div style="position:absolute;left:121.38px;top:161.33px" class="cls_060"><span class="cls_060">return "registration";</span></div>
<div style="position:absolute;left:111.78px;top:171.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:191.33px" class="cls_060"><span class="cls_060">@PostMapping</span></div>
<div style="position:absolute;left:111.78px;top:201.35px" class="cls_060"><span class="cls_060">public String processRegistration(RegistrationForm form) {</span></div>
<div style="position:absolute;left:121.38px;top:211.34px" class="cls_060"><span class="cls_060">userRepo.save(form.toUser(passwordEncoder));</span></div>
<div style="position:absolute;left:121.38px;top:221.33px" class="cls_060"><span class="cls_060">return "redirect:/login";</span></div>
<div style="position:absolute;left:111.78px;top:231.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:251.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:272.66px" class="cls_039"><span class="cls_039">Like any typical Spring MVC controller, </span><span class="cls_059">RegistrationController</span><span class="cls_039"> is annotated with</span></div>
<div style="position:absolute;left:102.18px;top:285.65px" class="cls_059"><span class="cls_059">@Controller</span><span class="cls_039"> to designate it as a controller and to mark it for component scanning.</span></div>
<div style="position:absolute;left:102.18px;top:298.67px" class="cls_039"><span class="cls_039">It’s also annotated with </span><span class="cls_059">@RequestMapping</span><span class="cls_039"> such that it will handle requests whose path</span></div>
<div style="position:absolute;left:102.18px;top:311.66px" class="cls_039"><span class="cls_039">is /register.</span></div>
<div style="position:absolute;left:117.79px;top:324.68px" class="cls_039"><span class="cls_039">More specifically, a GET request for /register will be handled by the </span><span class="cls_059">register-</span></div>
<div style="position:absolute;left:102.18px;top:337.67px" class="cls_059"><span class="cls_059">Form()</span><span class="cls_039"> method, which simply returns a logical view name of </span><span class="cls_059">registration</span><span class="cls_039">. The fol-</span></div>
<div style="position:absolute;left:102.18px;top:350.66px" class="cls_039"><span class="cls_039">lowing listing shows a Thymeleaf template that defines the </span><span class="cls_059">registration</span><span class="cls_039"> view.</span></div>
<div style="position:absolute;left:114.18px;top:374.39px" class="cls_066"><span class="cls_066">Listing 4.8</span></div>
<div style="position:absolute;left:166.26px;top:374.39px" class="cls_066"><span class="cls_066">A Thymeleaf registration form view</span></div>
<div style="position:absolute;left:102.18px;top:394.25px" class="cls_060"><span class="cls_060">&lt;!DOCTYPE html&gt;</span></div>
<div style="position:absolute;left:102.18px;top:404.24px" class="cls_060"><span class="cls_060">&lt;html xmlns="</span><a href="http://www.w3.org/1999/xhtml" "="">http://www.w3.org/1999/xhtml"</a> </div>
<div style="position:absolute;left:130.95px;top:414.26px" class="cls_060"><span class="cls_060">xmlns:th="</span><a href="http://www.thymeleaf.org/" "="">http://www.thymeleaf.org"</a>&gt;</div>
<div style="position:absolute;left:111.78px;top:424.25px" class="cls_060"><span class="cls_060">&lt;head&gt;</span></div>
<div style="position:absolute;left:121.38px;top:434.24px" class="cls_060"><span class="cls_060">&lt;title&gt;Taco Cloud&lt;/title&gt;</span></div>
<div style="position:absolute;left:111.78px;top:444.26px" class="cls_060"><span class="cls_060">&lt;/head&gt;</span></div>
<div style="position:absolute;left:111.78px;top:464.24px" class="cls_060"><span class="cls_060">&lt;body&gt;</span></div>
<div style="position:absolute;left:121.38px;top:474.26px" class="cls_060"><span class="cls_060">&lt;h1&gt;Register&lt;/h1&gt;</span></div>
<div style="position:absolute;left:121.38px;top:484.25px" class="cls_060"><span class="cls_060">&lt;img th:src="@{/images/TacoCloud.png}"/&gt;</span></div>
<div style="position:absolute;left:121.38px;top:504.26px" class="cls_060"><span class="cls_060">&lt;form method="POST" th:action="@{/register}" id="registerForm"&gt;</span></div>
<div style="position:absolute;left:140.56px;top:524.24px" class="cls_060"><span class="cls_060">&lt;label for="username"&gt;Username: &lt;/label&gt;</span></div>
<div style="position:absolute;left:140.56px;top:534.26px" class="cls_060"><span class="cls_060">&lt;input type="text" name="username"/&gt;&lt;br/&gt;</span></div>
<div style="position:absolute;left:140.56px;top:554.24px" class="cls_060"><span class="cls_060">&lt;label for="password"&gt;Password: &lt;/label&gt;</span></div>
<div style="position:absolute;left:140.56px;top:564.26px" class="cls_060"><span class="cls_060">&lt;input type="password" name="password"/&gt;&lt;br/&gt;</span></div>
<div style="position:absolute;left:140.56px;top:584.24px" class="cls_060"><span class="cls_060">&lt;label for="confirm"&gt;Confirm password: &lt;/label&gt;</span></div>
<div style="position:absolute;left:140.56px;top:594.26px" class="cls_060"><span class="cls_060">&lt;input type="password" name="confirm"/&gt;&lt;br/&gt;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:81792px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background124.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">102</span></div>
<div style="position:absolute;left:210.90px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 4</span></div>
<div style="position:absolute;left:255.03px;top:24.35px" class="cls_055"><span class="cls_055">Securing Spring</span></div>
<div style="position:absolute;left:131.56px;top:51.32px" class="cls_060"><span class="cls_060">&lt;label for="fullname"&gt;Full name: &lt;/label&gt;</span></div>
<div style="position:absolute;left:131.56px;top:61.34px" class="cls_060"><span class="cls_060">&lt;input type="text" name="fullname"/&gt;&lt;br/&gt;</span></div>
<div style="position:absolute;left:131.56px;top:81.32px" class="cls_060"><span class="cls_060">&lt;label for="street"&gt;Street: &lt;/label&gt;</span></div>
<div style="position:absolute;left:131.56px;top:91.34px" class="cls_060"><span class="cls_060">&lt;input type="text" name="street"/&gt;&lt;br/&gt;</span></div>
<div style="position:absolute;left:131.56px;top:111.32px" class="cls_060"><span class="cls_060">&lt;label for="city"&gt;City: &lt;/label&gt;</span></div>
<div style="position:absolute;left:131.56px;top:121.34px" class="cls_060"><span class="cls_060">&lt;input type="text" name="city"/&gt;&lt;br/&gt;</span></div>
<div style="position:absolute;left:131.56px;top:141.35px" class="cls_060"><span class="cls_060">&lt;label for="state"&gt;State: &lt;/label&gt;</span></div>
<div style="position:absolute;left:131.56px;top:151.34px" class="cls_060"><span class="cls_060">&lt;input type="text" name="state"/&gt;&lt;br/&gt;</span></div>
<div style="position:absolute;left:131.53px;top:171.35px" class="cls_060"><span class="cls_060">&lt;label for="zip"&gt;Zip: &lt;/label&gt;</span></div>
<div style="position:absolute;left:131.56px;top:181.34px" class="cls_060"><span class="cls_060">&lt;input type="text" name="zip"/&gt;&lt;br/&gt;</span></div>
<div style="position:absolute;left:131.56px;top:201.35px" class="cls_060"><span class="cls_060">&lt;label for="phone"&gt;Phone: &lt;/label&gt;</span></div>
<div style="position:absolute;left:131.56px;top:211.34px" class="cls_060"><span class="cls_060">&lt;input type="text" name="phone"/&gt;&lt;br/&gt;</span></div>
<div style="position:absolute;left:131.56px;top:231.35px" class="cls_060"><span class="cls_060">&lt;input type="submit" value="Register"/&gt;</span></div>
<div style="position:absolute;left:112.38px;top:241.34px" class="cls_060"><span class="cls_060">&lt;/form&gt;</span></div>
<div style="position:absolute;left:102.78px;top:261.35px" class="cls_060"><span class="cls_060">&lt;/body&gt;</span></div>
<div style="position:absolute;left:93.18px;top:271.34px" class="cls_061"><span class="cls_061">&lt;/html&gt;</span></div>
<div style="position:absolute;left:93.18px;top:292.67px" class="cls_039"><span class="cls_039">When the form is submitted, the HTTP POST request will be handled by the</span></div>
<div style="position:absolute;left:93.18px;top:305.66px" class="cls_059"><span class="cls_059">processRegistration()</span><span class="cls_039"> method. The </span><span class="cls_059">RegistrationForm</span><span class="cls_039"> object given to </span><span class="cls_059">process-</span></div>
<div style="position:absolute;left:93.18px;top:318.68px" class="cls_059"><span class="cls_059">Registration()</span><span class="cls_039"> is bound to the request data and is defined with the following class:</span></div>
<div style="position:absolute;left:93.18px;top:338.33px" class="cls_060"><span class="cls_060">package tacos.security;</span></div>
<div style="position:absolute;left:93.18px;top:348.35px" class="cls_060"><span class="cls_060">import org.springframework.security.crypto.password.PasswordEncoder;</span></div>
<div style="position:absolute;left:93.18px;top:358.34px" class="cls_060"><span class="cls_060">import lombok.Data;</span></div>
<div style="position:absolute;left:93.18px;top:368.33px" class="cls_060"><span class="cls_060">import tacos.User;</span></div>
<div style="position:absolute;left:93.18px;top:388.34px" class="cls_060"><span class="cls_060">@Data</span></div>
<div style="position:absolute;left:93.18px;top:398.36px" class="cls_060"><span class="cls_060">public class RegistrationForm {</span></div>
<div style="position:absolute;left:102.77px;top:418.34px" class="cls_060"><span class="cls_060">private String username;</span></div>
<div style="position:absolute;left:102.77px;top:428.36px" class="cls_060"><span class="cls_060">private String password;</span></div>
<div style="position:absolute;left:102.77px;top:438.35px" class="cls_060"><span class="cls_060">private String fullname;</span></div>
<div style="position:absolute;left:102.77px;top:448.34px" class="cls_060"><span class="cls_060">private String street;</span></div>
<div style="position:absolute;left:102.77px;top:458.36px" class="cls_060"><span class="cls_060">private String city;</span></div>
<div style="position:absolute;left:102.77px;top:468.35px" class="cls_060"><span class="cls_060">private String state;</span></div>
<div style="position:absolute;left:102.77px;top:478.34px" class="cls_060"><span class="cls_060">private String zip;</span></div>
<div style="position:absolute;left:102.77px;top:488.36px" class="cls_060"><span class="cls_060">private String phone;</span></div>
<div style="position:absolute;left:102.77px;top:508.34px" class="cls_060"><span class="cls_060">public User toUser(PasswordEncoder passwordEncoder) {</span></div>
<div style="position:absolute;left:112.38px;top:518.36px" class="cls_060"><span class="cls_060">return new User(</span></div>
<div style="position:absolute;left:131.55px;top:528.35px" class="cls_060"><span class="cls_060">username, passwordEncoder.encode(password),</span></div>
<div style="position:absolute;left:131.57px;top:538.34px" class="cls_060"><span class="cls_060">fullname, street, city, state, zip, phone);</span></div>
<div style="position:absolute;left:102.78px;top:548.36px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:568.34px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:82468px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background125.jpg" width="531" height="666"></div>
<div style="position:absolute;left:231.45px;top:24.35px" class="cls_055"><span class="cls_055">Securing web requests</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">103</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">For the most part, </span><span class="cls_059">RegistrationForm</span><span class="cls_039"> is just a basic Lombok-enabled class with a</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">handful of properties. But the </span><span class="cls_059">toUser()</span><span class="cls_039"> method uses those properties to create a new</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_059"><span class="cls_059">User</span><span class="cls_039"> object, which is what </span><span class="cls_059">processRegistration()</span><span class="cls_039"> will save, using the injected </span><span class="cls_059">User-</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_059"><span class="cls_059">Repository</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.88px;top:102.65px" class="cls_039"><span class="cls_039">You’ve no doubt noticed that </span><span class="cls_059">RegistrationController</span><span class="cls_039"> is injected with a </span><span class="cls_059">Pass-</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_059"><span class="cls_059">wordEncoder</span><span class="cls_039">. This is the exact same </span><span class="cls_059">PasswordEncoder</span><span class="cls_039"> bean you declared before.</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">When processing a form submission, </span><span class="cls_059">RegistrationController</span><span class="cls_039"> passes it to the</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_059"><span class="cls_059">toUser()</span><span class="cls_039"> method, which uses it to encode the password before saving it to the data-</span></div>
<div style="position:absolute;left:102.18px;top:154.67px" class="cls_039"><span class="cls_039">base. In this way, the submitted password is written in an encoded form, and the user</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">details service will be able to authenticate against that encoded password.</span></div>
<div style="position:absolute;left:116.45px;top:180.65px" class="cls_039"><span class="cls_039">Now the Taco Cloud application has complete user registration and authentication</span></div>
<div style="position:absolute;left:102.18px;top:193.67px" class="cls_039"><span class="cls_039">support. But if you start it up at this point, you’ll notice that you can’t even get to the</span></div>
<div style="position:absolute;left:102.18px;top:206.66px" class="cls_039"><span class="cls_039">registration page without being prompted to log in. That’s because, by default, all</span></div>
<div style="position:absolute;left:102.18px;top:219.65px" class="cls_039"><span class="cls_039">requests require authentication. Let’s look at how web requests are intercepted and</span></div>
<div style="position:absolute;left:102.18px;top:232.67px" class="cls_039"><span class="cls_039">secured so you can fix this strange chicken-and-egg situation.</span></div>
<div style="position:absolute;left:66.18px;top:253.84px" class="cls_040"><span class="cls_040">4.3</span></div>
<div style="position:absolute;left:102.18px;top:253.84px" class="cls_040"><span class="cls_040">Securing web requests</span></div>
<div style="position:absolute;left:102.18px;top:271.67px" class="cls_039"><span class="cls_039">The security requirements for Taco Cloud should require that a user be authenticated</span></div>
<div style="position:absolute;left:102.18px;top:284.66px" class="cls_039"><span class="cls_039">before designing tacos or placing orders. But the homepage, login page, and registra-</span></div>
<div style="position:absolute;left:102.18px;top:297.68px" class="cls_039"><span class="cls_039">tion page should be available to unauthenticated users.</span></div>
<div style="position:absolute;left:116.85px;top:310.67px" class="cls_039"><span class="cls_039">To configure these security rules, let me introduce you to </span><span class="cls_059">WebSecurityConfigurer-</span></div>
<div style="position:absolute;left:102.27px;top:323.66px" class="cls_059"><span class="cls_059">Adapter</span><span class="cls_039">’s other </span><span class="cls_059">configure()</span><span class="cls_039"> method:</span></div>
<div style="position:absolute;left:102.18px;top:343.34px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:102.18px;top:353.33px" class="cls_060"><span class="cls_060">protected void configure(HttpSecurity http) throws Exception {</span></div>
<div style="position:absolute;left:102.18px;top:373.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:394.67px" class="cls_039"><span class="cls_039">This </span><span class="cls_059">configure()</span><span class="cls_039"> method accepts an </span><span class="cls_059">HttpSecurity</span><span class="cls_039"> object, which can be used to con-</span></div>
<div style="position:absolute;left:102.18px;top:407.66px" class="cls_039"><span class="cls_039">figure how security is handled at the web level. Among the many things you can con-</span></div>
<div style="position:absolute;left:102.18px;top:420.68px" class="cls_039"><span class="cls_039">figure with </span><span class="cls_059">HttpSecurity</span><span class="cls_039"> are these:</span></div>
<div style="position:absolute;left:117.78px;top:437.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Requiring that certain security conditions be met before allowing a request to</span></div>
<div style="position:absolute;left:129.78px;top:450.68px" class="cls_039"><span class="cls_039">be served</span></div>
<div style="position:absolute;left:117.78px;top:464.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Configuring a custom login page</span></div>
<div style="position:absolute;left:117.78px;top:478.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Enabling users to log out of the application</span></div>
<div style="position:absolute;left:117.78px;top:492.68px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Configuring cross-site request forgery protection</span></div>
<div style="position:absolute;left:102.18px;top:510.68px" class="cls_039"><span class="cls_039">Intercepting requests to ensure that the user has proper authority is one of the most</span></div>
<div style="position:absolute;left:102.18px;top:523.67px" class="cls_039"><span class="cls_039">common things you’ll configure </span><span class="cls_059">HttpSecurity</span><span class="cls_039"> to do. Let’s ensure that your Taco</span></div>
<div style="position:absolute;left:102.18px;top:536.66px" class="cls_039"><span class="cls_039">Cloud customers meet those requirements.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:83144px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background126.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">104</span></div>
<div style="position:absolute;left:210.90px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 4</span></div>
<div style="position:absolute;left:255.03px;top:24.35px" class="cls_055"><span class="cls_055">Securing Spring</span></div>
<div style="position:absolute;left:57.18px;top:50.48px" class="cls_063"><span class="cls_063">4.3.1</span></div>
<div style="position:absolute;left:93.18px;top:50.48px" class="cls_063"><span class="cls_063">Securing requests</span></div>
<div style="position:absolute;left:93.18px;top:67.67px" class="cls_039"><span class="cls_039">You need to ensure that requests for /design and /orders are only available to authen-</span></div>
<div style="position:absolute;left:93.18px;top:80.66px" class="cls_039"><span class="cls_039">ticated users; all other requests should be permitted for all users. The following </span><span class="cls_059">con-</span></div>
<div style="position:absolute;left:93.18px;top:93.65px" class="cls_059"><span class="cls_059">figure()</span><span class="cls_039"> implementation does exactly that:</span></div>
<div style="position:absolute;left:93.18px;top:113.33px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:93.18px;top:123.35px" class="cls_060"><span class="cls_060">protected void configure(HttpSecurity http) throws Exception {</span></div>
<div style="position:absolute;left:102.78px;top:133.34px" class="cls_060"><span class="cls_060">http</span></div>
<div style="position:absolute;left:112.38px;top:143.33px" class="cls_060"><span class="cls_060">.authorizeRequests()</span></div>
<div style="position:absolute;left:121.93px;top:153.35px" class="cls_060"><span class="cls_060">.antMatchers("/design", "/orders")</span></div>
<div style="position:absolute;left:131.55px;top:163.34px" class="cls_060"><span class="cls_060">.hasRole("ROLE_USER")</span></div>
<div style="position:absolute;left:121.95px;top:173.33px" class="cls_060"><span class="cls_060">.antMatchers(“/”, "/**").permitAll()</span></div>
<div style="position:absolute;left:112.38px;top:183.35px" class="cls_060"><span class="cls_060">;</span></div>
<div style="position:absolute;left:93.18px;top:193.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:216.65px" class="cls_039"><span class="cls_039">The call to </span><span class="cls_059">authorizeRequests()</span><span class="cls_039"> returns an object (</span><span class="cls_059">ExpressionInterceptUrlRegis-</span></div>
<div style="position:absolute;left:93.18px;top:229.67px" class="cls_059"><span class="cls_059">try</span><span class="cls_039">) on which you can specify URL paths and patterns and the security requirements</span></div>
<div style="position:absolute;left:93.18px;top:242.66px" class="cls_039"><span class="cls_039">for those paths. In this case, you specify two security rules:</span></div>
<div style="position:absolute;left:108.78px;top:259.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Requests for /design and /orders should be for users with a granted authority</span></div>
<div style="position:absolute;left:120.78px;top:272.66px" class="cls_039"><span class="cls_039">of </span><span class="cls_059">ROLE_USER</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:108.78px;top:286.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  All requests should be permitted to all users.</span></div>
<div style="position:absolute;left:93.18px;top:304.67px" class="cls_039"><span class="cls_039">The order of these rules is important. Security rules declared first take precedence</span></div>
<div style="position:absolute;left:93.18px;top:317.66px" class="cls_039"><span class="cls_039">over those declared lower down. If you were to swap the order of those two security</span></div>
<div style="position:absolute;left:93.18px;top:330.68px" class="cls_039"><span class="cls_039">rules, all requests would have </span><span class="cls_059">permitAll()</span><span class="cls_039"> applied to them; the rule for /design and</span></div>
<div style="position:absolute;left:93.18px;top:343.67px" class="cls_039"><span class="cls_039">/orders requests would have no effect.</span></div>
<div style="position:absolute;left:108.93px;top:356.66px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">hasRole()</span><span class="cls_039"> and </span><span class="cls_059">permitAll()</span><span class="cls_039"> methods are just a couple of the methods for</span></div>
<div style="position:absolute;left:93.18px;top:369.68px" class="cls_039"><span class="cls_039">declaring security requirements for request paths. Table 4.1 describes all the avail-</span></div>
<div style="position:absolute;left:93.18px;top:382.67px" class="cls_039"><span class="cls_039">able methods.</span></div>
<div style="position:absolute;left:93.18px;top:405.35px" class="cls_053"><span class="cls_053">Table 4.1</span></div>
<div style="position:absolute;left:134.91px;top:405.35px" class="cls_053"><span class="cls_053">Configuration methods to define how a path is to be secured</span></div>
<div style="position:absolute;left:146.76px;top:426.35px" class="cls_073"><span class="cls_073">Method</span></div>
<div style="position:absolute;left:323.73px;top:426.35px" class="cls_073"><span class="cls_073">What it does</span></div>
<div style="position:absolute;left:99.18px;top:445.34px" class="cls_060"><span class="cls_060">access(String)</span></div>
<div style="position:absolute;left:236.70px;top:445.34px" class="cls_074"><span class="cls_074">Allows access if the given SpEL expression evaluates to </span><span class="cls_060">true</span></div>
<div style="position:absolute;left:99.18px;top:462.35px" class="cls_060"><span class="cls_060">anonymous()</span></div>
<div style="position:absolute;left:236.70px;top:462.35px" class="cls_074"><span class="cls_074">Allows access to anonymous users</span></div>
<div style="position:absolute;left:99.18px;top:479.36px" class="cls_060"><span class="cls_060">authenticated()</span></div>
<div style="position:absolute;left:236.70px;top:479.36px" class="cls_074"><span class="cls_074">Allows access to authenticated users</span></div>
<div style="position:absolute;left:99.18px;top:496.34px" class="cls_060"><span class="cls_060">denyAll()</span></div>
<div style="position:absolute;left:236.70px;top:496.34px" class="cls_074"><span class="cls_074">Denies access unconditionally</span></div>
<div style="position:absolute;left:99.18px;top:513.35px" class="cls_060"><span class="cls_060">fullyAuthenticated()</span></div>
<div style="position:absolute;left:236.70px;top:513.35px" class="cls_074"><span class="cls_074">Allows access if the user is fully authenticated (not remembered)</span></div>
<div style="position:absolute;left:99.18px;top:530.36px" class="cls_060"><span class="cls_060">hasAnyAuthority(String…)</span></div>
<div style="position:absolute;left:236.70px;top:530.36px" class="cls_074"><span class="cls_074">Allows access if the user has any of the given authorities</span></div>
<div style="position:absolute;left:99.18px;top:547.34px" class="cls_060"><span class="cls_060">hasAnyRole(String…)</span></div>
<div style="position:absolute;left:236.70px;top:547.34px" class="cls_074"><span class="cls_074">Allows access if the user has any of the given roles</span></div>
<div style="position:absolute;left:99.18px;top:564.35px" class="cls_060"><span class="cls_060">hasAuthority(String)</span></div>
<div style="position:absolute;left:236.70px;top:564.35px" class="cls_074"><span class="cls_074">Allows access if the user has the given authority</span></div>
<div style="position:absolute;left:99.18px;top:581.36px" class="cls_060"><span class="cls_060">hasIpAddress(String)</span></div>
<div style="position:absolute;left:236.70px;top:581.36px" class="cls_074"><span class="cls_074">Allows access if the request comes from the given IP address</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:83820px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background127.jpg" width="531" height="666"></div>
<div style="position:absolute;left:231.45px;top:24.35px" class="cls_055"><span class="cls_055">Securing web requests</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">105</span></div>
<div style="position:absolute;left:102.18px;top:51.32px" class="cls_053"><span class="cls_053">Table 4.1</span></div>
<div style="position:absolute;left:143.91px;top:51.32px" class="cls_053"><span class="cls_053">Configuration methods to define how a path is to be secured</span><span class="cls_084"> (continued)</span></div>
<div style="position:absolute;left:155.76px;top:72.32px" class="cls_073"><span class="cls_073">Method</span></div>
<div style="position:absolute;left:332.73px;top:72.32px" class="cls_073"><span class="cls_073">What it does</span></div>
<div style="position:absolute;left:108.18px;top:91.34px" class="cls_060"><span class="cls_060">hasRole(String)</span></div>
<div style="position:absolute;left:245.70px;top:91.34px" class="cls_074"><span class="cls_074">Allows access if the user has the given role</span></div>
<div style="position:absolute;left:108.18px;top:108.32px" class="cls_060"><span class="cls_060">not()</span></div>
<div style="position:absolute;left:245.70px;top:108.32px" class="cls_074"><span class="cls_074">Negates the effect of any of the other access methods</span></div>
<div style="position:absolute;left:108.18px;top:125.33px" class="cls_060"><span class="cls_060">permitAll()</span></div>
<div style="position:absolute;left:245.70px;top:125.33px" class="cls_074"><span class="cls_074">Allows access unconditionally</span></div>
<div style="position:absolute;left:108.18px;top:142.34px" class="cls_060"><span class="cls_060">rememberMe()</span></div>
<div style="position:absolute;left:245.70px;top:142.34px" class="cls_074"><span class="cls_074">Allows access for users who are authenticated via remember-me</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">Most of the methods in table 4.1 provide essential security rules for request handling,</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">but they’re self-limiting, only enabling security rules as defined by those methods.</span></div>
<div style="position:absolute;left:102.18px;top:193.67px" class="cls_039"><span class="cls_039">Alternatively, you can use the </span><span class="cls_059">access()</span><span class="cls_039"> method to provide a SpEL expression to</span></div>
<div style="position:absolute;left:102.18px;top:206.66px" class="cls_039"><span class="cls_039">declare richer security rules. Spring Security extends SpEL to include several security-</span></div>
<div style="position:absolute;left:102.18px;top:219.65px" class="cls_039"><span class="cls_039">specific values and functions, as listed in table 4.2.</span></div>
<div style="position:absolute;left:102.18px;top:242.33px" class="cls_053"><span class="cls_053">Table 4.2</span></div>
<div style="position:absolute;left:143.90px;top:242.33px" class="cls_053"><span class="cls_053">Spring Security extensions to the Spring Expression Language</span></div>
<div style="position:absolute;left:134.37px;top:263.33px" class="cls_073"><span class="cls_073">Security expression</span></div>
<div style="position:absolute;left:319.53px;top:263.33px" class="cls_073"><span class="cls_073">What it evaluates to</span></div>
<div style="position:absolute;left:108.18px;top:282.35px" class="cls_060"><span class="cls_060">authentication</span></div>
<div style="position:absolute;left:246.06px;top:282.35px" class="cls_074"><span class="cls_074">The user’s authentication object</span></div>
<div style="position:absolute;left:108.18px;top:299.33px" class="cls_060"><span class="cls_060">denyAll</span></div>
<div style="position:absolute;left:246.06px;top:299.33px" class="cls_074"><span class="cls_074">Always evaluates to </span><span class="cls_060">false</span></div>
<div style="position:absolute;left:108.18px;top:316.34px" class="cls_060"><span class="cls_060">hasAnyRole(list of roles)</span></div>
<div style="position:absolute;left:246.04px;top:316.34px" class="cls_060"><span class="cls_060">true</span><span class="cls_074"> if the user has any of the given roles</span></div>
<div style="position:absolute;left:108.18px;top:333.35px" class="cls_060"><span class="cls_060">hasRole(role)</span></div>
<div style="position:absolute;left:246.05px;top:333.35px" class="cls_060"><span class="cls_060">true</span><span class="cls_074"> if the user has the given role</span></div>
<div style="position:absolute;left:108.18px;top:350.33px" class="cls_060"><span class="cls_060">hasIpAddress(IP address)</span></div>
<div style="position:absolute;left:246.04px;top:350.33px" class="cls_060"><span class="cls_060">true</span><span class="cls_074"> if the request comes from the given IP address</span></div>
<div style="position:absolute;left:108.18px;top:367.34px" class="cls_060"><span class="cls_060">isAnonymous()</span></div>
<div style="position:absolute;left:246.05px;top:367.34px" class="cls_060"><span class="cls_060">true</span><span class="cls_074"> if the user is anonymous</span></div>
<div style="position:absolute;left:108.18px;top:384.35px" class="cls_060"><span class="cls_060">isAuthenticated()</span></div>
<div style="position:absolute;left:246.04px;top:384.35px" class="cls_060"><span class="cls_060">true</span><span class="cls_074"> if the user is authenticated</span></div>
<div style="position:absolute;left:108.18px;top:401.36px" class="cls_060"><span class="cls_060">isFullyAuthenticated()</span></div>
<div style="position:absolute;left:246.05px;top:401.36px" class="cls_060"><span class="cls_060">true</span><span class="cls_074"> if the user is fully authenticated (not authenticated with</span></div>
<div style="position:absolute;left:246.06px;top:411.35px" class="cls_074"><span class="cls_074">remember-me)</span></div>
<div style="position:absolute;left:108.18px;top:428.36px" class="cls_060"><span class="cls_060">isRememberMe()</span></div>
<div style="position:absolute;left:246.05px;top:428.36px" class="cls_060"><span class="cls_060">true</span><span class="cls_074"> if the user was authenticated via remember-me</span></div>
<div style="position:absolute;left:108.18px;top:445.34px" class="cls_060"><span class="cls_060">permitAll</span></div>
<div style="position:absolute;left:246.06px;top:445.34px" class="cls_074"><span class="cls_074">Always evaluates to </span><span class="cls_060">true</span></div>
<div style="position:absolute;left:108.18px;top:462.35px" class="cls_060"><span class="cls_060">principal</span></div>
<div style="position:absolute;left:246.06px;top:462.35px" class="cls_074"><span class="cls_074">The user’s principal object</span></div>
<div style="position:absolute;left:102.18px;top:490.67px" class="cls_039"><span class="cls_039">As you can see, most of the security expression extensions in table 4.2 correspond to</span></div>
<div style="position:absolute;left:102.18px;top:503.66px" class="cls_039"><span class="cls_039">similar methods in table 4.1. In fact, using the </span><span class="cls_059">access()</span><span class="cls_039"> method along with the </span><span class="cls_059">has-</span></div>
<div style="position:absolute;left:102.18px;top:516.68px" class="cls_059"><span class="cls_059">Role()</span><span class="cls_039"> and </span><span class="cls_059">permitAll</span><span class="cls_039"> expressions, you can rewrite </span><span class="cls_059">configure()</span><span class="cls_039"> as follows.</span></div>
<div style="position:absolute;left:114.18px;top:540.41px" class="cls_066"><span class="cls_066">Listing 4.9</span></div>
<div style="position:absolute;left:166.28px;top:540.41px" class="cls_066"><span class="cls_066">Using Spring expressions to define authorization rules</span></div>
<div style="position:absolute;left:102.18px;top:560.24px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:102.18px;top:570.26px" class="cls_060"><span class="cls_060">protected void configure(HttpSecurity http) throws Exception {</span></div>
<div style="position:absolute;left:111.78px;top:580.25px" class="cls_060"><span class="cls_060">http</span></div>
<div style="position:absolute;left:121.38px;top:590.24px" class="cls_060"><span class="cls_060">.authorizeRequests()</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:84496px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background128.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">106</span></div>
<div style="position:absolute;left:210.90px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 4</span></div>
<div style="position:absolute;left:255.03px;top:24.35px" class="cls_055"><span class="cls_055">Securing Spring</span></div>
<div style="position:absolute;left:121.93px;top:51.32px" class="cls_060"><span class="cls_060">.antMatchers("/design", "/orders")</span></div>
<div style="position:absolute;left:131.56px;top:61.34px" class="cls_060"><span class="cls_060">.access("hasRole('ROLE_USER')")</span></div>
<div style="position:absolute;left:121.96px;top:71.33px" class="cls_060"><span class="cls_060">.antMatchers(“/”, "/**").access("permitAll")</span></div>
<div style="position:absolute;left:112.38px;top:81.32px" class="cls_060"><span class="cls_060">;</span></div>
<div style="position:absolute;left:93.18px;top:91.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:112.67px" class="cls_039"><span class="cls_039">This may not seem like a big deal at first. After all, these expressions only mirror what</span></div>
<div style="position:absolute;left:93.18px;top:125.66px" class="cls_039"><span class="cls_039">you already did with method calls. But expressions can be much more flexible. For</span></div>
<div style="position:absolute;left:93.18px;top:138.65px" class="cls_039"><span class="cls_039">instance, suppose that (for some crazy reason) you only wanted to allow users with</span></div>
<div style="position:absolute;left:93.18px;top:151.67px" class="cls_059"><span class="cls_059">ROLE_USER</span><span class="cls_039"> authority to create new tacos on Tuesdays (for example, on Taco Tuesday);</span></div>
<div style="position:absolute;left:93.18px;top:164.66px" class="cls_039"><span class="cls_039">you could rewrite the expression as shown in this modified version of </span><span class="cls_059">configure()</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:186.35px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:93.18px;top:196.34px" class="cls_060"><span class="cls_060">protected void configure(HttpSecurity http) throws Exception {</span></div>
<div style="position:absolute;left:102.78px;top:206.33px" class="cls_060"><span class="cls_060">http</span></div>
<div style="position:absolute;left:112.38px;top:216.35px" class="cls_060"><span class="cls_060">.authorizeRequests()</span></div>
<div style="position:absolute;left:121.93px;top:226.34px" class="cls_060"><span class="cls_060">.antMatchers("/design", "/orders")</span></div>
<div style="position:absolute;left:131.56px;top:236.33px" class="cls_060"><span class="cls_060">.access("hasRole('ROLE_USER') &amp;&amp; " +</span></div>
<div style="position:absolute;left:141.15px;top:246.35px" class="cls_060"><span class="cls_060">"T(java.util.Calendar).getInstance().get("+</span></div>
<div style="position:absolute;left:141.16px;top:256.34px" class="cls_060"><span class="cls_060">"T(java.util.Calendar).DAY_OF_WEEK) == " +</span></div>
<div style="position:absolute;left:141.15px;top:266.33px" class="cls_060"><span class="cls_060">"T(java.util.Calendar).TUESDAY")</span></div>
<div style="position:absolute;left:121.95px;top:276.35px" class="cls_060"><span class="cls_060">.antMatchers(“/”, "/**").access("permitAll")</span></div>
<div style="position:absolute;left:112.38px;top:286.34px" class="cls_060"><span class="cls_060">;</span></div>
<div style="position:absolute;left:93.18px;top:296.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:319.67px" class="cls_039"><span class="cls_039">With SpEL-based security constraints, the possibilities are virtually endless. I’ll bet that</span></div>
<div style="position:absolute;left:93.18px;top:332.66px" class="cls_039"><span class="cls_039">you’re already dreaming up interesting security constraints based on SpEL.</span></div>
<div style="position:absolute;left:107.78px;top:345.68px" class="cls_039"><span class="cls_039">The authorization needs for the Taco Cloud application are met by the simple use</span></div>
<div style="position:absolute;left:93.18px;top:358.67px" class="cls_039"><span class="cls_039">of </span><span class="cls_059">access()</span><span class="cls_039"> and the SpEL expressions in listing 4.9. Now let’s see about customizing</span></div>
<div style="position:absolute;left:93.18px;top:371.66px" class="cls_039"><span class="cls_039">the login page to fit the look of the Taco Cloud application.</span></div>
<div style="position:absolute;left:57.18px;top:397.49px" class="cls_063"><span class="cls_063">4.3.2</span></div>
<div style="position:absolute;left:93.18px;top:397.49px" class="cls_063"><span class="cls_063">Creating a custom login page</span></div>
<div style="position:absolute;left:93.18px;top:415.16px" class="cls_039"><span class="cls_039">The default login page is much better than the clunky HTTP basic dialog box you</span></div>
<div style="position:absolute;left:93.18px;top:428.18px" class="cls_039"><span class="cls_039">started with, but it’s still rather plain and doesn’t quite fit into the look of the rest of</span></div>
<div style="position:absolute;left:93.18px;top:441.17px" class="cls_039"><span class="cls_039">the Taco Cloud application.</span></div>
<div style="position:absolute;left:108.11px;top:454.16px" class="cls_039"><span class="cls_039">To replace the built-in login page, you first need to tell Spring Security what path</span></div>
<div style="position:absolute;left:93.18px;top:467.18px" class="cls_039"><span class="cls_039">your custom login page will be at. That can be done by calling </span><span class="cls_059">formLogin()</span><span class="cls_039"> on the</span></div>
<div style="position:absolute;left:93.18px;top:480.17px" class="cls_059"><span class="cls_059">HttpSecurity</span><span class="cls_039"> object passed into </span><span class="cls_059">configure()</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:501.86px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:93.18px;top:511.85px" class="cls_060"><span class="cls_060">protected void configure(HttpSecurity http) throws Exception {</span></div>
<div style="position:absolute;left:102.78px;top:521.84px" class="cls_060"><span class="cls_060">http</span></div>
<div style="position:absolute;left:112.38px;top:531.86px" class="cls_060"><span class="cls_060">.authorizeRequests()</span></div>
<div style="position:absolute;left:121.93px;top:541.85px" class="cls_060"><span class="cls_060">.antMatchers("/design", "/orders")</span></div>
<div style="position:absolute;left:131.55px;top:551.84px" class="cls_060"><span class="cls_060">.access("hasRole('ROLE_USER')")</span></div>
<div style="position:absolute;left:121.95px;top:561.86px" class="cls_060"><span class="cls_060">.antMatchers(“/”, "/**").access("permitAll")</span></div>
<div style="position:absolute;left:112.38px;top:581.84px" class="cls_060"><span class="cls_060">.and()</span></div>
<div style="position:absolute;left:121.95px;top:591.86px" class="cls_060"><span class="cls_060">.formLogin()</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:85172px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background129.jpg" width="531" height="666"></div>
<div style="position:absolute;left:231.45px;top:24.35px" class="cls_055"><span class="cls_055">Securing web requests</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">107</span></div>
<div style="position:absolute;left:140.55px;top:51.32px" class="cls_060"><span class="cls_060">.loginPage("/login")</span></div>
<div style="position:absolute;left:121.38px;top:61.34px" class="cls_060"><span class="cls_060">;</span></div>
<div style="position:absolute;left:102.18px;top:71.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:92.66px" class="cls_039"><span class="cls_039">Notice that before you call </span><span class="cls_059">formLogin()</span><span class="cls_039">, you bridge this section of configuration</span></div>
<div style="position:absolute;left:102.18px;top:105.65px" class="cls_039"><span class="cls_039">and the previous section with a call to </span><span class="cls_059">and()</span><span class="cls_039">. The </span><span class="cls_059">and()</span><span class="cls_039"> method signifies that you’re</span></div>
<div style="position:absolute;left:102.18px;top:118.67px" class="cls_039"><span class="cls_039">finished with the authorization configuration and are ready to apply some addi-</span></div>
<div style="position:absolute;left:102.18px;top:131.66px" class="cls_039"><span class="cls_039">tional HTTP configuration. You’ll use </span><span class="cls_059">and()</span><span class="cls_039"> several times as you begin new sections</span></div>
<div style="position:absolute;left:102.18px;top:144.65px" class="cls_039"><span class="cls_039">of configuration.</span></div>
<div style="position:absolute;left:118.67px;top:157.67px" class="cls_039"><span class="cls_039">After the bridge, you call </span><span class="cls_059">formLogin()</span><span class="cls_039"> to start configuring your custom login</span></div>
<div style="position:absolute;left:102.18px;top:170.66px" class="cls_039"><span class="cls_039">form. The call to </span><span class="cls_059">loginPage()</span><span class="cls_039"> after that designates the path where your custom login</span></div>
<div style="position:absolute;left:102.18px;top:183.65px" class="cls_039"><span class="cls_039">page will be provided. When Spring Security determines that the user is unauthenti-</span></div>
<div style="position:absolute;left:102.18px;top:196.67px" class="cls_039"><span class="cls_039">cated and needs to log in, it will redirect them to this path.</span></div>
<div style="position:absolute;left:117.25px;top:209.66px" class="cls_039"><span class="cls_039">Now you need to provide a controller that handles requests at that path. Because</span></div>
<div style="position:absolute;left:102.18px;top:222.65px" class="cls_039"><span class="cls_039">your login page will be fairly simple—nothing but a view—it’s easy enough to declare</span></div>
<div style="position:absolute;left:102.18px;top:235.67px" class="cls_039"><span class="cls_039">it as a view controller in </span><span class="cls_059">WebConfig</span><span class="cls_039">. The following </span><span class="cls_059">addViewControllers()</span><span class="cls_039"> method</span></div>
<div style="position:absolute;left:102.18px;top:248.66px" class="cls_039"><span class="cls_039">sets up the login page view controller alongside the view controller that maps </span><span class="cls_059">"/"</span><span class="cls_039"> to</span></div>
<div style="position:absolute;left:102.18px;top:261.65px" class="cls_039"><span class="cls_039">the home controller:</span></div>
<div style="position:absolute;left:102.18px;top:281.33px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:102.18px;top:291.35px" class="cls_060"><span class="cls_060">public void addViewControllers(ViewControllerRegistry registry) {</span></div>
<div style="position:absolute;left:111.78px;top:301.34px" class="cls_060"><span class="cls_060">registry.addViewController("/").setViewName("home");</span></div>
<div style="position:absolute;left:111.78px;top:311.33px" class="cls_060"><span class="cls_060">registry.addViewController("/login");</span></div>
<div style="position:absolute;left:102.18px;top:321.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:342.68px" class="cls_039"><span class="cls_039">Finally, you need to define the login page view itself. Because you’re using Thymeleaf</span></div>
<div style="position:absolute;left:102.18px;top:355.67px" class="cls_039"><span class="cls_039">as your template engine, the following Thymeleaf template should do fine:</span></div>
<div style="position:absolute;left:102.18px;top:375.35px" class="cls_060"><span class="cls_060">&lt;!DOCTYPE html&gt;</span></div>
<div style="position:absolute;left:102.18px;top:385.34px" class="cls_060"><span class="cls_060">&lt;html xmlns="</span><a href="http://www.w3.org/1999/xhtml" "="">http://www.w3.org/1999/xhtml"</a> </div>
<div style="position:absolute;left:130.95px;top:395.36px" class="cls_060"><span class="cls_060">xmlns:th="</span><a href="http://www.thymeleaf.org/" "="">http://www.thymeleaf.org"</a>&gt;</div>
<div style="position:absolute;left:111.78px;top:405.35px" class="cls_060"><span class="cls_060">&lt;head&gt;</span></div>
<div style="position:absolute;left:121.38px;top:415.34px" class="cls_060"><span class="cls_060">&lt;title&gt;Taco Cloud&lt;/title&gt;</span></div>
<div style="position:absolute;left:111.78px;top:425.36px" class="cls_060"><span class="cls_060">&lt;/head&gt;</span></div>
<div style="position:absolute;left:111.78px;top:445.34px" class="cls_060"><span class="cls_060">&lt;body&gt;</span></div>
<div style="position:absolute;left:121.38px;top:455.36px" class="cls_060"><span class="cls_060">&lt;h1&gt;Login&lt;/h1&gt;</span></div>
<div style="position:absolute;left:121.38px;top:465.35px" class="cls_060"><span class="cls_060">&lt;img th:src="@{/images/TacoCloud.png}"/&gt;</span></div>
<div style="position:absolute;left:121.38px;top:485.36px" class="cls_060"><span class="cls_060">&lt;div th:if="${error}"&gt;</span></div>
<div style="position:absolute;left:130.97px;top:495.35px" class="cls_060"><span class="cls_060">Unable to login. Check your username and password.</span></div>
<div style="position:absolute;left:121.38px;top:505.34px" class="cls_060"><span class="cls_060">&lt;/div&gt;</span></div>
<div style="position:absolute;left:121.38px;top:525.35px" class="cls_060"><span class="cls_060">&lt;p&gt;New here? Click</span></div>
<div style="position:absolute;left:135.74px;top:535.34px" class="cls_060"><span class="cls_060">&lt;a th:href="@{/register}"&gt;here&lt;/a&gt; to register.&lt;/p&gt;</span></div>
<div style="position:absolute;left:121.38px;top:555.35px" class="cls_060"><span class="cls_060">&lt;!-- tag::thAction[] --&gt;</span></div>
<div style="position:absolute;left:121.38px;top:565.34px" class="cls_060"><span class="cls_060">&lt;form method="POST" th:action="@{/login}" id="loginForm"&gt;</span></div>
<div style="position:absolute;left:121.38px;top:575.36px" class="cls_060"><span class="cls_060">&lt;!-- end::thAction[] --&gt;</span></div>
<div style="position:absolute;left:130.96px;top:585.35px" class="cls_060"><span class="cls_060">&lt;label for="username"&gt;Username: &lt;/label&gt;</span></div>
<div style="position:absolute;left:130.96px;top:595.34px" class="cls_060"><span class="cls_060">&lt;input type="text" name="username" id="username" /&gt;&lt;br/&gt;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:85848px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background130.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">108</span></div>
<div style="position:absolute;left:210.90px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 4</span></div>
<div style="position:absolute;left:255.03px;top:24.35px" class="cls_055"><span class="cls_055">Securing Spring</span></div>
<div style="position:absolute;left:121.96px;top:51.32px" class="cls_060"><span class="cls_060">&lt;label for="password"&gt;Password: &lt;/label&gt;</span></div>
<div style="position:absolute;left:121.96px;top:61.34px" class="cls_060"><span class="cls_060">&lt;input type="password" name="password" id="password" /&gt;&lt;br/&gt;</span></div>
<div style="position:absolute;left:121.96px;top:81.32px" class="cls_060"><span class="cls_060">&lt;input type="submit" value="Login"/&gt;</span></div>
<div style="position:absolute;left:112.38px;top:91.34px" class="cls_060"><span class="cls_060">&lt;/form&gt;</span></div>
<div style="position:absolute;left:102.78px;top:101.33px" class="cls_060"><span class="cls_060">&lt;/body&gt;</span></div>
<div style="position:absolute;left:93.18px;top:111.32px" class="cls_061"><span class="cls_061">&lt;/html&gt;</span></div>
<div style="position:absolute;left:93.18px;top:132.65px" class="cls_039"><span class="cls_039">The key things to note about this login page are the path it posts to and the names of</span></div>
<div style="position:absolute;left:93.18px;top:145.67px" class="cls_039"><span class="cls_039">the username and password fields. By default, Spring Security listens for login</span></div>
<div style="position:absolute;left:93.18px;top:158.66px" class="cls_039"><span class="cls_039">requests at /login and expects that the username and password fields be named </span><span class="cls_059">user-</span></div>
<div style="position:absolute;left:93.18px;top:171.65px" class="cls_059"><span class="cls_059">name</span><span class="cls_039"> and </span><span class="cls_059">password</span><span class="cls_039">. This is configurable, however. For example, the following config-</span></div>
<div style="position:absolute;left:93.18px;top:184.67px" class="cls_039"><span class="cls_039">uration customizes the path and field names:</span></div>
<div style="position:absolute;left:93.18px;top:204.35px" class="cls_060"><span class="cls_060">.and()</span></div>
<div style="position:absolute;left:102.78px;top:214.34px" class="cls_060"><span class="cls_060">.formLogin()</span></div>
<div style="position:absolute;left:112.38px;top:224.33px" class="cls_060"><span class="cls_060">.loginPage("/login")</span></div>
<div style="position:absolute;left:112.38px;top:234.35px" class="cls_060"><span class="cls_060">.loginProcessingUrl("/authenticate")</span></div>
<div style="position:absolute;left:112.38px;top:244.34px" class="cls_060"><span class="cls_060">.usernameParameter("user")</span></div>
<div style="position:absolute;left:112.38px;top:254.33px" class="cls_061"><span class="cls_061">.passwordParameter("pwd")</span></div>
<div style="position:absolute;left:93.18px;top:275.66px" class="cls_039"><span class="cls_039">Here, you specify that Spring Security should listen for requests to /authenticate to</span></div>
<div style="position:absolute;left:93.18px;top:288.65px" class="cls_039"><span class="cls_039">handle login submissions. Also, the username and password fields should now be</span></div>
<div style="position:absolute;left:93.18px;top:301.67px" class="cls_039"><span class="cls_039">named </span><span class="cls_059">user</span><span class="cls_039"> and </span><span class="cls_059">pwd</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:108.23px;top:314.66px" class="cls_039"><span class="cls_039">By default, a successful login will take the user directly to the page that they were</span></div>
<div style="position:absolute;left:93.18px;top:327.68px" class="cls_039"><span class="cls_039">navigating to when Spring Security determined that they needed to log in. If the user</span></div>
<div style="position:absolute;left:93.18px;top:340.67px" class="cls_039"><span class="cls_039">were to directly navigate to the login page, a successful login would take them to the</span></div>
<div style="position:absolute;left:93.18px;top:353.66px" class="cls_039"><span class="cls_039">root path (for example, the homepage). But you can change that by specifying a</span></div>
<div style="position:absolute;left:93.18px;top:366.68px" class="cls_039"><span class="cls_039">default success page:</span></div>
<div style="position:absolute;left:93.18px;top:386.36px" class="cls_060"><span class="cls_060">.and()</span></div>
<div style="position:absolute;left:102.78px;top:396.35px" class="cls_060"><span class="cls_060">.formLogin()</span></div>
<div style="position:absolute;left:112.38px;top:406.34px" class="cls_060"><span class="cls_060">.loginPage("/login")</span></div>
<div style="position:absolute;left:112.38px;top:416.36px" class="cls_061"><span class="cls_061">.defaultSuccessUrl("/design")</span></div>
<div style="position:absolute;left:93.18px;top:437.66px" class="cls_039"><span class="cls_039">As configured here, if the user were to successfully log in after directly going to the</span></div>
<div style="position:absolute;left:93.18px;top:450.68px" class="cls_039"><span class="cls_039">login page, they would be directed to the /design page.</span></div>
<div style="position:absolute;left:107.86px;top:463.67px" class="cls_039"><span class="cls_039">Optionally, you can force the user to the design page after login, even if they were</span></div>
<div style="position:absolute;left:93.18px;top:476.66px" class="cls_039"><span class="cls_039">navigating elsewhere prior to logging in, by passing </span><span class="cls_059">true</span><span class="cls_039"> as a second parameter to</span></div>
<div style="position:absolute;left:93.18px;top:489.68px" class="cls_059"><span class="cls_059">defaultSuccessUrl</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:509.36px" class="cls_060"><span class="cls_060">.and()</span></div>
<div style="position:absolute;left:102.78px;top:519.35px" class="cls_060"><span class="cls_060">.formLogin()</span></div>
<div style="position:absolute;left:112.38px;top:529.34px" class="cls_060"><span class="cls_060">.loginPage("/login")</span></div>
<div style="position:absolute;left:112.38px;top:539.36px" class="cls_061"><span class="cls_061">.defaultSuccessUrl("/design", true)</span></div>
<div style="position:absolute;left:93.18px;top:560.69px" class="cls_039"><span class="cls_039">Now that you’ve dealt with your custom login page, let’s flip to the other side of the</span></div>
<div style="position:absolute;left:93.18px;top:573.68px" class="cls_039"><span class="cls_039">authentication coin and see how you can enable a user to log out.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:86524px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background131.jpg" width="531" height="666"></div>
<div style="position:absolute;left:231.45px;top:24.35px" class="cls_055"><span class="cls_055">Securing web requests</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">109</span></div>
<div style="position:absolute;left:66.18px;top:50.48px" class="cls_063"><span class="cls_063">4.3.3</span></div>
<div style="position:absolute;left:102.18px;top:50.48px" class="cls_063"><span class="cls_063">Logging out</span></div>
<div style="position:absolute;left:102.18px;top:67.67px" class="cls_039"><span class="cls_039">Just as important as logging into an application is logging out. To enable logout, you</span></div>
<div style="position:absolute;left:102.18px;top:80.66px" class="cls_039"><span class="cls_039">simply need to call </span><span class="cls_059">logout</span><span class="cls_039"> on the </span><span class="cls_059">HttpSecurity</span><span class="cls_039"> object:</span></div>
<div style="position:absolute;left:102.18px;top:102.32px" class="cls_060"><span class="cls_060">.and()</span></div>
<div style="position:absolute;left:111.78px;top:112.34px" class="cls_060"><span class="cls_060">.logout()</span></div>
<div style="position:absolute;left:121.38px;top:122.33px" class="cls_061"><span class="cls_061">.logoutSuccessUrl("/")</span></div>
<div style="position:absolute;left:102.18px;top:145.67px" class="cls_039"><span class="cls_039">This sets up a security filter that intercepts POST requests to /logout. Therefore, to</span></div>
<div style="position:absolute;left:102.18px;top:158.66px" class="cls_039"><span class="cls_039">provide logout capability, you just need to add a logout form and button to the views</span></div>
<div style="position:absolute;left:102.18px;top:171.65px" class="cls_039"><span class="cls_039">in your application:</span></div>
<div style="position:absolute;left:102.18px;top:193.34px" class="cls_060"><span class="cls_060">&lt;form method="POST" th:action="@{/logout}"&gt;</span></div>
<div style="position:absolute;left:111.78px;top:203.33px" class="cls_060"><span class="cls_060">&lt;input type="submit" value="Logout"/&gt;</span></div>
<div style="position:absolute;left:102.18px;top:213.35px" class="cls_061"><span class="cls_061">&lt;/form&gt;</span></div>
<div style="position:absolute;left:102.18px;top:236.66px" class="cls_039"><span class="cls_039">When the user clicks the button, their session will be cleared, and they will be logged</span></div>
<div style="position:absolute;left:102.18px;top:249.65px" class="cls_039"><span class="cls_039">out of the application. By default, they’ll be redirected to the login page where they</span></div>
<div style="position:absolute;left:102.18px;top:262.67px" class="cls_039"><span class="cls_039">can log in again. But if you’d rather they be sent to a different page, you can call</span></div>
<div style="position:absolute;left:102.18px;top:275.66px" class="cls_059"><span class="cls_059">logoutSucessFilter()</span><span class="cls_039"> to specify a different post-logout landing page:</span></div>
<div style="position:absolute;left:102.18px;top:297.35px" class="cls_060"><span class="cls_060">.and()</span></div>
<div style="position:absolute;left:111.78px;top:307.34px" class="cls_060"><span class="cls_060">.logout()</span></div>
<div style="position:absolute;left:121.38px;top:317.33px" class="cls_061"><span class="cls_061">.logoutSuccessUrl("/")</span></div>
<div style="position:absolute;left:102.18px;top:340.67px" class="cls_039"><span class="cls_039">In this case, users will be sent to the homepage following logout.</span></div>
<div style="position:absolute;left:66.18px;top:362.48px" class="cls_063"><span class="cls_063">4.3.4</span></div>
<div style="position:absolute;left:102.18px;top:362.48px" class="cls_063"><span class="cls_063">Preventing cross-site request forgery</span></div>
<div style="position:absolute;left:102.18px;top:379.67px" class="cls_039"><span class="cls_039">Cross-site request forgery (CSRF) is a common security attack. It involves subjecting a</span></div>
<div style="position:absolute;left:102.18px;top:392.66px" class="cls_039"><span class="cls_039">user to code on a maliciously designed web page that automatically (and usually</span></div>
<div style="position:absolute;left:102.18px;top:405.68px" class="cls_039"><span class="cls_039">secretly) submits a form to another application on behalf of a user who is often the</span></div>
<div style="position:absolute;left:102.18px;top:418.67px" class="cls_039"><span class="cls_039">victim of the attack. For example, a user may be presented with a form on an</span></div>
<div style="position:absolute;left:102.18px;top:431.66px" class="cls_039"><span class="cls_039">attacker’s website that automatically posts to a URL on the user’s banking website</span></div>
<div style="position:absolute;left:102.18px;top:444.68px" class="cls_039"><span class="cls_039">(which is presumably poorly designed and vulnerable to such an attack) to transfer</span></div>
<div style="position:absolute;left:102.18px;top:457.67px" class="cls_039"><span class="cls_039">money. The user may not even know that the attack happened until they notice</span></div>
<div style="position:absolute;left:102.18px;top:470.66px" class="cls_039"><span class="cls_039">money missing from their account.</span></div>
<div style="position:absolute;left:116.97px;top:483.68px" class="cls_039"><span class="cls_039">To protect against such attacks, applications can generate a CSRF token upon dis-</span></div>
<div style="position:absolute;left:102.18px;top:496.67px" class="cls_039"><span class="cls_039">playing a form, place that token in a hidden field, and then stow it for later use on the</span></div>
<div style="position:absolute;left:102.18px;top:509.66px" class="cls_039"><span class="cls_039">server. When the form is submitted, the token is sent back to the server along with the</span></div>
<div style="position:absolute;left:102.18px;top:522.68px" class="cls_039"><span class="cls_039">rest of the form data. The request is then intercepted by the server and compared</span></div>
<div style="position:absolute;left:102.18px;top:535.67px" class="cls_039"><span class="cls_039">with the token that was originally generated. If the token matches, the request is</span></div>
<div style="position:absolute;left:102.18px;top:548.69px" class="cls_039"><span class="cls_039">allowed to proceed. Otherwise, the form must have been rendered by an evil website</span></div>
<div style="position:absolute;left:102.18px;top:561.68px" class="cls_039"><span class="cls_039">without knowledge of the token generated by the server.</span></div>
<div style="position:absolute;left:117.25px;top:574.67px" class="cls_039"><span class="cls_039">Fortunately, Spring Security has built-in CSRF protection. Even more fortunate is</span></div>
<div style="position:absolute;left:102.18px;top:587.69px" class="cls_039"><span class="cls_039">that it’s enabled by default and you don’t need to explicitly configure it. You only</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:87200px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background132.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">110</span></div>
<div style="position:absolute;left:210.90px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 4</span></div>
<div style="position:absolute;left:255.03px;top:24.35px" class="cls_055"><span class="cls_055">Securing Spring</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">need to make sure that any forms your application submits include a field named</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_059"><span class="cls_059">_csrf</span><span class="cls_039"> that contains the CSRF token.</span></div>
<div style="position:absolute;left:108.04px;top:76.67px" class="cls_039"><span class="cls_039">Spring Security even makes that easy by placing the CSRF token in a request attri-</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">bute with the name </span><span class="cls_059">_csrf</span><span class="cls_039">. Therefore, you could render the CSRF token in a hidden</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">field with the following in a Thymeleaf template:</span></div>
<div style="position:absolute;left:93.18px;top:125.33px" class="cls_061"><span class="cls_061">&lt;input type="hidden" name="_csrf" th:value="${_csrf.token}"/&gt;</span></div>
<div style="position:absolute;left:93.18px;top:145.67px" class="cls_039"><span class="cls_039">If you’re using Spring MVC’s JSP tag library or Thymeleaf with the Spring Security dia-</span></div>
<div style="position:absolute;left:93.18px;top:158.66px" class="cls_039"><span class="cls_039">lect, you needn’t even bother explicitly including a hidden field. The hidden field will</span></div>
<div style="position:absolute;left:93.18px;top:171.65px" class="cls_039"><span class="cls_039">be rendered automatically for you.</span></div>
<div style="position:absolute;left:108.10px;top:184.67px" class="cls_039"><span class="cls_039">In Thymeleaf, you just need to make sure that one of the attributes of the </span><span class="cls_059">&lt;form&gt;</span></div>
<div style="position:absolute;left:93.18px;top:197.66px" class="cls_039"><span class="cls_039">element is prefixed as a Thymeleaf attribute. That’s usually not a concern, as it’s quite</span></div>
<div style="position:absolute;left:93.18px;top:210.65px" class="cls_039"><span class="cls_039">common to let Thymeleaf render the path as context relative. For example, the</span></div>
<div style="position:absolute;left:93.18px;top:223.67px" class="cls_059"><span class="cls_059">th:action</span><span class="cls_039"> attribute is all you need for Thymeleaf to render the hidden field for you:</span></div>
<div style="position:absolute;left:93.18px;top:246.35px" class="cls_061"><span class="cls_061">&lt;form method="POST" th:action="@{/login}" id="loginForm"&gt;</span></div>
<div style="position:absolute;left:93.18px;top:266.66px" class="cls_039"><span class="cls_039">It’s possible to disable CSRF support, but I’m hesitant to show you how. CSRF protec-</span></div>
<div style="position:absolute;left:93.18px;top:279.65px" class="cls_039"><span class="cls_039">tion is important and easily handled in forms, so there’s little reason to disable it. But</span></div>
<div style="position:absolute;left:93.18px;top:292.67px" class="cls_039"><span class="cls_039">if you insist on disabling it, you can do so by calling </span><span class="cls_059">disable()</span><span class="cls_039"> like this:</span></div>
<div style="position:absolute;left:93.18px;top:312.35px" class="cls_060"><span class="cls_060">.and()</span></div>
<div style="position:absolute;left:102.78px;top:322.34px" class="cls_060"><span class="cls_060">.csrf()</span></div>
<div style="position:absolute;left:112.38px;top:332.33px" class="cls_061"><span class="cls_061">.disable()</span></div>
<div style="position:absolute;left:93.18px;top:353.66px" class="cls_039"><span class="cls_039">Again, I caution you not to disable CSRF protection, especially for production</span></div>
<div style="position:absolute;left:93.18px;top:366.68px" class="cls_039"><span class="cls_039">applications.</span></div>
<div style="position:absolute;left:109.22px;top:379.67px" class="cls_039"><span class="cls_039">All of your web layer security is now configured for Taco Cloud. Among other</span></div>
<div style="position:absolute;left:93.18px;top:392.66px" class="cls_039"><span class="cls_039">things, you now have a custom login page and the ability to authenticate users against</span></div>
<div style="position:absolute;left:93.18px;top:405.68px" class="cls_039"><span class="cls_039">a JPA-backed user repository. Now let’s see how you can obtain information about the</span></div>
<div style="position:absolute;left:93.18px;top:418.67px" class="cls_039"><span class="cls_039">logged-in user.</span></div>
<div style="position:absolute;left:57.18px;top:439.84px" class="cls_040"><span class="cls_040">4.4</span></div>
<div style="position:absolute;left:93.18px;top:439.84px" class="cls_040"><span class="cls_040">Knowing your user</span></div>
<div style="position:absolute;left:93.18px;top:457.67px" class="cls_039"><span class="cls_039">Often, it’s not enough to simply know that the user has logged in. It’s usually import-</span></div>
<div style="position:absolute;left:93.18px;top:470.66px" class="cls_039"><span class="cls_039">ant to also know who they are, so that you can tailor their experience.</span></div>
<div style="position:absolute;left:107.61px;top:483.68px" class="cls_039"><span class="cls_039">For example, in </span><span class="cls_059">OrderController</span><span class="cls_039">, when you initially create the </span><span class="cls_059">Order</span><span class="cls_039"> object that’s</span></div>
<div style="position:absolute;left:93.18px;top:496.67px" class="cls_039"><span class="cls_039">bound to the order form, it’d be nice if you could prepopulate the </span><span class="cls_059">Order</span><span class="cls_039"> with the</span></div>
<div style="position:absolute;left:93.18px;top:509.66px" class="cls_039"><span class="cls_039">user’s name and address, so they don’t have to reenter it for each order. Perhaps even</span></div>
<div style="position:absolute;left:93.18px;top:522.68px" class="cls_039"><span class="cls_039">more important, when you save their order, you should associate the </span><span class="cls_059">Order</span><span class="cls_039"> entity with</span></div>
<div style="position:absolute;left:93.18px;top:535.67px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">User</span><span class="cls_039"> that created the order.</span></div>
<div style="position:absolute;left:107.92px;top:548.69px" class="cls_039"><span class="cls_039">To achieve the desired connection between an </span><span class="cls_059">Order</span><span class="cls_039"> entity and a </span><span class="cls_059">User</span><span class="cls_039"> entity, you</span></div>
<div style="position:absolute;left:93.18px;top:561.68px" class="cls_039"><span class="cls_039">need to add a new property to the </span><span class="cls_059">Order</span><span class="cls_039"> class:</span></div>
<div style="position:absolute;left:93.18px;top:581.36px" class="cls_060"><span class="cls_060">@Data</span></div>
<div style="position:absolute;left:93.18px;top:591.35px" class="cls_060"><span class="cls_060">@Entity</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:87876px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background133.jpg" width="531" height="666"></div>
<div style="position:absolute;left:236.67px;top:24.35px" class="cls_055"><span class="cls_055">Knowing your user</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">111</span></div>
<div style="position:absolute;left:102.18px;top:51.32px" class="cls_060"><span class="cls_060">@Table(name="Taco_Order")</span></div>
<div style="position:absolute;left:102.18px;top:61.34px" class="cls_060"><span class="cls_060">public class Order implements Serializable {</span></div>
<div style="position:absolute;left:111.78px;top:101.33px" class="cls_060"><span class="cls_060">@ManyToOne</span></div>
<div style="position:absolute;left:111.78px;top:111.32px" class="cls_060"><span class="cls_060">private User user;</span></div>
<div style="position:absolute;left:102.18px;top:151.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:174.65px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">@ManyToOne</span><span class="cls_039"> annotation on this property indicates that an order belongs to a sin-</span></div>
<div style="position:absolute;left:102.18px;top:187.67px" class="cls_039"><span class="cls_039">gle user, and, conversely, that a user may have many orders. (Because you’re using</span></div>
<div style="position:absolute;left:102.18px;top:200.66px" class="cls_039"><span class="cls_039">Lombok, you won’t need to explicitly define accessor methods for the property.)</span></div>
<div style="position:absolute;left:118.65px;top:213.65px" class="cls_039"><span class="cls_039">In </span><span class="cls_059">OrderController</span><span class="cls_039">, the </span><span class="cls_059">processOrder()</span><span class="cls_039"> method is responsible for saving an</span></div>
<div style="position:absolute;left:102.18px;top:226.67px" class="cls_039"><span class="cls_039">order. It will need to be modified to determine who the authenticated user is and to</span></div>
<div style="position:absolute;left:102.18px;top:239.66px" class="cls_039"><span class="cls_039">call </span><span class="cls_059">setUser()</span><span class="cls_039"> on the </span><span class="cls_059">Order</span><span class="cls_039"> object to connect the order with the user.</span></div>
<div style="position:absolute;left:117.37px;top:252.65px" class="cls_039"><span class="cls_039">There are several ways to determine who the user is. These are a few of the most</span></div>
<div style="position:absolute;left:102.18px;top:265.67px" class="cls_039"><span class="cls_039">common ways:</span></div>
<div style="position:absolute;left:117.78px;top:284.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Inject a </span><span class="cls_059">Principal</span><span class="cls_039"> object into the controller method</span></div>
<div style="position:absolute;left:117.78px;top:298.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Inject an </span><span class="cls_059">Authentication</span><span class="cls_039"> object into the controller method</span></div>
<div style="position:absolute;left:117.78px;top:312.68px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Use </span><span class="cls_059">SecurityContextHolder</span><span class="cls_039"> to get at the security context</span></div>
<div style="position:absolute;left:117.78px;top:326.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Use an </span><span class="cls_059">@AuthenticationPrincipal</span><span class="cls_039"> annotated method</span></div>
<div style="position:absolute;left:102.18px;top:346.67px" class="cls_039"><span class="cls_039">For example, you could modify </span><span class="cls_059">processOrder()</span><span class="cls_039"> to accept a </span><span class="cls_059">java.security.Principal</span></div>
<div style="position:absolute;left:102.18px;top:359.66px" class="cls_039"><span class="cls_039">as a parameter. You could then use the principal name to look up the user from a</span></div>
<div style="position:absolute;left:102.18px;top:372.68px" class="cls_059"><span class="cls_059">UserRepository</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:102.18px;top:394.34px" class="cls_060"><span class="cls_060">@PostMapping</span></div>
<div style="position:absolute;left:102.18px;top:404.36px" class="cls_060"><span class="cls_060">public String processOrder(@Valid Order order, Errors errors,</span></div>
<div style="position:absolute;left:121.35px;top:414.35px" class="cls_060"><span class="cls_060">SessionStatus sessionStatus,</span></div>
<div style="position:absolute;left:121.38px;top:424.34px" class="cls_060"><span class="cls_060">Principal principal) {</span></div>
<div style="position:absolute;left:111.78px;top:464.36px" class="cls_060"><span class="cls_060">User user = userRepository.findByUsername(</span></div>
<div style="position:absolute;left:150.15px;top:474.35px" class="cls_060"><span class="cls_060">principal.getName());</span></div>
<div style="position:absolute;left:111.78px;top:494.36px" class="cls_060"><span class="cls_060">order.setUser(user);</span></div>
<div style="position:absolute;left:102.18px;top:534.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:557.69px" class="cls_039"><span class="cls_039">This works fine, but it litters code that’s otherwise unrelated to security with security</span></div>
<div style="position:absolute;left:102.18px;top:570.68px" class="cls_039"><span class="cls_039">code. You can trim down some of the security-specific code by modifying </span><span class="cls_059">process-</span></div>
<div style="position:absolute;left:102.18px;top:583.67px" class="cls_059"><span class="cls_059">Order()</span><span class="cls_039"> to accept an </span><span class="cls_059">Authentication</span><span class="cls_039"> object as a parameter instead of a </span><span class="cls_059">Principal</span><span class="cls_039">:</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:88552px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background134.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">112</span></div>
<div style="position:absolute;left:210.90px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 4</span></div>
<div style="position:absolute;left:255.03px;top:24.35px" class="cls_055"><span class="cls_055">Securing Spring</span></div>
<div style="position:absolute;left:93.18px;top:51.32px" class="cls_060"><span class="cls_060">@PostMapping</span></div>
<div style="position:absolute;left:93.18px;top:61.34px" class="cls_060"><span class="cls_060">public String processOrder(@Valid Order order, Errors errors,</span></div>
<div style="position:absolute;left:112.38px;top:71.33px" class="cls_060"><span class="cls_060">SessionStatus sessionStatus,</span></div>
<div style="position:absolute;left:112.38px;top:81.32px" class="cls_060"><span class="cls_060">Authentication authentication) {</span></div>
<div style="position:absolute;left:102.78px;top:121.34px" class="cls_060"><span class="cls_060">User user = (User) authentication.getPrincipal();</span></div>
<div style="position:absolute;left:102.78px;top:131.33px" class="cls_060"><span class="cls_060">order.setUser(user);</span></div>
<div style="position:absolute;left:93.18px;top:171.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:194.66px" class="cls_039"><span class="cls_039">With the </span><span class="cls_059">Authentication</span><span class="cls_039"> in hand, you can call </span><span class="cls_059">getPrincipal()</span><span class="cls_039"> to get the principal</span></div>
<div style="position:absolute;left:93.18px;top:207.65px" class="cls_039"><span class="cls_039">object which, in this case, is a </span><span class="cls_059">User</span><span class="cls_039">. Note that </span><span class="cls_059">getPrincipal()</span><span class="cls_039"> returns a </span><span class="cls_059">java.util</span></div>
<div style="position:absolute;left:93.18px;top:220.67px" class="cls_059"><span class="cls_059">.Object</span><span class="cls_039">, so you need to cast it to </span><span class="cls_059">User</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:108.40px;top:233.66px" class="cls_039"><span class="cls_039">Perhaps the cleanest solution of all, however, is to simply accept a </span><span class="cls_059">User</span><span class="cls_039"> object in</span></div>
<div style="position:absolute;left:93.18px;top:246.65px" class="cls_059"><span class="cls_059">processOrder()</span><span class="cls_039">, but annotate it with </span><span class="cls_059">@AuthenticationPrincipal</span><span class="cls_039"> so that it will be</span></div>
<div style="position:absolute;left:93.18px;top:259.67px" class="cls_039"><span class="cls_039">the authentication’s principal:</span></div>
<div style="position:absolute;left:93.18px;top:281.33px" class="cls_060"><span class="cls_060">@PostMapping</span></div>
<div style="position:absolute;left:93.18px;top:291.35px" class="cls_060"><span class="cls_060">public String processOrder(@Valid Order order, Errors errors,</span></div>
<div style="position:absolute;left:112.38px;top:301.34px" class="cls_060"><span class="cls_060">SessionStatus sessionStatus,</span></div>
<div style="position:absolute;left:112.38px;top:311.33px" class="cls_060"><span class="cls_060">@AuthenticationPrincipal User user) {</span></div>
<div style="position:absolute;left:102.77px;top:331.34px" class="cls_060"><span class="cls_060">if (errors.hasErrors()) {</span></div>
<div style="position:absolute;left:112.38px;top:341.33px" class="cls_060"><span class="cls_060">return "orderForm";</span></div>
<div style="position:absolute;left:102.78px;top:351.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.78px;top:371.33px" class="cls_060"><span class="cls_060">order.setUser(user);</span></div>
<div style="position:absolute;left:102.78px;top:391.34px" class="cls_060"><span class="cls_060">orderRepo.save(order);</span></div>
<div style="position:absolute;left:102.78px;top:401.36px" class="cls_060"><span class="cls_060">sessionStatus.setComplete();</span></div>
<div style="position:absolute;left:102.78px;top:421.34px" class="cls_060"><span class="cls_060">return "redirect:/";</span></div>
<div style="position:absolute;left:93.18px;top:431.36px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:454.67px" class="cls_039"><span class="cls_039">What’s nice about </span><span class="cls_059">@AuthenticationPrincipal</span><span class="cls_039"> is that it doesn’t require a cast (as with</span></div>
<div style="position:absolute;left:93.18px;top:467.66px" class="cls_059"><span class="cls_059">Authentication</span><span class="cls_039">), and it limits the security-specific code to the annotation itself. By</span></div>
<div style="position:absolute;left:93.18px;top:480.68px" class="cls_039"><span class="cls_039">the time you get the </span><span class="cls_059">User</span><span class="cls_039"> object in </span><span class="cls_059">processOrder()</span><span class="cls_039">, it’s ready to be used and assigned</span></div>
<div style="position:absolute;left:93.18px;top:493.67px" class="cls_039"><span class="cls_039">to the </span><span class="cls_059">Order</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:108.00px;top:506.66px" class="cls_039"><span class="cls_039">There’s one other way of identifying who the authenticated user is, although it’s</span></div>
<div style="position:absolute;left:93.18px;top:519.68px" class="cls_039"><span class="cls_039">a bit messy in the sense that it’s very heavy with security-specific code. You can obtain</span></div>
<div style="position:absolute;left:93.18px;top:532.67px" class="cls_039"><span class="cls_039">an </span><span class="cls_059">Authentication</span><span class="cls_039"> object from the security context and then request its principal</span></div>
<div style="position:absolute;left:93.18px;top:545.66px" class="cls_039"><span class="cls_039">like this:</span></div>
<div style="position:absolute;left:93.18px;top:567.35px" class="cls_060"><span class="cls_060">Authentication authentication =</span></div>
<div style="position:absolute;left:112.38px;top:577.34px" class="cls_060"><span class="cls_060">SecurityContextHolder.getContext().getAuthentication();</span></div>
<div style="position:absolute;left:93.18px;top:587.36px" class="cls_061"><span class="cls_061">User user = (User) authentication.getPrincipal();</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:89228px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background135.jpg" width="531" height="666"></div>
<div style="position:absolute;left:253.20px;top:24.35px" class="cls_055"><span class="cls_055">Summary</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">113</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">Although this snippet is thick with security-specific code, it has one advantage over the</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">other approaches described: it can be used anywhere in the application, not only in a</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">controller’s handler methods. This makes it suitable for use in lower levels of the code.</span></div>
<div style="position:absolute;left:102.18px;top:97.81px" class="cls_040"><span class="cls_040">Summary</span></div>
<div style="position:absolute;left:117.78px;top:116.15px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Spring Security autoconfiguration is a great way to get started with security, but</span></div>
<div style="position:absolute;left:129.78px;top:129.17px" class="cls_039"><span class="cls_039">most applications will need to explicitly configure security to meet their unique</span></div>
<div style="position:absolute;left:129.78px;top:142.16px" class="cls_039"><span class="cls_039">security requirements.</span></div>
<div style="position:absolute;left:117.78px;top:156.17px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  User details can be managed in user stores backed by relational databases,</span></div>
<div style="position:absolute;left:129.78px;top:169.16px" class="cls_039"><span class="cls_039">LDAP, or completely custom implementations.</span></div>
<div style="position:absolute;left:117.78px;top:183.17px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Spring Security automatically protects against CSRF attacks.</span></div>
<div style="position:absolute;left:117.78px;top:197.15px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Information about the authenticated user can be obtained via the </span><span class="cls_059">Security-</span></div>
<div style="position:absolute;left:129.78px;top:210.17px" class="cls_059"><span class="cls_059">Context</span><span class="cls_039"> object (returned from </span><span class="cls_059">SecurityContextHolder.getContext()</span><span class="cls_039">)  or</span></div>
<div style="position:absolute;left:129.78px;top:223.16px" class="cls_039"><span class="cls_039">injected into controllers using </span><span class="cls_059">@AuthenticationPrincipal</span><span class="cls_039">.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:89904px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background136.jpg" width="531" height="666"></div>
<div style="position:absolute;left:303.78px;top:111.83px" class="cls_014"><span class="cls_014">Working with</span></div>
<div style="position:absolute;left:186.78px;top:143.84px" class="cls_014"><span class="cls_014">configuration properties</span></div>
<div style="position:absolute;left:84.18px;top:264.85px" class="cls_049"><span class="cls_049">This chapter covers</span></div>
<div style="position:absolute;left:84.18px;top:283.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Fine-tuning autoconfigured beans</span></div>
<div style="position:absolute;left:84.18px;top:298.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Applying configuration properties to application</span></div>
<div style="position:absolute;left:96.18px;top:310.55px" class="cls_051"><span class="cls_051">components</span></div>
<div style="position:absolute;left:84.18px;top:325.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Working with Spring profiles</span></div>
<div style="position:absolute;left:102.18px;top:395.54px" class="cls_039"><span class="cls_039">Do you remember when the iPhone first came out? A small slab of metal and glass</span></div>
<div style="position:absolute;left:102.18px;top:408.53px" class="cls_039"><span class="cls_039">hardly fit the description of what the world had come to recognize as a phone. And</span></div>
<div style="position:absolute;left:102.18px;top:421.55px" class="cls_039"><span class="cls_039">yet, it pioneered the modern smartphone era, changing everything about how we</span></div>
<div style="position:absolute;left:102.18px;top:434.54px" class="cls_039"><span class="cls_039">communicate. Although touch phones are in many ways easier and more powerful</span></div>
<div style="position:absolute;left:102.18px;top:447.53px" class="cls_039"><span class="cls_039">than their predecessor, the flip phone, when the iPhone was first announced, it was</span></div>
<div style="position:absolute;left:102.18px;top:460.55px" class="cls_039"><span class="cls_039">hard to imagine how a device with a single button could be used to place calls.</span></div>
<div style="position:absolute;left:118.60px;top:473.54px" class="cls_039"><span class="cls_039">In some ways, Spring Boot autoconfiguration is like this. Autoconfiguration</span></div>
<div style="position:absolute;left:102.18px;top:486.56px" class="cls_039"><span class="cls_039">greatly simplifies Spring application development. But after a decade of setting</span></div>
<div style="position:absolute;left:102.18px;top:499.55px" class="cls_039"><span class="cls_039">property values in Spring XML configuration and calling setter methods on bean</span></div>
<div style="position:absolute;left:102.18px;top:512.54px" class="cls_039"><span class="cls_039">instances, it’s not immediately apparent how to set properties on beans for which</span></div>
<div style="position:absolute;left:102.18px;top:525.56px" class="cls_039"><span class="cls_039">there’s no explicit configuration.</span></div>
<div style="position:absolute;left:116.55px;top:538.55px" class="cls_039"><span class="cls_039">Fortunately, Spring Boot provides a way with configuration properties. Config-</span></div>
<div style="position:absolute;left:102.18px;top:551.54px" class="cls_039"><span class="cls_039">uration properties are nothing more than properties on beans in the Spring</span></div>
<div style="position:absolute;left:257.16px;top:596.99px" class="cls_024"><span class="cls_024">114</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:90580px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background137.jpg" width="531" height="666"></div>
<div style="position:absolute;left:216.96px;top:24.35px" class="cls_055"><span class="cls_055">Fine-tuning autoconfiguration</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">115</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">application context that can be set from one of several property sources, including</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">JVM system properties, command-line arguments, and environment variables.</span></div>
<div style="position:absolute;left:117.17px;top:76.67px" class="cls_039"><span class="cls_039">In this chapter, you’re going to take a step back from implementing new features</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">in the Taco Cloud application to explore configuration properties. What you take</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">away will no doubt prove useful as you move forward in the chapters that follow. We’ll</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">start by seeing how to employ configuration properties to fine-tune what Spring Boot</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">automatically configures.</span></div>
<div style="position:absolute;left:66.18px;top:149.83px" class="cls_040"><span class="cls_040">5.1</span></div>
<div style="position:absolute;left:102.18px;top:149.83px" class="cls_040"><span class="cls_040">Fine-tuning autoconfiguration</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">Before we dive in too deeply with configuration properties, it’s important to establish</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">that there are two different (but related) kinds of configurations in Spring:</span></div>
<div style="position:absolute;left:117.78px;top:197.66px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Bean wiring</span><span class="cls_039">—Configuration that declares application components to be created</span></div>
<div style="position:absolute;left:129.78px;top:210.65px" class="cls_039"><span class="cls_039">as beans in the Spring application context and how they should be injected into</span></div>
<div style="position:absolute;left:129.78px;top:223.67px" class="cls_039"><span class="cls_039">each other.</span></div>
<div style="position:absolute;left:117.78px;top:237.65px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Property injection</span><span class="cls_039">—Configuration that sets values on beans in the Spring applica-</span></div>
<div style="position:absolute;left:129.78px;top:250.67px" class="cls_039"><span class="cls_039">tion context.</span></div>
<div style="position:absolute;left:102.18px;top:268.67px" class="cls_039"><span class="cls_039">In Spring’s XML and Java-based configuration, these two types of configurations are</span></div>
<div style="position:absolute;left:102.18px;top:281.66px" class="cls_039"><span class="cls_039">often declared explicitly in the same place. In Java configuration, an </span><span class="cls_059">@Bean</span><span class="cls_039">-annotated</span></div>
<div style="position:absolute;left:102.18px;top:294.68px" class="cls_039"><span class="cls_039">method is likely to both instantiate a bean and then set values to its properties. For</span></div>
<div style="position:absolute;left:102.18px;top:307.67px" class="cls_039"><span class="cls_039">example, consider the following </span><span class="cls_059">@Bean</span><span class="cls_039"> method that declares a </span><span class="cls_059">DataSource</span><span class="cls_039"> for an</span></div>
<div style="position:absolute;left:102.18px;top:320.66px" class="cls_039"><span class="cls_039">embedded H2 database:</span></div>
<div style="position:absolute;left:102.18px;top:340.34px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:102.18px;top:350.33px" class="cls_060"><span class="cls_060">public DataSource dataSource() {</span></div>
<div style="position:absolute;left:111.78px;top:360.35px" class="cls_060"><span class="cls_060">return new EmbeddedDataSourceBuilder()</span></div>
<div style="position:absolute;left:130.95px;top:370.34px" class="cls_060"><span class="cls_060">.setType(H2)</span></div>
<div style="position:absolute;left:130.95px;top:380.36px" class="cls_060"><span class="cls_060">.addScript("taco_schema.sql")</span></div>
<div style="position:absolute;left:130.96px;top:390.35px" class="cls_060"><span class="cls_060">.addScripts("user_data.sql", "ingredient_data.sql")</span></div>
<div style="position:absolute;left:130.95px;top:400.34px" class="cls_060"><span class="cls_060">.build();</span></div>
<div style="position:absolute;left:102.18px;top:410.36px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:431.66px" class="cls_039"><span class="cls_039">Here the </span><span class="cls_059">addScript()</span><span class="cls_039"> and </span><span class="cls_059">addScripts()</span><span class="cls_039"> methods set some </span><span class="cls_059">String</span><span class="cls_039"> properties with</span></div>
<div style="position:absolute;left:102.18px;top:444.68px" class="cls_039"><span class="cls_039">the name of SQL scripts that should be applied to the database once the data source is</span></div>
<div style="position:absolute;left:102.18px;top:457.67px" class="cls_039"><span class="cls_039">ready. Whereas this is how you might configure a </span><span class="cls_059">DataSource</span><span class="cls_039"> bean if you aren’t using</span></div>
<div style="position:absolute;left:102.18px;top:470.66px" class="cls_039"><span class="cls_039">Spring Boot, autoconfiguration makes this method completely unnecessary.</span></div>
<div style="position:absolute;left:116.62px;top:483.68px" class="cls_039"><span class="cls_039">If the H2 dependency is available in the run-time classpath, then Spring Boot auto-</span></div>
<div style="position:absolute;left:102.18px;top:496.67px" class="cls_039"><span class="cls_039">matically creates an appropriate </span><span class="cls_059">DataSource</span><span class="cls_039"> bean in the Spring application context.</span></div>
<div style="position:absolute;left:102.18px;top:509.66px" class="cls_039"><span class="cls_039">The bean applies the SQL scripts schema.sql and data.sql.</span></div>
<div style="position:absolute;left:116.86px;top:522.68px" class="cls_039"><span class="cls_039">But what if you want to name the SQL scripts something else? Or what if you need</span></div>
<div style="position:absolute;left:102.18px;top:535.67px" class="cls_039"><span class="cls_039">to specify more than two SQL scripts? That’s where configuration properties come in.</span></div>
<div style="position:absolute;left:102.18px;top:548.69px" class="cls_039"><span class="cls_039">But before you can start using configuration properties, you need to understand</span></div>
<div style="position:absolute;left:102.18px;top:561.68px" class="cls_039"><span class="cls_039">where those properties come from.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:91256px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background138.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">116</span></div>
<div style="position:absolute;left:170.70px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 5</span></div>
<div style="position:absolute;left:214.86px;top:24.35px" class="cls_055"><span class="cls_055">Working with configuration properties</span></div>
<div style="position:absolute;left:57.18px;top:50.48px" class="cls_063"><span class="cls_063">5.1.1</span></div>
<div style="position:absolute;left:93.18px;top:50.48px" class="cls_063"><span class="cls_063">Understanding Spring’s environment abstraction</span></div>
<div style="position:absolute;left:93.18px;top:67.67px" class="cls_039"><span class="cls_039">The Spring environment abstraction is a one-stop shop for any configurable property.</span></div>
<div style="position:absolute;left:93.18px;top:80.66px" class="cls_039"><span class="cls_039">It abstracts the origins of properties so that beans needing those properties can con-</span></div>
<div style="position:absolute;left:93.18px;top:93.65px" class="cls_039"><span class="cls_039">sume them from Spring itself. The Spring environment pulls from several property</span></div>
<div style="position:absolute;left:93.18px;top:106.67px" class="cls_039"><span class="cls_039">sources, including</span></div>
<div style="position:absolute;left:108.78px;top:125.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  JVM system properties</span></div>
<div style="position:absolute;left:108.78px;top:139.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Operating system environment variables</span></div>
<div style="position:absolute;left:108.78px;top:153.65px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Command-line arguments</span></div>
<div style="position:absolute;left:108.78px;top:167.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Application property configuration files</span></div>
<div style="position:absolute;left:93.18px;top:187.67px" class="cls_039"><span class="cls_039">It then aggregates those properties into a single source from which Spring beans can</span></div>
<div style="position:absolute;left:93.18px;top:200.66px" class="cls_039"><span class="cls_039">be injected. Figure 5.1 illustrates how properties from property sources flow through</span></div>
<div style="position:absolute;left:93.18px;top:213.65px" class="cls_039"><span class="cls_039">the Spring environment abstraction to Spring beans.</span></div>
<div style="position:absolute;left:107.41px;top:247.26px" class="cls_079"><span class="cls_079">Property Sources</span></div>
<div style="position:absolute;left:290.14px;top:247.26px" class="cls_079"><span class="cls_079">Beans in the Spring application context</span></div>
<div style="position:absolute;left:118.67px;top:266.13px" class="cls_057"><span class="cls_057">JVM System</span></div>
<div style="position:absolute;left:323.64px;top:270.63px" class="cls_057"><span class="cls_057">Data source</span></div>
<div style="position:absolute;left:122.75px;top:275.13px" class="cls_057"><span class="cls_057">properties</span></div>
<div style="position:absolute;left:110.84px;top:305.23px" class="cls_057"><span class="cls_057">Operating system</span></div>
<div style="position:absolute;left:362.32px;top:305.24px" class="cls_057"><span class="cls_057">User service</span></div>
<div style="position:absolute;left:104.03px;top:314.23px" class="cls_057"><span class="cls_057">environment variables</span></div>
<div style="position:absolute;left:350.99px;top:335.36px" class="cls_057"><span class="cls_057">Product</span></div>
<div style="position:absolute;left:115.71px;top:344.17px" class="cls_057"><span class="cls_057">Command line</span></div>
<div style="position:absolute;left:351.96px;top:344.36px" class="cls_057"><span class="cls_057">service</span></div>
<div style="position:absolute;left:121.74px;top:353.17px" class="cls_057"><span class="cls_057">arguments</span></div>
<div style="position:absolute;left:379.91px;top:369.97px" class="cls_057"><span class="cls_057">Inventory</span></div>
<div style="position:absolute;left:383.61px;top:378.97px" class="cls_057"><span class="cls_057">tracker</span></div>
<div style="position:absolute;left:104.61px;top:383.14px" class="cls_057"><span class="cls_057">Application.properties</span></div>
<div style="position:absolute;left:351.48px;top:409.09px" class="cls_057"><span class="cls_057">Audit service</span></div>
<div style="position:absolute;left:114.73px;top:413.42px" class="cls_057"><span class="cls_057">Application.yml</span></div>
<div style="position:absolute;left:93.18px;top:443.84px" class="cls_053"><span class="cls_053">Figure 5.1</span></div>
<div style="position:absolute;left:137.79px;top:443.84px" class="cls_053"><span class="cls_053">The Spring environment pulls properties from property sources and makes them</span></div>
<div style="position:absolute;left:93.18px;top:453.86px" class="cls_053"><span class="cls_053">available to beans in the application context.</span></div>
<div style="position:absolute;left:93.18px;top:490.67px" class="cls_039"><span class="cls_039">The beans that are automatically configured by Spring Boot are all configurable by</span></div>
<div style="position:absolute;left:93.18px;top:503.66px" class="cls_039"><span class="cls_039">properties drawn from the Spring environment. As a simple example, suppose that</span></div>
<div style="position:absolute;left:93.18px;top:516.68px" class="cls_039"><span class="cls_039">you would like the application’s underlying servlet container to listen for requests</span></div>
<div style="position:absolute;left:93.18px;top:529.67px" class="cls_039"><span class="cls_039">on some port other than the default port of 8080. To do that, specify a different port</span></div>
<div style="position:absolute;left:93.18px;top:542.69px" class="cls_039"><span class="cls_039">by setting the </span><span class="cls_059">server.port</span><span class="cls_039"> property in src/main/resources/application.properties</span></div>
<div style="position:absolute;left:93.18px;top:555.68px" class="cls_039"><span class="cls_039">like this:</span></div>
<div style="position:absolute;left:93.18px;top:578.36px" class="cls_061"><span class="cls_061">server.port=9090</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:91932px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background139.jpg" width="531" height="666"></div>
<div style="position:absolute;left:216.96px;top:24.35px" class="cls_055"><span class="cls_055">Fine-tuning autoconfiguration</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">117</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">Personally, I prefer using YAML when setting configuration properties. Therefore,</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">instead of using application.properties, I might set the </span><span class="cls_059">server.port</span><span class="cls_039"> value in src/main/</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">resources/application.yml like this:</span></div>
<div style="position:absolute;left:102.18px;top:96.32px" class="cls_060"><span class="cls_060">server:</span></div>
<div style="position:absolute;left:111.78px;top:106.34px" class="cls_061"><span class="cls_061">port: 9090</span></div>
<div style="position:absolute;left:102.18px;top:127.67px" class="cls_039"><span class="cls_039">If you’d prefer to configure that property externally, you could also specify the port</span></div>
<div style="position:absolute;left:102.18px;top:140.66px" class="cls_039"><span class="cls_039">when starting the application using a command-line argument:</span></div>
<div style="position:absolute;left:102.18px;top:163.34px" class="cls_061"><span class="cls_061">$ java -jar tacocloud-0.0.5-SNAPSHOT.jar --server.port=9090</span></div>
<div style="position:absolute;left:102.18px;top:183.65px" class="cls_039"><span class="cls_039">If you want the application to always start on a specific port, you could set it one time</span></div>
<div style="position:absolute;left:102.18px;top:196.67px" class="cls_039"><span class="cls_039">as an operating system environment variable:</span></div>
<div style="position:absolute;left:102.18px;top:219.35px" class="cls_061"><span class="cls_061">$ export SERVER_PORT=9090</span></div>
<div style="position:absolute;left:102.18px;top:239.66px" class="cls_039"><span class="cls_039">Notice that when setting properties as environment variables, the naming style is</span></div>
<div style="position:absolute;left:102.18px;top:252.65px" class="cls_039"><span class="cls_039">slightly different to accommodate restrictions placed on environment variable names</span></div>
<div style="position:absolute;left:102.18px;top:265.67px" class="cls_039"><span class="cls_039">by the operating system. That’s OK. Spring is able to sort it out and interpret</span></div>
<div style="position:absolute;left:102.18px;top:278.66px" class="cls_059"><span class="cls_059">SERVER_PORT</span><span class="cls_039"> as </span><span class="cls_059">server.port</span><span class="cls_039"> with no problems.</span></div>
<div style="position:absolute;left:117.28px;top:291.68px" class="cls_039"><span class="cls_039">As I said, there are several ways of setting configuration properties. And when we</span></div>
<div style="position:absolute;left:102.18px;top:304.67px" class="cls_039"><span class="cls_039">get to chapter 14, you’ll see yet another way of setting configuration properties in a</span></div>
<div style="position:absolute;left:102.18px;top:317.66px" class="cls_039"><span class="cls_039">centralized configuration server. In fact, there are several hundred configuration</span></div>
<div style="position:absolute;left:102.18px;top:330.68px" class="cls_039"><span class="cls_039">properties you can use to tweak and adjust how Spring beans behave. You’ve already</span></div>
<div style="position:absolute;left:102.18px;top:343.67px" class="cls_039"><span class="cls_039">seen a few: </span><span class="cls_059">server.port</span><span class="cls_039"> in this chapter and </span><span class="cls_059">security.user.name</span><span class="cls_039"> and </span><span class="cls_059">security</span></div>
<div style="position:absolute;left:102.18px;top:356.66px" class="cls_059"><span class="cls_059">.user.password</span><span class="cls_039"> in the previous chapter.</span></div>
<div style="position:absolute;left:116.57px;top:369.68px" class="cls_039"><span class="cls_039">It’s impossible to examine all of the available configuration properties in this chap-</span></div>
<div style="position:absolute;left:102.18px;top:382.67px" class="cls_039"><span class="cls_039">ter. Even so, let’s take a look at a few of the most useful configuration properties you</span></div>
<div style="position:absolute;left:102.18px;top:395.66px" class="cls_039"><span class="cls_039">might commonly encounter. We’ll start with a few properties that let you tweak the</span></div>
<div style="position:absolute;left:102.18px;top:408.68px" class="cls_039"><span class="cls_039">autoconfigured data source.</span></div>
<div style="position:absolute;left:66.18px;top:430.49px" class="cls_063"><span class="cls_063">5.1.2</span></div>
<div style="position:absolute;left:102.18px;top:430.49px" class="cls_063"><span class="cls_063">Configuring a data source</span></div>
<div style="position:absolute;left:102.18px;top:447.68px" class="cls_039"><span class="cls_039">At this point, the Taco Cloud application is still unfinished, but you’ll have several</span></div>
<div style="position:absolute;left:102.18px;top:460.67px" class="cls_039"><span class="cls_039">more chapters to take care of that before you’re ready to deploy the application. As</span></div>
<div style="position:absolute;left:102.18px;top:473.66px" class="cls_039"><span class="cls_039">such, the embedded H2 database you’re using as a data source is perfect for your</span></div>
<div style="position:absolute;left:102.18px;top:486.68px" class="cls_039"><span class="cls_039">needs—for now. But once you take the application into production, you’ll probably</span></div>
<div style="position:absolute;left:102.18px;top:499.67px" class="cls_039"><span class="cls_039">want to consider a more permanent database solution.</span></div>
<div style="position:absolute;left:117.00px;top:512.66px" class="cls_039"><span class="cls_039">Although you could explicitly configure your own </span><span class="cls_059">DataSource</span><span class="cls_039"> bean, that’s usually</span></div>
<div style="position:absolute;left:102.18px;top:525.68px" class="cls_039"><span class="cls_039">unnecessary. Instead, it’s simpler to configure the URL and credentials for your data-</span></div>
<div style="position:absolute;left:102.18px;top:538.67px" class="cls_039"><span class="cls_039">base via configuration properties. For example, if you were to start using a MySQL</span></div>
<div style="position:absolute;left:102.18px;top:551.69px" class="cls_039"><span class="cls_039">database, you might add the following configuration properties to application.yml:</span></div>
<div style="position:absolute;left:102.18px;top:571.34px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:111.78px;top:581.36px" class="cls_060"><span class="cls_060">datasource:</span></div>
<div style="position:absolute;left:121.38px;top:591.35px" class="cls_060"><span class="cls_060">url: jdbc:mysql://localhost/tacocloud</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:92608px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background140.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">118</span></div>
<div style="position:absolute;left:170.70px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 5</span></div>
<div style="position:absolute;left:214.86px;top:24.35px" class="cls_055"><span class="cls_055">Working with configuration properties</span></div>
<div style="position:absolute;left:112.38px;top:51.32px" class="cls_060"><span class="cls_060">username: tacodb</span></div>
<div style="position:absolute;left:112.38px;top:61.34px" class="cls_061"><span class="cls_061">password: tacopassword</span></div>
<div style="position:absolute;left:93.18px;top:82.67px" class="cls_039"><span class="cls_039">Although you’ll need to add the appropriate JDBC driver to the build, you won’t usu-</span></div>
<div style="position:absolute;left:93.18px;top:95.66px" class="cls_039"><span class="cls_039">ally need to specify the JDBC driver class; Spring Boot can figure it out from the struc-</span></div>
<div style="position:absolute;left:93.18px;top:108.65px" class="cls_039"><span class="cls_039">ture of the database URL. But if there’s a problem, you can try setting the </span><span class="cls_059">spring</span></div>
<div style="position:absolute;left:93.18px;top:121.67px" class="cls_059"><span class="cls_059">.datasource.driver-class-name</span><span class="cls_039"> property:</span></div>
<div style="position:absolute;left:93.18px;top:141.35px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:102.78px;top:151.34px" class="cls_060"><span class="cls_060">datasource:</span></div>
<div style="position:absolute;left:112.38px;top:161.33px" class="cls_060"><span class="cls_060">url: jdbc:mysql://localhost/tacocloud</span></div>
<div style="position:absolute;left:112.38px;top:171.35px" class="cls_060"><span class="cls_060">username: tacodb</span></div>
<div style="position:absolute;left:112.38px;top:181.34px" class="cls_060"><span class="cls_060">password: tacopassword</span></div>
<div style="position:absolute;left:112.38px;top:191.33px" class="cls_061"><span class="cls_061">driver-class-name: com.mysql.jdbc.Driver</span></div>
<div style="position:absolute;left:93.18px;top:212.66px" class="cls_039"><span class="cls_039">Spring Boot uses this connection data when autoconfiguring the </span><span class="cls_059">DataSource</span><span class="cls_039"> bean.</span></div>
<div style="position:absolute;left:93.18px;top:225.65px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">DataSource</span><span class="cls_039"> bean will be pooled using Tomcat’s JDBC connection pool if it’s avail-</span></div>
<div style="position:absolute;left:93.18px;top:238.67px" class="cls_039"><span class="cls_039">able on the classpath. If not, Spring Boot looks for and uses one of these other con-</span></div>
<div style="position:absolute;left:93.18px;top:251.66px" class="cls_039"><span class="cls_039">nection pool implementations on the classpath:</span></div>
<div style="position:absolute;left:108.78px;top:268.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  HikariCP</span></div>
<div style="position:absolute;left:108.78px;top:282.65px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Commons DBCP 2</span></div>
<div style="position:absolute;left:93.18px;top:300.68px" class="cls_039"><span class="cls_039">Although these are the only connection pool options available through autoconfigu-</span></div>
<div style="position:absolute;left:93.18px;top:313.67px" class="cls_039"><span class="cls_039">ration, you’re always welcome to explicitly configure a </span><span class="cls_059">DataSource</span><span class="cls_039"> bean to use what-</span></div>
<div style="position:absolute;left:93.18px;top:326.66px" class="cls_039"><span class="cls_039">ever connection pool implementation you’d like.</span></div>
<div style="position:absolute;left:108.06px;top:339.68px" class="cls_039"><span class="cls_039">Earlier in this chapter, we suggested that there might be a way to specify the data-</span></div>
<div style="position:absolute;left:93.18px;top:352.67px" class="cls_039"><span class="cls_039">base initialization scripts to run when the application starts. In that case, the </span><span class="cls_059">spring</span></div>
<div style="position:absolute;left:93.18px;top:365.66px" class="cls_059"><span class="cls_059">.datasource.schema</span><span class="cls_039"> and </span><span class="cls_059">spring.datasource.data</span><span class="cls_039"> properties prove useful:</span></div>
<div style="position:absolute;left:93.18px;top:385.34px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:102.78px;top:395.36px" class="cls_060"><span class="cls_060">datasource:</span></div>
<div style="position:absolute;left:112.38px;top:405.35px" class="cls_060"><span class="cls_060">schema:</span></div>
<div style="position:absolute;left:112.38px;top:415.34px" class="cls_060"><span class="cls_060">- order-schema.sql</span></div>
<div style="position:absolute;left:112.38px;top:425.36px" class="cls_060"><span class="cls_060">- ingredient-schema.sql</span></div>
<div style="position:absolute;left:112.38px;top:435.35px" class="cls_060"><span class="cls_060">- taco-schema.sql</span></div>
<div style="position:absolute;left:112.38px;top:445.34px" class="cls_060"><span class="cls_060">- user-schema.sql</span></div>
<div style="position:absolute;left:112.38px;top:455.36px" class="cls_060"><span class="cls_060">data:</span></div>
<div style="position:absolute;left:112.38px;top:465.35px" class="cls_061"><span class="cls_061">- ingredients.sql</span></div>
<div style="position:absolute;left:93.18px;top:486.68px" class="cls_039"><span class="cls_039">Maybe explicit data source configuration isn’t your style. Instead, perhaps you’d pre-</span></div>
<div style="position:absolute;left:93.18px;top:499.67px" class="cls_039"><span class="cls_039">fer to configure your data source in JNDI and have Spring look it up from there. In</span></div>
<div style="position:absolute;left:93.18px;top:512.66px" class="cls_039"><span class="cls_039">that case, set up your data source by configuring </span><span class="cls_059">spring.datasource.jndi-name</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:532.34px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:102.78px;top:542.36px" class="cls_060"><span class="cls_060">datasource:</span></div>
<div style="position:absolute;left:112.38px;top:552.35px" class="cls_061"><span class="cls_061">jndi-name: java:/comp/env/jdbc/tacoCloudDS</span></div>
<div style="position:absolute;left:93.18px;top:573.68px" class="cls_039"><span class="cls_039">If you set the </span><span class="cls_059">spring.datasource.jndi-name</span><span class="cls_039"> property, the other data source connec-</span></div>
<div style="position:absolute;left:93.18px;top:586.67px" class="cls_039"><span class="cls_039">tion properties (if set) are ignored.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:93284px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background141.jpg" width="531" height="666"></div>
<div style="position:absolute;left:216.96px;top:24.35px" class="cls_055"><span class="cls_055">Fine-tuning autoconfiguration</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">119</span></div>
<div style="position:absolute;left:66.18px;top:50.48px" class="cls_063"><span class="cls_063">5.1.3</span></div>
<div style="position:absolute;left:102.18px;top:50.48px" class="cls_063"><span class="cls_063">Configuring the embedded server</span></div>
<div style="position:absolute;left:102.18px;top:67.67px" class="cls_039"><span class="cls_039">You’ve already seen how to set the servlet container’s port by setting </span><span class="cls_059">server.port</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:102.18px;top:80.66px" class="cls_039"><span class="cls_039">What I didn’t show you is what happens if </span><span class="cls_059">server.port</span><span class="cls_039"> is set to 0:</span></div>
<div style="position:absolute;left:102.18px;top:100.34px" class="cls_060"><span class="cls_060">server:</span></div>
<div style="position:absolute;left:111.78px;top:110.33px" class="cls_061"><span class="cls_061">port: 0</span></div>
<div style="position:absolute;left:102.18px;top:131.66px" class="cls_039"><span class="cls_039">Although you’re explicitly setting </span><span class="cls_059">server.port</span><span class="cls_039"> to 0, the server won’t start on port 0.</span></div>
<div style="position:absolute;left:102.18px;top:144.65px" class="cls_039"><span class="cls_039">Instead, it’ll start on a randomly chosen available port. This is useful when running</span></div>
<div style="position:absolute;left:102.18px;top:157.67px" class="cls_039"><span class="cls_039">automated integration tests to ensure that any concurrently running tests don’t clash</span></div>
<div style="position:absolute;left:102.18px;top:170.66px" class="cls_039"><span class="cls_039">on a hard-coded port number. As you’ll see in chapter 13, it’s also useful when you</span></div>
<div style="position:absolute;left:102.18px;top:183.65px" class="cls_039"><span class="cls_039">don’t care what port your application starts on because it’s a microservice that will be</span></div>
<div style="position:absolute;left:102.18px;top:196.67px" class="cls_039"><span class="cls_039">looked up from a service registry.</span></div>
<div style="position:absolute;left:117.29px;top:209.66px" class="cls_039"><span class="cls_039">But there’s more to the underlying server than just a port. One of the most com-</span></div>
<div style="position:absolute;left:102.18px;top:222.65px" class="cls_039"><span class="cls_039">mon things you’ll need to do with the underlying container is to set it up to handle</span></div>
<div style="position:absolute;left:102.18px;top:235.67px" class="cls_039"><span class="cls_039">HTTPS requests. To do that, the first thing you must do is create a keystore using the</span></div>
<div style="position:absolute;left:102.18px;top:248.66px" class="cls_039"><span class="cls_039">JDK’s </span><span class="cls_059">keytool</span><span class="cls_039"> command-line utility:</span></div>
<div style="position:absolute;left:102.18px;top:271.34px" class="cls_061"><span class="cls_061">$ keytool -keystore mykeys.jks -genkey -alias tomcat -keyalg RSA</span></div>
<div style="position:absolute;left:102.18px;top:291.68px" class="cls_039"><span class="cls_039">You’ll be asked several questions about your name and organization, most of which</span></div>
<div style="position:absolute;left:102.18px;top:304.67px" class="cls_039"><span class="cls_039">are irrelevant. But when asked for a password, remember what you choose. For the</span></div>
<div style="position:absolute;left:102.18px;top:317.66px" class="cls_039"><span class="cls_039">sake of this example, I chose letmein as the password.</span></div>
<div style="position:absolute;left:116.67px;top:330.68px" class="cls_039"><span class="cls_039">Next, you’ll need to set a few properties to enable HTTPS in the embedded server.</span></div>
<div style="position:absolute;left:102.18px;top:343.67px" class="cls_039"><span class="cls_039">You could specify them all on the command line, but that would be terribly inconve-</span></div>
<div style="position:absolute;left:102.18px;top:356.66px" class="cls_039"><span class="cls_039">nient. Instead, you’ll probably set them in the file’s application.properties or applica-</span></div>
<div style="position:absolute;left:102.18px;top:369.68px" class="cls_039"><span class="cls_039">tion.yml. In application.yml, the properties might look like this:</span></div>
<div style="position:absolute;left:102.18px;top:389.36px" class="cls_060"><span class="cls_060">server:</span></div>
<div style="position:absolute;left:111.78px;top:399.35px" class="cls_060"><span class="cls_060">port: 8443</span></div>
<div style="position:absolute;left:111.78px;top:409.34px" class="cls_060"><span class="cls_060">ssl:</span></div>
<div style="position:absolute;left:121.38px;top:419.36px" class="cls_060"><span class="cls_060">key-store: file:///path/to/mykeys.jks</span></div>
<div style="position:absolute;left:121.38px;top:429.35px" class="cls_060"><span class="cls_060">key-store-password: letmein</span></div>
<div style="position:absolute;left:121.36px;top:439.34px" class="cls_061"><span class="cls_061">key-password: letmein</span></div>
<div style="position:absolute;left:102.18px;top:460.67px" class="cls_039"><span class="cls_039">Here the </span><span class="cls_059">server.port</span><span class="cls_039"> property is set to 8443, a common choice for development</span></div>
<div style="position:absolute;left:102.18px;top:473.66px" class="cls_039"><span class="cls_039">HTTPS servers. The </span><span class="cls_059">server.ssl.key-store</span><span class="cls_039"> property should be set to the path where</span></div>
<div style="position:absolute;left:102.18px;top:486.68px" class="cls_039"><span class="cls_039">the keystore file is created. Here it’s shown with a </span><span class="cls_059">file://</span><span class="cls_039"> URL to load it from the</span></div>
<div style="position:absolute;left:102.18px;top:499.67px" class="cls_039"><span class="cls_039">filesystem, but if you package it within the application JAR file, you’ll use a </span><span class="cls_059">classpath</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:102.18px;top:512.66px" class="cls_039"><span class="cls_039">URL to reference it. And both the </span><span class="cls_059">server.ssl.key-store-password</span><span class="cls_039"> and </span><span class="cls_059">server</span></div>
<div style="position:absolute;left:102.18px;top:525.68px" class="cls_059"><span class="cls_059">.ssl.key-password</span><span class="cls_039"> properties are set to the password that was given when creating</span></div>
<div style="position:absolute;left:102.18px;top:538.67px" class="cls_039"><span class="cls_039">the keystore.</span></div>
<div style="position:absolute;left:117.99px;top:551.69px" class="cls_039"><span class="cls_039">With these properties in place, your application should be listening for HTTPS</span></div>
<div style="position:absolute;left:102.18px;top:564.68px" class="cls_039"><span class="cls_039">requests on port 8443. Depending on which browser you’re using, you may encounter</span></div>
<div style="position:absolute;left:102.18px;top:577.67px" class="cls_039"><span class="cls_039">a warning about the server not being able to verify its identity. This is nothing to worry</span></div>
<div style="position:absolute;left:102.18px;top:590.69px" class="cls_039"><span class="cls_039">about when serving from localhost during development.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:93960px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background142.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">120</span></div>
<div style="position:absolute;left:170.70px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 5</span></div>
<div style="position:absolute;left:214.86px;top:24.35px" class="cls_055"><span class="cls_055">Working with configuration properties</span></div>
<div style="position:absolute;left:57.18px;top:50.48px" class="cls_063"><span class="cls_063">5.1.4</span></div>
<div style="position:absolute;left:93.18px;top:50.48px" class="cls_063"><span class="cls_063">Configuring logging</span></div>
<div style="position:absolute;left:93.18px;top:67.67px" class="cls_039"><span class="cls_039">Most applications provide some form of logging. And even if your application doesn’t log</span></div>
<div style="position:absolute;left:93.18px;top:80.66px" class="cls_039"><span class="cls_039">anything directly, the libraries that your application uses will certainly log their activity.</span></div>
<div style="position:absolute;left:107.79px;top:93.65px" class="cls_039"><span class="cls_039">By default, Spring Boot configures logging via Logback (</span><a href="http://logback.qos.ch/">http://logback.qos.ch</a> <span class="cls_039">) to</span></div>
<div style="position:absolute;left:93.18px;top:106.67px" class="cls_039"><span class="cls_039">write to the console at an INFO level. You’ve probably already seen plenty of INFO-</span></div>
<div style="position:absolute;left:93.18px;top:119.66px" class="cls_039"><span class="cls_039">level entries in the application logs as you’ve run the application and other examples.</span></div>
<div style="position:absolute;left:107.58px;top:132.65px" class="cls_039"><span class="cls_039">For full control over the logging configuration, you can create a logback.xml file at</span></div>
<div style="position:absolute;left:93.18px;top:145.67px" class="cls_039"><span class="cls_039">the root of the classpath (in src/main/resources). Here’s an example of a simple log-</span></div>
<div style="position:absolute;left:93.18px;top:158.66px" class="cls_039"><span class="cls_039">back.xml file you might use:</span></div>
<div style="position:absolute;left:93.18px;top:178.34px" class="cls_060"><span class="cls_060">&lt;configuration&gt;</span></div>
<div style="position:absolute;left:102.78px;top:188.33px" class="cls_060"><span class="cls_060">&lt;appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender"&gt;</span></div>
<div style="position:absolute;left:112.38px;top:198.35px" class="cls_060"><span class="cls_060">&lt;encoder&gt;</span></div>
<div style="position:absolute;left:121.95px;top:208.34px" class="cls_060"><span class="cls_060">&lt;pattern&gt;</span></div>
<div style="position:absolute;left:131.57px;top:218.33px" class="cls_060"><span class="cls_060">%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</span></div>
<div style="position:absolute;left:121.95px;top:228.35px" class="cls_060"><span class="cls_060">&lt;/pattern&gt;</span></div>
<div style="position:absolute;left:112.38px;top:238.34px" class="cls_060"><span class="cls_060">&lt;/encoder&gt;</span></div>
<div style="position:absolute;left:102.78px;top:248.33px" class="cls_060"><span class="cls_060">&lt;/appender&gt;</span></div>
<div style="position:absolute;left:102.78px;top:258.35px" class="cls_060"><span class="cls_060">&lt;logger name="root" level="INFO"/&gt;</span></div>
<div style="position:absolute;left:102.78px;top:268.34px" class="cls_060"><span class="cls_060">&lt;root level="INFO"&gt;</span></div>
<div style="position:absolute;left:112.38px;top:278.33px" class="cls_060"><span class="cls_060">&lt;appender-ref ref="STDOUT" /&gt;</span></div>
<div style="position:absolute;left:102.78px;top:288.35px" class="cls_060"><span class="cls_060">&lt;/root&gt;</span></div>
<div style="position:absolute;left:93.18px;top:298.34px" class="cls_061"><span class="cls_061">&lt;/configuration&gt;</span></div>
<div style="position:absolute;left:93.18px;top:319.67px" class="cls_039"><span class="cls_039">Aside from the pattern used for logging, this Logback configuration is more or less</span></div>
<div style="position:absolute;left:93.18px;top:332.66px" class="cls_039"><span class="cls_039">equivalent to the default you’ll get if you have no logback.xml file. But by editing log-</span></div>
<div style="position:absolute;left:93.18px;top:345.68px" class="cls_039"><span class="cls_039">back.xml you can gain full control over your application’s log files.</span></div>
<div style="position:absolute;left:105.18px;top:368.66px" class="cls_083"><span class="cls_083">NOTE</span><span class="cls_039">   The specifics of what can go into logback.xml are outside the scope of</span></div>
<div style="position:absolute;left:105.18px;top:380.66px" class="cls_039"><span class="cls_039">this book. Refer to Logback’s documentation for more information.</span></div>
<div style="position:absolute;left:93.18px;top:402.68px" class="cls_039"><span class="cls_039">The most common changes you’ll make to a logging configuration are to change the</span></div>
<div style="position:absolute;left:93.18px;top:415.67px" class="cls_039"><span class="cls_039">logging levels and perhaps to specify a file where the logs should be written. With</span></div>
<div style="position:absolute;left:93.18px;top:428.66px" class="cls_039"><span class="cls_039">Spring Boot configuration properties, you can make those changes without having to</span></div>
<div style="position:absolute;left:93.18px;top:441.68px" class="cls_039"><span class="cls_039">create a logback.xml file.</span></div>
<div style="position:absolute;left:110.52px;top:454.67px" class="cls_039"><span class="cls_039">To set the logging levels, you create properties that are prefixed with </span><span class="cls_059">log-</span></div>
<div style="position:absolute;left:93.18px;top:467.66px" class="cls_059"><span class="cls_059">ging.level</span><span class="cls_039">, followed by the name of the logger for which you want to set the logging</span></div>
<div style="position:absolute;left:93.18px;top:480.68px" class="cls_039"><span class="cls_039">level. For instance, suppose you’d like to set the root logging level to WARN, but log</span></div>
<div style="position:absolute;left:93.18px;top:493.67px" class="cls_039"><span class="cls_039">Spring Security logs at a DEBUG level. The following entries in application.yml will</span></div>
<div style="position:absolute;left:93.18px;top:506.66px" class="cls_039"><span class="cls_039">take care of that for you:</span></div>
<div style="position:absolute;left:93.18px;top:526.34px" class="cls_060"><span class="cls_060">logging:</span></div>
<div style="position:absolute;left:102.78px;top:536.36px" class="cls_060"><span class="cls_060">level:</span></div>
<div style="position:absolute;left:112.38px;top:546.35px" class="cls_060"><span class="cls_060">root: WARN</span></div>
<div style="position:absolute;left:112.38px;top:556.34px" class="cls_060"><span class="cls_060">org:</span></div>
<div style="position:absolute;left:121.95px;top:566.36px" class="cls_060"><span class="cls_060">springframework:</span></div>
<div style="position:absolute;left:131.55px;top:576.35px" class="cls_061"><span class="cls_061">security: DEBUG</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:94636px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background143.jpg" width="531" height="666"></div>
<div style="position:absolute;left:216.96px;top:24.35px" class="cls_055"><span class="cls_055">Fine-tuning autoconfiguration</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">121</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">Optionally, you can collapse the Spring Security package name to a single line for eas-</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">ier reading:</span></div>
<div style="position:absolute;left:102.18px;top:83.33px" class="cls_060"><span class="cls_060">logging:</span></div>
<div style="position:absolute;left:111.78px;top:93.32px" class="cls_060"><span class="cls_060">level:</span></div>
<div style="position:absolute;left:121.38px;top:103.34px" class="cls_060"><span class="cls_060">root: WARN</span></div>
<div style="position:absolute;left:121.38px;top:113.33px" class="cls_061"><span class="cls_061">org.springframework.security: DEBUG</span></div>
<div style="position:absolute;left:102.18px;top:134.66px" class="cls_039"><span class="cls_039">Now suppose that you want to write the log entries to the file TacoCloud.log at</span></div>
<div style="position:absolute;left:102.18px;top:147.65px" class="cls_039"><span class="cls_039">/var/logs/. The </span><span class="cls_059">logging.path</span><span class="cls_039"> and </span><span class="cls_059">logging.file</span><span class="cls_039"> properties can help achieve that:</span></div>
<div style="position:absolute;left:102.18px;top:167.33px" class="cls_060"><span class="cls_060">logging:</span></div>
<div style="position:absolute;left:111.78px;top:177.35px" class="cls_060"><span class="cls_060">path: /var/logs/</span></div>
<div style="position:absolute;left:111.78px;top:187.34px" class="cls_060"><span class="cls_060">file: TacoCloud.log</span></div>
<div style="position:absolute;left:111.78px;top:197.33px" class="cls_060"><span class="cls_060">level:</span></div>
<div style="position:absolute;left:121.38px;top:207.35px" class="cls_060"><span class="cls_060">root: WARN</span></div>
<div style="position:absolute;left:121.38px;top:217.34px" class="cls_060"><span class="cls_060">org:</span></div>
<div style="position:absolute;left:130.95px;top:227.33px" class="cls_060"><span class="cls_060">springframework:</span></div>
<div style="position:absolute;left:140.52px;top:237.35px" class="cls_061"><span class="cls_061">security: DEBUG</span></div>
<div style="position:absolute;left:102.18px;top:260.66px" class="cls_039"><span class="cls_039">Assuming that the application has write permissions to /var/logs/, the log entries will</span></div>
<div style="position:absolute;left:102.18px;top:273.65px" class="cls_039"><span class="cls_039">be written to /var/logs/TacoCloud.log. By default, the log files rotate once they reach</span></div>
<div style="position:absolute;left:102.18px;top:286.67px" class="cls_039"><span class="cls_039">10 MB in size.</span></div>
<div style="position:absolute;left:66.18px;top:308.48px" class="cls_063"><span class="cls_063">5.1.5</span></div>
<div style="position:absolute;left:102.18px;top:308.48px" class="cls_063"><span class="cls_063">Using special property values</span></div>
<div style="position:absolute;left:102.18px;top:325.67px" class="cls_039"><span class="cls_039">When setting properties, you aren’t limited to declaring their values as hard-coded</span></div>
<div style="position:absolute;left:102.18px;top:338.66px" class="cls_059"><span class="cls_059">String</span><span class="cls_039"> and numeric values. Instead, you can derive their values from other configura-</span></div>
<div style="position:absolute;left:102.18px;top:351.68px" class="cls_039"><span class="cls_039">tion properties.</span></div>
<div style="position:absolute;left:118.17px;top:364.67px" class="cls_039"><span class="cls_039">For example, suppose (for whatever reason) you want to set a property named</span></div>
<div style="position:absolute;left:102.18px;top:377.66px" class="cls_059"><span class="cls_059">greeting.welcome</span><span class="cls_039"> to echo the value of another property named </span><span class="cls_059">spring.application</span></div>
<div style="position:absolute;left:102.18px;top:390.68px" class="cls_059"><span class="cls_059">.name</span><span class="cls_039">. To achieve this, you could use the </span><span class="cls_059">${}</span><span class="cls_039"> placeholder markers when setting</span></div>
<div style="position:absolute;left:102.18px;top:403.67px" class="cls_059"><span class="cls_059">greeting.welcome</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:102.18px;top:425.36px" class="cls_060"><span class="cls_060">greeting:</span></div>
<div style="position:absolute;left:111.78px;top:435.35px" class="cls_061"><span class="cls_061">welcome: ${spring.application.name}</span></div>
<div style="position:absolute;left:102.18px;top:458.66px" class="cls_039"><span class="cls_039">You can even embed that placeholder amidst other text:</span></div>
<div style="position:absolute;left:102.18px;top:480.35px" class="cls_060"><span class="cls_060">greeting:</span></div>
<div style="position:absolute;left:111.78px;top:490.34px" class="cls_061"><span class="cls_061">welcome: You are using ${spring.application.name}.</span></div>
<div style="position:absolute;left:102.18px;top:513.68px" class="cls_039"><span class="cls_039">As you’ve seen, configuring Spring’s own components with configuration properties</span></div>
<div style="position:absolute;left:102.18px;top:526.67px" class="cls_039"><span class="cls_039">makes it easy to inject values into those components’ properties and to fine-tune</span></div>
<div style="position:absolute;left:102.18px;top:539.66px" class="cls_039"><span class="cls_039">autoconfiguration. Configuration properties aren’t exclusive to the beans that</span></div>
<div style="position:absolute;left:102.18px;top:552.68px" class="cls_039"><span class="cls_039">Spring creates. With a small amount of effort, you can take advantage of configura-</span></div>
<div style="position:absolute;left:102.18px;top:565.67px" class="cls_039"><span class="cls_039">tion properties in your own beans. Let’s see how.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:95312px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background144.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">122</span></div>
<div style="position:absolute;left:170.70px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 5</span></div>
<div style="position:absolute;left:214.86px;top:24.35px" class="cls_055"><span class="cls_055">Working with configuration properties</span></div>
<div style="position:absolute;left:57.18px;top:49.81px" class="cls_040"><span class="cls_040">5.2</span></div>
<div style="position:absolute;left:93.18px;top:49.81px" class="cls_040"><span class="cls_040">Creating your own configuration properties</span></div>
<div style="position:absolute;left:93.18px;top:69.17px" class="cls_039"><span class="cls_039">As I mentioned earlier, configuration properties are nothing more than properties of</span></div>
<div style="position:absolute;left:93.18px;top:82.16px" class="cls_039"><span class="cls_039">beans that have been designated to accept configurations from Spring’s environment</span></div>
<div style="position:absolute;left:93.18px;top:95.15px" class="cls_039"><span class="cls_039">abstraction. What I didn’t mention is how those beans are designated to consume</span></div>
<div style="position:absolute;left:93.18px;top:108.17px" class="cls_039"><span class="cls_039">those configurations.</span></div>
<div style="position:absolute;left:108.04px;top:121.16px" class="cls_039"><span class="cls_039">To support property injection of configuration properties, Spring Boot provides</span></div>
<div style="position:absolute;left:93.18px;top:134.15px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">@ConfigurationProperties</span><span class="cls_039"> annotation. When placed on any Spring bean, it</span></div>
<div style="position:absolute;left:93.18px;top:147.17px" class="cls_039"><span class="cls_039">specifies that the properties of that bean can be injected from properties in the</span></div>
<div style="position:absolute;left:93.18px;top:160.16px" class="cls_039"><span class="cls_039">Spring environment.</span></div>
<div style="position:absolute;left:107.86px;top:173.15px" class="cls_039"><span class="cls_039">To demonstrate how </span><span class="cls_059">@ConfigurationProperties</span><span class="cls_039"> works, suppose that you’ve added</span></div>
<div style="position:absolute;left:93.18px;top:186.17px" class="cls_039"><span class="cls_039">the following method to </span><span class="cls_059">OrderController</span><span class="cls_039"> to list the authenticated user’s past orders:</span></div>
<div style="position:absolute;left:93.18px;top:205.85px" class="cls_060"><span class="cls_060">@GetMapping</span></div>
<div style="position:absolute;left:93.18px;top:215.84px" class="cls_060"><span class="cls_060">public String ordersForUser(</span></div>
<div style="position:absolute;left:112.38px;top:225.83px" class="cls_060"><span class="cls_060">@AuthenticationPrincipal User user, Model model) {</span></div>
<div style="position:absolute;left:102.78px;top:245.84px" class="cls_060"><span class="cls_060">model.addAttribute("orders",</span></div>
<div style="position:absolute;left:121.95px;top:255.83px" class="cls_060"><span class="cls_060">orderRepo.findByUserOrderByPlacedAtDesc(user));</span></div>
<div style="position:absolute;left:102.78px;top:275.84px" class="cls_060"><span class="cls_060">return "orderList";</span></div>
<div style="position:absolute;left:93.18px;top:285.83px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:307.16px" class="cls_039"><span class="cls_039">Along with that, you’ve also added the necessary </span><span class="cls_059">findByUser()</span><span class="cls_039"> method to </span><span class="cls_059">Order-</span></div>
<div style="position:absolute;left:93.18px;top:320.18px" class="cls_059"><span class="cls_059">Repository</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:342.83px" class="cls_061"><span class="cls_061">List&lt;Order&gt; findByUserOrderByPlacedAtDesc(User user);</span></div>
<div style="position:absolute;left:93.18px;top:363.17px" class="cls_039"><span class="cls_039">Notice that this repository method is named with a clause of </span><span class="cls_059">OrderByPlacedAtDesc</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:93.18px;top:376.16px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">OrderBy</span><span class="cls_039"> portion specifies a property by which the results will be ordered—in this</span></div>
<div style="position:absolute;left:93.18px;top:389.18px" class="cls_039"><span class="cls_039">case, the </span><span class="cls_059">placedAt</span><span class="cls_039"> property. The </span><span class="cls_059">Desc</span><span class="cls_039"> at the end causes the ordering to be in</span></div>
<div style="position:absolute;left:93.18px;top:402.17px" class="cls_039"><span class="cls_039">descending order. Therefore, the list of orders returned will be sorted most recent to</span></div>
<div style="position:absolute;left:93.18px;top:415.16px" class="cls_039"><span class="cls_039">least recent.</span></div>
<div style="position:absolute;left:108.06px;top:428.18px" class="cls_039"><span class="cls_039">As written, this controller method may be useful after the user has placed a hand-</span></div>
<div style="position:absolute;left:93.18px;top:441.17px" class="cls_039"><span class="cls_039">ful of orders. But it could become a bit unwieldy for the most avid of taco connois-</span></div>
<div style="position:absolute;left:93.18px;top:454.16px" class="cls_039"><span class="cls_039">seurs. A few orders displayed in the browser are useful; a never-ending list of hundreds</span></div>
<div style="position:absolute;left:93.18px;top:467.18px" class="cls_039"><span class="cls_039">of orders is just noise. Let’s say that you want to limit the number of orders displayed</span></div>
<div style="position:absolute;left:93.18px;top:480.17px" class="cls_039"><span class="cls_039">to the most recent 20 orders. You can change </span><span class="cls_059">ordersForUser()</span></div>
<div style="position:absolute;left:93.18px;top:499.85px" class="cls_060"><span class="cls_060">@GetMapping</span></div>
<div style="position:absolute;left:93.18px;top:509.84px" class="cls_060"><span class="cls_060">public String ordersForUser(</span></div>
<div style="position:absolute;left:112.38px;top:519.86px" class="cls_060"><span class="cls_060">@AuthenticationPrincipal User user, Model model) {</span></div>
<div style="position:absolute;left:102.78px;top:539.84px" class="cls_060"><span class="cls_060">Pageable pageable = PageRequest.of(0, 20);</span></div>
<div style="position:absolute;left:102.78px;top:549.86px" class="cls_060"><span class="cls_060">model.addAttribute("orders",</span></div>
<div style="position:absolute;left:121.95px;top:559.85px" class="cls_060"><span class="cls_060">orderRepo.findByUserOrderByPlacedAtDesc(user, pageable));</span></div>
<div style="position:absolute;left:102.78px;top:579.86px" class="cls_060"><span class="cls_060">return "orderList";</span></div>
<div style="position:absolute;left:93.18px;top:589.85px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:95988px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background145.jpg" width="531" height="666"></div>
<div style="position:absolute;left:193.05px;top:24.35px" class="cls_055"><span class="cls_055">Creating your own configuration properties</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">123</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">along with the corresponding changes to </span><span class="cls_059">OrderRepository:</span></div>
<div style="position:absolute;left:102.18px;top:70.34px" class="cls_060"><span class="cls_060">List&lt;Order&gt; findByUserOrderByPlacedAtDesc(</span></div>
<div style="position:absolute;left:140.56px;top:80.33px" class="cls_061"><span class="cls_061">User user, Pageable pageable);</span></div>
<div style="position:absolute;left:102.18px;top:99.65px" class="cls_039"><span class="cls_039">Here you’ve changed the signature of the </span><span class="cls_059">findByUserOrderByPlacedAtDesc()</span><span class="cls_039"> method</span></div>
<div style="position:absolute;left:102.18px;top:112.67px" class="cls_039"><span class="cls_039">to accept a </span><span class="cls_059">Pageable</span><span class="cls_039"> as a parameter. </span><span class="cls_059">Pageable</span><span class="cls_039"> is Spring Data’s way of selecting some</span></div>
<div style="position:absolute;left:102.18px;top:125.66px" class="cls_039"><span class="cls_039">subset of the results by a page number and page size. In the </span><span class="cls_059">ordersForUser()</span><span class="cls_039"> control-</span></div>
<div style="position:absolute;left:102.18px;top:138.65px" class="cls_039"><span class="cls_039">ler method, you constructed a </span><span class="cls_059">PageRequest</span><span class="cls_039"> object that implemented </span><span class="cls_059">Pageable</span><span class="cls_039"> to</span></div>
<div style="position:absolute;left:102.18px;top:151.67px" class="cls_039"><span class="cls_039">request the first page (page zero) with a page size of 20 to get up to 20 of the most</span></div>
<div style="position:absolute;left:102.18px;top:164.66px" class="cls_039"><span class="cls_039">recently placed orders for the user.</span></div>
<div style="position:absolute;left:117.22px;top:177.65px" class="cls_039"><span class="cls_039">Although this works fantastically, it leaves me a bit uneasy that you’ve hard-coded</span></div>
<div style="position:absolute;left:102.18px;top:190.67px" class="cls_039"><span class="cls_039">the page size. What if you later decide that 20 is too many orders to list, and you</span></div>
<div style="position:absolute;left:102.18px;top:203.66px" class="cls_039"><span class="cls_039">decide to change it to 10? Because it’s hard-coded, you’d have to rebuild and redeploy</span></div>
<div style="position:absolute;left:102.18px;top:216.65px" class="cls_039"><span class="cls_039">the application.</span></div>
<div style="position:absolute;left:117.94px;top:229.67px" class="cls_039"><span class="cls_039">Rather than hardcode the page size, you can set it with a custom configuration</span></div>
<div style="position:absolute;left:102.18px;top:242.66px" class="cls_039"><span class="cls_039">property. First, you need to add a new property called </span><span class="cls_059">pageSize</span><span class="cls_039"> to </span><span class="cls_059">OrderController</span></div>
<div style="position:absolute;left:102.18px;top:255.65px" class="cls_039"><span class="cls_039">and then annotate </span><span class="cls_059">OrderController</span><span class="cls_039"> with </span><span class="cls_059">@ConfigurationProperties</span><span class="cls_039"> as shown in</span></div>
<div style="position:absolute;left:102.18px;top:268.67px" class="cls_039"><span class="cls_039">the next listing.</span></div>
<div style="position:absolute;left:114.18px;top:292.67px" class="cls_066"><span class="cls_066">Listing 5.1</span></div>
<div style="position:absolute;left:166.27px;top:292.28px" class="cls_066"><span class="cls_066">Enabling configuration properties in </span><span class="cls_077">OrderController</span></div>
<div style="position:absolute;left:102.18px;top:312.65px" class="cls_060"><span class="cls_060">@Controller</span></div>
<div style="position:absolute;left:102.18px;top:322.64px" class="cls_060"><span class="cls_060">@RequestMapping("/orders")</span></div>
<div style="position:absolute;left:102.18px;top:332.63px" class="cls_060"><span class="cls_060">@SessionAttributes("order")</span></div>
<div style="position:absolute;left:102.18px;top:342.65px" class="cls_060"><span class="cls_060">@ConfigurationProperties(prefix="taco.orders")</span></div>
<div style="position:absolute;left:102.18px;top:352.64px" class="cls_060"><span class="cls_060">public class OrderController {</span></div>
<div style="position:absolute;left:111.78px;top:372.65px" class="cls_060"><span class="cls_060">private int pageSize = 20;</span></div>
<div style="position:absolute;left:111.77px;top:392.66px" class="cls_060"><span class="cls_060">public void setPageSize(int pageSize) {</span></div>
<div style="position:absolute;left:121.36px;top:402.65px" class="cls_060"><span class="cls_060">this.pageSize = pageSize;</span></div>
<div style="position:absolute;left:111.78px;top:412.64px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:450.65px" class="cls_060"><span class="cls_060">@GetMapping</span></div>
<div style="position:absolute;left:111.78px;top:460.64px" class="cls_060"><span class="cls_060">public String ordersForUser(</span></div>
<div style="position:absolute;left:130.95px;top:470.66px" class="cls_060"><span class="cls_060">@AuthenticationPrincipal User user, Model model) {</span></div>
<div style="position:absolute;left:121.36px;top:490.64px" class="cls_060"><span class="cls_060">Pageable pageable = PageRequest.of(0, pageSize);</span></div>
<div style="position:absolute;left:121.38px;top:500.66px" class="cls_060"><span class="cls_060">model.addAttribute("orders",</span></div>
<div style="position:absolute;left:140.52px;top:510.65px" class="cls_060"><span class="cls_060">orderRepo.findByUserOrderByPlacedAtDesc(user, pageable));</span></div>
<div style="position:absolute;left:121.38px;top:528.65px" class="cls_060"><span class="cls_060">return "orderList";</span></div>
<div style="position:absolute;left:111.78px;top:538.64px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:558.65px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:577.97px" class="cls_039"><span class="cls_039">The most significant change made in listing 5.1 is the addition of the </span><span class="cls_059">@Configuration-</span></div>
<div style="position:absolute;left:102.27px;top:590.99px" class="cls_059"><span class="cls_059">Properties</span><span class="cls_039"> annotation. Its prefix attribute is set to </span><span class="cls_059">taco.orders</span><span class="cls_039">, which means that</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:96664px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background146.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">124</span></div>
<div style="position:absolute;left:170.70px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 5</span></div>
<div style="position:absolute;left:214.86px;top:24.35px" class="cls_055"><span class="cls_055">Working with configuration properties</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">when setting the </span><span class="cls_059">pageSize</span><span class="cls_039"> property, you need to use a configuration property named</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_059"><span class="cls_059">taco.orders.pageSize</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:109.14px;top:76.67px" class="cls_039"><span class="cls_039">The new </span><span class="cls_059">pageSize</span><span class="cls_039"> property defaults to 20. But you can easily change it to any</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">value you want by setting a </span><span class="cls_059">taco.orders.pageSize</span><span class="cls_039"> property. For example, you could</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">set this property in application.yml like this:</span></div>
<div style="position:absolute;left:93.18px;top:123.35px" class="cls_060"><span class="cls_060">taco:</span></div>
<div style="position:absolute;left:102.78px;top:133.34px" class="cls_060"><span class="cls_060">orders:</span></div>
<div style="position:absolute;left:112.38px;top:143.33px" class="cls_061"><span class="cls_061">pageSize: 10</span></div>
<div style="position:absolute;left:93.18px;top:163.67px" class="cls_039"><span class="cls_039">Or, if you need to make a quick change while in production, you can do so without</span></div>
<div style="position:absolute;left:93.18px;top:176.66px" class="cls_039"><span class="cls_039">having to rebuild and redeploy the application by setting the </span><span class="cls_059">taco.orders.pageSize</span></div>
<div style="position:absolute;left:93.18px;top:189.65px" class="cls_039"><span class="cls_039">property as an environment variable:</span></div>
<div style="position:absolute;left:93.18px;top:210.35px" class="cls_061"><span class="cls_061">$ export TACO_ORDERS_PAGESIZE=10</span></div>
<div style="position:absolute;left:93.18px;top:231.65px" class="cls_039"><span class="cls_039">Any means by which a configuration property can be set can be used to adjust the</span></div>
<div style="position:absolute;left:93.18px;top:244.67px" class="cls_039"><span class="cls_039">page size of the recent orders page. Next, we’ll look at how to set configuration data</span></div>
<div style="position:absolute;left:93.18px;top:257.66px" class="cls_039"><span class="cls_039">in property holders.</span></div>
<div style="position:absolute;left:57.18px;top:279.50px" class="cls_063"><span class="cls_063">5.2.1</span></div>
<div style="position:absolute;left:93.18px;top:279.50px" class="cls_063"><span class="cls_063">Defining configuration properties holders</span></div>
<div style="position:absolute;left:93.18px;top:296.66px" class="cls_039"><span class="cls_039">There’s nothing that says </span><span class="cls_059">@ConfigurationProperties</span><span class="cls_039"> must be set on a controller or</span></div>
<div style="position:absolute;left:93.18px;top:309.68px" class="cls_039"><span class="cls_039">any other specific kind of bean. </span><span class="cls_059">@ConfigurationProperties</span><span class="cls_039"> are in fact often placed</span></div>
<div style="position:absolute;left:93.18px;top:322.67px" class="cls_039"><span class="cls_039">on beans whose sole purpose in the application is to be holders of configuration data.</span></div>
<div style="position:absolute;left:93.18px;top:335.66px" class="cls_039"><span class="cls_039">This keeps configuration-specific details out of the controllers and other application</span></div>
<div style="position:absolute;left:93.18px;top:348.68px" class="cls_039"><span class="cls_039">classes. It also makes it easy to share common configuration properties among several</span></div>
<div style="position:absolute;left:93.18px;top:361.67px" class="cls_039"><span class="cls_039">beans that may make use of that information.</span></div>
<div style="position:absolute;left:107.77px;top:374.66px" class="cls_039"><span class="cls_039">In the case of the </span><span class="cls_059">pageSize</span><span class="cls_039"> property in </span><span class="cls_059">OrderController</span><span class="cls_039">, you could extract it to a</span></div>
<div style="position:absolute;left:93.18px;top:387.68px" class="cls_039"><span class="cls_039">separate class. The following listing uses the </span><span class="cls_059">OrderProps</span><span class="cls_039"> class in such a way.</span></div>
<div style="position:absolute;left:105.18px;top:411.65px" class="cls_066"><span class="cls_066">Listing 5.2</span></div>
<div style="position:absolute;left:157.28px;top:411.26px" class="cls_066"><span class="cls_066">Extracting </span><span class="cls_077">pageSize</span><span class="cls_066"> to a holder class</span></div>
<div style="position:absolute;left:93.18px;top:431.66px" class="cls_060"><span class="cls_060">package tacos.web;</span></div>
<div style="position:absolute;left:93.18px;top:441.65px" class="cls_060"><span class="cls_060">import org.springframework.boot.context.properties.</span></div>
<div style="position:absolute;left:285.11px;top:451.64px" class="cls_060"><span class="cls_060">ConfigurationProperties;</span></div>
<div style="position:absolute;left:93.18px;top:461.66px" class="cls_060"><span class="cls_060">import org.springframework.stereotype.Component;</span></div>
<div style="position:absolute;left:93.18px;top:471.65px" class="cls_060"><span class="cls_060">import lombok.Data;</span></div>
<div style="position:absolute;left:93.18px;top:489.65px" class="cls_060"><span class="cls_060">@Component</span></div>
<div style="position:absolute;left:93.18px;top:499.64px" class="cls_060"><span class="cls_060">@ConfigurationProperties(prefix="taco.orders")</span></div>
<div style="position:absolute;left:93.18px;top:509.66px" class="cls_060"><span class="cls_060">@Data</span></div>
<div style="position:absolute;left:93.18px;top:519.65px" class="cls_060"><span class="cls_060">public class OrderProps {</span></div>
<div style="position:absolute;left:102.78px;top:539.66px" class="cls_060"><span class="cls_060">private int pageSize = 20;</span></div>
<div style="position:absolute;left:93.18px;top:559.64px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:578.99px" class="cls_039"><span class="cls_039">As you did with </span><span class="cls_059">OrderController</span><span class="cls_039">, the </span><span class="cls_059">pageSize</span><span class="cls_039"> property defaults to 20 and </span><span class="cls_059">Order-</span></div>
<div style="position:absolute;left:93.18px;top:591.98px" class="cls_059"><span class="cls_059">Props</span><span class="cls_039"> is annotated with </span><span class="cls_059">@ConfigurationProperties</span><span class="cls_039"> to have a prefix of </span><span class="cls_059">taco.orders</span><span class="cls_039">.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:97340px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background147.jpg" width="531" height="666"></div>
<div style="position:absolute;left:193.05px;top:24.35px" class="cls_055"><span class="cls_055">Creating your own configuration properties</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">125</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">It’s also annotated with </span><span class="cls_059">@Component</span><span class="cls_039"> so that Spring component scanning will automati-</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">cally discover it and create it as a bean in the Spring application context. This is</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">important, as the next step is to inject the </span><span class="cls_059">OrderProps</span><span class="cls_039"> bean into </span><span class="cls_059">OrderController</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:116.59px;top:89.66px" class="cls_039"><span class="cls_039">There’s nothing particularly special about configuration property holders. They’re</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">beans that have their properties injected from the Spring environment. They can be</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">injected into any other bean that needs those properties. For </span><span class="cls_059">OrderController</span><span class="cls_039">, this</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">means removing the </span><span class="cls_059">pageSize</span><span class="cls_039"> property from </span><span class="cls_059">OrderController</span><span class="cls_039"> and instead injecting</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">and using the </span><span class="cls_059">OrderProps</span><span class="cls_039"> bean:</span></div>
<div style="position:absolute;left:102.18px;top:161.33px" class="cls_060"><span class="cls_060">@Controller</span></div>
<div style="position:absolute;left:102.18px;top:171.35px" class="cls_060"><span class="cls_060">@RequestMapping("/orders")</span></div>
<div style="position:absolute;left:102.18px;top:181.34px" class="cls_060"><span class="cls_060">@SessionAttributes("order")</span></div>
<div style="position:absolute;left:102.18px;top:191.33px" class="cls_060"><span class="cls_060">public class OrderController {</span></div>
<div style="position:absolute;left:111.78px;top:211.34px" class="cls_060"><span class="cls_060">private OrderRepository orderRepo;</span></div>
<div style="position:absolute;left:111.78px;top:231.35px" class="cls_060"><span class="cls_060">private OrderProps props;</span></div>
<div style="position:absolute;left:111.78px;top:251.33px" class="cls_060"><span class="cls_060">public OrderController(OrderRepository orderRepo,</span></div>
<div style="position:absolute;left:150.15px;top:261.35px" class="cls_060"><span class="cls_060">OrderProps props) {</span></div>
<div style="position:absolute;left:121.38px;top:271.34px" class="cls_060"><span class="cls_060">this.orderRepo = orderRepo;</span></div>
<div style="position:absolute;left:121.38px;top:281.33px" class="cls_060"><span class="cls_060">this.props = props;</span></div>
<div style="position:absolute;left:111.78px;top:291.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:331.34px" class="cls_060"><span class="cls_060">@GetMapping</span></div>
<div style="position:absolute;left:111.78px;top:341.33px" class="cls_060"><span class="cls_060">public String ordersForUser(</span></div>
<div style="position:absolute;left:130.95px;top:351.35px" class="cls_060"><span class="cls_060">@AuthenticationPrincipal User user, Model model) {</span></div>
<div style="position:absolute;left:121.36px;top:371.33px" class="cls_060"><span class="cls_060">Pageable pageable = PageRequest.of(0, props.getPageSize());</span></div>
<div style="position:absolute;left:121.38px;top:381.35px" class="cls_060"><span class="cls_060">model.addAttribute("orders",</span></div>
<div style="position:absolute;left:140.52px;top:391.34px" class="cls_060"><span class="cls_060">orderRepo.findByUserOrderByPlacedAtDesc(user, pageable));</span></div>
<div style="position:absolute;left:121.38px;top:411.35px" class="cls_060"><span class="cls_060">return "orderList";</span></div>
<div style="position:absolute;left:111.78px;top:421.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:461.36px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:482.66px" class="cls_039"><span class="cls_039">Now </span><span class="cls_059">OrderController</span><span class="cls_039"> is no longer responsible for handling its own configuration</span></div>
<div style="position:absolute;left:102.18px;top:495.68px" class="cls_039"><span class="cls_039">properties. This keeps the code in </span><span class="cls_059">OrderController</span><span class="cls_039"> slightly neater and allows you to</span></div>
<div style="position:absolute;left:102.18px;top:508.67px" class="cls_039"><span class="cls_039">reuse the properties in </span><span class="cls_059">OrderProps</span><span class="cls_039"> in any other bean that may need them. Moreover,</span></div>
<div style="position:absolute;left:102.18px;top:521.66px" class="cls_039"><span class="cls_039">you’re collecting configuration properties that pertain to orders in one place: the</span></div>
<div style="position:absolute;left:102.18px;top:534.68px" class="cls_059"><span class="cls_059">OrderProps</span><span class="cls_039"> class. If you need to add, remove, rename, or otherwise change the prop-</span></div>
<div style="position:absolute;left:102.18px;top:547.67px" class="cls_039"><span class="cls_039">erties therein, you only need to apply those changes in </span><span class="cls_059">OrderProps</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:116.49px;top:560.69px" class="cls_039"><span class="cls_039">For example, let’s pretend that you’re using the </span><span class="cls_059">pageSize</span><span class="cls_039"> property in several other</span></div>
<div style="position:absolute;left:102.18px;top:573.68px" class="cls_039"><span class="cls_039">beans when you decide it would be best to apply some validation to that property to</span></div>
<div style="position:absolute;left:102.18px;top:586.67px" class="cls_039"><span class="cls_039">limit its values to no less than 5 and no more than 25. Without a holder bean, you’d</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:98016px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background148.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">126</span></div>
<div style="position:absolute;left:170.70px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 5</span></div>
<div style="position:absolute;left:214.86px;top:24.35px" class="cls_055"><span class="cls_055">Working with configuration properties</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">have to apply validation annotations to </span><span class="cls_059">OrderController</span><span class="cls_039">, the </span><span class="cls_059">pageSize</span><span class="cls_039"> property, and</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">all other classes using that property. But because you’ve extracted </span><span class="cls_059">pageSize</span><span class="cls_039"> into</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_059"><span class="cls_059">OrderProps</span><span class="cls_039">, you only must make the changes to </span><span class="cls_059">OrderProps</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:96.32px" class="cls_060"><span class="cls_060">package tacos.web;</span></div>
<div style="position:absolute;left:93.18px;top:106.34px" class="cls_060"><span class="cls_060">import javax.validation.constraints.Max;</span></div>
<div style="position:absolute;left:93.18px;top:116.33px" class="cls_060"><span class="cls_060">import javax.validation.constraints.Min;</span></div>
<div style="position:absolute;left:93.18px;top:132.35px" class="cls_060"><span class="cls_060">import org.springframework.boot.context.properties.</span></div>
<div style="position:absolute;left:285.11px;top:142.34px" class="cls_060"><span class="cls_060">ConfigurationProperties;</span></div>
<div style="position:absolute;left:93.18px;top:152.33px" class="cls_060"><span class="cls_060">import org.springframework.stereotype.Component;</span></div>
<div style="position:absolute;left:93.18px;top:162.35px" class="cls_060"><span class="cls_060">import org.springframework.validation.annotation.Validated;</span></div>
<div style="position:absolute;left:93.18px;top:180.35px" class="cls_060"><span class="cls_060">import lombok.Data;</span></div>
<div style="position:absolute;left:93.18px;top:198.35px" class="cls_060"><span class="cls_060">@Component</span></div>
<div style="position:absolute;left:93.18px;top:208.34px" class="cls_060"><span class="cls_060">@ConfigurationProperties(prefix="taco.orders")</span></div>
<div style="position:absolute;left:93.18px;top:218.33px" class="cls_060"><span class="cls_060">@Data</span></div>
<div style="position:absolute;left:93.18px;top:228.35px" class="cls_060"><span class="cls_060">@Validated</span></div>
<div style="position:absolute;left:93.18px;top:238.34px" class="cls_060"><span class="cls_060">public class OrderProps {</span></div>
<div style="position:absolute;left:102.77px;top:256.34px" class="cls_060"><span class="cls_060">@Min(value=5, message="must be between 5 and 25")</span></div>
<div style="position:absolute;left:102.77px;top:266.33px" class="cls_060"><span class="cls_060">@Max(value=25, message="must be between 5 and 25")</span></div>
<div style="position:absolute;left:102.78px;top:276.35px" class="cls_060"><span class="cls_060">private int pageSize = 20;</span></div>
<div style="position:absolute;left:93.18px;top:294.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:304.34px" class="cls_061"><span class="cls_061">//end::validated[]</span></div>
<div style="position:absolute;left:93.18px;top:325.67px" class="cls_039"><span class="cls_039">Although you could as easily apply the </span><span class="cls_059">@Validated</span><span class="cls_039">, </span><span class="cls_059">@Min</span><span class="cls_039">, and </span><span class="cls_059">@Max</span><span class="cls_039"> annotations to</span></div>
<div style="position:absolute;left:93.18px;top:338.66px" class="cls_059"><span class="cls_059">OrderController</span><span class="cls_039"> (and any other beans that can be injected with </span><span class="cls_059">OrderProps</span><span class="cls_039">), it</span></div>
<div style="position:absolute;left:93.18px;top:351.68px" class="cls_039"><span class="cls_039">would just clutter up </span><span class="cls_059">OrderController</span><span class="cls_039"> that much more. With a configuration prop-</span></div>
<div style="position:absolute;left:93.18px;top:364.67px" class="cls_039"><span class="cls_039">erty holder bean, you’ve collected configuration property specifics in one place, leav-</span></div>
<div style="position:absolute;left:93.18px;top:377.66px" class="cls_039"><span class="cls_039">ing the classes that need those properties relatively clean.</span></div>
<div style="position:absolute;left:57.18px;top:399.50px" class="cls_063"><span class="cls_063">5.2.2</span></div>
<div style="position:absolute;left:93.18px;top:399.50px" class="cls_063"><span class="cls_063">Declaring configuration property metadata</span></div>
<div style="position:absolute;left:93.18px;top:416.66px" class="cls_039"><span class="cls_039">Depending on your IDE, you may have noticed that the </span><span class="cls_059">taco.orders.pageSize</span><span class="cls_039"> entry</span></div>
<div style="position:absolute;left:93.18px;top:429.68px" class="cls_039"><span class="cls_039">in application.yml (or application.properties) has a warning saying something like</span></div>
<div style="position:absolute;left:93.18px;top:442.67px" class="cls_039"><span class="cls_039">Unknown Property ‘taco’. This warning appears because there’s missing metadata</span></div>
<div style="position:absolute;left:93.18px;top:455.66px" class="cls_039"><span class="cls_039">concerning the configuration property you just created. Figure 5.2 shows what this</span></div>
<div style="position:absolute;left:93.18px;top:468.68px" class="cls_039"><span class="cls_039">looks like when I hover over the </span><span class="cls_059">taco</span><span class="cls_039"> portion of the property in the Spring Tool Suite.</span></div>
<div style="position:absolute;left:230.64px;top:520.70px" class="cls_053"><span class="cls_053">Figure 5.2</span></div>
<div style="position:absolute;left:275.24px;top:520.70px" class="cls_053"><span class="cls_053">A warning for missing</span></div>
<div style="position:absolute;left:230.64px;top:530.72px" class="cls_053"><span class="cls_053">configuration property metadata</span></div>
<div style="position:absolute;left:93.18px;top:566.21px" class="cls_039"><span class="cls_039">Configuration property metadata is completely optional and doesn’t prevent configu-</span></div>
<div style="position:absolute;left:93.18px;top:579.20px" class="cls_039"><span class="cls_039">ration properties from working. But the metadata can be useful for providing some</span></div>
<div style="position:absolute;left:93.18px;top:592.22px" class="cls_039"><span class="cls_039">minimal documentation around the configuration properties, especially in the IDE.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:98692px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background149.jpg" width="531" height="666"></div>
<div style="position:absolute;left:193.05px;top:24.35px" class="cls_055"><span class="cls_055">Creating your own configuration properties</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">127</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">For example, when I hover over the </span><span class="cls_059">security.user.password</span><span class="cls_039"> property, I see what’s</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">shown in figure 5.3. Although the hover help you get is minimal, it can be enough to</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">help understand what the property is used for and how to use it.</span></div>
<div style="position:absolute;left:293.04px;top:190.70px" class="cls_053"><span class="cls_053">Figure 5.3</span></div>
<div style="position:absolute;left:337.65px;top:190.70px" class="cls_053"><span class="cls_053">Hover documentation for</span></div>
<div style="position:absolute;left:293.04px;top:200.72px" class="cls_053"><span class="cls_053">configuration properties in the Spring</span></div>
<div style="position:absolute;left:293.04px;top:210.71px" class="cls_053"><span class="cls_053">Tool Suite</span></div>
<div style="position:absolute;left:102.18px;top:241.16px" class="cls_039"><span class="cls_039">To help those who might use the configuration properties that you define—which</span></div>
<div style="position:absolute;left:102.18px;top:254.15px" class="cls_039"><span class="cls_039">might even be you—it’s generally a good idea to create some metadata around those</span></div>
<div style="position:absolute;left:102.18px;top:267.17px" class="cls_039"><span class="cls_039">properties. At least it gets rid of those annoying yellow warnings in the IDE.</span></div>
<div style="position:absolute;left:116.59px;top:280.16px" class="cls_039"><span class="cls_039">To create metadata for your custom configuration properties, you’ll need to create</span></div>
<div style="position:absolute;left:102.18px;top:293.18px" class="cls_039"><span class="cls_039">a file under the META-INF (for example, in the project under src/main/resources/</span></div>
<div style="position:absolute;left:102.18px;top:306.17px" class="cls_039"><span class="cls_039">META-INF) named additional-spring-configuration-metadata.json.</span></div>
<div style="position:absolute;left:102.18px;top:324.35px" class="cls_064"><span class="cls_064">Q</span><span class="cls_065">UICK</span><span class="cls_064">-</span><span class="cls_065">FIXING</span><span class="cls_064"> </span><span class="cls_065">MISSING</span><span class="cls_064"> </span><span class="cls_065">METADATA</span><span class="cls_064">.</span></div>
<div style="position:absolute;left:102.18px;top:336.68px" class="cls_039"><span class="cls_039">If you’re using the Spring Tool Suite, there’s a quick-fix option for creating missing</span></div>
<div style="position:absolute;left:102.18px;top:349.67px" class="cls_039"><span class="cls_039">property metadata. Place your cursor on the line with the missing metadata warning</span></div>
<div style="position:absolute;left:102.18px;top:362.66px" class="cls_039"><span class="cls_039">and open the quick-fix pop up with CMD-1 on Mac or Ctrl-1 on Windows and Linux</span></div>
<div style="position:absolute;left:102.18px;top:375.68px" class="cls_039"><span class="cls_039">(see figure 5.4).</span></div>
<div style="position:absolute;left:102.18px;top:534.14px" class="cls_053"><span class="cls_053">Figure 5.4</span></div>
<div style="position:absolute;left:146.78px;top:534.14px" class="cls_053"><span class="cls_053">Creating configuration property metadata with the quick-fix pop up in Spring Tool Suite</span></div>
<div style="position:absolute;left:102.18px;top:565.37px" class="cls_039"><span class="cls_039">Then select the Create Metadata for … option to add some metadata for the property</span></div>
<div style="position:absolute;left:102.18px;top:578.36px" class="cls_039"><span class="cls_039">(in additional-spring-configuration-metadata.json as this figure shows) and create that</span></div>
<div style="position:absolute;left:102.18px;top:591.35px" class="cls_039"><span class="cls_039">file if it doesn’t already exist.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:99368px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background150.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">128</span></div>
<div style="position:absolute;left:170.70px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 5</span></div>
<div style="position:absolute;left:214.86px;top:24.35px" class="cls_055"><span class="cls_055">Working with configuration properties</span></div>
<div style="position:absolute;left:107.72px;top:50.66px" class="cls_039"><span class="cls_039">For the </span><span class="cls_059">taco.orders.pageSize</span><span class="cls_039"> property, you can set up the metadata with the fol-</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">lowing JSON:</span></div>
<div style="position:absolute;left:93.18px;top:83.33px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:102.78px;top:93.32px" class="cls_060"><span class="cls_060">"properties": [</span></div>
<div style="position:absolute;left:112.38px;top:103.34px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:121.95px;top:113.33px" class="cls_060"><span class="cls_060">"name": "taco.orders.page-size",</span></div>
<div style="position:absolute;left:121.95px;top:123.32px" class="cls_060"><span class="cls_060">"type": "java.lang.String",</span></div>
<div style="position:absolute;left:121.95px;top:133.34px" class="cls_060"><span class="cls_060">"description":</span></div>
<div style="position:absolute;left:141.17px;top:143.33px" class="cls_060"><span class="cls_060">"Sets the maximum number of orders to display in a list."</span></div>
<div style="position:absolute;left:112.38px;top:153.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.78px;top:163.34px" class="cls_060"><span class="cls_060">]</span></div>
<div style="position:absolute;left:93.18px;top:173.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:194.66px" class="cls_039"><span class="cls_039">Notice that the property name referenced in the metadata is </span><span class="cls_059">taco.orders.page-</span></div>
<div style="position:absolute;left:93.18px;top:207.65px" class="cls_059"><span class="cls_059">size</span><span class="cls_039">. Spring Boot’s flexible property naming allows for variations in property names</span></div>
<div style="position:absolute;left:93.18px;top:220.67px" class="cls_039"><span class="cls_039">such that </span><span class="cls_059">taco.orders.page-size</span><span class="cls_039"> is equivalent to </span><span class="cls_059">taco.orders.pageSize</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:108.95px;top:233.66px" class="cls_039"><span class="cls_039">With that metadata in place, the warnings should be gone. What’s more, if you</span></div>
<div style="position:absolute;left:93.18px;top:246.65px" class="cls_039"><span class="cls_039">hover over the </span><span class="cls_059">taco.orders.pageSize</span><span class="cls_039"> property, you’ll see the description shown in</span></div>
<div style="position:absolute;left:93.18px;top:259.67px" class="cls_039"><span class="cls_039">figure 5.5.</span></div>
<div style="position:absolute;left:333.93px;top:373.07px" class="cls_053"><span class="cls_053">Figure 5.5</span></div>
<div style="position:absolute;left:378.53px;top:373.07px" class="cls_053"><span class="cls_053">Hover help for custom</span></div>
<div style="position:absolute;left:333.93px;top:383.09px" class="cls_053"><span class="cls_053">configuration properties</span></div>
<div style="position:absolute;left:93.18px;top:417.20px" class="cls_039"><span class="cls_039">Also, as shown in figure 5.6, you get autocompletion help from the IDE, just like Spring-</span></div>
<div style="position:absolute;left:93.18px;top:430.22px" class="cls_039"><span class="cls_039">provided configuration properties.</span></div>
<div style="position:absolute;left:57.18px;top:542.18px" class="cls_053"><span class="cls_053">Figure 5.6</span></div>
<div style="position:absolute;left:101.78px;top:542.18px" class="cls_053"><span class="cls_053">Configuration property metadata enables autocompletion of properties.</span></div>
<div style="position:absolute;left:93.18px;top:574.88px" class="cls_039"><span class="cls_039">As you’ve seen, configuration properties are useful for tweaking both autoconfig-</span></div>
<div style="position:absolute;left:93.18px;top:587.90px" class="cls_039"><span class="cls_039">ured components as well as the details injected into your own application beans. But</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:100044px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background151.jpg" width="531" height="666"></div>
<div style="position:absolute;left:225.51px;top:24.35px" class="cls_055"><span class="cls_055">Configuring with profiles</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">129</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">what if you need to configure different properties for different deployment environ-</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">ments? Let’s take a look at how to use Spring profiles to set up environment-specific</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">configuration.</span></div>
<div style="position:absolute;left:66.18px;top:97.81px" class="cls_040"><span class="cls_040">5.3</span></div>
<div style="position:absolute;left:102.18px;top:97.81px" class="cls_040"><span class="cls_040">Configuring with profiles</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">When applications are deployed to different run-time environments, usually some</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">configuration details differ. The details of a database connection, for instance, are</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">likely not the same in a development environment as in a quality assurance environ-</span></div>
<div style="position:absolute;left:102.18px;top:154.67px" class="cls_039"><span class="cls_039">ment, and different still in a production environment. One way to configure proper-</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">ties uniquely in one environment over another is to use environment variables to</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">specify configuration properties instead of defining them in application.properties</span></div>
<div style="position:absolute;left:102.18px;top:193.67px" class="cls_039"><span class="cls_039">and application.yml.</span></div>
<div style="position:absolute;left:116.96px;top:206.66px" class="cls_039"><span class="cls_039">For instance, during development you can lean on the autoconfigured embedded</span></div>
<div style="position:absolute;left:102.18px;top:219.65px" class="cls_039"><span class="cls_039">H2 database. But in production you can set database configuration properties as envi-</span></div>
<div style="position:absolute;left:102.18px;top:232.67px" class="cls_039"><span class="cls_039">ronment variables like this:</span></div>
<div style="position:absolute;left:102.18px;top:252.35px" class="cls_060"><span class="cls_060">% export SPRING_DATASOURCE_URL=jdbc:mysql://localhost/tacocloud</span></div>
<div style="position:absolute;left:102.18px;top:262.34px" class="cls_060"><span class="cls_060">% export SPRING_DATASOURCE_USERNAME=tacouser</span></div>
<div style="position:absolute;left:102.18px;top:272.33px" class="cls_061"><span class="cls_061">% export SPRING_DATASOURCE_PASSWORD=tacopassword</span></div>
<div style="position:absolute;left:102.18px;top:293.66px" class="cls_039"><span class="cls_039">Although this will work, it’s somewhat cumbersome to specify more than one or two</span></div>
<div style="position:absolute;left:102.18px;top:306.68px" class="cls_039"><span class="cls_039">configuration properties as environment variables. Moreover, there’s no good way</span></div>
<div style="position:absolute;left:102.18px;top:319.67px" class="cls_039"><span class="cls_039">to track changes to environment variables or to easily roll back changes if there’s a</span></div>
<div style="position:absolute;left:102.18px;top:332.66px" class="cls_039"><span class="cls_039">mistake.</span></div>
<div style="position:absolute;left:117.20px;top:345.68px" class="cls_039"><span class="cls_039">Instead, I prefer to take advantage of Spring profiles. Profiles are a type of condi-</span></div>
<div style="position:absolute;left:102.18px;top:358.67px" class="cls_039"><span class="cls_039">tional configuration where different beans, configuration classes, and configuration</span></div>
<div style="position:absolute;left:102.18px;top:371.66px" class="cls_039"><span class="cls_039">properties are applied or ignored based on what profiles are active at runtime.</span></div>
<div style="position:absolute;left:117.23px;top:384.68px" class="cls_039"><span class="cls_039">For instance, let’s say that for development and debugging purposes, you want to</span></div>
<div style="position:absolute;left:102.18px;top:397.67px" class="cls_039"><span class="cls_039">use the embedded H2 database, and you want the logging levels for the Taco Cloud</span></div>
<div style="position:absolute;left:102.18px;top:410.66px" class="cls_039"><span class="cls_039">code to be set to DEBUG. But in production, you want to use an external MySQL data-</span></div>
<div style="position:absolute;left:102.18px;top:423.68px" class="cls_039"><span class="cls_039">base and set the logging levels to WARN. In the development situation, it’s easy</span></div>
<div style="position:absolute;left:102.18px;top:436.67px" class="cls_039"><span class="cls_039">enough to not set any data-source properties and get the autoconfigured H2 database.</span></div>
<div style="position:absolute;left:102.18px;top:449.66px" class="cls_039"><span class="cls_039">And as for debug-level logging, you can set the </span><span class="cls_059">logging.level.tacos</span><span class="cls_039"> property for the</span></div>
<div style="position:absolute;left:102.18px;top:462.68px" class="cls_059"><span class="cls_059">tacos</span><span class="cls_039"> base package to DEBUG in application.yml:</span></div>
<div style="position:absolute;left:102.18px;top:482.36px" class="cls_060"><span class="cls_060">logging:</span></div>
<div style="position:absolute;left:111.78px;top:492.35px" class="cls_060"><span class="cls_060">level:</span></div>
<div style="position:absolute;left:121.38px;top:502.34px" class="cls_061"><span class="cls_061">tacos: DEBUG</span></div>
<div style="position:absolute;left:102.18px;top:523.67px" class="cls_039"><span class="cls_039">This is precisely what you need for development purposes. But if you were to deploy</span></div>
<div style="position:absolute;left:102.18px;top:536.66px" class="cls_039"><span class="cls_039">this application in a production setting with no further changes to application.yml,</span></div>
<div style="position:absolute;left:102.18px;top:549.68px" class="cls_039"><span class="cls_039">you’d still have debug logging for the </span><span class="cls_059">tacos</span><span class="cls_039"> package and an embedded H2 database.</span></div>
<div style="position:absolute;left:102.18px;top:562.67px" class="cls_039"><span class="cls_039">What you need is to define a profile with properties suited for production.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:100720px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background152.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">130</span></div>
<div style="position:absolute;left:170.70px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 5</span></div>
<div style="position:absolute;left:214.86px;top:24.35px" class="cls_055"><span class="cls_055">Working with configuration properties</span></div>
<div style="position:absolute;left:57.18px;top:50.48px" class="cls_063"><span class="cls_063">5.3.1</span></div>
<div style="position:absolute;left:93.18px;top:50.48px" class="cls_063"><span class="cls_063">Defining profile-specific properties</span></div>
<div style="position:absolute;left:93.18px;top:67.67px" class="cls_039"><span class="cls_039">One way to define profile-specific properties is to create yet another YAML or properties</span></div>
<div style="position:absolute;left:93.18px;top:80.66px" class="cls_039"><span class="cls_039">file containing only the properties for production. The name of the file should follow</span></div>
<div style="position:absolute;left:93.18px;top:93.65px" class="cls_039"><span class="cls_039">this convention: application-{profile name}.yml or application-{profile name}.properties.</span></div>
<div style="position:absolute;left:93.18px;top:106.67px" class="cls_039"><span class="cls_039">Then you can specify the configuration properties appropriate to that profile. For</span></div>
<div style="position:absolute;left:93.18px;top:119.66px" class="cls_039"><span class="cls_039">example, you could create a new file named application-prod.yml that contains the</span></div>
<div style="position:absolute;left:93.18px;top:132.65px" class="cls_039"><span class="cls_039">following properties:</span></div>
<div style="position:absolute;left:93.18px;top:152.33px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:102.78px;top:162.35px" class="cls_060"><span class="cls_060">datasource:</span></div>
<div style="position:absolute;left:112.38px;top:172.34px" class="cls_060"><span class="cls_060">url: jdbc:mysql://localhost/tacocloud</span></div>
<div style="position:absolute;left:112.38px;top:182.33px" class="cls_060"><span class="cls_060">username: tacouser</span></div>
<div style="position:absolute;left:112.38px;top:192.35px" class="cls_060"><span class="cls_060">password: tacopassword</span></div>
<div style="position:absolute;left:93.18px;top:202.34px" class="cls_060"><span class="cls_060">logging:</span></div>
<div style="position:absolute;left:102.78px;top:212.33px" class="cls_060"><span class="cls_060">level:</span></div>
<div style="position:absolute;left:112.38px;top:222.35px" class="cls_061"><span class="cls_061">tacos: WARN</span></div>
<div style="position:absolute;left:93.18px;top:243.65px" class="cls_039"><span class="cls_039">Another way to specify profile-specific properties works only with YAML configura-</span></div>
<div style="position:absolute;left:93.18px;top:256.67px" class="cls_039"><span class="cls_039">tion. It involves placing profile-specific properties alongside non-profiled properties</span></div>
<div style="position:absolute;left:93.18px;top:269.66px" class="cls_039"><span class="cls_039">in application.yml, separated by three hyphens and the </span><span class="cls_059">spring.profiles</span><span class="cls_039"> property to</span></div>
<div style="position:absolute;left:93.18px;top:282.65px" class="cls_039"><span class="cls_039">name the profile. When applying the production properties to application.yml in this</span></div>
<div style="position:absolute;left:93.18px;top:295.67px" class="cls_039"><span class="cls_039">way, the entire application.yml would look like this:</span></div>
<div style="position:absolute;left:93.18px;top:315.35px" class="cls_060"><span class="cls_060">logging:</span></div>
<div style="position:absolute;left:102.78px;top:325.34px" class="cls_060"><span class="cls_060">level:</span></div>
<div style="position:absolute;left:112.38px;top:335.33px" class="cls_060"><span class="cls_060">tacos: DEBUG</span></div>
<div style="position:absolute;left:93.18px;top:355.34px" class="cls_060"><span class="cls_060">---</span></div>
<div style="position:absolute;left:93.18px;top:365.33px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:102.78px;top:375.35px" class="cls_060"><span class="cls_060">profiles: prod</span></div>
<div style="position:absolute;left:102.78px;top:395.36px" class="cls_060"><span class="cls_060">datasource:</span></div>
<div style="position:absolute;left:112.38px;top:405.35px" class="cls_060"><span class="cls_060">url: jdbc:mysql://localhost/tacocloud</span></div>
<div style="position:absolute;left:112.38px;top:415.34px" class="cls_060"><span class="cls_060">username: tacouser</span></div>
<div style="position:absolute;left:112.38px;top:425.36px" class="cls_060"><span class="cls_060">password: tacopassword</span></div>
<div style="position:absolute;left:93.18px;top:445.34px" class="cls_060"><span class="cls_060">logging:</span></div>
<div style="position:absolute;left:102.78px;top:455.36px" class="cls_060"><span class="cls_060">level:</span></div>
<div style="position:absolute;left:112.38px;top:465.35px" class="cls_061"><span class="cls_061">tacos: WARN</span></div>
<div style="position:absolute;left:93.18px;top:486.68px" class="cls_039"><span class="cls_039">As you can see, this application.yml file is divided into two sections by a set of triple</span></div>
<div style="position:absolute;left:93.18px;top:499.67px" class="cls_039"><span class="cls_039">hyphens (</span><span class="cls_059">---</span><span class="cls_039">). The second section specifies a value for </span><span class="cls_059">spring.profiles</span><span class="cls_039">, indicating</span></div>
<div style="position:absolute;left:93.18px;top:512.66px" class="cls_039"><span class="cls_039">that the properties that follow apply to the </span><span class="cls_059">prod</span><span class="cls_039"> profile. The first section, on the other</span></div>
<div style="position:absolute;left:93.18px;top:525.68px" class="cls_039"><span class="cls_039">hand, doesn’t specify a value for </span><span class="cls_059">spring.profiles</span><span class="cls_039">. Therefore, its properties are com-</span></div>
<div style="position:absolute;left:93.18px;top:538.67px" class="cls_039"><span class="cls_039">mon to all profiles or are defaults if the active profile doesn’t otherwise have the prop-</span></div>
<div style="position:absolute;left:93.18px;top:551.66px" class="cls_039"><span class="cls_039">erties set.</span></div>
<div style="position:absolute;left:107.69px;top:564.68px" class="cls_039"><span class="cls_039">Regardless of which profiles are active when the application runs, the logging level</span></div>
<div style="position:absolute;left:93.18px;top:577.67px" class="cls_039"><span class="cls_039">for the </span><span class="cls_059">tacos</span><span class="cls_039"> package will be set to DEBUG by the property set in the default profile.</span></div>
<div style="position:absolute;left:93.18px;top:590.69px" class="cls_039"><span class="cls_039">But if the profile named </span><span class="cls_059">prod</span><span class="cls_039"> is active, then the </span><span class="cls_059">logging.level.tacos</span><span class="cls_039"> property will</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:101396px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background153.jpg" width="531" height="666"></div>
<div style="position:absolute;left:225.51px;top:24.35px" class="cls_055"><span class="cls_055">Configuring with profiles</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">131</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">be overridden with </span><span class="cls_059">WARN</span><span class="cls_039">. Likewise, if the </span><span class="cls_059">prod</span><span class="cls_039"> profile is active, then the data-source</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">properties will be set to use the external MySQL database.</span></div>
<div style="position:absolute;left:117.21px;top:76.67px" class="cls_039"><span class="cls_039">You can define properties for as many profiles as you need by creating additional</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">YAML or properties files named with the pattern application-{profile name}.yml or</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">application-{profile name}.properties. Or, if you prefer, type three more dashes in</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">application.yml along with another </span><span class="cls_059">spring.profiles</span><span class="cls_039"> property to specify the profile</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">name. Then add all of the profile-specific properties you need.</span></div>
<div style="position:absolute;left:66.18px;top:150.47px" class="cls_063"><span class="cls_063">5.3.2</span></div>
<div style="position:absolute;left:102.18px;top:150.47px" class="cls_063"><span class="cls_063">Activating profiles</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">Setting profile-specific properties will do no good unless those profiles are active. But</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">how can you make a profile active? All it takes to make a profile active is to include it</span></div>
<div style="position:absolute;left:102.18px;top:193.67px" class="cls_039"><span class="cls_039">in the list of profile names given to the </span><span class="cls_059">spring.profiles.active</span><span class="cls_039"> property. For exam-</span></div>
<div style="position:absolute;left:102.18px;top:206.66px" class="cls_039"><span class="cls_039">ple, you could set it in application.yml like this:</span></div>
<div style="position:absolute;left:102.18px;top:226.34px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:111.78px;top:236.33px" class="cls_060"><span class="cls_060">profiles:</span></div>
<div style="position:absolute;left:121.38px;top:246.35px" class="cls_060"><span class="cls_060">active:</span></div>
<div style="position:absolute;left:121.38px;top:256.34px" class="cls_061"><span class="cls_061">- prod</span></div>
<div style="position:absolute;left:102.18px;top:277.67px" class="cls_039"><span class="cls_039">But that’s perhaps the worst possible way to set an active profile. If you set the active</span></div>
<div style="position:absolute;left:102.18px;top:290.66px" class="cls_039"><span class="cls_039">profile in application.yml, then that profile becomes the default profile, and you</span></div>
<div style="position:absolute;left:102.18px;top:303.68px" class="cls_039"><span class="cls_039">achieve none of the benefits of using profiles to separate the production-specific</span></div>
<div style="position:absolute;left:102.18px;top:316.67px" class="cls_039"><span class="cls_039">properties from development properties. Instead, I recommend that you set the active</span></div>
<div style="position:absolute;left:102.18px;top:329.66px" class="cls_039"><span class="cls_039">profile(s) with environment variables. On the production environment, you would set</span></div>
<div style="position:absolute;left:102.18px;top:342.68px" class="cls_059"><span class="cls_059">SPRING_PROFILES_ACTIVE</span><span class="cls_039"> like this:</span></div>
<div style="position:absolute;left:102.18px;top:365.33px" class="cls_061"><span class="cls_061">% export SPRING_PROFILES_ACTIVE=prod</span></div>
<div style="position:absolute;left:102.18px;top:385.67px" class="cls_039"><span class="cls_039">From then on, any applications deployed to that machine will have the </span><span class="cls_059">prod</span><span class="cls_039"> profile</span></div>
<div style="position:absolute;left:102.18px;top:398.66px" class="cls_039"><span class="cls_039">active and the corresponding configuration properties would take precedence over</span></div>
<div style="position:absolute;left:102.18px;top:411.68px" class="cls_039"><span class="cls_039">the properties in the default profile.</span></div>
<div style="position:absolute;left:117.07px;top:424.67px" class="cls_039"><span class="cls_039">If you’re running the application as an executable JAR file, you might also set the</span></div>
<div style="position:absolute;left:102.18px;top:437.66px" class="cls_039"><span class="cls_039">active profile with a command-line argument like this:</span></div>
<div style="position:absolute;left:102.18px;top:460.34px" class="cls_061"><span class="cls_061">% java -jar taco-cloud.jar --spring.profiles.active=prod</span></div>
<div style="position:absolute;left:102.18px;top:480.68px" class="cls_039"><span class="cls_039">Note that the </span><span class="cls_059">spring.profiles.active</span><span class="cls_039"> property name contains the plural word pro-</span></div>
<div style="position:absolute;left:102.18px;top:493.67px" class="cls_039"><span class="cls_039">files. This means you can specify more than one active profile. Often, this is with a</span></div>
<div style="position:absolute;left:102.18px;top:506.66px" class="cls_039"><span class="cls_039">comma-separated list as when setting it with an environment variable:</span></div>
<div style="position:absolute;left:102.18px;top:529.34px" class="cls_061"><span class="cls_061">% export SPRING_PROFILES_ACTIVE=prod,audit,ha</span></div>
<div style="position:absolute;left:102.18px;top:549.68px" class="cls_039"><span class="cls_039">But in YAML, you’d specify it as a list like this:</span></div>
<div style="position:absolute;left:102.18px;top:569.36px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:111.78px;top:579.35px" class="cls_060"><span class="cls_060">profiles:</span></div>
<div style="position:absolute;left:121.38px;top:589.34px" class="cls_060"><span class="cls_060">active:</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:102072px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background154.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">132</span></div>
<div style="position:absolute;left:170.70px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 5</span></div>
<div style="position:absolute;left:214.86px;top:24.35px" class="cls_055"><span class="cls_055">Working with configuration properties</span></div>
<div style="position:absolute;left:112.38px;top:51.32px" class="cls_060"><span class="cls_060">- prod</span></div>
<div style="position:absolute;left:112.38px;top:61.34px" class="cls_060"><span class="cls_060">- audit</span></div>
<div style="position:absolute;left:112.38px;top:71.33px" class="cls_061"><span class="cls_061">- ha</span></div>
<div style="position:absolute;left:93.18px;top:90.65px" class="cls_039"><span class="cls_039">It’s also worth noting that if you deploy a Spring application to Cloud Foundry, a pro-</span></div>
<div style="position:absolute;left:93.18px;top:103.67px" class="cls_039"><span class="cls_039">file named </span><span class="cls_059">cloud</span><span class="cls_039"> is automatically activated for you. If Cloud Foundry is your produc-</span></div>
<div style="position:absolute;left:93.18px;top:116.66px" class="cls_039"><span class="cls_039">tion environment, you’ll want to be sure to specify production-specific properties</span></div>
<div style="position:absolute;left:93.18px;top:129.65px" class="cls_039"><span class="cls_039">under the </span><span class="cls_059">cloud</span><span class="cls_039"> profile.</span></div>
<div style="position:absolute;left:108.09px;top:142.67px" class="cls_039"><span class="cls_039">As it turns out, profiles aren’t useful only for conditionally setting configuration</span></div>
<div style="position:absolute;left:93.18px;top:155.66px" class="cls_039"><span class="cls_039">properties in a Spring application. Let’s see how to declare beans specific to an</span></div>
<div style="position:absolute;left:93.18px;top:168.65px" class="cls_039"><span class="cls_039">active profile.</span></div>
<div style="position:absolute;left:57.18px;top:189.47px" class="cls_063"><span class="cls_063">5.3.3</span></div>
<div style="position:absolute;left:93.18px;top:189.47px" class="cls_063"><span class="cls_063">Conditionally creating beans with profiles</span></div>
<div style="position:absolute;left:93.18px;top:206.66px" class="cls_039"><span class="cls_039">Sometimes it’s useful to provide a unique set of beans for different profiles. Normally,</span></div>
<div style="position:absolute;left:93.18px;top:219.65px" class="cls_039"><span class="cls_039">any bean declared in a Java configuration class is created, regardless of which profile is</span></div>
<div style="position:absolute;left:93.18px;top:232.67px" class="cls_039"><span class="cls_039">active. But suppose there are some beans that you only need to be created if a certain</span></div>
<div style="position:absolute;left:93.18px;top:245.66px" class="cls_039"><span class="cls_039">profile is active. In that case, the </span><span class="cls_059">@Profile</span><span class="cls_039"> annotation can designate beans as only</span></div>
<div style="position:absolute;left:93.18px;top:258.65px" class="cls_039"><span class="cls_039">being applicable to a given profile.</span></div>
<div style="position:absolute;left:110.40px;top:271.67px" class="cls_039"><span class="cls_039">For instance, you have a </span><span class="cls_059">CommandLineRunner</span><span class="cls_039"> bean declared in </span><span class="cls_059">TacoCloud-</span></div>
<div style="position:absolute;left:93.27px;top:284.66px" class="cls_059"><span class="cls_059">Application</span><span class="cls_039"> that’s used to load the embedded database with ingredient data when</span></div>
<div style="position:absolute;left:93.18px;top:297.68px" class="cls_039"><span class="cls_039">the application starts. That’s great for development, but would be unnecessary (and</span></div>
<div style="position:absolute;left:93.18px;top:310.67px" class="cls_039"><span class="cls_039">undesirable) in a production application. To prevent the ingredient data from being</span></div>
<div style="position:absolute;left:93.18px;top:323.66px" class="cls_039"><span class="cls_039">loaded every time the application starts in a production deployment, you could anno-</span></div>
<div style="position:absolute;left:93.18px;top:336.68px" class="cls_039"><span class="cls_039">tate the </span><span class="cls_059">CommandLineRunner</span><span class="cls_039"> bean method with </span><span class="cls_059">@Profile</span><span class="cls_039"> like this:</span></div>
<div style="position:absolute;left:93.18px;top:356.33px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:93.18px;top:366.35px" class="cls_060"><span class="cls_060">@Profile("dev")</span></div>
<div style="position:absolute;left:93.18px;top:376.34px" class="cls_060"><span class="cls_060">public CommandLineRunner dataLoader(IngredientRepository repo,</span></div>
<div style="position:absolute;left:121.97px;top:386.36px" class="cls_060"><span class="cls_060">UserRepository userRepo, PasswordEncoder encoder) {</span></div>
<div style="position:absolute;left:93.18px;top:426.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:445.67px" class="cls_039"><span class="cls_039">Or suppose that you need the </span><span class="cls_059">CommandLineRunner</span><span class="cls_039"> created if either the </span><span class="cls_059">dev</span><span class="cls_039"> profile</span></div>
<div style="position:absolute;left:93.18px;top:458.66px" class="cls_039"><span class="cls_039">or </span><span class="cls_059">qa</span><span class="cls_039"> profile is active. In that case, you can list the profiles for which the bean</span></div>
<div style="position:absolute;left:93.18px;top:471.68px" class="cls_039"><span class="cls_039">should be created:</span></div>
<div style="position:absolute;left:93.18px;top:490.34px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:93.18px;top:500.36px" class="cls_060"><span class="cls_060">@Profile({"dev", "qa"})</span></div>
<div style="position:absolute;left:93.18px;top:510.35px" class="cls_060"><span class="cls_060">public CommandLineRunner dataLoader(IngredientRepository repo,</span></div>
<div style="position:absolute;left:121.97px;top:520.34px" class="cls_060"><span class="cls_060">UserRepository userRepo, PasswordEncoder encoder) {</span></div>
<div style="position:absolute;left:93.18px;top:560.36px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:579.68px" class="cls_039"><span class="cls_039">Now the ingredient data will only be loaded if the </span><span class="cls_059">dev</span><span class="cls_039"> or </span><span class="cls_059">qa</span><span class="cls_039"> profiles are active. That</span></div>
<div style="position:absolute;left:93.18px;top:592.67px" class="cls_039"><span class="cls_039">would mean that you’d need to activate the </span><span class="cls_059">dev</span><span class="cls_039"> profile when running the application</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:102748px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background155.jpg" width="531" height="666"></div>
<div style="position:absolute;left:253.20px;top:24.35px" class="cls_055"><span class="cls_055">Summary</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">133</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">in the development environment. It would be even more convenient if that </span><span class="cls_059">Command-</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_059"><span class="cls_059">LineRunner</span><span class="cls_039"> bean were always created unless the </span><span class="cls_059">prod</span><span class="cls_039"> profile is active. In that case, you</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">can apply </span><span class="cls_059">@Profile</span><span class="cls_039"> like this:</span></div>
<div style="position:absolute;left:102.18px;top:96.32px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:102.18px;top:106.34px" class="cls_060"><span class="cls_060">@Profile("!prod")</span></div>
<div style="position:absolute;left:102.18px;top:116.33px" class="cls_060"><span class="cls_060">public CommandLineRunner dataLoader(IngredientRepository repo,</span></div>
<div style="position:absolute;left:130.97px;top:126.35px" class="cls_060"><span class="cls_060">UserRepository userRepo, PasswordEncoder encoder) {</span></div>
<div style="position:absolute;left:102.18px;top:166.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:187.67px" class="cls_039"><span class="cls_039">Here, the exclamation mark (!) negates the profile name. Effectively, it states that the</span></div>
<div style="position:absolute;left:102.18px;top:200.66px" class="cls_059"><span class="cls_059">CommandLineRunner</span><span class="cls_039"> bean will be created if the </span><span class="cls_059">prod</span><span class="cls_039"> profile isn’t active.</span></div>
<div style="position:absolute;left:118.02px;top:213.65px" class="cls_039"><span class="cls_039">It’s also possible to use </span><span class="cls_059">@Profile</span><span class="cls_039"> on an entire </span><span class="cls_059">@Configuration</span><span class="cls_039">-annotated class.</span></div>
<div style="position:absolute;left:102.18px;top:226.67px" class="cls_039"><span class="cls_039">For example, suppose that you were to extract the </span><span class="cls_059">CommandLineRunner</span><span class="cls_039"> bean into a</span></div>
<div style="position:absolute;left:102.18px;top:239.66px" class="cls_039"><span class="cls_039">separate configuration class named </span><span class="cls_059">DevelopmentConfig</span><span class="cls_039">. Then you could annotate</span></div>
<div style="position:absolute;left:102.18px;top:252.65px" class="cls_059"><span class="cls_059">DevelopmentConfig</span><span class="cls_039"> with </span><span class="cls_059">@Profile</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:102.18px;top:272.33px" class="cls_060"><span class="cls_060">@Profile({"!prod", "!qa"})</span></div>
<div style="position:absolute;left:102.18px;top:282.35px" class="cls_060"><span class="cls_060">@Configuration</span></div>
<div style="position:absolute;left:102.18px;top:292.34px" class="cls_060"><span class="cls_060">public class DevelopmentConfig {</span></div>
<div style="position:absolute;left:111.78px;top:312.35px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:111.78px;top:322.34px" class="cls_060"><span class="cls_060">public CommandLineRunner dataLoader(IngredientRepository repo,</span></div>
<div style="position:absolute;left:140.56px;top:332.33px" class="cls_060"><span class="cls_060">UserRepository userRepo, PasswordEncoder encoder) {</span></div>
<div style="position:absolute;left:111.78px;top:372.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:392.36px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:413.66px" class="cls_039"><span class="cls_039">Here, the </span><span class="cls_059">CommandLineRunner</span><span class="cls_039"> bean (as well as any other beans defined in </span><span class="cls_059">Development-</span></div>
<div style="position:absolute;left:102.33px;top:426.68px" class="cls_059"><span class="cls_059">Config</span><span class="cls_039">) will only be created if neither the </span><span class="cls_059">prod</span><span class="cls_039"> nor </span><span class="cls_059">qa</span><span class="cls_039"> profiles are active.</span></div>
<div style="position:absolute;left:102.18px;top:447.85px" class="cls_040"><span class="cls_040">Summary</span></div>
<div style="position:absolute;left:117.78px;top:466.16px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Spring beans can be annotated with </span><span class="cls_059">@ConfigurationProperties</span><span class="cls_039"> to enable</span></div>
<div style="position:absolute;left:129.78px;top:479.18px" class="cls_039"><span class="cls_039">injection of values from one of several property sources.</span></div>
<div style="position:absolute;left:117.78px;top:493.16px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Configuration properties can be set in command-line arguments, environment</span></div>
<div style="position:absolute;left:129.78px;top:506.18px" class="cls_039"><span class="cls_039">variables, JVM system properties, properties files, or YAML files, among other</span></div>
<div style="position:absolute;left:129.78px;top:519.17px" class="cls_039"><span class="cls_039">options.</span></div>
<div style="position:absolute;left:117.78px;top:533.18px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Configuration properties can be used to override autoconfiguration settings,</span></div>
<div style="position:absolute;left:129.78px;top:546.17px" class="cls_039"><span class="cls_039">including the ability to specify a data-source URL and logging levels.</span></div>
<div style="position:absolute;left:117.78px;top:560.18px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Spring profiles can be used with property sources to conditionally set configura-</span></div>
<div style="position:absolute;left:129.78px;top:573.17px" class="cls_039"><span class="cls_039">tion properties based on the active profile(s).</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:103424px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background156.jpg" width="531" height="666"></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:103424px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background157.jpg" width="531" height="666"></div>
<div style="position:absolute;left:388.38px;top:82.94px" class="cls_014"><span class="cls_014">Part 2</span></div>
<div style="position:absolute;left:271.38px;top:142.94px" class="cls_014"><span class="cls_014">Integrated Spring</span></div>
<div style="position:absolute;left:126.18px;top:215.61px" class="cls_047"><span class="cls_047">T</span></div>
<div style="position:absolute;left:150.66px;top:253.67px" class="cls_039"><span class="cls_039">he chapters in part 2 cover topics that help integrate your Spring applica-</span></div>
<div style="position:absolute;left:126.18px;top:266.66px" class="cls_039"><span class="cls_039">tion with other applications.</span></div>
<div style="position:absolute;left:141.22px;top:279.65px" class="cls_039"><span class="cls_039">Chapter 6 expands on the discussion of Spring MVC started in chapter 2 by</span></div>
<div style="position:absolute;left:126.18px;top:292.67px" class="cls_039"><span class="cls_039">looking at how to write REST APIs in Spring. We’ll look at how to define REST</span></div>
<div style="position:absolute;left:126.18px;top:305.66px" class="cls_039"><span class="cls_039">endpoints in Spring MVC, enable hyperlinked REST resources, and automati-</span></div>
<div style="position:absolute;left:126.18px;top:318.68px" class="cls_039"><span class="cls_039">cally generate repository-based REST endpoints with Spring Data REST. Chapter 7</span></div>
<div style="position:absolute;left:126.18px;top:331.67px" class="cls_039"><span class="cls_039">switches perspective to show how a Spring application can consume a REST API.</span></div>
<div style="position:absolute;left:126.18px;top:344.66px" class="cls_039"><span class="cls_039">In chapter 8, we'll look at using asynchronous communication to enable a</span></div>
<div style="position:absolute;left:126.18px;top:357.68px" class="cls_039"><span class="cls_039">Spring application to both send and receive messages using the Java Message</span></div>
<div style="position:absolute;left:126.18px;top:370.67px" class="cls_039"><span class="cls_039">Service (JMS), RabbitMQ, and Kafka. And finally, chapter 9 discusses declarative</span></div>
<div style="position:absolute;left:126.18px;top:383.66px" class="cls_039"><span class="cls_039">application integration using the Spring Integration project. We’ll cover process-</span></div>
<div style="position:absolute;left:126.18px;top:396.68px" class="cls_039"><span class="cls_039">ing data in real time, defining integration flows, and integrating with external</span></div>
<div style="position:absolute;left:126.18px;top:409.67px" class="cls_039"><span class="cls_039">systems like emails and filesystems.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:104100px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background158.jpg" width="531" height="666"></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:104100px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background159.jpg" width="531" height="666"></div>
<div style="position:absolute;left:203.58px;top:111.83px" class="cls_014"><span class="cls_014">Creating REST services</span></div>
<div style="position:absolute;left:96.18px;top:264.85px" class="cls_049"><span class="cls_049">This chapter covers</span></div>
<div style="position:absolute;left:96.18px;top:283.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Defining REST endpoints in Spring MVC</span></div>
<div style="position:absolute;left:96.18px;top:298.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Enabling hyperlinked REST resources</span></div>
<div style="position:absolute;left:96.18px;top:313.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Automatic repository-based REST endpoints</span></div>
<div style="position:absolute;left:114.18px;top:383.54px" class="cls_039"><span class="cls_039">“The web browser is dead. What now?”</span></div>
<div style="position:absolute;left:129.27px;top:396.53px" class="cls_039"><span class="cls_039">Roughly a dozen years ago, I heard someone suggest that the web browser was</span></div>
<div style="position:absolute;left:114.18px;top:409.55px" class="cls_039"><span class="cls_039">nearing legacy status and that something else would take over. But how could this</span></div>
<div style="position:absolute;left:114.18px;top:422.54px" class="cls_039"><span class="cls_039">be? What could possibly dethrone the near-ubiquitous web browser? How would we</span></div>
<div style="position:absolute;left:114.18px;top:435.53px" class="cls_039"><span class="cls_039">consume the growing number of sites and online services if not with a web browser?</span></div>
<div style="position:absolute;left:114.18px;top:448.55px" class="cls_039"><span class="cls_039">Surely these were the ramblings of a madman!</span></div>
<div style="position:absolute;left:128.79px;top:461.54px" class="cls_039"><span class="cls_039">Fast-forward to the present day and it’s clear that the web browser hasn’t gone</span></div>
<div style="position:absolute;left:114.18px;top:474.56px" class="cls_039"><span class="cls_039">away. But it no longer reigns as the primary means of accessing the internet.</span></div>
<div style="position:absolute;left:114.18px;top:487.55px" class="cls_039"><span class="cls_039">Mobile devices, tablets, smart watches, and voice-based devices are now common-</span></div>
<div style="position:absolute;left:114.18px;top:500.54px" class="cls_039"><span class="cls_039">place. And even many browser-based applications are actually running JavaScript</span></div>
<div style="position:absolute;left:114.18px;top:513.56px" class="cls_039"><span class="cls_039">applications rather than letting the browser be a dumb terminal for server-</span></div>
<div style="position:absolute;left:114.18px;top:526.55px" class="cls_039"><span class="cls_039">rendered content.</span></div>
<div style="position:absolute;left:128.55px;top:539.54px" class="cls_039"><span class="cls_039">With such a vast selection of client-side options, many applications have adopted a</span></div>
<div style="position:absolute;left:114.18px;top:552.56px" class="cls_039"><span class="cls_039">common design where the user interface is pushed closer to the client and the</span></div>
<div style="position:absolute;left:269.16px;top:596.99px" class="cls_048"><span class="cls_048">137</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:104776px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background160.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">138</span></div>
<div style="position:absolute;left:197.31px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 6</span></div>
<div style="position:absolute;left:241.47px;top:24.35px" class="cls_055"><span class="cls_055">Creating REST services</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">server exposes an API through which all kinds of clients can interact with the backend</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">functionality.</span></div>
<div style="position:absolute;left:108.82px;top:76.67px" class="cls_039"><span class="cls_039">In this chapter, you’re going to use Spring to provide a REST API for the Taco</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">Cloud application. You’ll use what you learned about Spring MVC in chapter 2 to cre-</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">ate RESTful endpoints with Spring MVC controllers. You’ll also automatically expose</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">REST endpoints for the Spring Data repositories you defined in chapter 4. Finally,</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">we’ll look at ways to test and secure those endpoints.</span></div>
<div style="position:absolute;left:107.66px;top:141.65px" class="cls_039"><span class="cls_039">But first, you’ll start by writing a few new Spring MVC controllers that expose back-</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_039"><span class="cls_039">end functionality with REST endpoints to be consumed by a rich web frontend.</span></div>
<div style="position:absolute;left:57.18px;top:178.84px" class="cls_040"><span class="cls_040">6.1</span></div>
<div style="position:absolute;left:93.18px;top:178.84px" class="cls_040"><span class="cls_040">Writing RESTful controllers</span></div>
<div style="position:absolute;left:93.18px;top:196.67px" class="cls_039"><span class="cls_039">I hope you don’t mind, but while you were turning the page and reading the introduc-</span></div>
<div style="position:absolute;left:93.18px;top:209.66px" class="cls_039"><span class="cls_039">tion to this chapter, I took it upon myself to reimagine the user interface for Taco</span></div>
<div style="position:absolute;left:93.18px;top:222.65px" class="cls_039"><span class="cls_039">Cloud. What you’ve been working with has been fine for getting started, but it lacked</span></div>
<div style="position:absolute;left:93.18px;top:235.67px" class="cls_039"><span class="cls_039">in the aesthetics department.</span></div>
<div style="position:absolute;left:107.64px;top:248.66px" class="cls_039"><span class="cls_039">Figure 6.1 is just a sample of what the new Taco Cloud looks like. Pretty snazzy, huh?</span></div>
<div style="position:absolute;left:57.18px;top:590.39px" class="cls_053"><span class="cls_053">Figure 6.1</span></div>
<div style="position:absolute;left:101.78px;top:590.39px" class="cls_053"><span class="cls_053">The new Taco Cloud home page</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:105452px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background161.jpg" width="531" height="666"></div>
<div style="position:absolute;left:220.56px;top:24.35px" class="cls_055"><span class="cls_055">Writing RESTful controllers</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">139</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">And while I was spiffing up the Taco Cloud look, I also decided to build the frontend</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">as a single-page application using the popular Angular framework. Ultimately, this</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">new browser UI will replace the server-rendered pages you created in chapter 2. But</span></div>
<div style="position:absolute;left:102.18px;top:89.48px" class="cls_039"><span class="cls_039">for that to work, you’ll need to create a REST API that the Angular-based</span><span class="cls_069"><sup>1</sup></span><span class="cls_039"> UI will com-</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">municate with to save and fetch taco data.</span></div>
<div style="position:absolute;left:114.18px;top:134.48px" class="cls_075"><span class="cls_075">To SPA or not to SPA?</span></div>
<div style="position:absolute;left:114.18px;top:148.34px" class="cls_076"><span class="cls_076">You developed a traditional multipage application (MPA) with Spring MVC in chapter 2,</span></div>
<div style="position:absolute;left:114.18px;top:159.35px" class="cls_076"><span class="cls_076">and now you’re replacing that with a single-page application (SPA) based on Angular.</span></div>
<div style="position:absolute;left:114.18px;top:170.33px" class="cls_076"><span class="cls_076">But I’m not suggesting that SPA is always a better choice than MPA.</span></div>
<div style="position:absolute;left:114.18px;top:188.33px" class="cls_076"><span class="cls_076">Because presentation is largely decoupled from backend processing in a SPA, it</span></div>
<div style="position:absolute;left:114.18px;top:199.34px" class="cls_076"><span class="cls_076">affords the opportunity to develop more than one user interface (such as a native</span></div>
<div style="position:absolute;left:114.18px;top:210.35px" class="cls_076"><span class="cls_076">mobile application) for the same backend functionality. It also opens up the opportu-</span></div>
<div style="position:absolute;left:114.18px;top:221.33px" class="cls_076"><span class="cls_076">nity for integration with other applications that can consume the API. But not all appli-</span></div>
<div style="position:absolute;left:114.18px;top:232.34px" class="cls_076"><span class="cls_076">cations require that flexibility, and MPA is a simpler design if all you need is to display</span></div>
<div style="position:absolute;left:114.18px;top:243.35px" class="cls_076"><span class="cls_076">information on a web page.</span></div>
<div style="position:absolute;left:102.18px;top:275.66px" class="cls_039"><span class="cls_039">This isn’t a book on Angular, so the code in this chapter will focus primarily on the</span></div>
<div style="position:absolute;left:102.18px;top:288.65px" class="cls_039"><span class="cls_039">backend Spring code. I’ll show just enough Angular code to give you a feel for how</span></div>
<div style="position:absolute;left:102.18px;top:301.67px" class="cls_039"><span class="cls_039">the client side works. Rest assured that the complete set of code, including the</span></div>
<div style="position:absolute;left:102.18px;top:314.66px" class="cls_039"><span class="cls_039">Angular frontend, is available as part of the downloadable code for the book and at</span></div>
<div style="position:absolute;left:102.18px;top:327.68px" class="cls_045"><span class="cls_045"> </span><a href="https://github.com/habuma/spring-in-action-5-samples">https://github.com/habuma/spring-in-action-5-samples</a> <span class="cls_039">. You may also be interested</span></div>
<div style="position:absolute;left:102.18px;top:340.67px" class="cls_039"><span class="cls_039">in reading </span><span class="cls_036">Angular in Action</span><span class="cls_039"> by Jeremy Wilken (Manning, 2018) and </span><span class="cls_036">Angular Develop-</span></div>
<div style="position:absolute;left:102.18px;top:353.66px" class="cls_036"><span class="cls_036">ment with TypeScript, Second Edition</span><span class="cls_039"> by Yakov Fain and Anton Moiseev (Manning, 2018).</span></div>
<div style="position:absolute;left:116.60px;top:366.68px" class="cls_039"><span class="cls_039">In a nutshell, the Angular client code will communicate with an API that you’ll cre-</span></div>
<div style="position:absolute;left:102.18px;top:379.67px" class="cls_039"><span class="cls_039">ate throughout this chapter by way of HTTP requests. In chapter 2 you used </span><span class="cls_059">@Get-</span></div>
<div style="position:absolute;left:102.18px;top:392.66px" class="cls_059"><span class="cls_059">Mapping</span><span class="cls_039"> and </span><span class="cls_059">@PostMapping</span><span class="cls_039"> annotations to fetch and post data to the server. Those</span></div>
<div style="position:absolute;left:102.18px;top:405.68px" class="cls_039"><span class="cls_039">same annotations will still come in handy as you define your REST API. In addition,</span></div>
<div style="position:absolute;left:102.18px;top:418.67px" class="cls_039"><span class="cls_039">Spring MVC supports a handful of other annotations for various types of HTTP</span></div>
<div style="position:absolute;left:102.18px;top:431.66px" class="cls_039"><span class="cls_039">requests, as listed in table 6.1.</span></div>
<div style="position:absolute;left:102.18px;top:452.36px" class="cls_053"><span class="cls_053">Table 6.1</span></div>
<div style="position:absolute;left:143.91px;top:452.36px" class="cls_053"><span class="cls_053">Spring MVC’s HTTP request-handling annotations</span></div>
<div style="position:absolute;left:128.61px;top:473.90px" class="cls_073"><span class="cls_073">Annotation</span></div>
<div style="position:absolute;left:261.00px;top:473.90px" class="cls_073"><span class="cls_073">HTTP method</span></div>
<div style="position:absolute;left:402.33px;top:474.26px" class="cls_073"><span class="cls_073">Typical use</span><span class="cls_085"><sup>a</sup></span></div>
<div style="position:absolute;left:108.18px;top:493.43px" class="cls_060"><span class="cls_060">@GetMapping</span></div>
<div style="position:absolute;left:203.22px;top:493.43px" class="cls_074"><span class="cls_074">HTTP </span><span class="cls_060">GET</span><span class="cls_074"> requests</span></div>
<div style="position:absolute;left:381.93px;top:493.43px" class="cls_074"><span class="cls_074">Reading resource data</span></div>
<div style="position:absolute;left:108.18px;top:510.44px" class="cls_060"><span class="cls_060">@PostMapping</span></div>
<div style="position:absolute;left:203.22px;top:510.44px" class="cls_074"><span class="cls_074">HTTP </span><span class="cls_060">POST</span><span class="cls_074"> requests</span></div>
<div style="position:absolute;left:381.93px;top:510.44px" class="cls_074"><span class="cls_074">Creating a resource</span></div>
<div style="position:absolute;left:108.18px;top:527.45px" class="cls_060"><span class="cls_060">@PutMapping</span></div>
<div style="position:absolute;left:203.22px;top:527.45px" class="cls_074"><span class="cls_074">HTTP </span><span class="cls_060">PUT</span><span class="cls_074"> requests</span></div>
<div style="position:absolute;left:381.93px;top:527.45px" class="cls_074"><span class="cls_074">Updating a resource</span></div>
<div style="position:absolute;left:108.18px;top:544.43px" class="cls_060"><span class="cls_060">@PatchMapping</span></div>
<div style="position:absolute;left:203.22px;top:544.43px" class="cls_074"><span class="cls_074">HTTP </span><span class="cls_060">PATCH</span><span class="cls_074"> requests</span></div>
<div style="position:absolute;left:381.93px;top:544.43px" class="cls_074"><span class="cls_074">Updating a resource</span></div>
<div style="position:absolute;left:66.18px;top:573.50px" class="cls_070"><span class="cls_070">1</span></div>
<div style="position:absolute;left:75.18px;top:573.68px" class="cls_071"><span class="cls_071">I chose to use Angular, but the choice of frontend framework should have little to no bearing on how the</span></div>
<div style="position:absolute;left:75.18px;top:583.19px" class="cls_071"><span class="cls_071">backend Spring code is written. Feel free to choose Angular, React, Vue.js, or whatever frontend technology</span></div>
<div style="position:absolute;left:75.18px;top:592.67px" class="cls_071"><span class="cls_071">suits you best.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:106128px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background162.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">140</span></div>
<div style="position:absolute;left:197.31px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 6</span></div>
<div style="position:absolute;left:241.47px;top:24.35px" class="cls_055"><span class="cls_055">Creating REST services</span></div>
<div style="position:absolute;left:93.18px;top:51.32px" class="cls_053"><span class="cls_053">Table 6.1</span></div>
<div style="position:absolute;left:134.91px;top:51.32px" class="cls_053"><span class="cls_053">Spring MVC’s HTTP request-handling annotations</span><span class="cls_084"> (continued)</span></div>
<div style="position:absolute;left:119.61px;top:72.89px" class="cls_073"><span class="cls_073">Annotation</span></div>
<div style="position:absolute;left:252.00px;top:72.89px" class="cls_073"><span class="cls_073">HTTP method</span></div>
<div style="position:absolute;left:393.33px;top:73.25px" class="cls_073"><span class="cls_073">Typical use</span><span class="cls_085"><sup>a</sup></span></div>
<div style="position:absolute;left:99.18px;top:92.42px" class="cls_060"><span class="cls_060">@DeleteMapping</span></div>
<div style="position:absolute;left:194.22px;top:92.42px" class="cls_074"><span class="cls_074">HTTP </span><span class="cls_060">DELETE</span><span class="cls_074"> requests</span></div>
<div style="position:absolute;left:372.93px;top:92.42px" class="cls_074"><span class="cls_074">Deleting a resource</span></div>
<div style="position:absolute;left:99.18px;top:109.43px" class="cls_060"><span class="cls_060">@RequestMapping</span></div>
<div style="position:absolute;left:194.22px;top:109.43px" class="cls_074"><span class="cls_074">General purpose request handling; HTTP method</span></div>
<div style="position:absolute;left:194.22px;top:119.42px" class="cls_074"><span class="cls_074">specified in the </span><span class="cls_060">method</span><span class="cls_074"> attribute</span></div>
<div style="position:absolute;left:93.18px;top:136.76px" class="cls_086"><span class="cls_086">a  Mapping HTTP methods to create, read, update, and delete (CRUD) operations isn’t a perfect match, but in practice,</span></div>
<div style="position:absolute;left:103.98px;top:145.76px" class="cls_086"><span class="cls_086">that’s how they’re often used and how you’ll use them in Taco Cloud.</span></div>
<div style="position:absolute;left:93.18px;top:167.75px" class="cls_039"><span class="cls_039">To see these annotations in action, you’ll start by creating a simple REST endpoint</span></div>
<div style="position:absolute;left:93.18px;top:180.74px" class="cls_039"><span class="cls_039">that fetches a few of the most recently created tacos.</span></div>
<div style="position:absolute;left:57.18px;top:202.58px" class="cls_063"><span class="cls_063">6.1.1</span></div>
<div style="position:absolute;left:93.18px;top:202.58px" class="cls_063"><span class="cls_063">Retrieving data from the server</span></div>
<div style="position:absolute;left:93.18px;top:219.77px" class="cls_039"><span class="cls_039">One of the coolest things about Taco Cloud is that it allows taco fanatics to design</span></div>
<div style="position:absolute;left:93.18px;top:232.76px" class="cls_039"><span class="cls_039">their own taco creations and share them with their fellow taco lovers. To this end,</span></div>
<div style="position:absolute;left:93.18px;top:245.75px" class="cls_039"><span class="cls_039">Taco Cloud needs to be able to display a list of the most recently created tacos when</span></div>
<div style="position:absolute;left:93.18px;top:258.77px" class="cls_039"><span class="cls_039">the Latest Designs link is clicked.</span></div>
<div style="position:absolute;left:107.85px;top:271.76px" class="cls_039"><span class="cls_039">In the Angular code I’ve defined a </span><span class="cls_059">RecentTacosComponent</span><span class="cls_039"> that will display the most</span></div>
<div style="position:absolute;left:93.18px;top:284.75px" class="cls_039"><span class="cls_039">recently created tacos. The complete TypeScript code for </span><span class="cls_059">RecentTacosComponent</span><span class="cls_039"> is</span></div>
<div style="position:absolute;left:93.18px;top:297.77px" class="cls_039"><span class="cls_039">shown in the next listing.</span></div>
<div style="position:absolute;left:105.18px;top:321.47px" class="cls_066"><span class="cls_066">Listing 6.1</span></div>
<div style="position:absolute;left:157.26px;top:321.47px" class="cls_066"><span class="cls_066">Angular component for displaying recent tacos</span></div>
<div style="position:absolute;left:93.18px;top:341.33px" class="cls_060"><span class="cls_060">import { Component, OnInit, Injectable } from '@angular/core';</span></div>
<div style="position:absolute;left:93.18px;top:351.35px" class="cls_060"><span class="cls_060">import { Http } from '@angular/http';</span></div>
<div style="position:absolute;left:93.18px;top:361.34px" class="cls_060"><span class="cls_060">import { HttpClient } from '@angular/common/http';</span></div>
<div style="position:absolute;left:93.18px;top:381.35px" class="cls_060"><span class="cls_060">@Component({</span></div>
<div style="position:absolute;left:102.78px;top:391.34px" class="cls_060"><span class="cls_060">selector: 'recent-tacos',</span></div>
<div style="position:absolute;left:102.78px;top:401.33px" class="cls_060"><span class="cls_060">templateUrl: 'recents.component.html',</span></div>
<div style="position:absolute;left:102.78px;top:411.35px" class="cls_060"><span class="cls_060">styleUrls: ['./recents.component.css']</span></div>
<div style="position:absolute;left:93.18px;top:421.34px" class="cls_060"><span class="cls_060">})</span></div>
<div style="position:absolute;left:93.18px;top:441.35px" class="cls_060"><span class="cls_060">@Injectable()</span></div>
<div style="position:absolute;left:93.18px;top:451.34px" class="cls_060"><span class="cls_060">export class RecentTacosComponent implements OnInit {</span></div>
<div style="position:absolute;left:102.78px;top:461.33px" class="cls_060"><span class="cls_060">recentTacos: any;</span></div>
<div style="position:absolute;left:102.78px;top:481.34px" class="cls_060"><span class="cls_060">constructor(private httpClient: HttpClient) { }</span></div>
<div style="position:absolute;left:433.62px;top:479.99px" class="cls_067"><span class="cls_067">Fetches</span></div>
<div style="position:absolute;left:433.62px;top:489.47px" class="cls_067"><span class="cls_067">recent tacos</span></div>
<div style="position:absolute;left:102.78px;top:501.35px" class="cls_060"><span class="cls_060">ngOnInit() {</span></div>
<div style="position:absolute;left:433.62px;top:498.98px" class="cls_067"><span class="cls_067">from the</span></div>
<div style="position:absolute;left:112.38px;top:511.34px" class="cls_060"><span class="cls_060">this.httpClient.get('</span><a href="http://localhost:8080/design/recent&#39;/">http://localhost:8080/design/recent'</a>)</div>
<div style="position:absolute;left:433.62px;top:508.49px" class="cls_067"><span class="cls_067">server</span></div>
<div style="position:absolute;left:131.56px;top:521.33px" class="cls_060"><span class="cls_060">.subscribe(data =&gt; this.recentTacos = data);</span></div>
<div style="position:absolute;left:102.78px;top:531.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:541.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:562.67px" class="cls_039"><span class="cls_039">Turn your attention to the </span><span class="cls_059">ngOnInit()</span><span class="cls_039"> method. In that method, </span><span class="cls_059">RecentTacos-</span></div>
<div style="position:absolute;left:93.27px;top:575.66px" class="cls_059"><span class="cls_059">Component</span><span class="cls_039"> uses the injected </span><span class="cls_059">Http</span><span class="cls_039"> module to perform an HTTP </span><span class="cls_059">GET</span><span class="cls_039"> request to </span><a href="http://localhost:8080/design/recent">http://</a> </div>
<div style="position:absolute;left:93.18px;top:588.68px" class="cls_045"><span class="cls_045"> </span><a href="http://localhost:8080/design/recent">localhost:8080/design/recent</a> <span class="cls_039">, expecting that the response will contain a list of taco</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:106804px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background163.jpg" width="531" height="666"></div>
<div style="position:absolute;left:220.56px;top:24.35px" class="cls_055"><span class="cls_055">Writing RESTful controllers</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">141</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">designs, which will be placed in the </span><span class="cls_059">recentTacos</span><span class="cls_039"> model variable. The view (in recents</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">.component.html) will present that model data as HTML to be rendered in the</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">browser. The end result might look something like figure 6.2, after three tacos have</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">been created.</span></div>
<div style="position:absolute;left:66.18px;top:430.73px" class="cls_053"><span class="cls_053">Figure 6.2</span></div>
<div style="position:absolute;left:110.78px;top:430.73px" class="cls_053"><span class="cls_053">Displaying the most recently created tacos</span></div>
<div style="position:absolute;left:102.18px;top:465.26px" class="cls_039"><span class="cls_039">The missing piece in this puzzle is an endpoint that handles </span><span class="cls_059">GET</span><span class="cls_039"> requests for /design/</span></div>
<div style="position:absolute;left:102.18px;top:478.25px" class="cls_039"><span class="cls_039">recent and responds with a list of recently designed tacos. You’ll create a new control-</span></div>
<div style="position:absolute;left:102.18px;top:491.24px" class="cls_039"><span class="cls_039">ler to handle such a request. The next listing shows the controller for the job.</span></div>
<div style="position:absolute;left:114.18px;top:514.97px" class="cls_066"><span class="cls_066">Listing 6.2</span></div>
<div style="position:absolute;left:166.27px;top:514.97px" class="cls_066"><span class="cls_066">A RESTful controller for taco design API requests</span></div>
<div style="position:absolute;left:102.18px;top:534.83px" class="cls_060"><span class="cls_060">package tacos.web.api;</span></div>
<div style="position:absolute;left:102.18px;top:554.84px" class="cls_060"><span class="cls_060">import java.util.Optional;</span></div>
<div style="position:absolute;left:102.18px;top:574.82px" class="cls_060"><span class="cls_060">import org.springframework.beans.factory.annotation.Autowired;</span></div>
<div style="position:absolute;left:102.18px;top:584.84px" class="cls_060"><span class="cls_060">import org.springframework.data.domain.PageRequest;</span></div>
<div style="position:absolute;left:102.18px;top:594.83px" class="cls_060"><span class="cls_060">import org.springframework.data.domain.Sort;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:107480px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background164.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">142</span></div>
<div style="position:absolute;left:197.31px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 6</span></div>
<div style="position:absolute;left:241.47px;top:24.35px" class="cls_055"><span class="cls_055">Creating REST services</span></div>
<div style="position:absolute;left:93.18px;top:51.32px" class="cls_060"><span class="cls_060">import org.springframework.hateoas.EntityLinks;</span></div>
<div style="position:absolute;left:93.18px;top:61.34px" class="cls_060"><span class="cls_060">import org.springframework.http.HttpStatus;</span></div>
<div style="position:absolute;left:93.18px;top:71.33px" class="cls_060"><span class="cls_060">import org.springframework.web.bind.annotation.CrossOrigin;</span></div>
<div style="position:absolute;left:93.18px;top:81.32px" class="cls_060"><span class="cls_060">import org.springframework.web.bind.annotation.GetMapping;</span></div>
<div style="position:absolute;left:93.18px;top:91.34px" class="cls_060"><span class="cls_060">import org.springframework.web.bind.annotation.PathVariable;</span></div>
<div style="position:absolute;left:93.18px;top:101.33px" class="cls_060"><span class="cls_060">import org.springframework.web.bind.annotation.RequestMapping;</span></div>
<div style="position:absolute;left:93.18px;top:111.32px" class="cls_060"><span class="cls_060">import org.springframework.web.bind.annotation.ResponseStatus;</span></div>
<div style="position:absolute;left:93.18px;top:121.34px" class="cls_060"><span class="cls_060">import org.springframework.web.bind.annotation.RestController;</span></div>
<div style="position:absolute;left:93.18px;top:141.35px" class="cls_060"><span class="cls_060">import tacos.Taco;</span></div>
<div style="position:absolute;left:93.18px;top:151.34px" class="cls_060"><span class="cls_060">import tacos.data.TacoRepository;</span></div>
<div style="position:absolute;left:330.78px;top:167.66px" class="cls_067"><span class="cls_067">Handles requests</span></div>
<div style="position:absolute;left:93.18px;top:171.35px" class="cls_060"><span class="cls_060">@RestController</span></div>
<div style="position:absolute;left:330.78px;top:177.14px" class="cls_067"><span class="cls_067">for /design</span></div>
<div style="position:absolute;left:93.18px;top:181.34px" class="cls_060"><span class="cls_060">@RequestMapping(path="/design",</span></div>
<div style="position:absolute;left:169.95px;top:191.33px" class="cls_060"><span class="cls_060">produces="application/json")</span></div>
<div style="position:absolute;left:93.18px;top:201.35px" class="cls_060"><span class="cls_060">@CrossOrigin(origins="*")</span></div>
<div style="position:absolute;left:330.78px;top:204.62px" class="cls_067"><span class="cls_067">Allows cross-</span></div>
<div style="position:absolute;left:93.18px;top:211.34px" class="cls_060"><span class="cls_060">public class DesignTacoController {</span></div>
<div style="position:absolute;left:330.78px;top:214.13px" class="cls_067"><span class="cls_067">origin requests</span></div>
<div style="position:absolute;left:102.78px;top:221.33px" class="cls_060"><span class="cls_060">private TacoRepository tacoRepo;</span></div>
<div style="position:absolute;left:102.78px;top:241.34px" class="cls_060"><span class="cls_060">@Autowired</span></div>
<div style="position:absolute;left:102.78px;top:251.33px" class="cls_060"><span class="cls_060">EntityLinks entityLinks;</span></div>
<div style="position:absolute;left:102.78px;top:271.34px" class="cls_060"><span class="cls_060">public DesignTacoController(TacoRepository tacoRepo) {</span></div>
<div style="position:absolute;left:112.38px;top:281.33px" class="cls_060"><span class="cls_060">this.tacoRepo = tacoRepo;</span></div>
<div style="position:absolute;left:102.78px;top:291.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:330.78px;top:307.64px" class="cls_067"><span class="cls_067">Fetches and returns</span></div>
<div style="position:absolute;left:102.78px;top:311.33px" class="cls_060"><span class="cls_060">@GetMapping("/recent")</span></div>
<div style="position:absolute;left:330.78px;top:317.15px" class="cls_067"><span class="cls_067">recent taco designs</span></div>
<div style="position:absolute;left:102.77px;top:321.35px" class="cls_060"><span class="cls_060">public Iterable&lt;Taco&gt; recentTacos() {</span></div>
<div style="position:absolute;left:112.38px;top:331.34px" class="cls_060"><span class="cls_060">PageRequest page = PageRequest.of(</span></div>
<div style="position:absolute;left:150.76px;top:341.33px" class="cls_060"><span class="cls_060">0, 12, Sort.by("createdAt").descending());</span></div>
<div style="position:absolute;left:112.38px;top:351.35px" class="cls_060"><span class="cls_060">return tacoRepo.findAll(page).getContent();</span></div>
<div style="position:absolute;left:102.78px;top:361.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:371.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:392.66px" class="cls_039"><span class="cls_039">You may be thinking that this controller’s name sounds familiar. In chapter 2 you cre-</span></div>
<div style="position:absolute;left:93.18px;top:405.68px" class="cls_039"><span class="cls_039">ated a </span><span class="cls_059">DesignTacoController</span><span class="cls_039"> that handled similar types of requests. But where that</span></div>
<div style="position:absolute;left:93.18px;top:418.67px" class="cls_039"><span class="cls_039">controller was for the multipage Taco Cloud application, this new </span><span class="cls_059">DesignTaco-</span></div>
<div style="position:absolute;left:93.18px;top:431.66px" class="cls_059"><span class="cls_059">Controller</span><span class="cls_039"> is a REST controller, as indicated by the </span><span class="cls_059">@RestController</span><span class="cls_039"> annotation.</span></div>
<div style="position:absolute;left:107.64px;top:444.68px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">@RestController</span><span class="cls_039"> annotation serves two purposes. First, it’s a stereotype anno-</span></div>
<div style="position:absolute;left:93.18px;top:457.67px" class="cls_039"><span class="cls_039">tation like </span><span class="cls_059">@Controller</span><span class="cls_039"> and </span><span class="cls_059">@Service</span><span class="cls_039"> that marks a class for discovery by component</span></div>
<div style="position:absolute;left:93.18px;top:470.66px" class="cls_039"><span class="cls_039">scanning. But most relevant to the discussion of REST, the </span><span class="cls_059">@RestController</span><span class="cls_039"> annota-</span></div>
<div style="position:absolute;left:93.18px;top:483.68px" class="cls_039"><span class="cls_039">tion tells Spring that all handler methods in the controller should have their return</span></div>
<div style="position:absolute;left:93.18px;top:496.67px" class="cls_039"><span class="cls_039">value written directly to the body of the response, rather than being carried in the</span></div>
<div style="position:absolute;left:93.18px;top:509.66px" class="cls_039"><span class="cls_039">model to a view for rendering.</span></div>
<div style="position:absolute;left:107.51px;top:522.68px" class="cls_039"><span class="cls_039">Alternatively, you could have annotated </span><span class="cls_059">DesignTacoController</span><span class="cls_039"> with </span><span class="cls_059">@Controller</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:93.18px;top:535.67px" class="cls_039"><span class="cls_039">just like with any Spring MVC controller. But then you’d need to also annotate all of</span></div>
<div style="position:absolute;left:93.18px;top:548.66px" class="cls_039"><span class="cls_039">the handler methods with </span><span class="cls_059">@ResponseBody</span><span class="cls_039"> to achieve the same result. Yet another</span></div>
<div style="position:absolute;left:93.18px;top:561.68px" class="cls_039"><span class="cls_039">option would be to return a </span><span class="cls_059">ResponseEntity</span><span class="cls_039"> object, which we’ll discuss in a moment.</span></div>
<div style="position:absolute;left:109.05px;top:574.67px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">@RequestMapping</span><span class="cls_039"> annotation at the class level works with the </span><span class="cls_059">@GetMapping</span></div>
<div style="position:absolute;left:93.18px;top:587.69px" class="cls_039"><span class="cls_039">annotation on the </span><span class="cls_059">recentTacos()</span><span class="cls_039"> method to specify that the </span><span class="cls_059">recentTacos()</span><span class="cls_039"> method</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:108156px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background165.jpg" width="531" height="666"></div>
<div style="position:absolute;left:220.56px;top:24.35px" class="cls_055"><span class="cls_055">Writing RESTful controllers</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">143</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">is responsible for handling </span><span class="cls_059">GET</span><span class="cls_039"> requests for /design/recent (which is exactly what</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">your Angular code needs).</span></div>
<div style="position:absolute;left:117.22px;top:76.67px" class="cls_039"><span class="cls_039">You’ll notice that the </span><span class="cls_059">@RequestMapping</span><span class="cls_039"> annotation also sets a </span><span class="cls_059">produces</span><span class="cls_039"> attribute.</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">This specifies that any of the handler methods in </span><span class="cls_059">DesignTacoController</span><span class="cls_039"> will only</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">handle requests if the request’s </span><span class="cls_059">Accept</span><span class="cls_039"> header includes “application/json”. Not only</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">does this limit your API to only producing JSON results, it also allows for another con-</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">troller (perhaps the </span><span class="cls_059">DesignTacoController</span><span class="cls_039"> from chapter 2) to handle requests with</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">the same paths, so long as those requests don’t require JSON output. Even though this</span></div>
<div style="position:absolute;left:102.18px;top:154.67px" class="cls_039"><span class="cls_039">limits your API to being JSON-based (which is fine for your needs), you’re welcome to</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">set </span><span class="cls_059">produces</span><span class="cls_039"> to an array of </span><span class="cls_059">String</span><span class="cls_039"> for multiple content types. For example, to allow</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">for XML output, you could add “text/html” to the </span><span class="cls_059">produces</span><span class="cls_039"> attribute:</span></div>
<div style="position:absolute;left:102.18px;top:203.33px" class="cls_060"><span class="cls_060">@RequestMapping(path="/design",</span></div>
<div style="position:absolute;left:178.95px;top:213.35px" class="cls_061"><span class="cls_061">produces={"application/json", "text/xml"})</span></div>
<div style="position:absolute;left:102.18px;top:236.66px" class="cls_039"><span class="cls_039">The other thing you may have noticed in listing 6.2 is that the class is annotated with</span></div>
<div style="position:absolute;left:102.18px;top:249.65px" class="cls_059"><span class="cls_059">@CrossOrigin</span><span class="cls_039">. Because the Angular portion of the application will be running on a</span></div>
<div style="position:absolute;left:102.18px;top:262.67px" class="cls_039"><span class="cls_039">separate host and/or port from the API (at least for now), the web browser will pre-</span></div>
<div style="position:absolute;left:102.18px;top:275.66px" class="cls_039"><span class="cls_039">vent your Angular client from consuming the API. This restriction can be overcome</span></div>
<div style="position:absolute;left:102.18px;top:288.65px" class="cls_039"><span class="cls_039">by including CORS (Cross-Origin Resource Sharing) headers in the server responses.</span></div>
<div style="position:absolute;left:102.18px;top:301.67px" class="cls_039"><span class="cls_039">Spring makes it easy to apply CORS with the </span><span class="cls_059">@CrossOrigin</span><span class="cls_039"> annotation. As applied</span></div>
<div style="position:absolute;left:102.18px;top:314.66px" class="cls_039"><span class="cls_039">here, </span><span class="cls_059">@CrossOrigin</span><span class="cls_039"> allows clients from any domain to consume the API.</span></div>
<div style="position:absolute;left:117.00px;top:327.68px" class="cls_039"><span class="cls_039">The logic within the </span><span class="cls_059">recentTacos()</span><span class="cls_039"> method is fairly straightforward. It constructs</span></div>
<div style="position:absolute;left:102.18px;top:340.67px" class="cls_039"><span class="cls_039">a </span><span class="cls_059">PageRequest</span><span class="cls_039"> object that specifies that you only want the first (0th) page of 12 results,</span></div>
<div style="position:absolute;left:102.18px;top:353.66px" class="cls_039"><span class="cls_039">sorted in descending order by the taco’s creation date. In short, you want a dozen of</span></div>
<div style="position:absolute;left:102.18px;top:366.68px" class="cls_039"><span class="cls_039">the most recently created taco designs. The </span><span class="cls_059">PageRequest</span><span class="cls_039"> is passed into the call to the</span></div>
<div style="position:absolute;left:102.18px;top:379.67px" class="cls_059"><span class="cls_059">findAll()</span><span class="cls_039"> method of </span><span class="cls_059">TacoRepository</span><span class="cls_039">, and the content of that page of results is</span></div>
<div style="position:absolute;left:102.18px;top:392.66px" class="cls_039"><span class="cls_039">returned to the client (which, as you saw in listing 6.1, will be used as model data to</span></div>
<div style="position:absolute;left:102.18px;top:405.68px" class="cls_039"><span class="cls_039">display to the user).</span></div>
<div style="position:absolute;left:116.80px;top:418.67px" class="cls_039"><span class="cls_039">Now let’s say that you want to offer an endpoint that fetches a single taco by its ID.</span></div>
<div style="position:absolute;left:102.18px;top:431.66px" class="cls_039"><span class="cls_039">By using a placeholder variable in the handler method’s path and accepting a path</span></div>
<div style="position:absolute;left:102.18px;top:444.68px" class="cls_039"><span class="cls_039">variable, you can capture the ID and use it to look up the </span><span class="cls_059">Taco</span><span class="cls_039"> object through the</span></div>
<div style="position:absolute;left:102.18px;top:457.67px" class="cls_039"><span class="cls_039">repository:</span></div>
<div style="position:absolute;left:102.18px;top:480.35px" class="cls_060"><span class="cls_060">@GetMapping("/{id}")</span></div>
<div style="position:absolute;left:102.18px;top:490.34px" class="cls_060"><span class="cls_060">public Taco tacoById(@PathVariable("id") Long id) {</span></div>
<div style="position:absolute;left:111.78px;top:500.36px" class="cls_060"><span class="cls_060">Optional&lt;Taco&gt; optTaco = tacoRepo.findById(id);</span></div>
<div style="position:absolute;left:111.77px;top:510.35px" class="cls_060"><span class="cls_060">if (optTaco.isPresent()) {</span></div>
<div style="position:absolute;left:121.38px;top:520.34px" class="cls_060"><span class="cls_060">return optTaco.get();</span></div>
<div style="position:absolute;left:111.78px;top:530.36px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:540.35px" class="cls_060"><span class="cls_060">return null;</span></div>
<div style="position:absolute;left:102.18px;top:550.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:573.68px" class="cls_039"><span class="cls_039">Because the controller’s base path is /design, this controller method handles </span><span class="cls_059">GET</span></div>
<div style="position:absolute;left:102.18px;top:586.67px" class="cls_039"><span class="cls_039">requests for </span><span class="cls_059">/design/{id}</span><span class="cls_039">, where the </span><span class="cls_059">{id}</span><span class="cls_039"> portion of the path is a placeholder. The</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:108832px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background166.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">144</span></div>
<div style="position:absolute;left:197.31px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 6</span></div>
<div style="position:absolute;left:241.47px;top:24.35px" class="cls_055"><span class="cls_055">Creating REST services</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">actual value in the request is given to the </span><span class="cls_059">id</span><span class="cls_039"> parameter, which is mapped to the </span><span class="cls_059">{id}</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">placeholder by </span><span class="cls_059">@PathVariable</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:108.63px;top:76.67px" class="cls_039"><span class="cls_039">Inside of </span><span class="cls_059">tacoById()</span><span class="cls_039">, the </span><span class="cls_059">id</span><span class="cls_039"> parameter is passed to the repository’s </span><span class="cls_059">findById()</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">method to fetch the </span><span class="cls_059">Taco</span><span class="cls_039">. </span><span class="cls_059">findById()</span><span class="cls_039"> returns an </span><span class="cls_059">Optional&lt;Taco&gt;</span><span class="cls_039"> because there may</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">not be a taco with the given ID. Therefore, you need to determine whether the ID</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">matched a taco or not before returning a value. If it matches, you call </span><span class="cls_059">get()</span><span class="cls_039"> on the</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_059"><span class="cls_059">Optional&lt;Taco&gt;</span><span class="cls_039"> object to return the actual </span><span class="cls_059">Taco</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:108.63px;top:141.65px" class="cls_039"><span class="cls_039">If the ID doesn’t match any known tacos, you return </span><span class="cls_059">null</span><span class="cls_039">. This, however, is less</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_039"><span class="cls_039">than ideal. By returning </span><span class="cls_059">null</span><span class="cls_039">, the client receives a response with an empty body and</span></div>
<div style="position:absolute;left:93.18px;top:167.66px" class="cls_039"><span class="cls_039">an HTTP status code of 200 (OK). The client is handed a response it can’t use, but the</span></div>
<div style="position:absolute;left:93.18px;top:180.65px" class="cls_039"><span class="cls_039">status code indicates everything is fine. A better approach would be to return a</span></div>
<div style="position:absolute;left:93.18px;top:193.67px" class="cls_039"><span class="cls_039">response with an HTTP 404 (NOT FOUND) status.</span></div>
<div style="position:absolute;left:107.73px;top:206.66px" class="cls_039"><span class="cls_039">As it’s currently written, there’s no easy way to return a 404 status code from </span><span class="cls_059">taco-</span></div>
<div style="position:absolute;left:93.18px;top:219.65px" class="cls_059"><span class="cls_059">ById()</span><span class="cls_039">. But if you make a few small tweaks, you can set the status code appropriately:</span></div>
<div style="position:absolute;left:93.18px;top:239.33px" class="cls_060"><span class="cls_060">@GetMapping("/{id}")</span></div>
<div style="position:absolute;left:93.18px;top:249.35px" class="cls_060"><span class="cls_060">public ResponseEntity&lt;Taco&gt; tacoById(@PathVariable("id") Long id) {</span></div>
<div style="position:absolute;left:102.77px;top:259.34px" class="cls_060"><span class="cls_060">Optional&lt;Taco&gt; optTaco = tacoRepo.findById(id);</span></div>
<div style="position:absolute;left:102.77px;top:269.33px" class="cls_060"><span class="cls_060">if (optTaco.isPresent()) {</span></div>
<div style="position:absolute;left:112.38px;top:279.35px" class="cls_060"><span class="cls_060">return new ResponseEntity&lt;&gt;(optTaco.get(), HttpStatus.OK);</span></div>
<div style="position:absolute;left:102.78px;top:289.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.78px;top:299.33px" class="cls_060"><span class="cls_060">return new ResponseEntity&lt;&gt;(null, HttpStatus.NOT_FOUND);</span></div>
<div style="position:absolute;left:93.18px;top:309.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:330.68px" class="cls_039"><span class="cls_039">Now, instead of returning a </span><span class="cls_059">Taco</span><span class="cls_039"> object, </span><span class="cls_059">tacoById()</span><span class="cls_039"> returns a </span><span class="cls_059">ResponseEntity&lt;Taco&gt;</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:93.18px;top:343.67px" class="cls_039"><span class="cls_039">If the taco is found, you wrap the </span><span class="cls_059">Taco</span><span class="cls_039"> object in a </span><span class="cls_059">ResponseEntity</span><span class="cls_039"> with an HTTP sta-</span></div>
<div style="position:absolute;left:93.18px;top:356.66px" class="cls_039"><span class="cls_039">tus of OK (which is what the behavior was before). But if the taco isn’t found, you</span></div>
<div style="position:absolute;left:93.18px;top:369.68px" class="cls_039"><span class="cls_039">wrap a </span><span class="cls_059">null</span><span class="cls_039"> in a </span><span class="cls_059">ResponseEntity</span><span class="cls_039"> along with an HTTP status of NOT FOUND to indi-</span></div>
<div style="position:absolute;left:93.18px;top:382.67px" class="cls_039"><span class="cls_039">cate that the client is trying to fetch a taco that doesn’t exist.</span></div>
<div style="position:absolute;left:107.94px;top:395.66px" class="cls_039"><span class="cls_039">You now have the start of a Taco Cloud API for your Angular client—or any other</span></div>
<div style="position:absolute;left:93.18px;top:408.68px" class="cls_039"><span class="cls_039">kind of client, for that matter. For development testing purposes, you may also want to</span></div>
<div style="position:absolute;left:93.18px;top:421.67px" class="cls_039"><span class="cls_039">use command-line utilities like curl or HTTPie (</span><a href="https://httpie.org/">https://httpie.org/</a> <span class="cls_039">) to poke about</span></div>
<div style="position:absolute;left:93.18px;top:434.66px" class="cls_039"><span class="cls_039">the API. For example, the following command line shows how you might fetch</span></div>
<div style="position:absolute;left:93.18px;top:447.68px" class="cls_039"><span class="cls_039">recently created tacos with curl:</span></div>
<div style="position:absolute;left:93.18px;top:470.36px" class="cls_061"><span class="cls_061">$ curl localhost:8080/design/recent</span></div>
<div style="position:absolute;left:93.18px;top:493.67px" class="cls_039"><span class="cls_039">Or like this if you prefer HTTPie:</span></div>
<div style="position:absolute;left:93.18px;top:516.35px" class="cls_061"><span class="cls_061">$ http :8080/design/recent</span></div>
<div style="position:absolute;left:93.18px;top:539.66px" class="cls_039"><span class="cls_039">But defining an endpoint that returns information is only the start. What if your API</span></div>
<div style="position:absolute;left:93.18px;top:552.68px" class="cls_039"><span class="cls_039">needs to receive data from the client? Let’s see how you can write controller methods</span></div>
<div style="position:absolute;left:93.18px;top:565.67px" class="cls_039"><span class="cls_039">that handle input on the requests.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:109508px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background167.jpg" width="531" height="666"></div>
<div style="position:absolute;left:220.56px;top:24.35px" class="cls_055"><span class="cls_055">Writing RESTful controllers</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">145</span></div>
<div style="position:absolute;left:66.18px;top:50.48px" class="cls_063"><span class="cls_063">6.1.2</span></div>
<div style="position:absolute;left:102.18px;top:50.48px" class="cls_063"><span class="cls_063">Sending data to the server</span></div>
<div style="position:absolute;left:102.18px;top:67.67px" class="cls_039"><span class="cls_039">So far your API is able to return a dozen of the most recently created tacos. But how</span></div>
<div style="position:absolute;left:102.18px;top:80.66px" class="cls_039"><span class="cls_039">did those tacos get created in the first place?</span></div>
<div style="position:absolute;left:118.15px;top:93.65px" class="cls_039"><span class="cls_039">You haven’t deleted any code from chapter 2 yet, so you still have the original</span></div>
<div style="position:absolute;left:102.18px;top:106.67px" class="cls_059"><span class="cls_059">DesignTacoController</span><span class="cls_039"> that displays a taco design form and handles form submission.</span></div>
<div style="position:absolute;left:102.18px;top:119.66px" class="cls_039"><span class="cls_039">That’s a great way to get some test data in place to test the API you’ve created. But if</span></div>
<div style="position:absolute;left:102.18px;top:132.65px" class="cls_039"><span class="cls_039">you’re going to transform Taco Cloud into a single-page application, you’ll need to</span></div>
<div style="position:absolute;left:102.18px;top:145.67px" class="cls_039"><span class="cls_039">create Angular components and corresponding endpoints to replace that taco design</span></div>
<div style="position:absolute;left:102.18px;top:158.66px" class="cls_039"><span class="cls_039">form from chapter 2.</span></div>
<div style="position:absolute;left:117.74px;top:171.65px" class="cls_039"><span class="cls_039">I’ve already handled the client code for the taco design form by defining a new</span></div>
<div style="position:absolute;left:102.18px;top:184.67px" class="cls_039"><span class="cls_039">Angular component named </span><span class="cls_059">DesignComponent</span><span class="cls_039"> (in a file named design.component.ts).</span></div>
<div style="position:absolute;left:102.18px;top:197.66px" class="cls_039"><span class="cls_039">As it pertains to handling form submission, </span><span class="cls_059">DesignComponent</span><span class="cls_039"> has an </span><span class="cls_059">onSubmit()</span></div>
<div style="position:absolute;left:102.18px;top:210.65px" class="cls_039"><span class="cls_039">method that looks like this:</span></div>
<div style="position:absolute;left:102.18px;top:230.33px" class="cls_060"><span class="cls_060">onSubmit() {</span></div>
<div style="position:absolute;left:111.78px;top:240.35px" class="cls_060"><span class="cls_060">this.httpClient.post(</span></div>
<div style="position:absolute;left:130.95px;top:250.34px" class="cls_060"><span class="cls_060">'</span><a href="http://localhost:8080/design&#39;/">http://localhost:8080/design'</a>,</div>
<div style="position:absolute;left:130.93px;top:260.33px" class="cls_060"><span class="cls_060">this.model, {</span></div>
<div style="position:absolute;left:150.15px;top:270.35px" class="cls_060"><span class="cls_060">headers: new HttpHeaders().set('Content-type', 'application/json'),</span></div>
<div style="position:absolute;left:130.96px;top:280.34px" class="cls_060"><span class="cls_060">}).subscribe(taco =&gt; this.cart.addToCart(taco));</span></div>
<div style="position:absolute;left:111.78px;top:300.35px" class="cls_060"><span class="cls_060">this.router.navigate(['/cart']);</span></div>
<div style="position:absolute;left:102.18px;top:310.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:330.68px" class="cls_039"><span class="cls_039">In the </span><span class="cls_059">onSubmit()</span><span class="cls_039"> method, the </span><span class="cls_059">post()</span><span class="cls_039"> method of </span><span class="cls_059">HttpClient</span><span class="cls_039"> is called instead of</span></div>
<div style="position:absolute;left:102.18px;top:343.67px" class="cls_059"><span class="cls_059">get()</span><span class="cls_039">. This means that instead of fetching data from the API, you’re sending data to</span></div>
<div style="position:absolute;left:102.18px;top:356.66px" class="cls_039"><span class="cls_039">the API. Specifically, you’re sending a taco design, which is held in the </span><span class="cls_059">model</span><span class="cls_039"> variable,</span></div>
<div style="position:absolute;left:102.18px;top:369.68px" class="cls_039"><span class="cls_039">to the API endpoint at /design with an HTTP </span><span class="cls_059">POST</span><span class="cls_039"> request.</span></div>
<div style="position:absolute;left:117.38px;top:382.67px" class="cls_039"><span class="cls_039">This means that you’ll need to write a method in </span><span class="cls_059">DesignTacoController</span><span class="cls_039"> to han-</span></div>
<div style="position:absolute;left:102.18px;top:395.66px" class="cls_039"><span class="cls_039">dle that request and save the design. By adding the following </span><span class="cls_059">postTaco()</span><span class="cls_039"> method to</span></div>
<div style="position:absolute;left:102.18px;top:408.68px" class="cls_059"><span class="cls_059">DesignTacoController</span><span class="cls_039">, you enable the controller to do exactly that:</span></div>
<div style="position:absolute;left:102.18px;top:428.36px" class="cls_060"><span class="cls_060">@PostMapping(consumes="application/json")</span></div>
<div style="position:absolute;left:102.18px;top:438.35px" class="cls_060"><span class="cls_060">@ResponseStatus(HttpStatus.CREATED)</span></div>
<div style="position:absolute;left:102.18px;top:448.34px" class="cls_060"><span class="cls_060">public Taco postTaco(@RequestBody Taco taco) {</span></div>
<div style="position:absolute;left:111.78px;top:458.36px" class="cls_060"><span class="cls_060">return tacoRepo.save(taco);</span></div>
<div style="position:absolute;left:102.18px;top:468.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:488.66px" class="cls_039"><span class="cls_039">Because </span><span class="cls_059">postTaco()</span><span class="cls_039"> will handle an HTTP </span><span class="cls_059">POST</span><span class="cls_039"> request, it’s annotated with </span><span class="cls_059">@Post-</span></div>
<div style="position:absolute;left:102.18px;top:501.68px" class="cls_059"><span class="cls_059">Mapping</span><span class="cls_039"> instead of </span><span class="cls_059">@GetMapping</span><span class="cls_039">. You’re not specifying a </span><span class="cls_059">path</span><span class="cls_039"> attribute here, so the</span></div>
<div style="position:absolute;left:102.18px;top:514.67px" class="cls_059"><span class="cls_059">postTaco()</span><span class="cls_039"> method will handle requests for /design as specified in the class-level</span></div>
<div style="position:absolute;left:102.18px;top:527.66px" class="cls_059"><span class="cls_059">@RequestMapping</span><span class="cls_039"> on </span><span class="cls_059">DesignTacoController</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.47px;top:540.68px" class="cls_039"><span class="cls_039">You do set the </span><span class="cls_059">consumes</span><span class="cls_039"> attribute, however. The </span><span class="cls_059">consumes</span><span class="cls_039"> attribute is to request</span></div>
<div style="position:absolute;left:102.18px;top:553.67px" class="cls_039"><span class="cls_039">input what </span><span class="cls_059">produces</span><span class="cls_039"> is to request output. Here you use </span><span class="cls_059">consumes</span><span class="cls_039"> to say that the</span></div>
<div style="position:absolute;left:102.18px;top:566.69px" class="cls_039"><span class="cls_039">method will only handle requests whose </span><span class="cls_059">Content-type</span><span class="cls_039"> matches </span><span class="cls_059">application/json</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.93px;top:579.68px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">Taco</span><span class="cls_039"> parameter to the method is annotated with </span><span class="cls_059">@RequestBody</span><span class="cls_039"> to indicate</span></div>
<div style="position:absolute;left:102.18px;top:592.67px" class="cls_039"><span class="cls_039">that the body of the request should be converted to a </span><span class="cls_059">Taco</span><span class="cls_039"> object and bound to the</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:110184px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background168.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">146</span></div>
<div style="position:absolute;left:197.31px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 6</span></div>
<div style="position:absolute;left:241.47px;top:24.35px" class="cls_055"><span class="cls_055">Creating REST services</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">parameter. This annotation is important—without it, Spring MVC would assume that</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">you want request parameters (either query parameters or form parameters) to be</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">bound to the </span><span class="cls_059">Taco</span><span class="cls_039"> object. But the </span><span class="cls_059">@RequestBody</span><span class="cls_039"> annotation ensures that JSON in the</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">request body is bound to the </span><span class="cls_059">Taco</span><span class="cls_039"> object instead.</span></div>
<div style="position:absolute;left:108.33px;top:102.65px" class="cls_039"><span class="cls_039">Once </span><span class="cls_059">postTaco()</span><span class="cls_039"> has received the </span><span class="cls_059">Taco</span><span class="cls_039"> object, it passes it to the </span><span class="cls_059">save()</span><span class="cls_039"> method</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">on the </span><span class="cls_059">TacoRepository</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:109.59px;top:128.66px" class="cls_039"><span class="cls_039">You may have also noticed that I’ve annotated the </span><span class="cls_059">postTaco()</span><span class="cls_039"> method with</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_059"><span class="cls_059">@ResponseStatus(HttpStatus.CREATED)</span><span class="cls_039">. Under normal circumstances (when no</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_039"><span class="cls_039">exceptions are thrown), all responses will have an HTTP status code of 200 (OK),</span></div>
<div style="position:absolute;left:93.18px;top:167.66px" class="cls_039"><span class="cls_039">indicating that the request was successful. Although an HTTP 200 response is always</span></div>
<div style="position:absolute;left:93.18px;top:180.65px" class="cls_039"><span class="cls_039">welcome, it’s not always descriptive enough. In the case of a </span><span class="cls_059">POST</span><span class="cls_039"> request, an HTTP</span></div>
<div style="position:absolute;left:93.18px;top:193.67px" class="cls_039"><span class="cls_039">status of 201 (CREATED) is more descriptive. It tells the client that not only was the</span></div>
<div style="position:absolute;left:93.18px;top:206.66px" class="cls_039"><span class="cls_039">request successful, but a resource was created as a result. It’s always a good idea to use</span></div>
<div style="position:absolute;left:93.18px;top:219.65px" class="cls_059"><span class="cls_059">@ResponseStatus</span><span class="cls_039"> where appropriate to communicate the most descriptive and accu-</span></div>
<div style="position:absolute;left:93.18px;top:232.67px" class="cls_039"><span class="cls_039">rate HTTP status code to the client.</span></div>
<div style="position:absolute;left:108.09px;top:245.66px" class="cls_039"><span class="cls_039">Although you’ve used </span><span class="cls_059">@PostMapping</span><span class="cls_039"> to create a new </span><span class="cls_059">Taco</span><span class="cls_039"> resource, </span><span class="cls_059">POST</span><span class="cls_039"> requests</span></div>
<div style="position:absolute;left:93.18px;top:258.65px" class="cls_039"><span class="cls_039">can also be used to update resources. Even so, </span><span class="cls_059">POST</span><span class="cls_039"> requests are typically used for</span></div>
<div style="position:absolute;left:93.18px;top:271.67px" class="cls_039"><span class="cls_039">resource creation and </span><span class="cls_059">PUT</span><span class="cls_039"> and </span><span class="cls_059">PATCH</span><span class="cls_039"> requests are used to update resources. Let’s see</span></div>
<div style="position:absolute;left:93.18px;top:284.66px" class="cls_039"><span class="cls_039">how you can update data using </span><span class="cls_059">@PutMapping</span><span class="cls_039"> and </span><span class="cls_059">@PatchMapping</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:57.18px;top:306.50px" class="cls_063"><span class="cls_063">6.1.3</span></div>
<div style="position:absolute;left:93.18px;top:306.50px" class="cls_063"><span class="cls_063">Updating data on the server</span></div>
<div style="position:absolute;left:93.18px;top:323.66px" class="cls_039"><span class="cls_039">Before you write any controller code for handling HTTP </span><span class="cls_059">PUT</span><span class="cls_039"> or </span><span class="cls_059">PATCH</span><span class="cls_039"> commands, you</span></div>
<div style="position:absolute;left:93.18px;top:336.68px" class="cls_039"><span class="cls_039">should take a moment to consider the elephant in the room: Why are there two differ-</span></div>
<div style="position:absolute;left:93.18px;top:349.67px" class="cls_039"><span class="cls_039">ent HTTP methods for updating resources?</span></div>
<div style="position:absolute;left:108.99px;top:362.66px" class="cls_039"><span class="cls_039">Although it’s true that </span><span class="cls_059">PUT</span><span class="cls_039"> is often used to update resource data, it’s actually the</span></div>
<div style="position:absolute;left:93.18px;top:375.68px" class="cls_039"><span class="cls_039">semantic opposite of </span><span class="cls_059">GET</span><span class="cls_039">. Whereas </span><span class="cls_059">GET</span><span class="cls_039"> requests are for transferring data from the server</span></div>
<div style="position:absolute;left:93.18px;top:388.67px" class="cls_039"><span class="cls_039">to the client, </span><span class="cls_059">PUT</span><span class="cls_039"> requests are for sending data from the client to the server.</span></div>
<div style="position:absolute;left:108.47px;top:401.66px" class="cls_039"><span class="cls_039">In that sense, </span><span class="cls_059">PUT</span><span class="cls_039"> is really intended to perform a wholesale </span><span class="cls_036">replacement</span><span class="cls_039"> operation</span></div>
<div style="position:absolute;left:93.18px;top:414.68px" class="cls_039"><span class="cls_039">rather than an update operation. In contrast, the purpose of HTTP </span><span class="cls_059">PATCH</span><span class="cls_039"> is to per-</span></div>
<div style="position:absolute;left:93.18px;top:427.67px" class="cls_039"><span class="cls_039">form a patch or partial update of resource data.</span></div>
<div style="position:absolute;left:108.13px;top:440.66px" class="cls_039"><span class="cls_039">For example, suppose you want to be able to change the address on an order. One</span></div>
<div style="position:absolute;left:93.18px;top:453.68px" class="cls_039"><span class="cls_039">way we could achieve this through the REST API is with a </span><span class="cls_059">PUT</span><span class="cls_039"> request handled like this:</span></div>
<div style="position:absolute;left:93.18px;top:473.36px" class="cls_060"><span class="cls_060">@PutMapping("/{orderId}")</span></div>
<div style="position:absolute;left:93.18px;top:483.35px" class="cls_060"><span class="cls_060">public Order putOrder(@RequestBody Order order) {</span></div>
<div style="position:absolute;left:102.78px;top:493.34px" class="cls_060"><span class="cls_060">return repo.save(order);</span></div>
<div style="position:absolute;left:93.18px;top:503.36px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:524.66px" class="cls_039"><span class="cls_039">This could work, but it would require that the client submit the complete order</span></div>
<div style="position:absolute;left:93.18px;top:537.68px" class="cls_039"><span class="cls_039">data in the </span><span class="cls_059">PUT</span><span class="cls_039"> request. Semantically, </span><span class="cls_059">PUT</span><span class="cls_039"> means “put this data at this URL,” essen-</span></div>
<div style="position:absolute;left:93.18px;top:550.67px" class="cls_039"><span class="cls_039">tially replacing any data that’s already there. If any of the order’s properties are</span></div>
<div style="position:absolute;left:93.18px;top:563.69px" class="cls_039"><span class="cls_039">omitted, that property’s value would be overwritten with </span><span class="cls_059">null</span><span class="cls_039">. Even the tacos in the</span></div>
<div style="position:absolute;left:93.18px;top:576.68px" class="cls_039"><span class="cls_039">order would need to be set along with the order data or else they’d be removed</span></div>
<div style="position:absolute;left:93.18px;top:589.67px" class="cls_039"><span class="cls_039">from the order.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:110860px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background169.jpg" width="531" height="666"></div>
<div style="position:absolute;left:220.56px;top:24.35px" class="cls_055"><span class="cls_055">Writing RESTful controllers</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">147</span></div>
<div style="position:absolute;left:117.84px;top:50.66px" class="cls_039"><span class="cls_039">If </span><span class="cls_059">PUT</span><span class="cls_039"> does a wholesale replacement of the resource data, then how should you</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">handle requests to do just a partial update? That’s what HTTP </span><span class="cls_059">PATCH</span><span class="cls_039"> requests and</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">Spring’s </span><span class="cls_059">@PatchMapping</span><span class="cls_039"> are good for. Here’s how you might write</span></div>
<div style="position:absolute;left:420.32px;top:76.67px" class="cls_039"><span class="cls_039">a controller</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">method to handle a </span><span class="cls_059">PATCH</span><span class="cls_039"> request for an order:</span></div>
<div style="position:absolute;left:102.18px;top:112.34px" class="cls_060"><span class="cls_060">@PatchMapping(path="/{orderId}", consumes="application/json")</span></div>
<div style="position:absolute;left:102.18px;top:122.33px" class="cls_060"><span class="cls_060">public Order patchOrder(@PathVariable("orderId") Long orderId,</span></div>
<div style="position:absolute;left:217.34px;top:132.35px" class="cls_060"><span class="cls_060">@RequestBody Order patch) {</span></div>
<div style="position:absolute;left:111.78px;top:152.33px" class="cls_060"><span class="cls_060">Order order = repo.findById(orderId).get();</span></div>
<div style="position:absolute;left:111.76px;top:162.35px" class="cls_060"><span class="cls_060">if (patch.getDeliveryName() != null) {</span></div>
<div style="position:absolute;left:121.38px;top:172.34px" class="cls_060"><span class="cls_060">order.setDeliveryName(patch.getDeliveryName());</span></div>
<div style="position:absolute;left:111.78px;top:182.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.77px;top:192.35px" class="cls_060"><span class="cls_060">if (patch.getDeliveryStreet() != null) {</span></div>
<div style="position:absolute;left:121.38px;top:202.34px" class="cls_060"><span class="cls_060">order.setDeliveryStreet(patch.getDeliveryStreet());</span></div>
<div style="position:absolute;left:111.78px;top:212.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.76px;top:222.35px" class="cls_060"><span class="cls_060">if (patch.getDeliveryCity() != null) {</span></div>
<div style="position:absolute;left:121.38px;top:232.34px" class="cls_060"><span class="cls_060">order.setDeliveryCity(patch.getDeliveryCity());</span></div>
<div style="position:absolute;left:111.78px;top:242.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.77px;top:252.35px" class="cls_060"><span class="cls_060">if (patch.getDeliveryState() != null) {</span></div>
<div style="position:absolute;left:121.38px;top:262.34px" class="cls_060"><span class="cls_060">order.setDeliveryState(patch.getDeliveryState());</span></div>
<div style="position:absolute;left:111.78px;top:272.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.77px;top:282.35px" class="cls_060"><span class="cls_060">if (patch.getDeliveryZip() != null) {</span></div>
<div style="position:absolute;left:121.38px;top:292.34px" class="cls_060"><span class="cls_060">order.setDeliveryZip(patch.getDeliveryState());</span></div>
<div style="position:absolute;left:111.78px;top:302.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.77px;top:312.35px" class="cls_060"><span class="cls_060">if (patch.getCcNumber() != null) {</span></div>
<div style="position:absolute;left:121.38px;top:322.34px" class="cls_060"><span class="cls_060">order.setCcNumber(patch.getCcNumber());</span></div>
<div style="position:absolute;left:111.78px;top:332.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.76px;top:342.35px" class="cls_060"><span class="cls_060">if (patch.getCcExpiration() != null) {</span></div>
<div style="position:absolute;left:121.38px;top:352.34px" class="cls_060"><span class="cls_060">order.setCcExpiration(patch.getCcExpiration());</span></div>
<div style="position:absolute;left:111.78px;top:362.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.77px;top:372.35px" class="cls_060"><span class="cls_060">if (patch.getCcCVV() != null) {</span></div>
<div style="position:absolute;left:121.38px;top:382.34px" class="cls_060"><span class="cls_060">order.setCcCVV(patch.getCcCVV());</span></div>
<div style="position:absolute;left:111.78px;top:392.36px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:412.34px" class="cls_060"><span class="cls_060">return repo.save(order);</span></div>
<div style="position:absolute;left:102.18px;top:422.36px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:446.66px" class="cls_039"><span class="cls_039">The first thing to note here is that the </span><span class="cls_059">patchOrder()</span><span class="cls_039"> method is annotated with</span></div>
<div style="position:absolute;left:102.18px;top:459.68px" class="cls_059"><span class="cls_059">@PatchMapping</span><span class="cls_039"> instead of </span><span class="cls_059">@PutMapping</span><span class="cls_039">, indicating that it should handle HTTP </span><span class="cls_059">PATCH</span></div>
<div style="position:absolute;left:102.18px;top:472.67px" class="cls_039"><span class="cls_039">requests instead of </span><span class="cls_059">PUT</span><span class="cls_039"> requests.</span></div>
<div style="position:absolute;left:117.36px;top:485.66px" class="cls_039"><span class="cls_039">But the one thing you’ve no doubt noticed is that the </span><span class="cls_059">patchOrder()</span><span class="cls_039"> method is a</span></div>
<div style="position:absolute;left:102.18px;top:498.68px" class="cls_039"><span class="cls_039">bit more involved than the </span><span class="cls_059">putOrder()</span><span class="cls_039"> method. That’s because Spring MVC’s map-</span></div>
<div style="position:absolute;left:102.18px;top:511.67px" class="cls_039"><span class="cls_039">ping annotations, including </span><span class="cls_059">@PatchMapping</span><span class="cls_039"> and </span><span class="cls_059">@PutMapping</span><span class="cls_039">, only specify what kinds</span></div>
<div style="position:absolute;left:102.18px;top:524.66px" class="cls_039"><span class="cls_039">of requests a method should handle. These annotations don’t dictate how the request</span></div>
<div style="position:absolute;left:102.18px;top:537.68px" class="cls_039"><span class="cls_039">will be handled. Even though </span><span class="cls_059">PATCH</span><span class="cls_039"> semantically implies a partial update, it’s up to</span></div>
<div style="position:absolute;left:102.18px;top:550.67px" class="cls_039"><span class="cls_039">you to write code in the handler method that actually performs such an update.</span></div>
<div style="position:absolute;left:118.18px;top:563.69px" class="cls_039"><span class="cls_039">In the case of the </span><span class="cls_059">putOrder()</span><span class="cls_039"> method, you accepted the complete data for an</span></div>
<div style="position:absolute;left:102.18px;top:576.68px" class="cls_039"><span class="cls_039">order and saved it, adhering to the semantics of HTTP </span><span class="cls_059">PUT</span><span class="cls_039">. But in order for </span><span class="cls_059">patch-</span></div>
<div style="position:absolute;left:102.18px;top:589.67px" class="cls_059"><span class="cls_059">Mapping()</span><span class="cls_039"> to adhere to the semantics of HTTP </span><span class="cls_059">PATCH</span><span class="cls_039">, the body of the method</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:111536px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background170.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">148</span></div>
<div style="position:absolute;left:197.31px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 6</span></div>
<div style="position:absolute;left:241.47px;top:24.35px" class="cls_055"><span class="cls_055">Creating REST services</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">requires more intelligence. Instead of completely replacing the order with the new</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">data sent in, it inspects each field of the incoming </span><span class="cls_059">Order</span><span class="cls_039"> object and applies any non-</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_059"><span class="cls_059">null</span><span class="cls_039"> values to the existing order. This approach allows the client to only send the</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">properties that should be changed and enables the server to retain existing data for</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">any properties not specified by the client.</span></div>
<div style="position:absolute;left:105.18px;top:134.48px" class="cls_075"><span class="cls_075">There’s more than one way to PATCH</span></div>
<div style="position:absolute;left:105.18px;top:148.34px" class="cls_076"><span class="cls_076">The patching approach applied in the </span><span class="cls_059">patchOrder()</span><span class="cls_076"> method has a couple of limitations:</span></div>
<div style="position:absolute;left:120.78px;top:166.34px" class="cls_062"><span class="cls_062"></span><span class="cls_076">  If </span><span class="cls_059">null</span><span class="cls_076"> values are meant to specify no change, how can the client indicate</span></div>
<div style="position:absolute;left:132.78px;top:177.83px" class="cls_076"><span class="cls_076">that a field should be set to </span><span class="cls_059">null</span><span class="cls_076">?</span></div>
<div style="position:absolute;left:120.78px;top:190.34px" class="cls_062"><span class="cls_062"></span><span class="cls_076">  There’s no way of removing or adding a subset of items from a collection. If</span></div>
<div style="position:absolute;left:132.78px;top:201.83px" class="cls_076"><span class="cls_076">the client wants to add or remove an entry from a collection, it must send the</span></div>
<div style="position:absolute;left:132.78px;top:213.35px" class="cls_076"><span class="cls_076">complete altered collection.</span></div>
<div style="position:absolute;left:105.18px;top:231.83px" class="cls_076"><span class="cls_076">There’s really no hard-and-fast rule about how </span><span class="cls_059">PATCH</span><span class="cls_076"> requests should be handled or</span></div>
<div style="position:absolute;left:105.18px;top:242.84px" class="cls_076"><span class="cls_076">what the incoming data should look like. Rather than sending the actual domain data,</span></div>
<div style="position:absolute;left:105.18px;top:253.85px" class="cls_076"><span class="cls_076">a client could send a patch-specific description of the changes to be applied. Of</span></div>
<div style="position:absolute;left:105.18px;top:264.83px" class="cls_076"><span class="cls_076">course, the request handler would have to be written to handle patch instructions</span></div>
<div style="position:absolute;left:105.18px;top:275.84px" class="cls_076"><span class="cls_076">instead of the domain data.</span></div>
<div style="position:absolute;left:93.18px;top:309.17px" class="cls_039"><span class="cls_039">In both </span><span class="cls_059">@PutMapping</span><span class="cls_039"> and </span><span class="cls_059">@PatchMapping</span><span class="cls_039">, notice that the request path references the</span></div>
<div style="position:absolute;left:93.18px;top:322.16px" class="cls_039"><span class="cls_039">resource that’s to be changed. This is the same way paths are handled by </span><span class="cls_059">@GetMapping</span><span class="cls_039">-</span></div>
<div style="position:absolute;left:93.18px;top:335.18px" class="cls_039"><span class="cls_039">annotated methods.</span></div>
<div style="position:absolute;left:108.79px;top:348.17px" class="cls_039"><span class="cls_039">You’ve now seen how to fetch and post resources with </span><span class="cls_059">@GetMapping</span><span class="cls_039"> and </span><span class="cls_059">@Post-</span></div>
<div style="position:absolute;left:93.18px;top:361.16px" class="cls_059"><span class="cls_059">Mapping</span><span class="cls_039">. And you’ve seen two different ways of updating a resource with </span><span class="cls_059">@PutMapping</span></div>
<div style="position:absolute;left:93.18px;top:374.18px" class="cls_039"><span class="cls_039">and </span><span class="cls_059">@PatchMapping</span><span class="cls_039">. All that’s left is handling requests to delete a resource.</span></div>
<div style="position:absolute;left:57.18px;top:395.99px" class="cls_063"><span class="cls_063">6.1.4</span></div>
<div style="position:absolute;left:93.18px;top:395.99px" class="cls_063"><span class="cls_063">Deleting data from the server</span></div>
<div style="position:absolute;left:93.18px;top:413.18px" class="cls_039"><span class="cls_039">Sometimes data simply isn’t needed anymore. In those cases, a client should be able to</span></div>
<div style="position:absolute;left:93.18px;top:426.17px" class="cls_039"><span class="cls_039">request that a resource be removed with an HTTP </span><span class="cls_059">DELETE</span><span class="cls_039"> request.</span></div>
<div style="position:absolute;left:107.79px;top:439.16px" class="cls_039"><span class="cls_039">Spring MVC’s </span><span class="cls_059">@DeleteMapping</span><span class="cls_039"> comes in handy for declaring methods that handle</span></div>
<div style="position:absolute;left:93.18px;top:452.18px" class="cls_059"><span class="cls_059">DELETE</span><span class="cls_039"> requests. For example, let’s say you want your API to allow for an order resource</span></div>
<div style="position:absolute;left:93.18px;top:465.17px" class="cls_039"><span class="cls_039">to be deleted. The following controller method should do the trick:</span></div>
<div style="position:absolute;left:93.18px;top:484.85px" class="cls_060"><span class="cls_060">@DeleteMapping("/{orderId}")</span></div>
<div style="position:absolute;left:93.18px;top:494.84px" class="cls_060"><span class="cls_060">@ResponseStatus(code=HttpStatus.NO_CONTENT)</span></div>
<div style="position:absolute;left:93.18px;top:504.86px" class="cls_060"><span class="cls_060">public void deleteOrder(@PathVariable("orderId") Long orderId) {</span></div>
<div style="position:absolute;left:102.78px;top:514.85px" class="cls_060"><span class="cls_060">try {</span></div>
<div style="position:absolute;left:112.38px;top:524.84px" class="cls_060"><span class="cls_060">repo.deleteById(orderId);</span></div>
<div style="position:absolute;left:102.77px;top:534.86px" class="cls_060"><span class="cls_060">} catch (EmptyResultDataAccessException e) {}</span></div>
<div style="position:absolute;left:93.18px;top:544.85px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:566.18px" class="cls_039"><span class="cls_039">By this point, the idea of another mapping annotation should be old hat to you.</span></div>
<div style="position:absolute;left:93.18px;top:579.17px" class="cls_039"><span class="cls_039">You’ve already seen </span><span class="cls_059">@GetMapping</span><span class="cls_039">, </span><span class="cls_059">@PostMapping</span><span class="cls_039">, </span><span class="cls_059">@PutMapping</span><span class="cls_039">, and </span><span class="cls_059">@PatchMapping</span><span class="cls_039">—</span></div>
<div style="position:absolute;left:93.18px;top:592.19px" class="cls_039"><span class="cls_039">each specifying that a method should handle requests for their corresponding HTTP</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:112212px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background171.jpg" width="531" height="666"></div>
<div style="position:absolute;left:231.72px;top:24.35px" class="cls_055"><span class="cls_055">Enabling hypermedia</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">149</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">methods. It will probably come as no surprise to you that </span><span class="cls_059">@DeleteMapping</span><span class="cls_039"> is used to</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">specify that the </span><span class="cls_059">deleteOrder()</span><span class="cls_039"> method is responsible for handling </span><span class="cls_059">DELETE</span><span class="cls_039"> requests</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">for /orders/{orderId}.</span></div>
<div style="position:absolute;left:117.04px;top:89.66px" class="cls_039"><span class="cls_039">The code within the method is what does the actual work of deleting an order. In</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">this case, it takes the order ID, provided as a path variable in the URL, and passes it to</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">the repository’s </span><span class="cls_059">deleteById()</span><span class="cls_039"> method. If the order exists when that method is called,</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">it will be deleted. If the order doesn’t exist, an </span><span class="cls_059">EmptyResultDataAccessException</span><span class="cls_039"> will</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">be thrown.</span></div>
<div style="position:absolute;left:117.43px;top:154.67px" class="cls_039"><span class="cls_039">I’ve chosen to catch the </span><span class="cls_059">EmptyResultDataAccessException</span><span class="cls_039"> and do nothing with</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">it. My thinking here is that if you try to delete a resource that doesn’t exist, the out-</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">come is the same as if it did exist prior to deletion. That is, the resource will be nonex-</span></div>
<div style="position:absolute;left:102.18px;top:193.67px" class="cls_039"><span class="cls_039">istent. Whether it existed before or not is irrelevant. Alternatively, I could’ve written</span></div>
<div style="position:absolute;left:102.18px;top:206.66px" class="cls_059"><span class="cls_059">deleteOrder()</span><span class="cls_039"> to return a </span><span class="cls_059">ResponseEntity</span><span class="cls_039">, setting the body to </span><span class="cls_059">null</span><span class="cls_039"> and the HTTP</span></div>
<div style="position:absolute;left:102.18px;top:219.65px" class="cls_039"><span class="cls_039">status code to NOT FOUND.</span></div>
<div style="position:absolute;left:118.27px;top:232.67px" class="cls_039"><span class="cls_039">The only other thing to take note of in the </span><span class="cls_059">deleteOrder()</span><span class="cls_039"> method is that it’s</span></div>
<div style="position:absolute;left:102.18px;top:245.66px" class="cls_039"><span class="cls_039">annotated with </span><span class="cls_059">@ResponseStatus</span><span class="cls_039"> to ensure that the response’s HTTP status is 204</span></div>
<div style="position:absolute;left:102.18px;top:258.65px" class="cls_039"><span class="cls_039">(NO CONTENT). There’s no need to communicate any resource data back to the cli-</span></div>
<div style="position:absolute;left:102.18px;top:271.67px" class="cls_039"><span class="cls_039">ent for a resource that no longer exists, so responses to </span><span class="cls_059">DELETE</span><span class="cls_039"> requests typically have</span></div>
<div style="position:absolute;left:102.18px;top:284.66px" class="cls_039"><span class="cls_039">no body and therefore should communicate an HTTP status code to let the client</span></div>
<div style="position:absolute;left:102.18px;top:297.68px" class="cls_039"><span class="cls_039">know not to expect any content.</span></div>
<div style="position:absolute;left:116.98px;top:310.67px" class="cls_039"><span class="cls_039">Your Taco Cloud API is starting to take shape. The client-side code can now easily</span></div>
<div style="position:absolute;left:102.18px;top:323.66px" class="cls_039"><span class="cls_039">consume this API to present ingredients, accept orders, and display recently created</span></div>
<div style="position:absolute;left:102.18px;top:336.68px" class="cls_039"><span class="cls_039">tacos. But there’s something you can do that will make your API even easier for the cli-</span></div>
<div style="position:absolute;left:102.18px;top:349.67px" class="cls_039"><span class="cls_039">ent to consume. Let’s look at how you can add hypermedia to the Taco Cloud API.</span></div>
<div style="position:absolute;left:66.18px;top:374.83px" class="cls_040"><span class="cls_040">6.2</span></div>
<div style="position:absolute;left:102.18px;top:374.83px" class="cls_040"><span class="cls_040">Enabling hypermedia</span></div>
<div style="position:absolute;left:102.18px;top:394.16px" class="cls_039"><span class="cls_039">The API you’ve created thus far is fairly basic, but it does work as long as the client</span></div>
<div style="position:absolute;left:102.18px;top:407.18px" class="cls_039"><span class="cls_039">that consumes it is aware of the API’s URL scheme. For example, a client may be hard-</span></div>
<div style="position:absolute;left:102.18px;top:420.17px" class="cls_039"><span class="cls_039">coded to know that it can obtain a list of recently created tacos by issuing a </span><span class="cls_059">GET</span><span class="cls_039"> request</span></div>
<div style="position:absolute;left:102.18px;top:433.16px" class="cls_039"><span class="cls_039">for /design/recent. Likewise, it may be hardcoded to know that it can append the ID</span></div>
<div style="position:absolute;left:102.18px;top:446.18px" class="cls_039"><span class="cls_039">of any taco in that list to /design to get the URL for that particular taco resource.</span></div>
<div style="position:absolute;left:117.74px;top:459.17px" class="cls_039"><span class="cls_039">Using hardcoded URL patterns and string manipulation is common among API</span></div>
<div style="position:absolute;left:102.18px;top:472.16px" class="cls_039"><span class="cls_039">client code. But imagine for a moment what would happen if the API’s URL scheme</span></div>
<div style="position:absolute;left:102.18px;top:485.18px" class="cls_039"><span class="cls_039">were to change. The hardcoded client code would have an obsolete understanding of</span></div>
<div style="position:absolute;left:102.18px;top:498.17px" class="cls_039"><span class="cls_039">the API and would thus be broken. Hardcoding API URLs and using string manipula-</span></div>
<div style="position:absolute;left:102.18px;top:511.16px" class="cls_039"><span class="cls_039">tion on them makes the client code brittle.</span></div>
<div style="position:absolute;left:117.69px;top:524.18px" class="cls_036"><span class="cls_036">Hypermedia as the Engine of Application State</span><span class="cls_039">, or HATEOAS, is a means of creating</span></div>
<div style="position:absolute;left:102.18px;top:537.17px" class="cls_039"><span class="cls_039">self-describing APIs wherein resources returned from an API contain links to related</span></div>
<div style="position:absolute;left:102.18px;top:550.19px" class="cls_039"><span class="cls_039">resources. This enables clients to navigate an API with minimal understanding of the</span></div>
<div style="position:absolute;left:102.18px;top:563.18px" class="cls_039"><span class="cls_039">API’s URLs. Instead, it understands </span><span class="cls_036">relationships</span><span class="cls_039"> between the resources served by the API</span></div>
<div style="position:absolute;left:102.18px;top:576.17px" class="cls_039"><span class="cls_039">and uses its understanding of those relationships to discover the API’s URLs as it tra-</span></div>
<div style="position:absolute;left:102.18px;top:589.19px" class="cls_039"><span class="cls_039">verses those relationships.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:112888px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background172.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">150</span></div>
<div style="position:absolute;left:197.31px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 6</span></div>
<div style="position:absolute;left:241.47px;top:24.35px" class="cls_055"><span class="cls_055">Creating REST services</span></div>
<div style="position:absolute;left:108.22px;top:50.66px" class="cls_039"><span class="cls_039">For example, suppose a client were to request a list of recently designed tacos. In</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">its raw form, with no hyperlinks, the list of recent tacos would be received in the client</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">with JSON that looks like this (with all but the first taco in the list clipped out for brev-</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">ity’s sake):</span></div>
<div style="position:absolute;left:93.18px;top:109.34px" class="cls_060"><span class="cls_060">[</span></div>
<div style="position:absolute;left:102.78px;top:119.33px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:112.38px;top:129.35px" class="cls_060"><span class="cls_060">"id": 4,</span></div>
<div style="position:absolute;left:112.38px;top:139.34px" class="cls_060"><span class="cls_060">"name": "Veg-Out",</span></div>
<div style="position:absolute;left:112.35px;top:149.33px" class="cls_060"><span class="cls_060">"createdAt": "2018-01-31T20:15:53.219+0000",</span></div>
<div style="position:absolute;left:112.38px;top:159.35px" class="cls_060"><span class="cls_060">"ingredients": [</span></div>
<div style="position:absolute;left:121.96px;top:169.34px" class="cls_060"><span class="cls_060">{"id": "FLTO", "name": "Flour Tortilla", "type": "WRAP"},</span></div>
<div style="position:absolute;left:121.95px;top:179.33px" class="cls_060"><span class="cls_060">{"id": "COTO", "name": "Corn Tortilla", "type": "WRAP"},</span></div>
<div style="position:absolute;left:121.96px;top:189.35px" class="cls_060"><span class="cls_060">{"id": "TMTO", "name": "Diced Tomatoes", "type": "VEGGIES"},</span></div>
<div style="position:absolute;left:121.96px;top:199.34px" class="cls_060"><span class="cls_060">{"id": "LETC", "name": "Lettuce", "type": "VEGGIES"},</span></div>
<div style="position:absolute;left:121.96px;top:209.33px" class="cls_060"><span class="cls_060">{"id": "SLSA", "name": "Salsa", "type": "SAUCE"}</span></div>
<div style="position:absolute;left:112.38px;top:219.35px" class="cls_060"><span class="cls_060">]</span></div>
<div style="position:absolute;left:102.78px;top:229.34px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:93.18px;top:249.35px" class="cls_061"><span class="cls_061">]</span></div>
<div style="position:absolute;left:93.18px;top:270.65px" class="cls_039"><span class="cls_039">If the client wished to fetch or perform some other HTTP operation on the taco</span></div>
<div style="position:absolute;left:93.18px;top:283.67px" class="cls_039"><span class="cls_039">itself, it would need to know (via hardcoding) that it could append the value of the</span></div>
<div style="position:absolute;left:93.18px;top:296.66px" class="cls_059"><span class="cls_059">id</span><span class="cls_039"> property to a URL whose path is /design. Likewise, if it wanted to perform an</span></div>
<div style="position:absolute;left:93.18px;top:309.68px" class="cls_039"><span class="cls_039">HTTP operation on one of the ingredients, it would need to know that it could</span></div>
<div style="position:absolute;left:93.18px;top:322.67px" class="cls_039"><span class="cls_039">append the value of the ingredient’s </span><span class="cls_059">id</span><span class="cls_039"> property to a URL whose path is /ingredi-</span></div>
<div style="position:absolute;left:93.18px;top:335.66px" class="cls_039"><span class="cls_039">ents. In either case, it would also need to prefix that path with http:</span><span class="cls_045">//</span><span class="cls_039"> or https:</span><span class="cls_045">//</span><span class="cls_039"> and</span></div>
<div style="position:absolute;left:93.18px;top:348.68px" class="cls_039"><span class="cls_039">the hostname of the API.</span></div>
<div style="position:absolute;left:108.29px;top:361.67px" class="cls_039"><span class="cls_039">In contrast, if the API is enabled with hypermedia, the API will describe its own</span></div>
<div style="position:absolute;left:93.18px;top:374.66px" class="cls_039"><span class="cls_039">URLs, relieving the client of needing to be hardcoded with that knowledge. The</span></div>
<div style="position:absolute;left:93.18px;top:387.68px" class="cls_039"><span class="cls_039">same list of recently created tacos might look like the next listing if hyperlinks were</span></div>
<div style="position:absolute;left:93.18px;top:400.67px" class="cls_039"><span class="cls_039">embedded.</span></div>
<div style="position:absolute;left:105.18px;top:424.40px" class="cls_066"><span class="cls_066">Listing 6.3</span></div>
<div style="position:absolute;left:157.28px;top:424.40px" class="cls_066"><span class="cls_066">A list of taco resources that includes hyperlinks</span></div>
<div style="position:absolute;left:93.18px;top:444.26px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:102.78px;top:454.25px" class="cls_060"><span class="cls_060">"_embedded": {</span></div>
<div style="position:absolute;left:112.38px;top:464.24px" class="cls_060"><span class="cls_060">"tacoResourceList": [</span></div>
<div style="position:absolute;left:121.95px;top:474.26px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:131.55px;top:484.25px" class="cls_060"><span class="cls_060">"name": "Veg-Out",</span></div>
<div style="position:absolute;left:131.55px;top:494.24px" class="cls_060"><span class="cls_060">"createdAt": "2018-01-31T20:15:53.219+0000",</span></div>
<div style="position:absolute;left:131.55px;top:504.26px" class="cls_060"><span class="cls_060">"ingredients": [</span></div>
<div style="position:absolute;left:141.15px;top:514.25px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:150.76px;top:524.24px" class="cls_060"><span class="cls_060">"name": "Flour Tortilla", "type": "WRAP",</span></div>
<div style="position:absolute;left:150.76px;top:534.26px" class="cls_060"><span class="cls_060">"_links": {</span></div>
<div style="position:absolute;left:160.35px;top:544.25px" class="cls_060"><span class="cls_060">"self": { "href": "</span><a href="http://localhost:8080/ingredients/flto" "="">http://localhost:8080/ingredients/FLTO"</a> }</div>
<div style="position:absolute;left:150.75px;top:554.24px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:141.15px;top:564.26px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:141.15px;top:574.25px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:150.76px;top:584.24px" class="cls_060"><span class="cls_060">"name": "Corn Tortilla", "type": "WRAP",</span></div>
<div style="position:absolute;left:150.76px;top:594.26px" class="cls_060"><span class="cls_060">"_links": {</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:113564px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background173.jpg" width="531" height="666"></div>
<div style="position:absolute;left:231.72px;top:24.35px" class="cls_055"><span class="cls_055">Enabling hypermedia</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">151</span></div>
<div style="position:absolute;left:169.35px;top:51.32px" class="cls_060"><span class="cls_060">"self": { "href": "</span><a href="http://localhost:8080/ingredients/coto" "="">http://localhost:8080/ingredients/COTO"</a> }</div>
<div style="position:absolute;left:159.75px;top:61.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:150.15px;top:71.33px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:150.15px;top:81.32px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:159.76px;top:91.34px" class="cls_060"><span class="cls_060">"name": "Diced Tomatoes", "type": "VEGGIES",</span></div>
<div style="position:absolute;left:159.76px;top:101.33px" class="cls_060"><span class="cls_060">"_links": {</span></div>
<div style="position:absolute;left:169.35px;top:111.32px" class="cls_060"><span class="cls_060">"self": { "href": "</span><a href="http://localhost:8080/ingredients/tmto" "="">http://localhost:8080/ingredients/TMTO"</a> }</div>
<div style="position:absolute;left:159.75px;top:121.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:150.15px;top:131.33px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:150.15px;top:141.35px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:159.76px;top:151.34px" class="cls_060"><span class="cls_060">"name": "Lettuce", "type": "VEGGIES",</span></div>
<div style="position:absolute;left:159.76px;top:161.33px" class="cls_060"><span class="cls_060">"_links": {</span></div>
<div style="position:absolute;left:169.35px;top:171.35px" class="cls_060"><span class="cls_060">"self": { "href": "</span><a href="http://localhost:8080/ingredients/letc" "="">http://localhost:8080/ingredients/LETC"</a> }</div>
<div style="position:absolute;left:159.75px;top:181.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:150.15px;top:191.33px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:150.15px;top:201.35px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:159.76px;top:211.34px" class="cls_060"><span class="cls_060">"name": "Salsa", "type": "SAUCE",</span></div>
<div style="position:absolute;left:159.76px;top:221.33px" class="cls_060"><span class="cls_060">"_links": {</span></div>
<div style="position:absolute;left:169.35px;top:231.35px" class="cls_060"><span class="cls_060">"self": { "href": "</span><a href="http://localhost:8080/ingredients/slsa" "="">http://localhost:8080/ingredients/SLSA"</a> }</div>
<div style="position:absolute;left:159.75px;top:241.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:150.15px;top:251.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:140.55px;top:261.35px" class="cls_060"><span class="cls_060">],</span></div>
<div style="position:absolute;left:140.53px;top:271.34px" class="cls_060"><span class="cls_060">"_links": {</span></div>
<div style="position:absolute;left:150.14px;top:281.33px" class="cls_060"><span class="cls_060">"self": { "href": "</span><a href="http://localhost:8080/design/4" "="">http://localhost:8080/design/4"</a> }</div>
<div style="position:absolute;left:140.55px;top:291.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:130.95px;top:301.34px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:121.38px;top:333.35px" class="cls_060"><span class="cls_060">]</span></div>
<div style="position:absolute;left:111.78px;top:343.34px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:111.78px;top:353.33px" class="cls_060"><span class="cls_060">"_links": {</span></div>
<div style="position:absolute;left:121.38px;top:363.35px" class="cls_060"><span class="cls_060">"recents": {</span></div>
<div style="position:absolute;left:130.95px;top:373.34px" class="cls_060"><span class="cls_060">"href": "</span><a href="http://localhost:8080/design/recent" "="">http://localhost:8080/design/recent"</a> </div>
<div style="position:absolute;left:121.38px;top:383.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:393.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:403.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:427.67px" class="cls_039"><span class="cls_039">This particular flavor of HATEOAS is known as HAL (Hypertext Application Lan-</span></div>
<div style="position:absolute;left:102.18px;top:440.66px" class="cls_039"><span class="cls_039">guage; </span><a href="http://stateless.co/hal_specification.html">http://stateless.co/hal_specification.html</a> <span class="cls_039">), a simple and commonly used for-</span></div>
<div style="position:absolute;left:102.18px;top:453.68px" class="cls_039"><span class="cls_039">mat for embedding hyperlinks in JSON responses.</span></div>
<div style="position:absolute;left:117.30px;top:466.67px" class="cls_039"><span class="cls_039">Although this list isn’t as succinct as before, it does provide some useful informa-</span></div>
<div style="position:absolute;left:102.18px;top:479.66px" class="cls_039"><span class="cls_039">tion. Each element in this new list of tacos includes a property named </span><span class="cls_059">_links</span><span class="cls_039"> that</span></div>
<div style="position:absolute;left:102.18px;top:492.68px" class="cls_039"><span class="cls_039">contains hyperlinks for the client to navigate the API. In this example, both tacos and</span></div>
<div style="position:absolute;left:102.18px;top:505.67px" class="cls_039"><span class="cls_039">ingredients each have </span><span class="cls_059">self</span><span class="cls_039"> links to reference those resources, and the entire list has a</span></div>
<div style="position:absolute;left:102.18px;top:518.66px" class="cls_059"><span class="cls_059">recents</span><span class="cls_039"> link that references itself.</span></div>
<div style="position:absolute;left:116.67px;top:531.68px" class="cls_039"><span class="cls_039">Should a client application need to perform an HTTP request against a taco in the</span></div>
<div style="position:absolute;left:102.18px;top:544.67px" class="cls_039"><span class="cls_039">list, it doesn’t need to be developed with any knowledge of what the taco resource’s</span></div>
<div style="position:absolute;left:102.18px;top:557.66px" class="cls_039"><span class="cls_039">URL would look like. Instead, it knows to ask for the </span><span class="cls_059">self</span><span class="cls_039"> link, which maps to </span><a href="http://localhost:8080/design/4">http://</a> </div>
<div style="position:absolute;left:102.18px;top:570.68px" class="cls_045"><span class="cls_045"> </span><a href="http://localhost:8080/design/4">localhost:8080/design/4</a> <span class="cls_039">. If the client wants to deal with a particular ingredient, it</span></div>
<div style="position:absolute;left:102.18px;top:583.67px" class="cls_039"><span class="cls_039">only needs to follow the </span><span class="cls_059">self</span><span class="cls_039"> link for that ingredient.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:114240px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background174.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">152</span></div>
<div style="position:absolute;left:197.31px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 6</span></div>
<div style="position:absolute;left:241.47px;top:24.35px" class="cls_055"><span class="cls_055">Creating REST services</span></div>
<div style="position:absolute;left:107.70px;top:50.66px" class="cls_039"><span class="cls_039">The Spring HATEOAS project brings hyperlink support to Spring. It offers a set of</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">classes and resource assemblers that can be used to add links to resources before</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">returning them from a Spring MVC controller.</span></div>
<div style="position:absolute;left:109.64px;top:89.66px" class="cls_039"><span class="cls_039">To enable hypermedia in the Taco Cloud API, you’ll need to add the Spring</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">HATEOAS starter dependency to the build:</span></div>
<div style="position:absolute;left:93.18px;top:124.34px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:134.33px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:144.35px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-boot-starter-hateoas&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:93.18px;top:154.34px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:93.18px;top:177.65px" class="cls_039"><span class="cls_039">This starter not only adds Spring HATEOAS to the project’s classpath, but also pro-</span></div>
<div style="position:absolute;left:93.18px;top:190.67px" class="cls_039"><span class="cls_039">vides for autoconfiguration to enable Spring HATEOAS. All you need to do is rework</span></div>
<div style="position:absolute;left:93.18px;top:203.66px" class="cls_039"><span class="cls_039">your controllers to return resource types instead of domain types.</span></div>
<div style="position:absolute;left:107.73px;top:216.65px" class="cls_039"><span class="cls_039">You’ll start by adding hypermedia links to the list of recent tacos returned by a </span><span class="cls_059">GET</span></div>
<div style="position:absolute;left:93.18px;top:229.67px" class="cls_039"><span class="cls_039">request to /design/recent.</span></div>
<div style="position:absolute;left:57.18px;top:254.48px" class="cls_063"><span class="cls_063">6.2.1</span></div>
<div style="position:absolute;left:93.18px;top:254.48px" class="cls_063"><span class="cls_063">Adding hyperlinks</span></div>
<div style="position:absolute;left:93.18px;top:272.15px" class="cls_039"><span class="cls_039">Spring HATEOAS provides two primary types that represent hyperlinked resources:</span></div>
<div style="position:absolute;left:93.18px;top:285.17px" class="cls_059"><span class="cls_059">Resource</span><span class="cls_039"> and </span><span class="cls_059">Resources</span><span class="cls_039">. The </span><span class="cls_059">Resource</span><span class="cls_039"> type represents a single resource, whereas</span></div>
<div style="position:absolute;left:93.18px;top:298.16px" class="cls_059"><span class="cls_059">Resources</span><span class="cls_039"> is a collection of resources. Both types are capable of carrying links to</span></div>
<div style="position:absolute;left:93.18px;top:311.18px" class="cls_039"><span class="cls_039">other resources. When returned from a Spring MVC REST controller method, the</span></div>
<div style="position:absolute;left:93.18px;top:324.17px" class="cls_039"><span class="cls_039">links they carry will be included in the JSON (or XML) received by the client.</span></div>
<div style="position:absolute;left:108.90px;top:337.16px" class="cls_039"><span class="cls_039">To add hyperlinks to the list of recently created tacos, you’ll need to revisit the</span></div>
<div style="position:absolute;left:93.18px;top:350.18px" class="cls_059"><span class="cls_059">recentTacos()</span><span class="cls_039"> method shown in listing 6.2. The original implementation returned a</span></div>
<div style="position:absolute;left:93.18px;top:363.17px" class="cls_059"><span class="cls_059">List&lt;Taco&gt;</span><span class="cls_039">, which was fine at the time, but you’re going to need it to return a</span></div>
<div style="position:absolute;left:93.18px;top:376.16px" class="cls_059"><span class="cls_059">Resources</span><span class="cls_039"> object instead. The following listing shows a new implementation of</span></div>
<div style="position:absolute;left:93.18px;top:389.18px" class="cls_059"><span class="cls_059">recentTacos()</span><span class="cls_039"> that includes the first steps toward enabling hyperlinks in the recent</span></div>
<div style="position:absolute;left:93.18px;top:402.17px" class="cls_039"><span class="cls_039">tacos list.</span></div>
<div style="position:absolute;left:105.18px;top:425.90px" class="cls_066"><span class="cls_066">Listing 6.4</span></div>
<div style="position:absolute;left:157.27px;top:425.90px" class="cls_066"><span class="cls_066">Adding hyperlinks to resources</span></div>
<div style="position:absolute;left:93.18px;top:445.76px" class="cls_060"><span class="cls_060">@GetMapping("/recent")</span></div>
<div style="position:absolute;left:93.18px;top:455.75px" class="cls_060"><span class="cls_060">public Resources&lt;Resource&lt;Taco&gt;&gt; recentTacos() {</span></div>
<div style="position:absolute;left:102.78px;top:465.74px" class="cls_060"><span class="cls_060">PageRequest page = PageRequest.of(</span></div>
<div style="position:absolute;left:141.12px;top:475.76px" class="cls_060"><span class="cls_060">0, 12, Sort.by("createdAt").descending());</span></div>
<div style="position:absolute;left:102.78px;top:495.74px" class="cls_060"><span class="cls_060">List&lt;Taco&gt; tacos = tacoRepo.findAll(page).getContent();</span></div>
<div style="position:absolute;left:102.78px;top:505.76px" class="cls_060"><span class="cls_060">Resources&lt;Resource&lt;Taco&gt;&gt; recentResources = Resources.wrap(tacos);</span></div>
<div style="position:absolute;left:102.78px;top:525.74px" class="cls_060"><span class="cls_060">recentResources.add(</span></div>
<div style="position:absolute;left:121.93px;top:535.76px" class="cls_060"><span class="cls_060">new Link("</span><a href="http://localhost:8080/design/recent" "="">http://localhost:8080/design/recent"</a>, "recents"));</div>
<div style="position:absolute;left:102.78px;top:545.75px" class="cls_060"><span class="cls_060">return recentResources;</span></div>
<div style="position:absolute;left:93.18px;top:555.74px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:579.08px" class="cls_039"><span class="cls_039">In this new version of </span><span class="cls_059">recentTacos()</span><span class="cls_039">, you no longer return the list of tacos directly.</span></div>
<div style="position:absolute;left:93.18px;top:592.07px" class="cls_039"><span class="cls_039">Instead, you use </span><span class="cls_059">Resources.wrap()</span><span class="cls_039"> to wrap the list of tacos as an instance of</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:114916px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background175.jpg" width="531" height="666"></div>
<div style="position:absolute;left:231.72px;top:24.35px" class="cls_055"><span class="cls_055">Enabling hypermedia</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">153</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_059"><span class="cls_059">Resources&lt;Resource&lt;Taco&gt;&gt;</span><span class="cls_039">, which is ultimately returned from the method. But before</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">returning the </span><span class="cls_059">Resources</span><span class="cls_039"> object, you add a link whose relationship name is </span><span class="cls_059">recents</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">and whose URL is </span><a href="http://localhost:8080/design/recent">http://localhost:8080/design/recent</a> <span class="cls_039">. As a consequence, the fol-</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">lowing snippet of JSON is included in the resource returned from the API request:</span></div>
<div style="position:absolute;left:102.18px;top:109.34px" class="cls_060"><span class="cls_060">"_links": {</span></div>
<div style="position:absolute;left:111.78px;top:119.33px" class="cls_060"><span class="cls_060">"recents": {</span></div>
<div style="position:absolute;left:121.38px;top:129.35px" class="cls_060"><span class="cls_060">"href": "</span><a href="http://localhost:8080/design/recent" "="">http://localhost:8080/design/recent"</a> </div>
<div style="position:absolute;left:111.78px;top:139.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:149.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:170.66px" class="cls_039"><span class="cls_039">This is a good start, but you’ve still got some work to do. At this point, the only link</span></div>
<div style="position:absolute;left:102.18px;top:183.65px" class="cls_039"><span class="cls_039">you’ve added is to the entire list; no links are added to the taco resources themselves</span></div>
<div style="position:absolute;left:102.18px;top:196.67px" class="cls_039"><span class="cls_039">or to the ingredients of each taco. You’ll add those soon. But first, let’s address the</span></div>
<div style="position:absolute;left:102.18px;top:209.66px" class="cls_039"><span class="cls_039">hardcoded URL that you’ve given for the </span><span class="cls_059">recents</span><span class="cls_039"> link.</span></div>
<div style="position:absolute;left:116.76px;top:222.65px" class="cls_039"><span class="cls_039">Hardcoding a URL like this is a really bad idea. Unless your Taco Cloud ambitions</span></div>
<div style="position:absolute;left:102.18px;top:235.67px" class="cls_039"><span class="cls_039">are limited to only ever running the application on your own development machines,</span></div>
<div style="position:absolute;left:102.18px;top:248.66px" class="cls_039"><span class="cls_039">you need a way to not hardcode a URL with localhost:8080 in it. Fortunately, Spring</span></div>
<div style="position:absolute;left:102.18px;top:261.65px" class="cls_039"><span class="cls_039">HATEOAS provides help in the form of link builders.</span></div>
<div style="position:absolute;left:116.64px;top:274.67px" class="cls_039"><span class="cls_039">The most useful of the Spring HATEOAS link builders is </span><span class="cls_059">ControllerLinkBuilder</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:102.18px;top:287.66px" class="cls_039"><span class="cls_039">This link builder is smart enough to know what the hostname is without you having to</span></div>
<div style="position:absolute;left:102.18px;top:300.68px" class="cls_039"><span class="cls_039">hardcode it. And it provides a handy fluent API to help you build links relative to the</span></div>
<div style="position:absolute;left:102.18px;top:313.67px" class="cls_039"><span class="cls_039">base URL of any controller.</span></div>
<div style="position:absolute;left:117.81px;top:326.66px" class="cls_039"><span class="cls_039">Using </span><span class="cls_059">ControllerLinkBuilder</span><span class="cls_039">, you can rewrite the hardcoded </span><span class="cls_059">Link</span><span class="cls_039"> creation in</span></div>
<div style="position:absolute;left:102.18px;top:339.68px" class="cls_059"><span class="cls_059">recentTacos()</span><span class="cls_039"> with the following lines:</span></div>
<div style="position:absolute;left:102.18px;top:359.33px" class="cls_060"><span class="cls_060">Resources&lt;Resource&lt;Taco&gt;&gt; recentResources = Resources.wrap(tacos);</span></div>
<div style="position:absolute;left:102.18px;top:369.35px" class="cls_060"><span class="cls_060">recentResources.add(</span></div>
<div style="position:absolute;left:111.78px;top:379.34px" class="cls_060"><span class="cls_060">ControllerLinkBuilder.linkTo(DesignTacoController.class)</span></div>
<div style="position:absolute;left:212.52px;top:389.36px" class="cls_060"><span class="cls_060">.slash("recent")</span></div>
<div style="position:absolute;left:212.52px;top:399.35px" class="cls_061"><span class="cls_061">.withRel("recents"));</span></div>
<div style="position:absolute;left:102.18px;top:420.68px" class="cls_039"><span class="cls_039">Not only do you no longer need to hardcode the hostname, you also don’t have to</span></div>
<div style="position:absolute;left:102.18px;top:433.67px" class="cls_039"><span class="cls_039">specify the /design path. Instead, you ask for a link to </span><span class="cls_059">DesignTacoController</span><span class="cls_039">, whose</span></div>
<div style="position:absolute;left:102.18px;top:446.66px" class="cls_039"><span class="cls_039">base path is /design. </span><span class="cls_059">ControllerLinkBuilder</span><span class="cls_039"> uses the controller’s base path as the</span></div>
<div style="position:absolute;left:102.18px;top:459.68px" class="cls_039"><span class="cls_039">foundation of the </span><span class="cls_059">Link</span><span class="cls_039"> object you’re creating.</span></div>
<div style="position:absolute;left:116.85px;top:472.67px" class="cls_039"><span class="cls_039">What’s next is a call to one of my favorite methods in any Spring project: </span><span class="cls_059">slash()</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:102.18px;top:485.66px" class="cls_039"><span class="cls_039">I love this method because it so succinctly describes exactly what it’s going to do. It</span></div>
<div style="position:absolute;left:102.18px;top:498.68px" class="cls_039"><span class="cls_039">quite literally appends a slash (</span><span class="cls_059">/</span><span class="cls_039">) and the given value to the URL. As a result, the</span></div>
<div style="position:absolute;left:102.18px;top:511.67px" class="cls_039"><span class="cls_039">URL’s path is /design/recent.</span></div>
<div style="position:absolute;left:117.55px;top:524.66px" class="cls_039"><span class="cls_039">Finally, you specify a relation name for the </span><span class="cls_059">Link</span><span class="cls_039">. In this example, the relation is</span></div>
<div style="position:absolute;left:102.18px;top:537.68px" class="cls_039"><span class="cls_039">named </span><span class="cls_059">recents</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:119.07px;top:550.67px" class="cls_039"><span class="cls_039">Although I’m a big fan of the </span><span class="cls_059">slash()</span><span class="cls_039"> method, </span><span class="cls_059">ControllerLinkBuilder</span><span class="cls_039"> has</span></div>
<div style="position:absolute;left:102.18px;top:563.69px" class="cls_039"><span class="cls_039">another method that can help eliminate any hardcoding associated with link URLs.</span></div>
<div style="position:absolute;left:102.18px;top:576.68px" class="cls_039"><span class="cls_039">Instead of calling </span><span class="cls_059">slash()</span><span class="cls_039">, you can call </span><span class="cls_059">linkTo()</span><span class="cls_039"> by giving it a method on the control-</span></div>
<div style="position:absolute;left:102.18px;top:589.67px" class="cls_039"><span class="cls_039">ler to have </span><span class="cls_059">ControllerLinkBuilder</span><span class="cls_039"> derive the base URL from both the controller’s</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:115592px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background176.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">154</span></div>
<div style="position:absolute;left:197.31px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 6</span></div>
<div style="position:absolute;left:241.47px;top:24.35px" class="cls_055"><span class="cls_055">Creating REST services</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">base path and the method’s mapped path. The following code uses the </span><span class="cls_059">linkTo()</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">method this way:</span></div>
<div style="position:absolute;left:93.18px;top:83.33px" class="cls_060"><span class="cls_060">Resources&lt;Resource&lt;Taco&gt;&gt; recentResources = Resources.wrap(tacos);</span></div>
<div style="position:absolute;left:93.18px;top:93.32px" class="cls_060"><span class="cls_060">recentResources.add(</span></div>
<div style="position:absolute;left:131.55px;top:103.34px" class="cls_060"><span class="cls_060">linkTo(methodOn(DesignTacoController.class).recentTacos())</span></div>
<div style="position:absolute;left:131.55px;top:113.33px" class="cls_061"><span class="cls_061">.withRel("recents"));</span></div>
<div style="position:absolute;left:93.18px;top:132.65px" class="cls_039"><span class="cls_039">Here I’ve decided to statically include the </span><span class="cls_059">linkTo()</span><span class="cls_039"> and </span><span class="cls_059">methodOn()</span><span class="cls_039"> methods (both</span></div>
<div style="position:absolute;left:93.18px;top:145.67px" class="cls_039"><span class="cls_039">from </span><span class="cls_059">ControllerLinkBuilder</span><span class="cls_039">) to keep the code easier to read. The </span><span class="cls_059">methodOn()</span></div>
<div style="position:absolute;left:93.18px;top:158.66px" class="cls_039"><span class="cls_039">method takes the controller class and lets you make a call to the </span><span class="cls_059">recentTacos()</span></div>
<div style="position:absolute;left:93.18px;top:171.65px" class="cls_039"><span class="cls_039">method, which is intercepted by </span><span class="cls_059">ControllerLinkBuilder</span><span class="cls_039"> and used to determine not</span></div>
<div style="position:absolute;left:93.18px;top:184.67px" class="cls_039"><span class="cls_039">only the controller’s base path, but also the path mapped to </span><span class="cls_059">recentTacos()</span><span class="cls_039">. Now the</span></div>
<div style="position:absolute;left:93.18px;top:197.66px" class="cls_039"><span class="cls_039">entire URL is derived from the controller’s mappings, and absolutely no portion is</span></div>
<div style="position:absolute;left:93.18px;top:210.65px" class="cls_039"><span class="cls_039">hardcoded. Sweet!</span></div>
<div style="position:absolute;left:57.18px;top:232.49px" class="cls_063"><span class="cls_063">6.2.2</span></div>
<div style="position:absolute;left:93.18px;top:232.49px" class="cls_063"><span class="cls_063">Creating resource assemblers</span></div>
<div style="position:absolute;left:93.18px;top:249.65px" class="cls_039"><span class="cls_039">Now you need to add links to the taco resource contained within the list. One option</span></div>
<div style="position:absolute;left:93.18px;top:262.67px" class="cls_039"><span class="cls_039">is to loop through each of the </span><span class="cls_059">Resource&lt;Taco&gt;</span><span class="cls_039"> elements carried in the </span><span class="cls_059">Resources</span></div>
<div style="position:absolute;left:93.18px;top:275.66px" class="cls_039"><span class="cls_039">object, adding a </span><span class="cls_059">Link</span><span class="cls_039"> to each individually. But that’s a bit tedious and you’d need to</span></div>
<div style="position:absolute;left:93.18px;top:288.65px" class="cls_039"><span class="cls_039">repeat that looping code in the API wherever you return a list of taco resources.</span></div>
<div style="position:absolute;left:107.77px;top:301.67px" class="cls_039"><span class="cls_039">We need a different tactic.</span></div>
<div style="position:absolute;left:108.58px;top:314.66px" class="cls_039"><span class="cls_039">Rather than let </span><span class="cls_059">Resources.wrap()</span><span class="cls_039"> create a </span><span class="cls_059">Resource</span><span class="cls_039"> object for each taco in the</span></div>
<div style="position:absolute;left:93.18px;top:327.68px" class="cls_039"><span class="cls_039">list, you’re going to define a utility class that converts </span><span class="cls_059">Taco</span><span class="cls_039"> objects to a new </span><span class="cls_059">Taco-</span></div>
<div style="position:absolute;left:93.18px;top:340.67px" class="cls_059"><span class="cls_059">Resource</span><span class="cls_039"> object. The </span><span class="cls_059">TacoResource</span><span class="cls_039"> object will look a lot like a </span><span class="cls_059">Taco</span><span class="cls_039">, but it will also be</span></div>
<div style="position:absolute;left:93.18px;top:353.66px" class="cls_039"><span class="cls_039">able to carry links. The next listing shows what a </span><span class="cls_059">TacoResource</span><span class="cls_039"> might look like.</span></div>
<div style="position:absolute;left:105.18px;top:376.40px" class="cls_066"><span class="cls_066">Listing 6.5</span></div>
<div style="position:absolute;left:157.27px;top:376.40px" class="cls_066"><span class="cls_066">A taco resource carriying domain data and a list of hyperlinks</span></div>
<div style="position:absolute;left:93.18px;top:395.24px" class="cls_060"><span class="cls_060">package tacos.web.api;</span></div>
<div style="position:absolute;left:93.18px;top:405.26px" class="cls_060"><span class="cls_060">import java.util.Date;</span></div>
<div style="position:absolute;left:93.18px;top:415.25px" class="cls_060"><span class="cls_060">import java.util.List;</span></div>
<div style="position:absolute;left:93.18px;top:425.24px" class="cls_060"><span class="cls_060">import org.springframework.hateoas.ResourceSupport;</span></div>
<div style="position:absolute;left:93.18px;top:435.26px" class="cls_060"><span class="cls_060">import lombok.Getter;</span></div>
<div style="position:absolute;left:93.18px;top:445.25px" class="cls_060"><span class="cls_060">import tacos.Ingredient;</span></div>
<div style="position:absolute;left:93.18px;top:455.24px" class="cls_060"><span class="cls_060">import tacos.Taco;</span></div>
<div style="position:absolute;left:93.18px;top:475.25px" class="cls_060"><span class="cls_060">public class TacoResource extends ResourceSupport {</span></div>
<div style="position:absolute;left:102.78px;top:495.26px" class="cls_060"><span class="cls_060">@Getter</span></div>
<div style="position:absolute;left:102.78px;top:505.25px" class="cls_060"><span class="cls_060">private final String name;</span></div>
<div style="position:absolute;left:102.78px;top:525.26px" class="cls_060"><span class="cls_060">@Getter</span></div>
<div style="position:absolute;left:102.78px;top:535.25px" class="cls_060"><span class="cls_060">private final Date createdAt;</span></div>
<div style="position:absolute;left:102.78px;top:555.26px" class="cls_060"><span class="cls_060">@Getter</span></div>
<div style="position:absolute;left:102.78px;top:565.25px" class="cls_060"><span class="cls_060">private final List&lt;Ingredient&gt; ingredients;</span></div>
<div style="position:absolute;left:102.78px;top:585.26px" class="cls_060"><span class="cls_060">public TacoResource(Taco taco) {</span></div>
<div style="position:absolute;left:112.38px;top:595.25px" class="cls_060"><span class="cls_060">this.name = taco.getName();</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:116268px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background177.jpg" width="531" height="666"></div>
<div style="position:absolute;left:231.72px;top:24.35px" class="cls_055"><span class="cls_055">Enabling hypermedia</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">155</span></div>
<div style="position:absolute;left:121.38px;top:51.32px" class="cls_060"><span class="cls_060">this.createdAt = taco.getCreatedAt();</span></div>
<div style="position:absolute;left:121.38px;top:61.34px" class="cls_060"><span class="cls_060">this.ingredients = taco.getIngredients();</span></div>
<div style="position:absolute;left:111.78px;top:71.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:91.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:112.67px" class="cls_039"><span class="cls_039">In a lot of ways, </span><span class="cls_059">TacoResource</span><span class="cls_039"> isn’t that different from the </span><span class="cls_059">Taco</span><span class="cls_039"> domain type. They</span></div>
<div style="position:absolute;left:102.18px;top:125.66px" class="cls_039"><span class="cls_039">both have </span><span class="cls_059">name</span><span class="cls_039">, </span><span class="cls_059">createdAt</span><span class="cls_039">, and </span><span class="cls_059">ingredients</span><span class="cls_039"> properties. But </span><span class="cls_059">TacoResource</span><span class="cls_039"> extends</span></div>
<div style="position:absolute;left:102.18px;top:138.65px" class="cls_059"><span class="cls_059">ResourceSupport</span><span class="cls_039"> to inherit a list of </span><span class="cls_059">Link</span><span class="cls_039"> object and methods to manage the list of</span></div>
<div style="position:absolute;left:102.18px;top:151.67px" class="cls_039"><span class="cls_039">links.</span></div>
<div style="position:absolute;left:117.66px;top:164.66px" class="cls_039"><span class="cls_039">What’s more, </span><span class="cls_059">TacoResource</span><span class="cls_039"> doesn’t include the </span><span class="cls_059">id</span><span class="cls_039"> property from </span><span class="cls_059">Taco</span><span class="cls_039">. That’s</span></div>
<div style="position:absolute;left:102.18px;top:177.65px" class="cls_039"><span class="cls_039">because there’s no need to expose any database-specific IDs in the API. The</span></div>
<div style="position:absolute;left:102.18px;top:190.67px" class="cls_039"><span class="cls_039">resource’s </span><span class="cls_059">self</span><span class="cls_039"> link will serve as the identifier for the resource from the perspective</span></div>
<div style="position:absolute;left:102.18px;top:203.66px" class="cls_039"><span class="cls_039">of an API client.</span></div>
<div style="position:absolute;left:114.18px;top:222.65px" class="cls_083"><span class="cls_083">NOTE</span><span class="cls_039">  Domains and resources: separate or the same? Some Spring developers</span></div>
<div style="position:absolute;left:114.18px;top:234.65px" class="cls_039"><span class="cls_039">may choose to combine their domain and resource types into a single type by</span></div>
<div style="position:absolute;left:114.18px;top:246.65px" class="cls_039"><span class="cls_039">having their domain types extend </span><span class="cls_059">ResourceSupport</span><span class="cls_039">. There’s no right or</span></div>
<div style="position:absolute;left:114.18px;top:258.65px" class="cls_039"><span class="cls_039">wrong answer as to which is the correct way. I chose to create a separate</span></div>
<div style="position:absolute;left:114.18px;top:270.65px" class="cls_039"><span class="cls_039">resource type so that </span><span class="cls_059">Taco</span><span class="cls_039"> isn’t unnecessarily cluttered with resource links for</span></div>
<div style="position:absolute;left:114.18px;top:282.65px" class="cls_039"><span class="cls_039">use cases where links aren’t needed. Also, by creating a separate resource</span></div>
<div style="position:absolute;left:114.18px;top:294.68px" class="cls_039"><span class="cls_039">type, I was able to easily leave the </span><span class="cls_059">id</span><span class="cls_039"> property out so that it won’t be exposed</span></div>
<div style="position:absolute;left:114.18px;top:306.68px" class="cls_039"><span class="cls_039">in the API.</span></div>
<div style="position:absolute;left:102.18px;top:326.66px" class="cls_059"><span class="cls_059">TacoResource</span><span class="cls_039"> has a single constructor that accepts a </span><span class="cls_059">Taco</span><span class="cls_039"> and copies the pertinent</span></div>
<div style="position:absolute;left:102.18px;top:339.68px" class="cls_039"><span class="cls_039">properties from the </span><span class="cls_059">Taco</span><span class="cls_039"> to its own properties. This makes it easy to convert a single</span></div>
<div style="position:absolute;left:102.18px;top:352.67px" class="cls_059"><span class="cls_059">Taco</span><span class="cls_039"> object to a </span><span class="cls_059">TacoResource</span><span class="cls_039">. But if you stop there, you’d still need looping to con-</span></div>
<div style="position:absolute;left:102.18px;top:365.66px" class="cls_039"><span class="cls_039">vert a list of </span><span class="cls_059">Taco</span><span class="cls_039"> objects to a </span><span class="cls_059">Resources&lt;TacoResource&gt;</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.83px;top:378.68px" class="cls_039"><span class="cls_039">To aid in converting </span><span class="cls_059">Taco</span><span class="cls_039"> objects to </span><span class="cls_059">TacoResource</span><span class="cls_039"> objects, you’re also going to</span></div>
<div style="position:absolute;left:102.18px;top:391.67px" class="cls_039"><span class="cls_039">create a resource assembler. The following listing is what you’ll need.</span></div>
<div style="position:absolute;left:114.18px;top:415.40px" class="cls_066"><span class="cls_066">Listing 6.6</span></div>
<div style="position:absolute;left:166.27px;top:415.40px" class="cls_066"><span class="cls_066">A resource assembler that assembles taco resources</span></div>
<div style="position:absolute;left:102.18px;top:435.26px" class="cls_060"><span class="cls_060">package tacos.web.api;</span></div>
<div style="position:absolute;left:102.18px;top:455.24px" class="cls_060"><span class="cls_060">import org.springframework.hateoas.mvc.ResourceAssemblerSupport;</span></div>
<div style="position:absolute;left:102.18px;top:475.25px" class="cls_060"><span class="cls_060">import tacos.Taco;</span></div>
<div style="position:absolute;left:102.18px;top:495.26px" class="cls_060"><span class="cls_060">public class TacoResourceAssembler</span></div>
<div style="position:absolute;left:135.76px;top:505.25px" class="cls_060"><span class="cls_060">extends ResourceAssemblerSupport&lt;Taco, TacoResource&gt; {</span></div>
<div style="position:absolute;left:111.78px;top:525.26px" class="cls_060"><span class="cls_060">public TacoResourceAssembler() {</span></div>
<div style="position:absolute;left:121.38px;top:535.25px" class="cls_060"><span class="cls_060">super(DesignTacoController.class, TacoResource.class);</span></div>
<div style="position:absolute;left:111.78px;top:545.24px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:565.25px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:111.78px;top:575.24px" class="cls_060"><span class="cls_060">protected TacoResource instantiateResource(Taco taco) {</span></div>
<div style="position:absolute;left:121.38px;top:585.26px" class="cls_060"><span class="cls_060">return new TacoResource(taco);</span></div>
<div style="position:absolute;left:111.78px;top:595.25px" class="cls_060"><span class="cls_060">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:116944px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background178.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">156</span></div>
<div style="position:absolute;left:197.31px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 6</span></div>
<div style="position:absolute;left:241.47px;top:24.35px" class="cls_055"><span class="cls_055">Creating REST services</span></div>
<div style="position:absolute;left:102.78px;top:51.32px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:102.78px;top:61.34px" class="cls_060"><span class="cls_060">public TacoResource toResource(Taco taco) {</span></div>
<div style="position:absolute;left:112.38px;top:71.33px" class="cls_060"><span class="cls_060">return createResourceWithId(taco.getId(), taco);</span></div>
<div style="position:absolute;left:102.78px;top:81.32px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:97.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:116.66px" class="cls_059"><span class="cls_059">TacoResourceAssembler</span><span class="cls_039"> has a default constructor that informs the superclass (</span><span class="cls_059">Resource-</span></div>
<div style="position:absolute;left:93.36px;top:129.65px" class="cls_059"><span class="cls_059">AssemblerSupport</span><span class="cls_039">) that it will be using </span><span class="cls_059">DesignTacoController</span><span class="cls_039"> to determine the base</span></div>
<div style="position:absolute;left:93.18px;top:142.67px" class="cls_039"><span class="cls_039">path for any URLs in links it creates when creating a </span><span class="cls_059">TacoResource</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:108.03px;top:155.66px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">instantiateResource()</span><span class="cls_039"> method is overridden to instantiate a </span><span class="cls_059">TacoResource</span></div>
<div style="position:absolute;left:93.18px;top:168.65px" class="cls_039"><span class="cls_039">given a </span><span class="cls_059">Taco</span><span class="cls_039">. This method would be optional if </span><span class="cls_059">TacoResource</span><span class="cls_039"> had a default construc-</span></div>
<div style="position:absolute;left:93.18px;top:181.67px" class="cls_039"><span class="cls_039">tor. In this case, however, </span><span class="cls_059">TacoResource</span><span class="cls_039"> requires construction with a </span><span class="cls_059">Taco</span><span class="cls_039">, so you’re</span></div>
<div style="position:absolute;left:93.18px;top:194.66px" class="cls_039"><span class="cls_039">required to override it.</span></div>
<div style="position:absolute;left:109.40px;top:207.65px" class="cls_039"><span class="cls_039">Finally, the </span><span class="cls_059">toResource()</span><span class="cls_039"> method is the only method that’s strictly mandatory</span></div>
<div style="position:absolute;left:93.18px;top:220.67px" class="cls_039"><span class="cls_039">when extending </span><span class="cls_059">ResourceAssemblerSupport</span><span class="cls_039">. Here you’re telling it to create a </span><span class="cls_059">Taco-</span></div>
<div style="position:absolute;left:93.18px;top:233.66px" class="cls_059"><span class="cls_059">Resource</span><span class="cls_039"> object from a </span><span class="cls_059">Taco</span><span class="cls_039">, and to automatically give it a </span><span class="cls_059">self</span><span class="cls_039"> link with the URL</span></div>
<div style="position:absolute;left:93.18px;top:246.65px" class="cls_039"><span class="cls_039">being derived from the </span><span class="cls_059">Taco</span><span class="cls_039"> object’s </span><span class="cls_059">id</span><span class="cls_039"> property.</span></div>
<div style="position:absolute;left:108.01px;top:259.67px" class="cls_039"><span class="cls_039">On the surface, </span><span class="cls_059">toResource()</span><span class="cls_039"> appears to have a similar purpose to </span><span class="cls_059">instantiate-</span></div>
<div style="position:absolute;left:93.33px;top:272.66px" class="cls_059"><span class="cls_059">Resource()</span><span class="cls_039">, but they serve slightly different purposes. Whereas </span><span class="cls_059">instantiateResource()</span></div>
<div style="position:absolute;left:93.18px;top:285.65px" class="cls_039"><span class="cls_039">is intended to only instantiate a </span><span class="cls_059">Resource</span><span class="cls_039"> object, </span><span class="cls_059">toResource()</span><span class="cls_039"> is intended not only</span></div>
<div style="position:absolute;left:93.18px;top:298.67px" class="cls_039"><span class="cls_039">to create the </span><span class="cls_059">Resource</span><span class="cls_039"> object, but also to populate it with links. Under the covers,</span></div>
<div style="position:absolute;left:93.18px;top:311.66px" class="cls_059"><span class="cls_059">toResource()</span><span class="cls_039"> will call </span><span class="cls_059">instantiateResource()</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:107.76px;top:324.68px" class="cls_039"><span class="cls_039">Now tweak the </span><span class="cls_059">recentTacos()</span><span class="cls_039"> method to make use of </span><span class="cls_059">TacoResourceAssembler</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:344.33px" class="cls_060"><span class="cls_060">@GetMapping("/recent")</span></div>
<div style="position:absolute;left:93.18px;top:354.35px" class="cls_060"><span class="cls_060">public Resources&lt;TacoResource&gt; recentTacos() {</span></div>
<div style="position:absolute;left:102.78px;top:364.34px" class="cls_060"><span class="cls_060">PageRequest page = PageRequest.of(</span></div>
<div style="position:absolute;left:141.12px;top:374.33px" class="cls_060"><span class="cls_060">0, 12, Sort.by("createdAt").descending());</span></div>
<div style="position:absolute;left:102.78px;top:384.35px" class="cls_060"><span class="cls_060">List&lt;Taco&gt; tacos = tacoRepo.findAll(page).getContent();</span></div>
<div style="position:absolute;left:102.78px;top:400.34px" class="cls_060"><span class="cls_060">List&lt;TacoResource&gt; tacoResources =</span></div>
<div style="position:absolute;left:121.95px;top:410.36px" class="cls_060"><span class="cls_060">new TacoResourceAssembler().toResources(tacos);</span></div>
<div style="position:absolute;left:102.77px;top:420.35px" class="cls_060"><span class="cls_060">Resources&lt;TacoResource&gt; recentResources =</span></div>
<div style="position:absolute;left:121.95px;top:430.34px" class="cls_060"><span class="cls_060">new Resources&lt;TacoResource&gt;(tacoResources);</span></div>
<div style="position:absolute;left:102.78px;top:440.36px" class="cls_060"><span class="cls_060">recentResources.add(</span></div>
<div style="position:absolute;left:121.95px;top:450.35px" class="cls_060"><span class="cls_060">linkTo(methodOn(DesignTacoController.class).recentTacos())</span></div>
<div style="position:absolute;left:121.95px;top:460.34px" class="cls_060"><span class="cls_060">.withRel("recents"));</span></div>
<div style="position:absolute;left:102.78px;top:470.36px" class="cls_060"><span class="cls_060">return recentResources;</span></div>
<div style="position:absolute;left:93.18px;top:480.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:499.67px" class="cls_039"><span class="cls_039">Rather than return a </span><span class="cls_059">Resources&lt;Resource&lt;Taco&gt;&gt;</span><span class="cls_039">, </span><span class="cls_059">recentTacos()</span><span class="cls_039"> now returns a</span></div>
<div style="position:absolute;left:93.18px;top:512.66px" class="cls_059"><span class="cls_059">Resources&lt;TacoResource&gt;</span><span class="cls_039"> to take advantage of your new </span><span class="cls_059">TacoResource</span><span class="cls_039"> type. After</span></div>
<div style="position:absolute;left:93.18px;top:525.68px" class="cls_039"><span class="cls_039">fetching the tacos from the repository, you pass the list of </span><span class="cls_059">Taco</span><span class="cls_039"> objects to the</span></div>
<div style="position:absolute;left:93.18px;top:538.67px" class="cls_059"><span class="cls_059">toResources()</span><span class="cls_039"> method on a </span><span class="cls_059">TacoResourceAssembler</span><span class="cls_039">. This handy method cycles</span></div>
<div style="position:absolute;left:93.18px;top:551.69px" class="cls_039"><span class="cls_039">through all of the </span><span class="cls_059">Taco</span><span class="cls_039"> objects, calling the </span><span class="cls_059">toResource()</span><span class="cls_039"> method that you overrode</span></div>
<div style="position:absolute;left:93.18px;top:564.68px" class="cls_039"><span class="cls_039">in </span><span class="cls_059">TacoResourceAssembler</span><span class="cls_039"> to create a list of </span><span class="cls_059">TacoResource</span><span class="cls_039"> objects.</span></div>
<div style="position:absolute;left:108.66px;top:577.67px" class="cls_039"><span class="cls_039">With that </span><span class="cls_059">TacoResource</span><span class="cls_039"> list, you next create a </span><span class="cls_059">Resources&lt;TacoResource&gt;</span><span class="cls_039"> object</span></div>
<div style="position:absolute;left:93.18px;top:590.69px" class="cls_039"><span class="cls_039">and then populate it with the </span><span class="cls_059">recents</span><span class="cls_039"> links as in the prior version of </span><span class="cls_059">recentTacos()</span><span class="cls_039">.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:117620px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background179.jpg" width="531" height="666"></div>
<div style="position:absolute;left:231.72px;top:24.35px" class="cls_055"><span class="cls_055">Enabling hypermedia</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">157</span></div>
<div style="position:absolute;left:116.62px;top:50.66px" class="cls_039"><span class="cls_039">At this point, a </span><span class="cls_059">GET</span><span class="cls_039"> request to /design/recent will produce a list of tacos, each with</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">a </span><span class="cls_059">self</span><span class="cls_039"> link and a </span><span class="cls_059">recents</span><span class="cls_039"> link on the list itself. But the ingredients will still be without</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">a link. To address that, you’ll create a new resource assembler for ingredients:</span></div>
<div style="position:absolute;left:102.18px;top:98.33px" class="cls_060"><span class="cls_060">package tacos.web.api;</span></div>
<div style="position:absolute;left:102.18px;top:108.32px" class="cls_060"><span class="cls_060">import org.springframework.hateoas.mvc.ResourceAssemblerSupport;</span></div>
<div style="position:absolute;left:102.18px;top:118.34px" class="cls_060"><span class="cls_060">import tacos.Ingredient;</span></div>
<div style="position:absolute;left:102.18px;top:138.35px" class="cls_060"><span class="cls_060">class IngredientResourceAssembler extends</span></div>
<div style="position:absolute;left:150.13px;top:148.34px" class="cls_060"><span class="cls_060">ResourceAssemblerSupport&lt;Ingredient, IngredientResource&gt; {</span></div>
<div style="position:absolute;left:111.78px;top:168.35px" class="cls_060"><span class="cls_060">public IngredientResourceAssembler() {</span></div>
<div style="position:absolute;left:121.38px;top:178.34px" class="cls_060"><span class="cls_060">super(IngredientController2.class, IngredientResource.class);</span></div>
<div style="position:absolute;left:111.78px;top:188.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:208.34px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:111.78px;top:218.33px" class="cls_060"><span class="cls_060">public IngredientResource toResource(Ingredient ingredient) {</span></div>
<div style="position:absolute;left:121.38px;top:228.35px" class="cls_060"><span class="cls_060">return createResourceWithId(ingredient.getId(), ingredient);</span></div>
<div style="position:absolute;left:111.78px;top:238.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:258.35px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:111.78px;top:268.34px" class="cls_060"><span class="cls_060">protected IngredientResource instantiateResource(</span></div>
<div style="position:absolute;left:313.23px;top:278.33px" class="cls_060"><span class="cls_060">Ingredient ingredient) {</span></div>
<div style="position:absolute;left:121.38px;top:288.35px" class="cls_060"><span class="cls_060">return new IngredientResource(ingredient);</span></div>
<div style="position:absolute;left:111.78px;top:298.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:318.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:341.66px" class="cls_039"><span class="cls_039">As you can see, IngredientResourceAssembler is much like TacoResourceAssembler,</span></div>
<div style="position:absolute;left:102.18px;top:354.68px" class="cls_039"><span class="cls_039">but it works with Ingredient and IngredientResource objects instead of Taco and</span></div>
<div style="position:absolute;left:102.18px;top:367.67px" class="cls_039"><span class="cls_039">TacoResource objects.</span></div>
<div style="position:absolute;left:116.78px;top:380.66px" class="cls_039"><span class="cls_039">Speaking of </span><span class="cls_059">IngredientResource</span><span class="cls_039">, it looks like this:</span></div>
<div style="position:absolute;left:102.18px;top:402.35px" class="cls_060"><span class="cls_060">package tacos.web.api;</span></div>
<div style="position:absolute;left:102.18px;top:412.34px" class="cls_060"><span class="cls_060">import org.springframework.hateoas.ResourceSupport;</span></div>
<div style="position:absolute;left:102.18px;top:422.36px" class="cls_060"><span class="cls_060">import lombok.Getter;</span></div>
<div style="position:absolute;left:102.18px;top:432.35px" class="cls_060"><span class="cls_060">import tacos.Ingredient;</span></div>
<div style="position:absolute;left:102.18px;top:442.34px" class="cls_060"><span class="cls_060">import tacos.Ingredient.Type;</span></div>
<div style="position:absolute;left:102.18px;top:462.35px" class="cls_060"><span class="cls_060">public class IngredientResource extends ResourceSupport {</span></div>
<div style="position:absolute;left:111.78px;top:482.36px" class="cls_060"><span class="cls_060">@Getter</span></div>
<div style="position:absolute;left:111.78px;top:492.35px" class="cls_060"><span class="cls_060">private String name;</span></div>
<div style="position:absolute;left:111.78px;top:512.36px" class="cls_060"><span class="cls_060">@Getter</span></div>
<div style="position:absolute;left:111.78px;top:522.35px" class="cls_060"><span class="cls_060">private Type type;</span></div>
<div style="position:absolute;left:111.78px;top:542.36px" class="cls_060"><span class="cls_060">public IngredientResource(Ingredient ingredient) {</span></div>
<div style="position:absolute;left:121.38px;top:552.35px" class="cls_060"><span class="cls_060">this.name = ingredient.getName();</span></div>
<div style="position:absolute;left:121.38px;top:562.34px" class="cls_060"><span class="cls_060">this.type = ingredient.getType();</span></div>
<div style="position:absolute;left:111.78px;top:572.36px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:592.34px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:118296px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background180.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">158</span></div>
<div style="position:absolute;left:197.31px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 6</span></div>
<div style="position:absolute;left:241.47px;top:24.35px" class="cls_055"><span class="cls_055">Creating REST services</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">As with </span><span class="cls_059">TacoResource</span><span class="cls_039">, </span><span class="cls_059">IngredientResource</span><span class="cls_039"> extends </span><span class="cls_059">ResourceSupport</span><span class="cls_039"> and copies</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">pertinent properties from the domain type into its own set of properties (leaving out</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">id</span><span class="cls_039"> property).</span></div>
<div style="position:absolute;left:107.61px;top:89.66px" class="cls_039"><span class="cls_039">All that’s left is to make a slight change to </span><span class="cls_059">TacoResource</span><span class="cls_039"> so that it carries </span><span class="cls_059">Ingredient-</span></div>
<div style="position:absolute;left:93.33px;top:102.65px" class="cls_059"><span class="cls_059">Resource</span><span class="cls_039"> objects instead of </span><span class="cls_059">Ingredient</span><span class="cls_039"> objects:</span></div>
<div style="position:absolute;left:93.18px;top:125.33px" class="cls_060"><span class="cls_060">package tacos.web.api;</span></div>
<div style="position:absolute;left:93.18px;top:135.35px" class="cls_060"><span class="cls_060">import java.util.Date;</span></div>
<div style="position:absolute;left:93.18px;top:145.34px" class="cls_060"><span class="cls_060">import java.util.List;</span></div>
<div style="position:absolute;left:93.18px;top:155.33px" class="cls_060"><span class="cls_060">import org.springframework.hateoas.ResourceSupport;</span></div>
<div style="position:absolute;left:93.18px;top:165.35px" class="cls_060"><span class="cls_060">import lombok.Getter;</span></div>
<div style="position:absolute;left:93.18px;top:175.34px" class="cls_060"><span class="cls_060">import tacos.Taco;</span></div>
<div style="position:absolute;left:93.18px;top:197.33px" class="cls_060"><span class="cls_060">public class TacoResource extends ResourceSupport {</span></div>
<div style="position:absolute;left:102.77px;top:219.35px" class="cls_060"><span class="cls_060">private static final IngredientResourceAssembler</span></div>
<div style="position:absolute;left:150.75px;top:229.34px" class="cls_060"><span class="cls_060">ingredientAssembler = new IngredientResourceAssembler();</span></div>
<div style="position:absolute;left:102.78px;top:251.33px" class="cls_060"><span class="cls_060">@Getter</span></div>
<div style="position:absolute;left:102.78px;top:261.35px" class="cls_060"><span class="cls_060">private final String name;</span></div>
<div style="position:absolute;left:102.78px;top:283.34px" class="cls_060"><span class="cls_060">@Getter</span></div>
<div style="position:absolute;left:102.78px;top:293.33px" class="cls_060"><span class="cls_060">private final Date createdAt;</span></div>
<div style="position:absolute;left:102.78px;top:315.35px" class="cls_060"><span class="cls_060">@Getter</span></div>
<div style="position:absolute;left:102.78px;top:325.34px" class="cls_060"><span class="cls_060">private final List&lt;IngredientResource&gt; ingredients;</span></div>
<div style="position:absolute;left:102.78px;top:347.33px" class="cls_060"><span class="cls_060">public TacoResource(Taco taco) {</span></div>
<div style="position:absolute;left:112.38px;top:357.35px" class="cls_060"><span class="cls_060">this.name = taco.getName();</span></div>
<div style="position:absolute;left:112.38px;top:367.34px" class="cls_060"><span class="cls_060">this.createdAt = taco.getCreatedAt();</span></div>
<div style="position:absolute;left:112.38px;top:377.33px" class="cls_060"><span class="cls_060">this.ingredients =</span></div>
<div style="position:absolute;left:131.55px;top:387.35px" class="cls_060"><span class="cls_060">ingredientAssembler.toResources(taco.getIngredients());</span></div>
<div style="position:absolute;left:102.78px;top:397.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:417.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:441.68px" class="cls_039"><span class="cls_039">This new version of </span><span class="cls_059">TacoResource</span><span class="cls_039"> creates a static final instance of </span><span class="cls_059">Ingredient-</span></div>
<div style="position:absolute;left:93.27px;top:454.67px" class="cls_059"><span class="cls_059">ResourceAssembler</span><span class="cls_039"> and uses its </span><span class="cls_059">toResource()</span><span class="cls_039"> method to convert a given </span><span class="cls_059">Taco</span><span class="cls_039"> object’s</span></div>
<div style="position:absolute;left:93.18px;top:467.66px" class="cls_039"><span class="cls_039">list of </span><span class="cls_059">Ingredient</span><span class="cls_039"> into a list of </span><span class="cls_059">IngredientResource</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:107.64px;top:480.68px" class="cls_039"><span class="cls_039">Your recent tacos list is now completely outfitted with hyperlinks, not only for itself</span></div>
<div style="position:absolute;left:93.18px;top:493.67px" class="cls_039"><span class="cls_039">(the </span><span class="cls_059">recents</span><span class="cls_039"> link), but also for all of its taco entries and the ingredients of those</span></div>
<div style="position:absolute;left:93.18px;top:506.66px" class="cls_039"><span class="cls_039">tacos. The response should look a lot like the JSON in listing 6.3.</span></div>
<div style="position:absolute;left:108.41px;top:519.68px" class="cls_039"><span class="cls_039">You could stop here and move on to the next subject. But first I’ll address some-</span></div>
<div style="position:absolute;left:93.18px;top:532.67px" class="cls_039"><span class="cls_039">thing that’s been bugging me about listing 6.3.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:118972px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background181.jpg" width="531" height="666"></div>
<div style="position:absolute;left:231.72px;top:24.35px" class="cls_055"><span class="cls_055">Enabling hypermedia</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">159</span></div>
<div style="position:absolute;left:66.18px;top:50.48px" class="cls_063"><span class="cls_063">6.2.3</span></div>
<div style="position:absolute;left:102.18px;top:50.48px" class="cls_063"><span class="cls_063">Naming embedded relationships</span></div>
<div style="position:absolute;left:102.18px;top:67.67px" class="cls_039"><span class="cls_039">If you take a closer look at listing 6.3, you’ll notice that the top-level elements look</span></div>
<div style="position:absolute;left:102.18px;top:80.66px" class="cls_039"><span class="cls_039">like this:</span></div>
<div style="position:absolute;left:102.18px;top:100.34px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:111.78px;top:110.33px" class="cls_060"><span class="cls_060">"_embedded": {</span></div>
<div style="position:absolute;left:121.38px;top:120.32px" class="cls_060"><span class="cls_060">"tacoResourceList": [</span></div>
<div style="position:absolute;left:121.38px;top:140.33px" class="cls_060"><span class="cls_060">]</span></div>
<div style="position:absolute;left:111.78px;top:150.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:160.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:181.67px" class="cls_039"><span class="cls_039">Most notably, let me draw your attention to the name </span><span class="cls_059">tacoResourceList</span><span class="cls_039"> under</span></div>
<div style="position:absolute;left:102.18px;top:194.66px" class="cls_059"><span class="cls_059">embedded</span><span class="cls_039">. That name was derived from the fact that the </span><span class="cls_059">Resources</span><span class="cls_039"> object was cre-</span></div>
<div style="position:absolute;left:102.18px;top:207.65px" class="cls_039"><span class="cls_039">ated from a </span><span class="cls_059">List&lt;TacoResource&gt;</span><span class="cls_039">. Not that it’s likely, but if you were to refactor the</span></div>
<div style="position:absolute;left:102.18px;top:220.67px" class="cls_039"><span class="cls_039">name of the </span><span class="cls_059">TacoResource</span><span class="cls_039"> class to something else, the field name in the resulting</span></div>
<div style="position:absolute;left:102.18px;top:233.66px" class="cls_039"><span class="cls_039">JSON would change to match it. This would likely break any clients coded to count</span></div>
<div style="position:absolute;left:102.18px;top:246.65px" class="cls_039"><span class="cls_039">on that name.</span></div>
<div style="position:absolute;left:117.66px;top:259.67px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">@Relation</span><span class="cls_039"> annotation can help break the coupling between the JSON field</span></div>
<div style="position:absolute;left:102.18px;top:272.66px" class="cls_039"><span class="cls_039">name and the resource type class names as defined in Java. By annotating </span><span class="cls_059">Taco-</span></div>
<div style="position:absolute;left:102.18px;top:285.65px" class="cls_059"><span class="cls_059">Resource</span><span class="cls_039"> with </span><span class="cls_059">@Relation</span><span class="cls_039">, you can specify how Spring HATEOAS should name the</span></div>
<div style="position:absolute;left:102.18px;top:298.67px" class="cls_039"><span class="cls_039">field in the resulting JSON:</span></div>
<div style="position:absolute;left:102.18px;top:318.35px" class="cls_060"><span class="cls_060">@Relation(value="taco", collectionRelation="tacos")</span></div>
<div style="position:absolute;left:102.18px;top:328.34px" class="cls_060"><span class="cls_060">public class TacoResource extends ResourceSupport {</span></div>
<div style="position:absolute;left:102.18px;top:348.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:369.68px" class="cls_039"><span class="cls_039">Here you’ve specified that when a list of </span><span class="cls_059">TacoResource</span><span class="cls_039"> objects is used in a </span><span class="cls_059">Resources</span></div>
<div style="position:absolute;left:102.18px;top:382.67px" class="cls_039"><span class="cls_039">object, it should be named </span><span class="cls_059">tacos</span><span class="cls_039">. And although you’re not making use of it in our</span></div>
<div style="position:absolute;left:102.18px;top:395.66px" class="cls_039"><span class="cls_039">API, a single </span><span class="cls_059">TacoResource</span><span class="cls_039"> object should be referred to in JSON as </span><span class="cls_059">taco</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.91px;top:408.68px" class="cls_039"><span class="cls_039">As a result, the JSON returned from /design/recent will now look like this (no</span></div>
<div style="position:absolute;left:102.18px;top:421.67px" class="cls_039"><span class="cls_039">matter what refactoring you may or may not perform on </span><span class="cls_059">TacoResource</span><span class="cls_039">):</span></div>
<div style="position:absolute;left:102.18px;top:441.35px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:111.78px;top:451.34px" class="cls_060"><span class="cls_060">"_embedded": {</span></div>
<div style="position:absolute;left:121.38px;top:461.36px" class="cls_060"><span class="cls_060">"tacos": [</span></div>
<div style="position:absolute;left:121.38px;top:481.34px" class="cls_060"><span class="cls_060">]</span></div>
<div style="position:absolute;left:111.78px;top:491.36px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:501.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:522.68px" class="cls_039"><span class="cls_039">Spring HATEOAS makes adding links to your API rather straightforward and simple.</span></div>
<div style="position:absolute;left:102.18px;top:535.67px" class="cls_039"><span class="cls_039">Nonetheless, it did add several lines of code that you wouldn’t otherwise need.</span></div>
<div style="position:absolute;left:102.18px;top:548.66px" class="cls_039"><span class="cls_039">Because of that, some developers may choose to not bother with HATEOAS in their</span></div>
<div style="position:absolute;left:102.18px;top:561.68px" class="cls_039"><span class="cls_039">APIs, even if it means that the client code is subject to breakage if the API’s URL</span></div>
<div style="position:absolute;left:102.18px;top:574.67px" class="cls_039"><span class="cls_039">scheme changes. I encourage you to take HATEOAS seriously and not to take the lazy</span></div>
<div style="position:absolute;left:102.18px;top:587.69px" class="cls_039"><span class="cls_039">way out by not adding hyperlinks in your resources.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:119648px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background182.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">160</span></div>
<div style="position:absolute;left:197.31px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 6</span></div>
<div style="position:absolute;left:241.47px;top:24.35px" class="cls_055"><span class="cls_055">Creating REST services</span></div>
<div style="position:absolute;left:108.91px;top:50.66px" class="cls_039"><span class="cls_039">But if you insist on being lazy, then maybe there’s a win-win scenario for you if</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">you’re using Spring Data for your repositories. Let’s see how Spring Data REST can</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">help you automatically create APIs based on the data repositories you created with</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">Spring Data in chapter 3.</span></div>
<div style="position:absolute;left:57.18px;top:110.83px" class="cls_040"><span class="cls_040">6.3</span></div>
<div style="position:absolute;left:93.18px;top:110.83px" class="cls_040"><span class="cls_040">Enabling data-backed services</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">As you saw in chapter 3, Spring Data performs a special kind of magic by automatically</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">creating repository implementations based on interfaces you define in your code. But</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_039"><span class="cls_039">Spring Data has another trick up its sleeve that can help you define APIs for your</span></div>
<div style="position:absolute;left:93.18px;top:167.66px" class="cls_039"><span class="cls_039">application.</span></div>
<div style="position:absolute;left:107.85px;top:180.65px" class="cls_039"><span class="cls_039">Spring Data REST is another member of the Spring Data family that automatically</span></div>
<div style="position:absolute;left:93.18px;top:193.67px" class="cls_039"><span class="cls_039">creates REST APIs for repositories created by Spring Data. By doing little more than</span></div>
<div style="position:absolute;left:93.18px;top:206.66px" class="cls_039"><span class="cls_039">adding Spring Data REST to your build, you get an API with operations for each</span></div>
<div style="position:absolute;left:93.18px;top:219.65px" class="cls_039"><span class="cls_039">repository interface you’ve defined.</span></div>
<div style="position:absolute;left:107.73px;top:232.67px" class="cls_039"><span class="cls_039">To start using Spring Data REST, you add the following dependency to your build:</span></div>
<div style="position:absolute;left:93.18px;top:252.35px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:262.34px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:272.33px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-boot-starter-data-rest&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:93.18px;top:282.35px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:93.18px;top:303.68px" class="cls_039"><span class="cls_039">Believe it or not, that’s all that’s required to expose a REST API in a project that’s</span></div>
<div style="position:absolute;left:93.18px;top:316.67px" class="cls_039"><span class="cls_039">already using Spring Data for automatic repositories. By simply having the Spring</span></div>
<div style="position:absolute;left:93.18px;top:329.66px" class="cls_039"><span class="cls_039">Data REST starter in the build, the application gets auto-configuration that enables</span></div>
<div style="position:absolute;left:93.18px;top:342.68px" class="cls_039"><span class="cls_039">automatic creation of a REST API for any repositories that were created by Spring</span></div>
<div style="position:absolute;left:93.18px;top:355.67px" class="cls_039"><span class="cls_039">Data (including Spring Data JPA, Spring Data Mongo, and so on).</span></div>
<div style="position:absolute;left:108.63px;top:368.66px" class="cls_039"><span class="cls_039">The REST endpoints that Spring Data REST creates are at least as good as (and</span></div>
<div style="position:absolute;left:93.18px;top:381.68px" class="cls_039"><span class="cls_039">possibly even better than) the ones you’ve created yourself. So at this point, feel free</span></div>
<div style="position:absolute;left:93.18px;top:394.67px" class="cls_039"><span class="cls_039">to do a little demolition work and remove any </span><span class="cls_059">@RestController</span><span class="cls_039">-annotated classes</span></div>
<div style="position:absolute;left:93.18px;top:407.66px" class="cls_039"><span class="cls_039">you’ve created up to this point before moving on.</span></div>
<div style="position:absolute;left:107.84px;top:420.68px" class="cls_039"><span class="cls_039">To try out the endpoints provided by Spring Data REST, you can fire up the appli-</span></div>
<div style="position:absolute;left:93.18px;top:433.67px" class="cls_039"><span class="cls_039">cation and start poking at some of the URLs. Based on the set of repositories you’ve</span></div>
<div style="position:absolute;left:93.18px;top:446.66px" class="cls_039"><span class="cls_039">already defined for Taco Cloud, you should be able to perform </span><span class="cls_059">GET</span><span class="cls_039"> requests for tacos,</span></div>
<div style="position:absolute;left:93.18px;top:459.68px" class="cls_039"><span class="cls_039">ingredients, orders, and users.</span></div>
<div style="position:absolute;left:109.41px;top:472.67px" class="cls_039"><span class="cls_039">For example, you can get a list of all ingredients by making a </span><span class="cls_059">GET</span><span class="cls_039"> request for</span></div>
<div style="position:absolute;left:93.18px;top:485.66px" class="cls_039"><span class="cls_039">/ingredients. Using curl, you might get something that looks like this (abridged to</span></div>
<div style="position:absolute;left:93.18px;top:498.68px" class="cls_039"><span class="cls_039">only show the first ingredient):</span></div>
<div style="position:absolute;left:93.18px;top:520.34px" class="cls_060"><span class="cls_060">$ curl localhost:8080/ingredients</span></div>
<div style="position:absolute;left:93.18px;top:530.36px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:102.78px;top:540.35px" class="cls_060"><span class="cls_060">"_embedded" : {</span></div>
<div style="position:absolute;left:112.38px;top:550.34px" class="cls_060"><span class="cls_060">"ingredients" : [ {</span></div>
<div style="position:absolute;left:121.96px;top:560.36px" class="cls_060"><span class="cls_060">"name" : "Flour Tortilla",</span></div>
<div style="position:absolute;left:121.96px;top:570.35px" class="cls_060"><span class="cls_060">"type" : "WRAP",</span></div>
<div style="position:absolute;left:121.94px;top:580.34px" class="cls_060"><span class="cls_060">"_links" : {</span></div>
<div style="position:absolute;left:131.53px;top:590.36px" class="cls_060"><span class="cls_060">"self" : {</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:120324px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background183.jpg" width="531" height="666"></div>
<div style="position:absolute;left:216.51px;top:24.35px" class="cls_055"><span class="cls_055">Enabling data-backed services</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">161</span></div>
<div style="position:absolute;left:150.15px;top:51.32px" class="cls_060"><span class="cls_060">"href" : "</span><a href="http://localhost:8080/ingredients/flto" "="">http://localhost:8080/ingredients/FLTO"</a> </div>
<div style="position:absolute;left:140.55px;top:61.34px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:140.56px;top:71.33px" class="cls_060"><span class="cls_060">"ingredient" : {</span></div>
<div style="position:absolute;left:150.15px;top:81.32px" class="cls_060"><span class="cls_060">"href" : "</span><a href="http://localhost:8080/ingredients/flto" "="">http://localhost:8080/ingredients/FLTO"</a> </div>
<div style="position:absolute;left:140.55px;top:91.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:130.95px;top:101.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:121.38px;top:111.32px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:121.38px;top:131.33px" class="cls_060"><span class="cls_060">]</span></div>
<div style="position:absolute;left:111.78px;top:141.35px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:111.78px;top:151.34px" class="cls_060"><span class="cls_060">"_links" : {</span></div>
<div style="position:absolute;left:121.38px;top:161.33px" class="cls_060"><span class="cls_060">"self" : {</span></div>
<div style="position:absolute;left:130.96px;top:171.35px" class="cls_060"><span class="cls_060">"href" : "</span><a href="http://localhost:8080/ingredients" "="">http://localhost:8080/ingredients"</a> </div>
<div style="position:absolute;left:121.38px;top:181.34px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:121.38px;top:191.33px" class="cls_060"><span class="cls_060">"profile" : {</span></div>
<div style="position:absolute;left:130.96px;top:201.35px" class="cls_060"><span class="cls_060">"href" : "</span><a href="http://localhost:8080/profile/ingredients" "="">http://localhost:8080/profile/ingredients"</a> </div>
<div style="position:absolute;left:121.38px;top:211.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:221.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:231.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:254.66px" class="cls_039"><span class="cls_039">Wow! By doing nothing more than adding a dependency to your build, you’re not</span></div>
<div style="position:absolute;left:102.18px;top:267.65px" class="cls_039"><span class="cls_039">only getting an endpoint for ingredients, but the resources that come back also con-</span></div>
<div style="position:absolute;left:102.18px;top:280.67px" class="cls_039"><span class="cls_039">tain hyperlinks! Pretending to be a client of this API, you can also use curl to follow</span></div>
<div style="position:absolute;left:102.18px;top:293.66px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">self</span><span class="cls_039"> link for the flour tortilla entry:</span></div>
<div style="position:absolute;left:102.18px;top:316.34px" class="cls_060"><span class="cls_060">$ curl </span><a href="http://localhost:8080/ingredients/flto/">http://localhost:8080/ingredients/FLTO</a> </div>
<div style="position:absolute;left:102.18px;top:326.33px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:111.77px;top:336.35px" class="cls_060"><span class="cls_060">"name" : "Flour Tortilla",</span></div>
<div style="position:absolute;left:111.78px;top:346.34px" class="cls_060"><span class="cls_060">"type" : "WRAP",</span></div>
<div style="position:absolute;left:111.78px;top:356.33px" class="cls_060"><span class="cls_060">"_links" : {</span></div>
<div style="position:absolute;left:121.38px;top:366.35px" class="cls_060"><span class="cls_060">"self" : {</span></div>
<div style="position:absolute;left:130.96px;top:376.34px" class="cls_060"><span class="cls_060">"href" : "</span><a href="http://localhost:8080/ingredients/flto" "="">http://localhost:8080/ingredients/FLTO"</a> </div>
<div style="position:absolute;left:121.38px;top:386.33px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:121.38px;top:396.35px" class="cls_060"><span class="cls_060">"ingredient" : {</span></div>
<div style="position:absolute;left:130.96px;top:406.34px" class="cls_060"><span class="cls_060">"href" : "</span><a href="http://localhost:8080/ingredients/flto" "="">http://localhost:8080/ingredients/FLTO"</a> </div>
<div style="position:absolute;left:121.38px;top:416.36px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:426.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:436.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:459.68px" class="cls_039"><span class="cls_039">To avoid getting too distracted, we won’t waste much more time in this book digging</span></div>
<div style="position:absolute;left:102.18px;top:472.67px" class="cls_039"><span class="cls_039">into each and every endpoint and option that Spring Data REST has created. But you</span></div>
<div style="position:absolute;left:102.18px;top:485.66px" class="cls_039"><span class="cls_039">should know that it also supports </span><span class="cls_059">POST</span><span class="cls_039">, </span><span class="cls_059">PUT</span><span class="cls_039">, and </span><span class="cls_059">DELETE</span><span class="cls_039"> methods for the endpoints it</span></div>
<div style="position:absolute;left:102.18px;top:498.68px" class="cls_039"><span class="cls_039">creates. That’s right: you can </span><span class="cls_059">POST</span><span class="cls_039"> to /ingredients to create a new ingredient and</span></div>
<div style="position:absolute;left:102.18px;top:511.67px" class="cls_059"><span class="cls_059">DELETE</span><span class="cls_039"> /ingredients/FLTO to remove flour tortillas from the menu.</span></div>
<div style="position:absolute;left:116.88px;top:524.66px" class="cls_039"><span class="cls_039">One thing you might want to do is set a base path for the API so that its endpoints</span></div>
<div style="position:absolute;left:102.18px;top:537.68px" class="cls_039"><span class="cls_039">are distinct and don’t collide with any controllers you write. (In fact, if you don’t</span></div>
<div style="position:absolute;left:102.18px;top:550.67px" class="cls_039"><span class="cls_039">remove the </span><span class="cls_059">IngredientsController</span><span class="cls_039"> you created earlier, it will interfere with the</span></div>
<div style="position:absolute;left:102.18px;top:563.69px" class="cls_039"><span class="cls_039">/ingredients endpoint provided by Spring Data REST.) To adjust the base path for</span></div>
<div style="position:absolute;left:102.18px;top:576.68px" class="cls_039"><span class="cls_039">the API, set the </span><span class="cls_059">spring.data.rest.base-path</span><span class="cls_039"> property:</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:121000px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background184.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">162</span></div>
<div style="position:absolute;left:197.31px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 6</span></div>
<div style="position:absolute;left:241.47px;top:24.35px" class="cls_055"><span class="cls_055">Creating REST services</span></div>
<div style="position:absolute;left:93.18px;top:51.32px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:102.78px;top:61.34px" class="cls_060"><span class="cls_060">data:</span></div>
<div style="position:absolute;left:112.38px;top:71.33px" class="cls_060"><span class="cls_060">rest:</span></div>
<div style="position:absolute;left:121.93px;top:81.32px" class="cls_061"><span class="cls_061">base-path: /api</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">This sets the base path for Spring Data REST endpoints to /api. Consequently, the</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">ingredients endpoint is now /api/ingredients. Now give this new base path a spin by</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">requesting a list of tacos:</span></div>
<div style="position:absolute;left:93.18px;top:148.34px" class="cls_060"><span class="cls_060">$ curl </span><a href="http://localhost:8080/api/tacos/">http://localhost:8080/api/tacos</a> </div>
<div style="position:absolute;left:93.18px;top:158.33px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:102.78px;top:168.35px" class="cls_060"><span class="cls_060">"timestamp": "2018-02-11T16:22:12.381+0000",</span></div>
<div style="position:absolute;left:102.78px;top:178.34px" class="cls_060"><span class="cls_060">"status": 404,</span></div>
<div style="position:absolute;left:102.78px;top:188.33px" class="cls_060"><span class="cls_060">"error": "Not Found",</span></div>
<div style="position:absolute;left:102.77px;top:198.35px" class="cls_060"><span class="cls_060">"message": "No message available",</span></div>
<div style="position:absolute;left:102.78px;top:208.34px" class="cls_060"><span class="cls_060">"path": "/api/tacos"</span></div>
<div style="position:absolute;left:93.18px;top:218.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:239.66px" class="cls_039"><span class="cls_039">Oh dear! That didn’t work quite as expected. You have an </span><span class="cls_059">Ingredient</span><span class="cls_039"> entity and an</span></div>
<div style="position:absolute;left:93.18px;top:252.65px" class="cls_059"><span class="cls_059">IngredientRepository</span><span class="cls_039"> interface, which Spring Data REST exposed with an /api/</span></div>
<div style="position:absolute;left:93.18px;top:265.67px" class="cls_039"><span class="cls_039">ingredients endpoint. So if you have a </span><span class="cls_059">Taco</span><span class="cls_039"> entity and a </span><span class="cls_059">TacoRepository</span><span class="cls_039"> interface,</span></div>
<div style="position:absolute;left:93.18px;top:278.66px" class="cls_039"><span class="cls_039">why doesn’t Spring Data REST give you an /api/tacos endpoint?</span></div>
<div style="position:absolute;left:57.18px;top:300.50px" class="cls_063"><span class="cls_063">6.3.1</span></div>
<div style="position:absolute;left:93.18px;top:300.50px" class="cls_063"><span class="cls_063">Adjusting resource paths and relation names</span></div>
<div style="position:absolute;left:93.18px;top:317.66px" class="cls_039"><span class="cls_039">Actually, Spring Data REST </span><span class="cls_036">does</span><span class="cls_039"> give you an endpoint for working with tacos. But as</span></div>
<div style="position:absolute;left:93.18px;top:330.68px" class="cls_039"><span class="cls_039">clever as Spring Data REST can be, it shows itself to be a tiny bit less awesome in how it</span></div>
<div style="position:absolute;left:93.18px;top:343.67px" class="cls_039"><span class="cls_039">exposes the tacos endpoint.</span></div>
<div style="position:absolute;left:108.34px;top:356.66px" class="cls_039"><span class="cls_039">When creating endpoints for Spring Data repositories, Spring Data REST tries to</span></div>
<div style="position:absolute;left:93.18px;top:369.68px" class="cls_039"><span class="cls_039">pluralize the associated entity class. For the </span><span class="cls_059">Ingredient</span><span class="cls_039"> entity, the endpoint is /ingre-</span></div>
<div style="position:absolute;left:93.18px;top:382.67px" class="cls_039"><span class="cls_039">dients. For the </span><span class="cls_059">Order</span><span class="cls_039"> and </span><span class="cls_059">User</span><span class="cls_039"> entities it’s /orders and /users. So far, so good.</span></div>
<div style="position:absolute;left:107.65px;top:395.66px" class="cls_039"><span class="cls_039">But sometimes, such as with “taco”, it trips up on a word and the pluralized version</span></div>
<div style="position:absolute;left:93.18px;top:408.68px" class="cls_039"><span class="cls_039">isn’t quite right. As it turns out, Spring Data REST pluralized “taco” as “tacoes”, so to</span></div>
<div style="position:absolute;left:93.18px;top:421.67px" class="cls_039"><span class="cls_039">make a request for tacos, you must play along and request /api/tacoes:</span></div>
<div style="position:absolute;left:93.18px;top:441.35px" class="cls_060"><span class="cls_060">% curl localhost:8080/api/tacoes</span></div>
<div style="position:absolute;left:93.18px;top:451.34px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:102.78px;top:461.36px" class="cls_060"><span class="cls_060">"_embedded" : {</span></div>
<div style="position:absolute;left:112.36px;top:471.35px" class="cls_060"><span class="cls_060">"tacoes" : [ {</span></div>
<div style="position:absolute;left:121.96px;top:481.34px" class="cls_060"><span class="cls_060">"name" : "Carnivore",</span></div>
<div style="position:absolute;left:121.96px;top:491.36px" class="cls_060"><span class="cls_060">"createdAt" : "2018-02-11T17:01:32.999+0000",</span></div>
<div style="position:absolute;left:121.94px;top:501.35px" class="cls_060"><span class="cls_060">"_links" : {</span></div>
<div style="position:absolute;left:131.53px;top:511.34px" class="cls_060"><span class="cls_060">"self" : {</span></div>
<div style="position:absolute;left:141.14px;top:521.36px" class="cls_060"><span class="cls_060">"href" : "</span><a href="http://localhost:8080/api/tacoes/2" "="">http://localhost:8080/api/tacoes/2"</a> </div>
<div style="position:absolute;left:131.55px;top:531.35px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:131.53px;top:541.34px" class="cls_060"><span class="cls_060">"taco" : {</span></div>
<div style="position:absolute;left:141.14px;top:551.36px" class="cls_060"><span class="cls_060">"href" : "</span><a href="http://localhost:8080/api/tacoes/2" "="">http://localhost:8080/api/tacoes/2"</a> </div>
<div style="position:absolute;left:131.55px;top:561.35px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:131.56px;top:571.34px" class="cls_060"><span class="cls_060">"ingredients" : {</span></div>
<div style="position:absolute;left:141.12px;top:581.36px" class="cls_060"><span class="cls_060">"href" : "</span><a href="http://localhost:8080/api/tacoes/2/ingredients" "="">http://localhost:8080/api/tacoes/2/ingredients"</a> </div>
<div style="position:absolute;left:131.55px;top:591.35px" class="cls_060"><span class="cls_060">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:121676px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background185.jpg" width="531" height="666"></div>
<div style="position:absolute;left:216.51px;top:24.35px" class="cls_055"><span class="cls_055">Enabling data-backed services</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">163</span></div>
<div style="position:absolute;left:130.95px;top:51.32px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:121.38px;top:61.34px" class="cls_060"><span class="cls_060">}]</span></div>
<div style="position:absolute;left:111.78px;top:71.33px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:111.78px;top:81.32px" class="cls_060"><span class="cls_060">"page" : {</span></div>
<div style="position:absolute;left:121.38px;top:91.34px" class="cls_060"><span class="cls_060">"size" : 20,</span></div>
<div style="position:absolute;left:121.38px;top:101.33px" class="cls_060"><span class="cls_060">"totalElements" : 3,</span></div>
<div style="position:absolute;left:121.38px;top:111.32px" class="cls_060"><span class="cls_060">"totalPages" : 1,</span></div>
<div style="position:absolute;left:121.38px;top:121.34px" class="cls_060"><span class="cls_060">"number" : 0</span></div>
<div style="position:absolute;left:111.78px;top:131.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:141.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:165.65px" class="cls_039"><span class="cls_039">You may be wondering how I knew that “taco” would be mispluralized as “tacoes”. As it</span></div>
<div style="position:absolute;left:102.18px;top:178.67px" class="cls_039"><span class="cls_039">turns out, Spring Data REST also exposes a home resource that has links for all</span></div>
<div style="position:absolute;left:102.18px;top:191.66px" class="cls_039"><span class="cls_039">exposed endpoints. Just make a </span><span class="cls_059">GET</span><span class="cls_039"> request to the API base path to get the goods:</span></div>
<div style="position:absolute;left:102.18px;top:214.34px" class="cls_060"><span class="cls_060">$ curl localhost:8080/api</span></div>
<div style="position:absolute;left:102.18px;top:224.33px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:111.78px;top:234.35px" class="cls_060"><span class="cls_060">"_links" : {</span></div>
<div style="position:absolute;left:121.38px;top:244.34px" class="cls_060"><span class="cls_060">"orders" : {</span></div>
<div style="position:absolute;left:130.96px;top:254.33px" class="cls_060"><span class="cls_060">"href" : "</span><a href="http://localhost:8080/api/orders" "="">http://localhost:8080/api/orders"</a> </div>
<div style="position:absolute;left:121.38px;top:264.35px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:121.36px;top:274.34px" class="cls_060"><span class="cls_060">"ingredients" : {</span></div>
<div style="position:absolute;left:130.96px;top:284.33px" class="cls_060"><span class="cls_060">"href" : "</span><a href="http://localhost:8080/api/ingredients" "="">http://localhost:8080/api/ingredients"</a> </div>
<div style="position:absolute;left:121.38px;top:294.35px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:121.38px;top:304.34px" class="cls_060"><span class="cls_060">"tacoes" : {</span></div>
<div style="position:absolute;left:130.96px;top:314.33px" class="cls_060"><span class="cls_060">"href" : "</span><a href="http://localhost:8080/api/tacoes%7B?page/">http://localhost:8080/api/tacoes{?page</a>,size,sort}",</div>
<div style="position:absolute;left:130.94px;top:324.35px" class="cls_060"><span class="cls_060">"templated" : true</span></div>
<div style="position:absolute;left:121.38px;top:334.34px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:121.38px;top:344.33px" class="cls_060"><span class="cls_060">"users" : {</span></div>
<div style="position:absolute;left:130.96px;top:354.35px" class="cls_060"><span class="cls_060">"href" : "</span><a href="http://localhost:8080/api/users" "="">http://localhost:8080/api/users"</a> </div>
<div style="position:absolute;left:121.38px;top:364.34px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:121.38px;top:374.33px" class="cls_060"><span class="cls_060">"profile" : {</span></div>
<div style="position:absolute;left:130.96px;top:384.35px" class="cls_060"><span class="cls_060">"href" : "</span><a href="http://localhost:8080/api/profile" "="">http://localhost:8080/api/profile"</a> </div>
<div style="position:absolute;left:121.38px;top:394.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:404.36px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:414.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:438.68px" class="cls_039"><span class="cls_039">As you can see, the home resource shows the links for all of your entities. Everything</span></div>
<div style="position:absolute;left:102.18px;top:451.67px" class="cls_039"><span class="cls_039">looks good, except for the </span><span class="cls_059">tacoes</span><span class="cls_039"> link, where both the relation name and the URL</span></div>
<div style="position:absolute;left:102.18px;top:464.66px" class="cls_039"><span class="cls_039">have the odd pluralization of “taco”.</span></div>
<div style="position:absolute;left:118.12px;top:477.68px" class="cls_039"><span class="cls_039">The good news is that you don’t have to accept this little quirk of Spring Data</span></div>
<div style="position:absolute;left:102.18px;top:490.67px" class="cls_039"><span class="cls_039">REST. By adding a simple annotation to the </span><span class="cls_059">Taco</span><span class="cls_039"> class, you can tweak both the rela-</span></div>
<div style="position:absolute;left:102.18px;top:503.66px" class="cls_039"><span class="cls_039">tion name and that path:</span></div>
<div style="position:absolute;left:102.18px;top:526.34px" class="cls_060"><span class="cls_060">@Data</span></div>
<div style="position:absolute;left:102.18px;top:536.36px" class="cls_060"><span class="cls_060">@Entity</span></div>
<div style="position:absolute;left:102.18px;top:546.35px" class="cls_060"><span class="cls_060">@RestResource(rel="tacos", path="tacos")</span></div>
<div style="position:absolute;left:102.18px;top:556.34px" class="cls_060"><span class="cls_060">public class Taco {</span></div>
<div style="position:absolute;left:102.18px;top:576.35px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:122352px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background186.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">164</span></div>
<div style="position:absolute;left:197.31px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 6</span></div>
<div style="position:absolute;left:241.47px;top:24.35px" class="cls_055"><span class="cls_055">Creating REST services</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">@RestResource</span><span class="cls_039"> annotation lets you give the entity any relation name and path</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">you want. In this case, you’re setting them both to “tacos”. Now when you request the</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">home resource, you see the </span><span class="cls_059">tacos</span><span class="cls_039"> link with correct pluralization:</span></div>
<div style="position:absolute;left:93.18px;top:96.32px" class="cls_060"><span class="cls_060">"tacos" : {</span></div>
<div style="position:absolute;left:102.78px;top:106.34px" class="cls_060"><span class="cls_060">"href" : "</span><a href="http://localhost:8080/api/tacos%7B?page/">http://localhost:8080/api/tacos{?page</a>,size,sort}",</div>
<div style="position:absolute;left:102.78px;top:116.33px" class="cls_060"><span class="cls_060">"templated" : true</span></div>
<div style="position:absolute;left:93.18px;top:126.35px" class="cls_061"><span class="cls_061">},</span></div>
<div style="position:absolute;left:93.18px;top:147.65px" class="cls_039"><span class="cls_039">This also sorts out the path for the endpoint so that you can issue requests against</span></div>
<div style="position:absolute;left:93.18px;top:160.67px" class="cls_039"><span class="cls_039">/api/tacos to work with taco resources.</span></div>
<div style="position:absolute;left:109.39px;top:173.66px" class="cls_039"><span class="cls_039">Speaking of sorting things out, let’s look at how you can sort the results from</span></div>
<div style="position:absolute;left:93.18px;top:186.65px" class="cls_039"><span class="cls_039">Spring Data REST endpoints.</span></div>
<div style="position:absolute;left:57.18px;top:208.49px" class="cls_063"><span class="cls_063">6.3.2</span></div>
<div style="position:absolute;left:93.18px;top:208.49px" class="cls_063"><span class="cls_063">Paging and sorting</span></div>
<div style="position:absolute;left:93.18px;top:225.65px" class="cls_039"><span class="cls_039">You may have noticed that the links in the home resource all offer optional </span><span class="cls_059">page</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:93.18px;top:238.67px" class="cls_059"><span class="cls_059">size</span><span class="cls_039">, and </span><span class="cls_059">sort</span><span class="cls_039"> parameters. By default, requests to a collection resource such as</span></div>
<div style="position:absolute;left:93.18px;top:251.66px" class="cls_039"><span class="cls_039">/api/tacos will return up to 20 items per page from the first page. But you can adjust</span></div>
<div style="position:absolute;left:93.18px;top:264.65px" class="cls_039"><span class="cls_039">the page size and the page displayed by specifying the </span><span class="cls_059">page</span><span class="cls_039"> and </span><span class="cls_059">size</span><span class="cls_039"> parameters in</span></div>
<div style="position:absolute;left:93.18px;top:277.67px" class="cls_039"><span class="cls_039">your request.</span></div>
<div style="position:absolute;left:108.70px;top:290.66px" class="cls_039"><span class="cls_039">For example, to request the first page of tacos where the page size is 5, you can</span></div>
<div style="position:absolute;left:93.18px;top:303.68px" class="cls_039"><span class="cls_039">issue the following </span><span class="cls_059">GET</span><span class="cls_039"> request (using curl):</span></div>
<div style="position:absolute;left:93.18px;top:326.33px" class="cls_061"><span class="cls_061">$ curl "localhost:8080/api/tacos?size=5"</span></div>
<div style="position:absolute;left:93.18px;top:346.67px" class="cls_039"><span class="cls_039">Assuming that there are more than five tacos to be seen, you can request the second</span></div>
<div style="position:absolute;left:93.18px;top:359.66px" class="cls_039"><span class="cls_039">page of tacos by adding the </span><span class="cls_059">page</span><span class="cls_039"> parameter:</span></div>
<div style="position:absolute;left:93.18px;top:382.34px" class="cls_061"><span class="cls_061">$ curl "localhost:8080/api/tacos?size=5&amp;page=1"</span></div>
<div style="position:absolute;left:93.18px;top:402.68px" class="cls_039"><span class="cls_039">Notice that the </span><span class="cls_059">page</span><span class="cls_039"> parameter is zero-based, which means that asking for page 1 is</span></div>
<div style="position:absolute;left:93.18px;top:415.67px" class="cls_039"><span class="cls_039">actually asking for the second page. (You’ll also note that many command-line shells</span></div>
<div style="position:absolute;left:93.18px;top:428.66px" class="cls_039"><span class="cls_039">trip up over the ampersand in the request, which is why I quoted the whole URL in</span></div>
<div style="position:absolute;left:93.18px;top:441.68px" class="cls_039"><span class="cls_039">the preceding curl command.)</span></div>
<div style="position:absolute;left:110.00px;top:454.67px" class="cls_039"><span class="cls_039">You could use string manipulation to add those parameters to the URL, but</span></div>
<div style="position:absolute;left:93.18px;top:467.66px" class="cls_039"><span class="cls_039">HATEOAS comes to the rescue by offering links for the first, last, next, and previous</span></div>
<div style="position:absolute;left:93.18px;top:480.68px" class="cls_039"><span class="cls_039">pages in the response:</span></div>
<div style="position:absolute;left:93.18px;top:500.36px" class="cls_060"><span class="cls_060">"_links" : {</span></div>
<div style="position:absolute;left:102.78px;top:510.35px" class="cls_060"><span class="cls_060">"first" : {</span></div>
<div style="position:absolute;left:112.38px;top:520.34px" class="cls_060"><span class="cls_060">"href" : "</span><a href="http://localhost:8080/api/tacos?page=0&amp;size=5" "="">http://localhost:8080/api/tacos?page=0&amp;size=5"</a> </div>
<div style="position:absolute;left:102.78px;top:530.36px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:102.78px;top:540.35px" class="cls_060"><span class="cls_060">"self" : {</span></div>
<div style="position:absolute;left:112.38px;top:550.34px" class="cls_060"><span class="cls_060">"href" : "</span><a href="http://localhost:8080/api/tacos" "="">http://localhost:8080/api/tacos"</a> </div>
<div style="position:absolute;left:102.78px;top:560.36px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:102.78px;top:570.35px" class="cls_060"><span class="cls_060">"next" : {</span></div>
<div style="position:absolute;left:112.38px;top:580.34px" class="cls_060"><span class="cls_060">"href" : "</span><a href="http://localhost:8080/api/tacos?page=1&amp;size=5" "="">http://localhost:8080/api/tacos?page=1&amp;size=5"</a> </div>
<div style="position:absolute;left:102.78px;top:590.36px" class="cls_060"><span class="cls_060">},</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:123028px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background187.jpg" width="531" height="666"></div>
<div style="position:absolute;left:216.51px;top:24.35px" class="cls_055"><span class="cls_055">Enabling data-backed services</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">165</span></div>
<div style="position:absolute;left:111.78px;top:51.32px" class="cls_060"><span class="cls_060">"last" : {</span></div>
<div style="position:absolute;left:121.38px;top:61.34px" class="cls_060"><span class="cls_060">"href" : "</span><a href="http://localhost:8080/api/tacos?page=2&amp;size=5" "="">http://localhost:8080/api/tacos?page=2&amp;size=5"</a> </div>
<div style="position:absolute;left:111.78px;top:71.33px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:111.78px;top:81.32px" class="cls_060"><span class="cls_060">"profile" : {</span></div>
<div style="position:absolute;left:121.38px;top:91.34px" class="cls_060"><span class="cls_060">"href" : "</span><a href="http://localhost:8080/api/profile/tacos" "="">http://localhost:8080/api/profile/tacos"</a> </div>
<div style="position:absolute;left:111.78px;top:101.33px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:111.78px;top:111.32px" class="cls_060"><span class="cls_060">"recents" : {</span></div>
<div style="position:absolute;left:121.38px;top:121.34px" class="cls_060"><span class="cls_060">"href" : "</span><a href="http://localhost:8080/api/tacos/recent" "="">http://localhost:8080/api/tacos/recent"</a> </div>
<div style="position:absolute;left:111.78px;top:131.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:141.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:165.65px" class="cls_039"><span class="cls_039">With these links, a client of the API need not keep track of what page it’s on and con-</span></div>
<div style="position:absolute;left:102.18px;top:178.67px" class="cls_039"><span class="cls_039">catenate the parameters to the URL. Instead, it must simply know to look for one of</span></div>
<div style="position:absolute;left:102.18px;top:191.66px" class="cls_039"><span class="cls_039">these page navigation links by its name and follow it.</span></div>
<div style="position:absolute;left:117.24px;top:204.65px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">sort</span><span class="cls_039"> parameter lets you sort the resulting list by any property of the entity.</span></div>
<div style="position:absolute;left:102.18px;top:217.67px" class="cls_039"><span class="cls_039">For example, you need a way to fetch the 12 most recently created tacos for the UI</span></div>
<div style="position:absolute;left:102.18px;top:230.66px" class="cls_039"><span class="cls_039">to display. You can do that by specifying the following mix of paging and sorting</span></div>
<div style="position:absolute;left:102.18px;top:243.65px" class="cls_039"><span class="cls_039">parameters:</span></div>
<div style="position:absolute;left:102.18px;top:268.34px" class="cls_061"><span class="cls_061">$ curl "localhost:8080/api/tacos?sort=createdAt,desc&amp;page=0&amp;size=12"</span></div>
<div style="position:absolute;left:102.18px;top:292.67px" class="cls_039"><span class="cls_039">Here the </span><span class="cls_059">sort</span><span class="cls_039"> parameter specifies that you should sort by the </span><span class="cls_059">createdDate</span><span class="cls_039"> prop-</span></div>
<div style="position:absolute;left:102.18px;top:305.66px" class="cls_039"><span class="cls_039">erty and that it should be sorted in descending order (so that the newest tacos are</span></div>
<div style="position:absolute;left:102.18px;top:318.68px" class="cls_039"><span class="cls_039">first). The </span><span class="cls_059">page</span><span class="cls_039"> and </span><span class="cls_059">size</span><span class="cls_039"> parameters specify that you should see the first page of</span></div>
<div style="position:absolute;left:102.18px;top:331.67px" class="cls_039"><span class="cls_039">12 tacos.</span></div>
<div style="position:absolute;left:118.15px;top:344.66px" class="cls_039"><span class="cls_039">This is precisely what the UI needs in order to show the most recently created</span></div>
<div style="position:absolute;left:102.18px;top:357.68px" class="cls_039"><span class="cls_039">tacos. It’s approximately the same as the /design/recent endpoint you defined in</span></div>
<div style="position:absolute;left:102.18px;top:370.67px" class="cls_059"><span class="cls_059">DesignTacoController</span><span class="cls_039"> earlier in this chapter.</span></div>
<div style="position:absolute;left:118.68px;top:383.66px" class="cls_039"><span class="cls_039">There’s a small problem, though. The UI code will need to be hardcoded to</span></div>
<div style="position:absolute;left:102.18px;top:396.68px" class="cls_039"><span class="cls_039">request the list of tacos with those parameters. Sure, it will work. But you’re adding</span></div>
<div style="position:absolute;left:102.18px;top:409.67px" class="cls_039"><span class="cls_039">some brittleness to the client by making it too knowledgeable regarding how to con-</span></div>
<div style="position:absolute;left:102.18px;top:422.66px" class="cls_039"><span class="cls_039">struct an API request. It would be great if the client could look up the URL from a list</span></div>
<div style="position:absolute;left:102.18px;top:435.68px" class="cls_039"><span class="cls_039">of links. And it would be even more awesome if the URL were more succinct, like the</span></div>
<div style="position:absolute;left:102.18px;top:448.67px" class="cls_039"><span class="cls_039">/design/recent endpoint you had before.</span></div>
<div style="position:absolute;left:66.18px;top:474.50px" class="cls_063"><span class="cls_063">6.3.3</span></div>
<div style="position:absolute;left:102.18px;top:474.50px" class="cls_063"><span class="cls_063">Adding custom endpoints</span></div>
<div style="position:absolute;left:102.18px;top:492.17px" class="cls_039"><span class="cls_039">Spring Data REST is great at creating endpoints for performing CRUD operations</span></div>
<div style="position:absolute;left:102.18px;top:505.16px" class="cls_039"><span class="cls_039">against Spring Data repositories. But sometimes you need to break away from the</span></div>
<div style="position:absolute;left:102.18px;top:518.18px" class="cls_039"><span class="cls_039">default CRUD API and create an endpoint that gets to the core of the problem.</span></div>
<div style="position:absolute;left:118.31px;top:531.17px" class="cls_039"><span class="cls_039">There’s absolutely nothing stopping you from implementing any endpoint you</span></div>
<div style="position:absolute;left:102.18px;top:544.16px" class="cls_039"><span class="cls_039">want in a </span><span class="cls_059">@RestController</span><span class="cls_039">-annotated bean to supplement what Spring Data REST</span></div>
<div style="position:absolute;left:102.18px;top:557.18px" class="cls_039"><span class="cls_039">automatically generates. In fact, you could resurrect the </span><span class="cls_059">DesignTacoController</span><span class="cls_039"> from</span></div>
<div style="position:absolute;left:102.18px;top:570.17px" class="cls_039"><span class="cls_039">earlier in the chapter, and it would still work alongside the endpoints provided by</span></div>
<div style="position:absolute;left:102.18px;top:583.19px" class="cls_039"><span class="cls_039">Spring Data REST.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:123704px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background188.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">166</span></div>
<div style="position:absolute;left:197.31px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 6</span></div>
<div style="position:absolute;left:241.47px;top:24.35px" class="cls_055"><span class="cls_055">Creating REST services</span></div>
<div style="position:absolute;left:109.41px;top:50.66px" class="cls_039"><span class="cls_039">But when you write your own API controllers, their endpoints seem somewhat</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">detached from the Spring Data REST endpoints in a couple of ways:</span></div>
<div style="position:absolute;left:108.78px;top:80.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Your own controller endpoints aren’t mapped under Spring Data REST’s base</span></div>
<div style="position:absolute;left:120.78px;top:93.65px" class="cls_039"><span class="cls_039">path. You could force their mappings to be prefixed with whatever base path</span></div>
<div style="position:absolute;left:120.78px;top:106.67px" class="cls_039"><span class="cls_039">you want, including the Spring Data REST base path, but if the base path were</span></div>
<div style="position:absolute;left:120.78px;top:119.66px" class="cls_039"><span class="cls_039">to change, you’d need to edit the controller’s mappings to match.</span></div>
<div style="position:absolute;left:108.78px;top:133.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Any endpoints you define in your own controllers won’t be automatically</span></div>
<div style="position:absolute;left:120.78px;top:146.66px" class="cls_039"><span class="cls_039">included as hyperlinks in the resources returned by Spring Data REST end-</span></div>
<div style="position:absolute;left:120.78px;top:159.65px" class="cls_039"><span class="cls_039">points. This means that clients won’t be able to discover your custom endpoints</span></div>
<div style="position:absolute;left:120.78px;top:172.67px" class="cls_039"><span class="cls_039">with a relation name.</span></div>
<div style="position:absolute;left:93.18px;top:190.67px" class="cls_039"><span class="cls_039">Let’s address the concern about the base path first. Spring Data REST includes</span></div>
<div style="position:absolute;left:93.18px;top:203.66px" class="cls_059"><span class="cls_059">@RepositoryRestController</span><span class="cls_039">, a new annotation for annotating controller classes whose</span></div>
<div style="position:absolute;left:93.18px;top:216.65px" class="cls_039"><span class="cls_039">mappings should assume a base path that’s the same as the one configured for Spring</span></div>
<div style="position:absolute;left:93.18px;top:229.67px" class="cls_039"><span class="cls_039">Data REST endpoints. Put simply, all mappings in a </span><span class="cls_059">@RepositoryRestController</span><span class="cls_039">-</span></div>
<div style="position:absolute;left:93.18px;top:242.66px" class="cls_039"><span class="cls_039">annotated controller will have their path prefixed with the value of the </span><span class="cls_059">spring.data</span></div>
<div style="position:absolute;left:93.18px;top:255.65px" class="cls_059"><span class="cls_059">.rest.base-path</span><span class="cls_039"> property (which you’ve configured as /api).</span></div>
<div style="position:absolute;left:110.29px;top:268.67px" class="cls_039"><span class="cls_039">Rather than resurrect the </span><span class="cls_059">DesignTacoController</span><span class="cls_039">, which had several handler</span></div>
<div style="position:absolute;left:93.18px;top:281.66px" class="cls_039"><span class="cls_039">methods you won’t need, you’ll create a new controller that only contains the </span><span class="cls_059">recent-</span></div>
<div style="position:absolute;left:93.18px;top:294.68px" class="cls_059"><span class="cls_059">Tacos()</span><span class="cls_039"> method. </span><span class="cls_059">RecentTacosController</span><span class="cls_039"> in the next listing  is annotated with</span></div>
<div style="position:absolute;left:93.18px;top:307.67px" class="cls_059"><span class="cls_059">@RepositoryRestController</span><span class="cls_039"> to adopt Spring Data REST’s base path for its request</span></div>
<div style="position:absolute;left:93.18px;top:320.66px" class="cls_039"><span class="cls_039">mappings.</span></div>
<div style="position:absolute;left:105.18px;top:344.39px" class="cls_066"><span class="cls_066">Listing 6.7</span></div>
<div style="position:absolute;left:157.26px;top:344.39px" class="cls_066"><span class="cls_066">Applying Spring Data REST’s base path to a controller</span></div>
<div style="position:absolute;left:93.18px;top:364.25px" class="cls_060"><span class="cls_060">package tacos.web.api;</span></div>
<div style="position:absolute;left:93.18px;top:374.24px" class="cls_060"><span class="cls_060">import static org.springframework.hateoas.mvc.ControllerLinkBuilder.*;</span></div>
<div style="position:absolute;left:93.18px;top:384.26px" class="cls_060"><span class="cls_060">import java.util.List;</span></div>
<div style="position:absolute;left:93.18px;top:394.25px" class="cls_060"><span class="cls_060">import org.springframework.data.domain.PageRequest;</span></div>
<div style="position:absolute;left:93.18px;top:404.24px" class="cls_060"><span class="cls_060">import org.springframework.data.domain.Sort;</span></div>
<div style="position:absolute;left:93.18px;top:414.26px" class="cls_060"><span class="cls_060">import org.springframework.data.rest.webmvc.RepositoryRestController;</span></div>
<div style="position:absolute;left:93.18px;top:424.25px" class="cls_060"><span class="cls_060">import org.springframework.hateoas.Resources;</span></div>
<div style="position:absolute;left:93.18px;top:434.24px" class="cls_060"><span class="cls_060">import org.springframework.http.HttpStatus;</span></div>
<div style="position:absolute;left:93.18px;top:444.26px" class="cls_060"><span class="cls_060">import org.springframework.http.ResponseEntity;</span></div>
<div style="position:absolute;left:93.18px;top:454.25px" class="cls_060"><span class="cls_060">import org.springframework.web.bind.annotation.GetMapping;</span></div>
<div style="position:absolute;left:93.18px;top:464.24px" class="cls_060"><span class="cls_060">import tacos.Taco;</span></div>
<div style="position:absolute;left:93.18px;top:474.26px" class="cls_060"><span class="cls_060">import tacos.data.TacoRepository;</span></div>
<div style="position:absolute;left:93.18px;top:494.24px" class="cls_060"><span class="cls_060">@RepositoryRestController</span></div>
<div style="position:absolute;left:93.18px;top:504.26px" class="cls_060"><span class="cls_060">public class RecentTacosController {</span></div>
<div style="position:absolute;left:102.78px;top:524.24px" class="cls_060"><span class="cls_060">private TacoRepository tacoRepo;</span></div>
<div style="position:absolute;left:102.78px;top:544.25px" class="cls_060"><span class="cls_060">public RecentTacosController(TacoRepository tacoRepo) {</span></div>
<div style="position:absolute;left:112.38px;top:554.24px" class="cls_060"><span class="cls_060">this.tacoRepo = tacoRepo;</span></div>
<div style="position:absolute;left:102.78px;top:564.26px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.78px;top:584.24px" class="cls_060"><span class="cls_060">@GetMapping(path="/tacos/recent", produces="application/hal+json")</span></div>
<div style="position:absolute;left:102.78px;top:594.26px" class="cls_060"><span class="cls_060">public ResponseEntity&lt;Resources&lt;TacoResource&gt;&gt; recentTacos() {</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:124380px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background189.jpg" width="531" height="666"></div>
<div style="position:absolute;left:216.51px;top:24.35px" class="cls_055"><span class="cls_055">Enabling data-backed services</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">167</span></div>
<div style="position:absolute;left:121.38px;top:51.32px" class="cls_060"><span class="cls_060">PageRequest page = PageRequest.of(</span></div>
<div style="position:absolute;left:226.93px;top:61.34px" class="cls_060"><span class="cls_060">0, 12, Sort.by("createdAt").descending());</span></div>
<div style="position:absolute;left:121.38px;top:71.33px" class="cls_060"><span class="cls_060">List&lt;Taco&gt; tacos = tacoRepo.findAll(page).getContent();</span></div>
<div style="position:absolute;left:121.38px;top:91.34px" class="cls_060"><span class="cls_060">List&lt;TacoResource&gt; tacoResources =</span></div>
<div style="position:absolute;left:140.55px;top:101.33px" class="cls_060"><span class="cls_060">new TacoResourceAssembler().toResources(tacos);</span></div>
<div style="position:absolute;left:121.38px;top:111.32px" class="cls_060"><span class="cls_060">Resources&lt;TacoResource&gt; recentResources =</span></div>
<div style="position:absolute;left:159.76px;top:121.34px" class="cls_060"><span class="cls_060">new Resources&lt;TacoResource&gt;(tacoResources);</span></div>
<div style="position:absolute;left:121.38px;top:131.33px" class="cls_060"><span class="cls_060">recentResources.add(</span></div>
<div style="position:absolute;left:140.55px;top:141.35px" class="cls_060"><span class="cls_060">linkTo(methodOn(RecentTacosController.class).recentTacos())</span></div>
<div style="position:absolute;left:159.75px;top:151.34px" class="cls_060"><span class="cls_060">.withRel("recents"));</span></div>
<div style="position:absolute;left:121.38px;top:161.33px" class="cls_060"><span class="cls_060">return new ResponseEntity&lt;&gt;(recentResources, HttpStatus.OK);</span></div>
<div style="position:absolute;left:111.78px;top:171.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:191.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:215.66px" class="cls_039"><span class="cls_039">Even though </span><span class="cls_059">@GetMapping</span><span class="cls_039"> is mapped to the path /tacos/recent, the </span><span class="cls_059">@Repository-</span></div>
<div style="position:absolute;left:102.18px;top:228.65px" class="cls_059"><span class="cls_059">RestController</span><span class="cls_039"> annotation at the class level will ensure that it will be prefixed with</span></div>
<div style="position:absolute;left:102.18px;top:241.67px" class="cls_039"><span class="cls_039">Spring Data REST’s base path. As you’ve configured it, the </span><span class="cls_059">recentTacos()</span><span class="cls_039"> method</span></div>
<div style="position:absolute;left:102.18px;top:254.66px" class="cls_039"><span class="cls_039">will handle </span><span class="cls_059">GET</span><span class="cls_039"> requests for /api/tacos/recent.</span></div>
<div style="position:absolute;left:118.21px;top:267.65px" class="cls_039"><span class="cls_039">One important thing to notice is that although </span><span class="cls_059">@RepositoryRestController</span><span class="cls_039"> is</span></div>
<div style="position:absolute;left:102.18px;top:280.67px" class="cls_039"><span class="cls_039">named similarly to </span><span class="cls_059">@RestController</span><span class="cls_039">, it doesn’t carry the same semantics as </span><span class="cls_059">@Rest-</span></div>
<div style="position:absolute;left:102.18px;top:293.66px" class="cls_059"><span class="cls_059">Controller</span><span class="cls_039">. Specifically, it doesn’t ensure that values returned from handler methods</span></div>
<div style="position:absolute;left:102.18px;top:306.68px" class="cls_039"><span class="cls_039">are automatically written to the body of the response. Therefore you need to either</span></div>
<div style="position:absolute;left:102.18px;top:319.67px" class="cls_039"><span class="cls_039">annotate the method with </span><span class="cls_059">@ResponseBody</span><span class="cls_039"> or return a </span><span class="cls_059">ResponseEntity</span><span class="cls_039"> that wraps the</span></div>
<div style="position:absolute;left:102.18px;top:332.66px" class="cls_039"><span class="cls_039">response data. Here you chose to return a </span><span class="cls_059">ResponseEntity</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.60px;top:345.68px" class="cls_039"><span class="cls_039">With </span><span class="cls_059">RecentTacosController</span><span class="cls_039"> in play, requests for /api/tacos/recent will return</span></div>
<div style="position:absolute;left:102.18px;top:358.67px" class="cls_039"><span class="cls_039">up to 15 of the most recently created tacos, without the need for paging and sorting</span></div>
<div style="position:absolute;left:102.18px;top:371.66px" class="cls_039"><span class="cls_039">parameters in the URL. But it still doesn’t appear in the hyperlinks list when request-</span></div>
<div style="position:absolute;left:102.18px;top:384.68px" class="cls_039"><span class="cls_039">ing /api/tacos. Let’s fix that.</span></div>
<div style="position:absolute;left:66.18px;top:410.48px" class="cls_063"><span class="cls_063">6.3.4</span></div>
<div style="position:absolute;left:102.18px;top:410.48px" class="cls_063"><span class="cls_063">Adding custom hyperlinks to Spring Data endpoints</span></div>
<div style="position:absolute;left:102.18px;top:428.18px" class="cls_039"><span class="cls_039">If the recent tacos endpoint isn’t among the hyperlinks returned from /api/tacos,</span></div>
<div style="position:absolute;left:102.18px;top:441.17px" class="cls_039"><span class="cls_039">how will a client know how to fetch the most recent tacos? It’ll either have to guess or</span></div>
<div style="position:absolute;left:102.18px;top:454.16px" class="cls_039"><span class="cls_039">use the paging and sorting parameters. Either way, it’ll be hardcoded in the client</span></div>
<div style="position:absolute;left:102.18px;top:467.18px" class="cls_039"><span class="cls_039">code, which isn’t ideal.</span></div>
<div style="position:absolute;left:117.49px;top:480.17px" class="cls_039"><span class="cls_039">By declaring a resource processor bean, however, you can add links to the list of</span></div>
<div style="position:absolute;left:102.18px;top:493.16px" class="cls_039"><span class="cls_039">links that Spring Data REST automatically includes. Spring Data HATEOAS offers</span></div>
<div style="position:absolute;left:102.18px;top:506.18px" class="cls_059"><span class="cls_059">ResourceProcessor</span><span class="cls_039">, an interface for manipulating resources before they’re returned</span></div>
<div style="position:absolute;left:102.18px;top:519.17px" class="cls_039"><span class="cls_039">through the API. For your purposes, you need an implementation of </span><span class="cls_059">Resource-</span></div>
<div style="position:absolute;left:102.27px;top:532.16px" class="cls_059"><span class="cls_059">Processor</span><span class="cls_039"> that adds a </span><span class="cls_059">recents</span><span class="cls_039"> link to any resource of type </span><span class="cls_059">PagedResources&lt;Resource</span></div>
<div style="position:absolute;left:102.18px;top:545.18px" class="cls_059"><span class="cls_059">&lt;Taco&gt;&gt;</span><span class="cls_039"> (the type returned for the /api/tacos endpoint). The next listing shows a</span></div>
<div style="position:absolute;left:102.18px;top:558.17px" class="cls_039"><span class="cls_039">bean declaration method that defines such a </span><span class="cls_059">ResourceProcessor</span><span class="cls_039">.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:125056px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background190.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">168</span></div>
<div style="position:absolute;left:197.31px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 6</span></div>
<div style="position:absolute;left:241.47px;top:24.35px" class="cls_055"><span class="cls_055">Creating REST services</span></div>
<div style="position:absolute;left:105.18px;top:54.38px" class="cls_066"><span class="cls_066">Listing 6.8</span></div>
<div style="position:absolute;left:157.26px;top:54.38px" class="cls_066"><span class="cls_066">Adding custom links to a Spring Data REST endpoint</span></div>
<div style="position:absolute;left:93.18px;top:73.22px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:93.18px;top:83.24px" class="cls_060"><span class="cls_060">public ResourceProcessor&lt;PagedResources&lt;Resource&lt;Taco&gt;&gt;&gt;</span></div>
<div style="position:absolute;left:102.78px;top:93.23px" class="cls_060"><span class="cls_060">tacoProcessor(EntityLinks links) {</span></div>
<div style="position:absolute;left:102.78px;top:113.24px" class="cls_060"><span class="cls_060">return new ResourceProcessor&lt;PagedResources&lt;Resource&lt;Taco&gt;&gt;&gt;() {</span></div>
<div style="position:absolute;left:112.38px;top:123.23px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:112.36px;top:133.25px" class="cls_060"><span class="cls_060">public PagedResources&lt;Resource&lt;Taco&gt;&gt; process(</span></div>
<div style="position:absolute;left:208.34px;top:143.24px" class="cls_060"><span class="cls_060">PagedResources&lt;Resource&lt;Taco&gt;&gt; resource) {</span></div>
<div style="position:absolute;left:121.95px;top:153.23px" class="cls_060"><span class="cls_060">resource.add(</span></div>
<div style="position:absolute;left:141.15px;top:163.25px" class="cls_060"><span class="cls_060">links.linkFor(Taco.class)</span></div>
<div style="position:absolute;left:165.15px;top:173.24px" class="cls_060"><span class="cls_060">.slash("recent")</span></div>
<div style="position:absolute;left:165.15px;top:183.23px" class="cls_060"><span class="cls_060">.withRel("recents"));</span></div>
<div style="position:absolute;left:121.95px;top:193.25px" class="cls_060"><span class="cls_060">return resource;</span></div>
<div style="position:absolute;left:112.38px;top:203.24px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.78px;top:213.23px" class="cls_060"><span class="cls_060">};</span></div>
<div style="position:absolute;left:93.18px;top:223.25px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:244.55px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">ResourceProcessor</span><span class="cls_039"> shown in listing 6.8 is defined as an anonymous inner class</span></div>
<div style="position:absolute;left:93.18px;top:257.57px" class="cls_039"><span class="cls_039">and declared as a bean to be created in the Spring application context. Spring</span></div>
<div style="position:absolute;left:93.18px;top:270.56px" class="cls_039"><span class="cls_039">HATEOAS will discover this bean (as well as any other beans of type </span><span class="cls_059">Resource-</span></div>
<div style="position:absolute;left:93.27px;top:283.55px" class="cls_059"><span class="cls_059">Processor</span><span class="cls_039">) automatically and will apply them to the appropriate resources. In this case,</span></div>
<div style="position:absolute;left:93.18px;top:296.57px" class="cls_039"><span class="cls_039">if a </span><span class="cls_059">PagedResources&lt;Resource&lt;Taco&gt;&gt;</span><span class="cls_039"> is returned from a controller, it will receive a</span></div>
<div style="position:absolute;left:93.18px;top:309.56px" class="cls_039"><span class="cls_039">link for the most recently created tacos. This includes the response for requests for</span></div>
<div style="position:absolute;left:93.18px;top:322.58px" class="cls_039"><span class="cls_039">/api/tacos.</span></div>
<div style="position:absolute;left:93.18px;top:343.72px" class="cls_040"><span class="cls_040">Summary</span></div>
<div style="position:absolute;left:108.78px;top:362.06px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  REST endpoints can be created with Spring MVC, with controllers that follow</span></div>
<div style="position:absolute;left:120.78px;top:375.08px" class="cls_039"><span class="cls_039">the same programming model as browser-targeted controllers.</span></div>
<div style="position:absolute;left:108.78px;top:389.06px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Controller handler methods can either be annotated with </span><span class="cls_059">@ResponseBody</span><span class="cls_039"> or</span></div>
<div style="position:absolute;left:120.78px;top:402.08px" class="cls_039"><span class="cls_039">return </span><span class="cls_059">ResponseEntity</span><span class="cls_039"> objects to bypass the model and view and write data</span></div>
<div style="position:absolute;left:120.78px;top:415.07px" class="cls_039"><span class="cls_039">directly to the response body.</span></div>
<div style="position:absolute;left:108.78px;top:429.08px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  The </span><span class="cls_059">@RestController</span><span class="cls_039"> annotation simplifies REST controllers, eliminating the</span></div>
<div style="position:absolute;left:120.78px;top:442.07px" class="cls_039"><span class="cls_039">need to use </span><span class="cls_059">@ResponseBody</span><span class="cls_039"> on handler methods.</span></div>
<div style="position:absolute;left:108.78px;top:456.08px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Spring HATEOAS enables hyperlinking of resources returned from Spring MVC</span></div>
<div style="position:absolute;left:120.78px;top:469.07px" class="cls_039"><span class="cls_039">controllers.</span></div>
<div style="position:absolute;left:108.78px;top:483.08px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Spring Data repositories can automatically be exposed as REST APIs using Spring</span></div>
<div style="position:absolute;left:120.78px;top:496.07px" class="cls_039"><span class="cls_039">Data REST.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:125732px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background191.jpg" width="531" height="666"></div>
<div style="position:absolute;left:176.28px;top:111.83px" class="cls_014"><span class="cls_014">Consuming REST services</span></div>
<div style="position:absolute;left:96.18px;top:264.85px" class="cls_049"><span class="cls_049">This chapter covers</span></div>
<div style="position:absolute;left:96.18px;top:283.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Using </span><span class="cls_078">RestTemplate</span><span class="cls_051"> to consume REST APIs</span></div>
<div style="position:absolute;left:96.18px;top:298.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Navigating hypermedia APIs with Traverson</span></div>
<div style="position:absolute;left:114.18px;top:366.53px" class="cls_039"><span class="cls_039">Have you ever gone to a movie and, as the movie starts, discovered that you were the</span></div>
<div style="position:absolute;left:114.18px;top:379.55px" class="cls_039"><span class="cls_039">only person in the theater? It certainly is a wonderful experience to have what is</span></div>
<div style="position:absolute;left:114.18px;top:392.54px" class="cls_039"><span class="cls_039">essentially a private viewing of a movie. You can pick whatever seat you want, talk back</span></div>
<div style="position:absolute;left:114.18px;top:405.53px" class="cls_039"><span class="cls_039">to the characters onscreen, and maybe even open your phone and tweet about it</span></div>
<div style="position:absolute;left:114.18px;top:418.55px" class="cls_039"><span class="cls_039">without anyone getting angry for disrupting their movie-watching experience. And</span></div>
<div style="position:absolute;left:114.18px;top:431.54px" class="cls_039"><span class="cls_039">the best part is that nobody else is there ruining the movie for you, either!</span></div>
<div style="position:absolute;left:130.54px;top:444.53px" class="cls_039"><span class="cls_039">This hasn’t happened to me often. But when it has, I have wondered what</span></div>
<div style="position:absolute;left:114.18px;top:457.55px" class="cls_039"><span class="cls_039">would have happened if I hadn’t shown up. Would they still have shown the film?</span></div>
<div style="position:absolute;left:114.18px;top:470.54px" class="cls_039"><span class="cls_039">Would the hero still have saved the day? Would the theater staff still have cleaned</span></div>
<div style="position:absolute;left:114.18px;top:483.56px" class="cls_039"><span class="cls_039">the theater after the movie was over?</span></div>
<div style="position:absolute;left:128.73px;top:496.55px" class="cls_039"><span class="cls_039">A movie without an audience is kind of like an API without a client. It’s ready to</span></div>
<div style="position:absolute;left:114.18px;top:509.54px" class="cls_039"><span class="cls_039">accept and provide data, but if the API is never invoked, is it really an API? Like</span></div>
<div style="position:absolute;left:114.18px;top:522.56px" class="cls_039"><span class="cls_039">Schrödinger’s cat, we can’t know if the API is active or returning HTTP 404 responses</span></div>
<div style="position:absolute;left:114.18px;top:535.55px" class="cls_039"><span class="cls_039">until we issue a request to it.</span></div>
<div style="position:absolute;left:129.77px;top:548.54px" class="cls_039"><span class="cls_039">In the previous chapter, we focused on defining REST endpoints that can be</span></div>
<div style="position:absolute;left:114.18px;top:561.56px" class="cls_039"><span class="cls_039">consumed by some client external to your application. Although the driving force</span></div>
<div style="position:absolute;left:269.16px;top:596.99px" class="cls_048"><span class="cls_048">169</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:126408px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background192.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">170</span></div>
<div style="position:absolute;left:192.90px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 7</span></div>
<div style="position:absolute;left:237.06px;top:24.35px" class="cls_055"><span class="cls_055">Consuming REST services</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">for developing such an API was a single-page Angular application that served as the</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">Taco Cloud website, the reality is that the client could be any application, in any lan-</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">guage—even another Java application.</span></div>
<div style="position:absolute;left:109.59px;top:89.66px" class="cls_039"><span class="cls_039">It’s not uncommon for Spring applications to both provide an API and make</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">requests to another application’s API. In fact, this is becoming prevalent in the world</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">of microservices. Therefore, it’s worthwhile to spend a moment looking at how to use</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">Spring to interact with REST APIs.</span></div>
<div style="position:absolute;left:107.78px;top:141.65px" class="cls_039"><span class="cls_039">A Spring application can consume a REST API with</span></div>
<div style="position:absolute;left:108.78px;top:158.66px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> RestTemplate</span><span class="cls_039">—A straightforward, synchronous REST client provided by the</span></div>
<div style="position:absolute;left:120.78px;top:171.65px" class="cls_039"><span class="cls_039">core Spring Framework.</span></div>
<div style="position:absolute;left:108.78px;top:185.66px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Traverson</span><span class="cls_039">—A hyperlink-aware, synchronous REST client provided by Spring</span></div>
<div style="position:absolute;left:120.78px;top:198.65px" class="cls_039"><span class="cls_039">HATEOAS. Inspired from a JavaScript library of the same name.</span></div>
<div style="position:absolute;left:108.78px;top:212.66px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> WebClient</span><span class="cls_039">—A reactive, asynchronous REST client introduced in Spring 5.</span></div>
<div style="position:absolute;left:93.18px;top:230.66px" class="cls_039"><span class="cls_039">I’ll defer discussion of </span><span class="cls_059">WebClient</span><span class="cls_039"> until we cover Spring’s reactive web framework in</span></div>
<div style="position:absolute;left:93.18px;top:243.65px" class="cls_039"><span class="cls_039">chapter 11. For now, we’ll focus on the other two REST clients, starting with </span><span class="cls_059">Rest-</span></div>
<div style="position:absolute;left:93.18px;top:256.67px" class="cls_059"><span class="cls_059">Template</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:57.18px;top:280.84px" class="cls_040"><span class="cls_040">7.1</span></div>
<div style="position:absolute;left:93.18px;top:280.84px" class="cls_040"><span class="cls_040">Consuming REST endpoints with RestTemplate</span></div>
<div style="position:absolute;left:93.18px;top:300.17px" class="cls_039"><span class="cls_039">There’s a lot that goes into interacting with a REST resource from the client’s perspec-</span></div>
<div style="position:absolute;left:93.18px;top:313.16px" class="cls_039"><span class="cls_039">tive—mostly tedium and boilerplate. Working with low-level HTTP libraries, the client</span></div>
<div style="position:absolute;left:93.18px;top:326.18px" class="cls_039"><span class="cls_039">needs to create a client instance and a request object, execute the request, interpret</span></div>
<div style="position:absolute;left:93.18px;top:339.17px" class="cls_039"><span class="cls_039">the response, map the response to domain objects, and handle any exceptions that</span></div>
<div style="position:absolute;left:93.18px;top:352.16px" class="cls_039"><span class="cls_039">may be thrown along the way. And all of this boilerplate is repeated, regardless of what</span></div>
<div style="position:absolute;left:93.18px;top:365.18px" class="cls_039"><span class="cls_039">HTTP request is sent.</span></div>
<div style="position:absolute;left:110.07px;top:378.17px" class="cls_039"><span class="cls_039">To avoid such boilerplate code, Spring provides </span><span class="cls_059">RestTemplate</span><span class="cls_039">. Just as </span><span class="cls_059">JDBC-</span></div>
<div style="position:absolute;left:93.18px;top:391.16px" class="cls_059"><span class="cls_059">Template</span><span class="cls_039"> handles the ugly parts of working with JDBC, </span><span class="cls_059">RestTemplate</span><span class="cls_039"> frees you from</span></div>
<div style="position:absolute;left:93.18px;top:404.18px" class="cls_039"><span class="cls_039">dealing with the tedium of consuming REST resources.</span></div>
<div style="position:absolute;left:108.87px;top:417.17px" class="cls_059"><span class="cls_059">RestTemplate</span><span class="cls_039"> provides 41 methods for interacting with REST resources. Rather</span></div>
<div style="position:absolute;left:93.18px;top:430.16px" class="cls_039"><span class="cls_039">than examine all of the methods that it offers, it’s easier to consider only a dozen</span></div>
<div style="position:absolute;left:93.18px;top:443.18px" class="cls_039"><span class="cls_039">unique operations, each overloaded to equal the complete set of 41 methods. The 12</span></div>
<div style="position:absolute;left:93.18px;top:456.17px" class="cls_039"><span class="cls_039">operations are described in table 7.1.</span></div>
<div style="position:absolute;left:93.18px;top:479.06px" class="cls_053"><span class="cls_053">Table 7.1</span></div>
<div style="position:absolute;left:134.67px;top:478.76px" class="cls_087"><span class="cls_087">RestTemplate</span><span class="cls_053"> defines 12 unique operations, each of which is overloaded, providing a total</span></div>
<div style="position:absolute;left:93.18px;top:489.14px" class="cls_053"><span class="cls_053">of 41 methods.</span></div>
<div style="position:absolute;left:132.54px;top:510.14px" class="cls_073"><span class="cls_073">Method</span></div>
<div style="position:absolute;left:312.21px;top:510.14px" class="cls_073"><span class="cls_073">Description</span></div>
<div style="position:absolute;left:99.18px;top:529.16px" class="cls_060"><span class="cls_060">delete(…)</span></div>
<div style="position:absolute;left:208.29px;top:529.16px" class="cls_074"><span class="cls_074">Performs an HTTP </span><span class="cls_060">DELETE</span><span class="cls_074"> request on a resource at a specified URL</span></div>
<div style="position:absolute;left:99.18px;top:546.14px" class="cls_060"><span class="cls_060">exchange(…)</span></div>
<div style="position:absolute;left:208.29px;top:546.14px" class="cls_074"><span class="cls_074">Executes a specified HTTP method against a URL, returning a</span></div>
<div style="position:absolute;left:208.29px;top:556.16px" class="cls_060"><span class="cls_060">ResponseEntity</span><span class="cls_074"> containing an object mapped from the response body</span></div>
<div style="position:absolute;left:99.18px;top:573.14px" class="cls_060"><span class="cls_060">execute(…)</span></div>
<div style="position:absolute;left:208.29px;top:573.14px" class="cls_074"><span class="cls_074">Executes a specified HTTP method against a URL, returning an object</span></div>
<div style="position:absolute;left:208.29px;top:583.16px" class="cls_074"><span class="cls_074">mapped from the response body</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:127084px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background193.jpg" width="531" height="666"></div>
<div style="position:absolute;left:185.70px;top:24.35px" class="cls_055"><span class="cls_055">Consuming REST endpoints with RestTemplate</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">171</span></div>
<div style="position:absolute;left:102.18px;top:51.53px" class="cls_053"><span class="cls_053">Table 7.1</span></div>
<div style="position:absolute;left:143.67px;top:51.23px" class="cls_087"><span class="cls_087">RestTemplate</span><span class="cls_053"> defines 12 unique operations, each of which is overloaded, providing a total</span></div>
<div style="position:absolute;left:102.18px;top:61.64px" class="cls_053"><span class="cls_053">of 41 methods.</span><span class="cls_084"> (continued)</span></div>
<div style="position:absolute;left:141.54px;top:82.64px" class="cls_073"><span class="cls_073">Method</span></div>
<div style="position:absolute;left:321.21px;top:82.64px" class="cls_073"><span class="cls_073">Description</span></div>
<div style="position:absolute;left:108.18px;top:101.63px" class="cls_060"><span class="cls_060">getForEntity(…)</span></div>
<div style="position:absolute;left:217.29px;top:101.63px" class="cls_074"><span class="cls_074">Sends an HTTP </span><span class="cls_060">GET</span><span class="cls_074"> request, returning a </span><span class="cls_060">ResponseEntity</span><span class="cls_074"> containing</span></div>
<div style="position:absolute;left:217.29px;top:111.62px" class="cls_074"><span class="cls_074">an object mapped from the response body</span></div>
<div style="position:absolute;left:108.18px;top:128.63px" class="cls_060"><span class="cls_060">getForObject(…)</span></div>
<div style="position:absolute;left:217.29px;top:128.63px" class="cls_074"><span class="cls_074">Sends an HTTP </span><span class="cls_060">GET</span><span class="cls_074"> request, returning an object mapped from a</span></div>
<div style="position:absolute;left:217.29px;top:138.65px" class="cls_074"><span class="cls_074">response body</span></div>
<div style="position:absolute;left:108.18px;top:155.63px" class="cls_060"><span class="cls_060">headForHeaders(…)</span></div>
<div style="position:absolute;left:217.29px;top:155.63px" class="cls_074"><span class="cls_074">Sends an HTTP </span><span class="cls_060">HEAD</span><span class="cls_074"> request, returning the HTTP headers for the speci-</span></div>
<div style="position:absolute;left:217.29px;top:165.65px" class="cls_074"><span class="cls_074">fied resource URL</span></div>
<div style="position:absolute;left:108.18px;top:182.63px" class="cls_060"><span class="cls_060">optionsForAllow(…)</span></div>
<div style="position:absolute;left:217.29px;top:182.63px" class="cls_074"><span class="cls_074">Sends an HTTP </span><span class="cls_060">OPTIONS</span><span class="cls_074"> request, returning the Allow header for the</span></div>
<div style="position:absolute;left:217.29px;top:192.65px" class="cls_074"><span class="cls_074">specified URL</span></div>
<div style="position:absolute;left:108.18px;top:209.63px" class="cls_060"><span class="cls_060">patchForObject(…)</span></div>
<div style="position:absolute;left:217.29px;top:209.63px" class="cls_074"><span class="cls_074">Sends an HTTP </span><span class="cls_060">PATCH</span><span class="cls_074"> request, returning the resulting object mapped</span></div>
<div style="position:absolute;left:217.29px;top:219.65px" class="cls_074"><span class="cls_074">from the response body</span></div>
<div style="position:absolute;left:108.18px;top:236.63px" class="cls_060"><span class="cls_060">postForEntity(…)</span></div>
<div style="position:absolute;left:217.27px;top:236.63px" class="cls_060"><span class="cls_060">POSTs</span><span class="cls_074"> data to a URL, returning a </span><span class="cls_060">ResponseEntity</span><span class="cls_074"> containing an</span></div>
<div style="position:absolute;left:217.29px;top:246.65px" class="cls_074"><span class="cls_074">object mapped from the response body</span></div>
<div style="position:absolute;left:108.18px;top:263.63px" class="cls_060"><span class="cls_060">postForLocation(…)</span></div>
<div style="position:absolute;left:217.29px;top:263.63px" class="cls_060"><span class="cls_060">POSTs</span><span class="cls_074"> data to a URL, returning the URL of the newly created resource</span></div>
<div style="position:absolute;left:108.18px;top:280.64px" class="cls_060"><span class="cls_060">postForObject(…)</span></div>
<div style="position:absolute;left:217.29px;top:280.64px" class="cls_060"><span class="cls_060">POSTs</span><span class="cls_074"> data to a URL, returning an object mapped from the response body</span></div>
<div style="position:absolute;left:108.18px;top:297.65px" class="cls_060"><span class="cls_060">put(…)</span></div>
<div style="position:absolute;left:217.28px;top:297.65px" class="cls_060"><span class="cls_060">PUTs</span><span class="cls_074"> resource data to the specified URL</span></div>
<div style="position:absolute;left:102.18px;top:320.96px" class="cls_039"><span class="cls_039">With the exception of </span><span class="cls_059">TRACE</span><span class="cls_039">, </span><span class="cls_059">RestTemplate</span><span class="cls_039"> has at least one method for each of the</span></div>
<div style="position:absolute;left:102.18px;top:333.98px" class="cls_039"><span class="cls_039">standard HTTP methods. In addition, </span><span class="cls_059">execute()</span><span class="cls_039"> and </span><span class="cls_059">exchange()</span><span class="cls_039"> provide lower-level,</span></div>
<div style="position:absolute;left:102.18px;top:346.97px" class="cls_039"><span class="cls_039">general-purpose methods for sending requests with any HTTP method.</span></div>
<div style="position:absolute;left:116.78px;top:359.96px" class="cls_039"><span class="cls_039">Most of the methods in table 7.1 are overloaded into three method forms:</span></div>
<div style="position:absolute;left:117.78px;top:376.97px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  One accepts a </span><span class="cls_059">String</span><span class="cls_039"> URL specification with URL parameters specified in a</span></div>
<div style="position:absolute;left:129.78px;top:389.96px" class="cls_039"><span class="cls_039">variable argument list.</span></div>
<div style="position:absolute;left:117.78px;top:403.97px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  One accepts a </span><span class="cls_059">String</span><span class="cls_039"> URL specification with URL parameters specified in a</span></div>
<div style="position:absolute;left:129.78px;top:417.96px" class="cls_059"><span class="cls_059">Map&lt;String,String&gt;.</span></div>
<div style="position:absolute;left:117.78px;top:430.97px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  One accepts a </span><span class="cls_059">java.net.URI</span><span class="cls_039"> as the URL specification, with no support for</span></div>
<div style="position:absolute;left:129.78px;top:443.96px" class="cls_039"><span class="cls_039">parameterized URLs.</span></div>
<div style="position:absolute;left:102.18px;top:461.96px" class="cls_039"><span class="cls_039">Once you get to know the 12 operations provided by </span><span class="cls_059">RestTemplate</span><span class="cls_039"> and how each of</span></div>
<div style="position:absolute;left:102.18px;top:474.98px" class="cls_039"><span class="cls_039">the variant forms works, you’ll be well on your way to writing resource-consuming</span></div>
<div style="position:absolute;left:102.18px;top:487.97px" class="cls_039"><span class="cls_039">REST clients.</span></div>
<div style="position:absolute;left:116.46px;top:500.96px" class="cls_039"><span class="cls_039">To use </span><span class="cls_059">RestTemplate</span><span class="cls_039">, you’ll either need to create an instance at the point you need it</span></div>
<div style="position:absolute;left:102.18px;top:523.64px" class="cls_061"><span class="cls_061">RestTemplate rest = new RestTemplate();</span></div>
<div style="position:absolute;left:102.18px;top:543.98px" class="cls_039"><span class="cls_039">or you can declare it as a bean and inject it where you need it:</span></div>
<div style="position:absolute;left:102.18px;top:563.66px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:102.18px;top:573.65px" class="cls_060"><span class="cls_060">public RestTemplate restTemplate() {</span></div>
<div style="position:absolute;left:111.78px;top:583.64px" class="cls_060"><span class="cls_060">return new RestTemplate();</span></div>
<div style="position:absolute;left:102.18px;top:593.66px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:127760px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background194.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">172</span></div>
<div style="position:absolute;left:192.90px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 7</span></div>
<div style="position:absolute;left:237.06px;top:24.35px" class="cls_055"><span class="cls_055">Consuming REST services</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">Let’s survey </span><span class="cls_059">RestTemplate</span><span class="cls_039">’s operations by looking at those that support the four pri-</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">mary HTTP methods: </span><span class="cls_059">GET</span><span class="cls_039">, </span><span class="cls_059">PUT</span><span class="cls_039">, </span><span class="cls_059">DELETE</span><span class="cls_039">, and </span><span class="cls_059">POST</span><span class="cls_039">. We’ll start with </span><span class="cls_059">getForObject()</span><span class="cls_039"> and</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_059"><span class="cls_059">getForEntity()</span><span class="cls_039">—the </span><span class="cls_059">GET</span><span class="cls_039"> methods.</span></div>
<div style="position:absolute;left:57.18px;top:101.48px" class="cls_063"><span class="cls_063">7.1.1</span></div>
<div style="position:absolute;left:93.18px;top:101.48px" class="cls_063"><span class="cls_063">GETting resources</span></div>
<div style="position:absolute;left:93.18px;top:118.67px" class="cls_039"><span class="cls_039">Suppose that you want to fetch an ingredient from the Taco Cloud API. Assuming that</span></div>
<div style="position:absolute;left:93.18px;top:131.66px" class="cls_039"><span class="cls_039">the API isn’t HATEOAS-enabled, you can use </span><span class="cls_059">getForObject()</span><span class="cls_039"> to fetch the ingredient.</span></div>
<div style="position:absolute;left:93.18px;top:144.65px" class="cls_039"><span class="cls_039">For example, the following code uses </span><span class="cls_059">RestTemplate</span><span class="cls_039"> to fetch an </span><span class="cls_059">Ingredient</span><span class="cls_039"> object by</span></div>
<div style="position:absolute;left:93.18px;top:157.67px" class="cls_039"><span class="cls_039">its ID:</span></div>
<div style="position:absolute;left:93.18px;top:180.35px" class="cls_060"><span class="cls_060">public Ingredient getIngredientById(String ingredientId) {</span></div>
<div style="position:absolute;left:102.78px;top:190.34px" class="cls_060"><span class="cls_060">return rest.getForObject("</span><a href="http://localhost:8080/ingredients/%7Bid%7D" "="">http://localhost:8080/ingredients/{id}"</a>,</div>
<div style="position:absolute;left:222.73px;top:200.33px" class="cls_060"><span class="cls_060">Ingredient.class, ingredientId);</span></div>
<div style="position:absolute;left:93.18px;top:210.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:233.66px" class="cls_039"><span class="cls_039">Here you’re using the </span><span class="cls_059">getForObject()</span><span class="cls_039"> variant that accepts a </span><span class="cls_059">String</span><span class="cls_039"> URL and uses a</span></div>
<div style="position:absolute;left:93.18px;top:246.65px" class="cls_039"><span class="cls_039">variable list for URL variables. The </span><span class="cls_059">ingredientId</span><span class="cls_039"> parameter passed into </span><span class="cls_059">getFor-</span></div>
<div style="position:absolute;left:93.18px;top:259.67px" class="cls_059"><span class="cls_059">Object()</span><span class="cls_039"> is used to fill in the </span><span class="cls_059">{id}</span><span class="cls_039"> placeholder in the given URL. Although there’s</span></div>
<div style="position:absolute;left:93.18px;top:272.66px" class="cls_039"><span class="cls_039">only one URL variable in this example, it’s important to know that the variable param-</span></div>
<div style="position:absolute;left:93.18px;top:285.65px" class="cls_039"><span class="cls_039">eters are assigned to the placeholders in the order that they’re given.</span></div>
<div style="position:absolute;left:108.05px;top:298.67px" class="cls_039"><span class="cls_039">The second parameter to </span><span class="cls_059">getForObject()</span><span class="cls_039"> is the type that the response should be</span></div>
<div style="position:absolute;left:93.18px;top:311.66px" class="cls_039"><span class="cls_039">bound to. In this case, the response data (that’s likely in JSON format) should be dese-</span></div>
<div style="position:absolute;left:93.18px;top:324.68px" class="cls_039"><span class="cls_039">rialized into an </span><span class="cls_059">Ingredient</span><span class="cls_039"> object that will be returned.</span></div>
<div style="position:absolute;left:107.77px;top:337.67px" class="cls_039"><span class="cls_039">Alternatively, you can use a </span><span class="cls_059">Map</span><span class="cls_039"> to specify the URL variables:</span></div>
<div style="position:absolute;left:93.18px;top:360.35px" class="cls_060"><span class="cls_060">public Ingredient getIngredientById(String ingredientId) {</span></div>
<div style="position:absolute;left:102.78px;top:370.34px" class="cls_060"><span class="cls_060">Map&lt;String,String&gt; urlVariables = new HashMap&lt;&gt;();</span></div>
<div style="position:absolute;left:102.78px;top:380.36px" class="cls_060"><span class="cls_060">urlVariables.put("id", ingredientId);</span></div>
<div style="position:absolute;left:102.78px;top:390.35px" class="cls_060"><span class="cls_060">return rest.getForObject("</span><a href="http://localhost:8080/ingredients/%7Bid%7D" "="">http://localhost:8080/ingredients/{id}"</a>,</div>
<div style="position:absolute;left:222.73px;top:400.34px" class="cls_060"><span class="cls_060">Ingredient.class, urlVariables);</span></div>
<div style="position:absolute;left:93.18px;top:410.36px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:433.67px" class="cls_039"><span class="cls_039">In this case, the value of </span><span class="cls_059">ingredientId</span><span class="cls_039"> is mapped to a key of </span><span class="cls_059">id</span><span class="cls_039">. When the request is</span></div>
<div style="position:absolute;left:93.18px;top:446.66px" class="cls_039"><span class="cls_039">made, the </span><span class="cls_059">{id}</span><span class="cls_039"> placeholder is replaced by the map entry whose key is </span><span class="cls_059">id</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:108.05px;top:459.68px" class="cls_039"><span class="cls_039">Using a </span><span class="cls_059">URI</span><span class="cls_039"> parameter is a bit more involved, requiring that you construct a </span><span class="cls_059">URI</span></div>
<div style="position:absolute;left:93.18px;top:472.67px" class="cls_039"><span class="cls_039">object before calling </span><span class="cls_059">getForObject()</span><span class="cls_039">. Otherwise, it’s similar to both of the other</span></div>
<div style="position:absolute;left:93.18px;top:485.66px" class="cls_039"><span class="cls_039">variants:</span></div>
<div style="position:absolute;left:93.18px;top:508.34px" class="cls_060"><span class="cls_060">public Ingredient getIngredientById(String ingredientId) {</span></div>
<div style="position:absolute;left:102.78px;top:518.36px" class="cls_060"><span class="cls_060">Map&lt;String,String&gt; urlVariables = new HashMap&lt;&gt;();</span></div>
<div style="position:absolute;left:102.78px;top:528.35px" class="cls_060"><span class="cls_060">urlVariables.put("id", ingredientId);</span></div>
<div style="position:absolute;left:102.78px;top:538.34px" class="cls_060"><span class="cls_060">URI url = UriComponentsBuilder</span></div>
<div style="position:absolute;left:150.75px;top:548.36px" class="cls_060"><span class="cls_060">.fromHttpUrl("</span><a href="http://localhost:8080/ingredients/%7Bid%7D" "="">http://localhost:8080/ingredients/{id}"</a>)</div>
<div style="position:absolute;left:150.75px;top:558.35px" class="cls_060"><span class="cls_060">.build(urlVariables);</span></div>
<div style="position:absolute;left:102.78px;top:578.36px" class="cls_060"><span class="cls_060">return rest.getForObject(url, Ingredient.class);</span></div>
<div style="position:absolute;left:93.18px;top:588.35px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:128436px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background195.jpg" width="531" height="666"></div>
<div style="position:absolute;left:185.70px;top:24.35px" class="cls_055"><span class="cls_055">Consuming REST endpoints with RestTemplate</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">173</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">Here the </span><span class="cls_059">URI</span><span class="cls_039"> object is defined from a </span><span class="cls_059">String</span><span class="cls_039"> specification, and its placeholders filled</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">in from entries in a </span><span class="cls_059">Map</span><span class="cls_039">, much like the previous variant of </span><span class="cls_059">getForObject()</span><span class="cls_039">. The </span><span class="cls_059">get-</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_059"><span class="cls_059">ForObject()</span><span class="cls_039"> method is a no-nonsense way of fetching a resource. But if the client</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">needs more than the payload body, you may want to consider using </span><span class="cls_059">getForEntity()</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.39px;top:102.65px" class="cls_059"><span class="cls_059">getForEntity()</span><span class="cls_039"> works in much the same way as </span><span class="cls_059">getForObject(),</span><span class="cls_039"> but instead of</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">returning a domain object that represents the response’s payload, it returns a </span><span class="cls_059">Response-</span></div>
<div style="position:absolute;left:102.33px;top:128.66px" class="cls_059"><span class="cls_059">Entity</span><span class="cls_039"> object that wraps that domain object. The </span><span class="cls_059">ResponseEntity</span><span class="cls_039"> gives access to</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">additional response details, such as the response headers.</span></div>
<div style="position:absolute;left:116.47px;top:154.67px" class="cls_039"><span class="cls_039">For example, suppose that in addition to the ingredient data, you want to inspect the</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">Date header from the response. With </span><span class="cls_059">getForEntity()</span><span class="cls_039"> that becomes straightforward:</span></div>
<div style="position:absolute;left:102.18px;top:191.33px" class="cls_060"><span class="cls_060">public Ingredient getIngredientById(String ingredientId) {</span></div>
<div style="position:absolute;left:111.78px;top:201.35px" class="cls_060"><span class="cls_060">ResponseEntity&lt;Ingredient&gt; responseEntity =</span></div>
<div style="position:absolute;left:130.95px;top:211.34px" class="cls_060"><span class="cls_060">rest.getForEntity("</span><a href="http://localhost:8080/ingredients/%7Bid%7D" "="">http://localhost:8080/ingredients/{id}"</a>,</div>
<div style="position:absolute;left:150.15px;top:221.33px" class="cls_060"><span class="cls_060">Ingredient.class, ingredientId);</span></div>
<div style="position:absolute;left:111.78px;top:244.34px" class="cls_060"><span class="cls_060">log.info("Fetched time: " +</span></div>
<div style="position:absolute;left:150.15px;top:254.33px" class="cls_060"><span class="cls_060">responseEntity.getHeaders().getDate());</span></div>
<div style="position:absolute;left:111.78px;top:277.34px" class="cls_060"><span class="cls_060">return responseEntity.getBody();</span></div>
<div style="position:absolute;left:102.18px;top:287.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:311.66px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">getForEntity()</span><span class="cls_039"> method is overloaded with the same parameters as </span><span class="cls_059">getFor-</span></div>
<div style="position:absolute;left:102.18px;top:324.68px" class="cls_059"><span class="cls_059">Object()</span><span class="cls_039">, so you can provide the URL variables as a variable list parameter or call</span></div>
<div style="position:absolute;left:102.18px;top:337.67px" class="cls_059"><span class="cls_059">getForEntity()</span><span class="cls_039"> with a </span><span class="cls_059">URI</span><span class="cls_039"> object.</span></div>
<div style="position:absolute;left:66.18px;top:362.48px" class="cls_063"><span class="cls_063">7.1.2</span></div>
<div style="position:absolute;left:102.18px;top:362.48px" class="cls_063"><span class="cls_063">PUTting resources</span></div>
<div style="position:absolute;left:102.18px;top:380.18px" class="cls_039"><span class="cls_039">For sending HTTP PUT requests, </span><span class="cls_059">RestTemplate</span><span class="cls_039"> offers the </span><span class="cls_059">put()</span><span class="cls_039"> method. All three</span></div>
<div style="position:absolute;left:102.18px;top:393.17px" class="cls_039"><span class="cls_039">overloaded variants of </span><span class="cls_059">put()</span><span class="cls_039"> accept an </span><span class="cls_059">Object</span><span class="cls_039"> that is to be serialized and sent to the</span></div>
<div style="position:absolute;left:102.18px;top:406.16px" class="cls_039"><span class="cls_039">given URL. As for the URL itself, it can be specified as a </span><span class="cls_059">URI</span><span class="cls_039"> object or as a </span><span class="cls_059">String</span><span class="cls_039">. And</span></div>
<div style="position:absolute;left:102.18px;top:419.18px" class="cls_039"><span class="cls_039">like </span><span class="cls_059">getForObject()</span><span class="cls_039"> and </span><span class="cls_059">getForEntity()</span><span class="cls_039">, the URL variables can be provided as</span></div>
<div style="position:absolute;left:102.18px;top:432.17px" class="cls_039"><span class="cls_039">either a variable argument list or as a </span><span class="cls_059">Map</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:116.87px;top:445.16px" class="cls_039"><span class="cls_039">Suppose that you want to replace an ingredient resource with the data from a new</span></div>
<div style="position:absolute;left:102.18px;top:458.18px" class="cls_059"><span class="cls_059">Ingredient</span><span class="cls_039"> object. The following code should do the trick:</span></div>
<div style="position:absolute;left:102.18px;top:481.85px" class="cls_060"><span class="cls_060">public void updateIngredient(Ingredient ingredient) {</span></div>
<div style="position:absolute;left:111.78px;top:491.84px" class="cls_060"><span class="cls_060">rest.put("</span><a href="http://localhost:8080/ingredients/%7Bid%7D" "="">http://localhost:8080/ingredients/{id}"</a>,</div>
<div style="position:absolute;left:154.95px;top:501.86px" class="cls_060"><span class="cls_060">ingredient,</span></div>
<div style="position:absolute;left:154.95px;top:511.85px" class="cls_060"><span class="cls_060">ingredient.getId());</span></div>
<div style="position:absolute;left:102.18px;top:521.84px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:546.17px" class="cls_039"><span class="cls_039">Here the URL is given as a </span><span class="cls_059">String</span><span class="cls_039"> and has a placeholder that’s substituted by the</span></div>
<div style="position:absolute;left:102.18px;top:559.19px" class="cls_039"><span class="cls_039">given </span><span class="cls_059">Ingredient</span><span class="cls_039"> object’s </span><span class="cls_059">id</span><span class="cls_039"> property. The data to be sent is the </span><span class="cls_059">Ingredient</span><span class="cls_039"> object</span></div>
<div style="position:absolute;left:102.18px;top:572.18px" class="cls_039"><span class="cls_039">itself. The </span><span class="cls_059">put()</span><span class="cls_039"> method returns </span><span class="cls_059">void</span><span class="cls_039">, so there’s nothing you need to do to handle a</span></div>
<div style="position:absolute;left:102.18px;top:585.17px" class="cls_039"><span class="cls_039">return value.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:129112px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background196.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">174</span></div>
<div style="position:absolute;left:192.90px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 7</span></div>
<div style="position:absolute;left:237.06px;top:24.35px" class="cls_055"><span class="cls_055">Consuming REST services</span></div>
<div style="position:absolute;left:57.18px;top:50.48px" class="cls_063"><span class="cls_063">7.1.3</span></div>
<div style="position:absolute;left:93.18px;top:50.48px" class="cls_063"><span class="cls_063">DELETEing resources</span></div>
<div style="position:absolute;left:93.18px;top:67.67px" class="cls_039"><span class="cls_039">Suppose that Taco Cloud no longer offers an ingredient and wants it completely</span></div>
<div style="position:absolute;left:93.18px;top:80.66px" class="cls_039"><span class="cls_039">removed as an option. To make that happen, you can call the </span><span class="cls_059">delete()</span><span class="cls_039"> method from</span></div>
<div style="position:absolute;left:93.18px;top:93.65px" class="cls_059"><span class="cls_059">RestTemplate</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:113.33px" class="cls_060"><span class="cls_060">public void deleteIngredient(Ingredient ingredient) {</span></div>
<div style="position:absolute;left:102.78px;top:123.35px" class="cls_060"><span class="cls_060">rest.delete("</span><a href="http://localhost:8080/ingredients/%7Bid%7D" "="">http://localhost:8080/ingredients/{id}"</a>,</div>
<div style="position:absolute;left:160.35px;top:133.34px" class="cls_060"><span class="cls_060">ingredient.getId());</span></div>
<div style="position:absolute;left:93.18px;top:143.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:166.67px" class="cls_039"><span class="cls_039">In this example, only the URL (specified as a </span><span class="cls_059">String</span><span class="cls_039">) and a URL variable value are</span></div>
<div style="position:absolute;left:93.18px;top:179.66px" class="cls_039"><span class="cls_039">given to </span><span class="cls_059">delete()</span><span class="cls_039">. But as with the other </span><span class="cls_059">RestTemplate</span><span class="cls_039"> methods, the URL could be</span></div>
<div style="position:absolute;left:93.18px;top:192.65px" class="cls_039"><span class="cls_039">specified as a </span><span class="cls_059">URI</span><span class="cls_039"> object or the URL parameters given as a </span><span class="cls_059">Map</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:57.18px;top:217.49px" class="cls_063"><span class="cls_063">7.1.4</span></div>
<div style="position:absolute;left:93.18px;top:217.49px" class="cls_063"><span class="cls_063">POSTing resource data</span></div>
<div style="position:absolute;left:93.18px;top:235.16px" class="cls_039"><span class="cls_039">Now let’s say that you add a new ingredient to the Taco Cloud menu. An HTTP </span><span class="cls_059">POST</span></div>
<div style="position:absolute;left:93.18px;top:248.15px" class="cls_039"><span class="cls_039">request to the …/ingredients endpoint with ingredient data in the request body will</span></div>
<div style="position:absolute;left:93.18px;top:261.17px" class="cls_039"><span class="cls_039">make that happen. </span><span class="cls_059">RestTemplate</span><span class="cls_039"> has three ways of sending a </span><span class="cls_059">POST</span><span class="cls_039"> request, each of</span></div>
<div style="position:absolute;left:93.18px;top:274.16px" class="cls_039"><span class="cls_039">which has the same overloaded variants for specifying the URL. If you wanted to</span></div>
<div style="position:absolute;left:93.18px;top:287.15px" class="cls_039"><span class="cls_039">receive the newly created </span><span class="cls_059">Ingredient</span><span class="cls_039"> resource after the </span><span class="cls_059">POST</span><span class="cls_039"> request, you’d use </span><span class="cls_059">post-</span></div>
<div style="position:absolute;left:93.27px;top:300.17px" class="cls_059"><span class="cls_059">ForObject()</span><span class="cls_039"> like this:</span></div>
<div style="position:absolute;left:93.18px;top:319.85px" class="cls_060"><span class="cls_060">public Ingredient createIngredient(Ingredient ingredient) {</span></div>
<div style="position:absolute;left:102.78px;top:329.84px" class="cls_060"><span class="cls_060">return rest.postForObject("</span><a href="http://localhost:8080/ingredients" "="">http://localhost:8080/ingredients"</a>,</div>
<div style="position:absolute;left:227.53px;top:339.83px" class="cls_060"><span class="cls_060">ingredient,</span></div>
<div style="position:absolute;left:227.53px;top:349.85px" class="cls_060"><span class="cls_060">Ingredient.class);</span></div>
<div style="position:absolute;left:93.18px;top:359.84px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:383.18px" class="cls_039"><span class="cls_039">This variant of the </span><span class="cls_059">postForObject()</span><span class="cls_039"> method takes a </span><span class="cls_059">String</span><span class="cls_039"> URL specification, the</span></div>
<div style="position:absolute;left:93.18px;top:396.17px" class="cls_039"><span class="cls_039">object to be posted to the server, and the domain type that the response body should</span></div>
<div style="position:absolute;left:93.18px;top:409.16px" class="cls_039"><span class="cls_039">be bound to. Although you aren’t taking advantage of it in this case, a fourth parame-</span></div>
<div style="position:absolute;left:93.18px;top:422.18px" class="cls_039"><span class="cls_039">ter could be a </span><span class="cls_059">Map</span><span class="cls_039"> of the URL variable value or a variable list of parameters to substi-</span></div>
<div style="position:absolute;left:93.18px;top:435.17px" class="cls_039"><span class="cls_039">tute into the URL.</span></div>
<div style="position:absolute;left:108.33px;top:448.16px" class="cls_039"><span class="cls_039">If your client has more need for the location of the newly created resource, then</span></div>
<div style="position:absolute;left:93.18px;top:461.18px" class="cls_039"><span class="cls_039">you can call </span><span class="cls_059">postForLocation()</span><span class="cls_039">instead:</span></div>
<div style="position:absolute;left:93.18px;top:480.86px" class="cls_060"><span class="cls_060">public URI createIngredient(Ingredient ingredient) {</span></div>
<div style="position:absolute;left:102.78px;top:490.85px" class="cls_060"><span class="cls_060">return rest.postForLocation("</span><a href="http://localhost:8080/ingredients" "="">http://localhost:8080/ingredients"</a>,</div>
<div style="position:absolute;left:237.10px;top:500.84px" class="cls_060"><span class="cls_060">ingredient);</span></div>
<div style="position:absolute;left:93.18px;top:510.86px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:534.17px" class="cls_039"><span class="cls_039">Notice that </span><span class="cls_059">postForLocation()</span><span class="cls_039"> works much like </span><span class="cls_059">postForObject()</span><span class="cls_039"> with the excep-</span></div>
<div style="position:absolute;left:93.18px;top:547.19px" class="cls_039"><span class="cls_039">tion that it returns a </span><span class="cls_059">URI</span><span class="cls_039"> of the newly created resource instead of the resource object</span></div>
<div style="position:absolute;left:93.18px;top:560.18px" class="cls_039"><span class="cls_039">itself. The </span><span class="cls_059">URI</span><span class="cls_039"> returned is derived from the response’s </span><span class="cls_059">Location</span><span class="cls_039"> header. In the off</span></div>
<div style="position:absolute;left:93.18px;top:573.17px" class="cls_039"><span class="cls_039">chance that you need both the location and response payload, you can call </span><span class="cls_059">post-</span></div>
<div style="position:absolute;left:93.18px;top:586.19px" class="cls_059"><span class="cls_059">ForEntity()</span><span class="cls_039">:</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:129788px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background197.jpg" width="531" height="666"></div>
<div style="position:absolute;left:200.34px;top:24.35px" class="cls_055"><span class="cls_055">Navigating REST APIs with Traverson</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">175</span></div>
<div style="position:absolute;left:102.18px;top:51.32px" class="cls_060"><span class="cls_060">public Ingredient createIngredient(Ingredient ingredient) {</span></div>
<div style="position:absolute;left:111.78px;top:61.34px" class="cls_060"><span class="cls_060">ResponseEntity&lt;Ingredient&gt; responseEntity =</span></div>
<div style="position:absolute;left:145.35px;top:71.33px" class="cls_060"><span class="cls_060">rest.postForEntity("</span><a href="http://localhost:8080/ingredients" "="">http://localhost:8080/ingredients"</a>,</div>
<div style="position:absolute;left:236.53px;top:81.32px" class="cls_060"><span class="cls_060">ingredient,</span></div>
<div style="position:absolute;left:236.53px;top:91.34px" class="cls_060"><span class="cls_060">Ingredient.class);</span></div>
<div style="position:absolute;left:111.78px;top:111.32px" class="cls_060"><span class="cls_060">log.info("New resource created at " +</span></div>
<div style="position:absolute;left:154.95px;top:121.34px" class="cls_060"><span class="cls_060">responseEntity.getHeaders().getLocation());</span></div>
<div style="position:absolute;left:111.78px;top:141.35px" class="cls_060"><span class="cls_060">return responseEntity.getBody();</span></div>
<div style="position:absolute;left:102.18px;top:151.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:174.65px" class="cls_039"><span class="cls_039">Although the methods of </span><span class="cls_059">RestTemplate</span><span class="cls_039"> differ in their purpose, they’re quite similar</span></div>
<div style="position:absolute;left:102.18px;top:187.67px" class="cls_039"><span class="cls_039">in how they’re used. This makes it easy to become proficient with </span><span class="cls_059">RestTemplate</span><span class="cls_039"> and</span></div>
<div style="position:absolute;left:102.18px;top:200.66px" class="cls_039"><span class="cls_039">use it in your client code.</span></div>
<div style="position:absolute;left:116.88px;top:213.65px" class="cls_039"><span class="cls_039">On the other hand, if the API you’re consuming includes hyperlinks in its response,</span></div>
<div style="position:absolute;left:102.18px;top:226.67px" class="cls_059"><span class="cls_059">RestTemplate</span><span class="cls_039"> isn’t as helpful. It’s certainly possible to fetch the more detailed resource</span></div>
<div style="position:absolute;left:102.18px;top:239.66px" class="cls_039"><span class="cls_039">data with </span><span class="cls_059">RestTemplate</span><span class="cls_039"> and work with the content and links contained therein, but</span></div>
<div style="position:absolute;left:102.18px;top:252.65px" class="cls_039"><span class="cls_039">it’s not trivial to do so. Rather than struggle while consuming hypermedia APIs with</span></div>
<div style="position:absolute;left:102.18px;top:265.67px" class="cls_059"><span class="cls_059">RestTemplate</span><span class="cls_039">, let’s turn our attention to a client library that’s made for such things—</span></div>
<div style="position:absolute;left:102.18px;top:278.66px" class="cls_039"><span class="cls_039">Traverson.</span></div>
<div style="position:absolute;left:66.18px;top:302.83px" class="cls_040"><span class="cls_040">7.2</span></div>
<div style="position:absolute;left:102.18px;top:302.83px" class="cls_040"><span class="cls_040">Navigating REST APIs with Traverson</span></div>
<div style="position:absolute;left:102.18px;top:322.16px" class="cls_039"><span class="cls_039">Traverson comes with Spring Data HATEOAS as the out-of-the-box solution for consum-</span></div>
<div style="position:absolute;left:102.18px;top:335.18px" class="cls_039"><span class="cls_039">ing hypermedia APIs in Spring applications. This Java-based library is inspired by a simi-</span></div>
<div style="position:absolute;left:102.18px;top:348.17px" class="cls_039"><span class="cls_039">lar JavaScript library of the same name (</span><a href="https://github.com/traverson/traverson">https://github.com/traverson/traverson</a> <span class="cls_039">).</span></div>
<div style="position:absolute;left:117.39px;top:361.16px" class="cls_039"><span class="cls_039">You might have noticed that Traverson’s name kind of sounds like “traverse on”,</span></div>
<div style="position:absolute;left:102.18px;top:374.18px" class="cls_039"><span class="cls_039">which is a good way to describe how it’s used. In this section, you’ll consume an API by</span></div>
<div style="position:absolute;left:102.18px;top:387.17px" class="cls_039"><span class="cls_039">traversing the API on relation names.</span></div>
<div style="position:absolute;left:117.16px;top:400.16px" class="cls_039"><span class="cls_039">Working with Traverson starts with instantiating a </span><span class="cls_059">Traverson</span><span class="cls_039"> object with an API’s</span></div>
<div style="position:absolute;left:102.18px;top:413.18px" class="cls_039"><span class="cls_039">base URI:</span></div>
<div style="position:absolute;left:102.18px;top:435.86px" class="cls_060"><span class="cls_060">Traverson traverson = new Traverson(</span></div>
<div style="position:absolute;left:121.38px;top:445.85px" class="cls_061"><span class="cls_061">URI.create("</span><a href="http://localhost:8080/api" "="">http://localhost:8080/api"</a>), MediaTypes.HAL_JSON);</div>
<div style="position:absolute;left:102.18px;top:470.18px" class="cls_039"><span class="cls_039">Here I’ve pointed Traverson to the Taco Cloud’s base URL (running locally). This is the</span></div>
<div style="position:absolute;left:102.18px;top:483.17px" class="cls_039"><span class="cls_039">only URL you’ll need to give to Traverson. From here on out, you’ll navigate the API by</span></div>
<div style="position:absolute;left:102.18px;top:496.16px" class="cls_039"><span class="cls_039">link relation names. You’ll also specify that the API will produce JSON responses with</span></div>
<div style="position:absolute;left:102.18px;top:509.18px" class="cls_039"><span class="cls_039">HAL-style hyperlinks so that Traverson knows how to parse the incoming resource</span></div>
<div style="position:absolute;left:102.18px;top:522.17px" class="cls_039"><span class="cls_039">data. Like </span><span class="cls_059">RestTemplate</span><span class="cls_039">, you can choose to instantiate a </span><span class="cls_059">Traverson</span><span class="cls_039"> object prior to its</span></div>
<div style="position:absolute;left:102.18px;top:535.16px" class="cls_039"><span class="cls_039">use or declare it as a bean to be injected wherever it’s needed.</span></div>
<div style="position:absolute;left:117.93px;top:548.18px" class="cls_039"><span class="cls_039">With a </span><span class="cls_059">Traverson</span><span class="cls_039"> object in hand, you can start consuming an API by following</span></div>
<div style="position:absolute;left:102.18px;top:561.17px" class="cls_039"><span class="cls_039">links. For example, suppose that you’re interested in retrieving a list of all ingredients.</span></div>
<div style="position:absolute;left:102.18px;top:574.19px" class="cls_039"><span class="cls_039">You know from section 6.3.1 that the ingredients link has an </span><span class="cls_059">href</span><span class="cls_039"> property that links</span></div>
<div style="position:absolute;left:102.18px;top:587.18px" class="cls_039"><span class="cls_039">to the ingredients resource. You’ll need to follow that link:</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:130464px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background198.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">176</span></div>
<div style="position:absolute;left:192.90px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 7</span></div>
<div style="position:absolute;left:237.06px;top:24.35px" class="cls_055"><span class="cls_055">Consuming REST services</span></div>
<div style="position:absolute;left:93.18px;top:51.32px" class="cls_060"><span class="cls_060">ParameterizedTypeReference&lt;Resources&lt;Ingredient&gt;&gt; ingredientType =</span></div>
<div style="position:absolute;left:112.38px;top:61.34px" class="cls_060"><span class="cls_060">new ParameterizedTypeReference&lt;Resources&lt;Ingredient&gt;&gt;() {};</span></div>
<div style="position:absolute;left:93.18px;top:81.32px" class="cls_060"><span class="cls_060">Resources&lt;Ingredient&gt; ingredientRes =</span></div>
<div style="position:absolute;left:112.38px;top:91.34px" class="cls_060"><span class="cls_060">traverson</span></div>
<div style="position:absolute;left:121.95px;top:101.33px" class="cls_060"><span class="cls_060">.follow("ingredients")</span></div>
<div style="position:absolute;left:121.95px;top:111.32px" class="cls_060"><span class="cls_060">.toObject(ingredientType);</span></div>
<div style="position:absolute;left:93.18px;top:131.33px" class="cls_061"><span class="cls_061">Collection&lt;Ingredient&gt; ingredients = ingredientRes.getContent();</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_039"><span class="cls_039">By calling the </span><span class="cls_059">follow()</span><span class="cls_039"> method on the </span><span class="cls_059">Traverson</span><span class="cls_039"> object, you can navigate to the</span></div>
<div style="position:absolute;left:93.18px;top:167.66px" class="cls_039"><span class="cls_039">resource whose link’s relation name is ingredients. Now that the client has navigated</span></div>
<div style="position:absolute;left:93.18px;top:180.65px" class="cls_039"><span class="cls_039">to ingredients, you need to ingest the contents of that resource by calling </span><span class="cls_059">toObject()</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:108.54px;top:193.67px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">toObject()</span><span class="cls_039"> method requires that you tell it what kind of object to read the</span></div>
<div style="position:absolute;left:93.18px;top:206.66px" class="cls_039"><span class="cls_039">data into. This can get a little tricky, considering that you need to read it in as a</span></div>
<div style="position:absolute;left:93.18px;top:219.65px" class="cls_059"><span class="cls_059">Resources&lt;Ingredient&gt;</span><span class="cls_039"> object, and Java type erasure makes it difficult to provide</span></div>
<div style="position:absolute;left:93.18px;top:232.67px" class="cls_039"><span class="cls_039">type information for a generic type. But creating a </span><span class="cls_059">ParameterizedTypeReference</span></div>
<div style="position:absolute;left:93.18px;top:245.66px" class="cls_039"><span class="cls_039">helps with that.</span></div>
<div style="position:absolute;left:107.55px;top:258.65px" class="cls_039"><span class="cls_039">As an analogy, imagine that instead of a REST API, this were a homepage on a web-</span></div>
<div style="position:absolute;left:93.18px;top:271.67px" class="cls_039"><span class="cls_039">site. And instead of REST client code, imagine that it’s you viewing that homepage in</span></div>
<div style="position:absolute;left:93.18px;top:284.66px" class="cls_039"><span class="cls_039">a browser. You see a link on the page that says Ingredients and you follow that link by</span></div>
<div style="position:absolute;left:93.18px;top:297.68px" class="cls_039"><span class="cls_039">clicking it. Upon arriving at the next page, you read the page, which is analogous to</span></div>
<div style="position:absolute;left:93.18px;top:310.67px" class="cls_039"><span class="cls_039">Traverson ingesting the content as a </span><span class="cls_059">Resources&lt;Ingredient&gt;</span><span class="cls_039"> object.</span></div>
<div style="position:absolute;left:108.49px;top:323.66px" class="cls_039"><span class="cls_039">Now let’s consider a slightly more interesting use case. Let’s say that you want to</span></div>
<div style="position:absolute;left:93.18px;top:336.68px" class="cls_039"><span class="cls_039">fetch the most recently created tacos. Starting at the home resource, you can navigate</span></div>
<div style="position:absolute;left:93.18px;top:349.67px" class="cls_039"><span class="cls_039">to the recent tacos resource like this:</span></div>
<div style="position:absolute;left:93.18px;top:372.35px" class="cls_060"><span class="cls_060">ParameterizedTypeReference&lt;Resources&lt;Taco&gt;&gt; tacoType =</span></div>
<div style="position:absolute;left:112.36px;top:382.34px" class="cls_060"><span class="cls_060">new ParameterizedTypeReference&lt;Resources&lt;Taco&gt;&gt;() {};</span></div>
<div style="position:absolute;left:93.18px;top:402.35px" class="cls_060"><span class="cls_060">Resources&lt;Taco&gt; tacoRes =</span></div>
<div style="position:absolute;left:112.38px;top:412.34px" class="cls_060"><span class="cls_060">traverson</span></div>
<div style="position:absolute;left:121.95px;top:422.36px" class="cls_060"><span class="cls_060">.follow("tacos")</span></div>
<div style="position:absolute;left:121.95px;top:432.35px" class="cls_060"><span class="cls_060">.follow("recents")</span></div>
<div style="position:absolute;left:121.95px;top:442.34px" class="cls_060"><span class="cls_060">.toObject(tacoType);</span></div>
<div style="position:absolute;left:93.18px;top:462.35px" class="cls_061"><span class="cls_061">Collection&lt;Taco&gt; tacos = tacoRes.getContent();</span></div>
<div style="position:absolute;left:93.18px;top:485.66px" class="cls_039"><span class="cls_039">Here you follow the Tacos link and then, from there, follow the Recents link. That</span></div>
<div style="position:absolute;left:93.18px;top:498.68px" class="cls_039"><span class="cls_039">brings you to the resource you’re interested in, so a call to </span><span class="cls_059">toObject()</span><span class="cls_039"> with an appro-</span></div>
<div style="position:absolute;left:93.18px;top:511.67px" class="cls_039"><span class="cls_039">priate </span><span class="cls_059">ParameterizedTypeReference</span><span class="cls_039"> gets you what you want. The </span><span class="cls_059">.follow()</span><span class="cls_039"> method</span></div>
<div style="position:absolute;left:93.18px;top:524.66px" class="cls_039"><span class="cls_039">can be simplified by listing a trail of relation names to follow:</span></div>
<div style="position:absolute;left:93.18px;top:547.34px" class="cls_060"><span class="cls_060">Resources&lt;Taco&gt; tacoRes =</span></div>
<div style="position:absolute;left:112.38px;top:557.36px" class="cls_060"><span class="cls_060">traverson</span></div>
<div style="position:absolute;left:121.95px;top:567.35px" class="cls_060"><span class="cls_060">.follow("tacos", "recents")</span></div>
<div style="position:absolute;left:121.95px;top:577.34px" class="cls_061"><span class="cls_061">.toObject(tacoType);</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:131140px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background199.jpg" width="531" height="666"></div>
<div style="position:absolute;left:253.20px;top:24.35px" class="cls_055"><span class="cls_055">Summary</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">177</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">As you can see, Traverson makes easy work of navigating a HATEOAS-enabled API</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">and consuming its resources. But one thing it doesn’t do is offer any methods for writ-</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">ing to or deleting from those APIs. In contrast, </span><span class="cls_059">RestTemplate</span><span class="cls_039"> can write and delete</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">resources, but doesn’t make it easy to navigate an API.</span></div>
<div style="position:absolute;left:117.99px;top:102.65px" class="cls_039"><span class="cls_039">When you need to both navigate an API and update or delete resources, you’ll</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">need to use </span><span class="cls_059">RestTemplate</span><span class="cls_039"> and Traverson together. Traverson can still be used to navi-</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">gate to the link where a new resource will be created. Then </span><span class="cls_059">RestTemplate</span><span class="cls_039"> can be</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">given that link to do a </span><span class="cls_059">POST</span><span class="cls_039">, </span><span class="cls_059">PUT</span><span class="cls_039">, </span><span class="cls_059">DELETE</span><span class="cls_039">, or any other HTTP request you need.</span></div>
<div style="position:absolute;left:116.59px;top:154.67px" class="cls_039"><span class="cls_039">For example, suppose you want to add a new </span><span class="cls_059">Ingredient</span><span class="cls_039"> to the Taco Cloud menu.</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">The following </span><span class="cls_059">addIngredient()</span><span class="cls_039"> method teams up Traverson and </span><span class="cls_059">RestTemplate</span><span class="cls_039"> to</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">post a new </span><span class="cls_059">Ingredient</span><span class="cls_039"> to the API:</span></div>
<div style="position:absolute;left:102.18px;top:200.33px" class="cls_060"><span class="cls_060">private Ingredient addIngredient(Ingredient ingredient) {</span></div>
<div style="position:absolute;left:111.78px;top:210.35px" class="cls_060"><span class="cls_060">String ingredientsUrl = traverson</span></div>
<div style="position:absolute;left:130.95px;top:220.34px" class="cls_060"><span class="cls_060">.follow("ingredients")</span></div>
<div style="position:absolute;left:130.95px;top:230.33px" class="cls_060"><span class="cls_060">.asLink()</span></div>
<div style="position:absolute;left:130.95px;top:240.35px" class="cls_060"><span class="cls_060">.getHref();</span></div>
<div style="position:absolute;left:111.78px;top:260.33px" class="cls_060"><span class="cls_060">return rest.postForObject(ingredientsUrl,</span></div>
<div style="position:absolute;left:236.53px;top:270.35px" class="cls_060"><span class="cls_060">ingredient,</span></div>
<div style="position:absolute;left:236.53px;top:280.34px" class="cls_060"><span class="cls_060">Ingredient.class);</span></div>
<div style="position:absolute;left:102.18px;top:290.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:311.66px" class="cls_039"><span class="cls_039">After following the Ingredients link, you ask for the link itself by calling </span><span class="cls_059">asLink()</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:102.18px;top:324.68px" class="cls_039"><span class="cls_039">From that link, you ask for the link’s URL by calling </span><span class="cls_059">getHref()</span><span class="cls_039">. With a URL in hand,</span></div>
<div style="position:absolute;left:102.18px;top:337.67px" class="cls_039"><span class="cls_039">you have everything you need to call </span><span class="cls_059">postForObject()</span><span class="cls_039"> on the </span><span class="cls_059">RestTemplate</span><span class="cls_039"> instance</span></div>
<div style="position:absolute;left:102.18px;top:350.66px" class="cls_039"><span class="cls_039">and save the new ingredient.</span></div>
<div style="position:absolute;left:102.18px;top:371.83px" class="cls_040"><span class="cls_040">Summary</span></div>
<div style="position:absolute;left:117.78px;top:390.17px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Clients can use RestTemplate to make HTTP requests against REST APIs.</span></div>
<div style="position:absolute;left:117.78px;top:404.18px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Traverson enables clients to navigate an API using hyperlinks embedded in the</span></div>
<div style="position:absolute;left:129.78px;top:417.17px" class="cls_039"><span class="cls_039">responses.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:131816px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background200.jpg" width="531" height="666"></div>
<div style="position:absolute;left:258.78px;top:111.83px" class="cls_014"><span class="cls_014">Sending messages</span></div>
<div style="position:absolute;left:284.58px;top:143.84px" class="cls_014"><span class="cls_014">asynchronously</span></div>
<div style="position:absolute;left:84.18px;top:264.85px" class="cls_049"><span class="cls_049">This chapter covers</span></div>
<div style="position:absolute;left:84.18px;top:283.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Asynchronous messaging</span></div>
<div style="position:absolute;left:84.18px;top:298.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Sending messages with JMS, RabbitMQ, and</span></div>
<div style="position:absolute;left:96.18px;top:310.55px" class="cls_051"><span class="cls_051">Kafka</span></div>
<div style="position:absolute;left:84.18px;top:325.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Pulling messages from a broker</span></div>
<div style="position:absolute;left:84.18px;top:340.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Listening for messages</span></div>
<div style="position:absolute;left:102.18px;top:410.54px" class="cls_039"><span class="cls_039">It’s 4:55 p.m. on Friday. You’re minutes away from starting a much-anticipated vaca-</span></div>
<div style="position:absolute;left:102.18px;top:423.53px" class="cls_039"><span class="cls_039">tion. You have just enough time to drive to the airport and catch your flight. But</span></div>
<div style="position:absolute;left:102.18px;top:436.55px" class="cls_039"><span class="cls_039">before you pack up and head out, you need to be sure your boss and colleagues</span></div>
<div style="position:absolute;left:102.18px;top:449.54px" class="cls_039"><span class="cls_039">know the status of the work you’ve been doing so that on Monday they can pick up</span></div>
<div style="position:absolute;left:102.18px;top:462.53px" class="cls_039"><span class="cls_039">where you left off. Unfortunately, some of your colleagues have already skipped out</span></div>
<div style="position:absolute;left:102.18px;top:475.55px" class="cls_039"><span class="cls_039">for the weekend, and your boss is tied up in a meeting. What do you do?</span></div>
<div style="position:absolute;left:116.98px;top:488.54px" class="cls_039"><span class="cls_039">The most practical way to communicate your status and still catch your plane is</span></div>
<div style="position:absolute;left:102.18px;top:501.56px" class="cls_039"><span class="cls_039">to send a quick email to your boss and your colleagues, detailing your progress and</span></div>
<div style="position:absolute;left:102.18px;top:514.55px" class="cls_039"><span class="cls_039">promising to send a postcard. You don’t know where they are or when they’ll read</span></div>
<div style="position:absolute;left:102.18px;top:527.54px" class="cls_039"><span class="cls_039">the email, but you do know they’ll eventually return to their desks and read it.</span></div>
<div style="position:absolute;left:102.18px;top:540.56px" class="cls_039"><span class="cls_039">Meanwhile, you’re on your way to the airport.</span></div>
<div style="position:absolute;left:257.16px;top:596.99px" class="cls_024"><span class="cls_024">178</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:132492px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background201.jpg" width="531" height="666"></div>
<div style="position:absolute;left:221.10px;top:24.35px" class="cls_055"><span class="cls_055">Sending messages with JMS</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">179</span></div>
<div style="position:absolute;left:116.70px;top:50.66px" class="cls_036"><span class="cls_036">Synchronous</span><span class="cls_039"> communication, which is what we’ve seen with REST, has its place. But</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">it’s not the only style of inter-application communication available to developers. </span><span class="cls_036">Asyn-</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_036"><span class="cls_036">chronous</span><span class="cls_039"> messaging is a way of indirectly sending messages from one application to</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">another without waiting for a response. This indirection affords looser coupling and</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">greater scalability between the communicating applications.</span></div>
<div style="position:absolute;left:117.27px;top:115.67px" class="cls_039"><span class="cls_039">In this chapter, you’re going to use asynchronous messaging to send orders from</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">the Taco Cloud website to a separate application in the Taco Cloud kitchens where</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">the tacos will be prepared. We’ll consider three options that Spring offers for asyn-</span></div>
<div style="position:absolute;left:102.18px;top:154.67px" class="cls_039"><span class="cls_039">chronous messaging: the Java Message Service (JMS), RabbitMQ and Advanced Mes-</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">sage Queueing Protocol (AMQP), and Apache Kafka. In addition to the basic sending</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">and receiving of messages, we’ll look at Spring’s support for message-driven POJOs: a</span></div>
<div style="position:absolute;left:102.18px;top:193.67px" class="cls_039"><span class="cls_039">way to receive messages that resembles EJB’s message-driven beans (MDBs).</span></div>
<div style="position:absolute;left:66.18px;top:214.84px" class="cls_040"><span class="cls_040">8.1</span></div>
<div style="position:absolute;left:102.18px;top:214.84px" class="cls_040"><span class="cls_040">Sending messages with JMS</span></div>
<div style="position:absolute;left:102.18px;top:232.67px" class="cls_039"><span class="cls_039">JMS is a Java standard that defines a common API for working with message brokers.</span></div>
<div style="position:absolute;left:102.18px;top:245.66px" class="cls_039"><span class="cls_039">First introduced in 2001, JMS has been the go-to approach for asynchronous mes-</span></div>
<div style="position:absolute;left:102.18px;top:258.65px" class="cls_039"><span class="cls_039">saging in Java for a very long time. Before JMS, each message broker had a propri-</span></div>
<div style="position:absolute;left:102.18px;top:271.67px" class="cls_039"><span class="cls_039">etary API, making an application’s messaging code less portable between brokers.</span></div>
<div style="position:absolute;left:102.18px;top:284.66px" class="cls_039"><span class="cls_039">But with JMS, all compliant implementations can be worked with via a common</span></div>
<div style="position:absolute;left:102.18px;top:297.68px" class="cls_039"><span class="cls_039">interface in much the same way that JDBC has given relational database operations</span></div>
<div style="position:absolute;left:102.18px;top:310.67px" class="cls_039"><span class="cls_039">a common interface.</span></div>
<div style="position:absolute;left:116.73px;top:323.66px" class="cls_039"><span class="cls_039">Spring supports JMS through a template-based abstraction known as </span><span class="cls_059">JmsTemplate</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:102.18px;top:336.68px" class="cls_039"><span class="cls_039">Using </span><span class="cls_059">JmsTemplate</span><span class="cls_039">, it’s easy to send messages across queues and topics from the pro-</span></div>
<div style="position:absolute;left:102.18px;top:349.67px" class="cls_039"><span class="cls_039">ducer side and to receive those messages on the consumer side. Spring also supports</span></div>
<div style="position:absolute;left:102.18px;top:362.66px" class="cls_039"><span class="cls_039">the notion of message-driven POJOs: simple Java objects that react to messages arriv-</span></div>
<div style="position:absolute;left:102.18px;top:375.68px" class="cls_039"><span class="cls_039">ing on a queue or topic in an asynchronous fashion.</span></div>
<div style="position:absolute;left:116.44px;top:388.67px" class="cls_039"><span class="cls_039">We’re going to explore Spring’s JMS support, including </span><span class="cls_059">JmsTemplate</span><span class="cls_039"> and message-</span></div>
<div style="position:absolute;left:102.18px;top:401.66px" class="cls_039"><span class="cls_039">driven POJOs. But before you can send and receive messages, you need a message</span></div>
<div style="position:absolute;left:102.18px;top:414.68px" class="cls_039"><span class="cls_039">broker that’s ready to relay those messages between producers and consumers. Let’s</span></div>
<div style="position:absolute;left:102.18px;top:427.67px" class="cls_039"><span class="cls_039">kick off our exploration of Spring JMS by setting up a message broker in Spring.</span></div>
<div style="position:absolute;left:66.18px;top:449.48px" class="cls_063"><span class="cls_063">8.1.1</span></div>
<div style="position:absolute;left:102.18px;top:449.48px" class="cls_063"><span class="cls_063">Setting up JMS</span></div>
<div style="position:absolute;left:102.18px;top:466.67px" class="cls_039"><span class="cls_039">Before you can use JMS, you must add a JMS client to your project’s build. With</span></div>
<div style="position:absolute;left:102.18px;top:479.66px" class="cls_039"><span class="cls_039">Spring Boot, that couldn’t be any easier. All you need to do is add a starter depen-</span></div>
<div style="position:absolute;left:102.18px;top:492.68px" class="cls_039"><span class="cls_039">dency to the build. First, though, you must decide whether you’re going to use</span></div>
<div style="position:absolute;left:102.18px;top:505.67px" class="cls_039"><span class="cls_039">Apache ActiveMQ, or the newer Apache ActiveMQ Artemis broker.</span></div>
<div style="position:absolute;left:117.96px;top:518.66px" class="cls_039"><span class="cls_039">If you’re using ActiveMQ, you’ll need to add the following dependency to your</span></div>
<div style="position:absolute;left:102.18px;top:531.68px" class="cls_039"><span class="cls_039">project’s pom.xml file:</span></div>
<div style="position:absolute;left:102.18px;top:551.36px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:111.78px;top:561.35px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:111.78px;top:571.34px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-boot-starter-activemq&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:102.18px;top:581.36px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:133168px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background202.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">180</span></div>
<div style="position:absolute;left:179.97px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 8</span></div>
<div style="position:absolute;left:224.10px;top:24.35px" class="cls_055"><span class="cls_055">Sending messages asynchronously</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">If ActiveMQ Artemis is the choice, the starter dependency should look like this:</span></div>
<div style="position:absolute;left:93.18px;top:73.34px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:83.33px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:93.32px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-boot-starter-artemis&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:93.18px;top:103.34px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:93.18px;top:127.67px" class="cls_039"><span class="cls_039">Artemis is a next-generation reimplementation of ActiveMQ, effectively making</span></div>
<div style="position:absolute;left:93.18px;top:140.66px" class="cls_039"><span class="cls_039">ActiveMQ a legacy option. Therefore, for Taco Cloud you’re going to choose Artemis.</span></div>
<div style="position:absolute;left:93.18px;top:153.65px" class="cls_039"><span class="cls_039">But the choice ultimately has little impact on how you’ll write the code that sends and</span></div>
<div style="position:absolute;left:93.18px;top:166.67px" class="cls_039"><span class="cls_039">receives messages. The only significant differences will be in how you configure</span></div>
<div style="position:absolute;left:93.18px;top:179.66px" class="cls_039"><span class="cls_039">Spring to create connections to the broker.</span></div>
<div style="position:absolute;left:108.48px;top:192.65px" class="cls_039"><span class="cls_039">By default, Spring assumes that your Artemis broker is listening on </span><span class="cls_059">localhost</span><span class="cls_039"> at</span></div>
<div style="position:absolute;left:93.18px;top:205.67px" class="cls_039"><span class="cls_039">port 61616. That’s fine for development purposes, but once you’re ready to send your</span></div>
<div style="position:absolute;left:93.18px;top:218.66px" class="cls_039"><span class="cls_039">application into production, you’ll need to set a few properties that tell Spring how to</span></div>
<div style="position:absolute;left:93.18px;top:231.65px" class="cls_039"><span class="cls_039">access the broker. The properties you’ll find most useful are listed in table 8.1.</span></div>
<div style="position:absolute;left:93.18px;top:256.34px" class="cls_053"><span class="cls_053">Table 8.1</span></div>
<div style="position:absolute;left:134.91px;top:256.34px" class="cls_053"><span class="cls_053">Properties for configuring the location and credentials of an Artemis broker</span></div>
<div style="position:absolute;left:146.58px;top:277.34px" class="cls_073"><span class="cls_073">Property</span></div>
<div style="position:absolute;left:320.25px;top:277.34px" class="cls_073"><span class="cls_073">Description</span></div>
<div style="position:absolute;left:99.18px;top:296.33px" class="cls_060"><span class="cls_060">spring.artemis.host</span></div>
<div style="position:absolute;left:239.22px;top:296.33px" class="cls_074"><span class="cls_074">The broker’s host</span></div>
<div style="position:absolute;left:99.18px;top:313.34px" class="cls_060"><span class="cls_060">spring.artemis.port</span></div>
<div style="position:absolute;left:239.22px;top:313.34px" class="cls_074"><span class="cls_074">The broker’s port</span></div>
<div style="position:absolute;left:99.18px;top:330.35px" class="cls_060"><span class="cls_060">spring.artemis.user</span></div>
<div style="position:absolute;left:239.22px;top:330.35px" class="cls_074"><span class="cls_074">The user to use to access the broker (optional)</span></div>
<div style="position:absolute;left:99.18px;top:347.33px" class="cls_060"><span class="cls_060">spring.artemis.password</span></div>
<div style="position:absolute;left:239.22px;top:347.33px" class="cls_074"><span class="cls_074">The password to use to access the broker (optional)</span></div>
<div style="position:absolute;left:93.18px;top:377.66px" class="cls_039"><span class="cls_039">For example, consider the following entry from an application.yml file that might be</span></div>
<div style="position:absolute;left:93.18px;top:390.68px" class="cls_039"><span class="cls_039">used in a non-development setting:</span></div>
<div style="position:absolute;left:93.18px;top:413.36px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:102.78px;top:423.35px" class="cls_060"><span class="cls_060">artemis:</span></div>
<div style="position:absolute;left:112.38px;top:433.34px" class="cls_060"><span class="cls_060">host: artemis.tacocloud.com</span></div>
<div style="position:absolute;left:112.38px;top:443.36px" class="cls_060"><span class="cls_060">port: 61617</span></div>
<div style="position:absolute;left:112.38px;top:453.35px" class="cls_060"><span class="cls_060">user: tacoweb</span></div>
<div style="position:absolute;left:112.38px;top:463.34px" class="cls_061"><span class="cls_061">password: l3tm31n</span></div>
<div style="position:absolute;left:93.18px;top:487.67px" class="cls_039"><span class="cls_039">This sets up Spring to create broker connections to an Artemis broker listening at</span></div>
<div style="position:absolute;left:93.18px;top:500.66px" class="cls_039"><span class="cls_039">artemis.tacocloud.com, port 61617. It also sets the credentials for the application that</span></div>
<div style="position:absolute;left:93.18px;top:513.68px" class="cls_039"><span class="cls_039">will be interacting with that broker. The credentials are optional, but they’re recom-</span></div>
<div style="position:absolute;left:93.18px;top:526.67px" class="cls_039"><span class="cls_039">mended for production deployments.</span></div>
<div style="position:absolute;left:108.21px;top:539.66px" class="cls_039"><span class="cls_039">If you were to use ActiveMQ instead of Artemis, you’d need to use the ActiveMQ-</span></div>
<div style="position:absolute;left:93.18px;top:552.68px" class="cls_039"><span class="cls_039">specific properties listed in table 8.2.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:133844px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background203.jpg" width="531" height="666"></div>
<div style="position:absolute;left:221.10px;top:24.35px" class="cls_055"><span class="cls_055">Sending messages with JMS</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">181</span></div>
<div style="position:absolute;left:102.18px;top:51.32px" class="cls_053"><span class="cls_053">Table 8.2</span></div>
<div style="position:absolute;left:143.91px;top:51.32px" class="cls_053"><span class="cls_053">Properties for configuring the location and credentials of an ActiveMQ broker</span></div>
<div style="position:absolute;left:162.00px;top:72.32px" class="cls_073"><span class="cls_073">Property</span></div>
<div style="position:absolute;left:343.17px;top:72.32px" class="cls_073"><span class="cls_073">Description</span></div>
<div style="position:absolute;left:108.18px;top:91.34px" class="cls_060"><span class="cls_060">spring.activemq.broker-url</span></div>
<div style="position:absolute;left:261.06px;top:91.34px" class="cls_074"><span class="cls_074">The URL of the broker</span></div>
<div style="position:absolute;left:108.18px;top:108.32px" class="cls_060"><span class="cls_060">spring.activemq.user</span></div>
<div style="position:absolute;left:261.06px;top:108.32px" class="cls_074"><span class="cls_074">The user to use to access the broker (optional)</span></div>
<div style="position:absolute;left:108.18px;top:125.33px" class="cls_060"><span class="cls_060">spring.activemq.password</span></div>
<div style="position:absolute;left:261.06px;top:125.33px" class="cls_074"><span class="cls_074">The password to use to access the broker (optional)</span></div>
<div style="position:absolute;left:108.18px;top:142.34px" class="cls_060"><span class="cls_060">spring.activemq.in-memory</span></div>
<div style="position:absolute;left:261.06px;top:142.34px" class="cls_074"><span class="cls_074">Whether or not to start an in-memory broker (default: </span><span class="cls_060">true</span><span class="cls_074">)</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">Notice that instead of offering separate properties for the broker’s hostname and</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">port, an ActiveMQ broker’s address is specified with a single property, </span><span class="cls_059">spring</span></div>
<div style="position:absolute;left:102.18px;top:193.67px" class="cls_059"><span class="cls_059">.activemq.broker-url</span><span class="cls_039">. The URL should be a tcp:// URL, as shown in the following</span></div>
<div style="position:absolute;left:102.18px;top:206.66px" class="cls_039"><span class="cls_039">YAML snippet:</span></div>
<div style="position:absolute;left:102.18px;top:226.34px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:111.78px;top:236.33px" class="cls_060"><span class="cls_060">activemq:</span></div>
<div style="position:absolute;left:121.38px;top:246.35px" class="cls_060"><span class="cls_060">broker-url: tcp://activemq.tacocloud.com</span></div>
<div style="position:absolute;left:121.38px;top:256.34px" class="cls_060"><span class="cls_060">user: tacoweb</span></div>
<div style="position:absolute;left:121.38px;top:266.33px" class="cls_061"><span class="cls_061">password: l3tm31n</span></div>
<div style="position:absolute;left:102.18px;top:287.66px" class="cls_039"><span class="cls_039">Whether you choose Artemis or ActiveMQ, you shouldn’t need to configure these</span></div>
<div style="position:absolute;left:102.18px;top:300.68px" class="cls_039"><span class="cls_039">properties for development when the broker is running locally.</span></div>
<div style="position:absolute;left:118.46px;top:313.67px" class="cls_039"><span class="cls_039">If you’re using ActiveMQ, you will, however, need to set the </span><span class="cls_059">spring.activemq</span></div>
<div style="position:absolute;left:102.18px;top:326.66px" class="cls_059"><span class="cls_059">.in-memory</span><span class="cls_039"> property to </span><span class="cls_059">false</span><span class="cls_039"> to prevent Spring from starting an in-memory broker.</span></div>
<div style="position:absolute;left:102.18px;top:339.68px" class="cls_039"><span class="cls_039">An in-memory broker may seem useful, but it’s only helpful when you’ll be consuming</span></div>
<div style="position:absolute;left:102.18px;top:352.67px" class="cls_039"><span class="cls_039">messages from the same application that publishes them (which has limited usefulness).</span></div>
<div style="position:absolute;left:117.55px;top:365.66px" class="cls_039"><span class="cls_039">Instead of using an embedded broker, you’ll want to install and start an Artemis</span></div>
<div style="position:absolute;left:102.18px;top:378.68px" class="cls_039"><span class="cls_039">(or ActiveMQ) broker before moving on. Rather than repeat the installation instruc-</span></div>
<div style="position:absolute;left:102.18px;top:391.67px" class="cls_039"><span class="cls_039">tions here, I refer you to the broker documentation for details:</span></div>
<div style="position:absolute;left:117.78px;top:408.68px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Artemis</span><span class="cls_039">—</span><a href="https://activemq.apache.org/artemis/docs/latest/using-server.html">https://activemq.apache.org/artemis/docs/latest/using-server.html</a> </div>
<div style="position:absolute;left:117.78px;top:422.66px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  ActiveMQ</span><span class="cls_039">—</span><a href="http://activemq.apache.org/getting-started.html#GettingStarted-Pre-InstallationRequirements">http://activemq.apache.org/getting-started.html#GettingStarted-Pre-</a> </div>
<div style="position:absolute;left:129.78px;top:435.68px" class="cls_045"><span class="cls_045"> </span><a href="http://activemq.apache.org/getting-started.html#GettingStarted-Pre-InstallationRequirements">InstallationRequirements</a> </div>
<div style="position:absolute;left:102.18px;top:453.68px" class="cls_039"><span class="cls_039">With the JMS starter in your build and a broker waiting to ferry messages from one</span></div>
<div style="position:absolute;left:102.18px;top:466.67px" class="cls_039"><span class="cls_039">application to another, you’re ready to start sending messages.</span></div>
<div style="position:absolute;left:66.18px;top:491.51px" class="cls_063"><span class="cls_063">8.1.2</span></div>
<div style="position:absolute;left:102.18px;top:491.51px" class="cls_063"><span class="cls_063">Sending messages with JmsTemplate</span></div>
<div style="position:absolute;left:102.18px;top:509.18px" class="cls_039"><span class="cls_039">With a JMS starter dependency (either Artemis or ActiveMQ) in your build, Spring</span></div>
<div style="position:absolute;left:102.18px;top:522.17px" class="cls_039"><span class="cls_039">Boot will autoconfigure a </span><span class="cls_059">JmsTemplate</span><span class="cls_039"> (among other things) that you can inject and</span></div>
<div style="position:absolute;left:102.18px;top:535.16px" class="cls_039"><span class="cls_039">use to send and receive messages.</span></div>
<div style="position:absolute;left:118.20px;top:548.18px" class="cls_059"><span class="cls_059">JmsTemplate</span><span class="cls_039"> is the centerpiece of Spring’s JMS integration support. Much like</span></div>
<div style="position:absolute;left:102.18px;top:561.17px" class="cls_039"><span class="cls_039">Spring’s other template-oriented components, </span><span class="cls_059">JmsTemplate</span><span class="cls_039"> eliminates a lot of boiler-</span></div>
<div style="position:absolute;left:102.18px;top:574.19px" class="cls_039"><span class="cls_039">plate code that would otherwise be required to work with JMS. Without </span><span class="cls_059">JmsTemplate</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:102.18px;top:587.18px" class="cls_039"><span class="cls_039">you’d need to write code to create a connection and session with the message broker,</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:134520px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background204.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">182</span></div>
<div style="position:absolute;left:179.97px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 8</span></div>
<div style="position:absolute;left:224.10px;top:24.35px" class="cls_055"><span class="cls_055">Sending messages asynchronously</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">and more code to deal with any exceptions that might be thrown in the course of send-</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">ing a message. </span><span class="cls_059">JmsTemplate</span><span class="cls_039"> focuses on what you really want to do: send a message.</span></div>
<div style="position:absolute;left:108.27px;top:76.67px" class="cls_059"><span class="cls_059">JmsTemplate</span><span class="cls_039"> has several methods that are useful for sending messages, including</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">the following:</span></div>
<div style="position:absolute;left:93.18px;top:111.32px" class="cls_060"><span class="cls_060">// Send raw messages</span></div>
<div style="position:absolute;left:93.18px;top:121.34px" class="cls_060"><span class="cls_060">void send(MessageCreator messageCreator) throws JmsException;</span></div>
<div style="position:absolute;left:93.18px;top:131.33px" class="cls_060"><span class="cls_060">void send(Destination destination, MessageCreator messageCreator)</span></div>
<div style="position:absolute;left:323.46px;top:141.35px" class="cls_060"><span class="cls_060">throws JmsException;</span></div>
<div style="position:absolute;left:93.18px;top:151.34px" class="cls_060"><span class="cls_060">void send(String destinationName, MessageCreator messageCreator)</span></div>
<div style="position:absolute;left:323.46px;top:161.33px" class="cls_060"><span class="cls_060">throws JmsException;</span></div>
<div style="position:absolute;left:93.18px;top:171.35px" class="cls_060"><span class="cls_060">// Send messages converted from objects</span></div>
<div style="position:absolute;left:93.18px;top:181.34px" class="cls_060"><span class="cls_060">void convertAndSend(Object message) throws JmsException;</span></div>
<div style="position:absolute;left:93.18px;top:191.33px" class="cls_060"><span class="cls_060">void convertAndSend(Destination destination, Object message)</span></div>
<div style="position:absolute;left:323.46px;top:201.35px" class="cls_060"><span class="cls_060">throws JmsException;</span></div>
<div style="position:absolute;left:93.18px;top:211.34px" class="cls_060"><span class="cls_060">void convertAndSend(String destinationName, Object message)</span></div>
<div style="position:absolute;left:323.46px;top:221.33px" class="cls_060"><span class="cls_060">throws JmsException;</span></div>
<div style="position:absolute;left:93.18px;top:241.34px" class="cls_060"><span class="cls_060">// Send messages converted from objects with post-processing</span></div>
<div style="position:absolute;left:93.18px;top:251.33px" class="cls_060"><span class="cls_060">void convertAndSend(Object message,</span></div>
<div style="position:absolute;left:150.75px;top:261.35px" class="cls_060"><span class="cls_060">MessagePostProcessor postProcessor) throws JmsException;</span></div>
<div style="position:absolute;left:93.18px;top:271.34px" class="cls_060"><span class="cls_060">void convertAndSend(Destination destination, Object message,</span></div>
<div style="position:absolute;left:150.75px;top:281.33px" class="cls_060"><span class="cls_060">MessagePostProcessor postProcessor) throws JmsException;</span></div>
<div style="position:absolute;left:93.18px;top:291.35px" class="cls_060"><span class="cls_060">void convertAndSend(String destinationName, Object message,</span></div>
<div style="position:absolute;left:150.75px;top:301.34px" class="cls_061"><span class="cls_061">MessagePostProcessor postProcessor) throws JmsException;</span></div>
<div style="position:absolute;left:93.18px;top:324.68px" class="cls_039"><span class="cls_039">As you can see, there are really only two methods, </span><span class="cls_059">send()</span><span class="cls_039"> and </span><span class="cls_059">convertAndSend()</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:93.18px;top:337.67px" class="cls_039"><span class="cls_039">each overridden to support different parameters. And if you look closer, you’ll notice</span></div>
<div style="position:absolute;left:93.18px;top:350.66px" class="cls_039"><span class="cls_039">that the various forms of </span><span class="cls_059">convertAndSend()</span><span class="cls_039"> can be broken into two subcategories. In</span></div>
<div style="position:absolute;left:93.18px;top:363.68px" class="cls_039"><span class="cls_039">trying to understand what all of these methods do, consider the following breakdown:</span></div>
<div style="position:absolute;left:108.78px;top:380.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Three </span><span class="cls_059">send()</span><span class="cls_039"> methods require a </span><span class="cls_059">MessageCreator</span><span class="cls_039"> to manufacture a </span><span class="cls_059">Message</span></div>
<div style="position:absolute;left:120.78px;top:393.68px" class="cls_039"><span class="cls_039">object.</span></div>
<div style="position:absolute;left:108.78px;top:407.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Three </span><span class="cls_059">convertAndSend()</span><span class="cls_039"> methods accept an </span><span class="cls_059">Object</span><span class="cls_039"> and automatically convert</span></div>
<div style="position:absolute;left:120.78px;top:420.68px" class="cls_039"><span class="cls_039">that </span><span class="cls_059">Object</span><span class="cls_039"> into a </span><span class="cls_059">Message</span><span class="cls_039"> behind the scenes.</span></div>
<div style="position:absolute;left:108.78px;top:434.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Three </span><span class="cls_059">convertAndSend()</span><span class="cls_039"> methods automatically convert an </span><span class="cls_059">Object</span><span class="cls_039"> to a </span><span class="cls_059">Mes-</span></div>
<div style="position:absolute;left:120.78px;top:447.68px" class="cls_059"><span class="cls_059">sage</span><span class="cls_039">, but also accept a </span><span class="cls_059">MessagePostProcessor</span><span class="cls_039"> to allow for customization of the</span></div>
<div style="position:absolute;left:120.78px;top:460.67px" class="cls_059"><span class="cls_059">Message</span><span class="cls_039"> before it’s sent.</span></div>
<div style="position:absolute;left:93.18px;top:478.67px" class="cls_039"><span class="cls_039">Moreover, each of these three method categories is composed of three overriding</span></div>
<div style="position:absolute;left:93.18px;top:491.66px" class="cls_039"><span class="cls_039">methods that are distinguished by how the JMS destination (queue or topic) is</span></div>
<div style="position:absolute;left:93.18px;top:504.68px" class="cls_039"><span class="cls_039">specified:</span></div>
<div style="position:absolute;left:108.78px;top:521.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  One method accepts no destination parameter and sends the message to a</span></div>
<div style="position:absolute;left:120.78px;top:534.68px" class="cls_039"><span class="cls_039">default destination.</span></div>
<div style="position:absolute;left:108.78px;top:548.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  One method accepts a </span><span class="cls_059">Destination</span><span class="cls_039"> object that specifies the destination for</span></div>
<div style="position:absolute;left:120.78px;top:561.68px" class="cls_039"><span class="cls_039">the message.</span></div>
<div style="position:absolute;left:108.78px;top:575.69px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  One method accepts a </span><span class="cls_059">String</span><span class="cls_039"> that specifies the destination for the message</span></div>
<div style="position:absolute;left:120.78px;top:588.68px" class="cls_039"><span class="cls_039">by name.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:135196px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background205.jpg" width="531" height="666"></div>
<div style="position:absolute;left:221.10px;top:24.35px" class="cls_055"><span class="cls_055">Sending messages with JMS</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">183</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">Putting these methods to work, consider </span><span class="cls_059">JmsOrderMessagingService</span><span class="cls_039"> in the next list-</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">ing, which uses the most basic form of the </span><span class="cls_059">send()</span><span class="cls_039"> method.</span></div>
<div style="position:absolute;left:114.18px;top:87.65px" class="cls_066"><span class="cls_066">Listing 8.1</span></div>
<div style="position:absolute;left:166.28px;top:87.26px" class="cls_066"><span class="cls_066">Sending an order with </span><span class="cls_077">.send()</span><span class="cls_066"> to a default destination</span></div>
<div style="position:absolute;left:102.18px;top:107.63px" class="cls_060"><span class="cls_060">package tacos.messaging;</span></div>
<div style="position:absolute;left:102.18px;top:117.62px" class="cls_060"><span class="cls_060">import javax.jms.JMSException;</span></div>
<div style="position:absolute;left:102.18px;top:127.64px" class="cls_060"><span class="cls_060">import javax.jms.Message;</span></div>
<div style="position:absolute;left:102.18px;top:137.63px" class="cls_060"><span class="cls_060">import javax.jms.Session;</span></div>
<div style="position:absolute;left:102.18px;top:157.64px" class="cls_060"><span class="cls_060">import org.springframework.beans.factory.annotation.Autowired;</span></div>
<div style="position:absolute;left:102.18px;top:167.63px" class="cls_060"><span class="cls_060">import org.springframework.jms.core.JmsTemplate;</span></div>
<div style="position:absolute;left:102.18px;top:177.65px" class="cls_060"><span class="cls_060">import org.springframework.jms.core.MessageCreator;</span></div>
<div style="position:absolute;left:102.18px;top:187.64px" class="cls_060"><span class="cls_060">import org.springframework.stereotype.Service;</span></div>
<div style="position:absolute;left:102.18px;top:207.65px" class="cls_060"><span class="cls_060">@Service</span></div>
<div style="position:absolute;left:102.18px;top:217.64px" class="cls_060"><span class="cls_060">public class JmsOrderMessagingService implements OrderMessagingService {</span></div>
<div style="position:absolute;left:111.78px;top:227.63px" class="cls_060"><span class="cls_060">private JmsTemplate jms;</span></div>
<div style="position:absolute;left:111.78px;top:247.64px" class="cls_060"><span class="cls_060">@Autowired</span></div>
<div style="position:absolute;left:111.78px;top:257.63px" class="cls_060"><span class="cls_060">public JmsOrderMessagingService(JmsTemplate jms) {</span></div>
<div style="position:absolute;left:121.38px;top:267.65px" class="cls_060"><span class="cls_060">this.jms = jms;</span></div>
<div style="position:absolute;left:111.78px;top:277.64px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:297.65px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:111.77px;top:307.64px" class="cls_060"><span class="cls_060">public void sendOrder(Order order) {</span></div>
<div style="position:absolute;left:121.38px;top:317.63px" class="cls_060"><span class="cls_060">jms.send(new MessageCreator() {</span></div>
<div style="position:absolute;left:178.95px;top:327.65px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:178.96px;top:337.64px" class="cls_060"><span class="cls_060">public Message createMessage(Session session)</span></div>
<div style="position:absolute;left:322.86px;top:347.63px" class="cls_060"><span class="cls_060">throws JMSException {</span></div>
<div style="position:absolute;left:188.53px;top:357.65px" class="cls_060"><span class="cls_060">return session.createObjectMessage(order);</span></div>
<div style="position:absolute;left:178.94px;top:367.64px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:169.35px;top:377.63px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:121.38px;top:387.65px" class="cls_060"><span class="cls_060">);</span></div>
<div style="position:absolute;left:111.78px;top:397.64px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:407.66px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:428.96px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">sendOrder()</span><span class="cls_039"> method calls </span><span class="cls_059">jms.send()</span><span class="cls_039">, passing in an anonymous inner-class imple-</span></div>
<div style="position:absolute;left:102.18px;top:441.98px" class="cls_039"><span class="cls_039">mentation of </span><span class="cls_059">MessageCreator</span><span class="cls_039">. That implementation overrides </span><span class="cls_059">createMessage()</span><span class="cls_039"> to cre-</span></div>
<div style="position:absolute;left:102.18px;top:454.97px" class="cls_039"><span class="cls_039">ate a new object message from the given </span><span class="cls_059">Order</span><span class="cls_039"> object.</span></div>
<div style="position:absolute;left:117.77px;top:467.96px" class="cls_039"><span class="cls_039">I’m not sure about you, but I think the code in listing 8.1, although straightfor-</span></div>
<div style="position:absolute;left:102.18px;top:480.98px" class="cls_039"><span class="cls_039">ward, is a bit clumsy. The ceremony involved in declaring an anonymous inner class</span></div>
<div style="position:absolute;left:102.18px;top:493.97px" class="cls_039"><span class="cls_039">complicates an otherwise simple method call. Recognizing that </span><span class="cls_059">MessageCreator</span><span class="cls_039"> is a</span></div>
<div style="position:absolute;left:102.18px;top:506.96px" class="cls_039"><span class="cls_039">functional interface, you can tidy up the </span><span class="cls_059">sendOrder()</span><span class="cls_039"> method a bit with a lambda:</span></div>
<div style="position:absolute;left:102.18px;top:526.64px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:102.18px;top:536.66px" class="cls_060"><span class="cls_060">public void sendOrder(Order order) {</span></div>
<div style="position:absolute;left:111.78px;top:546.65px" class="cls_060"><span class="cls_060">jms.send(session -&gt; session.createObjectMessage(order));</span></div>
<div style="position:absolute;left:102.18px;top:556.64px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:577.97px" class="cls_039"><span class="cls_039">But notice that the call to </span><span class="cls_059">jms.send()</span><span class="cls_039"> doesn’t specify a destination. In order for this to</span></div>
<div style="position:absolute;left:102.18px;top:590.99px" class="cls_039"><span class="cls_039">work, you must also specify a default destination name with the </span><span class="cls_059">spring.jms.template</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:135872px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background206.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">184</span></div>
<div style="position:absolute;left:179.97px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 8</span></div>
<div style="position:absolute;left:224.10px;top:24.35px" class="cls_055"><span class="cls_055">Sending messages asynchronously</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_059"><span class="cls_059">.default-destination</span><span class="cls_039"> property. For example, you could set the property in your</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">application.yml file like this:</span></div>
<div style="position:absolute;left:93.18px;top:83.33px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:102.78px;top:93.32px" class="cls_060"><span class="cls_060">jms:</span></div>
<div style="position:absolute;left:112.38px;top:103.34px" class="cls_060"><span class="cls_060">template:</span></div>
<div style="position:absolute;left:121.95px;top:113.33px" class="cls_061"><span class="cls_061">default-destination: tacocloud.order.queue</span></div>
<div style="position:absolute;left:93.18px;top:134.66px" class="cls_039"><span class="cls_039">In many cases, using a default destination is the easiest choice. It lets you specify the</span></div>
<div style="position:absolute;left:93.18px;top:147.65px" class="cls_039"><span class="cls_039">destination name once, allowing the code to only be concerned with sending mes-</span></div>
<div style="position:absolute;left:93.18px;top:160.67px" class="cls_039"><span class="cls_039">sages, without regard for where they’re being sent. But if you ever need to send a</span></div>
<div style="position:absolute;left:93.18px;top:173.66px" class="cls_039"><span class="cls_039">message to a destination other than the default destination, you’ll need to specify that</span></div>
<div style="position:absolute;left:93.18px;top:186.65px" class="cls_039"><span class="cls_039">destination as a parameter to </span><span class="cls_059">send()</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:108.00px;top:199.67px" class="cls_039"><span class="cls_039">One way of doing that is by passing a </span><span class="cls_059">Destination</span><span class="cls_039"> object as the first parameter to</span></div>
<div style="position:absolute;left:93.18px;top:212.66px" class="cls_059"><span class="cls_059">send()</span><span class="cls_039">. The easiest way to do this is to declare a </span><span class="cls_059">Destination</span><span class="cls_039"> bean and then inject it</span></div>
<div style="position:absolute;left:93.18px;top:225.65px" class="cls_039"><span class="cls_039">into the bean that performs messaging. For example, the following bean declares the</span></div>
<div style="position:absolute;left:93.18px;top:238.67px" class="cls_039"><span class="cls_039">Taco Cloud order queue </span><span class="cls_059">Destination</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:258.35px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:93.18px;top:268.34px" class="cls_060"><span class="cls_060">public Destination orderQueue() {</span></div>
<div style="position:absolute;left:102.78px;top:278.33px" class="cls_060"><span class="cls_060">return new ActiveMQQueue("tacocloud.order.queue");</span></div>
<div style="position:absolute;left:93.18px;top:288.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:309.68px" class="cls_039"><span class="cls_039">It’s important to note that the </span><span class="cls_059">ActiveMQQueue</span><span class="cls_039"> used here is actually from Artemis</span></div>
<div style="position:absolute;left:93.18px;top:322.67px" class="cls_039"><span class="cls_039">(from the org.apache.activemq.artemis.jms.client package). If you’re using ActiveMQ</span></div>
<div style="position:absolute;left:93.18px;top:335.66px" class="cls_039"><span class="cls_039">(not Artemis), there’s also a class named </span><span class="cls_059">ActiveMQQueue</span><span class="cls_039"> (from the org.apache.activemq</span></div>
<div style="position:absolute;left:93.18px;top:348.68px" class="cls_039"><span class="cls_039">.command package).</span></div>
<div style="position:absolute;left:107.91px;top:361.67px" class="cls_039"><span class="cls_039">If this </span><span class="cls_059">Destination</span><span class="cls_039"> bean is injected into </span><span class="cls_059">JmsOrderMessagingService</span><span class="cls_039">, you can use</span></div>
<div style="position:absolute;left:93.18px;top:374.66px" class="cls_039"><span class="cls_039">it to specify the destination when calling </span><span class="cls_059">send()</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:394.34px" class="cls_060"><span class="cls_060">private Destination orderQueue;</span></div>
<div style="position:absolute;left:93.18px;top:414.35px" class="cls_060"><span class="cls_060">@Autowired</span></div>
<div style="position:absolute;left:93.18px;top:424.34px" class="cls_060"><span class="cls_060">public JmsOrderMessagingService(JmsTemplate jms,</span></div>
<div style="position:absolute;left:222.73px;top:434.36px" class="cls_060"><span class="cls_060">Destination orderQueue) {</span></div>
<div style="position:absolute;left:102.78px;top:444.35px" class="cls_060"><span class="cls_060">this.jms = jms;</span></div>
<div style="position:absolute;left:102.78px;top:454.34px" class="cls_060"><span class="cls_060">this.orderQueue = orderQueue;</span></div>
<div style="position:absolute;left:93.18px;top:464.36px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:504.35px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:93.18px;top:514.34px" class="cls_060"><span class="cls_060">public void sendOrder(Order order) {</span></div>
<div style="position:absolute;left:102.78px;top:524.36px" class="cls_060"><span class="cls_060">jms.send(</span></div>
<div style="position:absolute;left:121.95px;top:534.35px" class="cls_060"><span class="cls_060">orderQueue,</span></div>
<div style="position:absolute;left:121.93px;top:544.34px" class="cls_060"><span class="cls_060">session -&gt; session.createObjectMessage(order));</span></div>
<div style="position:absolute;left:93.18px;top:554.36px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:575.69px" class="cls_039"><span class="cls_039">Specifying the destination with a </span><span class="cls_059">Destination</span><span class="cls_039"> object like this affords you the opportu-</span></div>
<div style="position:absolute;left:93.18px;top:588.68px" class="cls_039"><span class="cls_039">nity to configure the </span><span class="cls_059">Destination</span><span class="cls_039"> with more than just the destination name. But in</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:136548px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background207.jpg" width="531" height="666"></div>
<div style="position:absolute;left:221.10px;top:24.35px" class="cls_055"><span class="cls_055">Sending messages with JMS</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">185</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">practice, you’ll almost never specify anything more than the destination name. It’s</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">often easier to just send the name as the first parameter to </span><span class="cls_059">send()</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:102.18px;top:86.33px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:102.18px;top:96.32px" class="cls_060"><span class="cls_060">public void sendOrder(Order order) {</span></div>
<div style="position:absolute;left:111.78px;top:106.34px" class="cls_060"><span class="cls_060">jms.send(</span></div>
<div style="position:absolute;left:130.95px;top:116.33px" class="cls_060"><span class="cls_060">"tacocloud.order.queue",</span></div>
<div style="position:absolute;left:130.96px;top:126.35px" class="cls_060"><span class="cls_060">session -&gt; session.createObjectMessage(order));</span></div>
<div style="position:absolute;left:102.18px;top:136.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:160.67px" class="cls_039"><span class="cls_039">Although the </span><span class="cls_059">send()</span><span class="cls_039"> method isn’t particularly difficult to use (especially when the</span></div>
<div style="position:absolute;left:102.18px;top:173.66px" class="cls_059"><span class="cls_059">MessageCreator</span><span class="cls_039"> is given as a lambda), a sliver of complexity is added by requiring</span></div>
<div style="position:absolute;left:102.18px;top:186.65px" class="cls_039"><span class="cls_039">that you provide a </span><span class="cls_059">MessageCreator</span><span class="cls_039">. Wouldn’t it be simpler if you only needed to spec-</span></div>
<div style="position:absolute;left:102.18px;top:199.67px" class="cls_039"><span class="cls_039">ify the object that’s to be sent (and optionally the destination)? That describes suc-</span></div>
<div style="position:absolute;left:102.18px;top:212.66px" class="cls_039"><span class="cls_039">cinctly how </span><span class="cls_059">convertAndSend()</span><span class="cls_039"> works. Let’s take a look.</span></div>
<div style="position:absolute;left:102.18px;top:232.85px" class="cls_064"><span class="cls_064">C</span><span class="cls_065">ONVERTING</span><span class="cls_064"> </span><span class="cls_065">MESSAGES</span><span class="cls_064"> </span><span class="cls_065">BEFORE</span><span class="cls_064"> </span><span class="cls_065">SENDING</span></div>
<div style="position:absolute;left:102.18px;top:246.17px" class="cls_059"><span class="cls_059">JmsTemplates</span><span class="cls_039">’s </span><span class="cls_059">convertAndSend()</span><span class="cls_039"> method simplifies message publication by elimi-</span></div>
<div style="position:absolute;left:102.18px;top:259.16px" class="cls_039"><span class="cls_039">nating the need to provide a </span><span class="cls_059">MessageCreator</span><span class="cls_039">. Instead, you pass the object that’s to be</span></div>
<div style="position:absolute;left:102.18px;top:272.15px" class="cls_039"><span class="cls_039">sent directly to </span><span class="cls_059">convertAndSend()</span><span class="cls_039">, and the object will be converted into a </span><span class="cls_059">Message</span></div>
<div style="position:absolute;left:102.18px;top:285.17px" class="cls_039"><span class="cls_039">before being sent.</span></div>
<div style="position:absolute;left:117.75px;top:298.16px" class="cls_039"><span class="cls_039">For example, the following reimplementation of </span><span class="cls_059">sendOrder()</span><span class="cls_039"> uses </span><span class="cls_059">convertAnd-</span></div>
<div style="position:absolute;left:102.18px;top:311.18px" class="cls_059"><span class="cls_059">Send()</span><span class="cls_039"> to send an </span><span class="cls_059">Order</span><span class="cls_039"> to a named destination:</span></div>
<div style="position:absolute;left:102.18px;top:333.83px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:102.18px;top:343.85px" class="cls_060"><span class="cls_060">public void sendOrder(Order order) {</span></div>
<div style="position:absolute;left:111.78px;top:353.84px" class="cls_060"><span class="cls_060">jms.convertAndSend("tacocloud.order.queue", order);</span></div>
<div style="position:absolute;left:102.18px;top:363.83px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:388.16px" class="cls_039"><span class="cls_039">Just like the </span><span class="cls_059">send()</span><span class="cls_039"> method, </span><span class="cls_059">convertAndSend()</span><span class="cls_039"> will accept either a </span><span class="cls_059">Destination</span><span class="cls_039"> or</span></div>
<div style="position:absolute;left:102.18px;top:401.18px" class="cls_059"><span class="cls_059">String</span><span class="cls_039"> value to specify the destination, or you can leave out the destination altogether</span></div>
<div style="position:absolute;left:102.18px;top:414.17px" class="cls_039"><span class="cls_039">to send the message to the default destination.</span></div>
<div style="position:absolute;left:116.53px;top:427.16px" class="cls_039"><span class="cls_039">Whichever form of </span><span class="cls_059">convertAndSend()</span><span class="cls_039"> you choose, the </span><span class="cls_059">Order</span><span class="cls_039"> passed into </span><span class="cls_059">convert-</span></div>
<div style="position:absolute;left:102.18px;top:440.18px" class="cls_059"><span class="cls_059">AndSend()</span><span class="cls_039"> is converted into a </span><span class="cls_059">Message</span><span class="cls_039"> before it’s sent. Under the covers, this is</span></div>
<div style="position:absolute;left:102.18px;top:453.17px" class="cls_039"><span class="cls_039">achieved with an implementation of </span><span class="cls_059">MessageConverter</span><span class="cls_039"> that does the dirty work of</span></div>
<div style="position:absolute;left:102.18px;top:466.16px" class="cls_039"><span class="cls_039">converting objects to </span><span class="cls_059">Message</span><span class="cls_039">s.</span></div>
<div style="position:absolute;left:102.18px;top:486.35px" class="cls_064"><span class="cls_064">C</span><span class="cls_065">ONFIGURING</span><span class="cls_064"> </span><span class="cls_065">A</span><span class="cls_064"> </span><span class="cls_065">MESSAGE</span><span class="cls_064"> </span><span class="cls_065">CONVERTER</span></div>
<div style="position:absolute;left:102.18px;top:499.67px" class="cls_059"><span class="cls_059">MessageConverter</span><span class="cls_039"> is a Spring-defined interface that has only two methods to be</span></div>
<div style="position:absolute;left:102.18px;top:512.66px" class="cls_039"><span class="cls_039">implemented:</span></div>
<div style="position:absolute;left:102.18px;top:535.34px" class="cls_060"><span class="cls_060">public interface MessageConverter {</span></div>
<div style="position:absolute;left:111.78px;top:545.36px" class="cls_060"><span class="cls_060">Message toMessage(Object object, Session session)</span></div>
<div style="position:absolute;left:193.33px;top:555.35px" class="cls_060"><span class="cls_060">throws JMSException, MessageConversionException;</span></div>
<div style="position:absolute;left:111.78px;top:565.34px" class="cls_060"><span class="cls_060">Object fromMessage(Message message)</span></div>
<div style="position:absolute;left:102.18px;top:575.36px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:137224px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background208.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">186</span></div>
<div style="position:absolute;left:179.97px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 8</span></div>
<div style="position:absolute;left:224.10px;top:24.35px" class="cls_055"><span class="cls_055">Sending messages asynchronously</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">Although this interface is simple enough to implement, you often won’t need to cre-</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">ate a custom implementation. Spring already offers a handful of implementations,</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">such as those described in table 8.3.</span></div>
<div style="position:absolute;left:93.18px;top:100.34px" class="cls_053"><span class="cls_053">Table 8.3</span></div>
<div style="position:absolute;left:134.90px;top:100.34px" class="cls_053"><span class="cls_053">Spring message converters for common conversion tasks (all in the</span></div>
<div style="position:absolute;left:93.18px;top:110.33px" class="cls_053"><span class="cls_053">org.springframework.jms.support.converter package)</span></div>
<div style="position:absolute;left:139.89px;top:131.33px" class="cls_073"><span class="cls_073">Message converter</span></div>
<div style="position:absolute;left:337.59px;top:131.33px" class="cls_073"><span class="cls_073">What it does</span></div>
<div style="position:absolute;left:99.18px;top:150.35px" class="cls_060"><span class="cls_060">MappingJackson2MessageConverter</span></div>
<div style="position:absolute;left:264.39px;top:150.35px" class="cls_074"><span class="cls_074">Uses the Jackson 2 JSON library to convert messages to</span></div>
<div style="position:absolute;left:264.39px;top:160.34px" class="cls_074"><span class="cls_074">and from JSON</span></div>
<div style="position:absolute;left:99.18px;top:177.35px" class="cls_060"><span class="cls_060">MarshallingMessageConverter</span></div>
<div style="position:absolute;left:264.39px;top:177.35px" class="cls_074"><span class="cls_074">Uses JAXB to convert messages to and from XML</span></div>
<div style="position:absolute;left:99.18px;top:194.33px" class="cls_060"><span class="cls_060">MessagingMessageConverter</span></div>
<div style="position:absolute;left:264.39px;top:194.33px" class="cls_074"><span class="cls_074">Converts a </span><span class="cls_060">Message</span><span class="cls_074"> from the messaging abstraction to</span></div>
<div style="position:absolute;left:264.39px;top:204.35px" class="cls_074"><span class="cls_074">and from a </span><span class="cls_060">Message</span><span class="cls_074"> using an underlying </span><span class="cls_060">Message-</span></div>
<div style="position:absolute;left:264.39px;top:214.34px" class="cls_060"><span class="cls_060">Converter</span><span class="cls_074"> for the payload and a </span><span class="cls_060">JmsHeaderMapper</span></div>
<div style="position:absolute;left:264.39px;top:224.33px" class="cls_074"><span class="cls_074">to map the JMS headers to and from standard message</span></div>
<div style="position:absolute;left:264.39px;top:234.35px" class="cls_074"><span class="cls_074">headers</span></div>
<div style="position:absolute;left:99.18px;top:251.33px" class="cls_060"><span class="cls_060">SimpleMessageConverter</span></div>
<div style="position:absolute;left:264.39px;top:251.33px" class="cls_074"><span class="cls_074">Converts </span><span class="cls_060">String</span><span class="cls_074">s to and from </span><span class="cls_060">TextMessage</span><span class="cls_074">, </span><span class="cls_060">byte</span></div>
<div style="position:absolute;left:264.39px;top:261.35px" class="cls_074"><span class="cls_074">arrays to and from </span><span class="cls_060">BytesMessage</span><span class="cls_074">, </span><span class="cls_060">Map</span><span class="cls_074">s to and from</span></div>
<div style="position:absolute;left:264.39px;top:271.34px" class="cls_060"><span class="cls_060">MapMessage</span><span class="cls_074">, and </span><span class="cls_060">Serializable</span><span class="cls_074"> objects to and from</span></div>
<div style="position:absolute;left:264.39px;top:281.33px" class="cls_060"><span class="cls_060">ObjectMessage</span></div>
<div style="position:absolute;left:93.18px;top:311.66px" class="cls_059"><span class="cls_059">SimpleMessageConverter</span><span class="cls_039"> is the default, but it requires that the object being sent</span></div>
<div style="position:absolute;left:93.18px;top:324.68px" class="cls_039"><span class="cls_039">implement </span><span class="cls_059">Serializable</span><span class="cls_039">. This may be a good idea, but you may prefer to use one of</span></div>
<div style="position:absolute;left:93.18px;top:337.67px" class="cls_039"><span class="cls_039">the other message converters, such as </span><span class="cls_059">MappingJackson2MessageConverter</span><span class="cls_039">, to avoid</span></div>
<div style="position:absolute;left:93.18px;top:350.66px" class="cls_039"><span class="cls_039">that restriction.</span></div>
<div style="position:absolute;left:108.45px;top:363.68px" class="cls_039"><span class="cls_039">To apply a different message converter, all you must do is declare an instance of</span></div>
<div style="position:absolute;left:93.18px;top:376.67px" class="cls_039"><span class="cls_039">the chosen converter as a bean. For example, the following bean declaration will</span></div>
<div style="position:absolute;left:93.18px;top:389.66px" class="cls_039"><span class="cls_039">enable </span><span class="cls_059">MappingJackson2MessageConverter</span><span class="cls_039"> to be used instead of </span><span class="cls_059">SimpleMessage-</span></div>
<div style="position:absolute;left:93.18px;top:402.68px" class="cls_059"><span class="cls_059">Converter</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:425.36px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:93.18px;top:435.35px" class="cls_060"><span class="cls_060">public MappingJackson2MessageConverter messageConverter() {</span></div>
<div style="position:absolute;left:102.78px;top:445.34px" class="cls_060"><span class="cls_060">MappingJackson2MessageConverter messageConverter =</span></div>
<div style="position:absolute;left:217.87px;top:455.36px" class="cls_060"><span class="cls_060">new MappingJackson2MessageConverter();</span></div>
<div style="position:absolute;left:102.78px;top:465.35px" class="cls_060"><span class="cls_060">messageConverter.setTypeIdPropertyName("_typeId");</span></div>
<div style="position:absolute;left:102.78px;top:475.34px" class="cls_060"><span class="cls_060">return messageConverter;</span></div>
<div style="position:absolute;left:93.18px;top:485.36px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:509.66px" class="cls_039"><span class="cls_039">Notice that you called </span><span class="cls_059">setTypeIdPropertyName()</span><span class="cls_039"> on the </span><span class="cls_059">MappingJackson2Message-</span></div>
<div style="position:absolute;left:93.18px;top:522.68px" class="cls_059"><span class="cls_059">Converter</span><span class="cls_039"> before returning it. This is very important, as it enables the receiver to know</span></div>
<div style="position:absolute;left:93.18px;top:535.67px" class="cls_039"><span class="cls_039">what type to convert an incoming message to. By default, it will contain the fully quali-</span></div>
<div style="position:absolute;left:93.18px;top:548.66px" class="cls_039"><span class="cls_039">fied classname of the type being converted. But that’s somewhat inflexible, requiring</span></div>
<div style="position:absolute;left:93.18px;top:561.68px" class="cls_039"><span class="cls_039">that the receiver also have the same type, with the same fully qualified classname.</span></div>
<div style="position:absolute;left:108.72px;top:574.67px" class="cls_039"><span class="cls_039">To allow for more flexibility, you can map a synthetic type name to the actual</span></div>
<div style="position:absolute;left:93.18px;top:587.69px" class="cls_039"><span class="cls_039">type by calling </span><span class="cls_059">setTypeIdMappings()</span><span class="cls_039"> on the message converter. For example, the</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:137900px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background209.jpg" width="531" height="666"></div>
<div style="position:absolute;left:221.10px;top:24.35px" class="cls_055"><span class="cls_055">Sending messages with JMS</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">187</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">following change to the message converter bean method maps a synthetic </span><span class="cls_059">order</span><span class="cls_039"> type</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">ID to the </span><span class="cls_059">Order</span><span class="cls_039"> class:</span></div>
<div style="position:absolute;left:102.18px;top:83.33px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:102.18px;top:93.32px" class="cls_060"><span class="cls_060">public MappingJackson2MessageConverter messageConverter() {</span></div>
<div style="position:absolute;left:111.78px;top:103.34px" class="cls_060"><span class="cls_060">MappingJackson2MessageConverter messageConverter =</span></div>
<div style="position:absolute;left:226.87px;top:113.33px" class="cls_060"><span class="cls_060">new MappingJackson2MessageConverter();</span></div>
<div style="position:absolute;left:111.78px;top:123.32px" class="cls_060"><span class="cls_060">messageConverter.setTypeIdPropertyName("_typeId");</span></div>
<div style="position:absolute;left:111.78px;top:143.33px" class="cls_060"><span class="cls_060">Map&lt;String, Class&lt;?&gt;&gt; typeIdMappings = new HashMap&lt;String, Class&lt;?&gt;&gt;();</span></div>
<div style="position:absolute;left:111.76px;top:153.35px" class="cls_060"><span class="cls_060">typeIdMappings.put("order", Order.class);</span></div>
<div style="position:absolute;left:111.78px;top:163.34px" class="cls_060"><span class="cls_060">messageConverter.setTypeIdMappings(typeIdMappings);</span></div>
<div style="position:absolute;left:111.78px;top:183.35px" class="cls_060"><span class="cls_060">return messageConverter;</span></div>
<div style="position:absolute;left:102.18px;top:193.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:214.67px" class="cls_039"><span class="cls_039">Instead of the fully qualified classname being sent in the message’s </span><span class="cls_059">_typeId</span><span class="cls_039"> property,</span></div>
<div style="position:absolute;left:102.18px;top:227.66px" class="cls_039"><span class="cls_039">the value </span><span class="cls_059">order</span><span class="cls_039"> will be sent. At the receiving application, a similar message converter</span></div>
<div style="position:absolute;left:102.18px;top:240.65px" class="cls_039"><span class="cls_039">will have been configured, mapping </span><span class="cls_059">order</span><span class="cls_039"> to its own understanding of what an order</span></div>
<div style="position:absolute;left:102.18px;top:253.67px" class="cls_039"><span class="cls_039">is. That implementation of an order may be in a different package, have a different</span></div>
<div style="position:absolute;left:102.18px;top:266.66px" class="cls_039"><span class="cls_039">name, and even have a subset of the sender’s </span><span class="cls_059">Order</span><span class="cls_039"> properties.</span></div>
<div style="position:absolute;left:102.18px;top:284.84px" class="cls_064"><span class="cls_064">P</span><span class="cls_065">OST</span><span class="cls_064">-</span><span class="cls_065">PROCESSING</span><span class="cls_064"> </span><span class="cls_065">MESSAGES</span></div>
<div style="position:absolute;left:102.18px;top:297.17px" class="cls_039"><span class="cls_039">Let’s suppose that in addition to its lucrative web business, Taco Cloud has decided to</span></div>
<div style="position:absolute;left:102.18px;top:310.16px" class="cls_039"><span class="cls_039">open a few brick and mortar taco joints. Given that any of their restaurants could also</span></div>
<div style="position:absolute;left:102.18px;top:323.18px" class="cls_039"><span class="cls_039">be a fulfillment center for the web business, they need a way to communicate the</span></div>
<div style="position:absolute;left:102.18px;top:336.17px" class="cls_039"><span class="cls_039">source of an order to the kitchens at the restaurants. This will enable the kitchen staff</span></div>
<div style="position:absolute;left:102.18px;top:349.16px" class="cls_039"><span class="cls_039">to employ a different process for store orders than for web orders.</span></div>
<div style="position:absolute;left:117.18px;top:362.18px" class="cls_039"><span class="cls_039">It would be reasonable to add a new </span><span class="cls_059">source</span><span class="cls_039"> property to the </span><span class="cls_059">Order</span><span class="cls_039"> object to carry</span></div>
<div style="position:absolute;left:102.18px;top:375.17px" class="cls_039"><span class="cls_039">this information, populating it with </span><span class="cls_059">WEB</span><span class="cls_039"> for orders placed online and with </span><span class="cls_059">STORE</span><span class="cls_039"> for</span></div>
<div style="position:absolute;left:102.18px;top:388.16px" class="cls_039"><span class="cls_039">orders placed in the stores. But that would require a change to both the website’s</span></div>
<div style="position:absolute;left:102.18px;top:401.18px" class="cls_059"><span class="cls_059">Order</span><span class="cls_039"> class and the kitchen application’s </span><span class="cls_059">Order</span><span class="cls_039"> class when, in reality, it’s information</span></div>
<div style="position:absolute;left:102.18px;top:414.17px" class="cls_039"><span class="cls_039">that’s only required for the taco preparers.</span></div>
<div style="position:absolute;left:117.58px;top:427.16px" class="cls_039"><span class="cls_039">An easier solution would be to add a custom header to the message to carry the</span></div>
<div style="position:absolute;left:102.18px;top:440.18px" class="cls_039"><span class="cls_039">order’s source. If you were using the </span><span class="cls_059">send()</span><span class="cls_039"> method to send the taco orders, this</span></div>
<div style="position:absolute;left:102.18px;top:453.17px" class="cls_039"><span class="cls_039">could easily be accomplished by calling </span><span class="cls_059">setStringProperty()</span><span class="cls_039"> on the </span><span class="cls_059">Message</span><span class="cls_039"> object:</span></div>
<div style="position:absolute;left:102.18px;top:472.85px" class="cls_060"><span class="cls_060">jms.send("tacocloud.order.queue",</span></div>
<div style="position:absolute;left:121.38px;top:482.84px" class="cls_060"><span class="cls_060">session -&gt; {</span></div>
<div style="position:absolute;left:140.56px;top:492.86px" class="cls_060"><span class="cls_060">Message message = session.createObjectMessage(order);</span></div>
<div style="position:absolute;left:140.55px;top:502.85px" class="cls_060"><span class="cls_060">message.setStringProperty("X_ORDER_SOURCE", "WEB");</span></div>
<div style="position:absolute;left:121.38px;top:512.84px" class="cls_061"><span class="cls_061">});</span></div>
<div style="position:absolute;left:102.18px;top:534.17px" class="cls_039"><span class="cls_039">The problem here is that you aren’t using </span><span class="cls_059">send()</span><span class="cls_039">. By choosing to use </span><span class="cls_059">convertAnd-</span></div>
<div style="position:absolute;left:102.18px;top:547.16px" class="cls_059"><span class="cls_059">Send()</span><span class="cls_039">, the </span><span class="cls_059">Message</span><span class="cls_039"> object is created under the covers, and you don’t have access to it.</span></div>
<div style="position:absolute;left:117.21px;top:560.18px" class="cls_039"><span class="cls_039">Fortunately, there’s a way to tweak a </span><span class="cls_059">Message</span><span class="cls_039"> created under the covers before it’s</span></div>
<div style="position:absolute;left:102.18px;top:573.17px" class="cls_039"><span class="cls_039">sent. By passing in a </span><span class="cls_059">MessagePostProcessor</span><span class="cls_039"> as the final parameter to </span><span class="cls_059">convertAnd-</span></div>
<div style="position:absolute;left:102.18px;top:586.19px" class="cls_059"><span class="cls_059">Send()</span><span class="cls_039">, you can do whatever you want with the </span><span class="cls_059">Message</span><span class="cls_039"> after it has been created. The</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:138576px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background210.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">188</span></div>
<div style="position:absolute;left:179.97px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 8</span></div>
<div style="position:absolute;left:224.10px;top:24.35px" class="cls_055"><span class="cls_055">Sending messages asynchronously</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">following code still uses </span><span class="cls_059">convertAndSend()</span><span class="cls_039">, but it also uses a </span><span class="cls_059">MessagePostProcessor</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">to add the </span><span class="cls_059">X_ORDER_SOURCE</span><span class="cls_039"> header before the message is sent:</span></div>
<div style="position:absolute;left:93.18px;top:84.32px" class="cls_060"><span class="cls_060">jms.convertAndSend("tacocloud.order.queue", order, new MessagePostProcessor() {</span></div>
<div style="position:absolute;left:102.54px;top:94.34px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:102.52px;top:104.33px" class="cls_060"><span class="cls_060">public Message postProcessMessage(Message message) throws JMSException {</span></div>
<div style="position:absolute;left:111.90px;top:114.32px" class="cls_060"><span class="cls_060">message.setStringProperty("X_ORDER_SOURCE", "WEB");</span></div>
<div style="position:absolute;left:111.90px;top:124.34px" class="cls_060"><span class="cls_060">return message;</span></div>
<div style="position:absolute;left:102.54px;top:134.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:144.35px" class="cls_061"><span class="cls_061">});</span></div>
<div style="position:absolute;left:93.18px;top:167.66px" class="cls_039"><span class="cls_039">You may have noticed that </span><span class="cls_059">MessagePostProcessor</span><span class="cls_039"> is a functional interface. This means</span></div>
<div style="position:absolute;left:93.18px;top:180.65px" class="cls_039"><span class="cls_039">that you can simplify it a bit by replacing the anonymous inner class with a lambda:</span></div>
<div style="position:absolute;left:93.18px;top:201.35px" class="cls_060"><span class="cls_060">jms.convertAndSend("tacocloud.order.queue", order,</span></div>
<div style="position:absolute;left:112.38px;top:211.34px" class="cls_060"><span class="cls_060">message -&gt; {</span></div>
<div style="position:absolute;left:121.95px;top:221.33px" class="cls_060"><span class="cls_060">message.setStringProperty("X_ORDER_SOURCE", "WEB");</span></div>
<div style="position:absolute;left:121.95px;top:231.35px" class="cls_060"><span class="cls_060">return message;</span></div>
<div style="position:absolute;left:112.38px;top:241.34px" class="cls_061"><span class="cls_061">});</span></div>
<div style="position:absolute;left:93.18px;top:264.65px" class="cls_039"><span class="cls_039">Although you only need this particular </span><span class="cls_059">MessagePostProcessor</span><span class="cls_039"> for this one call to</span></div>
<div style="position:absolute;left:93.18px;top:277.67px" class="cls_059"><span class="cls_059">convertAndSend()</span><span class="cls_039">, you may find yourself using the same </span><span class="cls_059">MessagePostProcessor</span><span class="cls_039"> for</span></div>
<div style="position:absolute;left:93.18px;top:290.66px" class="cls_039"><span class="cls_039">several different calls to </span><span class="cls_059">convertAndSend()</span><span class="cls_039">. In those cases, perhaps a method refer-</span></div>
<div style="position:absolute;left:93.18px;top:303.68px" class="cls_039"><span class="cls_039">ence is a better choice than a lambda, avoiding unnecessary code duplication:</span></div>
<div style="position:absolute;left:93.18px;top:323.33px" class="cls_060"><span class="cls_060">@GetMapping("/convertAndSend/order")</span></div>
<div style="position:absolute;left:93.18px;top:333.35px" class="cls_060"><span class="cls_060">public String convertAndSendOrder() {</span></div>
<div style="position:absolute;left:102.78px;top:343.34px" class="cls_060"><span class="cls_060">Order order = buildOrder();</span></div>
<div style="position:absolute;left:102.78px;top:353.33px" class="cls_060"><span class="cls_060">jms.convertAndSend("tacocloud.order.queue", order,</span></div>
<div style="position:absolute;left:121.95px;top:363.35px" class="cls_060"><span class="cls_060">this::addOrderSource);</span></div>
<div style="position:absolute;left:102.78px;top:373.34px" class="cls_060"><span class="cls_060">return "Convert and sent order";</span></div>
<div style="position:absolute;left:93.18px;top:383.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:403.34px" class="cls_060"><span class="cls_060">private Message addOrderSource(Message message) throws JMSException {</span></div>
<div style="position:absolute;left:102.78px;top:413.36px" class="cls_060"><span class="cls_060">message.setStringProperty("X_ORDER_SOURCE", "WEB");</span></div>
<div style="position:absolute;left:102.78px;top:423.35px" class="cls_060"><span class="cls_060">return message;</span></div>
<div style="position:absolute;left:93.18px;top:433.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:456.68px" class="cls_039"><span class="cls_039">You’ve now seen several ways of sending messages. But it does no good to send a mes-</span></div>
<div style="position:absolute;left:93.18px;top:469.67px" class="cls_039"><span class="cls_039">sage if nobody ever receives it. Let’s look at how you can receive messages with Spring</span></div>
<div style="position:absolute;left:93.18px;top:482.66px" class="cls_039"><span class="cls_039">and JMS.</span></div>
<div style="position:absolute;left:57.18px;top:504.50px" class="cls_063"><span class="cls_063">8.1.3</span></div>
<div style="position:absolute;left:93.18px;top:504.50px" class="cls_063"><span class="cls_063">Receiving JMS messages</span></div>
<div style="position:absolute;left:93.18px;top:521.66px" class="cls_039"><span class="cls_039">When it comes to consuming messages, you have the choice of a </span><span class="cls_036">pull model</span><span class="cls_039">, where your</span></div>
<div style="position:absolute;left:93.18px;top:534.68px" class="cls_039"><span class="cls_039">code requests a message and waits until one arrives, or a </span><span class="cls_036">push model</span><span class="cls_039">, in which messages</span></div>
<div style="position:absolute;left:93.18px;top:547.67px" class="cls_039"><span class="cls_039">are handed to your code as they become available.</span></div>
<div style="position:absolute;left:108.39px;top:560.69px" class="cls_059"><span class="cls_059">JmsTemplate</span><span class="cls_039"> offers several methods for receiving messages, but all of them use a</span></div>
<div style="position:absolute;left:93.18px;top:573.68px" class="cls_039"><span class="cls_039">pull model. You call one of those methods to request a message, and the thread blocks</span></div>
<div style="position:absolute;left:93.18px;top:586.67px" class="cls_039"><span class="cls_039">until a message is available (which could be immediately or it might take a while).</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:139252px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background211.jpg" width="531" height="666"></div>
<div style="position:absolute;left:221.10px;top:24.35px" class="cls_055"><span class="cls_055">Sending messages with JMS</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">189</span></div>
<div style="position:absolute;left:117.16px;top:50.66px" class="cls_039"><span class="cls_039">On the other hand, you also have the option of using a push model, wherein you</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">define a message listener that’s invoked any time a message is available.</span></div>
<div style="position:absolute;left:117.00px;top:76.67px" class="cls_039"><span class="cls_039">Both options are suitable for a variety of use cases. It’s generally accepted that the</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">push model is the best choice, as it doesn’t block a thread. But in some use cases, a lis-</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">tener could be overburdened if messages arrive too quickly. The pull model enables a</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">consumer to declare that they’re ready to process a new message.</span></div>
<div style="position:absolute;left:118.68px;top:128.66px" class="cls_039"><span class="cls_039">Let’s look at both ways of receiving messages. We’ll start with the pull model</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">offered by </span><span class="cls_059">JmsTemplate</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:102.18px;top:159.83px" class="cls_064"><span class="cls_064">R</span><span class="cls_065">ECEIVING</span><span class="cls_064"> </span><span class="cls_065">WITH</span><span class="cls_064"> J</span><span class="cls_065">MS</span><span class="cls_064">T</span><span class="cls_065">EMPLATE</span></div>
<div style="position:absolute;left:102.18px;top:172.16px" class="cls_059"><span class="cls_059">JmsTemplate</span><span class="cls_039"> offers several methods for pulling methods from the broker, including</span></div>
<div style="position:absolute;left:102.18px;top:185.15px" class="cls_039"><span class="cls_039">the following:</span></div>
<div style="position:absolute;left:102.18px;top:204.83px" class="cls_060"><span class="cls_060">Message receive() throws JmsException;</span></div>
<div style="position:absolute;left:102.18px;top:214.85px" class="cls_060"><span class="cls_060">Message receive(Destination destination) throws JmsException;</span></div>
<div style="position:absolute;left:102.18px;top:224.84px" class="cls_060"><span class="cls_060">Message receive(String destinationName) throws JmsException;</span></div>
<div style="position:absolute;left:102.18px;top:244.85px" class="cls_060"><span class="cls_060">Object receiveAndConvert() throws JmsException;</span></div>
<div style="position:absolute;left:102.18px;top:254.84px" class="cls_060"><span class="cls_060">Object receiveAndConvert(Destination destination) throws JmsException;</span></div>
<div style="position:absolute;left:102.18px;top:264.83px" class="cls_061"><span class="cls_061">Object receiveAndConvert(String destinationName) throws JmsException;</span></div>
<div style="position:absolute;left:102.18px;top:286.16px" class="cls_039"><span class="cls_039">As you can see, these six methods mirror the </span><span class="cls_059">send()</span><span class="cls_039"> and </span><span class="cls_059">convertAndSend()</span><span class="cls_039"> methods</span></div>
<div style="position:absolute;left:102.18px;top:299.18px" class="cls_039"><span class="cls_039">from </span><span class="cls_059">JmsTemplate</span><span class="cls_039">. The </span><span class="cls_059">receive()</span><span class="cls_039"> methods receive a raw </span><span class="cls_059">Message</span><span class="cls_039">, whereas the</span></div>
<div style="position:absolute;left:102.18px;top:312.17px" class="cls_059"><span class="cls_059">receiveAndConvert()</span><span class="cls_039"> methods use a configured message converter to convert mes-</span></div>
<div style="position:absolute;left:102.18px;top:325.16px" class="cls_039"><span class="cls_039">sages into domain types. And for each of these, you can specify either a </span><span class="cls_059">Destination</span></div>
<div style="position:absolute;left:102.18px;top:338.18px" class="cls_039"><span class="cls_039">or a </span><span class="cls_059">String</span><span class="cls_039"> containing the destination name, or you can pull a message from the</span></div>
<div style="position:absolute;left:102.18px;top:351.17px" class="cls_039"><span class="cls_039">default destination.</span></div>
<div style="position:absolute;left:117.51px;top:364.16px" class="cls_039"><span class="cls_039">To see these in action, you’ll write some code that pulls an </span><span class="cls_059">Order</span><span class="cls_039"> from the taco-</span></div>
<div style="position:absolute;left:102.18px;top:377.18px" class="cls_039"><span class="cls_039">cloud.order.queue destination. The following listing shows </span><span class="cls_059">OrderReceiver</span><span class="cls_039">, a service</span></div>
<div style="position:absolute;left:102.18px;top:390.17px" class="cls_039"><span class="cls_039">component that receives order data using </span><span class="cls_059">JmsTemplate.receive()</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:114.18px;top:413.90px" class="cls_066"><span class="cls_066">Listing 8.2</span></div>
<div style="position:absolute;left:166.27px;top:413.90px" class="cls_066"><span class="cls_066">Pulling orders from a queue</span></div>
<div style="position:absolute;left:102.18px;top:433.76px" class="cls_060"><span class="cls_060">package tacos.kitchen.messaging.jms;</span></div>
<div style="position:absolute;left:102.18px;top:443.75px" class="cls_060"><span class="cls_060">import javax.jms.Message;</span></div>
<div style="position:absolute;left:102.18px;top:453.74px" class="cls_060"><span class="cls_060">import org.springframework.beans.factory.annotation.Autowired;</span></div>
<div style="position:absolute;left:102.18px;top:463.76px" class="cls_060"><span class="cls_060">import org.springframework.jms.core.JmsTemplate;</span></div>
<div style="position:absolute;left:102.18px;top:473.75px" class="cls_060"><span class="cls_060">import org.springframework.jms.support.converter.MessageConverter;</span></div>
<div style="position:absolute;left:102.18px;top:483.74px" class="cls_060"><span class="cls_060">import org.springframework.stereotype.Component;</span></div>
<div style="position:absolute;left:102.18px;top:503.75px" class="cls_060"><span class="cls_060">@Component</span></div>
<div style="position:absolute;left:102.18px;top:513.74px" class="cls_060"><span class="cls_060">public class JmsOrderReceiver implements OrderReceiver {</span></div>
<div style="position:absolute;left:111.78px;top:523.76px" class="cls_060"><span class="cls_060">private JmsTemplate jms;</span></div>
<div style="position:absolute;left:111.78px;top:533.75px" class="cls_060"><span class="cls_060">private MessageConverter converter;</span></div>
<div style="position:absolute;left:111.78px;top:553.76px" class="cls_060"><span class="cls_060">@Autowired</span></div>
<div style="position:absolute;left:111.78px;top:563.75px" class="cls_060"><span class="cls_060">public JmsOrderReceiver(JmsTemplate jms, MessageConverter converter) {</span></div>
<div style="position:absolute;left:121.38px;top:573.74px" class="cls_060"><span class="cls_060">this.jms = jms;</span></div>
<div style="position:absolute;left:121.38px;top:583.76px" class="cls_060"><span class="cls_060">this.converter = converter;</span></div>
<div style="position:absolute;left:111.78px;top:593.75px" class="cls_060"><span class="cls_060">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:139928px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background212.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">190</span></div>
<div style="position:absolute;left:179.97px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 8</span></div>
<div style="position:absolute;left:224.10px;top:24.35px" class="cls_055"><span class="cls_055">Sending messages asynchronously</span></div>
<div style="position:absolute;left:102.77px;top:51.32px" class="cls_060"><span class="cls_060">public Order receiveOrder() {</span></div>
<div style="position:absolute;left:112.38px;top:61.34px" class="cls_060"><span class="cls_060">Message message = jms.receive("tacocloud.order.queue");</span></div>
<div style="position:absolute;left:112.38px;top:71.33px" class="cls_060"><span class="cls_060">return (Order) converter.fromMessage(message);</span></div>
<div style="position:absolute;left:102.78px;top:81.32px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:91.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:114.65px" class="cls_039"><span class="cls_039">Here you’ve used a </span><span class="cls_059">String</span><span class="cls_039"> to specify the destination to pull an order from. The</span></div>
<div style="position:absolute;left:93.18px;top:127.67px" class="cls_059"><span class="cls_059">receive()</span><span class="cls_039"> method returns an unconverted </span><span class="cls_059">Message</span><span class="cls_039">. But what you really need is the</span></div>
<div style="position:absolute;left:93.18px;top:140.66px" class="cls_059"><span class="cls_059">Order</span><span class="cls_039"> that’s inside of the </span><span class="cls_059">Message</span><span class="cls_039">, so the very next thing that happens is that you use</span></div>
<div style="position:absolute;left:93.18px;top:153.65px" class="cls_039"><span class="cls_039">an injected message converter to convert the message. The type ID property in the</span></div>
<div style="position:absolute;left:93.18px;top:166.67px" class="cls_039"><span class="cls_039">message will guide the converter in converting it to an </span><span class="cls_059">Order</span><span class="cls_039">, but it’s returned as an</span></div>
<div style="position:absolute;left:93.18px;top:179.66px" class="cls_059"><span class="cls_059">Object</span><span class="cls_039"> that requires casting before you can return it.</span></div>
<div style="position:absolute;left:108.32px;top:192.65px" class="cls_039"><span class="cls_039">Receiving a raw </span><span class="cls_059">Message</span><span class="cls_039"> object might be useful in some cases where you need to</span></div>
<div style="position:absolute;left:93.18px;top:205.67px" class="cls_039"><span class="cls_039">inspect the message’s properties and headers. But often you only need the payload.</span></div>
<div style="position:absolute;left:93.18px;top:218.66px" class="cls_039"><span class="cls_039">Converting that payload to a domain type is a two-step process and requires that the</span></div>
<div style="position:absolute;left:93.18px;top:231.65px" class="cls_039"><span class="cls_039">message converter be injected into the component. When you only care about the</span></div>
<div style="position:absolute;left:93.18px;top:244.67px" class="cls_039"><span class="cls_039">message’s payload, </span><span class="cls_059">receiveAndConvert()</span><span class="cls_039"> is a lot simpler. The next listing shows</span></div>
<div style="position:absolute;left:93.18px;top:257.66px" class="cls_039"><span class="cls_039">how </span><span class="cls_059">JmsOrderReceiver</span><span class="cls_039"> could be reworked to use </span><span class="cls_059">receiveAndConvert()</span><span class="cls_039"> instead of</span></div>
<div style="position:absolute;left:93.18px;top:270.65px" class="cls_059"><span class="cls_059">receive()</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:105.18px;top:297.65px" class="cls_066"><span class="cls_066">Listing 8.3</span></div>
<div style="position:absolute;left:157.27px;top:297.26px" class="cls_066"><span class="cls_066">Receiving an already-converted </span><span class="cls_077">Order</span><span class="cls_066"> object</span></div>
<div style="position:absolute;left:93.18px;top:317.63px" class="cls_060"><span class="cls_060">package tacos.kitchen.messaging.jms;</span></div>
<div style="position:absolute;left:93.18px;top:327.65px" class="cls_060"><span class="cls_060">import org.springframework.beans.factory.annotation.Autowired;</span></div>
<div style="position:absolute;left:93.18px;top:337.64px" class="cls_060"><span class="cls_060">import org.springframework.jms.core.JmsTemplate;</span></div>
<div style="position:absolute;left:93.18px;top:347.63px" class="cls_060"><span class="cls_060">import org.springframework.stereotype.Component;</span></div>
<div style="position:absolute;left:93.18px;top:367.64px" class="cls_060"><span class="cls_060">@Component</span></div>
<div style="position:absolute;left:93.18px;top:377.63px" class="cls_060"><span class="cls_060">public class JmsOrderReceiver implements OrderReceiver {</span></div>
<div style="position:absolute;left:102.78px;top:387.65px" class="cls_060"><span class="cls_060">private JmsTemplate jms;</span></div>
<div style="position:absolute;left:102.78px;top:407.66px" class="cls_060"><span class="cls_060">@Autowired</span></div>
<div style="position:absolute;left:102.78px;top:417.65px" class="cls_060"><span class="cls_060">public JmsOrderReceiver(JmsTemplate jms) {</span></div>
<div style="position:absolute;left:112.38px;top:427.64px" class="cls_060"><span class="cls_060">this.jms = jms;</span></div>
<div style="position:absolute;left:102.78px;top:437.66px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.77px;top:457.64px" class="cls_060"><span class="cls_060">public Order receiveOrder() {</span></div>
<div style="position:absolute;left:112.38px;top:467.66px" class="cls_060"><span class="cls_060">return (Order) jms.receiveAndConvert("tacocloud.order.queue");</span></div>
<div style="position:absolute;left:102.78px;top:477.65px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:487.64px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:510.98px" class="cls_039"><span class="cls_039">This new version of </span><span class="cls_059">JmsOrderReceiver</span><span class="cls_039"> has a </span><span class="cls_059">receieveOrder()</span><span class="cls_039"> method that has been</span></div>
<div style="position:absolute;left:93.18px;top:523.97px" class="cls_039"><span class="cls_039">reduced to only one line. And you no longer need to inject a </span><span class="cls_059">MessageConverter</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:93.18px;top:536.96px" class="cls_039"><span class="cls_039">because all of the message conversion will be done behind the scenes in </span><span class="cls_059">receiveAnd-</span></div>
<div style="position:absolute;left:93.18px;top:549.98px" class="cls_059"><span class="cls_059">Convert()</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:108.14px;top:562.97px" class="cls_039"><span class="cls_039">Before moving on, let’s consider how </span><span class="cls_059">receiveOrder()</span><span class="cls_039"> might be used in the Taco</span></div>
<div style="position:absolute;left:93.18px;top:575.99px" class="cls_039"><span class="cls_039">Cloud kitchen application. A food preparer at one of Taco Cloud’s kitchens might</span></div>
<div style="position:absolute;left:93.18px;top:588.98px" class="cls_039"><span class="cls_039">push a button or take some action to indicate that they’re ready to start building tacos.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:140604px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background213.jpg" width="531" height="666"></div>
<div style="position:absolute;left:221.10px;top:24.35px" class="cls_055"><span class="cls_055">Sending messages with JMS</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">191</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">At that point, </span><span class="cls_059">receiveOrder()</span><span class="cls_039"> would be invoked and the call to </span><span class="cls_059">receive()</span><span class="cls_039"> or </span><span class="cls_059">receive-</span></div>
<div style="position:absolute;left:102.27px;top:63.65px" class="cls_059"><span class="cls_059">AndConvert()</span><span class="cls_039"> would block. Nothing else would happen until an order message is ready.</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">Once an order arrives, it will be returned from </span><span class="cls_059">receiveOrder()</span><span class="cls_039"> and its information</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">used to display the details of the order for the food preparer to get to work. This</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">seems like a natural choice for a pull model.</span></div>
<div style="position:absolute;left:116.77px;top:115.67px" class="cls_039"><span class="cls_039">Now let’s see how a push model works by declaring a JMS listener.</span></div>
<div style="position:absolute;left:102.18px;top:133.85px" class="cls_064"><span class="cls_064">D</span><span class="cls_065">ECLARING</span><span class="cls_064"> </span><span class="cls_065">MESSAGE</span><span class="cls_064"> </span><span class="cls_065">LISTENERS</span></div>
<div style="position:absolute;left:102.18px;top:146.15px" class="cls_039"><span class="cls_039">Unlike the pull model, where an explicit call to </span><span class="cls_059">receive()</span><span class="cls_039"> or </span><span class="cls_059">receiveAndConvert()</span></div>
<div style="position:absolute;left:102.18px;top:159.17px" class="cls_039"><span class="cls_039">was required to receive a message, a message listener is a passive component that’s</span></div>
<div style="position:absolute;left:102.18px;top:172.16px" class="cls_039"><span class="cls_039">idle until a message arrives.</span></div>
<div style="position:absolute;left:116.65px;top:185.15px" class="cls_039"><span class="cls_039">To create a message listener that reacts to JMS messages, you simply must annotate</span></div>
<div style="position:absolute;left:102.18px;top:198.17px" class="cls_039"><span class="cls_039">a method in a component with </span><span class="cls_059">@JmsListener</span><span class="cls_039">. The next listing shows a new </span><span class="cls_059">Order-</span></div>
<div style="position:absolute;left:102.18px;top:211.16px" class="cls_059"><span class="cls_059">Listener</span><span class="cls_039"> component that listens passively for messages, rather than actively request-</span></div>
<div style="position:absolute;left:102.18px;top:224.15px" class="cls_039"><span class="cls_039">ing them.</span></div>
<div style="position:absolute;left:114.18px;top:247.16px" class="cls_066"><span class="cls_066">Listing 8.4</span></div>
<div style="position:absolute;left:166.27px;top:246.77px" class="cls_066"><span class="cls_066">An </span><span class="cls_077">OrderListener</span><span class="cls_066"> component that listens for orders</span></div>
<div style="position:absolute;left:102.18px;top:266.15px" class="cls_060"><span class="cls_060">package tacos.kitchen.messaging.jms.listener;</span></div>
<div style="position:absolute;left:102.18px;top:276.14px" class="cls_060"><span class="cls_060">import org.springframework.beans.factory.annotation.Autowired;</span></div>
<div style="position:absolute;left:102.18px;top:286.13px" class="cls_060"><span class="cls_060">import org.springframework.jms.annotation.JmsListener;</span></div>
<div style="position:absolute;left:102.18px;top:296.15px" class="cls_060"><span class="cls_060">import org.springframework.stereotype.Component;</span></div>
<div style="position:absolute;left:102.18px;top:314.15px" class="cls_060"><span class="cls_060">@Component</span></div>
<div style="position:absolute;left:102.18px;top:324.14px" class="cls_060"><span class="cls_060">public class OrderListener {</span></div>
<div style="position:absolute;left:111.78px;top:334.13px" class="cls_060"><span class="cls_060">private KitchenUI ui;</span></div>
<div style="position:absolute;left:111.78px;top:352.13px" class="cls_060"><span class="cls_060">@Autowired</span></div>
<div style="position:absolute;left:111.78px;top:362.15px" class="cls_060"><span class="cls_060">public OrderListener(KitchenUI ui) {</span></div>
<div style="position:absolute;left:121.38px;top:372.14px" class="cls_060"><span class="cls_060">this.ui = ui;</span></div>
<div style="position:absolute;left:111.78px;top:382.16px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:400.16px" class="cls_060"><span class="cls_060">@JmsListener(destination = "tacocloud.order.queue")</span></div>
<div style="position:absolute;left:111.78px;top:410.15px" class="cls_060"><span class="cls_060">public void receiveOrder(Order order) {</span></div>
<div style="position:absolute;left:121.38px;top:420.14px" class="cls_060"><span class="cls_060">ui.displayOrder(order);</span></div>
<div style="position:absolute;left:111.78px;top:430.16px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:440.15px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:460.46px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">receiveOrder()</span><span class="cls_039"> method is annotated with </span><span class="cls_059">JmsListener</span><span class="cls_039"> to “listen” for messages</span></div>
<div style="position:absolute;left:102.18px;top:473.48px" class="cls_039"><span class="cls_039">on the tacocloud.order.queue destination. It doesn’t deal with </span><span class="cls_059">JmsTemplate</span><span class="cls_039">, nor is it</span></div>
<div style="position:absolute;left:102.18px;top:486.47px" class="cls_039"><span class="cls_039">explicitly invoked by your application code. Instead, framework code within Spring</span></div>
<div style="position:absolute;left:102.18px;top:499.46px" class="cls_039"><span class="cls_039">waits for messages to arrive on the specified destination, and when they arrive, the</span></div>
<div style="position:absolute;left:102.18px;top:512.48px" class="cls_059"><span class="cls_059">receiveOrder()</span><span class="cls_039"> method is invoked automatically with the message’s </span><span class="cls_059">Order</span><span class="cls_039"> payload as</span></div>
<div style="position:absolute;left:102.18px;top:525.47px" class="cls_039"><span class="cls_039">a parameter.</span></div>
<div style="position:absolute;left:117.59px;top:538.46px" class="cls_039"><span class="cls_039">In many ways, the </span><span class="cls_059">@JmsListener</span><span class="cls_039"> annotation is like one of Spring MVC’s request</span></div>
<div style="position:absolute;left:102.18px;top:551.48px" class="cls_039"><span class="cls_039">mapping annotations, such as </span><span class="cls_059">@GetMapping</span><span class="cls_039"> or </span><span class="cls_059">@PostMapping</span><span class="cls_039">. In Spring MVC, meth-</span></div>
<div style="position:absolute;left:102.18px;top:564.47px" class="cls_039"><span class="cls_039">ods annotated with one of the request mapping methods react to requests to a speci-</span></div>
<div style="position:absolute;left:102.18px;top:577.49px" class="cls_039"><span class="cls_039">fied path. Similarly, methods that are annotated with </span><span class="cls_059">@JmsListener</span><span class="cls_039"> react to messages</span></div>
<div style="position:absolute;left:102.18px;top:590.48px" class="cls_039"><span class="cls_039">that arrive in a destination.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:141280px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background214.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">192</span></div>
<div style="position:absolute;left:179.97px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 8</span></div>
<div style="position:absolute;left:224.10px;top:24.35px" class="cls_055"><span class="cls_055">Sending messages asynchronously</span></div>
<div style="position:absolute;left:107.85px;top:50.66px" class="cls_039"><span class="cls_039">Message listeners are often touted as the best choice because they don’t block and</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">are able to handle multiple messages quickly. In the context of the Taco Cloud appli-</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">cation, however, perhaps they aren’t the best choice. The food preparers are a signifi-</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">cant bottleneck in the system and may not be able to prepare tacos as quickly as orders</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">come in. A food preparer may have half-fulfilled an order when a new order is dis-</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">played on the screen. The kitchen user interface would need to buffer the orders as</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">they arrive to avoid overburdening the kitchen staff.</span></div>
<div style="position:absolute;left:107.97px;top:141.65px" class="cls_039"><span class="cls_039">That’s not to say that message listeners are bad. On the contrary, they’re a perfect</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_039"><span class="cls_039">fit when messages can be handled quickly. But when the message handlers need to be</span></div>
<div style="position:absolute;left:93.18px;top:167.66px" class="cls_039"><span class="cls_039">able to ask for more messages on their own timing, the pull model offered by </span><span class="cls_059">Jms-</span></div>
<div style="position:absolute;left:93.18px;top:180.65px" class="cls_059"><span class="cls_059">Template</span><span class="cls_039"> seems more fitting.</span></div>
<div style="position:absolute;left:108.90px;top:193.67px" class="cls_039"><span class="cls_039">Because JMS is defined by a standard Java specification and supported by many</span></div>
<div style="position:absolute;left:93.18px;top:206.66px" class="cls_039"><span class="cls_039">message broker implementations, it’s a common choice for messaging in Java. But</span></div>
<div style="position:absolute;left:93.18px;top:219.65px" class="cls_039"><span class="cls_039">JMS has a few shortcomings, not the least of which is that as a Java specification its use</span></div>
<div style="position:absolute;left:93.18px;top:232.67px" class="cls_039"><span class="cls_039">is limited to Java applications. Newer messaging options such as RabbitMQ and Kafka</span></div>
<div style="position:absolute;left:93.18px;top:245.66px" class="cls_039"><span class="cls_039">address these shortcomings and are available for other languages and platforms</span></div>
<div style="position:absolute;left:93.18px;top:258.65px" class="cls_039"><span class="cls_039">beyond the JVM. Let’s set JMS aside and see how you could have implemented your</span></div>
<div style="position:absolute;left:93.18px;top:271.67px" class="cls_039"><span class="cls_039">taco order messaging with RabbitMQ.</span></div>
<div style="position:absolute;left:57.18px;top:292.84px" class="cls_040"><span class="cls_040">8.2</span></div>
<div style="position:absolute;left:93.18px;top:292.84px" class="cls_040"><span class="cls_040">Working with RabbitMQ and AMQP</span></div>
<div style="position:absolute;left:93.18px;top:310.67px" class="cls_039"><span class="cls_039">As arguably the most prominent implementation of AMQP, RabbitMQ offers a more</span></div>
<div style="position:absolute;left:93.18px;top:323.66px" class="cls_039"><span class="cls_039">advanced message-routing strategy than JMS. Whereas JMS messages are addressed</span></div>
<div style="position:absolute;left:93.18px;top:336.68px" class="cls_039"><span class="cls_039">with the name of a destination from which the receiver will retrieve them, AMQP mes-</span></div>
<div style="position:absolute;left:93.18px;top:349.67px" class="cls_039"><span class="cls_039">sages are addressed with the name of an exchange and a routing key, which are decou-</span></div>
<div style="position:absolute;left:93.18px;top:362.66px" class="cls_039"><span class="cls_039">pled from the queue that the receiver is listening to. This relationship between an</span></div>
<div style="position:absolute;left:93.18px;top:375.68px" class="cls_039"><span class="cls_039">exchange and queues is illustrated in figure 8.1.</span></div>
<div style="position:absolute;left:159.92px;top:406.43px" class="cls_079"><span class="cls_079">RabbitMQ broker</span></div>
<div style="position:absolute;left:280.66px;top:426.36px" class="cls_057"><span class="cls_057">Queue</span></div>
<div style="position:absolute;left:354.47px;top:426.36px" class="cls_057"><span class="cls_057">Receiver</span></div>
<div style="position:absolute;left:225.64px;top:439.94px" class="cls_057"><span class="cls_057">Binding</span></div>
<div style="position:absolute;left:103.19px;top:456.72px" class="cls_057"><span class="cls_057">Sender</span></div>
<div style="position:absolute;left:174.64px;top:457.81px" class="cls_057"><span class="cls_057">Exchange</span></div>
<div style="position:absolute;left:225.64px;top:476.56px" class="cls_057"><span class="cls_057">Binding</span></div>
<div style="position:absolute;left:280.66px;top:488.53px" class="cls_057"><span class="cls_057">Queue</span></div>
<div style="position:absolute;left:354.47px;top:488.52px" class="cls_057"><span class="cls_057">Receiver</span></div>
<div style="position:absolute;left:93.18px;top:532.01px" class="cls_053"><span class="cls_053">Figure 8.1</span></div>
<div style="position:absolute;left:137.78px;top:532.01px" class="cls_053"><span class="cls_053">Messages sent to a RabbitMQ exchange are routed to one or more</span></div>
<div style="position:absolute;left:93.18px;top:542.00px" class="cls_053"><span class="cls_053">queues, based on routing keys and bindings.</span></div>
<div style="position:absolute;left:93.18px;top:577.13px" class="cls_039"><span class="cls_039">When a message arrives at the RabbitMQ broker, it goes to the exchange for which it</span></div>
<div style="position:absolute;left:93.18px;top:590.15px" class="cls_039"><span class="cls_039">was addressed. The exchange is responsible for routing it to one or more queues,</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:141956px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background215.jpg" width="531" height="666"></div>
<div style="position:absolute;left:203.94px;top:24.35px" class="cls_055"><span class="cls_055">Working with RabbitMQ and AMQP</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">193</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">depending on the type of exchange, the binding between the exchange and queues,</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">and the value of the message’s routing key.</span></div>
<div style="position:absolute;left:116.77px;top:76.67px" class="cls_039"><span class="cls_039">There are several different kinds of exchanges, including the following:</span></div>
<div style="position:absolute;left:117.78px;top:93.65px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Default</span><span class="cls_039">—A special exchange that’s automatically created by the broker. It routes</span></div>
<div style="position:absolute;left:129.78px;top:106.67px" class="cls_039"><span class="cls_039">messages to queues whose name is the same as the message’s routing key. All</span></div>
<div style="position:absolute;left:129.78px;top:119.66px" class="cls_039"><span class="cls_039">queues will automatically be bound to the default exchange.</span></div>
<div style="position:absolute;left:117.78px;top:133.67px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Direct</span><span class="cls_039">—Routes messages to a queue whose binding key is the same as the mes-</span></div>
<div style="position:absolute;left:129.78px;top:146.66px" class="cls_039"><span class="cls_039">sage’s routing key.</span></div>
<div style="position:absolute;left:117.78px;top:160.67px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Topic</span><span class="cls_039">—Routes a message to one or more queues where the binding key (which</span></div>
<div style="position:absolute;left:129.78px;top:173.66px" class="cls_039"><span class="cls_039">may contain wildcards) matches the message’s routing key.</span></div>
<div style="position:absolute;left:117.78px;top:187.67px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Fanout</span><span class="cls_039">—Routes messages to all bound queues without regard for binding keys</span></div>
<div style="position:absolute;left:129.78px;top:200.66px" class="cls_039"><span class="cls_039">or routing keys.</span></div>
<div style="position:absolute;left:117.78px;top:214.67px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Headers</span><span class="cls_039">—Similar to a topic exchange, except that routing is based on message</span></div>
<div style="position:absolute;left:129.78px;top:227.66px" class="cls_039"><span class="cls_039">header values rather than routing keys.</span></div>
<div style="position:absolute;left:117.78px;top:241.67px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Dead letter</span><span class="cls_039">—A catch-all for any messages that are undeliverable (meaning they</span></div>
<div style="position:absolute;left:129.78px;top:254.66px" class="cls_039"><span class="cls_039">don’t match any defined exchange-to-queue binding).</span></div>
<div style="position:absolute;left:102.18px;top:272.66px" class="cls_039"><span class="cls_039">The simplest forms of exchanges are default and fanout, as these roughly correspond</span></div>
<div style="position:absolute;left:102.18px;top:285.65px" class="cls_039"><span class="cls_039">to a JMS queue and topic. But the other exchanges allow you to define more flexible</span></div>
<div style="position:absolute;left:102.18px;top:298.67px" class="cls_039"><span class="cls_039">routing schemes.</span></div>
<div style="position:absolute;left:116.70px;top:311.66px" class="cls_039"><span class="cls_039">The most important thing to understand is that messages are sent to exchanges with</span></div>
<div style="position:absolute;left:102.18px;top:324.68px" class="cls_039"><span class="cls_039">routing keys and they’re consumed from queues. How they get from an exchange to a</span></div>
<div style="position:absolute;left:102.18px;top:337.67px" class="cls_039"><span class="cls_039">queue depends on the binding definitions and what best suits your use cases.</span></div>
<div style="position:absolute;left:116.77px;top:350.66px" class="cls_039"><span class="cls_039">Which exchange type you use and how you define the bindings from exchanges to</span></div>
<div style="position:absolute;left:102.18px;top:363.68px" class="cls_039"><span class="cls_039">queues has little bearing on how messages are sent and received in your Spring appli-</span></div>
<div style="position:absolute;left:102.18px;top:376.67px" class="cls_039"><span class="cls_039">cations. Therefore we’ll focus on how to write code that sends and receives messages</span></div>
<div style="position:absolute;left:102.18px;top:389.66px" class="cls_039"><span class="cls_039">with Rabbit.</span></div>
<div style="position:absolute;left:114.18px;top:410.66px" class="cls_083"><span class="cls_083">NOTE</span><span class="cls_039">  For  a  more  detailed  discussion  on  how  best  to  bind  queues  to</span></div>
<div style="position:absolute;left:114.18px;top:422.66px" class="cls_039"><span class="cls_039">exchanges, see </span><span class="cls_036">RabbitMQ in Action</span><span class="cls_039"> by Alvaro Videla and Jason J.W. Williams</span></div>
<div style="position:absolute;left:114.18px;top:434.66px" class="cls_039"><span class="cls_039">(Manning, 2012).</span></div>
<div style="position:absolute;left:66.18px;top:459.50px" class="cls_063"><span class="cls_063">8.2.1</span></div>
<div style="position:absolute;left:102.18px;top:459.50px" class="cls_063"><span class="cls_063">Adding RabbitMQ to Spring</span></div>
<div style="position:absolute;left:102.18px;top:477.17px" class="cls_039"><span class="cls_039">Before you can start sending and receiving RabbitMQ messages with Spring, you’ll</span></div>
<div style="position:absolute;left:102.18px;top:490.16px" class="cls_039"><span class="cls_039">need to add Spring Boot’s AMQP starter dependency to your build in place of the</span></div>
<div style="position:absolute;left:102.18px;top:503.18px" class="cls_039"><span class="cls_039">Artemis or ActiveMQ starter you added in the previous section:</span></div>
<div style="position:absolute;left:102.18px;top:522.86px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:111.78px;top:532.85px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:111.78px;top:542.84px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:102.18px;top:552.86px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:102.18px;top:576.17px" class="cls_039"><span class="cls_039">Adding the AMQP starter to your build will trigger autoconfiguration that will create a</span></div>
<div style="position:absolute;left:102.18px;top:589.19px" class="cls_039"><span class="cls_039">AMQP connection factory and </span><span class="cls_059">RabbitTemplate</span><span class="cls_039"> beans, as well as other supporting</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:142632px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background216.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">194</span></div>
<div style="position:absolute;left:179.97px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 8</span></div>
<div style="position:absolute;left:224.10px;top:24.35px" class="cls_055"><span class="cls_055">Sending messages asynchronously</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">components. Simply adding this dependency is all you need to do to start sending and</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">receiving messages from a RabbitMQ broker with Spring. But there are a handful of</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">useful properties you’ll want to know about, listed in table 8.4.</span></div>
<div style="position:absolute;left:93.18px;top:101.33px" class="cls_053"><span class="cls_053">Table 8.4</span></div>
<div style="position:absolute;left:134.91px;top:101.33px" class="cls_053"><span class="cls_053">Properties for configuring the location and credentials of a RabbitMQ broker</span></div>
<div style="position:absolute;left:150.36px;top:122.54px" class="cls_073"><span class="cls_073">Property</span></div>
<div style="position:absolute;left:330.99px;top:122.54px" class="cls_073"><span class="cls_073">Description</span></div>
<div style="position:absolute;left:99.18px;top:142.04px" class="cls_060"><span class="cls_060">spring.rabbitmq.addresses</span></div>
<div style="position:absolute;left:246.78px;top:142.04px" class="cls_074"><span class="cls_074">A comma-separated list of RabbitMQ broker addresses</span></div>
<div style="position:absolute;left:99.18px;top:159.53px" class="cls_060"><span class="cls_060">spring.rabbitmq.host</span></div>
<div style="position:absolute;left:246.78px;top:159.53px" class="cls_074"><span class="cls_074">The broker’s host (defaults to </span><span class="cls_060">localhost</span><span class="cls_074">)</span></div>
<div style="position:absolute;left:99.18px;top:177.05px" class="cls_060"><span class="cls_060">spring.rabbitmq.port</span></div>
<div style="position:absolute;left:246.78px;top:177.05px" class="cls_074"><span class="cls_074">The broker’s port (defaults to </span><span class="cls_060">5672</span><span class="cls_074">)</span></div>
<div style="position:absolute;left:99.18px;top:194.54px" class="cls_060"><span class="cls_060">spring.rabbitmq.username</span></div>
<div style="position:absolute;left:246.78px;top:194.54px" class="cls_074"><span class="cls_074">The username to use to access the broker (optional)</span></div>
<div style="position:absolute;left:99.18px;top:212.03px" class="cls_060"><span class="cls_060">spring.rabbitmq.password</span></div>
<div style="position:absolute;left:246.78px;top:212.03px" class="cls_074"><span class="cls_074">The password to use to access the broker (optional)</span></div>
<div style="position:absolute;left:93.18px;top:242.66px" class="cls_039"><span class="cls_039">For development purposes, you’ll probably have a RabbitMQ broker that doesn’t</span></div>
<div style="position:absolute;left:93.18px;top:255.65px" class="cls_039"><span class="cls_039">require authentication running on your local machine, listening on port 5672. These</span></div>
<div style="position:absolute;left:93.18px;top:268.67px" class="cls_039"><span class="cls_039">properties likely won’t get much use while you’re still in development, but they’ll no</span></div>
<div style="position:absolute;left:93.18px;top:281.66px" class="cls_039"><span class="cls_039">doubt prove useful when your applications move into production.</span></div>
<div style="position:absolute;left:107.90px;top:294.68px" class="cls_039"><span class="cls_039">For example, suppose that as you move into production, your RabbitMQ broker is</span></div>
<div style="position:absolute;left:93.18px;top:307.67px" class="cls_039"><span class="cls_039">on a server named rabbit.tacocloud.com, listening on port 5673, and requiring cre-</span></div>
<div style="position:absolute;left:93.18px;top:320.66px" class="cls_039"><span class="cls_039">dentials. In that case, the following configuration in your application.yml file will set</span></div>
<div style="position:absolute;left:93.18px;top:333.68px" class="cls_039"><span class="cls_039">those properties when the </span><span class="cls_059">prod</span><span class="cls_039"> profile is active:</span></div>
<div style="position:absolute;left:93.18px;top:356.33px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:102.78px;top:366.35px" class="cls_060"><span class="cls_060">profiles: prod</span></div>
<div style="position:absolute;left:102.78px;top:376.34px" class="cls_060"><span class="cls_060">rabbitmq:</span></div>
<div style="position:absolute;left:112.38px;top:386.36px" class="cls_060"><span class="cls_060">host: rabbit.tacocloud.com</span></div>
<div style="position:absolute;left:112.38px;top:396.35px" class="cls_060"><span class="cls_060">port: 5673</span></div>
<div style="position:absolute;left:112.38px;top:406.34px" class="cls_060"><span class="cls_060">username: tacoweb</span></div>
<div style="position:absolute;left:112.38px;top:416.36px" class="cls_061"><span class="cls_061">password: l3tm31n</span></div>
<div style="position:absolute;left:93.18px;top:440.66px" class="cls_039"><span class="cls_039">Now that RabbitMQ is configured in your application, it’s time to start sending mes-</span></div>
<div style="position:absolute;left:93.18px;top:453.68px" class="cls_039"><span class="cls_039">sages with </span><span class="cls_059">RabbitTemplate</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:57.18px;top:479.51px" class="cls_063"><span class="cls_063">8.2.2</span></div>
<div style="position:absolute;left:93.18px;top:479.51px" class="cls_063"><span class="cls_063">Sending messages with RabbitTemplate</span></div>
<div style="position:absolute;left:93.18px;top:497.18px" class="cls_039"><span class="cls_039">At the core of Spring’s support for RabbitMQ messaging is </span><span class="cls_059">RabbitTemplate</span><span class="cls_039">. </span><span class="cls_059">Rabbit-</span></div>
<div style="position:absolute;left:93.18px;top:510.17px" class="cls_059"><span class="cls_059">Template</span><span class="cls_039"> is similar to </span><span class="cls_059">JmsTemplate</span><span class="cls_039">, offering a similar set of methods. As you’ll see,</span></div>
<div style="position:absolute;left:93.18px;top:523.16px" class="cls_039"><span class="cls_039">however, there are some subtle differences that align with the unique way that Rab-</span></div>
<div style="position:absolute;left:93.18px;top:536.18px" class="cls_039"><span class="cls_039">bitMQ works.</span></div>
<div style="position:absolute;left:108.14px;top:549.17px" class="cls_039"><span class="cls_039">With regard to sending messages with </span><span class="cls_059">RabbitTemplate</span><span class="cls_039">, the </span><span class="cls_059">send()</span><span class="cls_039"> and </span><span class="cls_059">convert-</span></div>
<div style="position:absolute;left:93.18px;top:562.19px" class="cls_059"><span class="cls_059">AndSend()</span><span class="cls_039"> methods parallel the same-named methods from </span><span class="cls_059">JmsTemplate</span><span class="cls_039">. But unlike</span></div>
<div style="position:absolute;left:93.18px;top:575.18px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">JmsTemplate</span><span class="cls_039"> methods, which only routed messages to a given queue or topic,</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:143308px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background217.jpg" width="531" height="666"></div>
<div style="position:absolute;left:203.94px;top:24.35px" class="cls_055"><span class="cls_055">Working with RabbitMQ and AMQP</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">195</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_059"><span class="cls_059">RabbitTemplate</span><span class="cls_039"> methods send messages in terms of exchanges and routing keys. Here</span></div>
<div style="position:absolute;left:102.18px;top:63.47px" class="cls_039"><span class="cls_039">are a few of the most relevant methods for sending messages with </span><span class="cls_059">RabbitTemplate:</span><span class="cls_069"><sup>1</sup></span></div>
<div style="position:absolute;left:102.18px;top:83.33px" class="cls_060"><span class="cls_060">// Send raw messages</span></div>
<div style="position:absolute;left:102.18px;top:93.32px" class="cls_060"><span class="cls_060">void send(Message message) throws AmqpException;</span></div>
<div style="position:absolute;left:102.18px;top:103.34px" class="cls_060"><span class="cls_060">void send(String routingKey, Message message) throws AmqpException;</span></div>
<div style="position:absolute;left:102.18px;top:113.33px" class="cls_060"><span class="cls_060">void send(String exchange, String routingKey, Message message)</span></div>
<div style="position:absolute;left:231.75px;top:123.32px" class="cls_060"><span class="cls_060">throws AmqpException;</span></div>
<div style="position:absolute;left:102.18px;top:143.33px" class="cls_060"><span class="cls_060">// Send messages converted from objects</span></div>
<div style="position:absolute;left:102.18px;top:153.35px" class="cls_060"><span class="cls_060">void convertAndSend(Object message) throws AmqpException;</span></div>
<div style="position:absolute;left:102.18px;top:163.34px" class="cls_060"><span class="cls_060">void convertAndSend(String routingKey, Object message)</span></div>
<div style="position:absolute;left:231.75px;top:173.33px" class="cls_060"><span class="cls_060">throws AmqpException;</span></div>
<div style="position:absolute;left:102.18px;top:183.35px" class="cls_060"><span class="cls_060">void convertAndSend(String exchange, String routingKey,</span></div>
<div style="position:absolute;left:198.14px;top:193.34px" class="cls_060"><span class="cls_060">Object message) throws AmqpException;</span></div>
<div style="position:absolute;left:102.18px;top:213.35px" class="cls_060"><span class="cls_060">// Send messages converted from objects with post-processing</span></div>
<div style="position:absolute;left:102.18px;top:223.34px" class="cls_060"><span class="cls_060">void convertAndSend(Object message, MessagePostProcessor mPP)</span></div>
<div style="position:absolute;left:231.75px;top:233.33px" class="cls_060"><span class="cls_060">throws AmqpException;</span></div>
<div style="position:absolute;left:102.18px;top:243.35px" class="cls_060"><span class="cls_060">void convertAndSend(String routingKey, Object message,</span></div>
<div style="position:absolute;left:198.14px;top:253.34px" class="cls_060"><span class="cls_060">MessagePostProcessor messagePostProcessor)</span></div>
<div style="position:absolute;left:198.14px;top:263.33px" class="cls_060"><span class="cls_060">throws AmqpException;</span></div>
<div style="position:absolute;left:102.18px;top:273.35px" class="cls_060"><span class="cls_060">void convertAndSend(String exchange, String routingKey,</span></div>
<div style="position:absolute;left:198.14px;top:283.34px" class="cls_060"><span class="cls_060">Object message,</span></div>
<div style="position:absolute;left:198.14px;top:293.33px" class="cls_060"><span class="cls_060">MessagePostProcessor messagePostProcessor)</span></div>
<div style="position:absolute;left:198.14px;top:303.35px" class="cls_061"><span class="cls_061">throws AmqpException;</span></div>
<div style="position:absolute;left:102.18px;top:324.68px" class="cls_039"><span class="cls_039">As you can see, these methods follow a similar pattern to their twins in </span><span class="cls_059">JmsTemplate</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:102.18px;top:337.67px" class="cls_039"><span class="cls_039">The first three </span><span class="cls_059">send()</span><span class="cls_039"> methods all send a raw </span><span class="cls_059">Message</span><span class="cls_039"> object. The next three</span></div>
<div style="position:absolute;left:102.18px;top:350.66px" class="cls_059"><span class="cls_059">convertAndSend()</span><span class="cls_039"> methods accept an object that will be converted to a </span><span class="cls_059">Message</span></div>
<div style="position:absolute;left:102.18px;top:363.68px" class="cls_039"><span class="cls_039">behind the scenes before being sent. The final three </span><span class="cls_059">convertAndSend()</span><span class="cls_039"> methods are</span></div>
<div style="position:absolute;left:102.18px;top:376.67px" class="cls_039"><span class="cls_039">like the previous three, but they accept a </span><span class="cls_059">MessagePostProcessor</span><span class="cls_039"> that can be used to</span></div>
<div style="position:absolute;left:102.18px;top:389.66px" class="cls_039"><span class="cls_039">manipulate the </span><span class="cls_059">Message</span><span class="cls_039"> object before it’s sent to the broker.</span></div>
<div style="position:absolute;left:118.30px;top:402.68px" class="cls_039"><span class="cls_039">These methods differ from their </span><span class="cls_059">JmsTemplate</span><span class="cls_039"> counterparts in that they accept</span></div>
<div style="position:absolute;left:102.18px;top:415.67px" class="cls_059"><span class="cls_059">String</span><span class="cls_039"> values to specify an exchange and routing key, rather than a destination name</span></div>
<div style="position:absolute;left:102.18px;top:428.66px" class="cls_039"><span class="cls_039">(or </span><span class="cls_059">Destination</span><span class="cls_039"> object). The methods that don’t take an exchange will have their</span></div>
<div style="position:absolute;left:102.18px;top:441.68px" class="cls_039"><span class="cls_039">messages sent to the default exchange. Likewise, the methods that don’t take a rout-</span></div>
<div style="position:absolute;left:102.18px;top:454.67px" class="cls_039"><span class="cls_039">ing key will have their messages routed with a default routing key.</span></div>
<div style="position:absolute;left:116.76px;top:467.66px" class="cls_039"><span class="cls_039">Let’s put </span><span class="cls_059">RabbitTemplate</span><span class="cls_039"> to work sending taco orders. One way you can do that is</span></div>
<div style="position:absolute;left:102.18px;top:480.68px" class="cls_039"><span class="cls_039">by using the </span><span class="cls_059">send()</span><span class="cls_039"> method, as shown in listing 8.5. But before you can call </span><span class="cls_059">send()</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:102.18px;top:493.67px" class="cls_039"><span class="cls_039">you’ll need to convert an </span><span class="cls_059">Order</span><span class="cls_039"> object to a </span><span class="cls_059">Message</span><span class="cls_039">. That could be a tedious job, if not</span></div>
<div style="position:absolute;left:102.18px;top:506.66px" class="cls_039"><span class="cls_039">for the fact that </span><span class="cls_059">RabbitTemplate</span><span class="cls_039"> makes its message converter readily available with a</span></div>
<div style="position:absolute;left:102.18px;top:519.68px" class="cls_059"><span class="cls_059">getMessageConverter()</span><span class="cls_039"> method.</span></div>
<div style="position:absolute;left:66.18px;top:592.49px" class="cls_070"><span class="cls_070">1</span></div>
<div style="position:absolute;left:75.18px;top:592.67px" class="cls_071"><span class="cls_071">These methods are defined by </span><span class="cls_060">AmqpTemplate</span><span class="cls_071">, an interface implemented by </span><span class="cls_060">RabbitTemplate</span><span class="cls_071">.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:143984px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background218.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">196</span></div>
<div style="position:absolute;left:179.97px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 8</span></div>
<div style="position:absolute;left:224.10px;top:24.35px" class="cls_055"><span class="cls_055">Sending messages asynchronously</span></div>
<div style="position:absolute;left:105.18px;top:54.65px" class="cls_066"><span class="cls_066">Listing 8.5</span></div>
<div style="position:absolute;left:157.26px;top:54.26px" class="cls_066"><span class="cls_066">Sending a message with </span><span class="cls_077">RabbitTemplate.send()</span></div>
<div style="position:absolute;left:93.18px;top:73.64px" class="cls_060"><span class="cls_060">package tacos.messaging;</span></div>
<div style="position:absolute;left:93.18px;top:83.63px" class="cls_060"><span class="cls_060">import org.springframework.amqp.core.Message;</span></div>
<div style="position:absolute;left:93.18px;top:93.62px" class="cls_060"><span class="cls_060">import org.springframework.amqp.core.MessageProperties;</span></div>
<div style="position:absolute;left:93.18px;top:103.64px" class="cls_060"><span class="cls_060">import org.springframework.amqp.rabbit.core.RabbitTemplate;</span></div>
<div style="position:absolute;left:93.18px;top:113.63px" class="cls_060"><span class="cls_060">import</span></div>
<div style="position:absolute;left:107.58px;top:123.62px" class="cls_060"><span class="cls_060">org.springframework.amqp.support.converter.MessageConverter;</span></div>
<div style="position:absolute;left:93.18px;top:133.64px" class="cls_060"><span class="cls_060">import org.springframework.beans.factory.annotation.Autowired;</span></div>
<div style="position:absolute;left:93.18px;top:143.63px" class="cls_060"><span class="cls_060">import org.springframework.stereotype.Service;</span></div>
<div style="position:absolute;left:93.18px;top:153.65px" class="cls_060"><span class="cls_060">import tacos.Order;</span></div>
<div style="position:absolute;left:93.18px;top:176.63px" class="cls_060"><span class="cls_060">@Service</span></div>
<div style="position:absolute;left:93.18px;top:186.65px" class="cls_060"><span class="cls_060">public class RabbitOrderMessagingService</span></div>
<div style="position:absolute;left:126.76px;top:196.64px" class="cls_060"><span class="cls_060">implements OrderMessagingService {</span></div>
<div style="position:absolute;left:102.78px;top:206.63px" class="cls_060"><span class="cls_060">private RabbitTemplate rabbit;</span></div>
<div style="position:absolute;left:102.78px;top:229.64px" class="cls_060"><span class="cls_060">@Autowired</span></div>
<div style="position:absolute;left:102.78px;top:239.63px" class="cls_060"><span class="cls_060">public RabbitOrderMessagingService(RabbitTemplate rabbit) {</span></div>
<div style="position:absolute;left:112.38px;top:249.65px" class="cls_060"><span class="cls_060">this.rabbit = rabbit;</span></div>
<div style="position:absolute;left:102.78px;top:259.64px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.77px;top:282.65px" class="cls_060"><span class="cls_060">public void sendOrder(Order order) {</span></div>
<div style="position:absolute;left:112.38px;top:292.64px" class="cls_060"><span class="cls_060">MessageConverter converter = rabbit.getMessageConverter();</span></div>
<div style="position:absolute;left:112.37px;top:302.63px" class="cls_060"><span class="cls_060">MessageProperties props = new MessageProperties();</span></div>
<div style="position:absolute;left:112.38px;top:312.65px" class="cls_060"><span class="cls_060">Message message = converter.toMessage(order, props);</span></div>
<div style="position:absolute;left:112.38px;top:322.64px" class="cls_060"><span class="cls_060">rabbit.send("tacocloud.order", message);</span></div>
<div style="position:absolute;left:102.78px;top:332.63px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:342.65px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:366.98px" class="cls_039"><span class="cls_039">Once you have a </span><span class="cls_059">MessageConverter</span><span class="cls_039"> in hand, it’s simple work to convert an </span><span class="cls_059">Order</span><span class="cls_039"> to a</span></div>
<div style="position:absolute;left:93.18px;top:379.97px" class="cls_059"><span class="cls_059">Message</span><span class="cls_039">. You must supply any message properties with a </span><span class="cls_059">MessageProperties</span><span class="cls_039">, but if</span></div>
<div style="position:absolute;left:93.18px;top:392.96px" class="cls_039"><span class="cls_039">you don’t need to set any such properties, a default instance of </span><span class="cls_059">MessageProperties</span><span class="cls_039"> is</span></div>
<div style="position:absolute;left:93.18px;top:405.98px" class="cls_039"><span class="cls_039">fine. Then, all that’s left is to call </span><span class="cls_059">send()</span><span class="cls_039">, passing in the exchange and routing key</span></div>
<div style="position:absolute;left:93.18px;top:418.97px" class="cls_039"><span class="cls_039">(both of which are optional) along with the message. In this example, you’re specify-</span></div>
<div style="position:absolute;left:93.18px;top:431.96px" class="cls_039"><span class="cls_039">ing only the routing key—</span><span class="cls_059">tacocloud.order</span><span class="cls_039">—along with the message, so the default</span></div>
<div style="position:absolute;left:93.18px;top:444.98px" class="cls_039"><span class="cls_039">exchange will be used.</span></div>
<div style="position:absolute;left:110.45px;top:457.97px" class="cls_039"><span class="cls_039">Speaking of default exchanges, the default exchange name is </span><span class="cls_059">""</span><span class="cls_039"> (an empty</span></div>
<div style="position:absolute;left:93.18px;top:470.96px" class="cls_059"><span class="cls_059">String</span><span class="cls_039">), which corresponds to the default exchange that’s automatically created by</span></div>
<div style="position:absolute;left:93.18px;top:483.98px" class="cls_039"><span class="cls_039">the RabbitMQ broker. Likewise, the default routing key is </span><span class="cls_059">""</span><span class="cls_039"> (whose routing is depen-</span></div>
<div style="position:absolute;left:93.18px;top:496.97px" class="cls_039"><span class="cls_039">dent upon the exchange and bindings in question). You can override these defaults by</span></div>
<div style="position:absolute;left:93.18px;top:509.96px" class="cls_039"><span class="cls_039">setting the </span><span class="cls_059">spring.rabbitmq.template.exchange</span><span class="cls_039"> and </span><span class="cls_059">spring.rabbitmq.template</span></div>
<div style="position:absolute;left:93.18px;top:522.98px" class="cls_059"><span class="cls_059">.routing-key</span><span class="cls_039"> properties:</span></div>
<div style="position:absolute;left:93.18px;top:545.66px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:102.78px;top:555.65px" class="cls_060"><span class="cls_060">rabbitmq:</span></div>
<div style="position:absolute;left:112.38px;top:565.64px" class="cls_060"><span class="cls_060">template:</span></div>
<div style="position:absolute;left:121.95px;top:575.66px" class="cls_060"><span class="cls_060">exchange: tacocloud.orders</span></div>
<div style="position:absolute;left:121.95px;top:585.65px" class="cls_061"><span class="cls_061">routing-key: kitchens.central</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:144660px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background219.jpg" width="531" height="666"></div>
<div style="position:absolute;left:203.94px;top:24.35px" class="cls_055"><span class="cls_055">Working with RabbitMQ and AMQP</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">197</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">In this case, all messages sent without specifying an exchange will automatically be</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">sent to the exchange whose name is </span><span class="cls_059">tacocloud.orders</span><span class="cls_039">. If the routing key is also</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">unspecified in the call to </span><span class="cls_059">send()</span><span class="cls_039"> or </span><span class="cls_059">convertAndSend()</span><span class="cls_039">, the messages will have a rout-</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">ing key of </span><span class="cls_059">kitchens.central</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:116.66px;top:102.65px" class="cls_039"><span class="cls_039">Creating a </span><span class="cls_059">Message</span><span class="cls_039"> object from the message converter is easy enough, but it’s even</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">easier to use </span><span class="cls_059">convertAndSend()</span><span class="cls_039"> to let </span><span class="cls_059">RabbitTemplate</span><span class="cls_039"> handle all of the conversion</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">work for you:</span></div>
<div style="position:absolute;left:102.18px;top:148.34px" class="cls_060"><span class="cls_060">public void sendOrder(Order order) {</span></div>
<div style="position:absolute;left:111.78px;top:158.33px" class="cls_060"><span class="cls_060">rabbit.convertAndSend("tacocloud.order", order);</span></div>
<div style="position:absolute;left:102.18px;top:168.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:189.83px" class="cls_064"><span class="cls_064">C</span><span class="cls_065">ONFIGURING</span><span class="cls_064"> </span><span class="cls_065">A</span><span class="cls_064"> </span><span class="cls_065">MESSAGE</span><span class="cls_064"> </span><span class="cls_065">CONVERTER</span></div>
<div style="position:absolute;left:102.18px;top:202.16px" class="cls_039"><span class="cls_039">By default, message conversion is performed with </span><span class="cls_059">SimpleMessageConverter</span><span class="cls_039">, which is</span></div>
<div style="position:absolute;left:102.18px;top:215.15px" class="cls_039"><span class="cls_039">able to convert simple types (like </span><span class="cls_059">String</span><span class="cls_039">) and </span><span class="cls_059">Serializable</span><span class="cls_039"> objects to </span><span class="cls_059">Message</span></div>
<div style="position:absolute;left:102.18px;top:228.17px" class="cls_039"><span class="cls_039">objects. But Spring offers several message converters for </span><span class="cls_059">RabbitTemplate</span><span class="cls_039">, including</span></div>
<div style="position:absolute;left:102.18px;top:241.16px" class="cls_039"><span class="cls_039">the following:</span></div>
<div style="position:absolute;left:117.78px;top:258.17px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> Jackson2JsonMessageConverter</span><span class="cls_039">—Converts objects to and from JSON using</span></div>
<div style="position:absolute;left:129.78px;top:271.16px" class="cls_039"><span class="cls_039">the Jackson 2 JSON processor</span></div>
<div style="position:absolute;left:117.78px;top:285.17px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> MarshallingMessageConverte</span><span class="cls_039">r—Converts  using  a  Spring  Marshaller  and</span></div>
<div style="position:absolute;left:129.78px;top:298.16px" class="cls_039"><span class="cls_039">Unmarshaller</span></div>
<div style="position:absolute;left:117.78px;top:312.17px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> SerializerMessageConverter</span><span class="cls_039">—Converts </span><span class="cls_059">String</span><span class="cls_039"> and native objects of any</span></div>
<div style="position:absolute;left:129.78px;top:325.16px" class="cls_039"><span class="cls_039">kind using Spring’s </span><span class="cls_059">Serializer</span><span class="cls_039"> and </span><span class="cls_059">Deserializer</span><span class="cls_039"> abstractions</span></div>
<div style="position:absolute;left:117.78px;top:339.17px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> SimpleMessageConverter</span><span class="cls_039">—Converts String, byte arrays, and Serializable types</span></div>
<div style="position:absolute;left:117.78px;top:353.18px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> ContentTypeDelegatingMessageConverter</span><span class="cls_039">—Delegates to another </span><span class="cls_059">Message-</span></div>
<div style="position:absolute;left:129.78px;top:366.17px" class="cls_059"><span class="cls_059">Converter</span><span class="cls_039"> based on the </span><span class="cls_059">contentType</span><span class="cls_039"> header</span></div>
<div style="position:absolute;left:117.78px;top:380.18px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> MessagingMessageConverter</span><span class="cls_039">—Delegates to an underlying </span><span class="cls_059">MessageConverter</span></div>
<div style="position:absolute;left:129.78px;top:393.17px" class="cls_039"><span class="cls_039">for the message conversion and to an </span><span class="cls_059">AmqpHeaderConverter</span><span class="cls_039"> for the headers</span></div>
<div style="position:absolute;left:102.18px;top:411.17px" class="cls_039"><span class="cls_039">If you need to change the message converter, all you need to do is configure a bean of</span></div>
<div style="position:absolute;left:102.18px;top:424.16px" class="cls_039"><span class="cls_039">type </span><span class="cls_059">MessageConverter</span><span class="cls_039">. For example, for JSON-based message conversion, you can</span></div>
<div style="position:absolute;left:102.18px;top:437.18px" class="cls_039"><span class="cls_039">configure a </span><span class="cls_059">Jackson2JsonMessageConverter</span><span class="cls_039"> like this:</span></div>
<div style="position:absolute;left:102.18px;top:456.86px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:102.18px;top:466.85px" class="cls_060"><span class="cls_060">public MessageConverter messageConverter() {</span></div>
<div style="position:absolute;left:111.78px;top:476.84px" class="cls_060"><span class="cls_060">return new Jackson2JsonMessageConverter();</span></div>
<div style="position:absolute;left:102.18px;top:486.86px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:508.16px" class="cls_039"><span class="cls_039">Spring Boot autoconfiguration will discover this bean and inject it into </span><span class="cls_059">RabbitTem-</span></div>
<div style="position:absolute;left:102.18px;top:521.18px" class="cls_059"><span class="cls_059">plate</span><span class="cls_039"> in place of the default message converter.</span></div>
<div style="position:absolute;left:102.18px;top:539.36px" class="cls_064"><span class="cls_064">S</span><span class="cls_065">ETTING</span><span class="cls_064"> </span><span class="cls_065">MESSAGE</span><span class="cls_064"> </span><span class="cls_065">PROPERTIES</span></div>
<div style="position:absolute;left:102.18px;top:551.69px" class="cls_039"><span class="cls_039">As with JMS, you may need to set some headers in the messages you send. For exam-</span></div>
<div style="position:absolute;left:102.18px;top:564.68px" class="cls_039"><span class="cls_039">ple, let’s say you need to send an </span><span class="cls_059">X_ORDER_SOURCE</span><span class="cls_039"> for all orders submitted through</span></div>
<div style="position:absolute;left:102.18px;top:577.67px" class="cls_039"><span class="cls_039">the Taco Cloud website. When creating your own </span><span class="cls_059">Message</span><span class="cls_039"> objects, you can set the</span></div>
<div style="position:absolute;left:102.18px;top:590.69px" class="cls_039"><span class="cls_039">header through the </span><span class="cls_059">MessageProperties</span><span class="cls_039"> instance you give to the message converter.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:145336px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background220.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">198</span></div>
<div style="position:absolute;left:179.97px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 8</span></div>
<div style="position:absolute;left:224.10px;top:24.35px" class="cls_055"><span class="cls_055">Sending messages asynchronously</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">Revisiting the </span><span class="cls_059">sendOrder()</span><span class="cls_039"> method from listing 8.5, you only need one additional line</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">of code to set the header:</span></div>
<div style="position:absolute;left:93.18px;top:86.33px" class="cls_060"><span class="cls_060">public void sendOrder(Order order) {</span></div>
<div style="position:absolute;left:102.78px;top:96.32px" class="cls_060"><span class="cls_060">MessageConverter converter = rabbit.getMessageConverter();</span></div>
<div style="position:absolute;left:102.78px;top:106.34px" class="cls_060"><span class="cls_060">MessageProperties props = new MessageProperties();</span></div>
<div style="position:absolute;left:102.78px;top:116.33px" class="cls_060"><span class="cls_060">props.setHeader("X_ORDER_SOURCE", "WEB");</span></div>
<div style="position:absolute;left:102.78px;top:126.35px" class="cls_060"><span class="cls_060">Message message = converter.toMessage(order, props);</span></div>
<div style="position:absolute;left:102.78px;top:136.34px" class="cls_060"><span class="cls_060">rabbit.send("tacocloud.order", message);</span></div>
<div style="position:absolute;left:93.18px;top:146.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:169.67px" class="cls_039"><span class="cls_039">When using </span><span class="cls_059">convertAndSend()</span><span class="cls_039">, however, you don’t have quick access to the </span><span class="cls_059">Message-</span></div>
<div style="position:absolute;left:93.18px;top:182.66px" class="cls_059"><span class="cls_059">Properties</span><span class="cls_039"> object. A </span><span class="cls_059">MessagePostProcessor</span><span class="cls_039"> can help you with that, though:</span></div>
<div style="position:absolute;left:93.18px;top:205.34px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:93.18px;top:215.33px" class="cls_060"><span class="cls_060">public void sendOrder(Order order) {</span></div>
<div style="position:absolute;left:102.78px;top:225.35px" class="cls_060"><span class="cls_060">rabbit.convertAndSend("tacocloud.order.queue", order,</span></div>
<div style="position:absolute;left:121.96px;top:235.34px" class="cls_060"><span class="cls_060">new MessagePostProcessor() {</span></div>
<div style="position:absolute;left:131.55px;top:245.33px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:131.56px;top:255.35px" class="cls_060"><span class="cls_060">public Message postProcessMessage(Message message)</span></div>
<div style="position:absolute;left:150.76px;top:265.34px" class="cls_060"><span class="cls_060">throws AmqpException {</span></div>
<div style="position:absolute;left:141.16px;top:275.33px" class="cls_060"><span class="cls_060">MessageProperties props = message.getMessageProperties();</span></div>
<div style="position:absolute;left:141.15px;top:285.35px" class="cls_060"><span class="cls_060">props.setHeader("X_ORDER_SOURCE", "WEB");</span></div>
<div style="position:absolute;left:141.13px;top:295.34px" class="cls_060"><span class="cls_060">return message;</span></div>
<div style="position:absolute;left:131.55px;top:305.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.78px;top:315.35px" class="cls_060"><span class="cls_060">});</span></div>
<div style="position:absolute;left:93.18px;top:325.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:348.68px" class="cls_039"><span class="cls_039">Here you supply </span><span class="cls_059">convertAndSend()</span><span class="cls_039"> with an anonymous inner-class implementation</span></div>
<div style="position:absolute;left:93.18px;top:361.67px" class="cls_039"><span class="cls_039">of </span><span class="cls_059">MessagePostProcessor</span><span class="cls_039">. In the </span><span class="cls_059">postProcessMessage()</span><span class="cls_039"> method, you pull the</span></div>
<div style="position:absolute;left:93.18px;top:374.66px" class="cls_059"><span class="cls_059">MessageProperties</span><span class="cls_039"> from the </span><span class="cls_059">Message</span><span class="cls_039"> and then call </span><span class="cls_059">setHeader()</span><span class="cls_039"> to set the </span><span class="cls_059">X_ORDER</span></div>
<div style="position:absolute;left:93.18px;top:387.68px" class="cls_059"><span class="cls_059">_SOURCE</span><span class="cls_039"> header.</span></div>
<div style="position:absolute;left:108.03px;top:400.67px" class="cls_039"><span class="cls_039">Now that you’ve seen how to send messages with </span><span class="cls_059">RabbitTemplate</span><span class="cls_039">, let’s switch our</span></div>
<div style="position:absolute;left:93.18px;top:413.66px" class="cls_039"><span class="cls_039">focus over to the code that receives messages from a RabbitMQ queue.</span></div>
<div style="position:absolute;left:57.18px;top:439.49px" class="cls_063"><span class="cls_063">8.2.3</span></div>
<div style="position:absolute;left:93.18px;top:439.49px" class="cls_063"><span class="cls_063">Receiving message from RabbitMQ</span></div>
<div style="position:absolute;left:93.18px;top:457.16px" class="cls_039"><span class="cls_039">You’ve seen that sending messages with </span><span class="cls_059">RabbitTemplate</span><span class="cls_039"> doesn’t differ much from</span></div>
<div style="position:absolute;left:93.18px;top:470.18px" class="cls_039"><span class="cls_039">sending messages with </span><span class="cls_059">JmsTemplate</span><span class="cls_039">. And as it turns out, receiving messages from a</span></div>
<div style="position:absolute;left:93.18px;top:483.17px" class="cls_039"><span class="cls_039">RabbitMQ queue isn’t very different than from JMS.</span></div>
<div style="position:absolute;left:107.79px;top:496.16px" class="cls_039"><span class="cls_039">As with JMS, you have two choices:</span></div>
<div style="position:absolute;left:108.78px;top:513.17px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Pulling messages from a queue with </span><span class="cls_059">RabbitTemplate</span></div>
<div style="position:absolute;left:108.78px;top:527.18px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Having messages pushed to a </span><span class="cls_059">@RabbitListener</span><span class="cls_039">-annotated method</span></div>
<div style="position:absolute;left:93.18px;top:545.18px" class="cls_039"><span class="cls_039">Let’s start by looking at the pull-based </span><span class="cls_059">RabbitTemplate.receive()</span><span class="cls_039"> method.</span></div>
<div style="position:absolute;left:93.18px;top:563.36px" class="cls_064"><span class="cls_064">R</span><span class="cls_065">ECEIVING</span><span class="cls_064"> </span><span class="cls_065">MESSAGES</span><span class="cls_064"> </span><span class="cls_065">WITH</span><span class="cls_064"> R</span><span class="cls_065">ABBIT</span><span class="cls_064">T</span><span class="cls_065">EMPLATE</span></div>
<div style="position:absolute;left:93.18px;top:575.69px" class="cls_059"><span class="cls_059">RabbitTemplate</span><span class="cls_039"> comes with several methods for pulling messages from a queue. A</span></div>
<div style="position:absolute;left:93.18px;top:588.68px" class="cls_039"><span class="cls_039">few of the most useful ones are listed here:</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:146012px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background221.jpg" width="531" height="666"></div>
<div style="position:absolute;left:203.94px;top:24.35px" class="cls_055"><span class="cls_055">Working with RabbitMQ and AMQP</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">199</span></div>
<div style="position:absolute;left:102.18px;top:51.32px" class="cls_060"><span class="cls_060">// Receive messages</span></div>
<div style="position:absolute;left:102.18px;top:61.34px" class="cls_060"><span class="cls_060">Message receive() throws AmqpException;</span></div>
<div style="position:absolute;left:102.18px;top:71.33px" class="cls_060"><span class="cls_060">Message receive(String queueName) throws AmqpException;</span></div>
<div style="position:absolute;left:102.18px;top:81.32px" class="cls_060"><span class="cls_060">Message receive(long timeoutMillis) throws AmqpException;</span></div>
<div style="position:absolute;left:102.18px;top:91.34px" class="cls_060"><span class="cls_060">Message receive(String queueName, long timeoutMillis) throws AmqpException;</span></div>
<div style="position:absolute;left:102.18px;top:114.32px" class="cls_060"><span class="cls_060">// Receive objects converted from messages</span></div>
<div style="position:absolute;left:102.18px;top:124.34px" class="cls_060"><span class="cls_060">Object receiveAndConvert() throws AmqpException;</span></div>
<div style="position:absolute;left:102.18px;top:134.33px" class="cls_060"><span class="cls_060">Object receiveAndConvert(String queueName) throws AmqpException;</span></div>
<div style="position:absolute;left:102.18px;top:144.35px" class="cls_060"><span class="cls_060">Object receiveAndConvert(long timeoutMillis) throws AmqpException;</span></div>
<div style="position:absolute;left:102.18px;top:154.34px" class="cls_060"><span class="cls_060">Object receiveAndConvert(String queueName, long timeoutMillis) throws</span></div>
<div style="position:absolute;left:126.18px;top:164.33px" class="cls_060"><span class="cls_060">AmqpException;</span></div>
<div style="position:absolute;left:102.18px;top:187.34px" class="cls_060"><span class="cls_060">// Receive type-safe objects converted from messages</span></div>
<div style="position:absolute;left:102.18px;top:197.33px" class="cls_060"><span class="cls_060">&lt;T&gt; T receiveAndConvert(ParameterizedTypeReference&lt;T&gt; type) throws</span></div>
<div style="position:absolute;left:126.18px;top:207.35px" class="cls_060"><span class="cls_060">AmqpException;</span></div>
<div style="position:absolute;left:102.18px;top:217.34px" class="cls_060"><span class="cls_060">&lt;T&gt; T receiveAndConvert(String queueName, ParameterizedTypeReference&lt;T&gt; type)</span></div>
<div style="position:absolute;left:126.18px;top:227.33px" class="cls_060"><span class="cls_060">throws AmqpException;</span></div>
<div style="position:absolute;left:102.18px;top:237.35px" class="cls_060"><span class="cls_060">&lt;T&gt; T receiveAndConvert(long timeoutMillis, ParameterizedTypeReference&lt;T&gt;</span></div>
<div style="position:absolute;left:126.18px;top:247.34px" class="cls_060"><span class="cls_060">type) throws AmqpException;</span></div>
<div style="position:absolute;left:102.18px;top:257.33px" class="cls_060"><span class="cls_060">&lt;T&gt; T receiveAndConvert(String queueName, long timeoutMillis,</span></div>
<div style="position:absolute;left:126.18px;top:267.35px" class="cls_060"><span class="cls_060">ParameterizedTypeReference&lt;T&gt; type)</span></div>
<div style="position:absolute;left:121.38px;top:277.34px" class="cls_061"><span class="cls_061">throws AmqpException;</span></div>
<div style="position:absolute;left:102.18px;top:301.67px" class="cls_039"><span class="cls_039">These methods are the mirror images of the </span><span class="cls_059">send()</span><span class="cls_039"> and </span><span class="cls_059">convertAndSend()</span><span class="cls_039"> methods</span></div>
<div style="position:absolute;left:102.18px;top:314.66px" class="cls_039"><span class="cls_039">described earlier. Whereas </span><span class="cls_059">send()</span><span class="cls_039"> is used to send raw </span><span class="cls_059">Message</span><span class="cls_039"> objects, </span><span class="cls_059">receive()</span></div>
<div style="position:absolute;left:102.18px;top:327.68px" class="cls_039"><span class="cls_039">receives raw </span><span class="cls_059">Message</span><span class="cls_039"> objects from a queue. Likewise, </span><span class="cls_059">receiveAndConvert()</span><span class="cls_039"> receives</span></div>
<div style="position:absolute;left:102.18px;top:340.67px" class="cls_039"><span class="cls_039">messages and uses a message converter to convert them into domain objects before</span></div>
<div style="position:absolute;left:102.18px;top:353.66px" class="cls_039"><span class="cls_039">returning them.</span></div>
<div style="position:absolute;left:117.77px;top:366.68px" class="cls_039"><span class="cls_039">But there are a few obvious differences in the method signatures. First, none of</span></div>
<div style="position:absolute;left:102.18px;top:379.67px" class="cls_039"><span class="cls_039">these methods take an exchange or routing key as a parameter. That’s because</span></div>
<div style="position:absolute;left:102.18px;top:392.66px" class="cls_039"><span class="cls_039">exchanges and routing keys are used to route messages to queues, but once the mes-</span></div>
<div style="position:absolute;left:102.18px;top:405.68px" class="cls_039"><span class="cls_039">sages are in the queue, their next destination is the consumer who pulls them off the</span></div>
<div style="position:absolute;left:102.18px;top:418.67px" class="cls_039"><span class="cls_039">queue. Consuming applications needn’t concern themselves with exchanges or rout-</span></div>
<div style="position:absolute;left:102.18px;top:431.66px" class="cls_039"><span class="cls_039">ing keys. A queue is the only thing the consuming applications need to know about.</span></div>
<div style="position:absolute;left:117.00px;top:444.68px" class="cls_039"><span class="cls_039">You’ll also notice that many of the methods accept a </span><span class="cls_059">long</span><span class="cls_039"> parameter to indicate a</span></div>
<div style="position:absolute;left:102.18px;top:457.67px" class="cls_039"><span class="cls_039">timeout for receiving the messages. By default, the receive timeout is 0 milliseconds.</span></div>
<div style="position:absolute;left:102.18px;top:470.66px" class="cls_039"><span class="cls_039">That is, a call to </span><span class="cls_059">receive()</span><span class="cls_039"> will return immediately, potentially with a </span><span class="cls_059">null</span><span class="cls_039"> value if no</span></div>
<div style="position:absolute;left:102.18px;top:483.68px" class="cls_039"><span class="cls_039">messages are available. This is a marked difference from how the </span><span class="cls_059">receive()</span><span class="cls_039"> methods</span></div>
<div style="position:absolute;left:102.18px;top:496.67px" class="cls_039"><span class="cls_039">behave in </span><span class="cls_059">JmsTemplate</span><span class="cls_039">. By passing in a timeout value, you can have the </span><span class="cls_059">receive()</span></div>
<div style="position:absolute;left:102.18px;top:509.66px" class="cls_039"><span class="cls_039">and </span><span class="cls_059">receiveAndConvert()</span><span class="cls_039"> methods block until a message arrives or until the timeout</span></div>
<div style="position:absolute;left:102.18px;top:522.68px" class="cls_039"><span class="cls_039">expires. But even with a non-zero timeout, your code will need to be ready to deal with</span></div>
<div style="position:absolute;left:102.18px;top:535.67px" class="cls_039"><span class="cls_039">a </span><span class="cls_059">null</span><span class="cls_039"> return.</span></div>
<div style="position:absolute;left:116.76px;top:548.66px" class="cls_039"><span class="cls_039">Let’s see how you can put this in action. The next listing shows a new Rabbit-based</span></div>
<div style="position:absolute;left:102.18px;top:561.68px" class="cls_039"><span class="cls_039">implementation of </span><span class="cls_059">OrderReceiver</span><span class="cls_039"> that uses </span><span class="cls_059">RabbitTemplate</span><span class="cls_039"> to receive orders.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:146688px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background222.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">200</span></div>
<div style="position:absolute;left:179.97px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 8</span></div>
<div style="position:absolute;left:224.10px;top:24.35px" class="cls_055"><span class="cls_055">Sending messages asynchronously</span></div>
<div style="position:absolute;left:105.18px;top:54.65px" class="cls_066"><span class="cls_066">Listing 8.6</span></div>
<div style="position:absolute;left:157.26px;top:54.26px" class="cls_066"><span class="cls_066">Pulling orders from RabbitMQ with </span><span class="cls_077">RabbitTemplate</span></div>
<div style="position:absolute;left:93.18px;top:74.63px" class="cls_060"><span class="cls_060">package tacos.kitchen.messaging.rabbit;</span></div>
<div style="position:absolute;left:93.18px;top:84.62px" class="cls_060"><span class="cls_060">import org.springframework.amqp.core.Message;</span></div>
<div style="position:absolute;left:93.18px;top:94.64px" class="cls_060"><span class="cls_060">import org.springframework.amqp.rabbit.core.RabbitTemplate;</span></div>
<div style="position:absolute;left:93.18px;top:104.63px" class="cls_060"><span class="cls_060">import org.springframework.amqp.support.converter.MessageConverter;</span></div>
<div style="position:absolute;left:93.18px;top:114.62px" class="cls_060"><span class="cls_060">import org.springframework.beans.factory.annotation.Autowired;</span></div>
<div style="position:absolute;left:93.18px;top:124.64px" class="cls_060"><span class="cls_060">import org.springframework.stereotype.Component;</span></div>
<div style="position:absolute;left:93.18px;top:144.65px" class="cls_060"><span class="cls_060">@Component</span></div>
<div style="position:absolute;left:93.18px;top:154.64px" class="cls_060"><span class="cls_060">public class RabbitOrderReceiver {</span></div>
<div style="position:absolute;left:102.78px;top:164.63px" class="cls_060"><span class="cls_060">private RabbitTemplate rabbit;</span></div>
<div style="position:absolute;left:102.78px;top:174.65px" class="cls_060"><span class="cls_060">private MessageConverter converter;</span></div>
<div style="position:absolute;left:102.78px;top:194.63px" class="cls_060"><span class="cls_060">@Autowired</span></div>
<div style="position:absolute;left:102.78px;top:204.65px" class="cls_060"><span class="cls_060">public RabbitOrderReceiver(RabbitTemplate rabbit) {</span></div>
<div style="position:absolute;left:112.38px;top:214.64px" class="cls_060"><span class="cls_060">this.rabbit = rabbit;</span></div>
<div style="position:absolute;left:112.38px;top:224.63px" class="cls_060"><span class="cls_060">this.converter = rabbit.getMessageConverter();</span></div>
<div style="position:absolute;left:102.78px;top:234.65px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.77px;top:254.63px" class="cls_060"><span class="cls_060">public Order receiveOrder() {</span></div>
<div style="position:absolute;left:112.38px;top:264.65px" class="cls_060"><span class="cls_060">Message message = rabbit.receive("tacocloud.orders");</span></div>
<div style="position:absolute;left:112.38px;top:274.64px" class="cls_060"><span class="cls_060">return message != null</span></div>
<div style="position:absolute;left:145.97px;top:284.63px" class="cls_060"><span class="cls_060">? (Order) converter.fromMessage(message)</span></div>
<div style="position:absolute;left:145.95px;top:294.65px" class="cls_060"><span class="cls_060">: null;</span></div>
<div style="position:absolute;left:102.78px;top:304.64px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:314.63px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:337.97px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">receiveOrder()</span><span class="cls_039"> method is where all of the action takes place. It makes a call to</span></div>
<div style="position:absolute;left:93.18px;top:350.96px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">receive()</span><span class="cls_039"> method on the injected </span><span class="cls_059">RabbitTemplate</span><span class="cls_039"> to pull an order from the</span></div>
<div style="position:absolute;left:93.18px;top:363.98px" class="cls_059"><span class="cls_059">tacocloud.orders</span><span class="cls_039"> queue. It provides no timeout value, so you can only assume that</span></div>
<div style="position:absolute;left:93.18px;top:376.97px" class="cls_039"><span class="cls_039">the call returns immediately with either a </span><span class="cls_059">Message</span><span class="cls_039"> or </span><span class="cls_059">null</span><span class="cls_039">. If a </span><span class="cls_059">Message</span><span class="cls_039"> is returned,</span></div>
<div style="position:absolute;left:93.18px;top:389.96px" class="cls_039"><span class="cls_039">you use the </span><span class="cls_059">MessageConverter</span><span class="cls_039"> from the </span><span class="cls_059">RabbitTemplate</span><span class="cls_039"> to convert the </span><span class="cls_059">Message</span><span class="cls_039"> to</span></div>
<div style="position:absolute;left:93.18px;top:402.98px" class="cls_039"><span class="cls_039">an </span><span class="cls_059">Order</span><span class="cls_039">. On the other hand, if </span><span class="cls_059">receive()</span><span class="cls_039"> returns </span><span class="cls_059">null</span><span class="cls_039">, you’ll return a </span><span class="cls_059">null</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:108.00px;top:415.97px" class="cls_039"><span class="cls_039">Depending on the use case, you may be able to tolerate a small delay. In the Taco</span></div>
<div style="position:absolute;left:93.18px;top:428.96px" class="cls_039"><span class="cls_039">Cloud kitchen’s overhead display, for example, you can possibly wait a while if no</span></div>
<div style="position:absolute;left:93.18px;top:441.98px" class="cls_039"><span class="cls_039">orders are available. Let’s say you decide to wait up to 30 seconds before giving up.</span></div>
<div style="position:absolute;left:93.18px;top:454.97px" class="cls_039"><span class="cls_039">Then the </span><span class="cls_059">receiveOrder()</span><span class="cls_039"> method can be changed to pass a 30,000 millisecond delay</span></div>
<div style="position:absolute;left:93.18px;top:467.96px" class="cls_039"><span class="cls_039">to </span><span class="cls_059">receive()</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:487.64px" class="cls_060"><span class="cls_060">public Order receiveOrder() {</span></div>
<div style="position:absolute;left:102.78px;top:497.66px" class="cls_060"><span class="cls_060">Message message = rabbit.receive("tacocloud.order.queue", 30000);</span></div>
<div style="position:absolute;left:102.77px;top:507.65px" class="cls_060"><span class="cls_060">return message != null</span></div>
<div style="position:absolute;left:136.36px;top:517.64px" class="cls_060"><span class="cls_060">? (Order) converter.fromMessage(message)</span></div>
<div style="position:absolute;left:136.35px;top:527.66px" class="cls_060"><span class="cls_060">: null;</span></div>
<div style="position:absolute;left:93.18px;top:537.65px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:560.99px" class="cls_039"><span class="cls_039">If you’re like me, seeing a hardcoded number like that gives you a bit of discomfort. You</span></div>
<div style="position:absolute;left:93.18px;top:573.98px" class="cls_039"><span class="cls_039">might be thinking that it’d be a good idea to create an </span><span class="cls_059">@ConfigurationProperties</span><span class="cls_039">-</span></div>
<div style="position:absolute;left:93.18px;top:586.97px" class="cls_039"><span class="cls_039">annotated class so you could configure that timeout with a Spring Boot configuration</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:147364px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background223.jpg" width="531" height="666"></div>
<div style="position:absolute;left:203.94px;top:24.35px" class="cls_055"><span class="cls_055">Working with RabbitMQ and AMQP</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">201</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">property. I’d agree with you, if it weren’t for the fact that Spring Boot already offers</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">such a configuration property. If you want to set the timeout via configuration, simply</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">remove the timeout value in the call to </span><span class="cls_059">receive()</span><span class="cls_039"> and set it in your configuration with</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">spring.rabbitmq.template.receive-timeout</span><span class="cls_039"> property:</span></div>
<div style="position:absolute;left:102.18px;top:112.34px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:111.78px;top:122.33px" class="cls_060"><span class="cls_060">rabbitmq:</span></div>
<div style="position:absolute;left:121.38px;top:132.35px" class="cls_060"><span class="cls_060">template:</span></div>
<div style="position:absolute;left:130.95px;top:142.34px" class="cls_061"><span class="cls_061">receive-timeout: 30000</span></div>
<div style="position:absolute;left:102.18px;top:166.67px" class="cls_039"><span class="cls_039">Back in the </span><span class="cls_059">receiveOrder()</span><span class="cls_039"> method, notice that you had to use the message con-</span></div>
<div style="position:absolute;left:102.18px;top:179.66px" class="cls_039"><span class="cls_039">verter from </span><span class="cls_059">RabbitTemplate</span><span class="cls_039"> to convert the incoming </span><span class="cls_059">Message</span><span class="cls_039"> object to an </span><span class="cls_059">Order</span></div>
<div style="position:absolute;left:102.18px;top:192.65px" class="cls_039"><span class="cls_039">object. But if the </span><span class="cls_059">RabbitTemplate</span><span class="cls_039"> is carrying a message converter around, why can’t it</span></div>
<div style="position:absolute;left:102.18px;top:205.67px" class="cls_039"><span class="cls_039">do the conversion for you? That’s precisely what the </span><span class="cls_059">receiveAndConvert()</span><span class="cls_039"> method is</span></div>
<div style="position:absolute;left:102.18px;top:218.66px" class="cls_039"><span class="cls_039">for. Using </span><span class="cls_059">receiveAndConvert()</span><span class="cls_039">, you can rewrite </span><span class="cls_059">receiveOrder()</span><span class="cls_039"> like this:</span></div>
<div style="position:absolute;left:102.18px;top:241.34px" class="cls_060"><span class="cls_060">public Order receiveOrder() {</span></div>
<div style="position:absolute;left:111.78px;top:251.33px" class="cls_060"><span class="cls_060">return (Order) rabbit.receiveAndConvert("tacocloud.order.queue");</span></div>
<div style="position:absolute;left:102.18px;top:261.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:285.65px" class="cls_039"><span class="cls_039">That’s a lot simpler, isn’t it? The only troubling thing I see is the cast from </span><span class="cls_059">Object</span><span class="cls_039"> to</span></div>
<div style="position:absolute;left:102.18px;top:298.67px" class="cls_059"><span class="cls_059">Order</span><span class="cls_039">. There’s an alternative to casting, though. Instead, you can pass a </span><span class="cls_059">Parameterized-</span></div>
<div style="position:absolute;left:102.27px;top:311.66px" class="cls_059"><span class="cls_059">TypeReference</span><span class="cls_039"> to </span><span class="cls_059">receiveAndConvert()</span><span class="cls_039"> to receive an </span><span class="cls_059">Order</span><span class="cls_039"> object directly:</span></div>
<div style="position:absolute;left:102.18px;top:334.34px" class="cls_060"><span class="cls_060">public Order receiveOrder() {</span></div>
<div style="position:absolute;left:111.78px;top:344.33px" class="cls_060"><span class="cls_060">return rabbit.receiveAndConvert("tacocloud.order.queue",</span></div>
<div style="position:absolute;left:188.53px;top:354.35px" class="cls_060"><span class="cls_060">new ParameterizedTypeReference&lt;Order&gt;() {});</span></div>
<div style="position:absolute;left:102.18px;top:364.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:388.67px" class="cls_039"><span class="cls_039">It’s debatable whether that’s better than casting, but it is a more type-safe approach</span></div>
<div style="position:absolute;left:102.18px;top:401.66px" class="cls_039"><span class="cls_039">than casting. The only requirement to using a </span><span class="cls_059">ParameterizedTypeReference</span><span class="cls_039"> with</span></div>
<div style="position:absolute;left:102.18px;top:414.68px" class="cls_059"><span class="cls_059">receiveAndConvert()</span><span class="cls_039"> is that the message converter must be an implementation of</span></div>
<div style="position:absolute;left:102.18px;top:427.67px" class="cls_059"><span class="cls_059">SmartMessageConverter</span><span class="cls_039">; </span><span class="cls_059">Jackson2JsonMessageConverter</span><span class="cls_039"> is the only out-of-the-box</span></div>
<div style="position:absolute;left:102.18px;top:440.66px" class="cls_039"><span class="cls_039">implementation to choose from.</span></div>
<div style="position:absolute;left:117.10px;top:453.68px" class="cls_039"><span class="cls_039">The pull model offered by </span><span class="cls_059">JmsTemplate</span><span class="cls_039"> fits a lot of use cases, but often it’s better</span></div>
<div style="position:absolute;left:102.18px;top:466.67px" class="cls_039"><span class="cls_039">to have code that listens for messages and that’s invoked when messages arrive. Let’s</span></div>
<div style="position:absolute;left:102.18px;top:479.66px" class="cls_039"><span class="cls_039">see how you can write message-driven beans that respond to RabbitMQ messages.</span></div>
<div style="position:absolute;left:102.18px;top:497.84px" class="cls_064"><span class="cls_064">H</span><span class="cls_065">ANDLING</span><span class="cls_064"> R</span><span class="cls_065">ABBIT</span><span class="cls_064">MQ </span><span class="cls_065">MESSAGES</span><span class="cls_064"> </span><span class="cls_065">WITH</span><span class="cls_064"> </span><span class="cls_065">LISTENERS</span></div>
<div style="position:absolute;left:102.18px;top:510.17px" class="cls_039"><span class="cls_039">For message-driven RabbitMQ beans, Spring offers </span><span class="cls_059">RabbitListener</span><span class="cls_039">, the RabbitMQ</span></div>
<div style="position:absolute;left:102.18px;top:523.16px" class="cls_039"><span class="cls_039">counterpart to </span><span class="cls_059">JmsListener</span><span class="cls_039">. To specify that a method should be invoked when a mes-</span></div>
<div style="position:absolute;left:102.18px;top:536.18px" class="cls_039"><span class="cls_039">sage arrives in a RabbitMQ queue, annotate a bean’s method with </span><span class="cls_059">@RabbitTemplate</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.74px;top:549.17px" class="cls_039"><span class="cls_039">For example, the following listing shows a RabbitMQ implementation of </span><span class="cls_059">Order-</span></div>
<div style="position:absolute;left:102.18px;top:562.19px" class="cls_059"><span class="cls_059">Receiver</span><span class="cls_039"> that’s annotated to listen for order messages rather than to poll for them</span></div>
<div style="position:absolute;left:102.18px;top:575.18px" class="cls_039"><span class="cls_039">with </span><span class="cls_059">RabbitTemplate</span><span class="cls_039">.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:148040px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background224.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">202</span></div>
<div style="position:absolute;left:179.97px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 8</span></div>
<div style="position:absolute;left:224.10px;top:24.35px" class="cls_055"><span class="cls_055">Sending messages asynchronously</span></div>
<div style="position:absolute;left:105.18px;top:54.38px" class="cls_066"><span class="cls_066">Listing 8.7</span></div>
<div style="position:absolute;left:157.26px;top:54.38px" class="cls_066"><span class="cls_066">Declaring a method as a RabbitMQ message listener</span></div>
<div style="position:absolute;left:93.18px;top:73.22px" class="cls_060"><span class="cls_060">package tacos.kitchen.messaging.rabbit.listener;</span></div>
<div style="position:absolute;left:93.18px;top:83.24px" class="cls_060"><span class="cls_060">import org.springframework.amqp.rabbit.annotation.RabbitListener;</span></div>
<div style="position:absolute;left:93.18px;top:93.23px" class="cls_060"><span class="cls_060">import org.springframework.beans.factory.annotation.Autowired;</span></div>
<div style="position:absolute;left:93.18px;top:103.22px" class="cls_060"><span class="cls_060">import org.springframework.stereotype.Component;</span></div>
<div style="position:absolute;left:93.18px;top:126.23px" class="cls_060"><span class="cls_060">@Component</span></div>
<div style="position:absolute;left:93.18px;top:136.25px" class="cls_060"><span class="cls_060">public class OrderListener {</span></div>
<div style="position:absolute;left:102.78px;top:146.24px" class="cls_060"><span class="cls_060">private KitchenUI ui;</span></div>
<div style="position:absolute;left:102.78px;top:169.25px" class="cls_060"><span class="cls_060">@Autowired</span></div>
<div style="position:absolute;left:102.78px;top:179.24px" class="cls_060"><span class="cls_060">public OrderListener(KitchenUI ui) {</span></div>
<div style="position:absolute;left:112.38px;top:189.23px" class="cls_060"><span class="cls_060">this.ui = ui;</span></div>
<div style="position:absolute;left:102.78px;top:199.25px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.78px;top:222.23px" class="cls_060"><span class="cls_060">@RabbitListener(queues = "tacocloud.order.queue")</span></div>
<div style="position:absolute;left:102.78px;top:232.25px" class="cls_060"><span class="cls_060">public void receiveOrder(Order order) {</span></div>
<div style="position:absolute;left:112.38px;top:242.24px" class="cls_060"><span class="cls_060">ui.displayOrder(order);</span></div>
<div style="position:absolute;left:102.78px;top:252.23px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:262.25px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:286.55px" class="cls_039"><span class="cls_039">You’ll no doubt notice that this looks remarkably like the code from listing 8.4.</span></div>
<div style="position:absolute;left:93.18px;top:299.57px" class="cls_039"><span class="cls_039">Indeed, the only thing that changed was the listener annotation—from </span><span class="cls_059">@JmsListener</span></div>
<div style="position:absolute;left:93.18px;top:312.56px" class="cls_039"><span class="cls_039">to </span><span class="cls_059">@RabbitListener</span><span class="cls_039">. As wonderful as </span><span class="cls_059">@RabbitListener</span><span class="cls_039"> is, this near-duplication of</span></div>
<div style="position:absolute;left:93.18px;top:325.58px" class="cls_039"><span class="cls_039">code leaves me with little to say about </span><span class="cls_059">@RabbitListener</span><span class="cls_039"> that I haven’t already said</span></div>
<div style="position:absolute;left:93.18px;top:338.57px" class="cls_039"><span class="cls_039">about </span><span class="cls_059">@JmsListener</span><span class="cls_039">. They’re both great for writing code that responds to messages</span></div>
<div style="position:absolute;left:93.18px;top:351.56px" class="cls_039"><span class="cls_039">that are pushed to them from their respective brokers—a JMS broker for </span><span class="cls_059">@Jms-</span></div>
<div style="position:absolute;left:93.18px;top:364.58px" class="cls_059"><span class="cls_059">Listener</span><span class="cls_039"> and a RabbitMQ broker for </span><span class="cls_059">@RabbitListener</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:109.05px;top:377.57px" class="cls_039"><span class="cls_039">Although you may sense a lack of enthusiasm about </span><span class="cls_059">@RabbitListener</span><span class="cls_039"> in that</span></div>
<div style="position:absolute;left:93.18px;top:390.56px" class="cls_039"><span class="cls_039">previous paragraph, be certain that isn’t my intent. In truth, the fact that </span><span class="cls_059">@Rabbit-</span></div>
<div style="position:absolute;left:93.18px;top:403.58px" class="cls_059"><span class="cls_059">Listener</span><span class="cls_039"> works much like </span><span class="cls_059">@JmsListener</span><span class="cls_039"> is actually quite exciting! It means you don’t</span></div>
<div style="position:absolute;left:93.18px;top:416.57px" class="cls_039"><span class="cls_039">need to learn a completely different programming model when working with RabbitMQ</span></div>
<div style="position:absolute;left:93.18px;top:429.56px" class="cls_039"><span class="cls_039">vs. Artemis or ActiveMQ. The same excitement holds true for the similarities between</span></div>
<div style="position:absolute;left:93.18px;top:442.58px" class="cls_059"><span class="cls_059">RabbitTemplate</span><span class="cls_039"> and </span><span class="cls_059">JmsTemplate</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:107.57px;top:455.57px" class="cls_039"><span class="cls_039">Let’s hold on to that excitement as we wrap up this chapter by looking at one more</span></div>
<div style="position:absolute;left:93.18px;top:468.56px" class="cls_039"><span class="cls_039">messaging option supported by Spring: Apache Kafka.</span></div>
<div style="position:absolute;left:57.18px;top:493.75px" class="cls_040"><span class="cls_040">8.3</span></div>
<div style="position:absolute;left:93.18px;top:493.75px" class="cls_040"><span class="cls_040">Messaging with Kafka</span></div>
<div style="position:absolute;left:93.18px;top:513.08px" class="cls_039"><span class="cls_039">Apache Kafka is the newest messaging option we’re examining in this chapter. At a</span></div>
<div style="position:absolute;left:93.18px;top:526.07px" class="cls_039"><span class="cls_039">glance, Kafka is a message broker just like ActiveMQ, Artemis, or Rabbit. But Kafka</span></div>
<div style="position:absolute;left:93.18px;top:539.06px" class="cls_039"><span class="cls_039">has a few unique tricks up its sleeves.</span></div>
<div style="position:absolute;left:107.81px;top:552.08px" class="cls_039"><span class="cls_039">Kafka is designed to run in a cluster, affording great scalability. And by partition-</span></div>
<div style="position:absolute;left:93.18px;top:565.07px" class="cls_039"><span class="cls_039">ing its topics across all instances in the cluster, it’s very resilient. Whereas RabbitMQ</span></div>
<div style="position:absolute;left:93.18px;top:578.09px" class="cls_039"><span class="cls_039">deals primarily with queues in exchanges, Kafka utilizes topics only to offer pub/sub</span></div>
<div style="position:absolute;left:93.18px;top:591.08px" class="cls_039"><span class="cls_039">messaging.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:148716px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background225.jpg" width="531" height="666"></div>
<div style="position:absolute;left:230.28px;top:24.35px" class="cls_055"><span class="cls_055">Messaging with Kafka</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">203</span></div>
<div style="position:absolute;left:116.97px;top:50.66px" class="cls_039"><span class="cls_039">Kafka topics are replicated across all brokers in the cluster. Each node in the clus-</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">ter acts as a leader for one or more topics, being responsible for that topic’s data and</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">replicating it to the other nodes in the cluster.</span></div>
<div style="position:absolute;left:117.13px;top:89.66px" class="cls_039"><span class="cls_039">Going a step further, each topic can be split into multiple partitions. In that case,</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">each node in the cluster is the leader for one or more partitions of a topic, but not for</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">the entire topic. Responsibility for the topic is split across all nodes. Figure 8.2 illus-</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">trates how this works.</span></div>
<div style="position:absolute;left:243.92px;top:156.79px" class="cls_079"><span class="cls_079">Kafka cluster</span></div>
<div style="position:absolute;left:224.12px;top:177.60px" class="cls_057"><span class="cls_057">Partition</span></div>
<div style="position:absolute;left:261.76px;top:177.60px" class="cls_057"><span class="cls_057">Partition</span></div>
<div style="position:absolute;left:299.41px;top:177.60px" class="cls_057"><span class="cls_057">Partition</span></div>
<div style="position:absolute;left:112.60px;top:181.80px" class="cls_057"><span class="cls_057">Producer</span></div>
<div style="position:absolute;left:392.60px;top:181.80px" class="cls_057"><span class="cls_057">Consumer</span></div>
<div style="position:absolute;left:235.01px;top:192.00px" class="cls_057"><span class="cls_057">0</span></div>
<div style="position:absolute;left:272.66px;top:192.00px" class="cls_057"><span class="cls_057">1</span></div>
<div style="position:absolute;left:310.30px;top:192.00px" class="cls_057"><span class="cls_057">2</span></div>
<div style="position:absolute;left:224.12px;top:222.06px" class="cls_057"><span class="cls_057">Partition</span></div>
<div style="position:absolute;left:261.76px;top:222.06px" class="cls_057"><span class="cls_057">Partition</span></div>
<div style="position:absolute;left:299.41px;top:222.06px" class="cls_057"><span class="cls_057">Partition</span></div>
<div style="position:absolute;left:112.60px;top:226.20px" class="cls_057"><span class="cls_057">Producer</span></div>
<div style="position:absolute;left:392.60px;top:226.20px" class="cls_057"><span class="cls_057">Consumer</span></div>
<div style="position:absolute;left:235.01px;top:236.46px" class="cls_057"><span class="cls_057">0</span></div>
<div style="position:absolute;left:272.66px;top:236.46px" class="cls_057"><span class="cls_057">1</span></div>
<div style="position:absolute;left:310.30px;top:236.46px" class="cls_057"><span class="cls_057">2</span></div>
<div style="position:absolute;left:224.12px;top:266.45px" class="cls_057"><span class="cls_057">Partition</span></div>
<div style="position:absolute;left:261.76px;top:266.45px" class="cls_057"><span class="cls_057">Partition</span></div>
<div style="position:absolute;left:299.41px;top:266.45px" class="cls_057"><span class="cls_057">Partition</span></div>
<div style="position:absolute;left:112.60px;top:270.60px" class="cls_057"><span class="cls_057">Producer</span></div>
<div style="position:absolute;left:392.60px;top:270.60px" class="cls_057"><span class="cls_057">Consumer</span></div>
<div style="position:absolute;left:235.01px;top:280.85px" class="cls_057"><span class="cls_057">0</span></div>
<div style="position:absolute;left:272.66px;top:280.85px" class="cls_057"><span class="cls_057">1</span></div>
<div style="position:absolute;left:310.30px;top:280.85px" class="cls_057"><span class="cls_057">2</span></div>
<div style="position:absolute;left:102.18px;top:313.43px" class="cls_053"><span class="cls_053">Figure 8.2</span></div>
<div style="position:absolute;left:146.78px;top:313.43px" class="cls_053"><span class="cls_053">A Kafka cluster is composed of multiple brokers, each acting as a leader for</span></div>
<div style="position:absolute;left:102.18px;top:323.42px" class="cls_053"><span class="cls_053">partitions of the topics.</span></div>
<div style="position:absolute;left:102.18px;top:351.56px" class="cls_039"><span class="cls_039">Due to Kafka’s unique architecture, I encourage you to read more about it in </span><span class="cls_036">Kafka in</span></div>
<div style="position:absolute;left:102.18px;top:364.55px" class="cls_036"><span class="cls_036">Action</span><span class="cls_039"> by Dylan Scott (Manning, 2017). For our purposes, we’ll focus on how to send</span></div>
<div style="position:absolute;left:102.18px;top:377.57px" class="cls_039"><span class="cls_039">messages to and receive them from Kafka with Spring.</span></div>
<div style="position:absolute;left:66.18px;top:399.38px" class="cls_063"><span class="cls_063">8.3.1</span></div>
<div style="position:absolute;left:102.18px;top:399.38px" class="cls_063"><span class="cls_063">Setting up Spring for Kafka messaging</span></div>
<div style="position:absolute;left:102.18px;top:416.57px" class="cls_039"><span class="cls_039">To start using Kafka for messaging, you’ll need to add the appropriate dependencies</span></div>
<div style="position:absolute;left:102.18px;top:429.56px" class="cls_039"><span class="cls_039">to your build. Unlike the JMS and RabbitMQ options, however, there isn’t a Spring</span></div>
<div style="position:absolute;left:102.18px;top:442.55px" class="cls_039"><span class="cls_039">Boot starter for Kafka. Have no fear, though; you’ll only need one dependency:</span></div>
<div style="position:absolute;left:102.18px;top:462.23px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:111.78px;top:472.25px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:111.78px;top:482.24px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-kafka&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:102.18px;top:492.23px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:102.18px;top:513.56px" class="cls_039"><span class="cls_039">This one dependency brings everything you need for Kafka to the project. What’s</span></div>
<div style="position:absolute;left:102.18px;top:526.58px" class="cls_039"><span class="cls_039">more, its presence will trigger Spring Boot autoconfiguration for Kafka that will,</span></div>
<div style="position:absolute;left:102.18px;top:539.57px" class="cls_039"><span class="cls_039">among other things, arrange for a </span><span class="cls_059">KafkaTemplate</span><span class="cls_039"> in the Spring application context.</span></div>
<div style="position:absolute;left:102.18px;top:552.56px" class="cls_039"><span class="cls_039">All you need to do is inject the </span><span class="cls_059">KafkaTemplate</span><span class="cls_039"> and go to work sending and receiving</span></div>
<div style="position:absolute;left:102.18px;top:565.58px" class="cls_039"><span class="cls_039">messages.</span></div>
<div style="position:absolute;left:117.21px;top:578.57px" class="cls_039"><span class="cls_039">Before you start sending and receiving messages, however, you should be aware</span></div>
<div style="position:absolute;left:102.18px;top:591.56px" class="cls_039"><span class="cls_039">of a few properties that will come in handy when working with Kafka. Specifically,</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:149392px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background226.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">204</span></div>
<div style="position:absolute;left:179.97px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 8</span></div>
<div style="position:absolute;left:224.10px;top:24.35px" class="cls_055"><span class="cls_055">Sending messages asynchronously</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_059"><span class="cls_059">KafkaTemplate</span><span class="cls_039"> defaults to work with a Kafka broker on </span><span class="cls_059">localhost</span><span class="cls_039">, listening on port</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">9092. It’s fine to start up a Kafka broker locally while developing an application, but</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">when it’s time to go to production, you’ll need to configure a different host and port.</span></div>
<div style="position:absolute;left:108.00px;top:89.66px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">spring.kafka.bootstrap-servers</span><span class="cls_039"> property sets the location of one or more</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">Kafka servers used to establish an initial connection to the Kafka cluster. For example,</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">if one of the Kafka servers in the cluster is running at kafka.tacocloud.com and listen-</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">ing on port 9092, you can configure its location in YAML like this:</span></div>
<div style="position:absolute;left:93.18px;top:150.35px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:102.78px;top:160.34px" class="cls_060"><span class="cls_060">kafka:</span></div>
<div style="position:absolute;left:112.38px;top:170.33px" class="cls_060"><span class="cls_060">bootstrap-servers:</span></div>
<div style="position:absolute;left:112.38px;top:180.35px" class="cls_061"><span class="cls_061">- kafka.tacocloud.com:9092</span></div>
<div style="position:absolute;left:93.18px;top:203.66px" class="cls_039"><span class="cls_039">But notice that </span><span class="cls_059">spring.kafka.bootstrap-servers</span><span class="cls_039"> is plural and accepts a list. As such,</span></div>
<div style="position:absolute;left:93.18px;top:216.65px" class="cls_039"><span class="cls_039">you can provide it with multiple Kafka servers in the cluster:</span></div>
<div style="position:absolute;left:93.18px;top:238.34px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:102.78px;top:248.33px" class="cls_060"><span class="cls_060">kafka:</span></div>
<div style="position:absolute;left:112.38px;top:258.35px" class="cls_060"><span class="cls_060">bootstrap-servers:</span></div>
<div style="position:absolute;left:112.38px;top:268.34px" class="cls_060"><span class="cls_060">- kafka.tacocloud.com:9092</span></div>
<div style="position:absolute;left:112.38px;top:278.33px" class="cls_060"><span class="cls_060">- kafka.tacocloud.com:9093</span></div>
<div style="position:absolute;left:112.38px;top:288.35px" class="cls_061"><span class="cls_061">- kafka.tacocloud.com:9094</span></div>
<div style="position:absolute;left:93.18px;top:311.66px" class="cls_039"><span class="cls_039">With Kafka set up in your project, you’re ready to send and receive messages. You’ll</span></div>
<div style="position:absolute;left:93.18px;top:324.68px" class="cls_039"><span class="cls_039">start by sending </span><span class="cls_059">Order</span><span class="cls_039"> objects to Kafka using </span><span class="cls_059">KafkaTemplate</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:57.18px;top:350.48px" class="cls_063"><span class="cls_063">8.3.2</span></div>
<div style="position:absolute;left:93.18px;top:350.48px" class="cls_063"><span class="cls_063">Sending messages with KafkaTemplate</span></div>
<div style="position:absolute;left:93.18px;top:368.18px" class="cls_039"><span class="cls_039">In many ways, </span><span class="cls_059">KafkaTemplate</span><span class="cls_039"> is similar to its JMS and RabbitMQ counterparts. At the</span></div>
<div style="position:absolute;left:93.18px;top:381.17px" class="cls_039"><span class="cls_039">same time, it’s very different. This becomes apparent as we consider its methods for</span></div>
<div style="position:absolute;left:93.18px;top:394.16px" class="cls_039"><span class="cls_039">sending messages:</span></div>
<div style="position:absolute;left:93.18px;top:415.85px" class="cls_060"><span class="cls_060">ListenableFuture&lt;SendResult&lt;K, V&gt;&gt; send(String topic, V data);</span></div>
<div style="position:absolute;left:93.18px;top:425.84px" class="cls_060"><span class="cls_060">ListenableFuture&lt;SendResult&lt;K, V&gt;&gt; send(String topic, K key, V data);</span></div>
<div style="position:absolute;left:93.18px;top:435.86px" class="cls_060"><span class="cls_060">ListenableFuture&lt;SendResult&lt;K, V&gt;&gt; send(String topic,</span></div>
<div style="position:absolute;left:256.32px;top:445.85px" class="cls_060"><span class="cls_060">Integer partition, K key, V data);</span></div>
<div style="position:absolute;left:93.18px;top:455.84px" class="cls_060"><span class="cls_060">ListenableFuture&lt;SendResult&lt;K, V&gt;&gt; send(String topic,</span></div>
<div style="position:absolute;left:179.53px;top:465.86px" class="cls_060"><span class="cls_060">Integer partition, Long timestamp, K key, V data);</span></div>
<div style="position:absolute;left:93.18px;top:475.85px" class="cls_060"><span class="cls_060">ListenableFuture&lt;SendResult&lt;K, V&gt;&gt; send(ProducerRecord&lt;K, V&gt; record);</span></div>
<div style="position:absolute;left:93.18px;top:485.84px" class="cls_060"><span class="cls_060">ListenableFuture&lt;SendResult&lt;K, V&gt;&gt; send(Message&lt;?&gt; message);</span></div>
<div style="position:absolute;left:93.18px;top:505.85px" class="cls_060"><span class="cls_060">ListenableFuture&lt;SendResult&lt;K, V&gt;&gt; sendDefault(V data);</span></div>
<div style="position:absolute;left:93.18px;top:515.84px" class="cls_060"><span class="cls_060">ListenableFuture&lt;SendResult&lt;K, V&gt;&gt; sendDefault(K key, V data);</span></div>
<div style="position:absolute;left:93.18px;top:525.86px" class="cls_060"><span class="cls_060">ListenableFuture&lt;SendResult&lt;K, V&gt;&gt; sendDefault(Integer partition,</span></div>
<div style="position:absolute;left:318.66px;top:535.85px" class="cls_060"><span class="cls_060">K key, V data);</span></div>
<div style="position:absolute;left:93.18px;top:545.84px" class="cls_060"><span class="cls_060">ListenableFuture&lt;SendResult&lt;K, V&gt;&gt; sendDefault(Integer partition,</span></div>
<div style="position:absolute;left:270.71px;top:555.86px" class="cls_061"><span class="cls_061">Long timestamp, K key, V data);</span></div>
<div style="position:absolute;left:93.18px;top:579.17px" class="cls_039"><span class="cls_039">The first thing you may have noticed is that there are no </span><span class="cls_059">convertAndSend()</span><span class="cls_039"> methods.</span></div>
<div style="position:absolute;left:93.18px;top:592.19px" class="cls_039"><span class="cls_039">That’s because </span><span class="cls_059">KafkaTemplate</span><span class="cls_039"> is typed with generics and is able to deal with domain</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:150068px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background227.jpg" width="531" height="666"></div>
<div style="position:absolute;left:230.28px;top:24.35px" class="cls_055"><span class="cls_055">Messaging with Kafka</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">205</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">types directly when sending messages. In a way, all of the </span><span class="cls_059">send()</span><span class="cls_039"> methods are doing</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">the job of </span><span class="cls_059">convertAndSend()</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.19px;top:76.67px" class="cls_039"><span class="cls_039">You may also have noticed that there are several parameters to </span><span class="cls_059">send()</span><span class="cls_039"> and </span><span class="cls_059">send-</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_059"><span class="cls_059">Default()</span><span class="cls_039"> that are quite different from what you used with JMS and Rabbit. When</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">sending messages in Kafka, you can specify the following parameters to guide how the</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">message is sent:</span></div>
<div style="position:absolute;left:117.78px;top:132.65px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  The topic to send the message to (required for </span><span class="cls_059">send()</span><span class="cls_039">)</span></div>
<div style="position:absolute;left:117.78px;top:146.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  A partition to write the topic to (optional)</span></div>
<div style="position:absolute;left:117.78px;top:160.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  A key to send on the record (optional)</span></div>
<div style="position:absolute;left:117.78px;top:174.65px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  A timestamp (optional; defaults to </span><span class="cls_059">System.currentTimeMillis()</span><span class="cls_039">)</span></div>
<div style="position:absolute;left:117.78px;top:188.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  The payload (required)</span></div>
<div style="position:absolute;left:102.18px;top:206.66px" class="cls_039"><span class="cls_039">The topic and payload are the two most important parameters. Partitions and keys</span></div>
<div style="position:absolute;left:102.18px;top:219.65px" class="cls_039"><span class="cls_039">have little effect on how you use </span><span class="cls_059">KafkaTemplate</span><span class="cls_039">, aside from being extra information</span></div>
<div style="position:absolute;left:102.18px;top:232.67px" class="cls_039"><span class="cls_039">provided as parameters to </span><span class="cls_059">send()</span><span class="cls_039"> and </span><span class="cls_059">sendDefault()</span><span class="cls_039">. For our purposes, we’re going</span></div>
<div style="position:absolute;left:102.18px;top:245.66px" class="cls_039"><span class="cls_039">to focus on sending the message payload to a given topic and not worry ourselves with</span></div>
<div style="position:absolute;left:102.18px;top:258.65px" class="cls_039"><span class="cls_039">partitions and keys.</span></div>
<div style="position:absolute;left:117.38px;top:271.67px" class="cls_039"><span class="cls_039">For the </span><span class="cls_059">send()</span><span class="cls_039"> method, you can also choose to send a </span><span class="cls_059">ProducerRecord</span><span class="cls_039">, which is</span></div>
<div style="position:absolute;left:102.18px;top:284.66px" class="cls_039"><span class="cls_039">little more than a type that captures all of the preceding parameters in a single object.</span></div>
<div style="position:absolute;left:102.18px;top:297.68px" class="cls_039"><span class="cls_039">You can also send a </span><span class="cls_059">Message</span><span class="cls_039"> object, but doing so would require you to convert your</span></div>
<div style="position:absolute;left:102.18px;top:310.67px" class="cls_039"><span class="cls_039">domain objects into a </span><span class="cls_059">Message</span><span class="cls_039">. Generally, it’s easier to use one of the other methods</span></div>
<div style="position:absolute;left:102.18px;top:323.66px" class="cls_039"><span class="cls_039">rather than to create and send a </span><span class="cls_059">ProducerRecord</span><span class="cls_039"> or </span><span class="cls_059">Message</span><span class="cls_039"> object.</span></div>
<div style="position:absolute;left:118.44px;top:336.68px" class="cls_039"><span class="cls_039">Using the </span><span class="cls_059">KafkaTemplate</span><span class="cls_039"> and its </span><span class="cls_059">send()</span><span class="cls_039"> method, you can write a Kafka-based</span></div>
<div style="position:absolute;left:102.18px;top:349.67px" class="cls_039"><span class="cls_039">implementation of </span><span class="cls_059">OrderMessagingService</span><span class="cls_039">. The following listing shows what such an</span></div>
<div style="position:absolute;left:102.18px;top:362.66px" class="cls_039"><span class="cls_039">implementation might look like.</span></div>
<div style="position:absolute;left:114.18px;top:389.66px" class="cls_066"><span class="cls_066">Listing 8.8</span></div>
<div style="position:absolute;left:166.27px;top:389.27px" class="cls_066"><span class="cls_066">Sending orders with </span><span class="cls_077">KafkaTemplate</span></div>
<div style="position:absolute;left:102.18px;top:409.64px" class="cls_060"><span class="cls_060">package tacos.messaging;</span></div>
<div style="position:absolute;left:102.18px;top:419.66px" class="cls_060"><span class="cls_060">import org.springframework.beans.factory.annotation.Autowired;</span></div>
<div style="position:absolute;left:102.18px;top:429.65px" class="cls_060"><span class="cls_060">import org.springframework.kafka.core.KafkaTemplate;</span></div>
<div style="position:absolute;left:102.18px;top:439.64px" class="cls_060"><span class="cls_060">import org.springframework.stereotype.Service;</span></div>
<div style="position:absolute;left:102.18px;top:459.65px" class="cls_060"><span class="cls_060">@Service</span></div>
<div style="position:absolute;left:102.18px;top:469.64px" class="cls_060"><span class="cls_060">public class KafkaOrderMessagingService</span></div>
<div style="position:absolute;left:265.26px;top:479.66px" class="cls_060"><span class="cls_060">implements OrderMessagingService {</span></div>
<div style="position:absolute;left:111.78px;top:499.64px" class="cls_060"><span class="cls_060">private KafkaTemplate&lt;String, Order&gt; kafkaTemplate;</span></div>
<div style="position:absolute;left:111.78px;top:519.65px" class="cls_060"><span class="cls_060">@Autowired</span></div>
<div style="position:absolute;left:111.78px;top:529.64px" class="cls_060"><span class="cls_060">public KafkaOrderMessagingService(</span></div>
<div style="position:absolute;left:150.14px;top:539.66px" class="cls_060"><span class="cls_060">KafkaTemplate&lt;String, Order&gt; kafkaTemplate) {</span></div>
<div style="position:absolute;left:121.38px;top:549.65px" class="cls_060"><span class="cls_060">this.kafkaTemplate = kafkaTemplate;</span></div>
<div style="position:absolute;left:111.78px;top:559.64px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:579.65px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:111.77px;top:589.64px" class="cls_060"><span class="cls_060">public void sendOrder(Order order) {</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:150744px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background228.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">206</span></div>
<div style="position:absolute;left:179.97px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 8</span></div>
<div style="position:absolute;left:224.10px;top:24.35px" class="cls_055"><span class="cls_055">Sending messages asynchronously</span></div>
<div style="position:absolute;left:112.38px;top:51.32px" class="cls_060"><span class="cls_060">kafkaTemplate.send("tacocloud.orders.topic", order);</span></div>
<div style="position:absolute;left:102.78px;top:61.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:81.32px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">In this new implementation of </span><span class="cls_059">OrderMessagingService</span><span class="cls_039">, the </span><span class="cls_059">sendOrder()</span><span class="cls_039"> method</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">uses the </span><span class="cls_059">send()</span><span class="cls_039"> method of the injected </span><span class="cls_059">KafkaTemplate</span><span class="cls_039"> to send an </span><span class="cls_059">Order</span><span class="cls_039"> to the topic</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">named tacocloud.orders.topic. Except for the word “Kafka” scattered through the</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">code, this isn’t much different than the code you wrote for JMS and Rabbit.</span></div>
<div style="position:absolute;left:108.15px;top:154.67px" class="cls_039"><span class="cls_039">If you set a default topic, you can simplify the </span><span class="cls_059">sendOrder()</span><span class="cls_039"> method slightly. First,</span></div>
<div style="position:absolute;left:93.18px;top:167.66px" class="cls_039"><span class="cls_039">set your default topic to tacocloud.orders.topic by setting the </span><span class="cls_059">spring.kafka.template</span></div>
<div style="position:absolute;left:93.18px;top:180.65px" class="cls_059"><span class="cls_059">.default-topic</span><span class="cls_039"> property:</span></div>
<div style="position:absolute;left:93.18px;top:202.34px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:102.78px;top:212.33px" class="cls_060"><span class="cls_060">kafka:</span></div>
<div style="position:absolute;left:112.38px;top:222.35px" class="cls_060"><span class="cls_060">template:</span></div>
<div style="position:absolute;left:121.95px;top:232.34px" class="cls_061"><span class="cls_061">default-topic: tacocloud.orders.topic</span></div>
<div style="position:absolute;left:93.18px;top:255.65px" class="cls_039"><span class="cls_039">Then, in the </span><span class="cls_059">sendOrder()</span><span class="cls_039"> method, you can call </span><span class="cls_059">sendDefault()</span><span class="cls_039"> instead of </span><span class="cls_059">send()</span><span class="cls_039"> and</span></div>
<div style="position:absolute;left:93.18px;top:268.67px" class="cls_039"><span class="cls_039">not specify the topic name:</span></div>
<div style="position:absolute;left:93.18px;top:290.33px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:93.18px;top:300.35px" class="cls_060"><span class="cls_060">public void sendOrder(Order order) {</span></div>
<div style="position:absolute;left:102.78px;top:310.34px" class="cls_060"><span class="cls_060">kafkaTemplate.sendDefault(order);</span></div>
<div style="position:absolute;left:93.18px;top:320.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:343.67px" class="cls_039"><span class="cls_039">Now that your message-sending code has been written, let’s turn our attention to writ-</span></div>
<div style="position:absolute;left:93.18px;top:356.66px" class="cls_039"><span class="cls_039">ing code that will receive those messages from Kafka.</span></div>
<div style="position:absolute;left:57.18px;top:381.50px" class="cls_063"><span class="cls_063">8.3.3</span></div>
<div style="position:absolute;left:93.18px;top:381.50px" class="cls_063"><span class="cls_063">Writing Kafka listeners</span></div>
<div style="position:absolute;left:93.18px;top:399.17px" class="cls_039"><span class="cls_039">Aside from the unique method signatures for </span><span class="cls_059">send()</span><span class="cls_039"> and </span><span class="cls_059">sendDefault()</span><span class="cls_039">, </span><span class="cls_059">Kafka-</span></div>
<div style="position:absolute;left:93.18px;top:412.16px" class="cls_059"><span class="cls_059">Template</span><span class="cls_039"> differs from </span><span class="cls_059">JmsTemplate</span><span class="cls_039"> and </span><span class="cls_059">RabbitTemplate</span><span class="cls_039"> in that it doesn’t offer any</span></div>
<div style="position:absolute;left:93.18px;top:425.18px" class="cls_039"><span class="cls_039">methods for receiving messages. That means the only way to consume messages from</span></div>
<div style="position:absolute;left:93.18px;top:438.17px" class="cls_039"><span class="cls_039">a Kafka topic using Spring is to write a message listener.</span></div>
<div style="position:absolute;left:107.58px;top:451.16px" class="cls_039"><span class="cls_039">For Kafka, message listeners are defined as methods that are annotated with </span><span class="cls_059">@Kafka-</span></div>
<div style="position:absolute;left:93.27px;top:464.18px" class="cls_059"><span class="cls_059">Listener</span><span class="cls_039">. The </span><span class="cls_059">@KafkaListener</span><span class="cls_039"> annotation is roughly analogous to </span><span class="cls_059">@JmsListener</span><span class="cls_039"> and</span></div>
<div style="position:absolute;left:93.18px;top:477.17px" class="cls_059"><span class="cls_059">@RabbitListener</span><span class="cls_039"> and is used in much the same way. The next listing shows what your</span></div>
<div style="position:absolute;left:93.18px;top:490.16px" class="cls_039"><span class="cls_039">listener-based order receiver might look like if written for Kafka.</span></div>
<div style="position:absolute;left:105.18px;top:514.16px" class="cls_066"><span class="cls_066">Listing 8.9</span></div>
<div style="position:absolute;left:157.26px;top:513.77px" class="cls_066"><span class="cls_066">Receiving orders with </span><span class="cls_077">@KafkaListener</span></div>
<div style="position:absolute;left:93.18px;top:534.14px" class="cls_060"><span class="cls_060">package tacos.kitchen.messaging.kafka.listener;</span></div>
<div style="position:absolute;left:93.18px;top:544.16px" class="cls_060"><span class="cls_060">import org.springframework.beans.factory.annotation.Autowired;</span></div>
<div style="position:absolute;left:93.18px;top:554.15px" class="cls_060"><span class="cls_060">import org.springframework.kafka.annotation.KafkaListener;</span></div>
<div style="position:absolute;left:93.18px;top:564.14px" class="cls_060"><span class="cls_060">import org.springframework.stereotype.Component;</span></div>
<div style="position:absolute;left:93.18px;top:574.16px" class="cls_060"><span class="cls_060">import tacos.Order;</span></div>
<div style="position:absolute;left:93.18px;top:584.15px" class="cls_060"><span class="cls_060">import tacos.kitchen.KitchenUI;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:151420px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background229.jpg" width="531" height="666"></div>
<div style="position:absolute;left:230.28px;top:24.35px" class="cls_055"><span class="cls_055">Messaging with Kafka</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">207</span></div>
<div style="position:absolute;left:102.18px;top:51.32px" class="cls_060"><span class="cls_060">@Component</span></div>
<div style="position:absolute;left:102.18px;top:61.34px" class="cls_060"><span class="cls_060">public class OrderListener {</span></div>
<div style="position:absolute;left:111.78px;top:83.33px" class="cls_060"><span class="cls_060">private KitchenUI ui;</span></div>
<div style="position:absolute;left:111.78px;top:105.32px" class="cls_060"><span class="cls_060">@Autowired</span></div>
<div style="position:absolute;left:111.78px;top:115.34px" class="cls_060"><span class="cls_060">public OrderListener(KitchenUI ui) {</span></div>
<div style="position:absolute;left:121.38px;top:125.33px" class="cls_060"><span class="cls_060">this.ui = ui;</span></div>
<div style="position:absolute;left:111.78px;top:135.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:157.34px" class="cls_060"><span class="cls_060">@KafkaListener(topics="tacocloud.orders.topic")</span></div>
<div style="position:absolute;left:111.78px;top:167.33px" class="cls_060"><span class="cls_060">public void handle(Order order) {</span></div>
<div style="position:absolute;left:121.38px;top:177.35px" class="cls_060"><span class="cls_060">ui.displayOrder(order);</span></div>
<div style="position:absolute;left:111.78px;top:187.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:207.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:231.65px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">handle()</span><span class="cls_039"> method is annotated with </span><span class="cls_059">@KafkaListener</span><span class="cls_039"> to indicate that it should</span></div>
<div style="position:absolute;left:102.18px;top:244.67px" class="cls_039"><span class="cls_039">be invoked when a message arrives in the topic named tacocloud.orders.topic. As it’s</span></div>
<div style="position:absolute;left:102.18px;top:257.66px" class="cls_039"><span class="cls_039">written in listing 8.9, only an </span><span class="cls_059">Order</span><span class="cls_039"> (the payload) is given to </span><span class="cls_059">handle()</span><span class="cls_039">. But if you</span></div>
<div style="position:absolute;left:102.18px;top:270.65px" class="cls_039"><span class="cls_039">need additional metadata from the message, it can also accept a </span><span class="cls_059">ConsumerRecord</span><span class="cls_039"> or</span></div>
<div style="position:absolute;left:102.18px;top:283.67px" class="cls_059"><span class="cls_059">Message</span><span class="cls_039"> object.</span></div>
<div style="position:absolute;left:119.01px;top:296.66px" class="cls_039"><span class="cls_039">For example, the following implementation of </span><span class="cls_059">handle()</span><span class="cls_039"> accepts a </span><span class="cls_059">Consumer-</span></div>
<div style="position:absolute;left:102.18px;top:309.68px" class="cls_059"><span class="cls_059">Record</span><span class="cls_039"> so that you can log the partition and timestamp of the message:</span></div>
<div style="position:absolute;left:102.18px;top:332.33px" class="cls_060"><span class="cls_060">@KafkaListener(topics="tacocloud.orders.topic")</span></div>
<div style="position:absolute;left:102.18px;top:342.35px" class="cls_060"><span class="cls_060">public void handle(Order order, ConsumerRecord&lt;Order&gt; record) {</span></div>
<div style="position:absolute;left:111.77px;top:352.34px" class="cls_060"><span class="cls_060">log.info("Received from partition {} with timestamp {}",</span></div>
<div style="position:absolute;left:130.95px;top:362.33px" class="cls_060"><span class="cls_060">record.partition(), record.timestamp());</span></div>
<div style="position:absolute;left:111.78px;top:372.35px" class="cls_060"><span class="cls_060">ui.displayOrder(order);</span></div>
<div style="position:absolute;left:102.18px;top:382.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:406.67px" class="cls_039"><span class="cls_039">Similarly, you could ask for a </span><span class="cls_059">Message</span><span class="cls_039"> instead of a </span><span class="cls_059">ConsumerRecord</span><span class="cls_039"> and achieve the</span></div>
<div style="position:absolute;left:102.18px;top:419.66px" class="cls_039"><span class="cls_039">same thing:</span></div>
<div style="position:absolute;left:102.18px;top:442.34px" class="cls_060"><span class="cls_060">@KafkaListener(topics="tacocloud.orders.topic")</span></div>
<div style="position:absolute;left:102.18px;top:452.36px" class="cls_060"><span class="cls_060">public void handle(Order order, Message&lt;Order&gt; message) {</span></div>
<div style="position:absolute;left:102.18px;top:462.35px" class="cls_060"><span class="cls_060">MessageHeaders headers = message.getHeaders();</span></div>
<div style="position:absolute;left:111.77px;top:472.34px" class="cls_060"><span class="cls_060">log.info("Received from partition {} with timestamp {}",</span></div>
<div style="position:absolute;left:130.95px;top:482.36px" class="cls_060"><span class="cls_060">headers.get(KafkaHeaders.RECEIVED_PARTITION_ID)</span></div>
<div style="position:absolute;left:130.95px;top:492.35px" class="cls_060"><span class="cls_060">headers.get(KafkaHeaders.RECEIVED_TIMESTAMP));</span></div>
<div style="position:absolute;left:111.78px;top:502.34px" class="cls_060"><span class="cls_060">ui.displayOrder(order);</span></div>
<div style="position:absolute;left:102.18px;top:512.36px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:536.66px" class="cls_039"><span class="cls_039">It’s worth noting that the message payload is also available via </span><span class="cls_059">ConsumerRecord</span></div>
<div style="position:absolute;left:102.18px;top:549.68px" class="cls_059"><span class="cls_059">.value()</span><span class="cls_039"> or </span><span class="cls_059">Message.getPayload()</span><span class="cls_039">. This means that you could ask for the </span><span class="cls_059">Order</span></div>
<div style="position:absolute;left:102.18px;top:562.67px" class="cls_039"><span class="cls_039">through those objects instead of asking for it directly as a parameter to </span><span class="cls_059">handle()</span><span class="cls_039">.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:152096px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background230.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">208</span></div>
<div style="position:absolute;left:179.97px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 8</span></div>
<div style="position:absolute;left:224.10px;top:24.35px" class="cls_055"><span class="cls_055">Sending messages asynchronously</span></div>
<div style="position:absolute;left:93.18px;top:49.81px" class="cls_040"><span class="cls_040">Summary</span></div>
<div style="position:absolute;left:108.78px;top:68.15px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Asynchronous messaging provides a layer of indirection between communicat-</span></div>
<div style="position:absolute;left:120.78px;top:81.17px" class="cls_039"><span class="cls_039">ing applications, which allows for looser coupling and greater scalability.</span></div>
<div style="position:absolute;left:108.78px;top:95.15px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Spring supports asynchronous messaging with JMS, RabbitMQ, or Apache Kafka.</span></div>
<div style="position:absolute;left:108.78px;top:109.16px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Applications can use template-based clients (</span><span class="cls_059">JmsTemplate</span><span class="cls_039">, </span><span class="cls_059">RabbitTemplate</span><span class="cls_039">, or</span></div>
<div style="position:absolute;left:120.78px;top:122.15px" class="cls_059"><span class="cls_059">KafkaTemplate</span><span class="cls_039">) to send messages via a message broker.</span></div>
<div style="position:absolute;left:108.78px;top:136.16px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Receiving applications can consume messages in a pull-based model using the</span></div>
<div style="position:absolute;left:120.78px;top:149.15px" class="cls_039"><span class="cls_039">same template-based clients.</span></div>
<div style="position:absolute;left:108.78px;top:163.16px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Messages can also be pushed to consumers by applying message listener annota-</span></div>
<div style="position:absolute;left:120.78px;top:176.15px" class="cls_039"><span class="cls_039">tions (</span><span class="cls_059">@JmsListener</span><span class="cls_039">, </span><span class="cls_059">@RabbitListener</span><span class="cls_039">, or </span><span class="cls_059">@KafkaListener</span><span class="cls_039">) to bean methods.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:152772px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background231.jpg" width="531" height="666"></div>
<div style="position:absolute;left:258.18px;top:111.83px" class="cls_014"><span class="cls_014">Integrating Spring</span></div>
<div style="position:absolute;left:96.18px;top:264.85px" class="cls_049"><span class="cls_049">This chapter covers</span></div>
<div style="position:absolute;left:96.18px;top:283.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Processing data in real time</span></div>
<div style="position:absolute;left:96.18px;top:298.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Defining integration flows</span></div>
<div style="position:absolute;left:96.18px;top:313.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Using Spring Integration’s Java DSL definition</span></div>
<div style="position:absolute;left:96.18px;top:328.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Integrating with emails, filesystems, and other</span></div>
<div style="position:absolute;left:108.18px;top:340.55px" class="cls_051"><span class="cls_051">external systems</span></div>
<div style="position:absolute;left:114.18px;top:410.54px" class="cls_039"><span class="cls_039">One of the most frustrating things I encounter as I travel is being on a long flight</span></div>
<div style="position:absolute;left:114.18px;top:423.53px" class="cls_039"><span class="cls_039">and having a poor or nonexistent in-flight internet connection. I like to use my air</span></div>
<div style="position:absolute;left:114.18px;top:436.55px" class="cls_039"><span class="cls_039">time to get some work done, including writing many of the pages of this book. If</span></div>
<div style="position:absolute;left:114.18px;top:449.54px" class="cls_039"><span class="cls_039">there’s no network connection, I’m at a disadvantage if I need to fetch a library or</span></div>
<div style="position:absolute;left:114.18px;top:462.56px" class="cls_039"><span class="cls_039">look up a Java Doc, and I’m not able to get much work done. I’ve learned to pack a</span></div>
<div style="position:absolute;left:114.18px;top:475.55px" class="cls_039"><span class="cls_039">book to read for those occasions.</span></div>
<div style="position:absolute;left:129.29px;top:488.54px" class="cls_039"><span class="cls_039">Just as we need to connect to the internet to be productive, many applications</span></div>
<div style="position:absolute;left:114.18px;top:501.56px" class="cls_039"><span class="cls_039">must connect to external systems to perform their work. An application may need</span></div>
<div style="position:absolute;left:114.18px;top:514.55px" class="cls_039"><span class="cls_039">to read or send emails, interact with an external API, or react to data being written</span></div>
<div style="position:absolute;left:114.18px;top:527.54px" class="cls_039"><span class="cls_039">to a database. And, as data is ingested from or written to these external systems, the</span></div>
<div style="position:absolute;left:114.18px;top:540.56px" class="cls_039"><span class="cls_039">application may need to process data in some way to translate it to or from the</span></div>
<div style="position:absolute;left:114.18px;top:553.55px" class="cls_039"><span class="cls_039">application’s own domain.</span></div>
<div style="position:absolute;left:269.16px;top:596.99px" class="cls_048"><span class="cls_048">209</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:153448px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background232.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">210</span></div>
<div style="position:absolute;left:206.49px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 9</span></div>
<div style="position:absolute;left:250.62px;top:24.35px" class="cls_055"><span class="cls_055">Integrating Spring</span></div>
<div style="position:absolute;left:107.63px;top:50.66px" class="cls_039"><span class="cls_039">In this chapter, you’ll see how to employ common integration patterns with Spring</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">Integration. Spring Integration is a ready-to-use implementation of many of the inte-</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">gration patterns that are catalogued in </span><span class="cls_036">Enterprise Integration Patterns</span><span class="cls_039"> by Gregor Hohpe</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">and Bobby Woolf (Addison-Wesley, 2003). Each pattern is implemented as a compo-</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">nent through which messages ferry data in a pipeline. Using Spring configuration,</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">you can assemble these components into a pipeline through which data flows. Let’s</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">get started by defining a simple integration flow that introduces many of the features</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">and characteristics of working with Spring Integration.</span></div>
<div style="position:absolute;left:57.18px;top:162.82px" class="cls_040"><span class="cls_040">9.1</span></div>
<div style="position:absolute;left:93.18px;top:162.82px" class="cls_040"><span class="cls_040">Declaring a simple integration flow</span></div>
<div style="position:absolute;left:93.18px;top:180.65px" class="cls_039"><span class="cls_039">Generally speaking, Spring Integration enables the creation of integration flows</span></div>
<div style="position:absolute;left:93.18px;top:193.67px" class="cls_039"><span class="cls_039">through which an application can receive or send data to some resource external to</span></div>
<div style="position:absolute;left:93.18px;top:206.66px" class="cls_039"><span class="cls_039">the application itself. One such resource that an application may integrate with is the</span></div>
<div style="position:absolute;left:93.18px;top:219.65px" class="cls_039"><span class="cls_039">filesystem. Therefore, among Spring Integration’s many components are channel</span></div>
<div style="position:absolute;left:93.18px;top:232.67px" class="cls_039"><span class="cls_039">adapters for reading and writing files.</span></div>
<div style="position:absolute;left:107.85px;top:245.66px" class="cls_039"><span class="cls_039">To get your feet wet with Spring Integration, you’re going to create an integration</span></div>
<div style="position:absolute;left:93.18px;top:258.65px" class="cls_039"><span class="cls_039">flow that writes data to the filesystem. To get started, you need to add Spring Integra-</span></div>
<div style="position:absolute;left:93.18px;top:271.67px" class="cls_039"><span class="cls_039">tion to your project build. For Maven, the necessary dependencies are as follows:</span></div>
<div style="position:absolute;left:93.18px;top:291.35px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:301.34px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:311.33px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-boot-starter-integration&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:93.18px;top:321.35px" class="cls_060"><span class="cls_060">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:93.18px;top:341.33px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:351.35px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.integration&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:361.34px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-integration-file&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:93.18px;top:371.33px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:93.18px;top:392.66px" class="cls_039"><span class="cls_039">The first dependency is the Spring Boot starter for Spring Integration. This depen-</span></div>
<div style="position:absolute;left:93.18px;top:405.68px" class="cls_039"><span class="cls_039">dency is essential to developing a Spring Integration flow, regardless of what the flow</span></div>
<div style="position:absolute;left:93.18px;top:418.67px" class="cls_039"><span class="cls_039">may integrate with. Like all Spring Boot starter dependencies, it’s available as a check</span></div>
<div style="position:absolute;left:93.18px;top:431.66px" class="cls_039"><span class="cls_039">box in the Initializr form.</span></div>
<div style="position:absolute;left:109.30px;top:444.68px" class="cls_039"><span class="cls_039">The second dependency is for Spring Integration’s file endpoint module. This</span></div>
<div style="position:absolute;left:93.18px;top:457.67px" class="cls_039"><span class="cls_039">module is one of over two dozen endpoint modules used to integrate with external</span></div>
<div style="position:absolute;left:93.18px;top:470.66px" class="cls_039"><span class="cls_039">systems. We’ll talk more about the endpoint modules in section 9.2.9. But, for now,</span></div>
<div style="position:absolute;left:93.18px;top:483.68px" class="cls_039"><span class="cls_039">know that the file endpoint module offers the ability to ingest files from the filesystem</span></div>
<div style="position:absolute;left:93.18px;top:496.67px" class="cls_039"><span class="cls_039">into an integration flow and/or to write data from a flow to the filesystem.</span></div>
<div style="position:absolute;left:108.02px;top:509.66px" class="cls_039"><span class="cls_039">Next you need to create a way for the application to send data into an integration</span></div>
<div style="position:absolute;left:93.18px;top:522.68px" class="cls_039"><span class="cls_039">flow so that it can be written to a file. To do that, you’ll create a gateway interface,</span></div>
<div style="position:absolute;left:93.18px;top:535.67px" class="cls_039"><span class="cls_039">such as the one shown next.</span></div>
<div style="position:absolute;left:105.18px;top:559.40px" class="cls_066"><span class="cls_066">Listing 9.1</span></div>
<div style="position:absolute;left:157.27px;top:559.40px" class="cls_066"><span class="cls_066">Message gateway interface to transform method invocations into messages</span></div>
<div style="position:absolute;left:93.18px;top:579.26px" class="cls_060"><span class="cls_060">package sia5;</span></div>
<div style="position:absolute;left:93.18px;top:589.25px" class="cls_060"><span class="cls_060">import org.springframework.integration.annotation.MessagingGateway;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:154124px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background233.jpg" width="531" height="666"></div>
<div style="position:absolute;left:207.18px;top:24.35px" class="cls_055"><span class="cls_055">Declaring a simple integration flow</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">211</span></div>
<div style="position:absolute;left:102.18px;top:51.32px" class="cls_060"><span class="cls_060">import org.springframework.integration.file.FileHeaders;</span></div>
<div style="position:absolute;left:102.18px;top:61.34px" class="cls_060"><span class="cls_060">import org.springframework.messaging.handler.annotation.Header;</span></div>
<div style="position:absolute;left:102.18px;top:84.32px" class="cls_060"><span class="cls_060">@MessagingGateway(defaultRequestChannel="textInChannel")</span></div>
<div style="position:absolute;left:412.62px;top:87.62px" class="cls_067"><span class="cls_067">Declares a</span></div>
<div style="position:absolute;left:102.18px;top:94.34px" class="cls_060"><span class="cls_060">public interface FileWriterGateway {</span></div>
<div style="position:absolute;left:412.62px;top:97.13px" class="cls_067"><span class="cls_067">message gateway</span></div>
<div style="position:absolute;left:111.78px;top:117.32px" class="cls_060"><span class="cls_060">void writeToFile(</span></div>
<div style="position:absolute;left:130.95px;top:127.34px" class="cls_060"><span class="cls_060">@Header(FileHeaders.FILENAME) String filename,</span></div>
<div style="position:absolute;left:393.42px;top:126.95px" class="cls_067"><span class="cls_067">Writes to a file</span></div>
<div style="position:absolute;left:130.95px;top:137.33px" class="cls_060"><span class="cls_060">String data);</span></div>
<div style="position:absolute;left:102.18px;top:157.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:181.67px" class="cls_039"><span class="cls_039">Although it’s a simple Java interface, there’s a lot to be said about </span><span class="cls_059">FileWriterGateway</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:102.18px;top:194.66px" class="cls_039"><span class="cls_039">The first thing you’ll notice is that it’s annotated with </span><span class="cls_059">@MessagingGateway</span><span class="cls_039">. This</span></div>
<div style="position:absolute;left:102.18px;top:207.65px" class="cls_039"><span class="cls_039">annotation tells Spring Integration to generate an implementation of this interface</span></div>
<div style="position:absolute;left:102.18px;top:220.67px" class="cls_039"><span class="cls_039">at runtime—similar to how Spring Data automatically generates implementations of</span></div>
<div style="position:absolute;left:102.18px;top:233.66px" class="cls_039"><span class="cls_039">repository interfaces. Other parts of the code will use this interface when they need to</span></div>
<div style="position:absolute;left:102.18px;top:246.65px" class="cls_039"><span class="cls_039">write a file.</span></div>
<div style="position:absolute;left:118.02px;top:259.67px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">defaultRequestChannel</span><span class="cls_039"> attribute of </span><span class="cls_059">@MessagingGateway</span><span class="cls_039"> indicates that any</span></div>
<div style="position:absolute;left:102.18px;top:272.66px" class="cls_039"><span class="cls_039">messages resulting from a call to the interface methods should be sent to the given</span></div>
<div style="position:absolute;left:102.18px;top:285.65px" class="cls_039"><span class="cls_039">message channel. In this case, you state that any messages that result from a call to</span></div>
<div style="position:absolute;left:102.18px;top:298.67px" class="cls_059"><span class="cls_059">writeToFile()</span><span class="cls_039"> should be sent to the channel whose name is </span><span class="cls_059">textInChannel</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.32px;top:311.66px" class="cls_039"><span class="cls_039">As for the </span><span class="cls_059">writeToFile()</span><span class="cls_039"> method, it accepts a filename as a </span><span class="cls_059">String</span><span class="cls_039"> and another</span></div>
<div style="position:absolute;left:102.18px;top:324.68px" class="cls_059"><span class="cls_059">String</span><span class="cls_039"> that is to contain the text that should be written to a file. What’s notable about</span></div>
<div style="position:absolute;left:102.18px;top:337.67px" class="cls_039"><span class="cls_039">this method signature is that the </span><span class="cls_059">filename</span><span class="cls_039"> parameter is annotated with </span><span class="cls_059">@Header</span><span class="cls_039">. In</span></div>
<div style="position:absolute;left:102.18px;top:350.66px" class="cls_039"><span class="cls_039">this case, the </span><span class="cls_059">@Header</span><span class="cls_039"> annotation indicates that the value passed to </span><span class="cls_059">filename</span><span class="cls_039"> should</span></div>
<div style="position:absolute;left:102.18px;top:363.68px" class="cls_039"><span class="cls_039">be placed in a message header (specified as </span><span class="cls_059">FileHeaders.FILENAME,</span><span class="cls_039"> which resolves</span></div>
<div style="position:absolute;left:102.18px;top:376.67px" class="cls_039"><span class="cls_039">to </span><span class="cls_059">file_name</span><span class="cls_039">) rather than in the message payload. The </span><span class="cls_059">data</span><span class="cls_039"> parameter value, on the</span></div>
<div style="position:absolute;left:102.18px;top:389.66px" class="cls_039"><span class="cls_039">other hand, is carried in the message payload.</span></div>
<div style="position:absolute;left:117.79px;top:402.68px" class="cls_039"><span class="cls_039">Now that you’ve a message gateway, you need to configure the integration flow.</span></div>
<div style="position:absolute;left:102.18px;top:415.67px" class="cls_039"><span class="cls_039">Although the Spring Integration starter dependency that you added to your build</span></div>
<div style="position:absolute;left:102.18px;top:428.66px" class="cls_039"><span class="cls_039">enables essential autoconfiguration for Spring Integration, it’s still up to you to write</span></div>
<div style="position:absolute;left:102.18px;top:441.68px" class="cls_039"><span class="cls_039">additional configurations to define flows that meet the needs of the application.</span></div>
<div style="position:absolute;left:102.18px;top:454.67px" class="cls_039"><span class="cls_039">Three configuration options for declaring integration flows include these:</span></div>
<div style="position:absolute;left:117.78px;top:471.68px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  XML configuration</span></div>
<div style="position:absolute;left:117.78px;top:485.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Java configuration</span></div>
<div style="position:absolute;left:117.78px;top:499.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Java configuration with a DSL</span></div>
<div style="position:absolute;left:102.18px;top:517.67px" class="cls_039"><span class="cls_039">We’ll take a look at all three of these configuration styles for Spring Integration, start-</span></div>
<div style="position:absolute;left:102.18px;top:530.66px" class="cls_039"><span class="cls_039">ing with the old-timer, XML configuration.</span></div>
<div style="position:absolute;left:66.18px;top:555.50px" class="cls_063"><span class="cls_063">9.1.1</span></div>
<div style="position:absolute;left:102.18px;top:555.50px" class="cls_063"><span class="cls_063">Defining integration flows with XML</span></div>
<div style="position:absolute;left:102.18px;top:573.17px" class="cls_039"><span class="cls_039">Although I’ve avoided using XML configuration in this book, Spring Integration has a</span></div>
<div style="position:absolute;left:102.18px;top:586.19px" class="cls_039"><span class="cls_039">long history of integration flows defined in XML. Therefore, I think it worthwhile for</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:154800px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background234.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">212</span></div>
<div style="position:absolute;left:206.49px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 9</span></div>
<div style="position:absolute;left:250.62px;top:24.35px" class="cls_055"><span class="cls_055">Integrating Spring</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">me to show at least one example of an XML-defined integration flow. The following</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">listing shows how to configure your sample flow in XML.</span></div>
<div style="position:absolute;left:105.18px;top:87.38px" class="cls_066"><span class="cls_066">Listing 9.2</span></div>
<div style="position:absolute;left:157.26px;top:87.38px" class="cls_066"><span class="cls_066">Defining an integration flow with Spring XML configuration</span></div>
<div style="position:absolute;left:93.18px;top:107.24px" class="cls_060"><span class="cls_060">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></div>
<div style="position:absolute;left:93.18px;top:117.23px" class="cls_060"><span class="cls_060">&lt;beans xmlns="</span><a href="http://www.springframework.org/schema/beans" "="">http://www.springframework.org/schema/beans"</a> </div>
<div style="position:absolute;left:102.78px;top:127.25px" class="cls_060"><span class="cls_060">xmlns:xsi="</span><a href="http://www.w3.org/2001/xmlschema-instance" "="">http://www.w3.org/2001/XMLSchema-instance"</a> </div>
<div style="position:absolute;left:102.78px;top:137.24px" class="cls_060"><span class="cls_060">xmlns:int="</span><a href="http://www.springframework.org/schema/integration" "="">http://www.springframework.org/schema/integration"</a> </div>
<div style="position:absolute;left:102.78px;top:147.23px" class="cls_060"><span class="cls_060">xmlns:int-file="</span><a href="http://www.springframework.org/schema/integration/file" "="">http://www.springframework.org/schema/integration/file"</a> </div>
<div style="position:absolute;left:102.78px;top:157.25px" class="cls_060"><span class="cls_060">xsi:schemaLocation="</span><a href="http://www.springframework.org/schema/beans/">http://www.springframework.org/schema/beans</a> </div>
<div style="position:absolute;left:112.38px;top:167.24px" class="cls_060"><span class="cls_060"> </span><a href="http://www.springframework.org/schema/beans/spring-beans.xsd/">http://www.springframework.org/schema/beans/spring-beans.xsd</a> </div>
<div style="position:absolute;left:112.38px;top:177.23px" class="cls_060"><span class="cls_060"> </span><a href="http://www.springframework.org/schema/integration/">http://www.springframework.org/schema/integration</a> </div>
<div style="position:absolute;left:112.38px;top:187.25px" class="cls_060"><span class="cls_060"> </span><a href="http://www.springframework.org/schema/integration/spring-integration.xsd/">http://www.springframework.org/schema/integration/spring-integration.xsd</a> </div>
<div style="position:absolute;left:112.38px;top:197.24px" class="cls_060"><span class="cls_060"> </span><a href="http://www.springframework.org/schema/integration/file/">http://www.springframework.org/schema/integration/file</a> </div>
<div style="position:absolute;left:112.38px;top:207.23px" class="cls_060"><span class="cls_060"> </span><a href="http://www.springframework.org/schema/integration/file/spring-/">http://www.springframework.org/schema/integration/file/spring-</a> </div>
<div style="position:absolute;left:117.18px;top:217.25px" class="cls_060"><span class="cls_060">integration-file.xsd"&gt;</span></div>
<div style="position:absolute;left:102.77px;top:237.23px" class="cls_060"><span class="cls_060">&lt;int:channel id="textInChannel" /&gt;</span></div>
<div style="position:absolute;left:330.78px;top:240.53px" class="cls_067"><span class="cls_067">Declares</span></div>
<div style="position:absolute;left:330.78px;top:250.04px" class="cls_067"><span class="cls_067">textInChannel</span></div>
<div style="position:absolute;left:102.78px;top:257.24px" class="cls_060"><span class="cls_060">&lt;int:transformer id="upperCase"</span></div>
<div style="position:absolute;left:121.95px;top:267.23px" class="cls_060"><span class="cls_060">input-channel="textInChannel"</span></div>
<div style="position:absolute;left:121.95px;top:277.25px" class="cls_060"><span class="cls_060">output-channel="fileWriterChannel"</span></div>
<div style="position:absolute;left:121.96px;top:287.24px" class="cls_060"><span class="cls_060">expression="payload.toUpperCase()" /&gt;</span></div>
<div style="position:absolute;left:354.42px;top:286.88px" class="cls_067"><span class="cls_067">Transforms the text</span></div>
<div style="position:absolute;left:102.77px;top:307.25px" class="cls_060"><span class="cls_060">&lt;int:channel id="fileWriterChannel" /&gt;</span></div>
<div style="position:absolute;left:343.62px;top:310.55px" class="cls_067"><span class="cls_067">Declares</span></div>
<div style="position:absolute;left:343.62px;top:320.03px" class="cls_067"><span class="cls_067">fileWriterChannel</span></div>
<div style="position:absolute;left:102.78px;top:327.23px" class="cls_060"><span class="cls_060">&lt;int-file:outbound-channel-adapter id="writer"</span></div>
<div style="position:absolute;left:112.38px;top:337.25px" class="cls_060"><span class="cls_060">channel="fileWriterChannel"</span></div>
<div style="position:absolute;left:112.38px;top:347.24px" class="cls_060"><span class="cls_060">directory="/tmp/sia5/files"</span></div>
<div style="position:absolute;left:112.38px;top:357.23px" class="cls_060"><span class="cls_060">mode="APPEND"</span></div>
<div style="position:absolute;left:112.37px;top:367.25px" class="cls_060"><span class="cls_060">append-new-line="true" /&gt;</span></div>
<div style="position:absolute;left:287.91px;top:370.55px" class="cls_067"><span class="cls_067">Writes the</span></div>
<div style="position:absolute;left:287.91px;top:380.03px" class="cls_067"><span class="cls_067">text to a file</span></div>
<div style="position:absolute;left:93.18px;top:387.23px" class="cls_061"><span class="cls_061">&lt;/beans&gt;</span></div>
<div style="position:absolute;left:93.18px;top:408.56px" class="cls_039"><span class="cls_039">Breaking down the XML in listing 9.2:</span></div>
<div style="position:absolute;left:108.78px;top:425.57px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  You configured a channel named </span><span class="cls_059">textInChannel</span><span class="cls_039">. You’ll recognize this as the</span></div>
<div style="position:absolute;left:120.78px;top:438.56px" class="cls_039"><span class="cls_039">same channel that’s set as the request channel for </span><span class="cls_059">FileWriterGateway</span><span class="cls_039">. When</span></div>
<div style="position:absolute;left:120.78px;top:451.58px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">writeToFile()</span><span class="cls_039"> method is called on </span><span class="cls_059">FileWriterGateway</span><span class="cls_039">, the resulting mes-</span></div>
<div style="position:absolute;left:120.78px;top:464.57px" class="cls_039"><span class="cls_039">sage is published to this channel.</span></div>
<div style="position:absolute;left:108.78px;top:478.58px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  You configured a transformer that receives messages from </span><span class="cls_059">textInChannel</span><span class="cls_039">. It</span></div>
<div style="position:absolute;left:120.78px;top:491.57px" class="cls_039"><span class="cls_039">uses a Spring Expression Language (SpEL) expression to call </span><span class="cls_059">toUpperCase()</span></div>
<div style="position:absolute;left:120.78px;top:504.56px" class="cls_039"><span class="cls_039">on the message payload. The result of the uppercase operation is then pub-</span></div>
<div style="position:absolute;left:120.78px;top:517.58px" class="cls_039"><span class="cls_039">lished to </span><span class="cls_059">fileWriterChannel</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:108.78px;top:531.56px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  You configured the channel named </span><span class="cls_059">fileWriterChannel</span><span class="cls_039">. This channel serves as</span></div>
<div style="position:absolute;left:120.78px;top:544.58px" class="cls_039"><span class="cls_039">the conduit that connects the transformer with the outbound channel adapter.</span></div>
<div style="position:absolute;left:108.78px;top:558.59px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Finally, you configured an outbound channel adapter using the </span><span class="cls_059">int-file</span><span class="cls_039"> name-</span></div>
<div style="position:absolute;left:120.78px;top:571.58px" class="cls_039"><span class="cls_039">space. This XML namespace is provided by Spring Integration’s file module to</span></div>
<div style="position:absolute;left:120.78px;top:584.57px" class="cls_039"><span class="cls_039">write files. As you configured it, it receives messages from </span><span class="cls_059">fileWriterChannel</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:155476px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background235.jpg" width="531" height="666"></div>
<div style="position:absolute;left:207.18px;top:24.35px" class="cls_055"><span class="cls_055">Declaring a simple integration flow</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">213</span></div>
<div style="position:absolute;left:129.78px;top:50.66px" class="cls_039"><span class="cls_039">and writes the message payload to a file whose name is specified in the message’s</span></div>
<div style="position:absolute;left:129.78px;top:63.65px" class="cls_059"><span class="cls_059">file_name</span><span class="cls_039"> header in the directory specified in the </span><span class="cls_059">directory</span><span class="cls_039"> attribute. If the file</span></div>
<div style="position:absolute;left:129.78px;top:76.67px" class="cls_039"><span class="cls_039">already exists, the file will be appended with a newline rather than overwritten.</span></div>
<div style="position:absolute;left:102.18px;top:94.67px" class="cls_039"><span class="cls_039">This flow is illustrated in figure 9.1 using graphical elements styled after those in </span><span class="cls_036">Enter-</span></div>
<div style="position:absolute;left:102.18px;top:107.66px" class="cls_036"><span class="cls_036">prise Integration Patterns</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:120.66px;top:170.75px" class="cls_088"><span class="cls_088">File writer</span></div>
<div style="position:absolute;left:199.20px;top:170.75px" class="cls_088"><span class="cls_088">Text in</span></div>
<div style="position:absolute;left:265.30px;top:170.75px" class="cls_088"><span class="cls_088">Uppercase</span></div>
<div style="position:absolute;left:339.92px;top:170.75px" class="cls_088"><span class="cls_088">File writer</span></div>
<div style="position:absolute;left:410.87px;top:170.75px" class="cls_088"><span class="cls_088">File outbound</span></div>
<div style="position:absolute;left:122.79px;top:179.75px" class="cls_088"><span class="cls_088">gateway</span></div>
<div style="position:absolute;left:197.05px;top:179.75px" class="cls_088"><span class="cls_088">channel</span></div>
<div style="position:absolute;left:264.33px;top:179.75px" class="cls_088"><span class="cls_088">transformer</span></div>
<div style="position:absolute;left:342.83px;top:179.75px" class="cls_088"><span class="cls_088">channel</span></div>
<div style="position:absolute;left:406.98px;top:179.75px" class="cls_088"><span class="cls_088">channel adapter</span></div>
<div style="position:absolute;left:102.18px;top:196.10px" class="cls_053"><span class="cls_053">Figure 9.1</span></div>
<div style="position:absolute;left:146.79px;top:196.10px" class="cls_053"><span class="cls_053">The file writer integration flow</span></div>
<div style="position:absolute;left:102.18px;top:225.02px" class="cls_039"><span class="cls_039">If you want to use XML configuration in a Spring Boot application, you’ll need to</span></div>
<div style="position:absolute;left:102.18px;top:238.01px" class="cls_039"><span class="cls_039">import the XML as a resource into the Spring application. The easiest way to do this is</span></div>
<div style="position:absolute;left:102.18px;top:251.03px" class="cls_039"><span class="cls_039">to use Spring’s </span><span class="cls_059">@ImportResource</span><span class="cls_039"> annotation on one of your application’s Java config-</span></div>
<div style="position:absolute;left:102.18px;top:264.02px" class="cls_039"><span class="cls_039">uration classes:</span></div>
<div style="position:absolute;left:102.18px;top:283.70px" class="cls_060"><span class="cls_060">@Configuration</span></div>
<div style="position:absolute;left:102.18px;top:293.69px" class="cls_060"><span class="cls_060">@ImportResource("classpath:/filewriter-config.xml")</span></div>
<div style="position:absolute;left:102.18px;top:303.71px" class="cls_061"><span class="cls_061">public class FileWriterIntegrationConfig { ... }</span></div>
<div style="position:absolute;left:102.18px;top:325.01px" class="cls_039"><span class="cls_039">Although XML-based configuration has served Spring Integration well, most develop-</span></div>
<div style="position:absolute;left:102.18px;top:338.03px" class="cls_039"><span class="cls_039">ers have grown wary of using XML. (And, as I said, I’m avoiding XML configuration in</span></div>
<div style="position:absolute;left:102.18px;top:351.02px" class="cls_039"><span class="cls_039">this book.) Let’s set aside those angle brackets and turn our attention to Spring Inte-</span></div>
<div style="position:absolute;left:102.18px;top:364.01px" class="cls_039"><span class="cls_039">gration’s Java configuration style.</span></div>
<div style="position:absolute;left:66.18px;top:388.85px" class="cls_063"><span class="cls_063">9.1.2</span></div>
<div style="position:absolute;left:102.18px;top:388.85px" class="cls_063"><span class="cls_063">Configuring integration flows in Java</span></div>
<div style="position:absolute;left:102.18px;top:406.52px" class="cls_039"><span class="cls_039">Most modern Spring applications have eschewed XML configuration in favor of Java</span></div>
<div style="position:absolute;left:102.18px;top:419.54px" class="cls_039"><span class="cls_039">configuration. In fact, in Spring Boot applications, Java configuration is a natural style</span></div>
<div style="position:absolute;left:102.18px;top:432.53px" class="cls_039"><span class="cls_039">to complement autoconfiguration. Therefore, if you’re adding an integration flow to</span></div>
<div style="position:absolute;left:102.18px;top:445.52px" class="cls_039"><span class="cls_039">a Spring Boot application, it makes perfect sense to define the flow in Java.</span></div>
<div style="position:absolute;left:116.69px;top:458.54px" class="cls_039"><span class="cls_039">As a sample of how to write an integration flow with Java configuration, take a look</span></div>
<div style="position:absolute;left:102.18px;top:471.53px" class="cls_039"><span class="cls_039">at the next listing. This shows the same file-writing integration flow as before, but this</span></div>
<div style="position:absolute;left:102.18px;top:484.52px" class="cls_039"><span class="cls_039">time it’s written in Java.</span></div>
<div style="position:absolute;left:114.18px;top:508.25px" class="cls_066"><span class="cls_066">Listing 9.3</span></div>
<div style="position:absolute;left:166.27px;top:508.25px" class="cls_066"><span class="cls_066">Using Java configuration to define an integration flow</span></div>
<div style="position:absolute;left:102.18px;top:528.11px" class="cls_060"><span class="cls_060">package sia5;</span></div>
<div style="position:absolute;left:102.18px;top:538.10px" class="cls_060"><span class="cls_060">import java.io.File;</span></div>
<div style="position:absolute;left:102.18px;top:548.12px" class="cls_060"><span class="cls_060">import org.springframework.context.annotation.Bean;</span></div>
<div style="position:absolute;left:102.18px;top:558.11px" class="cls_060"><span class="cls_060">import org.springframework.context.annotation.Configuration;</span></div>
<div style="position:absolute;left:102.18px;top:568.10px" class="cls_060"><span class="cls_060">import org.springframework.integration.annotation.ServiceActivator;</span></div>
<div style="position:absolute;left:102.18px;top:578.12px" class="cls_060"><span class="cls_060">import org.springframework.integration.annotation.Transformer;</span></div>
<div style="position:absolute;left:102.18px;top:588.11px" class="cls_060"><span class="cls_060">import org.springframework.integration.file.FileWritingMessageHandler;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:156152px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background236.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">214</span></div>
<div style="position:absolute;left:206.49px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 9</span></div>
<div style="position:absolute;left:250.62px;top:24.35px" class="cls_055"><span class="cls_055">Integrating Spring</span></div>
<div style="position:absolute;left:93.18px;top:51.32px" class="cls_060"><span class="cls_060">import org.springframework.integration.file.support.FileExistsMode;</span></div>
<div style="position:absolute;left:93.18px;top:61.34px" class="cls_060"><span class="cls_060">import org.springframework.integration.transformer.GenericTransformer;</span></div>
<div style="position:absolute;left:93.18px;top:81.32px" class="cls_060"><span class="cls_060">@Configuration</span></div>
<div style="position:absolute;left:93.18px;top:91.34px" class="cls_060"><span class="cls_060">public class FileWriterIntegrationConfig {</span></div>
<div style="position:absolute;left:356.49px;top:107.66px" class="cls_067"><span class="cls_067">Declares a</span></div>
<div style="position:absolute;left:102.78px;top:111.32px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:356.49px;top:117.14px" class="cls_067"><span class="cls_067">transformer</span></div>
<div style="position:absolute;left:102.78px;top:121.34px" class="cls_060"><span class="cls_060">@Transformer(inputChannel="textInChannel",</span></div>
<div style="position:absolute;left:165.15px;top:131.33px" class="cls_060"><span class="cls_060">outputChannel="fileWriterChannel")</span></div>
<div style="position:absolute;left:102.78px;top:141.35px" class="cls_060"><span class="cls_060">public GenericTransformer&lt;String, String&gt; upperCaseTransformer() {</span></div>
<div style="position:absolute;left:112.38px;top:151.34px" class="cls_060"><span class="cls_060">return text -&gt; text.toUpperCase();</span></div>
<div style="position:absolute;left:102.78px;top:161.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.78px;top:181.34px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:377.91px;top:187.64px" class="cls_067"><span class="cls_067">Declares a</span></div>
<div style="position:absolute;left:102.78px;top:191.33px" class="cls_060"><span class="cls_060">@ServiceActivator(inputChannel="fileWriterChannel")</span></div>
<div style="position:absolute;left:377.91px;top:197.15px" class="cls_067"><span class="cls_067">file writer</span></div>
<div style="position:absolute;left:102.78px;top:201.35px" class="cls_060"><span class="cls_060">public FileWritingMessageHandler fileWriter() {</span></div>
<div style="position:absolute;left:112.36px;top:211.34px" class="cls_060"><span class="cls_060">FileWritingMessageHandler handler =</span></div>
<div style="position:absolute;left:131.53px;top:221.33px" class="cls_060"><span class="cls_060">new FileWritingMessageHandler(new File("/tmp/sia5/files"));</span></div>
<div style="position:absolute;left:112.38px;top:231.35px" class="cls_060"><span class="cls_060">handler.setExpectReply(false);</span></div>
<div style="position:absolute;left:112.38px;top:241.34px" class="cls_060"><span class="cls_060">handler.setFileExistsMode(FileExistsMode.APPEND);</span></div>
<div style="position:absolute;left:112.38px;top:251.33px" class="cls_060"><span class="cls_060">handler.setAppendNewLine(true);</span></div>
<div style="position:absolute;left:112.38px;top:261.35px" class="cls_060"><span class="cls_060">return handler;</span></div>
<div style="position:absolute;left:102.78px;top:271.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:291.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:315.68px" class="cls_039"><span class="cls_039">With Java configuration, you declare two beans: a transformer and a file-writing mes-</span></div>
<div style="position:absolute;left:93.18px;top:328.67px" class="cls_039"><span class="cls_039">sage handler. The transformer is a </span><span class="cls_059">GenericTransformer</span><span class="cls_039">. Because </span><span class="cls_059">GenericTransformer</span></div>
<div style="position:absolute;left:93.18px;top:341.66px" class="cls_039"><span class="cls_039">is a functional interface, you’re able to provide its implementation as a lambda that</span></div>
<div style="position:absolute;left:93.18px;top:354.68px" class="cls_039"><span class="cls_039">calls </span><span class="cls_059">toUpperCase()</span><span class="cls_039"> on the message text. The transformer bean is annotated with</span></div>
<div style="position:absolute;left:93.18px;top:367.67px" class="cls_059"><span class="cls_059">@Transformer</span><span class="cls_039"> designating it as a transformer in the integration flow that receives mes-</span></div>
<div style="position:absolute;left:93.18px;top:380.66px" class="cls_039"><span class="cls_039">sages on a channel named </span><span class="cls_059">textInChannel</span><span class="cls_039"> and writes messages to the channel named</span></div>
<div style="position:absolute;left:93.18px;top:393.68px" class="cls_059"><span class="cls_059">fileWriterChannel</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:107.60px;top:406.67px" class="cls_039"><span class="cls_039">As for the file-writing bean, it’s annotated with </span><span class="cls_059">@ServiceActivator</span><span class="cls_039"> to indicate that</span></div>
<div style="position:absolute;left:93.18px;top:419.66px" class="cls_039"><span class="cls_039">it’ll accept messages from </span><span class="cls_059">fileWriterChannel</span><span class="cls_039"> and hand those messages over to the</span></div>
<div style="position:absolute;left:93.18px;top:432.68px" class="cls_039"><span class="cls_039">service defined by an instance of </span><span class="cls_059">FileWritingMessageHandler</span><span class="cls_039">. </span><span class="cls_059">FileWritingMessage-</span></div>
<div style="position:absolute;left:93.18px;top:445.67px" class="cls_059"><span class="cls_059">Handler</span><span class="cls_039"> is a message handler that writes a message payload to a file in a specified</span></div>
<div style="position:absolute;left:93.18px;top:458.66px" class="cls_039"><span class="cls_039">directory using a filename specified in the message’s </span><span class="cls_059">file_name</span><span class="cls_039"> header. As with the</span></div>
<div style="position:absolute;left:93.18px;top:471.68px" class="cls_039"><span class="cls_039">XML example, </span><span class="cls_059">FileWritingMessageHandler</span><span class="cls_039"> is configured to append to the file with</span></div>
<div style="position:absolute;left:93.18px;top:484.67px" class="cls_039"><span class="cls_039">a newline.</span></div>
<div style="position:absolute;left:109.29px;top:497.66px" class="cls_039"><span class="cls_039">One thing unique about the configuration of the </span><span class="cls_059">FileWritingMessageHandler</span></div>
<div style="position:absolute;left:93.18px;top:510.68px" class="cls_039"><span class="cls_039">bean is that there’s a call to </span><span class="cls_059">setExpectReply(false)</span><span class="cls_039"> to indicate that the service activa-</span></div>
<div style="position:absolute;left:93.18px;top:523.67px" class="cls_039"><span class="cls_039">tor shouldn’t expect a reply channel (a channel through which a value may be returned</span></div>
<div style="position:absolute;left:93.18px;top:536.66px" class="cls_039"><span class="cls_039">to upstream components in the flow). If you don’t call </span><span class="cls_059">setExpectReply()</span><span class="cls_039">, the file-</span></div>
<div style="position:absolute;left:93.18px;top:549.68px" class="cls_039"><span class="cls_039">writing bean defaults to </span><span class="cls_059">true</span><span class="cls_039"> and, although the pipeline still functions as expected,</span></div>
<div style="position:absolute;left:93.18px;top:562.67px" class="cls_039"><span class="cls_039">you’ll see a few errors logged stating that no reply channel was configured.</span></div>
<div style="position:absolute;left:108.00px;top:575.69px" class="cls_039"><span class="cls_039">You’ll also notice that you didn’t need to explicitly declare the channels. The </span><span class="cls_059">text-</span></div>
<div style="position:absolute;left:93.27px;top:588.68px" class="cls_059"><span class="cls_059">InChannel</span><span class="cls_039"> and </span><span class="cls_059">fileWriterChannel</span><span class="cls_039"> channels will be created automatically if no beans</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:156828px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background237.jpg" width="531" height="666"></div>
<div style="position:absolute;left:207.18px;top:24.35px" class="cls_055"><span class="cls_055">Declaring a simple integration flow</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">215</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">with those names exist. But if you want more control over how the channels are con-</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">figured, you can explicitly construct them as beans like this:</span></div>
<div style="position:absolute;left:102.18px;top:83.33px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:102.18px;top:93.32px" class="cls_060"><span class="cls_060">public MessageChannel textInChannel() {</span></div>
<div style="position:absolute;left:111.78px;top:103.34px" class="cls_060"><span class="cls_060">return new DirectChannel();</span></div>
<div style="position:absolute;left:102.18px;top:113.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:145.34px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:102.18px;top:155.33px" class="cls_060"><span class="cls_060">public MessageChannel fileWriterChannel() {</span></div>
<div style="position:absolute;left:111.78px;top:165.35px" class="cls_060"><span class="cls_060">return new DirectChannel();</span></div>
<div style="position:absolute;left:102.18px;top:175.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:196.67px" class="cls_039"><span class="cls_039">The Java configuration option is arguably easier to read  and slightly briefer, and is</span></div>
<div style="position:absolute;left:102.18px;top:209.66px" class="cls_039"><span class="cls_039">certainly consistent with the Java-only configuration I’m shooting for in this book. But</span></div>
<div style="position:absolute;left:102.18px;top:222.65px" class="cls_039"><span class="cls_039">it can be made even more streamlined with Spring Integration’s Java DSL (domain-</span></div>
<div style="position:absolute;left:102.18px;top:235.67px" class="cls_039"><span class="cls_039">specific language) configuration style.</span></div>
<div style="position:absolute;left:66.18px;top:257.48px" class="cls_063"><span class="cls_063">9.1.3</span></div>
<div style="position:absolute;left:102.18px;top:257.48px" class="cls_063"><span class="cls_063">Using Spring Integration’s DSL configuration</span></div>
<div style="position:absolute;left:102.18px;top:274.67px" class="cls_039"><span class="cls_039">Let’s take one more stab at defining the file-writing integration flow. This time, you’ll</span></div>
<div style="position:absolute;left:102.18px;top:287.66px" class="cls_039"><span class="cls_039">still define it in Java, but you’ll use Spring Integration’s Java DSL. Rather than declare</span></div>
<div style="position:absolute;left:102.18px;top:300.68px" class="cls_039"><span class="cls_039">an individual bean for each component in the flow, you’ll declare a single bean that</span></div>
<div style="position:absolute;left:102.18px;top:313.67px" class="cls_039"><span class="cls_039">defines the entire flow.</span></div>
<div style="position:absolute;left:114.18px;top:337.40px" class="cls_066"><span class="cls_066">Listing 9.4</span></div>
<div style="position:absolute;left:166.28px;top:337.40px" class="cls_066"><span class="cls_066">Providing a fluent API for designing integration flows</span></div>
<div style="position:absolute;left:102.18px;top:357.23px" class="cls_060"><span class="cls_060">package sia5;</span></div>
<div style="position:absolute;left:102.18px;top:367.25px" class="cls_060"><span class="cls_060">import java.io.File;</span></div>
<div style="position:absolute;left:102.18px;top:377.24px" class="cls_060"><span class="cls_060">import org.springframework.context.annotation.Bean;</span></div>
<div style="position:absolute;left:102.18px;top:387.26px" class="cls_060"><span class="cls_060">import org.springframework.context.annotation.Configuration;</span></div>
<div style="position:absolute;left:102.18px;top:397.25px" class="cls_060"><span class="cls_060">import org.springframework.integration.dsl.IntegrationFlow;</span></div>
<div style="position:absolute;left:102.18px;top:407.24px" class="cls_060"><span class="cls_060">import org.springframework.integration.dsl.IntegrationFlows;</span></div>
<div style="position:absolute;left:102.18px;top:417.26px" class="cls_060"><span class="cls_060">import org.springframework.integration.dsl.channel.MessageChannels;</span></div>
<div style="position:absolute;left:102.18px;top:427.25px" class="cls_060"><span class="cls_060">import org.springframework.integration.file.dsl.Files;</span></div>
<div style="position:absolute;left:102.18px;top:437.24px" class="cls_060"><span class="cls_060">import org.springframework.integration.file.support.FileExistsMode;</span></div>
<div style="position:absolute;left:102.18px;top:453.26px" class="cls_060"><span class="cls_060">@Configuration</span></div>
<div style="position:absolute;left:102.18px;top:463.25px" class="cls_060"><span class="cls_060">public class FileWriterIntegrationConfig {</span></div>
<div style="position:absolute;left:111.78px;top:479.24px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:399.78px;top:482.69px" class="cls_067"><span class="cls_067">Inbound channel</span></div>
<div style="position:absolute;left:111.77px;top:489.26px" class="cls_060"><span class="cls_060">public IntegrationFlow fileWriterFlow() {</span></div>
<div style="position:absolute;left:121.38px;top:499.25px" class="cls_060"><span class="cls_060">return IntegrationFlows</span></div>
<div style="position:absolute;left:412.62px;top:505.55px" class="cls_067"><span class="cls_067">Declares a</span></div>
<div style="position:absolute;left:140.56px;top:509.24px" class="cls_060"><span class="cls_060">.from(MessageChannels.direct("textInChannel"))</span></div>
<div style="position:absolute;left:412.62px;top:515.06px" class="cls_067"><span class="cls_067">transformer</span></div>
<div style="position:absolute;left:140.55px;top:519.26px" class="cls_060"><span class="cls_060">.&lt;String, String&gt;transform(t -&gt; t.toUpperCase())</span></div>
<div style="position:absolute;left:140.56px;top:529.25px" class="cls_060"><span class="cls_060">.handle(Files</span></div>
<div style="position:absolute;left:404.07px;top:532.55px" class="cls_067"><span class="cls_067">Handles writing</span></div>
<div style="position:absolute;left:159.76px;top:539.24px" class="cls_060"><span class="cls_060">.outboundAdapter(new File("/tmp/sia5/files"))</span></div>
<div style="position:absolute;left:404.07px;top:542.06px" class="cls_067"><span class="cls_067">to a file</span></div>
<div style="position:absolute;left:159.75px;top:549.26px" class="cls_060"><span class="cls_060">.fileExistsMode(FileExistsMode.APPEND)</span></div>
<div style="position:absolute;left:159.75px;top:559.25px" class="cls_060"><span class="cls_060">.appendNewLine(true))</span></div>
<div style="position:absolute;left:140.55px;top:569.24px" class="cls_060"><span class="cls_060">.get();</span></div>
<div style="position:absolute;left:111.78px;top:579.26px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:595.25px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:157504px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background238.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">216</span></div>
<div style="position:absolute;left:206.49px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 9</span></div>
<div style="position:absolute;left:250.62px;top:24.35px" class="cls_055"><span class="cls_055">Integrating Spring</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">This new configuration is as terse as it can possibly be, capturing the entire flow in a</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">single bean method. The </span><span class="cls_059">IntegrationFlows</span><span class="cls_039"> class initiates the builder API, from</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">which you can declare the flow.</span></div>
<div style="position:absolute;left:108.93px;top:89.66px" class="cls_039"><span class="cls_039">In listing 9.4, you start by receiving messages from the channel named </span><span class="cls_059">textIn-</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_059"><span class="cls_059">Channel</span><span class="cls_039">, which then go to a transformer that uppercases the message payload. After</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">the transformer, messages are handled by an outbound channel adapter created from</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">Files</span><span class="cls_039"> type provided in Spring Integration’s file module. Finally, a call to </span><span class="cls_059">get()</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">builds the </span><span class="cls_059">IntegrationFlow</span><span class="cls_039"> to be returned. In short, this one bean method defines</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_039"><span class="cls_039">the same integration flow as the XML and Java configuration examples.</span></div>
<div style="position:absolute;left:107.46px;top:167.66px" class="cls_039"><span class="cls_039">You’ll notice that, as with the Java configuration example, you don’t need to explic-</span></div>
<div style="position:absolute;left:93.18px;top:180.65px" class="cls_039"><span class="cls_039">itly declare channel beans. Although you reference </span><span class="cls_059">textInChannel</span><span class="cls_039">, it’s automatically</span></div>
<div style="position:absolute;left:93.18px;top:193.67px" class="cls_039"><span class="cls_039">created by Spring Integration because there’s no existing channel bean with that</span></div>
<div style="position:absolute;left:93.18px;top:206.66px" class="cls_039"><span class="cls_039">name. But you can explicitly declare the channel bean if you want.</span></div>
<div style="position:absolute;left:107.88px;top:219.65px" class="cls_039"><span class="cls_039">As for the channel that connects the transformer to the outbound channel adapter,</span></div>
<div style="position:absolute;left:93.18px;top:232.67px" class="cls_039"><span class="cls_039">you don’t even reference it by name. If there’s a need to explicitly configure the chan-</span></div>
<div style="position:absolute;left:93.18px;top:245.66px" class="cls_039"><span class="cls_039">nel, you can reference it by name in the flow definition with a call to </span><span class="cls_059">channel()</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:268.34px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:93.18px;top:278.33px" class="cls_060"><span class="cls_060">public IntegrationFlow fileWriterFlow() {</span></div>
<div style="position:absolute;left:102.78px;top:288.35px" class="cls_060"><span class="cls_060">return IntegrationFlows</span></div>
<div style="position:absolute;left:121.95px;top:298.34px" class="cls_060"><span class="cls_060">.from(MessageChannels.direct("textInChannel"))</span></div>
<div style="position:absolute;left:121.96px;top:308.33px" class="cls_060"><span class="cls_060">.&lt;String, String&gt;transform(t -&gt; t.toUpperCase())</span></div>
<div style="position:absolute;left:121.95px;top:318.35px" class="cls_060"><span class="cls_060">.channel(MessageChannels.direct("fileWriterChannel"))</span></div>
<div style="position:absolute;left:121.95px;top:328.34px" class="cls_060"><span class="cls_060">.handle(Files</span></div>
<div style="position:absolute;left:141.15px;top:338.33px" class="cls_060"><span class="cls_060">.outboundAdapter(new File("/tmp/sia5/files"))</span></div>
<div style="position:absolute;left:141.15px;top:348.35px" class="cls_060"><span class="cls_060">.fileExistsMode(FileExistsMode.APPEND)</span></div>
<div style="position:absolute;left:141.15px;top:358.34px" class="cls_060"><span class="cls_060">.appendNewLine(true))</span></div>
<div style="position:absolute;left:121.95px;top:368.33px" class="cls_060"><span class="cls_060">.get();</span></div>
<div style="position:absolute;left:93.18px;top:378.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:401.66px" class="cls_039"><span class="cls_039">One thing to keep in mind when working with Spring Integration’s Java DSL (as with</span></div>
<div style="position:absolute;left:93.18px;top:414.68px" class="cls_039"><span class="cls_039">any fluent API) is that you must employ whitespace shrewdly to maintain readability.</span></div>
<div style="position:absolute;left:93.18px;top:427.67px" class="cls_039"><span class="cls_039">In the example given here, I’ve been careful to indent lines to indicate blocks of</span></div>
<div style="position:absolute;left:93.18px;top:440.66px" class="cls_039"><span class="cls_039">related code. For even longer, more complex flows, you may even consider extracting</span></div>
<div style="position:absolute;left:93.18px;top:453.68px" class="cls_039"><span class="cls_039">portions of the flow into separate methods or subflows for better readability.</span></div>
<div style="position:absolute;left:109.07px;top:466.67px" class="cls_039"><span class="cls_039">Now that you’ve seen a simple flow defined using three different configuration</span></div>
<div style="position:absolute;left:93.18px;top:479.66px" class="cls_039"><span class="cls_039">styles, let’s step back and take a look at Spring Integration’s big picture.</span></div>
<div style="position:absolute;left:57.18px;top:504.85px" class="cls_040"><span class="cls_040">9.2</span></div>
<div style="position:absolute;left:93.18px;top:504.85px" class="cls_040"><span class="cls_040">Surveying the Spring Integration landscape</span></div>
<div style="position:absolute;left:93.18px;top:524.18px" class="cls_039"><span class="cls_039">Spring Integration covers a lot of ground with a multitude of integration scenarios.</span></div>
<div style="position:absolute;left:93.18px;top:537.17px" class="cls_039"><span class="cls_039">Trying to include all of it in a single chapter would be like trying to fit an elephant in</span></div>
<div style="position:absolute;left:93.18px;top:550.19px" class="cls_039"><span class="cls_039">an envelope. Instead of a comprehensive treatment of Spring Integration, I’ll present</span></div>
<div style="position:absolute;left:93.18px;top:563.18px" class="cls_039"><span class="cls_039">a photograph of the Spring Integration elephant to give you some idea of how it</span></div>
<div style="position:absolute;left:93.18px;top:576.17px" class="cls_039"><span class="cls_039">works. Then you’ll create one more integration flow that adds functionality to the</span></div>
<div style="position:absolute;left:93.18px;top:589.19px" class="cls_039"><span class="cls_039">Taco Cloud application.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:158180px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background239.jpg" width="531" height="666"></div>
<div style="position:absolute;left:193.32px;top:24.35px" class="cls_055"><span class="cls_055">Surveying the Spring Integration landscape</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">217</span></div>
<div style="position:absolute;left:118.17px;top:50.66px" class="cls_039"><span class="cls_039">An integration flow is composed of one or more of the following components.</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">Before you write any more code, we’ll take a brief look at the role each of these com-</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">ponents plays in an integration flow:</span></div>
<div style="position:absolute;left:117.78px;top:93.65px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Channels</span><span class="cls_039">—Pass messages from one element to another.</span></div>
<div style="position:absolute;left:117.78px;top:107.66px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Filters</span><span class="cls_039">—Conditionally allow messages to pass through the flow based on some</span></div>
<div style="position:absolute;left:129.78px;top:120.65px" class="cls_039"><span class="cls_039">criteria.</span></div>
<div style="position:absolute;left:117.78px;top:134.66px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Transformers</span><span class="cls_039">—Change message values and/or convert message payloads from</span></div>
<div style="position:absolute;left:129.78px;top:147.65px" class="cls_039"><span class="cls_039">one type to another.</span></div>
<div style="position:absolute;left:117.78px;top:161.66px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Routers</span><span class="cls_039">—Direct messages to one of several channels, typically based on mes-</span></div>
<div style="position:absolute;left:129.78px;top:174.65px" class="cls_039"><span class="cls_039">sage headers.</span></div>
<div style="position:absolute;left:117.78px;top:188.66px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Splitters</span><span class="cls_039">—Split incoming messages into two or more messages, each sent to dif-</span></div>
<div style="position:absolute;left:129.78px;top:201.65px" class="cls_039"><span class="cls_039">ferent channels.</span></div>
<div style="position:absolute;left:117.78px;top:215.66px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Aggregators</span><span class="cls_039">—The opposite of splitters, combining multiple messages coming in</span></div>
<div style="position:absolute;left:129.78px;top:228.65px" class="cls_039"><span class="cls_039">from separate channels into a single message.</span></div>
<div style="position:absolute;left:117.78px;top:242.66px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Service activators</span><span class="cls_039">—Hand a message off to some Java method for processing, and</span></div>
<div style="position:absolute;left:129.78px;top:255.65px" class="cls_039"><span class="cls_039">then publish the return value on an output channel.</span></div>
<div style="position:absolute;left:117.78px;top:269.66px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Channel adapters</span><span class="cls_039">—Connect a channel to some external system or transport. Can</span></div>
<div style="position:absolute;left:129.78px;top:282.65px" class="cls_039"><span class="cls_039">either accept input or write to the external system.</span></div>
<div style="position:absolute;left:117.78px;top:296.66px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Gateways</span><span class="cls_039">—Pass data into an integration flow via an interface.</span></div>
<div style="position:absolute;left:102.18px;top:314.66px" class="cls_039"><span class="cls_039">You’ve already seen a few of these components in play when you defined the file-</span></div>
<div style="position:absolute;left:102.18px;top:327.68px" class="cls_039"><span class="cls_039">writing integration flow. The </span><span class="cls_059">FileWriterGateway</span><span class="cls_039"> interface was the gateway through</span></div>
<div style="position:absolute;left:102.18px;top:340.67px" class="cls_039"><span class="cls_039">which an application submitted text to be written to a file. You also defined a trans-</span></div>
<div style="position:absolute;left:102.18px;top:353.66px" class="cls_039"><span class="cls_039">former to convert the given text to uppercase; then you declared a service gateway</span></div>
<div style="position:absolute;left:102.18px;top:366.68px" class="cls_039"><span class="cls_039">that performed the task of writing the text to a file. And the flow had two channels,</span></div>
<div style="position:absolute;left:102.18px;top:379.67px" class="cls_059"><span class="cls_059">textInChannel</span><span class="cls_039"> and </span><span class="cls_059">fileWriterChannel</span><span class="cls_039">, that connected the other components with</span></div>
<div style="position:absolute;left:102.18px;top:392.66px" class="cls_039"><span class="cls_039">each other. Now, a quick tour of the integration flow components, as promised.</span></div>
<div style="position:absolute;left:66.18px;top:414.50px" class="cls_063"><span class="cls_063">9.2.1</span></div>
<div style="position:absolute;left:102.18px;top:414.50px" class="cls_063"><span class="cls_063">Message channels</span></div>
<div style="position:absolute;left:102.18px;top:431.66px" class="cls_039"><span class="cls_039">Message channels are the means by which messages move through an integration</span></div>
<div style="position:absolute;left:102.18px;top:444.68px" class="cls_039"><span class="cls_039">pipeline (figure 9.2). They’re the pipes that connect all the other parts of Spring Inte-</span></div>
<div style="position:absolute;left:102.18px;top:457.67px" class="cls_039"><span class="cls_039">gration plumbing together.</span></div>
<div style="position:absolute;left:239.64px;top:500.48px" class="cls_053"><span class="cls_053">Figure 9.2</span></div>
<div style="position:absolute;left:284.24px;top:500.48px" class="cls_053"><span class="cls_053">Message channels are conduits</span></div>
<div style="position:absolute;left:239.64px;top:510.50px" class="cls_053"><span class="cls_053">through which data flows between other</span></div>
<div style="position:absolute;left:152.83px;top:521.73px" class="cls_088"><span class="cls_088">Channel</span></div>
<div style="position:absolute;left:239.64px;top:520.49px" class="cls_053"><span class="cls_053">components in an integration flow.</span></div>
<div style="position:absolute;left:102.18px;top:549.32px" class="cls_039"><span class="cls_039">Spring Integration provides several channel implementations, including these:</span></div>
<div style="position:absolute;left:117.78px;top:566.33px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> PublishSubscribeChannel</span><span class="cls_039">—Messages published into a </span><span class="cls_059">PublishSubscribe-</span></div>
<div style="position:absolute;left:129.78px;top:579.32px" class="cls_059"><span class="cls_059">Channel</span><span class="cls_039"> are passed on to one or more consumers. If there are multiple con-</span></div>
<div style="position:absolute;left:129.78px;top:592.31px" class="cls_039"><span class="cls_039">sumers, all of them receive the message.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:158856px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background240.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">218</span></div>
<div style="position:absolute;left:206.49px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 9</span></div>
<div style="position:absolute;left:250.62px;top:24.35px" class="cls_055"><span class="cls_055">Integrating Spring</span></div>
<div style="position:absolute;left:108.78px;top:50.66px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> QueueChannel</span><span class="cls_039">—Messages published into a </span><span class="cls_059">QueueChannel</span><span class="cls_039"> are stored in a queue</span></div>
<div style="position:absolute;left:120.78px;top:63.65px" class="cls_039"><span class="cls_039">until pulled by a consumer in a first in, first out (FIFO) fashion. If there are</span></div>
<div style="position:absolute;left:120.78px;top:76.67px" class="cls_039"><span class="cls_039">multiple consumers, only one of them receives the message.</span></div>
<div style="position:absolute;left:108.78px;top:90.65px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> PriorityChannel</span><span class="cls_039">—Like </span><span class="cls_059">QueueChannel</span><span class="cls_039"> but, rather than FIFO behavior, mes-</span></div>
<div style="position:absolute;left:120.78px;top:103.67px" class="cls_039"><span class="cls_039">sages are pulled by consumers based on the message </span><span class="cls_059">priority</span><span class="cls_039"> header.</span></div>
<div style="position:absolute;left:108.78px;top:117.65px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> RendezvousChannel</span><span class="cls_039">—Like </span><span class="cls_059">QueueChannel</span><span class="cls_039"> except that the sender blocks the</span></div>
<div style="position:absolute;left:120.78px;top:130.67px" class="cls_039"><span class="cls_039">channel until a consumer receives the message, effectively synchronizing the</span></div>
<div style="position:absolute;left:120.78px;top:143.66px" class="cls_039"><span class="cls_039">sender with the consumer.</span></div>
<div style="position:absolute;left:108.78px;top:157.67px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> DirectChannel</span><span class="cls_039">—Like </span><span class="cls_059">PublishSubscribeChannel</span><span class="cls_039"> but sends a message to a sin-</span></div>
<div style="position:absolute;left:120.78px;top:170.66px" class="cls_039"><span class="cls_039">gle consumer by invoking the consumer in the same thread as the sender. This</span></div>
<div style="position:absolute;left:120.78px;top:183.65px" class="cls_039"><span class="cls_039">allows for transactions to span across the channel.</span></div>
<div style="position:absolute;left:108.78px;top:197.66px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> ExecutorChannel</span><span class="cls_039">—Similar to </span><span class="cls_059">DirectChannel</span><span class="cls_039"> but the message dispatch occurs</span></div>
<div style="position:absolute;left:120.78px;top:210.65px" class="cls_039"><span class="cls_039">via a </span><span class="cls_059">TaskExecutor</span><span class="cls_039">, taking place in a separate thread from the sender. This</span></div>
<div style="position:absolute;left:120.78px;top:223.67px" class="cls_039"><span class="cls_039">channel type doesn’t support transactions that span the channel.</span></div>
<div style="position:absolute;left:108.78px;top:237.65px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> FluxMessageChannel</span><span class="cls_039">—A Reactive Streams Publisher message channel based on</span></div>
<div style="position:absolute;left:120.78px;top:250.67px" class="cls_039"><span class="cls_039">Project Reactor’s Flux. (We’ll talk more about Reactive Streams, Reactor, and</span></div>
<div style="position:absolute;left:120.78px;top:263.66px" class="cls_039"><span class="cls_039">Flux in chapter 10.)</span></div>
<div style="position:absolute;left:93.18px;top:281.66px" class="cls_039"><span class="cls_039">In both the Java configuration and Java DSL styles, input channels are automatically</span></div>
<div style="position:absolute;left:93.18px;top:294.68px" class="cls_039"><span class="cls_039">created, with </span><span class="cls_059">DirectChannel</span><span class="cls_039"> as the default. But if you want to use a different channel</span></div>
<div style="position:absolute;left:93.18px;top:307.67px" class="cls_039"><span class="cls_039">implementation, you’ll need to explicitly declare the channel as a bean and reference</span></div>
<div style="position:absolute;left:93.18px;top:320.66px" class="cls_039"><span class="cls_039">it in the integration flow. For example, to declare a </span><span class="cls_059">PublishSubscribeChannel</span><span class="cls_039">, you’d</span></div>
<div style="position:absolute;left:93.18px;top:333.68px" class="cls_039"><span class="cls_039">declare the following </span><span class="cls_059">@Bean</span><span class="cls_039"> method:</span></div>
<div style="position:absolute;left:93.18px;top:356.33px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:93.18px;top:366.35px" class="cls_060"><span class="cls_060">public MessageChannel orderChannel() {</span></div>
<div style="position:absolute;left:102.78px;top:376.34px" class="cls_060"><span class="cls_060">return new PublishSubscribeChannel();</span></div>
<div style="position:absolute;left:93.18px;top:386.36px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:409.67px" class="cls_039"><span class="cls_039">Then you’d reference this channel by name in the integration flow definition. For</span></div>
<div style="position:absolute;left:93.18px;top:422.66px" class="cls_039"><span class="cls_039">example, if the channel were being consumed by a service activator bean, you’d refer-</span></div>
<div style="position:absolute;left:93.18px;top:435.68px" class="cls_039"><span class="cls_039">ence it in the </span><span class="cls_059">inputChannel</span><span class="cls_039"> attribute of </span><span class="cls_059">@ServiceActivator</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:460.34px" class="cls_061"><span class="cls_061">@ServiceActivator(inputChannel="orderChannel")</span></div>
<div style="position:absolute;left:93.18px;top:484.67px" class="cls_039"><span class="cls_039">Or, if you’re using the Java DSL configuration style, you’d reference it with a call to</span></div>
<div style="position:absolute;left:93.18px;top:497.66px" class="cls_059"><span class="cls_059">channel()</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:520.34px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:93.18px;top:530.36px" class="cls_060"><span class="cls_060">public IntegrationFlow orderFlow() {</span></div>
<div style="position:absolute;left:102.78px;top:540.35px" class="cls_060"><span class="cls_060">return IntegrationFlows</span></div>
<div style="position:absolute;left:121.95px;top:560.36px" class="cls_060"><span class="cls_060">.channel("orderChannel")</span></div>
<div style="position:absolute;left:121.95px;top:580.34px" class="cls_060"><span class="cls_060">.get();</span></div>
<div style="position:absolute;left:93.18px;top:590.36px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:159532px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background241.jpg" width="531" height="666"></div>
<div style="position:absolute;left:193.32px;top:24.35px" class="cls_055"><span class="cls_055">Surveying the Spring Integration landscape</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">219</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">It’s important to note that if you’re using </span><span class="cls_059">QueueChannel</span><span class="cls_039">, the consumers must be con-</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">figured with a poller. For instance, suppose that you’ve declared a </span><span class="cls_059">QueueChannel</span><span class="cls_039"> bean</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">like this:</span></div>
<div style="position:absolute;left:102.18px;top:96.32px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:102.18px;top:106.34px" class="cls_060"><span class="cls_060">public MessageChannel orderChannel() {</span></div>
<div style="position:absolute;left:111.78px;top:116.33px" class="cls_060"><span class="cls_060">return new QueueChannel();</span></div>
<div style="position:absolute;left:102.18px;top:126.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:147.65px" class="cls_039"><span class="cls_039">You’d need to make sure that the consumer is configured to poll the channel for mes-</span></div>
<div style="position:absolute;left:102.18px;top:160.67px" class="cls_039"><span class="cls_039">sages. In the case of a service activator, the </span><span class="cls_059">@ServiceActivator</span><span class="cls_039"> annotation might look</span></div>
<div style="position:absolute;left:102.18px;top:173.66px" class="cls_039"><span class="cls_039">like this:</span></div>
<div style="position:absolute;left:102.18px;top:193.34px" class="cls_060"><span class="cls_060">@ServiceActivator(inputChannel="orderChannel",</span></div>
<div style="position:absolute;left:188.52px;top:203.33px" class="cls_061"><span class="cls_061">poller=@Poller(fixedRate="1000"))</span></div>
<div style="position:absolute;left:102.18px;top:224.66px" class="cls_039"><span class="cls_039">In this example, the service activator polls from the channel named </span><span class="cls_059">orderChannel</span></div>
<div style="position:absolute;left:102.18px;top:237.65px" class="cls_039"><span class="cls_039">every 1 second (or 1,000 ms).</span></div>
<div style="position:absolute;left:66.18px;top:259.49px" class="cls_063"><span class="cls_063">9.2.2</span></div>
<div style="position:absolute;left:102.18px;top:259.49px" class="cls_063"><span class="cls_063">Filters</span></div>
<div style="position:absolute;left:102.18px;top:276.65px" class="cls_039"><span class="cls_039">Filters can be placed in the midst of an integration pipeline to allow or disallow mes-</span></div>
<div style="position:absolute;left:102.18px;top:289.67px" class="cls_039"><span class="cls_039">sages from proceeding to the next step in the flow (figure 9.3).</span></div>
<div style="position:absolute;left:238.56px;top:334.01px" class="cls_053"><span class="cls_053">Figure 9.3</span></div>
<div style="position:absolute;left:283.20px;top:334.01px" class="cls_053"><span class="cls_053">Filters based on some criteria</span></div>
<div style="position:absolute;left:238.56px;top:344.03px" class="cls_053"><span class="cls_053">allow or disallow messages from proceeding</span></div>
<div style="position:absolute;left:158.09px;top:354.89px" class="cls_089"><span class="cls_089">Filter</span></div>
<div style="position:absolute;left:238.56px;top:354.02px" class="cls_053"><span class="cls_053">in the pipeline.</span></div>
<div style="position:absolute;left:102.18px;top:387.20px" class="cls_039"><span class="cls_039">For example, suppose that messages containing integer values are published through</span></div>
<div style="position:absolute;left:102.18px;top:400.19px" class="cls_039"><span class="cls_039">a channel named </span><span class="cls_059">numberChannel</span><span class="cls_039">, but you only want even numbers to pass on to the</span></div>
<div style="position:absolute;left:102.18px;top:413.21px" class="cls_039"><span class="cls_039">channel named </span><span class="cls_059">evenNumberChannel</span><span class="cls_039">. In that case, you could declare a filter with the</span></div>
<div style="position:absolute;left:102.18px;top:426.20px" class="cls_059"><span class="cls_059">@Filter</span><span class="cls_039"> annotation like this:</span></div>
<div style="position:absolute;left:102.18px;top:445.88px" class="cls_060"><span class="cls_060">@Filter(inputChannel="numberChannel",</span></div>
<div style="position:absolute;left:140.55px;top:455.87px" class="cls_060"><span class="cls_060">outputChannel="evenNumberChannel")</span></div>
<div style="position:absolute;left:102.18px;top:465.89px" class="cls_060"><span class="cls_060">public boolean evenNumberFilter(Integer number) {</span></div>
<div style="position:absolute;left:111.77px;top:475.88px" class="cls_060"><span class="cls_060">return number % 2 == 0;</span></div>
<div style="position:absolute;left:102.18px;top:485.87px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:507.20px" class="cls_039"><span class="cls_039">Alternatively, if you’re using the Java DSL configuration style to define your integra-</span></div>
<div style="position:absolute;left:102.18px;top:520.22px" class="cls_039"><span class="cls_039">tion flow, you could make a call to </span><span class="cls_059">filter()</span><span class="cls_039"> like this:</span></div>
<div style="position:absolute;left:102.18px;top:539.90px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:102.18px;top:549.89px" class="cls_060"><span class="cls_060">public IntegrationFlow evenNumberFlow(AtomicInteger integerSource) {</span></div>
<div style="position:absolute;left:111.78px;top:559.88px" class="cls_060"><span class="cls_060">return IntegrationFlows</span></div>
<div style="position:absolute;left:130.95px;top:579.89px" class="cls_060"><span class="cls_060">.&lt;Integer&gt;filter((p) -&gt; p % 2 == 0)</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:160208px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background242.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">220</span></div>
<div style="position:absolute;left:206.49px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 9</span></div>
<div style="position:absolute;left:250.62px;top:24.35px" class="cls_055"><span class="cls_055">Integrating Spring</span></div>
<div style="position:absolute;left:121.95px;top:51.32px" class="cls_060"><span class="cls_060">.get();</span></div>
<div style="position:absolute;left:93.18px;top:61.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:82.67px" class="cls_039"><span class="cls_039">In this case, you use a lambda to implement the filter. But, in truth, the </span><span class="cls_059">filter()</span></div>
<div style="position:absolute;left:93.18px;top:95.66px" class="cls_039"><span class="cls_039">method accepts a </span><span class="cls_059">GenericSelector</span><span class="cls_039"> as an argument. This means that you can imple-</span></div>
<div style="position:absolute;left:93.18px;top:108.65px" class="cls_039"><span class="cls_039">ment the </span><span class="cls_059">GenericSelector</span><span class="cls_039"> interface instead, should your filtering needs be too</span></div>
<div style="position:absolute;left:93.18px;top:121.67px" class="cls_039"><span class="cls_039">involved for a simple lambda.</span></div>
<div style="position:absolute;left:57.18px;top:143.48px" class="cls_063"><span class="cls_063">9.2.3</span></div>
<div style="position:absolute;left:93.18px;top:143.48px" class="cls_063"><span class="cls_063">Transformers</span></div>
<div style="position:absolute;left:93.18px;top:160.67px" class="cls_039"><span class="cls_039">Transformers perform some operation on messages, typically resulting in a different</span></div>
<div style="position:absolute;left:93.18px;top:173.66px" class="cls_039"><span class="cls_039">message and, possibly, with a different payload type (see figure 9.4). The transforma-</span></div>
<div style="position:absolute;left:93.18px;top:186.65px" class="cls_039"><span class="cls_039">tion can be something simple, such as performing mathematic operations on a num-</span></div>
<div style="position:absolute;left:93.18px;top:199.67px" class="cls_039"><span class="cls_039">ber or manipulating a </span><span class="cls_059">String</span><span class="cls_039"> value. Or the transformation can be more complex,</span></div>
<div style="position:absolute;left:93.18px;top:212.66px" class="cls_039"><span class="cls_039">such as using a </span><span class="cls_059">String</span><span class="cls_039"> value representing an ISBN to look up and return details of the</span></div>
<div style="position:absolute;left:93.18px;top:225.65px" class="cls_039"><span class="cls_039">corresponding book.</span></div>
<div style="position:absolute;left:227.85px;top:286.19px" class="cls_053"><span class="cls_053">Figure 9.4</span></div>
<div style="position:absolute;left:272.48px;top:286.19px" class="cls_053"><span class="cls_053">Transformers morph messages as</span></div>
<div style="position:absolute;left:147.55px;top:296.40px" class="cls_088"><span class="cls_088">Filter</span></div>
<div style="position:absolute;left:227.85px;top:296.21px" class="cls_053"><span class="cls_053">they flow through an integration flow.</span></div>
<div style="position:absolute;left:93.18px;top:326.42px" class="cls_039"><span class="cls_039">For example, suppose that integer values are being published on a channel named</span></div>
<div style="position:absolute;left:93.18px;top:339.41px" class="cls_059"><span class="cls_059">numberChannel</span><span class="cls_039"> and you want to convert those numbers to a </span><span class="cls_059">String</span><span class="cls_039"> containing the</span></div>
<div style="position:absolute;left:93.18px;top:352.43px" class="cls_039"><span class="cls_039">Roman numeral equivalent. In that case, you can declare a bean of type </span><span class="cls_059">Generic-</span></div>
<div style="position:absolute;left:93.18px;top:365.42px" class="cls_059"><span class="cls_059">Transformer</span><span class="cls_039"> and annotate it with </span><span class="cls_059">@Transformer</span><span class="cls_039"> as follows:</span></div>
<div style="position:absolute;left:93.18px;top:385.10px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:93.18px;top:395.09px" class="cls_060"><span class="cls_060">@Transformer(inputChannel="numberChannel",</span></div>
<div style="position:absolute;left:155.56px;top:405.11px" class="cls_060"><span class="cls_060">outputChannel="romanNumberChannel")</span></div>
<div style="position:absolute;left:93.18px;top:415.10px" class="cls_060"><span class="cls_060">public GenericTransformer&lt;Integer, String&gt; romanNumTransformer() {</span></div>
<div style="position:absolute;left:102.78px;top:425.09px" class="cls_060"><span class="cls_060">return RomanNumbers::toRoman;</span></div>
<div style="position:absolute;left:93.18px;top:435.11px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:456.41px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">@Transformer</span><span class="cls_039"> annotation designates this bean as a transformer bean that receives</span></div>
<div style="position:absolute;left:93.18px;top:469.43px" class="cls_059"><span class="cls_059">Integer</span><span class="cls_039"> values from the channel named </span><span class="cls_059">numberChannel</span><span class="cls_039"> and uses a static method</span></div>
<div style="position:absolute;left:93.18px;top:482.42px" class="cls_039"><span class="cls_039">named </span><span class="cls_059">toRoman()</span><span class="cls_039"> to do the conversion. (The </span><span class="cls_059">toRoman()</span><span class="cls_039"> method is statically defined</span></div>
<div style="position:absolute;left:93.18px;top:495.41px" class="cls_039"><span class="cls_039">in a class named </span><span class="cls_059">RomanNumbers</span><span class="cls_039"> and referenced here with a method reference.) The</span></div>
<div style="position:absolute;left:93.18px;top:508.43px" class="cls_039"><span class="cls_039">result is published to the channel named </span><span class="cls_059">romanNumberChannel</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:107.53px;top:521.42px" class="cls_039"><span class="cls_039">In the Java DSL configuration style, it’s even easier with a call to </span><span class="cls_059">transform()</span><span class="cls_039">, pass-</span></div>
<div style="position:absolute;left:93.18px;top:534.41px" class="cls_039"><span class="cls_039">ing in the method reference to the </span><span class="cls_059">toRoman()</span><span class="cls_039"> method:</span></div>
<div style="position:absolute;left:93.18px;top:554.09px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:93.18px;top:564.11px" class="cls_060"><span class="cls_060">public IntegrationFlow transformerFlow() {</span></div>
<div style="position:absolute;left:102.78px;top:574.10px" class="cls_060"><span class="cls_060">return IntegrationFlows</span></div>
<div style="position:absolute;left:121.95px;top:594.11px" class="cls_060"><span class="cls_060">.transform(RomanNumbers::toRoman)</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:160884px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background243.jpg" width="531" height="666"></div>
<div style="position:absolute;left:193.32px;top:24.35px" class="cls_055"><span class="cls_055">Surveying the Spring Integration landscape</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">221</span></div>
<div style="position:absolute;left:130.95px;top:61.34px" class="cls_060"><span class="cls_060">.get();</span></div>
<div style="position:absolute;left:102.18px;top:71.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:92.66px" class="cls_039"><span class="cls_039">Although you’ve used a method reference in both of the transformer code samples,</span></div>
<div style="position:absolute;left:102.18px;top:105.65px" class="cls_039"><span class="cls_039">know that the transformer can also be specified as a lambda. Or, if the transformer is</span></div>
<div style="position:absolute;left:102.18px;top:118.67px" class="cls_039"><span class="cls_039">complex enough to warrant a separate Java class, you can inject it as a bean into the</span></div>
<div style="position:absolute;left:102.18px;top:131.66px" class="cls_039"><span class="cls_039">flow configuration and pass the reference to the </span><span class="cls_059">transform()</span><span class="cls_039"> method:</span></div>
<div style="position:absolute;left:102.18px;top:151.34px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:102.18px;top:161.33px" class="cls_060"><span class="cls_060">public RomanNumberTransformer romanNumberTransformer() {</span></div>
<div style="position:absolute;left:111.78px;top:171.35px" class="cls_060"><span class="cls_060">return new RomanNumberTransformer();</span></div>
<div style="position:absolute;left:102.18px;top:181.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:201.35px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:102.18px;top:211.34px" class="cls_060"><span class="cls_060">public IntegrationFlow transformerFlow(</span></div>
<div style="position:absolute;left:198.10px;top:221.33px" class="cls_060"><span class="cls_060">RomanNumberTransformer romanNumberTransformer) {</span></div>
<div style="position:absolute;left:111.78px;top:231.35px" class="cls_060"><span class="cls_060">return IntegrationFlows</span></div>
<div style="position:absolute;left:130.95px;top:251.33px" class="cls_060"><span class="cls_060">.transform(romanNumberTransformer)</span></div>
<div style="position:absolute;left:130.95px;top:271.34px" class="cls_060"><span class="cls_060">.get();</span></div>
<div style="position:absolute;left:102.18px;top:281.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:301.67px" class="cls_039"><span class="cls_039">Here, you declare a bean of type </span><span class="cls_059">RomanNumberTransformer</span><span class="cls_039">, which itself is an imple-</span></div>
<div style="position:absolute;left:102.18px;top:314.66px" class="cls_039"><span class="cls_039">mentation of Spring Integration’s </span><span class="cls_059">Transformer</span><span class="cls_039"> or </span><span class="cls_059">GenericTransformer</span><span class="cls_039"> interfaces. The</span></div>
<div style="position:absolute;left:102.18px;top:327.68px" class="cls_039"><span class="cls_039">bean is injected into the </span><span class="cls_059">transformerFlow()</span><span class="cls_039"> method and passed to the </span><span class="cls_059">transform()</span></div>
<div style="position:absolute;left:102.18px;top:340.67px" class="cls_039"><span class="cls_039">method when defining the integration flow.</span></div>
<div style="position:absolute;left:66.18px;top:362.48px" class="cls_063"><span class="cls_063">9.2.4</span></div>
<div style="position:absolute;left:102.18px;top:362.48px" class="cls_063"><span class="cls_063">Routers</span></div>
<div style="position:absolute;left:102.18px;top:379.67px" class="cls_039"><span class="cls_039">Routers, based on some routing criteria, allow for branching in an integration flow,</span></div>
<div style="position:absolute;left:102.18px;top:392.66px" class="cls_039"><span class="cls_039">directing messages to different channels (see figure 9.5).</span></div>
<div style="position:absolute;left:239.64px;top:441.95px" class="cls_053"><span class="cls_053">Figure 9.5</span></div>
<div style="position:absolute;left:284.25px;top:441.95px" class="cls_053"><span class="cls_053">Routers direct messages to</span></div>
<div style="position:absolute;left:239.64px;top:451.94px" class="cls_053"><span class="cls_053">different channels, based on some criteria</span></div>
<div style="position:absolute;left:155.36px;top:463.57px" class="cls_088"><span class="cls_088">Router</span></div>
<div style="position:absolute;left:239.64px;top:461.96px" class="cls_053"><span class="cls_053">applied to the messages.</span></div>
<div style="position:absolute;left:102.18px;top:490.22px" class="cls_039"><span class="cls_039">For example, suppose that you have a channel named </span><span class="cls_059">numberChannel</span><span class="cls_039"> through which</span></div>
<div style="position:absolute;left:102.18px;top:503.21px" class="cls_039"><span class="cls_039">integer values flow. And let’s say that you want to direct all messages with even num-</span></div>
<div style="position:absolute;left:102.18px;top:516.20px" class="cls_039"><span class="cls_039">bers to a channel named </span><span class="cls_059">evenChannel</span><span class="cls_039">, while messages with odd numbers are routed</span></div>
<div style="position:absolute;left:102.18px;top:529.22px" class="cls_039"><span class="cls_039">to a channel named </span><span class="cls_059">oddChannel</span><span class="cls_039">. To create such a routing in your integration flow,</span></div>
<div style="position:absolute;left:102.18px;top:542.21px" class="cls_039"><span class="cls_039">you can declare a bean of type </span><span class="cls_059">AbstractMessageRouter</span><span class="cls_039"> and annotate the bean with</span></div>
<div style="position:absolute;left:102.18px;top:555.20px" class="cls_059"><span class="cls_059">@Router</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:102.18px;top:574.88px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:102.18px;top:584.90px" class="cls_060"><span class="cls_060">@Router(inputChannel="numberChannel")</span></div>
<div style="position:absolute;left:102.18px;top:594.89px" class="cls_060"><span class="cls_060">public AbstractMessageRouter evenOddRouter() {</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:161560px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background244.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">222</span></div>
<div style="position:absolute;left:206.49px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 9</span></div>
<div style="position:absolute;left:250.62px;top:24.35px" class="cls_055"><span class="cls_055">Integrating Spring</span></div>
<div style="position:absolute;left:102.78px;top:51.32px" class="cls_060"><span class="cls_060">return new AbstractMessageRouter() {</span></div>
<div style="position:absolute;left:112.38px;top:61.34px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:112.38px;top:71.33px" class="cls_060"><span class="cls_060">protected Collection&lt;MessageChannel&gt;</span></div>
<div style="position:absolute;left:160.35px;top:81.32px" class="cls_060"><span class="cls_060">determineTargetChannels(Message&lt;?&gt; message) {</span></div>
<div style="position:absolute;left:121.96px;top:91.34px" class="cls_060"><span class="cls_060">Integer number = (Integer) message.getPayload();</span></div>
<div style="position:absolute;left:121.95px;top:101.33px" class="cls_060"><span class="cls_060">if (number % 2 == 0) {</span></div>
<div style="position:absolute;left:131.55px;top:111.32px" class="cls_060"><span class="cls_060">return Collections.singleton(evenChannel());</span></div>
<div style="position:absolute;left:121.95px;top:121.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:121.95px;top:131.33px" class="cls_060"><span class="cls_060">return Collections.singleton(oddChannel());</span></div>
<div style="position:absolute;left:112.38px;top:141.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.78px;top:151.34px" class="cls_060"><span class="cls_060">};</span></div>
<div style="position:absolute;left:93.18px;top:161.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:181.34px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:93.18px;top:191.33px" class="cls_060"><span class="cls_060">public MessageChannel evenChannel() {</span></div>
<div style="position:absolute;left:102.78px;top:201.35px" class="cls_060"><span class="cls_060">return new DirectChannel();</span></div>
<div style="position:absolute;left:93.18px;top:211.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:231.35px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:93.18px;top:241.34px" class="cls_060"><span class="cls_060">public MessageChannel oddChannel() {</span></div>
<div style="position:absolute;left:102.78px;top:251.33px" class="cls_060"><span class="cls_060">return new DirectChannel();</span></div>
<div style="position:absolute;left:93.18px;top:261.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:285.65px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">AbstractMessageRouter</span><span class="cls_039"> bean declared here accepts messages from an input</span></div>
<div style="position:absolute;left:93.18px;top:298.67px" class="cls_039"><span class="cls_039">channel named </span><span class="cls_059">numberChannel</span><span class="cls_039">. The implementation, defined as an anonymous</span></div>
<div style="position:absolute;left:93.18px;top:311.66px" class="cls_039"><span class="cls_039">inner class, examines the message payload and, if it’s an even number, returns the</span></div>
<div style="position:absolute;left:93.18px;top:324.68px" class="cls_039"><span class="cls_039">channel named </span><span class="cls_059">evenChannel</span><span class="cls_039"> (declared as a bean after the router bean). Otherwise,</span></div>
<div style="position:absolute;left:93.18px;top:337.67px" class="cls_039"><span class="cls_039">the number in the channel payload must be odd; in which case, the channel named</span></div>
<div style="position:absolute;left:93.18px;top:350.66px" class="cls_059"><span class="cls_059">oddChannel</span><span class="cls_039"> is returned (also declared in a bean declaration method).</span></div>
<div style="position:absolute;left:108.30px;top:363.68px" class="cls_039"><span class="cls_039">In Java DSL form, routers are declared by calling </span><span class="cls_059">route()</span><span class="cls_039"> in the course of a flow</span></div>
<div style="position:absolute;left:93.18px;top:376.67px" class="cls_039"><span class="cls_039">definition, as shown here:</span></div>
<div style="position:absolute;left:93.18px;top:399.35px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:93.18px;top:409.34px" class="cls_060"><span class="cls_060">public IntegrationFlow numberRoutingFlow(AtomicInteger source) {</span></div>
<div style="position:absolute;left:102.78px;top:419.36px" class="cls_060"><span class="cls_060">return IntegrationFlows</span></div>
<div style="position:absolute;left:121.95px;top:439.34px" class="cls_060"><span class="cls_060">.&lt;Integer, String&gt;route(n -&gt; n%2==0 ? "EVEN":"ODD", mapping -&gt; mapping</span></div>
<div style="position:absolute;left:131.57px;top:449.36px" class="cls_060"><span class="cls_060">.subFlowMapping("EVEN", sf -&gt; sf</span></div>
<div style="position:absolute;left:150.77px;top:459.35px" class="cls_060"><span class="cls_060">.&lt;Integer, Integer&gt;transform(n -&gt; n * 10)</span></div>
<div style="position:absolute;left:150.76px;top:469.34px" class="cls_060"><span class="cls_060">.handle((i,h) -&gt; { ... })</span></div>
<div style="position:absolute;left:150.75px;top:479.36px" class="cls_060"><span class="cls_060">)</span></div>
<div style="position:absolute;left:131.56px;top:489.35px" class="cls_060"><span class="cls_060">.subFlowMapping("ODD", sf -&gt; sf</span></div>
<div style="position:absolute;left:150.75px;top:499.34px" class="cls_060"><span class="cls_060">.transform(RomanNumbers::toRoman)</span></div>
<div style="position:absolute;left:150.76px;top:509.36px" class="cls_060"><span class="cls_060">.handle((i,h) -&gt; { ... })</span></div>
<div style="position:absolute;left:150.75px;top:519.35px" class="cls_060"><span class="cls_060">)</span></div>
<div style="position:absolute;left:131.55px;top:529.34px" class="cls_060"><span class="cls_060">)</span></div>
<div style="position:absolute;left:121.95px;top:539.36px" class="cls_060"><span class="cls_060">.get();</span></div>
<div style="position:absolute;left:93.18px;top:549.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:573.68px" class="cls_039"><span class="cls_039">Although it’s still possible to declare an </span><span class="cls_059">AbstractMessageRouter</span><span class="cls_039"> and pass it into</span></div>
<div style="position:absolute;left:93.18px;top:586.67px" class="cls_059"><span class="cls_059">route()</span><span class="cls_039">, this example uses a lambda to determine if a message payload is odd or even.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:162236px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background245.jpg" width="531" height="666"></div>
<div style="position:absolute;left:193.32px;top:24.35px" class="cls_055"><span class="cls_055">Surveying the Spring Integration landscape</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">223</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">If it’s even, then a </span><span class="cls_059">String</span><span class="cls_039"> value of </span><span class="cls_059">EVEN</span><span class="cls_039"> is returned. If it’s odd, then </span><span class="cls_059">ODD</span><span class="cls_039"> is returned.</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">These values are then used to determine which submapping will handle the message.</span></div>
<div style="position:absolute;left:66.18px;top:88.49px" class="cls_063"><span class="cls_063">9.2.5</span></div>
<div style="position:absolute;left:102.18px;top:88.49px" class="cls_063"><span class="cls_063">Splitters</span></div>
<div style="position:absolute;left:102.18px;top:106.16px" class="cls_039"><span class="cls_039">At times, in an integration flow it can be useful to split a message into multiple mes-</span></div>
<div style="position:absolute;left:102.18px;top:119.15px" class="cls_039"><span class="cls_039">sages to be handled independently. Splitters, as illustrated in figure 9.6, will split and</span></div>
<div style="position:absolute;left:102.18px;top:132.17px" class="cls_039"><span class="cls_039">handle those messages for you.</span></div>
<div style="position:absolute;left:239.64px;top:185.06px" class="cls_053"><span class="cls_053">Figure 9.6</span></div>
<div style="position:absolute;left:284.24px;top:185.06px" class="cls_053"><span class="cls_053">Splitters break down messages</span></div>
<div style="position:absolute;left:239.64px;top:195.05px" class="cls_053"><span class="cls_053">into two or more separate messages that can</span></div>
<div style="position:absolute;left:154.92px;top:205.17px" class="cls_088"><span class="cls_088">Splitter</span></div>
<div style="position:absolute;left:239.64px;top:205.04px" class="cls_053"><span class="cls_053">be handled by separate subflows.</span></div>
<div style="position:absolute;left:102.18px;top:236.12px" class="cls_039"><span class="cls_039">Splitters are useful in many circumstances, but there are two essential use cases for</span></div>
<div style="position:absolute;left:102.18px;top:249.14px" class="cls_039"><span class="cls_039">which you might use a splitter:</span></div>
<div style="position:absolute;left:117.78px;top:268.13px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  A message payload contains a collection of items of the same type that you’d like to process</span></div>
<div style="position:absolute;left:129.78px;top:281.12px" class="cls_036"><span class="cls_036">as individual message payloads.</span><span class="cls_039">  For example, a message carrying a list of prod-</span></div>
<div style="position:absolute;left:129.78px;top:294.14px" class="cls_039"><span class="cls_039">ucts might be split into multiple messages with payloads of one product each.</span></div>
<div style="position:absolute;left:117.78px;top:308.12px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  A message payload carries information that, although related, can be split into two or</span></div>
<div style="position:absolute;left:129.78px;top:321.14px" class="cls_036"><span class="cls_036">more messages of different types.</span><span class="cls_039">  For example, a purchase order might carry deliv-</span></div>
<div style="position:absolute;left:129.78px;top:334.13px" class="cls_039"><span class="cls_039">ery, billing, and line-item information. The delivery details might be processed</span></div>
<div style="position:absolute;left:129.78px;top:347.12px" class="cls_039"><span class="cls_039">by one subflow, billing by another, and line items in yet another. In this use</span></div>
<div style="position:absolute;left:129.78px;top:360.14px" class="cls_039"><span class="cls_039">case, the splitter is typically followed by a router that routes messages by payload</span></div>
<div style="position:absolute;left:129.78px;top:373.13px" class="cls_039"><span class="cls_039">type to ensure that the data gets handled by the right subflow.</span></div>
<div style="position:absolute;left:102.18px;top:393.14px" class="cls_039"><span class="cls_039">When splitting a message payload into two or more messages of different types, it’s</span></div>
<div style="position:absolute;left:102.18px;top:406.13px" class="cls_039"><span class="cls_039">usually sufficient to define a POJO that extracts the individual pieces of the incoming</span></div>
<div style="position:absolute;left:102.18px;top:419.12px" class="cls_039"><span class="cls_039">payload and returns them as elements of a collection.</span></div>
<div style="position:absolute;left:117.39px;top:432.14px" class="cls_039"><span class="cls_039">For example, suppose that you want to split a message carrying a purchase order</span></div>
<div style="position:absolute;left:102.18px;top:445.13px" class="cls_039"><span class="cls_039">into two messages: one carrying the billing information and another carrying a list of</span></div>
<div style="position:absolute;left:102.18px;top:458.15px" class="cls_039"><span class="cls_039">line items. The following </span><span class="cls_059">OrderSplitter</span><span class="cls_039"> will do the job:</span></div>
<div style="position:absolute;left:102.18px;top:480.80px" class="cls_060"><span class="cls_060">public class OrderSplitter {</span></div>
<div style="position:absolute;left:111.78px;top:490.82px" class="cls_060"><span class="cls_060">public Collection&lt;Object&gt; splitOrderIntoParts(PurchaseOrder po) {</span></div>
<div style="position:absolute;left:121.36px;top:500.81px" class="cls_060"><span class="cls_060">ArrayList&lt;Object&gt; parts = new ArrayList&lt;&gt;();</span></div>
<div style="position:absolute;left:121.38px;top:510.80px" class="cls_060"><span class="cls_060">parts.add(po.getBillingInfo());</span></div>
<div style="position:absolute;left:121.38px;top:520.82px" class="cls_060"><span class="cls_060">parts.add(po.getLineItems());</span></div>
<div style="position:absolute;left:121.38px;top:530.81px" class="cls_060"><span class="cls_060">return parts;</span></div>
<div style="position:absolute;left:111.78px;top:540.83px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:550.82px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:575.15px" class="cls_039"><span class="cls_039">You can then declare an </span><span class="cls_059">OrderSplitter</span><span class="cls_039"> bean as part of the integration flow by anno-</span></div>
<div style="position:absolute;left:102.18px;top:588.14px" class="cls_039"><span class="cls_039">tating it with </span><span class="cls_059">@Splitter</span><span class="cls_039"> like this:</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:162912px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background246.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">224</span></div>
<div style="position:absolute;left:206.49px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 9</span></div>
<div style="position:absolute;left:250.62px;top:24.35px" class="cls_055"><span class="cls_055">Integrating Spring</span></div>
<div style="position:absolute;left:93.18px;top:51.32px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:93.18px;top:61.34px" class="cls_060"><span class="cls_060">@Splitter(inputChannel="poChannel",</span></div>
<div style="position:absolute;left:141.15px;top:71.33px" class="cls_060"><span class="cls_060">outputChannel="splitOrderChannel")</span></div>
<div style="position:absolute;left:93.18px;top:81.32px" class="cls_060"><span class="cls_060">public OrderSplitter orderSplitter() {</span></div>
<div style="position:absolute;left:102.78px;top:91.34px" class="cls_060"><span class="cls_060">return new OrderSplitter();</span></div>
<div style="position:absolute;left:93.18px;top:101.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:122.66px" class="cls_039"><span class="cls_039">Here, purchase orders arrive on the channel named </span><span class="cls_059">poChannel</span><span class="cls_039"> and are split by</span></div>
<div style="position:absolute;left:93.18px;top:135.65px" class="cls_059"><span class="cls_059">OrderSplitter</span><span class="cls_039">. Then, each item in the returned collection is published as a separate</span></div>
<div style="position:absolute;left:93.18px;top:148.67px" class="cls_039"><span class="cls_039">message in the integration flow to a channel named </span><span class="cls_059">splitOrderChannel</span><span class="cls_039">. At this point</span></div>
<div style="position:absolute;left:93.18px;top:161.66px" class="cls_039"><span class="cls_039">in the flow, you can declare a </span><span class="cls_059">PayloadTypeRouter</span><span class="cls_039"> to route the billing information and</span></div>
<div style="position:absolute;left:93.18px;top:174.65px" class="cls_039"><span class="cls_039">the line items to their own subflow:</span></div>
<div style="position:absolute;left:93.18px;top:194.33px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:93.18px;top:204.35px" class="cls_060"><span class="cls_060">@Router(inputChannel="splitOrderChannel")</span></div>
<div style="position:absolute;left:93.18px;top:214.34px" class="cls_060"><span class="cls_060">public MessageRouter splitOrderRouter() {</span></div>
<div style="position:absolute;left:102.78px;top:224.33px" class="cls_060"><span class="cls_060">PayloadTypeRouter router = new PayloadTypeRouter();</span></div>
<div style="position:absolute;left:102.78px;top:234.35px" class="cls_060"><span class="cls_060">router.setChannelMapping(</span></div>
<div style="position:absolute;left:121.95px;top:244.34px" class="cls_060"><span class="cls_060">BillingInfo.class.getName(), "billingInfoChannel");</span></div>
<div style="position:absolute;left:102.78px;top:254.33px" class="cls_060"><span class="cls_060">router.setChannelMapping(</span></div>
<div style="position:absolute;left:121.95px;top:264.35px" class="cls_060"><span class="cls_060">List.class.getName(), "lineItemsChannel");</span></div>
<div style="position:absolute;left:102.78px;top:274.34px" class="cls_060"><span class="cls_060">return router;</span></div>
<div style="position:absolute;left:93.18px;top:284.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:305.66px" class="cls_039"><span class="cls_039">As its name implies, </span><span class="cls_059">PayloadTypeRouter</span><span class="cls_039"> routes messages to different channels</span></div>
<div style="position:absolute;left:93.18px;top:318.68px" class="cls_039"><span class="cls_039">based on their payload type. As configured here, messages whose payload is of type</span></div>
<div style="position:absolute;left:93.18px;top:331.67px" class="cls_059"><span class="cls_059">BillingInfo</span><span class="cls_039"> are routed to a channel named </span><span class="cls_059">billingInfoChannel</span><span class="cls_039"> for further pro-</span></div>
<div style="position:absolute;left:93.18px;top:344.66px" class="cls_039"><span class="cls_039">cessing. As for the line items, they’re in a </span><span class="cls_059">java.util.List</span><span class="cls_039"> collection; therefore, you</span></div>
<div style="position:absolute;left:93.18px;top:357.68px" class="cls_039"><span class="cls_039">mapped payloads of type </span><span class="cls_059">List</span><span class="cls_039"> to be routed to a channel named </span><span class="cls_059">lineItemsChannel</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:108.00px;top:370.67px" class="cls_039"><span class="cls_039">As things stand, the flow splits into two subflows: one through which </span><span class="cls_059">BillingInfo</span></div>
<div style="position:absolute;left:93.18px;top:383.66px" class="cls_039"><span class="cls_039">objects flow and another through which a </span><span class="cls_059">List&lt;LineItem&gt;</span><span class="cls_039"> flows. But what if you</span></div>
<div style="position:absolute;left:93.18px;top:396.68px" class="cls_039"><span class="cls_039">want to break it down further such that instead of dealing with a </span><span class="cls_059">List</span><span class="cls_039"> of </span><span class="cls_059">LineItem</span><span class="cls_039">s,</span></div>
<div style="position:absolute;left:93.18px;top:409.67px" class="cls_039"><span class="cls_039">you process each </span><span class="cls_059">LineItem</span><span class="cls_039"> separately? All you need to do to split the line-item list</span></div>
<div style="position:absolute;left:93.18px;top:422.66px" class="cls_039"><span class="cls_039">into multiple messages, one for each line item, is write a method (not a bean) that’s</span></div>
<div style="position:absolute;left:93.18px;top:435.68px" class="cls_039"><span class="cls_039">annotated with </span><span class="cls_059">@Splitter</span><span class="cls_039"> and returns a collection of </span><span class="cls_059">LineItem</span><span class="cls_039">s, perhaps some-</span></div>
<div style="position:absolute;left:93.18px;top:448.67px" class="cls_039"><span class="cls_039">thing like this:</span></div>
<div style="position:absolute;left:93.18px;top:468.35px" class="cls_060"><span class="cls_060">@Splitter(inputChannel="lineItemsChannel", outputChannel="lineItemChannel")</span></div>
<div style="position:absolute;left:93.18px;top:478.34px" class="cls_060"><span class="cls_060">public List&lt;LineItem&gt; lineItemSplitter(List&lt;LineItem&gt; lineItems) {</span></div>
<div style="position:absolute;left:102.78px;top:488.36px" class="cls_060"><span class="cls_060">return lineItems;</span></div>
<div style="position:absolute;left:93.18px;top:498.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:519.68px" class="cls_039"><span class="cls_039">When a message carrying a payload of </span><span class="cls_059">List&lt;LineItem&gt;</span><span class="cls_039"> arrives in the channel named</span></div>
<div style="position:absolute;left:93.18px;top:532.67px" class="cls_059"><span class="cls_059">lineItemsChannel</span><span class="cls_039">, it passes into the </span><span class="cls_059">lineItemSplitter()</span><span class="cls_039"> method. Per the rules of a</span></div>
<div style="position:absolute;left:93.18px;top:545.66px" class="cls_039"><span class="cls_039">splitter, the method must return a collection of the items to be split. In this case, you</span></div>
<div style="position:absolute;left:93.18px;top:558.68px" class="cls_039"><span class="cls_039">already have a collection of </span><span class="cls_059">LineItem</span><span class="cls_039">s, so you just return the collection directly. As a</span></div>
<div style="position:absolute;left:93.18px;top:571.67px" class="cls_039"><span class="cls_039">result, each </span><span class="cls_059">LineItem</span><span class="cls_039"> in the collection is published in a message of its own to the</span></div>
<div style="position:absolute;left:93.18px;top:584.69px" class="cls_039"><span class="cls_039">channel named </span><span class="cls_059">lineItemChannel</span><span class="cls_039">.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:163588px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background247.jpg" width="531" height="666"></div>
<div style="position:absolute;left:193.32px;top:24.35px" class="cls_055"><span class="cls_055">Surveying the Spring Integration landscape</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">225</span></div>
<div style="position:absolute;left:116.82px;top:50.66px" class="cls_039"><span class="cls_039">If you’d rather use the Java DSL to declare the same splitter/router configuration,</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">you can do so with calls to </span><span class="cls_059">split()</span><span class="cls_039"> and </span><span class="cls_059">route()</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:102.18px;top:83.33px" class="cls_060"><span class="cls_060">return IntegrationFlows</span></div>
<div style="position:absolute;left:121.38px;top:103.34px" class="cls_060"><span class="cls_060">.split(orderSplitter())</span></div>
<div style="position:absolute;left:121.38px;top:113.33px" class="cls_060"><span class="cls_060">.&lt;Object, String&gt; route(</span></div>
<div style="position:absolute;left:140.56px;top:123.32px" class="cls_060"><span class="cls_060">p -&gt; {</span></div>
<div style="position:absolute;left:150.15px;top:133.34px" class="cls_060"><span class="cls_060">if (p.getClass().isAssignableFrom(BillingInfo.class)) {</span></div>
<div style="position:absolute;left:159.76px;top:143.33px" class="cls_060"><span class="cls_060">return "BILLING_INFO";</span></div>
<div style="position:absolute;left:150.15px;top:153.35px" class="cls_060"><span class="cls_060">} else {</span></div>
<div style="position:absolute;left:159.76px;top:163.34px" class="cls_060"><span class="cls_060">return "LINE_ITEMS";</span></div>
<div style="position:absolute;left:150.15px;top:173.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:140.56px;top:183.35px" class="cls_060"><span class="cls_060">}, mapping -&gt; mapping</span></div>
<div style="position:absolute;left:150.13px;top:193.34px" class="cls_060"><span class="cls_060">.subFlowMapping("BILLING_INFO", sf -&gt; sf</span></div>
<div style="position:absolute;left:169.35px;top:203.33px" class="cls_060"><span class="cls_060">.&lt;BillingInfo&gt; handle((billingInfo, h) -&gt; {</span></div>
<div style="position:absolute;left:169.35px;top:223.34px" class="cls_060"><span class="cls_060">}))</span></div>
<div style="position:absolute;left:150.17px;top:233.33px" class="cls_060"><span class="cls_060">.subFlowMapping("LINE_ITEMS", sf -&gt; sf</span></div>
<div style="position:absolute;left:169.37px;top:243.35px" class="cls_060"><span class="cls_060">.split()</span></div>
<div style="position:absolute;left:169.37px;top:253.34px" class="cls_060"><span class="cls_060">.&lt;LineItem&gt; handle((lineItem, h) -&gt; {</span></div>
<div style="position:absolute;left:169.35px;top:273.35px" class="cls_060"><span class="cls_060">}))</span></div>
<div style="position:absolute;left:140.55px;top:293.33px" class="cls_060"><span class="cls_060">)</span></div>
<div style="position:absolute;left:121.38px;top:303.35px" class="cls_061"><span class="cls_061">.get();</span></div>
<div style="position:absolute;left:102.18px;top:324.68px" class="cls_039"><span class="cls_039">The DSL form of the flow definition is certainly terser, if not arguably a bit more diffi-</span></div>
<div style="position:absolute;left:102.18px;top:337.67px" class="cls_039"><span class="cls_039">cult to follow. It uses the same </span><span class="cls_059">OrderSplitter</span><span class="cls_039"> to split the order as the Java configura-</span></div>
<div style="position:absolute;left:102.18px;top:350.66px" class="cls_039"><span class="cls_039">tion example. After the order is split, it’s routed by its type to two separate subflows.</span></div>
<div style="position:absolute;left:66.18px;top:372.50px" class="cls_063"><span class="cls_063">9.2.6</span></div>
<div style="position:absolute;left:102.18px;top:372.50px" class="cls_063"><span class="cls_063">Service activators</span></div>
<div style="position:absolute;left:102.18px;top:389.66px" class="cls_039"><span class="cls_039">Service activators receive messages from an input channel and send those messages to</span></div>
<div style="position:absolute;left:102.18px;top:402.68px" class="cls_039"><span class="cls_039">an implementation of </span><span class="cls_059">MessageHandler</span><span class="cls_039">, as shown in figure 9.7.</span></div>
<div style="position:absolute;left:183.17px;top:428.25px" class="cls_088"><span class="cls_088">Invoke a</span></div>
<div style="position:absolute;left:185.32px;top:437.25px" class="cls_088"><span class="cls_088">service</span></div>
<div style="position:absolute;left:153.12px;top:498.59px" class="cls_088"><span class="cls_088">Service</span></div>
<div style="position:absolute;left:222.51px;top:497.21px" class="cls_053"><span class="cls_053">Figure 9.7</span></div>
<div style="position:absolute;left:266.56px;top:497.21px" class="cls_053"><span class="cls_053">Service activators invoke some service by way</span></div>
<div style="position:absolute;left:151.56px;top:507.59px" class="cls_088"><span class="cls_088">activator</span></div>
<div style="position:absolute;left:222.51px;top:506.90px" class="cls_053"><span class="cls_053">of a </span><span class="cls_087">MessageHandler</span><span class="cls_053"> on receipt of a message.</span></div>
<div style="position:absolute;left:102.18px;top:539.33px" class="cls_039"><span class="cls_039">Spring Integration offers several </span><span class="cls_059">MessageHandler</span><span class="cls_039"> implementations out of the box</span></div>
<div style="position:absolute;left:102.18px;top:552.32px" class="cls_039"><span class="cls_039">(even </span><span class="cls_059">PayloadTypeRouter</span><span class="cls_039"> is an implementation of </span><span class="cls_059">MessageHandler</span><span class="cls_039">), but you’ll often</span></div>
<div style="position:absolute;left:102.18px;top:565.31px" class="cls_039"><span class="cls_039">need to provide some custom implementation to act as a service activator. As an exam-</span></div>
<div style="position:absolute;left:102.18px;top:578.33px" class="cls_039"><span class="cls_039">ple, the following code shows how to declare a </span><span class="cls_059">MessageHandler</span><span class="cls_039"> bean, configured to</span></div>
<div style="position:absolute;left:102.18px;top:591.32px" class="cls_039"><span class="cls_039">be a service activator:</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:164264px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background248.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">226</span></div>
<div style="position:absolute;left:206.49px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 9</span></div>
<div style="position:absolute;left:250.62px;top:24.35px" class="cls_055"><span class="cls_055">Integrating Spring</span></div>
<div style="position:absolute;left:93.18px;top:51.32px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:93.18px;top:61.34px" class="cls_060"><span class="cls_060">@ServiceActivator(inputChannel="someChannel")</span></div>
<div style="position:absolute;left:93.18px;top:71.33px" class="cls_060"><span class="cls_060">public MessageHandler sysoutHandler() {</span></div>
<div style="position:absolute;left:102.77px;top:81.32px" class="cls_060"><span class="cls_060">return message -&gt; {</span></div>
<div style="position:absolute;left:112.38px;top:91.34px" class="cls_060"><span class="cls_060">System.out.println("Message payload:  " + message.getPayload());</span></div>
<div style="position:absolute;left:102.78px;top:101.33px" class="cls_060"><span class="cls_060">};</span></div>
<div style="position:absolute;left:93.18px;top:111.32px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:135.65px" class="cls_039"><span class="cls_039">The bean is annotated with </span><span class="cls_059">@ServiceActivator</span><span class="cls_039"> to designate it as a service activator that</span></div>
<div style="position:absolute;left:93.18px;top:148.67px" class="cls_039"><span class="cls_039">handles messages from the channel named </span><span class="cls_059">someChannel</span><span class="cls_039">. As for the </span><span class="cls_059">MessageHandler</span></div>
<div style="position:absolute;left:93.18px;top:161.66px" class="cls_039"><span class="cls_039">itself, it’s implemented via a lambda. Although it’s a simple </span><span class="cls_059">MessageHandler</span><span class="cls_039">, when</span></div>
<div style="position:absolute;left:93.18px;top:174.65px" class="cls_039"><span class="cls_039">given a </span><span class="cls_059">Message</span><span class="cls_039">, it emits its payload to the standard output stream.</span></div>
<div style="position:absolute;left:108.69px;top:187.67px" class="cls_039"><span class="cls_039">Alternatively, you could declare a service activator that processes the data in the</span></div>
<div style="position:absolute;left:93.18px;top:200.66px" class="cls_039"><span class="cls_039">incoming message before returning a new payload. In that case, the bean should be a</span></div>
<div style="position:absolute;left:93.18px;top:213.65px" class="cls_059"><span class="cls_059">GenericHandler</span><span class="cls_039"> rather than a </span><span class="cls_059">MessageHandler</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:236.33px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:93.18px;top:246.35px" class="cls_060"><span class="cls_060">@ServiceActivator(inputChannel="orderChannel",</span></div>
<div style="position:absolute;left:179.52px;top:256.34px" class="cls_060"><span class="cls_060">outputChannel="completeOrder")</span></div>
<div style="position:absolute;left:93.18px;top:266.33px" class="cls_060"><span class="cls_060">public GenericHandler&lt;Order&gt; orderHandler(</span></div>
<div style="position:absolute;left:232.33px;top:276.35px" class="cls_060"><span class="cls_060">OrderRepository orderRepo) {</span></div>
<div style="position:absolute;left:102.78px;top:286.34px" class="cls_060"><span class="cls_060">return (payload, headers) -&gt; {</span></div>
<div style="position:absolute;left:112.38px;top:296.33px" class="cls_060"><span class="cls_060">return orderRepo.save(payload);</span></div>
<div style="position:absolute;left:102.78px;top:306.35px" class="cls_060"><span class="cls_060">};</span></div>
<div style="position:absolute;left:93.18px;top:316.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:340.67px" class="cls_039"><span class="cls_039">In this case, the service activator is a </span><span class="cls_059">GenericHandler</span><span class="cls_039"> that expects messages with</span></div>
<div style="position:absolute;left:93.18px;top:353.66px" class="cls_039"><span class="cls_039">a payload of type </span><span class="cls_059">Order</span><span class="cls_039">. When the order arrives, it’s saved via a repository; the</span></div>
<div style="position:absolute;left:93.18px;top:366.68px" class="cls_039"><span class="cls_039">resulting saved </span><span class="cls_059">Order</span><span class="cls_039"> is returned to be sent to the output channel whose name is</span></div>
<div style="position:absolute;left:93.18px;top:379.67px" class="cls_059"><span class="cls_059">completeChannel</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:108.24px;top:392.66px" class="cls_039"><span class="cls_039">You may notice that a </span><span class="cls_059">GenericHandler</span><span class="cls_039"> is given not only the payload, but also the</span></div>
<div style="position:absolute;left:93.18px;top:405.68px" class="cls_039"><span class="cls_039">message headers (even if the example doesn’t use those headers in any way). If you</span></div>
<div style="position:absolute;left:93.18px;top:418.67px" class="cls_039"><span class="cls_039">prefer, you can also use service activators in the Java DSL configuration style by pass-</span></div>
<div style="position:absolute;left:93.18px;top:431.66px" class="cls_039"><span class="cls_039">ing a </span><span class="cls_059">MessageHandler</span><span class="cls_039"> or </span><span class="cls_059">GenericHandler</span><span class="cls_039"> to </span><span class="cls_059">handle()</span><span class="cls_039"> in the flow definition:</span></div>
<div style="position:absolute;left:93.18px;top:454.34px" class="cls_060"><span class="cls_060">public IntegrationFlow someFlow() {</span></div>
<div style="position:absolute;left:102.78px;top:464.36px" class="cls_060"><span class="cls_060">return IntegrationFlows</span></div>
<div style="position:absolute;left:121.96px;top:484.34px" class="cls_060"><span class="cls_060">.handle(msg -&gt; {</span></div>
<div style="position:absolute;left:131.55px;top:494.36px" class="cls_060"><span class="cls_060">System.out.println("Message payload:  " + msg.getPayload());</span></div>
<div style="position:absolute;left:126.75px;top:504.35px" class="cls_060"><span class="cls_060">})</span></div>
<div style="position:absolute;left:121.95px;top:514.34px" class="cls_060"><span class="cls_060">.get();</span></div>
<div style="position:absolute;left:93.18px;top:524.36px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:548.66px" class="cls_039"><span class="cls_039">In this case, the </span><span class="cls_059">MessageHandler</span><span class="cls_039"> is given as a lambda, but you could also provide it as</span></div>
<div style="position:absolute;left:93.18px;top:561.68px" class="cls_039"><span class="cls_039">a method reference or even as an instance of a class that implements the </span><span class="cls_059">Message-</span></div>
<div style="position:absolute;left:93.18px;top:574.67px" class="cls_059"><span class="cls_059">Handler</span><span class="cls_039"> interface. If you give it a lambda or method reference, be aware that it</span></div>
<div style="position:absolute;left:93.18px;top:587.69px" class="cls_039"><span class="cls_039">accepts a message as a parameter.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:164940px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background249.jpg" width="531" height="666"></div>
<div style="position:absolute;left:193.32px;top:24.35px" class="cls_055"><span class="cls_055">Surveying the Spring Integration landscape</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">227</span></div>
<div style="position:absolute;left:116.67px;top:50.66px" class="cls_039"><span class="cls_039">Similarly, </span><span class="cls_059">handle()</span><span class="cls_039"> can be written to accept a </span><span class="cls_059">GenericHandler</span><span class="cls_039"> if the service activa-</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">tor isn’t intended to be the end of the flow. Applying the order-saving service activator</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">from before, you could configure the flow with the Java DSL like this:</span></div>
<div style="position:absolute;left:102.18px;top:96.32px" class="cls_060"><span class="cls_060">public IntegrationFlow orderFlow(OrderRepository orderRepo) {</span></div>
<div style="position:absolute;left:111.78px;top:106.34px" class="cls_060"><span class="cls_060">return IntegrationFlows</span></div>
<div style="position:absolute;left:130.96px;top:126.35px" class="cls_060"><span class="cls_060">.&lt;Order&gt;handle((payload, headers) -&gt; {</span></div>
<div style="position:absolute;left:150.15px;top:136.34px" class="cls_060"><span class="cls_060">return orderRepo.save(payload);</span></div>
<div style="position:absolute;left:135.75px;top:146.33px" class="cls_060"><span class="cls_060">})</span></div>
<div style="position:absolute;left:130.95px;top:166.34px" class="cls_060"><span class="cls_060">.get();</span></div>
<div style="position:absolute;left:102.18px;top:176.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:197.66px" class="cls_039"><span class="cls_039">When working with a </span><span class="cls_059">GenericHandler</span><span class="cls_039">, the lambda or method reference accepts the</span></div>
<div style="position:absolute;left:102.18px;top:210.65px" class="cls_039"><span class="cls_039">message payload and headers as parameters. Also, if you choose to use </span><span class="cls_059">Generic-</span></div>
<div style="position:absolute;left:102.18px;top:223.67px" class="cls_059"><span class="cls_059">Handler</span><span class="cls_039"> at the end of a flow, you’ll need to return </span><span class="cls_059">null</span><span class="cls_039">, or else you’ll get errors indi-</span></div>
<div style="position:absolute;left:102.18px;top:236.66px" class="cls_039"><span class="cls_039">cating that there’s no output channel specified.</span></div>
<div style="position:absolute;left:66.18px;top:258.50px" class="cls_063"><span class="cls_063">9.2.7</span></div>
<div style="position:absolute;left:102.18px;top:258.50px" class="cls_063"><span class="cls_063">Gateways</span></div>
<div style="position:absolute;left:102.18px;top:275.66px" class="cls_039"><span class="cls_039">Gateways are the means by which an application can submit data into an integration</span></div>
<div style="position:absolute;left:102.18px;top:288.65px" class="cls_039"><span class="cls_039">flow and, optionally, receive a response that’s the result of the flow. Implemented by</span></div>
<div style="position:absolute;left:102.18px;top:301.67px" class="cls_039"><span class="cls_039">Spring Integration, gateways are realized as interfaces that the application can call to</span></div>
<div style="position:absolute;left:102.18px;top:314.66px" class="cls_039"><span class="cls_039">send messages to the integration flow (figure 9.8).</span></div>
<div style="position:absolute;left:241.73px;top:341.22px" class="cls_079"><span class="cls_079">Integration flow</span></div>
<div style="position:absolute;left:305.09px;top:380.18px" class="cls_090"><span class="cls_090">…</span></div>
<div style="position:absolute;left:343.05px;top:395.24px" class="cls_053"><span class="cls_053">Figure 9.8</span></div>
<div style="position:absolute;left:387.65px;top:395.24px" class="cls_053"><span class="cls_053">Service gateways</span></div>
<div style="position:absolute;left:153.91px;top:405.82px" class="cls_057"><span class="cls_057">Gateway</span></div>
<div style="position:absolute;left:236.05px;top:405.82px" class="cls_057"><span class="cls_057">Channel</span></div>
<div style="position:absolute;left:343.05px;top:405.23px" class="cls_053"><span class="cls_053">are interfaces through which an</span></div>
<div style="position:absolute;left:343.05px;top:415.25px" class="cls_053"><span class="cls_053">application can submit messages</span></div>
<div style="position:absolute;left:343.05px;top:425.24px" class="cls_053"><span class="cls_053">to an integration flow.</span></div>
<div style="position:absolute;left:102.18px;top:453.98px" class="cls_039"><span class="cls_039">You’ve already seen an example of a message gateway with </span><span class="cls_059">FileWriterGateway</span><span class="cls_039">. </span><span class="cls_059">File-</span></div>
<div style="position:absolute;left:102.18px;top:467.00px" class="cls_059"><span class="cls_059">WriterGateway</span><span class="cls_039"> was a one-way gateway with a method accepting a </span><span class="cls_059">String</span><span class="cls_039"> to write to a</span></div>
<div style="position:absolute;left:102.18px;top:479.99px" class="cls_039"><span class="cls_039">file, returning void.  It’s just about as easy to write a two-way gateway. When writing the</span></div>
<div style="position:absolute;left:102.18px;top:492.98px" class="cls_039"><span class="cls_039">gateway interface, be sure that the method returns some value to publish into the inte-</span></div>
<div style="position:absolute;left:102.18px;top:506.00px" class="cls_039"><span class="cls_039">gration flow.</span></div>
<div style="position:absolute;left:116.62px;top:518.99px" class="cls_039"><span class="cls_039">As an example, imagine a gateway that fronts a simple integration flow that accepts</span></div>
<div style="position:absolute;left:102.18px;top:532.01px" class="cls_039"><span class="cls_039">a </span><span class="cls_059">String</span><span class="cls_039"> and translates the given </span><span class="cls_059">String</span><span class="cls_039"> to all uppercase. The gateway interface</span></div>
<div style="position:absolute;left:102.18px;top:545.00px" class="cls_039"><span class="cls_039">might look something like this:</span></div>
<div style="position:absolute;left:102.18px;top:564.68px" class="cls_060"><span class="cls_060">package com.example.demo;</span></div>
<div style="position:absolute;left:102.18px;top:574.67px" class="cls_060"><span class="cls_060">import org.springframework.integration.annotation.MessagingGateway;</span></div>
<div style="position:absolute;left:102.18px;top:584.66px" class="cls_060"><span class="cls_060">import org.springframework.stereotype.Component;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:165616px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background250.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">228</span></div>
<div style="position:absolute;left:206.49px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 9</span></div>
<div style="position:absolute;left:250.62px;top:24.35px" class="cls_055"><span class="cls_055">Integrating Spring</span></div>
<div style="position:absolute;left:93.18px;top:51.32px" class="cls_060"><span class="cls_060">@Component</span></div>
<div style="position:absolute;left:93.18px;top:61.34px" class="cls_060"><span class="cls_060">@MessagingGateway(defaultRequestChannel="inChannel",</span></div>
<div style="position:absolute;left:179.52px;top:71.33px" class="cls_060"><span class="cls_060">defaultReplyChannel="outChannel")</span></div>
<div style="position:absolute;left:93.18px;top:81.32px" class="cls_060"><span class="cls_060">public interface UpperCaseGateway {</span></div>
<div style="position:absolute;left:102.78px;top:91.34px" class="cls_060"><span class="cls_060">String uppercase(String in);</span></div>
<div style="position:absolute;left:93.18px;top:101.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:122.66px" class="cls_039"><span class="cls_039">What’s amazing about this interface is that it’s not necessary to implement it. Spring</span></div>
<div style="position:absolute;left:93.18px;top:135.65px" class="cls_039"><span class="cls_039">Integration automatically provides an implementation at runtime that sends and</span></div>
<div style="position:absolute;left:93.18px;top:148.67px" class="cls_039"><span class="cls_039">receives data through the specified channels.</span></div>
<div style="position:absolute;left:107.91px;top:161.66px" class="cls_039"><span class="cls_039">When </span><span class="cls_059">uppercase()</span><span class="cls_039"> is called, the given </span><span class="cls_059">String</span><span class="cls_039"> is published to the integration flow</span></div>
<div style="position:absolute;left:93.18px;top:174.65px" class="cls_039"><span class="cls_039">into the channel named </span><span class="cls_059">inChannel</span><span class="cls_039">. And, regardless of how the flow is defined or</span></div>
<div style="position:absolute;left:93.18px;top:187.67px" class="cls_039"><span class="cls_039">what it does, when data arrives in the channel named </span><span class="cls_059">outChannel</span><span class="cls_039">, it’s returned from</span></div>
<div style="position:absolute;left:93.18px;top:200.66px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">uppercase()</span><span class="cls_039"> method.</span></div>
<div style="position:absolute;left:107.74px;top:213.65px" class="cls_039"><span class="cls_039">As for the uppercase integration flow, it’s a simplistic integration flow with only a</span></div>
<div style="position:absolute;left:93.18px;top:226.67px" class="cls_039"><span class="cls_039">single step to transform the </span><span class="cls_059">String</span><span class="cls_039"> to uppercase. Here, it’s expressed in the Java</span></div>
<div style="position:absolute;left:93.18px;top:239.66px" class="cls_039"><span class="cls_039">DSL configuration:</span></div>
<div style="position:absolute;left:93.18px;top:259.34px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:93.18px;top:269.33px" class="cls_060"><span class="cls_060">public IntegrationFlow uppercaseFlow() {</span></div>
<div style="position:absolute;left:102.78px;top:279.35px" class="cls_060"><span class="cls_060">return IntegrationFlows</span></div>
<div style="position:absolute;left:112.38px;top:289.34px" class="cls_060"><span class="cls_060">.from("inChannel")</span></div>
<div style="position:absolute;left:112.38px;top:299.33px" class="cls_060"><span class="cls_060">.&lt;String, String&gt; transform(s -&gt; s.toUpperCase())</span></div>
<div style="position:absolute;left:112.38px;top:309.35px" class="cls_060"><span class="cls_060">.channel("outChannel")</span></div>
<div style="position:absolute;left:112.38px;top:319.34px" class="cls_060"><span class="cls_060">.get();</span></div>
<div style="position:absolute;left:93.18px;top:329.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:350.66px" class="cls_039"><span class="cls_039">As defined here, the flow starts with data coming into the channel named </span><span class="cls_059">inChannel</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:93.18px;top:363.68px" class="cls_039"><span class="cls_039">The message payload is then transformed by the transformer, which is defined here as</span></div>
<div style="position:absolute;left:93.18px;top:376.67px" class="cls_039"><span class="cls_039">a lambda expression, to perform an uppercase operation. The resulting message is</span></div>
<div style="position:absolute;left:93.18px;top:389.66px" class="cls_039"><span class="cls_039">then published to the channel named </span><span class="cls_059">outChannel</span><span class="cls_039">, which is what you’ve declared as</span></div>
<div style="position:absolute;left:93.18px;top:402.68px" class="cls_039"><span class="cls_039">the reply channel for the </span><span class="cls_059">UpperCaseGateway</span><span class="cls_039"> interface.</span></div>
<div style="position:absolute;left:57.18px;top:424.49px" class="cls_063"><span class="cls_063">9.2.8</span></div>
<div style="position:absolute;left:93.18px;top:424.49px" class="cls_063"><span class="cls_063">Channel adapters</span></div>
<div style="position:absolute;left:93.18px;top:441.68px" class="cls_039"><span class="cls_039">Channel adapters represent the entry and exit points of an integration flow. Data</span></div>
<div style="position:absolute;left:93.18px;top:454.67px" class="cls_039"><span class="cls_039">enters an integration flow by way of an inbound channel adapter and exits an integra-</span></div>
<div style="position:absolute;left:93.18px;top:467.66px" class="cls_039"><span class="cls_039">tion flow by way of an outbound channel adapter. This is illustrated in figure 9.9.</span></div>
<div style="position:absolute;left:206.94px;top:507.51px" class="cls_090"><span class="cls_090">…</span></div>
<div style="position:absolute;left:345.30px;top:530.42px" class="cls_053"><span class="cls_053">Figure 9.9</span></div>
<div style="position:absolute;left:389.91px;top:530.42px" class="cls_053"><span class="cls_053">Channel adapters</span></div>
<div style="position:absolute;left:115.54px;top:537.23px" class="cls_057"><span class="cls_057">Inbound</span></div>
<div style="position:absolute;left:281.97px;top:537.23px" class="cls_057"><span class="cls_057">Outbound</span></div>
<div style="position:absolute;left:192.45px;top:542.22px" class="cls_057"><span class="cls_057">Integration</span></div>
<div style="position:absolute;left:345.30px;top:540.41px" class="cls_053"><span class="cls_053">are the entry and exit points of</span></div>
<div style="position:absolute;left:103.09px;top:546.23px" class="cls_057"><span class="cls_057">channel adapter</span></div>
<div style="position:absolute;left:272.24px;top:546.23px" class="cls_057"><span class="cls_057">channel adapter</span></div>
<div style="position:absolute;left:202.76px;top:551.22px" class="cls_057"><span class="cls_057">flow</span></div>
<div style="position:absolute;left:345.30px;top:550.43px" class="cls_053"><span class="cls_053">an integration flow.</span></div>
<div style="position:absolute;left:93.18px;top:578.60px" class="cls_039"><span class="cls_039">Inbound channel adapters can take many forms, depending on the source of the data</span></div>
<div style="position:absolute;left:93.18px;top:591.62px" class="cls_039"><span class="cls_039">they introduce into the flow. For example, you might declare an inbound channel</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:166292px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background251.jpg" width="531" height="666"></div>
<div style="position:absolute;left:193.32px;top:24.35px" class="cls_055"><span class="cls_055">Surveying the Spring Integration landscape</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">229</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">adapter that introduces incrementing numbers from an </span><span class="cls_059">AtomicInteger</span><span class="cls_039"> into the flow.</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">Using Java configuration, it might look like this:</span></div>
<div style="position:absolute;left:102.18px;top:83.33px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:102.18px;top:93.32px" class="cls_060"><span class="cls_060">@InboundChannelAdapter(</span></div>
<div style="position:absolute;left:121.38px;top:103.34px" class="cls_060"><span class="cls_060">poller=@Poller(fixedRate="1000"), channel="numberChannel")</span></div>
<div style="position:absolute;left:102.18px;top:113.33px" class="cls_060"><span class="cls_060">public MessageSource&lt;Integer&gt; numberSource(AtomicInteger source) {</span></div>
<div style="position:absolute;left:111.78px;top:123.32px" class="cls_060"><span class="cls_060">return () -&gt; {</span></div>
<div style="position:absolute;left:121.38px;top:133.34px" class="cls_060"><span class="cls_060">return new GenericMessage&lt;&gt;(source.getAndIncrement());</span></div>
<div style="position:absolute;left:111.78px;top:143.33px" class="cls_060"><span class="cls_060">};</span></div>
<div style="position:absolute;left:102.18px;top:153.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:174.65px" class="cls_039"><span class="cls_039">This </span><span class="cls_059">@Bean</span><span class="cls_039"> method declares an inbound channel adapter bean which, per the </span><span class="cls_059">@Inbound-</span></div>
<div style="position:absolute;left:102.33px;top:187.67px" class="cls_059"><span class="cls_059">ChannelAdapter</span><span class="cls_039"> annotation, submits a number from the injected </span><span class="cls_059">AtomicInteger</span><span class="cls_039"> to</span></div>
<div style="position:absolute;left:102.18px;top:200.66px" class="cls_039"><span class="cls_039">the channel named </span><span class="cls_059">numberChannel</span><span class="cls_039"> every 1 second (or 1,000 ms).</span></div>
<div style="position:absolute;left:118.05px;top:213.65px" class="cls_039"><span class="cls_039">Whereas </span><span class="cls_059">@InboundChannelAdapter</span><span class="cls_039"> indicates an inbound channel adapter when</span></div>
<div style="position:absolute;left:102.18px;top:226.67px" class="cls_039"><span class="cls_039">using Java configuration, the </span><span class="cls_059">from()</span><span class="cls_039"> method is how it’s done when using the Java DSL</span></div>
<div style="position:absolute;left:102.18px;top:239.66px" class="cls_039"><span class="cls_039">to define the integration flow. The following snippet of a flow definition shows a simi-</span></div>
<div style="position:absolute;left:102.18px;top:252.65px" class="cls_039"><span class="cls_039">lar inbound channel adapter as defined in the Java DSL:</span></div>
<div style="position:absolute;left:102.18px;top:272.33px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:102.18px;top:282.35px" class="cls_060"><span class="cls_060">public IntegrationFlow someFlow(AtomicInteger integerSource) {</span></div>
<div style="position:absolute;left:111.78px;top:292.34px" class="cls_060"><span class="cls_060">return IntegrationFlows</span></div>
<div style="position:absolute;left:130.95px;top:302.33px" class="cls_060"><span class="cls_060">.from(integerSource, "getAndIncrement",</span></div>
<div style="position:absolute;left:150.15px;top:312.35px" class="cls_060"><span class="cls_060">c -&gt; c.poller(Pollers.fixedRate(1000)))</span></div>
<div style="position:absolute;left:130.95px;top:332.33px" class="cls_060"><span class="cls_060">.get();</span></div>
<div style="position:absolute;left:102.18px;top:342.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:363.68px" class="cls_039"><span class="cls_039">Often, channel adapters are provided by one of Spring Integration’s many endpoint</span></div>
<div style="position:absolute;left:102.18px;top:376.67px" class="cls_039"><span class="cls_039">modules. Suppose, for example, that you need an inbound channel adapter that</span></div>
<div style="position:absolute;left:102.18px;top:389.66px" class="cls_039"><span class="cls_039">monitors a specified directory and submits any files that are written to that directory</span></div>
<div style="position:absolute;left:102.18px;top:402.68px" class="cls_039"><span class="cls_039">as messages to a channel named </span><span class="cls_059">file-channel</span><span class="cls_039">. The following Java configuration</span></div>
<div style="position:absolute;left:102.18px;top:415.67px" class="cls_039"><span class="cls_039">uses </span><span class="cls_059">FileReadingMessageSource</span><span class="cls_039"> from Spring Integration’s file endpoint module to</span></div>
<div style="position:absolute;left:102.18px;top:428.66px" class="cls_039"><span class="cls_039">achieve that:</span></div>
<div style="position:absolute;left:102.18px;top:448.34px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:102.18px;top:458.36px" class="cls_060"><span class="cls_060">@InboundChannelAdapter(channel="file-channel",</span></div>
<div style="position:absolute;left:310.86px;top:468.35px" class="cls_060"><span class="cls_060">poller=@Poller(fixedDelay="1000"))</span></div>
<div style="position:absolute;left:102.18px;top:478.34px" class="cls_060"><span class="cls_060">public MessageSource&lt;File&gt; fileReadingMessageSource() {</span></div>
<div style="position:absolute;left:111.45px;top:488.36px" class="cls_060"><span class="cls_060">FileReadingMessageSource sourceReader = new FileReadingMessageSource();</span></div>
<div style="position:absolute;left:111.45px;top:498.35px" class="cls_060"><span class="cls_060">sourceReader.setDirectory(new File(INPUT_DIR));</span></div>
<div style="position:absolute;left:111.45px;top:508.34px" class="cls_060"><span class="cls_060">sourceReader.setFilter(new SimplePatternFileListFilter(FILE_PATTERN));</span></div>
<div style="position:absolute;left:111.44px;top:518.36px" class="cls_060"><span class="cls_060">return sourceReader;</span></div>
<div style="position:absolute;left:102.18px;top:528.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:549.68px" class="cls_039"><span class="cls_039">When writing the equivalent file-reading inbound channel adapter in the Java DSL,</span></div>
<div style="position:absolute;left:102.18px;top:562.67px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">inboundAdapter()</span><span class="cls_039"> method from the </span><span class="cls_059">Files</span><span class="cls_039"> class achieves the same thing. An out-</span></div>
<div style="position:absolute;left:102.18px;top:575.69px" class="cls_039"><span class="cls_039">bound channel adapter is the end of the line for the integration flow, handing off the</span></div>
<div style="position:absolute;left:102.18px;top:588.68px" class="cls_039"><span class="cls_039">final message to the application or to some other system:</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:166968px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background252.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">230</span></div>
<div style="position:absolute;left:206.49px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 9</span></div>
<div style="position:absolute;left:250.62px;top:24.35px" class="cls_055"><span class="cls_055">Integrating Spring</span></div>
<div style="position:absolute;left:93.18px;top:51.32px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:93.18px;top:61.34px" class="cls_060"><span class="cls_060">public IntegrationFlow fileReaderFlow() {</span></div>
<div style="position:absolute;left:102.78px;top:71.33px" class="cls_060"><span class="cls_060">return IntegrationFlows</span></div>
<div style="position:absolute;left:121.95px;top:81.32px" class="cls_060"><span class="cls_060">.from(Files.inboundAdapter(new File(INPUT_DIR))</span></div>
<div style="position:absolute;left:141.15px;top:91.34px" class="cls_060"><span class="cls_060">.patternFilter(FILE_PATTERN))</span></div>
<div style="position:absolute;left:121.95px;top:101.33px" class="cls_060"><span class="cls_060">.get();</span></div>
<div style="position:absolute;left:93.18px;top:111.32px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:132.65px" class="cls_039"><span class="cls_039">Service activators, implemented as message handlers, often serve the purpose of an</span></div>
<div style="position:absolute;left:93.18px;top:145.67px" class="cls_039"><span class="cls_039">outbound channel adapter, especially when data needs to be handed off to the appli-</span></div>
<div style="position:absolute;left:93.18px;top:158.66px" class="cls_039"><span class="cls_039">cation itself. We’ve already discussed service activators, so there’s no point in repeat-</span></div>
<div style="position:absolute;left:93.18px;top:171.65px" class="cls_039"><span class="cls_039">ing that discussion.</span></div>
<div style="position:absolute;left:107.76px;top:184.67px" class="cls_039"><span class="cls_039">It’s worth noting, however, that Spring Integration endpoint modules provide use-</span></div>
<div style="position:absolute;left:93.18px;top:197.66px" class="cls_039"><span class="cls_039">ful message handlers for several common use cases. You saw an example of such an</span></div>
<div style="position:absolute;left:93.18px;top:210.65px" class="cls_039"><span class="cls_039">outbound channel adapter, </span><span class="cls_059">FileWritingMessageHandler</span><span class="cls_039">, in listing 9.3. Speaking of</span></div>
<div style="position:absolute;left:93.18px;top:223.67px" class="cls_039"><span class="cls_039">Spring Integration endpoint modules, let’s take a quick look at what ready-to-use inte-</span></div>
<div style="position:absolute;left:93.18px;top:236.66px" class="cls_039"><span class="cls_039">gration endpoint modules are available.</span></div>
<div style="position:absolute;left:57.18px;top:258.50px" class="cls_063"><span class="cls_063">9.2.9</span></div>
<div style="position:absolute;left:93.18px;top:258.50px" class="cls_063"><span class="cls_063">Endpoint modules</span></div>
<div style="position:absolute;left:93.18px;top:275.66px" class="cls_039"><span class="cls_039">It’s great that Spring Integration lets you create your own channel adapters. But</span></div>
<div style="position:absolute;left:93.18px;top:288.65px" class="cls_039"><span class="cls_039">what’s even better is that Spring Integration provides over two dozen endpoint mod-</span></div>
<div style="position:absolute;left:93.18px;top:301.67px" class="cls_039"><span class="cls_039">ules containing channel adapters—both inbound and outbound—for integration</span></div>
<div style="position:absolute;left:93.18px;top:314.66px" class="cls_039"><span class="cls_039">with a variety of common external systems, including those listed in table 9.1.</span></div>
<div style="position:absolute;left:93.18px;top:337.34px" class="cls_053"><span class="cls_053">Table 9.1</span></div>
<div style="position:absolute;left:134.91px;top:337.34px" class="cls_053"><span class="cls_053">Spring Integration provides over two dozen endpoint models for integration with external</span></div>
<div style="position:absolute;left:93.18px;top:347.33px" class="cls_053"><span class="cls_053">systems.</span></div>
<div style="position:absolute;left:290.70px;top:368.33px" class="cls_073"><span class="cls_073">Dependency artifact ID</span></div>
<div style="position:absolute;left:132.51px;top:373.49px" class="cls_073"><span class="cls_073">Module</span></div>
<div style="position:absolute;left:233.88px;top:378.23px" class="cls_073"><span class="cls_073">(Group ID: </span><span class="cls_091">org.springframework.integration</span><span class="cls_073">)</span></div>
<div style="position:absolute;left:99.18px;top:397.64px" class="cls_074"><span class="cls_074">AMQP</span></div>
<div style="position:absolute;left:207.24px;top:397.64px" class="cls_060"><span class="cls_060">spring-integration-amqp</span></div>
<div style="position:absolute;left:99.18px;top:414.65px" class="cls_074"><span class="cls_074">Spring application events</span></div>
<div style="position:absolute;left:207.24px;top:414.65px" class="cls_060"><span class="cls_060">spring-integration-event</span></div>
<div style="position:absolute;left:99.18px;top:431.66px" class="cls_074"><span class="cls_074">RSS and Atom</span></div>
<div style="position:absolute;left:207.24px;top:431.66px" class="cls_060"><span class="cls_060">spring-integration-feed</span></div>
<div style="position:absolute;left:99.18px;top:448.64px" class="cls_074"><span class="cls_074">Filesystem</span></div>
<div style="position:absolute;left:207.24px;top:448.64px" class="cls_060"><span class="cls_060">spring-integration-file</span></div>
<div style="position:absolute;left:99.18px;top:465.65px" class="cls_074"><span class="cls_074">FTP/FTPS</span></div>
<div style="position:absolute;left:207.24px;top:465.65px" class="cls_060"><span class="cls_060">spring-integration-ftp</span></div>
<div style="position:absolute;left:99.18px;top:482.66px" class="cls_074"><span class="cls_074">GemFire</span></div>
<div style="position:absolute;left:207.24px;top:482.66px" class="cls_060"><span class="cls_060">spring-integration-gemfire</span></div>
<div style="position:absolute;left:99.18px;top:499.64px" class="cls_074"><span class="cls_074">HTTP</span></div>
<div style="position:absolute;left:207.24px;top:499.64px" class="cls_060"><span class="cls_060">spring-integration-http</span></div>
<div style="position:absolute;left:99.18px;top:516.65px" class="cls_074"><span class="cls_074">JDBC</span></div>
<div style="position:absolute;left:207.24px;top:516.65px" class="cls_060"><span class="cls_060">spring-integration-jdbc</span></div>
<div style="position:absolute;left:99.18px;top:533.66px" class="cls_074"><span class="cls_074">JPA</span></div>
<div style="position:absolute;left:207.24px;top:533.66px" class="cls_060"><span class="cls_060">spring-integration-jpa</span></div>
<div style="position:absolute;left:99.18px;top:550.64px" class="cls_074"><span class="cls_074">JMS</span></div>
<div style="position:absolute;left:207.24px;top:550.64px" class="cls_060"><span class="cls_060">spring-integration-jms</span></div>
<div style="position:absolute;left:99.18px;top:567.65px" class="cls_074"><span class="cls_074">Email</span></div>
<div style="position:absolute;left:207.24px;top:567.65px" class="cls_060"><span class="cls_060">spring-integration-mail</span></div>
<div style="position:absolute;left:99.18px;top:584.66px" class="cls_074"><span class="cls_074">MongoDB</span></div>
<div style="position:absolute;left:207.24px;top:584.66px" class="cls_060"><span class="cls_060">spring-integration-mongodb</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:167644px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background253.jpg" width="531" height="666"></div>
<div style="position:absolute;left:208.44px;top:24.35px" class="cls_055"><span class="cls_055">Creating an email integration flow</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">231</span></div>
<div style="position:absolute;left:102.18px;top:51.32px" class="cls_053"><span class="cls_053">Table 9.1</span></div>
<div style="position:absolute;left:143.90px;top:51.32px" class="cls_053"><span class="cls_053">Spring Integration provides over two dozen endpoint models for integration with external</span></div>
<div style="position:absolute;left:102.18px;top:61.34px" class="cls_053"><span class="cls_053">systems.</span><span class="cls_084"> (continued)</span></div>
<div style="position:absolute;left:299.70px;top:82.34px" class="cls_073"><span class="cls_073">Dependency artifact ID</span></div>
<div style="position:absolute;left:141.51px;top:87.47px" class="cls_073"><span class="cls_073">Module</span></div>
<div style="position:absolute;left:242.88px;top:92.24px" class="cls_073"><span class="cls_073">(Group ID: </span><span class="cls_091">org.springframework.integration</span><span class="cls_073">)</span></div>
<div style="position:absolute;left:108.18px;top:111.62px" class="cls_074"><span class="cls_074">MQTT</span></div>
<div style="position:absolute;left:216.24px;top:111.62px" class="cls_060"><span class="cls_060">spring-integration-mqtt</span></div>
<div style="position:absolute;left:108.18px;top:128.63px" class="cls_074"><span class="cls_074">Redis</span></div>
<div style="position:absolute;left:216.24px;top:128.63px" class="cls_060"><span class="cls_060">spring-integration-redis</span></div>
<div style="position:absolute;left:108.18px;top:145.64px" class="cls_074"><span class="cls_074">RMI</span></div>
<div style="position:absolute;left:216.24px;top:145.64px" class="cls_060"><span class="cls_060">spring-integration-rmi</span></div>
<div style="position:absolute;left:108.18px;top:162.65px" class="cls_074"><span class="cls_074">SFTP</span></div>
<div style="position:absolute;left:216.24px;top:162.65px" class="cls_060"><span class="cls_060">spring-integration-sftp</span></div>
<div style="position:absolute;left:108.18px;top:179.63px" class="cls_074"><span class="cls_074">STOMP</span></div>
<div style="position:absolute;left:216.24px;top:179.63px" class="cls_060"><span class="cls_060">spring-integration-stomp</span></div>
<div style="position:absolute;left:108.18px;top:196.64px" class="cls_074"><span class="cls_074">Stream</span></div>
<div style="position:absolute;left:216.24px;top:196.64px" class="cls_060"><span class="cls_060">spring-integration-stream</span></div>
<div style="position:absolute;left:108.18px;top:213.65px" class="cls_074"><span class="cls_074">Syslog</span></div>
<div style="position:absolute;left:216.24px;top:213.65px" class="cls_060"><span class="cls_060">spring-integration-syslog</span></div>
<div style="position:absolute;left:108.18px;top:230.63px" class="cls_074"><span class="cls_074">TCP/UDP</span></div>
<div style="position:absolute;left:216.24px;top:230.63px" class="cls_060"><span class="cls_060">spring-integration-ip</span></div>
<div style="position:absolute;left:108.18px;top:247.64px" class="cls_074"><span class="cls_074">Twitter</span></div>
<div style="position:absolute;left:216.24px;top:247.64px" class="cls_060"><span class="cls_060">spring-integration-twitter</span></div>
<div style="position:absolute;left:108.18px;top:264.65px" class="cls_074"><span class="cls_074">Web Services</span></div>
<div style="position:absolute;left:216.24px;top:264.65px" class="cls_060"><span class="cls_060">spring-integration-ws</span></div>
<div style="position:absolute;left:108.18px;top:281.63px" class="cls_074"><span class="cls_074">WebFlux</span></div>
<div style="position:absolute;left:216.24px;top:281.63px" class="cls_060"><span class="cls_060">spring-integration-</span><span class="cls_074">webflux</span></div>
<div style="position:absolute;left:108.18px;top:298.64px" class="cls_074"><span class="cls_074">WebSocket</span></div>
<div style="position:absolute;left:216.24px;top:298.64px" class="cls_060"><span class="cls_060">spring-integration-</span><span class="cls_074">websocket</span></div>
<div style="position:absolute;left:108.18px;top:315.65px" class="cls_074"><span class="cls_074">XMPP</span></div>
<div style="position:absolute;left:216.24px;top:315.65px" class="cls_060"><span class="cls_060">spring-integration-xmpp</span></div>
<div style="position:absolute;left:108.18px;top:332.63px" class="cls_074"><span class="cls_074">ZooKeeper</span></div>
<div style="position:absolute;left:216.24px;top:332.63px" class="cls_060"><span class="cls_060">spring-integration-zookeeper</span></div>
<div style="position:absolute;left:102.18px;top:357.98px" class="cls_039"><span class="cls_039">One thing that’s clear from looking at table 9.1 is that Spring Integration provides an</span></div>
<div style="position:absolute;left:102.18px;top:370.97px" class="cls_039"><span class="cls_039">extensive set of components to meet many integration needs. Most applications will</span></div>
<div style="position:absolute;left:102.18px;top:383.96px" class="cls_039"><span class="cls_039">never need even a fraction of what Spring Integration offers. But it’s good to know</span></div>
<div style="position:absolute;left:102.18px;top:396.98px" class="cls_039"><span class="cls_039">that Spring Integration has you covered if you need them.</span></div>
<div style="position:absolute;left:117.00px;top:409.97px" class="cls_039"><span class="cls_039">What’s more, it would be impossible to cover all the channel adapters afforded by</span></div>
<div style="position:absolute;left:102.18px;top:422.96px" class="cls_039"><span class="cls_039">the modules listed in table 9.1 in the space of this chapter. You’ve already seen exam-</span></div>
<div style="position:absolute;left:102.18px;top:435.98px" class="cls_039"><span class="cls_039">ples that use the filesystem module to write to the filesystem. And you’re soon going to</span></div>
<div style="position:absolute;left:102.18px;top:448.97px" class="cls_039"><span class="cls_039">use the email module to read emails.</span></div>
<div style="position:absolute;left:116.82px;top:461.96px" class="cls_039"><span class="cls_039">Each of the endpoint modules offers channel adapters that can be either declared</span></div>
<div style="position:absolute;left:102.18px;top:474.98px" class="cls_039"><span class="cls_039">as beans when using Java configuration or referenced via static methods when using</span></div>
<div style="position:absolute;left:102.18px;top:487.97px" class="cls_039"><span class="cls_039">Java DSL configuration. I encourage you to explore any of the other endpoint mod-</span></div>
<div style="position:absolute;left:102.18px;top:500.96px" class="cls_039"><span class="cls_039">ules that interest you most. You’ll find that they’re fairly consistent in how they’re</span></div>
<div style="position:absolute;left:102.18px;top:513.98px" class="cls_039"><span class="cls_039">used. But for now, let’s turn our attention to the email endpoint module to see how</span></div>
<div style="position:absolute;left:102.18px;top:526.97px" class="cls_039"><span class="cls_039">you might use it in the Taco Cloud application.</span></div>
<div style="position:absolute;left:66.18px;top:548.14px" class="cls_040"><span class="cls_040">9.3</span></div>
<div style="position:absolute;left:102.18px;top:548.14px" class="cls_040"><span class="cls_040">Creating an email integration flow</span></div>
<div style="position:absolute;left:102.18px;top:565.97px" class="cls_039"><span class="cls_039">You’ve decided that Taco Cloud should enable its customers to submit their taco</span></div>
<div style="position:absolute;left:102.18px;top:578.99px" class="cls_039"><span class="cls_039">designs and place orders by email. You send out flyers and place take-out ads in news-</span></div>
<div style="position:absolute;left:102.18px;top:591.98px" class="cls_039"><span class="cls_039">papers inviting everyone to send in their taco orders by email. It’s a tremendous</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:168320px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background254.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">232</span></div>
<div style="position:absolute;left:206.49px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 9</span></div>
<div style="position:absolute;left:250.62px;top:24.35px" class="cls_055"><span class="cls_055">Integrating Spring</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">success! Unfortunately, it’s a bit </span><span class="cls_036">too</span><span class="cls_039"> successful. There are so many emails coming in</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">that you have to hire temporary help to do nothing more than read all the emails and</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">submit order details into the ordering system.</span></div>
<div style="position:absolute;left:109.17px;top:89.66px" class="cls_039"><span class="cls_039">In this section, you’ll implement an integration flow that polls the Taco Cloud</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">inbox for taco order emails, parses the emails for order details, and submits the orders</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">to Taco Cloud for handling. In short, the integration flow you’re going to need will</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">use an inbound channel adapter from the email endpoint module to ingest emails</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">from the Taco Cloud inbox into the integration flow.</span></div>
<div style="position:absolute;left:108.30px;top:154.67px" class="cls_039"><span class="cls_039">The next step in the integration flow will parse the emails into order objects that</span></div>
<div style="position:absolute;left:93.18px;top:167.66px" class="cls_039"><span class="cls_039">are handed off to another handler to submit orders to Taco Cloud’s REST API, where</span></div>
<div style="position:absolute;left:93.18px;top:180.65px" class="cls_039"><span class="cls_039">they’ll be processed the same as any order. To start with, let’s define a simple configu-</span></div>
<div style="position:absolute;left:93.18px;top:193.67px" class="cls_039"><span class="cls_039">ration properties class to capture the specifics of how to handle Taco Cloud emails:</span></div>
<div style="position:absolute;left:93.18px;top:213.35px" class="cls_060"><span class="cls_060">@Data</span></div>
<div style="position:absolute;left:93.18px;top:223.34px" class="cls_060"><span class="cls_060">@ConfigurationProperties(prefix="tacocloud.email")</span></div>
<div style="position:absolute;left:93.18px;top:233.33px" class="cls_060"><span class="cls_060">@Component</span></div>
<div style="position:absolute;left:93.18px;top:243.35px" class="cls_060"><span class="cls_060">public class EmailProperties {</span></div>
<div style="position:absolute;left:102.77px;top:261.35px" class="cls_060"><span class="cls_060">private String username;</span></div>
<div style="position:absolute;left:102.77px;top:271.34px" class="cls_060"><span class="cls_060">private String password;</span></div>
<div style="position:absolute;left:102.77px;top:281.33px" class="cls_060"><span class="cls_060">private String host;</span></div>
<div style="position:absolute;left:102.77px;top:291.35px" class="cls_060"><span class="cls_060">private String mailbox;</span></div>
<div style="position:absolute;left:102.78px;top:301.34px" class="cls_060"><span class="cls_060">private long pollRate = 30000;</span></div>
<div style="position:absolute;left:102.78px;top:319.34px" class="cls_060"><span class="cls_060">public String getImapUrl() {</span></div>
<div style="position:absolute;left:112.38px;top:329.33px" class="cls_060"><span class="cls_060">return String.format("imaps://%s:%s@%s/%s",</span></div>
<div style="position:absolute;left:131.56px;top:339.35px" class="cls_060"><span class="cls_060">this.username, this.password, this.host, this.mailbox);</span></div>
<div style="position:absolute;left:102.78px;top:349.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:369.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:388.67px" class="cls_039"><span class="cls_039">As you can see, </span><span class="cls_059">EmailProperties</span><span class="cls_039"> captures properties that are used to produce an</span></div>
<div style="position:absolute;left:93.18px;top:401.66px" class="cls_039"><span class="cls_039">IMAP URL. The flow uses this URL to connect to the Taco Cloud email server and poll</span></div>
<div style="position:absolute;left:93.18px;top:414.68px" class="cls_039"><span class="cls_039">for emails. Among the properties captured are the email user’s username and pass-</span></div>
<div style="position:absolute;left:93.18px;top:427.67px" class="cls_039"><span class="cls_039">word, as well as the hostname of the IMAP server, the mailbox to poll, and the rate at</span></div>
<div style="position:absolute;left:93.18px;top:440.66px" class="cls_039"><span class="cls_039">which the mailbox is polled (which defaults to every 30 seconds).</span></div>
<div style="position:absolute;left:108.72px;top:453.68px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">EmailProperties</span><span class="cls_039"> class is annotated at the class level with </span><span class="cls_059">@Configuration-</span></div>
<div style="position:absolute;left:93.18px;top:466.67px" class="cls_059"><span class="cls_059">Properties</span><span class="cls_039"> with a </span><span class="cls_059">prefix</span><span class="cls_039"> attribute set to </span><span class="cls_059">tacocloud.email</span><span class="cls_039">. This means that you can</span></div>
<div style="position:absolute;left:93.18px;top:479.66px" class="cls_039"><span class="cls_039">configure the details of consuming an email in the application.yml file like this:</span></div>
<div style="position:absolute;left:93.18px;top:499.34px" class="cls_060"><span class="cls_060">tacocloud:</span></div>
<div style="position:absolute;left:102.78px;top:509.36px" class="cls_060"><span class="cls_060">email:</span></div>
<div style="position:absolute;left:112.38px;top:519.35px" class="cls_060"><span class="cls_060">host: imap.tacocloud.com</span></div>
<div style="position:absolute;left:112.38px;top:529.34px" class="cls_060"><span class="cls_060">mailbox: INBOX</span></div>
<div style="position:absolute;left:112.38px;top:539.36px" class="cls_060"><span class="cls_060">username: taco-in-flow</span></div>
<div style="position:absolute;left:112.38px;top:549.35px" class="cls_060"><span class="cls_060">password: 1L0v3T4c0s</span></div>
<div style="position:absolute;left:112.38px;top:559.34px" class="cls_061"><span class="cls_061">poll-rate: 10000</span></div>
<div style="position:absolute;left:93.18px;top:578.69px" class="cls_039"><span class="cls_039">Now let’s use </span><span class="cls_059">EmailProperties</span><span class="cls_039"> to configure the integration flow. The flow you’re aim-</span></div>
<div style="position:absolute;left:93.18px;top:591.68px" class="cls_039"><span class="cls_039">ing to create will look a little like figure 9.10.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:168996px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background255.jpg" width="531" height="666"></div>
<div style="position:absolute;left:208.44px;top:24.35px" class="cls_055"><span class="cls_055">Creating an email integration flow</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">233</span></div>
<div style="position:absolute;left:110.87px;top:92.61px" class="cls_057"><span class="cls_057">Email (IMAP)</span></div>
<div style="position:absolute;left:258.04px;top:92.61px" class="cls_057"><span class="cls_057">Mail-to-order</span></div>
<div style="position:absolute;left:407.70px;top:92.61px" class="cls_057"><span class="cls_057">Submit order</span></div>
<div style="position:absolute;left:105.79px;top:101.61px" class="cls_057"><span class="cls_057">inbound channel</span></div>
<div style="position:absolute;left:259.99px;top:101.61px" class="cls_057"><span class="cls_057">transformer</span></div>
<div style="position:absolute;left:399.90px;top:101.61px" class="cls_057"><span class="cls_057">outbound channel</span></div>
<div style="position:absolute;left:119.61px;top:110.61px" class="cls_057"><span class="cls_057">adapter</span></div>
<div style="position:absolute;left:415.86px;top:110.61px" class="cls_057"><span class="cls_057">adapter</span></div>
<div style="position:absolute;left:102.18px;top:128.60px" class="cls_053"><span class="cls_053">Figure 9.10</span></div>
<div style="position:absolute;left:151.61px;top:128.60px" class="cls_053"><span class="cls_053">An integration flow to accept taco orders by email</span></div>
<div style="position:absolute;left:102.18px;top:160.91px" class="cls_039"><span class="cls_039">You have two options when defining this flow:</span></div>
<div style="position:absolute;left:117.78px;top:177.92px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Define it within the Taco Cloud application itself—</span><span class="cls_039">At the end of the flow, a service</span></div>
<div style="position:absolute;left:129.78px;top:190.91px" class="cls_039"><span class="cls_039">activator will call into the repositories you’ve defined to create the taco order.</span></div>
<div style="position:absolute;left:117.78px;top:204.92px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Define it as a separate application—</span><span class="cls_039">At the end of the flow, a service activator will</span></div>
<div style="position:absolute;left:129.78px;top:217.91px" class="cls_039"><span class="cls_039">send a POST request to the Taco Cloud API to submit the taco order.</span></div>
<div style="position:absolute;left:102.18px;top:235.91px" class="cls_039"><span class="cls_039">Whichever you choose has little bearing on the flow itself, aside from how the service</span></div>
<div style="position:absolute;left:102.18px;top:248.90px" class="cls_039"><span class="cls_039">activator is implemented. But because you’re going to need some types that represent</span></div>
<div style="position:absolute;left:102.18px;top:261.92px" class="cls_039"><span class="cls_039">tacos, orders, and ingredients, which are subtly different than those you’ve already</span></div>
<div style="position:absolute;left:102.18px;top:274.91px" class="cls_039"><span class="cls_039">defined in the main Taco Cloud application, you’ll proceed by defining the integration</span></div>
<div style="position:absolute;left:102.18px;top:287.90px" class="cls_039"><span class="cls_039">flow in a separate application to avoid any confusion with the existing domain types.</span></div>
<div style="position:absolute;left:116.69px;top:300.92px" class="cls_039"><span class="cls_039">You also have the choice of defining the flow using either XML configuration, Java</span></div>
<div style="position:absolute;left:102.18px;top:313.91px" class="cls_039"><span class="cls_039">configuration, or the Java DSL. I rather like the elegance of the Java DSL, so that’s</span></div>
<div style="position:absolute;left:102.18px;top:326.93px" class="cls_039"><span class="cls_039">what you’ll use. Feel free to write the flow using one of the other configuration styles if</span></div>
<div style="position:absolute;left:102.18px;top:339.92px" class="cls_039"><span class="cls_039">you’re interested in a little extra challenge. For now, let’s take a look at the Java DSL</span></div>
<div style="position:absolute;left:102.18px;top:352.91px" class="cls_039"><span class="cls_039">configuration for the taco order email flow as shown next.</span></div>
<div style="position:absolute;left:114.18px;top:379.64px" class="cls_066"><span class="cls_066">Listing 9.5</span></div>
<div style="position:absolute;left:166.27px;top:379.64px" class="cls_066"><span class="cls_066">Defining an integration flow to accept emails and submit them as orders</span></div>
<div style="position:absolute;left:102.18px;top:399.50px" class="cls_060"><span class="cls_060">package tacos.email;</span></div>
<div style="position:absolute;left:102.18px;top:409.49px" class="cls_060"><span class="cls_060">import org.springframework.context.annotation.Bean;</span></div>
<div style="position:absolute;left:102.18px;top:419.51px" class="cls_060"><span class="cls_060">import org.springframework.context.annotation.Configuration;</span></div>
<div style="position:absolute;left:102.18px;top:429.50px" class="cls_060"><span class="cls_060">import org.springframework.integration.dsl.IntegrationFlow;</span></div>
<div style="position:absolute;left:102.18px;top:439.49px" class="cls_060"><span class="cls_060">import org.springframework.integration.dsl.IntegrationFlows;</span></div>
<div style="position:absolute;left:102.18px;top:449.51px" class="cls_060"><span class="cls_060">import org.springframework.integration.dsl.Pollers;</span></div>
<div style="position:absolute;left:102.18px;top:469.49px" class="cls_060"><span class="cls_060">@Configuration</span></div>
<div style="position:absolute;left:102.18px;top:479.51px" class="cls_060"><span class="cls_060">public class TacoOrderEmailIntegrationConfig {</span></div>
<div style="position:absolute;left:111.78px;top:499.49px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:111.78px;top:509.51px" class="cls_060"><span class="cls_060">public IntegrationFlow tacoOrderEmailFlow(</span></div>
<div style="position:absolute;left:130.95px;top:519.50px" class="cls_060"><span class="cls_060">EmailProperties emailProps,</span></div>
<div style="position:absolute;left:130.93px;top:529.49px" class="cls_060"><span class="cls_060">EmailToOrderTransformer emailToOrderTransformer,</span></div>
<div style="position:absolute;left:130.96px;top:539.51px" class="cls_060"><span class="cls_060">OrderSubmitMessageHandler orderSubmitHandler) {</span></div>
<div style="position:absolute;left:121.38px;top:559.49px" class="cls_060"><span class="cls_060">return IntegrationFlows</span></div>
<div style="position:absolute;left:140.55px;top:569.51px" class="cls_060"><span class="cls_060">.from(Mail.imapInboundAdapter(emailProps.getImapUrl()),</span></div>
<div style="position:absolute;left:159.76px;top:579.50px" class="cls_060"><span class="cls_060">e -&gt; e.poller(</span></div>
<div style="position:absolute;left:178.95px;top:589.49px" class="cls_060"><span class="cls_060">Pollers.fixedDelay(emailProps.getPollRate())))</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:169672px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background256.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">234</span></div>
<div style="position:absolute;left:206.49px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 9</span></div>
<div style="position:absolute;left:250.62px;top:24.35px" class="cls_055"><span class="cls_055">Integrating Spring</span></div>
<div style="position:absolute;left:131.55px;top:51.32px" class="cls_060"><span class="cls_060">.transform(emailToOrderTransformer)</span></div>
<div style="position:absolute;left:131.55px;top:61.34px" class="cls_060"><span class="cls_060">.handle(orderSubmitHandler)</span></div>
<div style="position:absolute;left:131.55px;top:71.33px" class="cls_060"><span class="cls_060">.get();</span></div>
<div style="position:absolute;left:102.78px;top:81.32px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:101.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:122.66px" class="cls_039"><span class="cls_039">The taco order email flow, as defined in the </span><span class="cls_059">tacoOrderEmailFlow()</span><span class="cls_039"> method, is com-</span></div>
<div style="position:absolute;left:93.18px;top:135.65px" class="cls_039"><span class="cls_039">posed of three distinct components:</span></div>
<div style="position:absolute;left:108.78px;top:152.66px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  An IMAP email inbound channel adapter</span><span class="cls_039">—This channel adapter is created with</span></div>
<div style="position:absolute;left:120.78px;top:165.65px" class="cls_039"><span class="cls_039">the IMP URL generated from the </span><span class="cls_059">getImapUrl()</span><span class="cls_039"> method of </span><span class="cls_059">EmailProperties</span></div>
<div style="position:absolute;left:120.78px;top:178.67px" class="cls_039"><span class="cls_039">and polls on a delay set in the </span><span class="cls_059">pollRate</span><span class="cls_039"> property of </span><span class="cls_059">EmailProperties</span><span class="cls_039">. The</span></div>
<div style="position:absolute;left:120.78px;top:191.66px" class="cls_039"><span class="cls_039">emails coming in are handed off to a channel connecting it to the transformer.</span></div>
<div style="position:absolute;left:108.78px;top:205.67px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  A transformer that transforms an email into an order object</span><span class="cls_039">—The transformer is imple-</span></div>
<div style="position:absolute;left:120.78px;top:218.66px" class="cls_039"><span class="cls_039">mented in </span><span class="cls_059">EmailToOrderTransformer</span><span class="cls_039">, which is injected into the </span><span class="cls_059">tacoOrder-</span></div>
<div style="position:absolute;left:120.87px;top:231.65px" class="cls_059"><span class="cls_059">EmailFlow()</span><span class="cls_039"> method. The orders resulting from the transformation are handed</span></div>
<div style="position:absolute;left:120.78px;top:244.67px" class="cls_039"><span class="cls_039">off to the final component through another channel.</span></div>
<div style="position:absolute;left:108.78px;top:258.65px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  A handler (acting as an outbound channel adapter)</span><span class="cls_039">—The handler accepts an order</span></div>
<div style="position:absolute;left:120.78px;top:271.67px" class="cls_039"><span class="cls_039">object and submits it to Taco Cloud’s REST API.</span></div>
<div style="position:absolute;left:93.18px;top:289.67px" class="cls_039"><span class="cls_039">The call to </span><span class="cls_059">Mail.imapInboundAdapter()</span><span class="cls_039"> is made possible by including the </span><span class="cls_059">Email</span><span class="cls_039"> end-</span></div>
<div style="position:absolute;left:93.18px;top:302.66px" class="cls_039"><span class="cls_039">point module as a dependency in your project build. The Maven dependency looks</span></div>
<div style="position:absolute;left:93.18px;top:315.68px" class="cls_039"><span class="cls_039">like this:</span></div>
<div style="position:absolute;left:93.18px;top:335.33px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:345.35px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.integration&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:355.34px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-integration-file&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:93.18px;top:365.33px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:93.18px;top:386.66px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">EmailToOrderTransformer</span><span class="cls_039"> class is an implementation of Spring Integration’s</span></div>
<div style="position:absolute;left:93.18px;top:399.68px" class="cls_059"><span class="cls_059">Transformer</span><span class="cls_039"> interface, by way of extending </span><span class="cls_059">AbstractMailMessageTransformer</span><span class="cls_039"> (shown</span></div>
<div style="position:absolute;left:93.18px;top:412.67px" class="cls_039"><span class="cls_039">in the following listing).</span></div>
<div style="position:absolute;left:105.18px;top:436.40px" class="cls_066"><span class="cls_066">Listing 9.6</span></div>
<div style="position:absolute;left:157.27px;top:436.40px" class="cls_066"><span class="cls_066">Converting incoming emails to taco orders using an integration transformer</span></div>
<div style="position:absolute;left:93.18px;top:456.26px" class="cls_060"><span class="cls_060">@Component</span></div>
<div style="position:absolute;left:93.18px;top:466.25px" class="cls_060"><span class="cls_060">public class EmailToOrderTransformer</span></div>
<div style="position:absolute;left:117.16px;top:476.24px" class="cls_060"><span class="cls_060">extends AbstractMailMessageTransformer&lt;Order&gt; {</span></div>
<div style="position:absolute;left:102.78px;top:496.25px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:102.78px;top:506.24px" class="cls_060"><span class="cls_060">protected AbstractIntegrationMessageBuilder&lt;Order&gt;</span></div>
<div style="position:absolute;left:169.96px;top:516.26px" class="cls_060"><span class="cls_060">doTransform(Message mailMessage) throws Exception {</span></div>
<div style="position:absolute;left:112.38px;top:526.25px" class="cls_060"><span class="cls_060">Order tacoOrder = processPayload(mailMessage);</span></div>
<div style="position:absolute;left:112.38px;top:536.24px" class="cls_060"><span class="cls_060">return MessageBuilder.withPayload(tacoOrder);</span></div>
<div style="position:absolute;left:102.78px;top:546.26px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:586.25px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:170348px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background257.jpg" width="531" height="666"></div>
<div style="position:absolute;left:208.44px;top:24.35px" class="cls_055"><span class="cls_055">Creating an email integration flow</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">235</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_059"><span class="cls_059">AbstractMailMessageTransformer</span><span class="cls_039"> is a convenient base class for handling messages</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">whose payload is an email. It takes care of extracting the email information from the</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">incoming message into a </span><span class="cls_059">Message</span><span class="cls_039"> object that’s passed into the </span><span class="cls_059">doTransform()</span><span class="cls_039"> method.</span></div>
<div style="position:absolute;left:116.93px;top:89.66px" class="cls_039"><span class="cls_039">In the </span><span class="cls_059">doTransform()</span><span class="cls_039"> method, you pass the </span><span class="cls_059">Message</span><span class="cls_039"> to a </span><span class="cls_059">private</span><span class="cls_039"> method named</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_059"><span class="cls_059">processPayload()</span><span class="cls_039"> to parse the email into an </span><span class="cls_059">Order</span><span class="cls_039"> object. Although similar, the</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_059"><span class="cls_059">Order</span><span class="cls_039"> object in question isn’t the same as the </span><span class="cls_059">Order</span><span class="cls_039"> object used in the main Taco</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">Cloud application; it’s slightly simpler:</span></div>
<div style="position:absolute;left:102.18px;top:148.34px" class="cls_060"><span class="cls_060">package tacos.email;</span></div>
<div style="position:absolute;left:102.18px;top:158.33px" class="cls_060"><span class="cls_060">import java.util.ArrayList;</span></div>
<div style="position:absolute;left:102.18px;top:168.35px" class="cls_060"><span class="cls_060">import java.util.List;</span></div>
<div style="position:absolute;left:102.18px;top:178.34px" class="cls_060"><span class="cls_060">import lombok.Data;</span></div>
<div style="position:absolute;left:102.18px;top:198.35px" class="cls_060"><span class="cls_060">@Data</span></div>
<div style="position:absolute;left:102.18px;top:208.34px" class="cls_060"><span class="cls_060">public class Order {</span></div>
<div style="position:absolute;left:111.78px;top:218.33px" class="cls_060"><span class="cls_060">private final String email;</span></div>
<div style="position:absolute;left:111.78px;top:228.35px" class="cls_060"><span class="cls_060">private List&lt;Taco&gt; tacos = new ArrayList&lt;&gt;();</span></div>
<div style="position:absolute;left:111.78px;top:248.33px" class="cls_060"><span class="cls_060">public void addTaco(Taco taco) {</span></div>
<div style="position:absolute;left:121.38px;top:258.35px" class="cls_060"><span class="cls_060">this.tacos.add(taco);</span></div>
<div style="position:absolute;left:111.78px;top:268.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:278.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:301.67px" class="cls_039"><span class="cls_039">Rather than carry the customer’s entire delivery and billing information, this </span><span class="cls_059">Order</span></div>
<div style="position:absolute;left:102.18px;top:314.66px" class="cls_039"><span class="cls_039">class only carries the customer’s email, obtained from the incoming email.</span></div>
<div style="position:absolute;left:116.76px;top:327.68px" class="cls_039"><span class="cls_039">Parsing emails into taco orders is a non-trivial task. In fact, even a naive implemen-</span></div>
<div style="position:absolute;left:102.18px;top:340.67px" class="cls_039"><span class="cls_039">tation involves several dozen lines of code. And those several dozen lines of code do</span></div>
<div style="position:absolute;left:102.18px;top:353.66px" class="cls_039"><span class="cls_039">nothing to further the discussion of Spring Integration and how to implement a trans-</span></div>
<div style="position:absolute;left:102.18px;top:366.68px" class="cls_039"><span class="cls_039">former. Therefore, to save space, I’m leaving out the details of the </span><span class="cls_059">processPayload()</span></div>
<div style="position:absolute;left:102.18px;top:379.67px" class="cls_039"><span class="cls_039">method.</span></div>
<div style="position:absolute;left:118.09px;top:392.66px" class="cls_039"><span class="cls_039">The last thing that </span><span class="cls_059">EmailToOrderTransformer</span><span class="cls_039"> does is return a </span><span class="cls_059">MessageBuilder</span></div>
<div style="position:absolute;left:102.18px;top:405.68px" class="cls_039"><span class="cls_039">with a payload containing the </span><span class="cls_059">Order</span><span class="cls_039"> object. The message that’s produced by the</span></div>
<div style="position:absolute;left:102.18px;top:418.67px" class="cls_059"><span class="cls_059">MessageBuilder</span><span class="cls_039"> is sent to the final component in the integration flow: a message han-</span></div>
<div style="position:absolute;left:102.18px;top:431.66px" class="cls_039"><span class="cls_039">dler that posts the order to Taco Cloud’s API. The </span><span class="cls_059">OrderSubmitMessageHandler</span><span class="cls_039">, as</span></div>
<div style="position:absolute;left:102.18px;top:444.68px" class="cls_039"><span class="cls_039">shown in the next listing, implements Spring Integration’s </span><span class="cls_059">GenericHandler</span><span class="cls_039"> to handle</span></div>
<div style="position:absolute;left:102.18px;top:457.67px" class="cls_039"><span class="cls_039">messages with an </span><span class="cls_059">Order</span><span class="cls_039"> payload.</span></div>
<div style="position:absolute;left:114.18px;top:483.41px" class="cls_066"><span class="cls_066">Listing 9.7</span></div>
<div style="position:absolute;left:166.27px;top:483.41px" class="cls_066"><span class="cls_066">Posting orders to the Taco Cloud API via a message handler</span></div>
<div style="position:absolute;left:102.18px;top:503.24px" class="cls_060"><span class="cls_060">package tacos.email;</span></div>
<div style="position:absolute;left:102.18px;top:513.26px" class="cls_060"><span class="cls_060">import java.util.Map;</span></div>
<div style="position:absolute;left:102.18px;top:523.25px" class="cls_060"><span class="cls_060">import org.springframework.integration.handler.GenericHandler;</span></div>
<div style="position:absolute;left:102.18px;top:533.24px" class="cls_060"><span class="cls_060">import org.springframework.stereotype.Component;</span></div>
<div style="position:absolute;left:102.18px;top:543.26px" class="cls_060"><span class="cls_060">import org.springframework.web.client.RestTemplate;</span></div>
<div style="position:absolute;left:102.18px;top:563.24px" class="cls_060"><span class="cls_060">@Component</span></div>
<div style="position:absolute;left:102.18px;top:573.26px" class="cls_060"><span class="cls_060">public class OrderSubmitMessageHandler</span></div>
<div style="position:absolute;left:265.26px;top:583.25px" class="cls_060"><span class="cls_060">implements GenericHandler&lt;Order&gt; {</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:171024px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background258.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">236</span></div>
<div style="position:absolute;left:206.49px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 9</span></div>
<div style="position:absolute;left:250.62px;top:24.35px" class="cls_055"><span class="cls_055">Integrating Spring</span></div>
<div style="position:absolute;left:102.78px;top:51.32px" class="cls_060"><span class="cls_060">private RestTemplate rest;</span></div>
<div style="position:absolute;left:102.78px;top:61.34px" class="cls_060"><span class="cls_060">private ApiProperties apiProps;</span></div>
<div style="position:absolute;left:102.78px;top:81.32px" class="cls_060"><span class="cls_060">public OrderSubmitMessageHandler(</span></div>
<div style="position:absolute;left:141.16px;top:91.34px" class="cls_060"><span class="cls_060">ApiProperties apiProps, RestTemplate rest) {</span></div>
<div style="position:absolute;left:112.38px;top:101.33px" class="cls_060"><span class="cls_060">this.apiProps = apiProps;</span></div>
<div style="position:absolute;left:112.38px;top:111.32px" class="cls_060"><span class="cls_060">this.rest = rest;</span></div>
<div style="position:absolute;left:102.78px;top:121.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.78px;top:141.35px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:102.78px;top:151.34px" class="cls_060"><span class="cls_060">public Object handle(Order order, Map&lt;String, Object&gt; headers) {</span></div>
<div style="position:absolute;left:112.36px;top:161.33px" class="cls_060"><span class="cls_060">rest.postForObject(apiProps.getUrl(), order, String.class);</span></div>
<div style="position:absolute;left:112.38px;top:171.35px" class="cls_060"><span class="cls_060">return null;</span></div>
<div style="position:absolute;left:102.78px;top:181.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:201.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:224.66px" class="cls_039"><span class="cls_039">To satisfy the requirements of the </span><span class="cls_059">GenericHandler</span><span class="cls_039"> interface, </span><span class="cls_059">OrderSubmitMessage-</span></div>
<div style="position:absolute;left:93.18px;top:237.65px" class="cls_059"><span class="cls_059">Handler</span><span class="cls_039"> overrides the </span><span class="cls_059">handle()</span><span class="cls_039"> method. This method receives the incoming </span><span class="cls_059">Order</span></div>
<div style="position:absolute;left:93.18px;top:250.67px" class="cls_039"><span class="cls_039">object and uses an injected </span><span class="cls_059">RestTemplate</span><span class="cls_039"> to submit the </span><span class="cls_059">Order</span><span class="cls_039"> via a POST request to</span></div>
<div style="position:absolute;left:93.18px;top:263.66px" class="cls_039"><span class="cls_039">the URL captured in an injected </span><span class="cls_059">ApiProperties</span><span class="cls_039"> object. Finally, the </span><span class="cls_059">handle()</span><span class="cls_039"> method</span></div>
<div style="position:absolute;left:93.18px;top:276.65px" class="cls_039"><span class="cls_039">returns </span><span class="cls_059">null</span><span class="cls_039"> to indicate that this handler marks the end of the flow.</span></div>
<div style="position:absolute;left:109.92px;top:289.67px" class="cls_059"><span class="cls_059">ApiProperties</span><span class="cls_039"> is used to avoid hardcoding the URL in the call to </span><span class="cls_059">postFor-</span></div>
<div style="position:absolute;left:93.18px;top:302.66px" class="cls_059"><span class="cls_059">Object()</span><span class="cls_039">. It’s a configuration properties file that looks like this:</span></div>
<div style="position:absolute;left:93.18px;top:325.34px" class="cls_060"><span class="cls_060">@Data</span></div>
<div style="position:absolute;left:93.18px;top:335.33px" class="cls_060"><span class="cls_060">@ConfigurationProperties(prefix="tacocloud.api")</span></div>
<div style="position:absolute;left:93.18px;top:345.35px" class="cls_060"><span class="cls_060">@Component</span></div>
<div style="position:absolute;left:93.18px;top:355.34px" class="cls_060"><span class="cls_060">public class ApiProperties {</span></div>
<div style="position:absolute;left:102.76px;top:365.33px" class="cls_060"><span class="cls_060">private String url;</span></div>
<div style="position:absolute;left:93.18px;top:375.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:398.66px" class="cls_039"><span class="cls_039">And in application.yml, the URL for the Taco Cloud API might be configured like this:</span></div>
<div style="position:absolute;left:93.18px;top:420.35px" class="cls_060"><span class="cls_060">tacocloud:</span></div>
<div style="position:absolute;left:102.78px;top:430.34px" class="cls_060"><span class="cls_060">api:</span></div>
<div style="position:absolute;left:112.38px;top:440.36px" class="cls_061"><span class="cls_061">url: </span><a href="http://api.tacocloud.com/">http://api.tacocloud.com</a> </div>
<div style="position:absolute;left:93.18px;top:463.67px" class="cls_039"><span class="cls_039">In order to make </span><span class="cls_059">RestTemplate</span><span class="cls_039"> available in the project so that it can be injected into</span></div>
<div style="position:absolute;left:93.18px;top:476.66px" class="cls_059"><span class="cls_059">OrderSubmitMessageHandler</span><span class="cls_039">, you need to add the Spring Boot web starter to the</span></div>
<div style="position:absolute;left:93.18px;top:489.68px" class="cls_039"><span class="cls_039">project build:</span></div>
<div style="position:absolute;left:93.18px;top:511.34px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:521.36px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:531.35px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:93.18px;top:541.34px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:93.18px;top:564.68px" class="cls_039"><span class="cls_039">Whereas this makes </span><span class="cls_059">RestTemplate</span><span class="cls_039"> available in the classpath, it also triggers auto-</span></div>
<div style="position:absolute;left:93.18px;top:577.67px" class="cls_039"><span class="cls_039">configuration for Spring MVC. As a standalone Spring Integration flow, the applica-</span></div>
<div style="position:absolute;left:93.18px;top:590.69px" class="cls_039"><span class="cls_039">tion doesn’t need Spring MVC or even the embedded Tomcat that autoconfiguration</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:171700px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background259.jpg" width="531" height="666"></div>
<div style="position:absolute;left:253.20px;top:24.35px" class="cls_055"><span class="cls_055">Summary</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">237</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">provides. Therefore, you should disable Spring MVC autoconfiguration with the fol-</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">lowing entry in application.yml:</span></div>
<div style="position:absolute;left:102.18px;top:83.33px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:111.78px;top:93.32px" class="cls_060"><span class="cls_060">main:</span></div>
<div style="position:absolute;left:121.38px;top:103.34px" class="cls_061"><span class="cls_061">web-application-type: none</span></div>
<div style="position:absolute;left:102.18px;top:124.67px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">spring.main.web-application-type</span><span class="cls_039"> property can be set to either </span><span class="cls_059">servlet</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:102.18px;top:137.66px" class="cls_059"><span class="cls_059">reactive</span><span class="cls_039">, or </span><span class="cls_059">none</span><span class="cls_039">. When Spring MVC is in the classpath, autoconfiguration sets its</span></div>
<div style="position:absolute;left:102.18px;top:150.65px" class="cls_039"><span class="cls_039">value to </span><span class="cls_059">servlet</span><span class="cls_039">. But here you override it to </span><span class="cls_059">none</span><span class="cls_039"> so that Spring MVC and Tomcat</span></div>
<div style="position:absolute;left:102.18px;top:163.67px" class="cls_039"><span class="cls_039">won’t be autoconfigured. (We’ll talk more about what it means for an application to</span></div>
<div style="position:absolute;left:102.18px;top:176.66px" class="cls_039"><span class="cls_039">be a reactive web application in chapter 11.)</span></div>
<div style="position:absolute;left:102.18px;top:197.83px" class="cls_040"><span class="cls_040">Summary</span></div>
<div style="position:absolute;left:117.78px;top:216.17px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Spring Integration enables the definition of flows through which data can be</span></div>
<div style="position:absolute;left:129.78px;top:229.16px" class="cls_039"><span class="cls_039">processed as it enters or leaves an application.</span></div>
<div style="position:absolute;left:117.78px;top:243.17px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Integration flows can be defined in XML, Java, or using a succinct Java DSL con-</span></div>
<div style="position:absolute;left:129.78px;top:256.16px" class="cls_039"><span class="cls_039">figuration style.</span></div>
<div style="position:absolute;left:117.78px;top:270.17px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Message gateways and channel adapters act as entry and exit points of an inte-</span></div>
<div style="position:absolute;left:129.78px;top:283.16px" class="cls_039"><span class="cls_039">gration flow.</span></div>
<div style="position:absolute;left:117.78px;top:297.17px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Messages can be transformed, split, aggregated, routed, and processed by ser-</span></div>
<div style="position:absolute;left:129.78px;top:310.16px" class="cls_039"><span class="cls_039">vice activators in the course of a flow.</span></div>
<div style="position:absolute;left:117.78px;top:324.17px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Message channels connect the components of an integration flow.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:172376px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background260.jpg" width="531" height="666"></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:172376px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background261.jpg" width="531" height="666"></div>
<div style="position:absolute;left:388.38px;top:82.94px" class="cls_014"><span class="cls_014">Part 3</span></div>
<div style="position:absolute;left:292.38px;top:142.94px" class="cls_014"><span class="cls_014">Reactive Spring</span></div>
<div style="position:absolute;left:126.18px;top:215.61px" class="cls_047"><span class="cls_047">I</span></div>
<div style="position:absolute;left:143.46px;top:253.67px" class="cls_039"><span class="cls_039">n part 3, we’ll explore the exciting new support for reactive programming in</span></div>
<div style="position:absolute;left:126.18px;top:266.66px" class="cls_039"><span class="cls_039">Spring. Chapter 10 discusses the essentials of reactive programming with Project</span></div>
<div style="position:absolute;left:126.18px;top:279.65px" class="cls_039"><span class="cls_039">Reactor, the reactive programming library that underpins Spring 5’s reactive fea-</span></div>
<div style="position:absolute;left:126.18px;top:292.67px" class="cls_039"><span class="cls_039">tures. We’ll then look at some of Reactor’s most useful reactive operations. In</span></div>
<div style="position:absolute;left:126.18px;top:305.66px" class="cls_039"><span class="cls_039">chapter 11, we'll revisit REST API development, introducing Spring WebFlux, a</span></div>
<div style="position:absolute;left:126.18px;top:318.68px" class="cls_039"><span class="cls_039">new web framework that borrows much from Spring MVC while offering a new</span></div>
<div style="position:absolute;left:126.18px;top:331.67px" class="cls_039"><span class="cls_039">reactive model for web development. Chapter 12 rounds out part 3 with a look</span></div>
<div style="position:absolute;left:126.18px;top:344.66px" class="cls_039"><span class="cls_039">at writing reactive data persistence with Spring Data to read and write data to</span></div>
<div style="position:absolute;left:126.18px;top:357.68px" class="cls_039"><span class="cls_039">Cassandra and Mongo databases.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:173052px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background262.jpg" width="531" height="666"></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:173052px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background263.jpg" width="531" height="666"></div>
<div style="position:absolute;left:240.78px;top:111.83px" class="cls_014"><span class="cls_014">Introducing Reactor</span></div>
<div style="position:absolute;left:96.18px;top:264.85px" class="cls_049"><span class="cls_049">This chapter covers</span></div>
<div style="position:absolute;left:96.18px;top:283.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Understanding reactive programming</span></div>
<div style="position:absolute;left:96.18px;top:298.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Project Reactor</span></div>
<div style="position:absolute;left:96.18px;top:313.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Operating on data reactively</span></div>
<div style="position:absolute;left:114.18px;top:383.54px" class="cls_039"><span class="cls_039">Have you ever held a subscription for a newspaper or a magazine? The internet has</span></div>
<div style="position:absolute;left:114.18px;top:396.53px" class="cls_039"><span class="cls_039">certainly taken a bite out of the subscriber base of traditional publications, but</span></div>
<div style="position:absolute;left:114.18px;top:409.55px" class="cls_039"><span class="cls_039">there was a time when a newspaper subscription was one of the best ways to keep up</span></div>
<div style="position:absolute;left:114.18px;top:422.54px" class="cls_039"><span class="cls_039">with the events of the day. You could count on a fresh delivery of current events</span></div>
<div style="position:absolute;left:114.18px;top:435.53px" class="cls_039"><span class="cls_039">every morning, to read during breakfast or on the way to work.</span></div>
<div style="position:absolute;left:128.94px;top:448.55px" class="cls_039"><span class="cls_039">Now suppose that if, after paying for your subscription, several days go by and</span></div>
<div style="position:absolute;left:114.18px;top:461.54px" class="cls_039"><span class="cls_039">no papers have been delivered. A few more days go by, and you call the newspa-</span></div>
<div style="position:absolute;left:114.18px;top:474.56px" class="cls_039"><span class="cls_039">per sales office to ask why you haven’t yet received your daily paper. Imagine your</span></div>
<div style="position:absolute;left:114.18px;top:487.55px" class="cls_039"><span class="cls_039">surprise if they explain, “You paid for a full year of newspapers. The year hasn’t</span></div>
<div style="position:absolute;left:114.18px;top:500.54px" class="cls_039"><span class="cls_039">completed yet. You’ll certainly receive them all once the full year of newspapers</span></div>
<div style="position:absolute;left:114.18px;top:513.56px" class="cls_039"><span class="cls_039">is ready.”</span></div>
<div style="position:absolute;left:129.14px;top:526.55px" class="cls_039"><span class="cls_039">Thankfully, that’s not at all how subscriptions work. Newspapers have a certain</span></div>
<div style="position:absolute;left:114.18px;top:539.54px" class="cls_039"><span class="cls_039">timeliness to them. They’re delivered as quickly as possible after publication so that</span></div>
<div style="position:absolute;left:114.18px;top:552.56px" class="cls_039"><span class="cls_039">they can be read while their content is still fresh. Moreover, as you’re reading the</span></div>
<div style="position:absolute;left:269.16px;top:596.99px" class="cls_048"><span class="cls_048">241</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:173728px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background264.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">242</span></div>
<div style="position:absolute;left:201.03px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 10</span></div>
<div style="position:absolute;left:249.96px;top:24.35px" class="cls_055"><span class="cls_055">Introducing Reactor</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">latest issue, newspaper reporters are writing new stories for future editions, and the</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">presses are fired up producing the next edition—all in parallel.</span></div>
<div style="position:absolute;left:108.06px;top:76.67px" class="cls_039"><span class="cls_039">As we develop application code, there are two styles of code we can write: impera-</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">tive and reactive:</span></div>
<div style="position:absolute;left:108.78px;top:106.67px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Imperative</span><span class="cls_039"> code is a lot like that absurd hypothetical newspaper subscription. It’s</span></div>
<div style="position:absolute;left:120.78px;top:119.66px" class="cls_039"><span class="cls_039">a serial set of tasks, each running one at a time, each after the previous task.</span></div>
<div style="position:absolute;left:120.78px;top:132.65px" class="cls_039"><span class="cls_039">Data is processed in bulk and can’t be handed over to the next task until the</span></div>
<div style="position:absolute;left:120.78px;top:145.67px" class="cls_039"><span class="cls_039">previous task has completed its work on the bulk of data.</span></div>
<div style="position:absolute;left:108.78px;top:159.65px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Reactive</span><span class="cls_039"> code is a lot like a real newspaper subscription. A set of tasks is defined</span></div>
<div style="position:absolute;left:120.78px;top:172.67px" class="cls_039"><span class="cls_039">to process data, but those tasks can run in parallel. Each task can process sub-</span></div>
<div style="position:absolute;left:120.78px;top:185.66px" class="cls_039"><span class="cls_039">sets of the data, handing it off to the next task in line while it continues to work</span></div>
<div style="position:absolute;left:120.78px;top:198.65px" class="cls_039"><span class="cls_039">on another subset of the data.</span></div>
<div style="position:absolute;left:93.18px;top:216.65px" class="cls_039"><span class="cls_039">In this chapter, we’re going to step away from the Taco Cloud application temporar-</span></div>
<div style="position:absolute;left:93.18px;top:229.67px" class="cls_039"><span class="cls_039">ily to explore Project Reactor. Reactor is a library for reactive programming that’s</span></div>
<div style="position:absolute;left:93.18px;top:242.66px" class="cls_039"><span class="cls_039">part of the Spring family of projects. And because it serves as the foundation of</span></div>
<div style="position:absolute;left:93.18px;top:255.65px" class="cls_039"><span class="cls_039">Spring 5’s support for reactive programming, it’s important that you understand</span></div>
<div style="position:absolute;left:93.18px;top:268.67px" class="cls_039"><span class="cls_039">Reactor before we look at building reactive controllers and repositories with Spring.</span></div>
<div style="position:absolute;left:93.18px;top:281.66px" class="cls_039"><span class="cls_039">Before we start working with Reactor, though, let’s quickly examine the essentials of</span></div>
<div style="position:absolute;left:93.18px;top:294.68px" class="cls_039"><span class="cls_039">reactive programming.</span></div>
<div style="position:absolute;left:57.18px;top:315.82px" class="cls_040"><span class="cls_040">10.1</span></div>
<div style="position:absolute;left:93.18px;top:315.82px" class="cls_040"><span class="cls_040">Understanding reactive programming</span></div>
<div style="position:absolute;left:93.18px;top:333.68px" class="cls_039"><span class="cls_039">Reactive programming is a paradigm that’s an alternative to imperative programming.</span></div>
<div style="position:absolute;left:93.18px;top:346.67px" class="cls_039"><span class="cls_039">This alternative exists because reactive programming addresses a limitation in impera-</span></div>
<div style="position:absolute;left:93.18px;top:359.66px" class="cls_039"><span class="cls_039">tive programming. By understanding these limitations, you can better grasp the bene-</span></div>
<div style="position:absolute;left:93.18px;top:372.68px" class="cls_039"><span class="cls_039">fits of the reactive model.</span></div>
<div style="position:absolute;left:105.18px;top:393.68px" class="cls_083"><span class="cls_083">NOTE</span><span class="cls_039">  Reactive programming isn't a silver bullet. In no way should you infer</span></div>
<div style="position:absolute;left:105.18px;top:405.68px" class="cls_039"><span class="cls_039">from this chapter or any other discussion of reactive programming that</span></div>
<div style="position:absolute;left:105.18px;top:417.68px" class="cls_039"><span class="cls_039">imperative programming is evil and that reactive programming is your savior.</span></div>
<div style="position:absolute;left:105.18px;top:429.68px" class="cls_039"><span class="cls_039">Like anything you learn as a developer, reactive programming is a perfect fit</span></div>
<div style="position:absolute;left:105.18px;top:441.68px" class="cls_039"><span class="cls_039">in some use cases, and it’s ill fitted in others. An ounce of pragmatism is</span></div>
<div style="position:absolute;left:105.18px;top:453.68px" class="cls_039"><span class="cls_039">advised.</span></div>
<div style="position:absolute;left:93.18px;top:473.66px" class="cls_039"><span class="cls_039">If you’re like me and many developers, you cut your programming teeth with impera-</span></div>
<div style="position:absolute;left:93.18px;top:486.68px" class="cls_039"><span class="cls_039">tive programming. There’s a good chance that most (or all) of the code you write</span></div>
<div style="position:absolute;left:93.18px;top:499.67px" class="cls_039"><span class="cls_039">today is still imperative in nature. Imperative programming is intuitive enough that</span></div>
<div style="position:absolute;left:93.18px;top:512.66px" class="cls_039"><span class="cls_039">young students are learning it with ease in their school’s STEM programs, and it’s</span></div>
<div style="position:absolute;left:93.18px;top:525.68px" class="cls_039"><span class="cls_039">powerful enough that it makes up the bulk of code that drives the largest enterprises.</span></div>
<div style="position:absolute;left:107.82px;top:538.67px" class="cls_039"><span class="cls_039">The idea is simple: you write code as a list of instructions to be followed, one at a</span></div>
<div style="position:absolute;left:93.18px;top:551.69px" class="cls_039"><span class="cls_039">time, in the order that they’re encountered. A task is performed and the program</span></div>
<div style="position:absolute;left:93.18px;top:564.68px" class="cls_039"><span class="cls_039">waits for it to complete before moving on to the next task. At each step along the</span></div>
<div style="position:absolute;left:93.18px;top:577.67px" class="cls_039"><span class="cls_039">way, the data that’s to be processed must be fully available so that it can be processed</span></div>
<div style="position:absolute;left:93.18px;top:590.69px" class="cls_039"><span class="cls_039">as a whole.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:174404px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background265.jpg" width="531" height="666"></div>
<div style="position:absolute;left:202.95px;top:24.35px" class="cls_055"><span class="cls_055">Understanding reactive programming</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">243</span></div>
<div style="position:absolute;left:116.79px;top:50.66px" class="cls_039"><span class="cls_039">This is fine ... until it isn’t. While a task is being performed, and especially if it’s an</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">I/O task such as writing data to a database or fetching data from a remote server, the</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">thread that invoked that task is blocked, unable to do anything else until the task com-</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">pletes. To put it bluntly, blocked threads are wasteful.</span></div>
<div style="position:absolute;left:117.33px;top:102.65px" class="cls_039"><span class="cls_039">Most programming languages, including Java, support concurrent programming.</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">It’s fairly easy to fire up another thread in Java and send it on its way to perform some</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">work while the invoking thread carries on with something else. But although it’s easy</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">to create threads, those threads are likely to end up blocked themselves. Managing</span></div>
<div style="position:absolute;left:102.18px;top:154.67px" class="cls_039"><span class="cls_039">concurrency in multiple threads is challenging. More threads mean more complexity.</span></div>
<div style="position:absolute;left:117.29px;top:167.66px" class="cls_039"><span class="cls_039">In contrast, reactive programming is functional and declarative in nature. Rather</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">than describe a set of steps that are to be performed sequentially, reactive program-</span></div>
<div style="position:absolute;left:102.18px;top:193.67px" class="cls_039"><span class="cls_039">ming involves describing a pipeline or stream through which data flows. Rather than</span></div>
<div style="position:absolute;left:102.18px;top:206.66px" class="cls_039"><span class="cls_039">requiring the data be available to be processed as a whole, a reactive stream processes</span></div>
<div style="position:absolute;left:102.18px;top:219.65px" class="cls_039"><span class="cls_039">data as it becomes available. In fact, the incoming data may be endless (a constant</span></div>
<div style="position:absolute;left:102.18px;top:232.67px" class="cls_039"><span class="cls_039">stream of a location’s real-time temperature data, for instance).</span></div>
<div style="position:absolute;left:117.82px;top:245.66px" class="cls_039"><span class="cls_039">To apply a real-world analogy, consider imperative programming as a water bal-</span></div>
<div style="position:absolute;left:102.18px;top:258.65px" class="cls_039"><span class="cls_039">loon and reactive programming as a garden hose. Both are suitable ways to surprise</span></div>
<div style="position:absolute;left:102.18px;top:271.67px" class="cls_039"><span class="cls_039">and soak an unsuspecting friend on a hot summer day. But they differ in their execu-</span></div>
<div style="position:absolute;left:102.18px;top:284.66px" class="cls_039"><span class="cls_039">tion style:</span></div>
<div style="position:absolute;left:117.78px;top:301.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  A water balloon carries its payload all at once, soaking its intended target at the</span></div>
<div style="position:absolute;left:129.78px;top:314.66px" class="cls_039"><span class="cls_039">moment of impact. The water balloon has a finite capacity, however, and if you</span></div>
<div style="position:absolute;left:129.78px;top:327.68px" class="cls_039"><span class="cls_039">wish to soak more people (or the same person to a greater extent), your only</span></div>
<div style="position:absolute;left:129.78px;top:340.67px" class="cls_039"><span class="cls_039">choice is to scale up by increasing the number of water balloons.</span></div>
<div style="position:absolute;left:117.78px;top:354.68px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  A garden hose carries its payload as a stream of water that flows from the spigot</span></div>
<div style="position:absolute;left:129.78px;top:367.67px" class="cls_039"><span class="cls_039">to the nozzle. The garden hose’s capacity may be finite at any given point in</span></div>
<div style="position:absolute;left:129.78px;top:380.66px" class="cls_039"><span class="cls_039">time, but it’s unlimited over the course of a water battle. As long as water is</span></div>
<div style="position:absolute;left:129.78px;top:393.68px" class="cls_039"><span class="cls_039">entering the hose from the spigot, it will continue to flow through the hose and</span></div>
<div style="position:absolute;left:129.78px;top:406.67px" class="cls_039"><span class="cls_039">spray out of the nozzle. The same garden hose is easily scalable to soak as many</span></div>
<div style="position:absolute;left:129.78px;top:419.66px" class="cls_039"><span class="cls_039">friends as you wish.</span></div>
<div style="position:absolute;left:102.18px;top:439.67px" class="cls_039"><span class="cls_039">There’s nothing inherently wrong with water balloons (or imperative programming),</span></div>
<div style="position:absolute;left:102.18px;top:452.66px" class="cls_039"><span class="cls_039">but the person holding the garden hose (or applying reactive programming) has an</span></div>
<div style="position:absolute;left:102.18px;top:465.68px" class="cls_039"><span class="cls_039">advantage in regard to scalability and performance.</span></div>
<div style="position:absolute;left:66.18px;top:491.51px" class="cls_063"><span class="cls_063">10.1.1</span></div>
<div style="position:absolute;left:102.18px;top:491.51px" class="cls_063"><span class="cls_063">Defining Reactive Streams</span></div>
<div style="position:absolute;left:102.18px;top:509.18px" class="cls_039"><span class="cls_039">Reactive Streams is an initiative started in late 2013 by engineers from Netflix, Light-</span></div>
<div style="position:absolute;left:102.18px;top:522.17px" class="cls_039"><span class="cls_039">bend, and Pivotal (the company behind Spring). Reactive Streams aims to provide a</span></div>
<div style="position:absolute;left:102.18px;top:535.16px" class="cls_039"><span class="cls_039">standard for asynchronous stream processing with non-blocking backpressure.</span></div>
<div style="position:absolute;left:118.25px;top:548.18px" class="cls_039"><span class="cls_039">We’ve already touched on the asynchronous trait of reactive programming; it’s</span></div>
<div style="position:absolute;left:102.18px;top:561.17px" class="cls_039"><span class="cls_039">what enables us to perform tasks in parallel to achieve greater scalability. Backpressure</span></div>
<div style="position:absolute;left:102.18px;top:574.19px" class="cls_039"><span class="cls_039">is a means by which consumers of data can avoid being overwhelmed by an overly fast</span></div>
<div style="position:absolute;left:102.18px;top:587.18px" class="cls_039"><span class="cls_039">data source, by establishing limits on how much they’re willing to handle.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:175080px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background266.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">244</span></div>
<div style="position:absolute;left:201.03px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 10</span></div>
<div style="position:absolute;left:249.96px;top:24.35px" class="cls_055"><span class="cls_055">Introducing Reactor</span></div>
<div style="position:absolute;left:105.18px;top:62.48px" class="cls_075"><span class="cls_075">Java Streams vs. Reactive Streams</span></div>
<div style="position:absolute;left:105.18px;top:76.34px" class="cls_076"><span class="cls_076">There’s a lot of similarity between Java Streams and Reactive Streams. To start with,</span></div>
<div style="position:absolute;left:105.18px;top:87.32px" class="cls_076"><span class="cls_076">they both have the word </span><span class="cls_092">Streams</span><span class="cls_076"> in their names. They also both provide a functional</span></div>
<div style="position:absolute;left:105.18px;top:98.33px" class="cls_076"><span class="cls_076">API for working with data. In fact, as you’ll see later when we look at Reactor, they</span></div>
<div style="position:absolute;left:105.18px;top:109.34px" class="cls_076"><span class="cls_076">even share many of the same operations.</span></div>
<div style="position:absolute;left:105.18px;top:127.34px" class="cls_076"><span class="cls_076">Java Streams, however, are typically synchronous and work with a finite set of data.</span></div>
<div style="position:absolute;left:105.18px;top:138.35px" class="cls_076"><span class="cls_076">They’re essentially a means of iterating over a collection with functions.</span></div>
<div style="position:absolute;left:105.18px;top:156.35px" class="cls_076"><span class="cls_076">Reactive Streams support asynchronous processing of datasets of any size, including</span></div>
<div style="position:absolute;left:105.18px;top:167.33px" class="cls_076"><span class="cls_076">infinite datasets. They process data in real time, as it becomes available, with back-</span></div>
<div style="position:absolute;left:105.18px;top:178.34px" class="cls_076"><span class="cls_076">pressure to avoid overwhelming their consumers.</span></div>
<div style="position:absolute;left:93.18px;top:209.66px" class="cls_039"><span class="cls_039">The Reactive Streams specification can be summed up by four interface definitions:</span></div>
<div style="position:absolute;left:93.18px;top:222.65px" class="cls_059"><span class="cls_059">Publisher</span><span class="cls_039">, </span><span class="cls_059">Subscriber</span><span class="cls_039">, </span><span class="cls_059">Subscription</span><span class="cls_039">, and </span><span class="cls_059">Processor</span><span class="cls_039">. A </span><span class="cls_059">Publisher</span><span class="cls_039"> produces data that</span></div>
<div style="position:absolute;left:93.18px;top:235.67px" class="cls_039"><span class="cls_039">it sends to a </span><span class="cls_059">Subscriber</span><span class="cls_039"> per a </span><span class="cls_059">Subscription</span><span class="cls_039">. The </span><span class="cls_059">Publisher</span><span class="cls_039"> interface declares a single</span></div>
<div style="position:absolute;left:93.18px;top:248.66px" class="cls_039"><span class="cls_039">method, </span><span class="cls_059">subscribe()</span><span class="cls_039">, through which a </span><span class="cls_059">Subscriber</span><span class="cls_039"> can subscribe to the </span><span class="cls_059">Publisher</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:268.34px" class="cls_060"><span class="cls_060">public interface Publisher&lt;T&gt; {</span></div>
<div style="position:absolute;left:102.77px;top:278.33px" class="cls_060"><span class="cls_060">void subscribe(Subscriber&lt;? super T&gt; subscriber);</span></div>
<div style="position:absolute;left:93.18px;top:288.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:309.68px" class="cls_039"><span class="cls_039">Once a </span><span class="cls_059">Subscriber</span><span class="cls_039"> has subscribed, it can receive events from the </span><span class="cls_059">Publisher</span><span class="cls_039">. Those</span></div>
<div style="position:absolute;left:93.18px;top:322.67px" class="cls_039"><span class="cls_039">events are sent via methods on the </span><span class="cls_059">Subscriber</span><span class="cls_039"> interface:</span></div>
<div style="position:absolute;left:93.18px;top:342.35px" class="cls_060"><span class="cls_060">public interface Subscriber&lt;T&gt; {</span></div>
<div style="position:absolute;left:102.78px;top:352.34px" class="cls_060"><span class="cls_060">void onSubscribe(Subscription sub);</span></div>
<div style="position:absolute;left:102.78px;top:362.33px" class="cls_060"><span class="cls_060">void onNext(T item);</span></div>
<div style="position:absolute;left:102.78px;top:372.35px" class="cls_060"><span class="cls_060">void onError(Throwable ex);</span></div>
<div style="position:absolute;left:102.78px;top:382.34px" class="cls_060"><span class="cls_060">void onComplete();</span></div>
<div style="position:absolute;left:93.18px;top:392.36px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:413.66px" class="cls_039"><span class="cls_039">The first event that the </span><span class="cls_059">Subscriber</span><span class="cls_039"> will receive is through a call to </span><span class="cls_059">onSubscribe()</span><span class="cls_039">. When</span></div>
<div style="position:absolute;left:93.18px;top:426.68px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">Publisher</span><span class="cls_039"> calls </span><span class="cls_059">onSubscribe()</span><span class="cls_039">, it passes a </span><span class="cls_059">Subscription</span><span class="cls_039"> object to the </span><span class="cls_059">Subscriber</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:93.18px;top:439.67px" class="cls_039"><span class="cls_039">It’s through the </span><span class="cls_059">Subscription</span><span class="cls_039"> that the </span><span class="cls_059">Subscriber</span><span class="cls_039"> can manage its subscription:</span></div>
<div style="position:absolute;left:93.18px;top:459.35px" class="cls_060"><span class="cls_060">public interface Subscription {</span></div>
<div style="position:absolute;left:102.78px;top:469.34px" class="cls_060"><span class="cls_060">void request(long n);</span></div>
<div style="position:absolute;left:102.78px;top:479.36px" class="cls_060"><span class="cls_060">void cancel();</span></div>
<div style="position:absolute;left:93.18px;top:489.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:510.68px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">Subscriber</span><span class="cls_039"> can call </span><span class="cls_059">request()</span><span class="cls_039"> to request that data be sent, or it can call </span><span class="cls_059">cancel()</span></div>
<div style="position:absolute;left:93.18px;top:523.67px" class="cls_039"><span class="cls_039">to indicate that it’s no longer interested in receiving data and is canceling the sub-</span></div>
<div style="position:absolute;left:93.18px;top:536.66px" class="cls_039"><span class="cls_039">scription. When calling </span><span class="cls_059">request()</span><span class="cls_039">, the </span><span class="cls_059">Subscriber</span><span class="cls_039"> passes in a </span><span class="cls_059">long</span><span class="cls_039"> value to indi-</span></div>
<div style="position:absolute;left:93.18px;top:549.68px" class="cls_039"><span class="cls_039">cate how many data items it’s willing to accept. This is where backpressure comes in,</span></div>
<div style="position:absolute;left:93.18px;top:562.67px" class="cls_039"><span class="cls_039">preventing the </span><span class="cls_059">Publisher</span><span class="cls_039"> from sending more data than the </span><span class="cls_059">Subscriber</span><span class="cls_039"> is able to han-</span></div>
<div style="position:absolute;left:93.18px;top:575.69px" class="cls_039"><span class="cls_039">dle. After the </span><span class="cls_059">Publisher</span><span class="cls_039"> has sent as many items as were requested, the </span><span class="cls_059">Subscriber</span><span class="cls_039"> can</span></div>
<div style="position:absolute;left:93.18px;top:588.68px" class="cls_039"><span class="cls_039">call </span><span class="cls_059">request()</span><span class="cls_039"> again to request more.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:175756px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background267.jpg" width="531" height="666"></div>
<div style="position:absolute;left:219.57px;top:24.35px" class="cls_055"><span class="cls_055">Getting started with Reactor</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">245</span></div>
<div style="position:absolute;left:118.77px;top:50.66px" class="cls_039"><span class="cls_039">Once the </span><span class="cls_059">Subscriber</span><span class="cls_039"> has requested data, the data starts flowing through the</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">stream. For every item that’s published by the </span><span class="cls_059">Publisher</span><span class="cls_039">, the </span><span class="cls_059">onNext()</span><span class="cls_039"> method will</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">be called to deliver the data to the </span><span class="cls_059">Subscriber</span><span class="cls_039">. If there are any errors, </span><span class="cls_059">onError()</span><span class="cls_039"> is</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">called. If the </span><span class="cls_059">Publisher</span><span class="cls_039"> has no more data to send and isn’t going to produce any</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">more data, it will call </span><span class="cls_059">onComplete()</span><span class="cls_039"> to tell the </span><span class="cls_059">Subscriber</span><span class="cls_039"> that it’s out of business.</span></div>
<div style="position:absolute;left:117.30px;top:115.67px" class="cls_039"><span class="cls_039">As for the </span><span class="cls_059">Processor</span><span class="cls_039"> interface, it’s a combination of </span><span class="cls_059">Subscriber</span><span class="cls_039"> and </span><span class="cls_059">Publisher</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">as shown here:</span></div>
<div style="position:absolute;left:102.18px;top:148.34px" class="cls_060"><span class="cls_060">public interface Processor&lt;T, R&gt;</span></div>
<div style="position:absolute;left:145.36px;top:158.33px" class="cls_061"><span class="cls_061">extends Subscriber&lt;T&gt;, Publisher&lt;R&gt; {}</span></div>
<div style="position:absolute;left:102.18px;top:177.65px" class="cls_039"><span class="cls_039">As a </span><span class="cls_059">Subscriber</span><span class="cls_039">, a </span><span class="cls_059">Processor</span><span class="cls_039"> will receive data and process it in some way. Then it will</span></div>
<div style="position:absolute;left:102.18px;top:190.67px" class="cls_039"><span class="cls_039">switch hats and act as a </span><span class="cls_059">Publisher</span><span class="cls_039"> to publish the results to its </span><span class="cls_059">Subscribers</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:118.11px;top:203.66px" class="cls_039"><span class="cls_039">As you can see, the Reactive Streams specification is rather straightforward. It’s</span></div>
<div style="position:absolute;left:102.18px;top:216.65px" class="cls_039"><span class="cls_039">fairly easy to see how you could build up a data-processing pipeline that starts with a</span></div>
<div style="position:absolute;left:102.18px;top:229.67px" class="cls_059"><span class="cls_059">Publisher</span><span class="cls_039">, pumps data through zero or more </span><span class="cls_059">Processors</span><span class="cls_039">, and then drops the final</span></div>
<div style="position:absolute;left:102.18px;top:242.66px" class="cls_039"><span class="cls_039">results off to a </span><span class="cls_059">Subscriber</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.69px;top:255.65px" class="cls_039"><span class="cls_039">What the Reactive Streams interfaces don’t lend themselves to, however, is com-</span></div>
<div style="position:absolute;left:102.18px;top:268.67px" class="cls_039"><span class="cls_039">posing such a stream in a functional way. Project Reactor is an implementation of the</span></div>
<div style="position:absolute;left:102.18px;top:281.66px" class="cls_039"><span class="cls_039">Reactive Streams specification that provides a functional API for composing Reactive</span></div>
<div style="position:absolute;left:102.18px;top:294.68px" class="cls_039"><span class="cls_039">Streams. As you’ll see in the following chapters, Reactor is the foundation for Spring</span></div>
<div style="position:absolute;left:102.18px;top:307.67px" class="cls_039"><span class="cls_039">5’s reactive programming model. In the remainder of this chapter, we’re going to</span></div>
<div style="position:absolute;left:102.18px;top:320.66px" class="cls_039"><span class="cls_039">explore (and, dare I say, have a lot of fun with) Project Reactor.</span></div>
<div style="position:absolute;left:66.18px;top:341.83px" class="cls_040"><span class="cls_040">10.2</span></div>
<div style="position:absolute;left:102.18px;top:341.83px" class="cls_040"><span class="cls_040">Getting started with Reactor</span></div>
<div style="position:absolute;left:102.18px;top:359.66px" class="cls_039"><span class="cls_039">Reactive programming requires us to think in a very different way from imperative</span></div>
<div style="position:absolute;left:102.18px;top:372.68px" class="cls_039"><span class="cls_039">programming. Rather than describe a set of steps to be taken, reactive programming</span></div>
<div style="position:absolute;left:102.18px;top:385.67px" class="cls_039"><span class="cls_039">means building a pipeline through which data will flow. As data passes through the</span></div>
<div style="position:absolute;left:102.18px;top:398.66px" class="cls_039"><span class="cls_039">pipeline, it can be altered or used in some way.</span></div>
<div style="position:absolute;left:116.85px;top:411.68px" class="cls_039"><span class="cls_039">For example, suppose you want to take a person’s name, change all of its letters to</span></div>
<div style="position:absolute;left:102.18px;top:424.67px" class="cls_039"><span class="cls_039">uppercase, use it to create a greeting message, and then finally print it. In an impera-</span></div>
<div style="position:absolute;left:102.18px;top:437.66px" class="cls_039"><span class="cls_039">tive programming model, the code would look something like this:</span></div>
<div style="position:absolute;left:102.18px;top:457.34px" class="cls_060"><span class="cls_060">String name = "Craig";</span></div>
<div style="position:absolute;left:102.18px;top:467.36px" class="cls_060"><span class="cls_060">String capitalName = name.toUpperCase();</span></div>
<div style="position:absolute;left:102.18px;top:477.35px" class="cls_060"><span class="cls_060">String greeting = "Hello, " + capitalName + "!";</span></div>
<div style="position:absolute;left:102.18px;top:487.34px" class="cls_061"><span class="cls_061">System.out.println(greeting);</span></div>
<div style="position:absolute;left:102.18px;top:506.66px" class="cls_039"><span class="cls_039">In the imperative model, each line of code performs a step, one right after the other,</span></div>
<div style="position:absolute;left:102.18px;top:519.68px" class="cls_039"><span class="cls_039">and definitely in the same thread. Each step blocks the executing thread from moving</span></div>
<div style="position:absolute;left:102.18px;top:532.67px" class="cls_039"><span class="cls_039">to the next step until complete.</span></div>
<div style="position:absolute;left:116.77px;top:545.69px" class="cls_039"><span class="cls_039">In contrast, functional, reactive code could achieve the same thing like this:</span></div>
<div style="position:absolute;left:102.18px;top:565.34px" class="cls_060"><span class="cls_060">Mono.just("Craig")</span></div>
<div style="position:absolute;left:121.38px;top:575.36px" class="cls_060"><span class="cls_060">.map(n -&gt; n.toUpperCase())</span></div>
<div style="position:absolute;left:121.37px;top:585.35px" class="cls_060"><span class="cls_060">.map(cn -&gt; "Hello, " + cn + "!")</span></div>
<div style="position:absolute;left:121.38px;top:595.34px" class="cls_061"><span class="cls_061">.subscribe(System.out::println);</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:176432px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background268.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">246</span></div>
<div style="position:absolute;left:201.03px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 10</span></div>
<div style="position:absolute;left:249.96px;top:24.35px" class="cls_055"><span class="cls_055">Introducing Reactor</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">Don’t worry too much about the details of this example; we’ll talk all about the </span><span class="cls_059">just()</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_059"><span class="cls_059">map()</span><span class="cls_039">, and </span><span class="cls_059">subscribe()</span><span class="cls_039"> operations soon enough. For now, it’s important to under-</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">stand that although the reactive example still seems to follow a step-by-step model, it’s</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">really a pipeline that data flows through. At each phase of the pipeline, the data is</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">tweaked somehow, but no assumption can be made about which thread any of the</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">operations are performed on. They may be the same thread ... or they may not be.</span></div>
<div style="position:absolute;left:108.75px;top:128.66px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">Mono</span><span class="cls_039"> in the example is one of Reactor’s two core types. </span><span class="cls_059">Flux</span><span class="cls_039"> is the other.</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">Both are implementations of Reactive Streams’ </span><span class="cls_059">Publisher</span><span class="cls_039">. A </span><span class="cls_059">Flux</span><span class="cls_039"> represents a pipe-</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_039"><span class="cls_039">line of zero, one, or many (potentially infinite) data items. A </span><span class="cls_059">Mono</span><span class="cls_039"> is a specialized</span></div>
<div style="position:absolute;left:93.18px;top:167.66px" class="cls_039"><span class="cls_039">reactive type that’s optimized for when the dataset is known to have no more than</span></div>
<div style="position:absolute;left:93.18px;top:180.65px" class="cls_039"><span class="cls_039">one data item.</span></div>
<div style="position:absolute;left:105.18px;top:214.49px" class="cls_075"><span class="cls_075">Reactor vs. RxJava (ReactiveX)</span></div>
<div style="position:absolute;left:105.18px;top:228.35px" class="cls_076"><span class="cls_076">If you’re already familiar with RxJava or ReactiveX, you may be thinking that </span><span class="cls_059">Mono</span><span class="cls_076"> and</span></div>
<div style="position:absolute;left:105.18px;top:239.33px" class="cls_059"><span class="cls_059">Flux</span><span class="cls_076"> sound a lot like </span><span class="cls_059">Observable</span><span class="cls_076"> and </span><span class="cls_059">Single</span><span class="cls_076">. In fact, they’re approximately equiv-</span></div>
<div style="position:absolute;left:105.18px;top:250.34px" class="cls_076"><span class="cls_076">alent semantically. They even offer many of the same operations.</span></div>
<div style="position:absolute;left:105.18px;top:268.34px" class="cls_076"><span class="cls_076">Although we focus on Reactor in this book, you may be happy to know that it’s pos-</span></div>
<div style="position:absolute;left:105.18px;top:279.35px" class="cls_076"><span class="cls_076">sible to covert between Reactor and RxJava types. Moreover, as you’ll see in the fol-</span></div>
<div style="position:absolute;left:105.18px;top:290.33px" class="cls_076"><span class="cls_076">lowing chapters, Spring can also work with RxJava types.</span></div>
<div style="position:absolute;left:93.18px;top:324.68px" class="cls_039"><span class="cls_039">There are actually three </span><span class="cls_059">Mono</span><span class="cls_039">s in the previous example. The </span><span class="cls_059">just()</span><span class="cls_039"> operation creates</span></div>
<div style="position:absolute;left:93.18px;top:337.67px" class="cls_039"><span class="cls_039">the first one. When the </span><span class="cls_059">Mono</span><span class="cls_039"> emits a value, that value is given to the </span><span class="cls_059">map()</span><span class="cls_039"> operation</span></div>
<div style="position:absolute;left:93.18px;top:350.66px" class="cls_039"><span class="cls_039">to be capitalized and used to create another </span><span class="cls_059">Mono</span><span class="cls_039">. When the second </span><span class="cls_059">Mono</span><span class="cls_039"> publishes its</span></div>
<div style="position:absolute;left:93.18px;top:363.68px" class="cls_039"><span class="cls_039">data, it’s given to the second </span><span class="cls_059">map()</span><span class="cls_039"> operation to do some </span><span class="cls_059">String</span><span class="cls_039"> concatenation, the</span></div>
<div style="position:absolute;left:93.18px;top:376.67px" class="cls_039"><span class="cls_039">results of which are used to create the third </span><span class="cls_059">Mono</span><span class="cls_039">. Finally, the call to </span><span class="cls_059">subscribe()</span><span class="cls_039"> sub-</span></div>
<div style="position:absolute;left:93.18px;top:389.66px" class="cls_039"><span class="cls_039">scribes to the </span><span class="cls_059">Mono</span><span class="cls_039">, receives the data, and prints it.</span></div>
<div style="position:absolute;left:57.18px;top:411.50px" class="cls_063"><span class="cls_063">10.2.1</span></div>
<div style="position:absolute;left:93.18px;top:411.50px" class="cls_063"><span class="cls_063">Diagramming reactive flows</span></div>
<div style="position:absolute;left:93.18px;top:428.66px" class="cls_039"><span class="cls_039">Reactive flows are often illustrated with marble diagrams. Marble diagrams, in their</span></div>
<div style="position:absolute;left:93.18px;top:441.68px" class="cls_039"><span class="cls_039">simplest form, depict a timeline of data as it flows through a </span><span class="cls_059">Flux</span><span class="cls_039"> or </span><span class="cls_059">Mono</span><span class="cls_039"> at the top,</span></div>
<div style="position:absolute;left:93.18px;top:454.67px" class="cls_039"><span class="cls_039">an operation in the middle, and the timeline of the resulting </span><span class="cls_059">Flux</span><span class="cls_039"> or </span><span class="cls_059">Mono</span><span class="cls_039"> at the bot-</span></div>
<div style="position:absolute;left:93.18px;top:467.66px" class="cls_039"><span class="cls_039">tom. Figure 10.1 shows a marble diagram template for a </span><span class="cls_059">Flux</span><span class="cls_039">. As you can see, as data</span></div>
<div style="position:absolute;left:93.18px;top:480.68px" class="cls_039"><span class="cls_039">flows through the original </span><span class="cls_059">Flux</span><span class="cls_039">, it’s processed through some operation, resulting in a</span></div>
<div style="position:absolute;left:93.18px;top:493.67px" class="cls_039"><span class="cls_039">new </span><span class="cls_059">Flux</span><span class="cls_039"> through which the processed data flows.</span></div>
<div style="position:absolute;left:107.75px;top:506.66px" class="cls_039"><span class="cls_039">Figure 10.2 shows a similar marble diagram, but for a </span><span class="cls_059">Mono</span><span class="cls_039">. As you can see, the key</span></div>
<div style="position:absolute;left:93.18px;top:519.68px" class="cls_039"><span class="cls_039">difference is that a </span><span class="cls_059">Mono</span><span class="cls_039"> will have either zero or one data item, or an error.</span></div>
<div style="position:absolute;left:108.59px;top:532.67px" class="cls_039"><span class="cls_039">In section 10.3, we’ll explore many operations supported by </span><span class="cls_059">Flux</span><span class="cls_039"> and </span><span class="cls_059">Mono</span><span class="cls_039">, and</span></div>
<div style="position:absolute;left:93.18px;top:545.69px" class="cls_039"><span class="cls_039">we’ll use marble diagrams to visualize how they work.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:177108px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background269.jpg" width="531" height="666"></div>
<div style="position:absolute;left:219.57px;top:24.35px" class="cls_055"><span class="cls_055">Getting started with Reactor</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">247</span></div>
<div style="position:absolute;left:329.05px;top:52.44px" class="cls_057"><span class="cls_057">Indicates completion</span></div>
<div style="position:absolute;left:262.29px;top:56.88px" class="cls_057"><span class="cls_057">Values emitted</span></div>
<div style="position:absolute;left:343.98px;top:61.41px" class="cls_057"><span class="cls_057">of the flux</span></div>
<div style="position:absolute;left:269.32px;top:65.88px" class="cls_057"><span class="cls_057">by the flux</span></div>
<div style="position:absolute;left:139.68px;top:83.49px" class="cls_057"><span class="cls_057">The flux’s</span></div>
<div style="position:absolute;left:232.31px;top:88.13px" class="cls_057"><span class="cls_057">1</span></div>
<div style="position:absolute;left:252.69px;top:88.13px" class="cls_057"><span class="cls_057">2</span></div>
<div style="position:absolute;left:273.06px;top:88.13px" class="cls_057"><span class="cls_057">3</span></div>
<div style="position:absolute;left:293.44px;top:88.13px" class="cls_057"><span class="cls_057">4</span></div>
<div style="position:absolute;left:313.82px;top:88.13px" class="cls_057"><span class="cls_057">5</span></div>
<div style="position:absolute;left:334.20px;top:88.13px" class="cls_057"><span class="cls_057">6</span></div>
<div style="position:absolute;left:145.16px;top:92.49px" class="cls_057"><span class="cls_057">timeline</span></div>
<div style="position:absolute;left:112.15px;top:119.90px" class="cls_057"><span class="cls_057">Some operation to</span></div>
<div style="position:absolute;left:290.71px;top:122.39px" class="cls_079"><span class="cls_079">Operation</span></div>
<div style="position:absolute;left:110.95px;top:128.90px" class="cls_057"><span class="cls_057">perform on the flux</span></div>
<div style="position:absolute;left:108.73px;top:148.07px" class="cls_057"><span class="cls_057">A new flux resulting</span></div>
<div style="position:absolute;left:102.81px;top:157.07px" class="cls_057"><span class="cls_057">from operating on the</span></div>
<div style="position:absolute;left:231.64px;top:161.10px" class="cls_057"><span class="cls_057">1'</span></div>
<div style="position:absolute;left:252.02px;top:161.10px" class="cls_057"><span class="cls_057">2'</span></div>
<div style="position:absolute;left:272.40px;top:161.10px" class="cls_057"><span class="cls_057">3'</span></div>
<div style="position:absolute;left:106.95px;top:166.07px" class="cls_057"><span class="cls_057">value emitted by the</span></div>
<div style="position:absolute;left:133.77px;top:175.07px" class="cls_057"><span class="cls_057">original flux</span></div>
<div style="position:absolute;left:323.48px;top:173.38px" class="cls_057"><span class="cls_057">Indicates an error</span></div>
<div style="position:absolute;left:323.48px;top:182.39px" class="cls_057"><span class="cls_057">or abnormal termination</span></div>
<div style="position:absolute;left:219.73px;top:187.28px" class="cls_057"><span class="cls_057">Values on the new flux</span></div>
<div style="position:absolute;left:323.48px;top:191.39px" class="cls_057"><span class="cls_057">of the flux</span></div>
<div style="position:absolute;left:219.64px;top:196.28px" class="cls_057"><span class="cls_057">after the operation has</span></div>
<div style="position:absolute;left:229.94px;top:205.28px" class="cls_057"><span class="cls_057">been performed</span></div>
<div style="position:absolute;left:102.18px;top:222.35px" class="cls_053"><span class="cls_053">Figure 10.1</span></div>
<div style="position:absolute;left:151.60px;top:222.05px" class="cls_053"><span class="cls_053">Marble diagram illustrating the basic flow of a </span><span class="cls_087">Flux</span></div>
<div style="position:absolute;left:239.70px;top:262.72px" class="cls_088"><span class="cls_088">A value emitted</span></div>
<div style="position:absolute;left:312.49px;top:262.72px" class="cls_088"><span class="cls_088">Indicates completion</span></div>
<div style="position:absolute;left:244.55px;top:271.72px" class="cls_088"><span class="cls_088">by the mono</span></div>
<div style="position:absolute;left:324.13px;top:271.72px" class="cls_088"><span class="cls_088">of the mono</span></div>
<div style="position:absolute;left:133.29px;top:296.58px" class="cls_088"><span class="cls_088">The mono’s</span></div>
<div style="position:absolute;left:273.29px;top:301.21px" class="cls_088"><span class="cls_088">1</span></div>
<div style="position:absolute;left:145.39px;top:305.58px" class="cls_088"><span class="cls_088">timeline</span></div>
<div style="position:absolute;left:112.38px;top:332.99px" class="cls_088"><span class="cls_088">Some operation to</span></div>
<div style="position:absolute;left:290.96px;top:335.47px" class="cls_093"><span class="cls_093">Operation</span></div>
<div style="position:absolute;left:104.57px;top:341.99px" class="cls_088"><span class="cls_088">perform on the mono</span></div>
<div style="position:absolute;left:102.34px;top:361.15px" class="cls_088"><span class="cls_088">A new mono resulting</span></div>
<div style="position:absolute;left:103.04px;top:370.15px" class="cls_088"><span class="cls_088">from operating on the</span></div>
<div style="position:absolute;left:272.62px;top:374.19px" class="cls_088"><span class="cls_088">1'</span></div>
<div style="position:absolute;left:107.18px;top:379.15px" class="cls_088"><span class="cls_088">value emitted by the</span></div>
<div style="position:absolute;left:182.66px;top:385.87px" class="cls_088"><span class="cls_088">A value on the new mono</span></div>
<div style="position:absolute;left:349.51px;top:386.47px" class="cls_088"><span class="cls_088">Indicates an error</span></div>
<div style="position:absolute;left:127.39px;top:388.15px" class="cls_088"><span class="cls_088">original mono</span></div>
<div style="position:absolute;left:191.36px;top:394.87px" class="cls_088"><span class="cls_088">after the operation has</span></div>
<div style="position:absolute;left:349.51px;top:395.47px" class="cls_088"><span class="cls_088">or abnormal termination</span></div>
<div style="position:absolute;left:211.96px;top:403.87px" class="cls_088"><span class="cls_088">been performed</span></div>
<div style="position:absolute;left:349.51px;top:404.47px" class="cls_088"><span class="cls_088">of the mono</span></div>
<div style="position:absolute;left:102.18px;top:422.72px" class="cls_053"><span class="cls_053">Figure 10.2</span></div>
<div style="position:absolute;left:151.60px;top:422.42px" class="cls_053"><span class="cls_053">Marble diagram illustrating the basic flow of a </span><span class="cls_087">Mono</span></div>
<div style="position:absolute;left:66.18px;top:453.56px" class="cls_063"><span class="cls_063">10.2.2</span></div>
<div style="position:absolute;left:102.18px;top:453.56px" class="cls_063"><span class="cls_063">Adding Reactor dependencies</span></div>
<div style="position:absolute;left:102.18px;top:470.75px" class="cls_039"><span class="cls_039">To get started with Reactor, add the following dependency to the project build:</span></div>
<div style="position:absolute;left:102.18px;top:490.43px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:111.78px;top:500.42px" class="cls_060"><span class="cls_060">&lt;groupId&gt;io.projectreactor&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:111.78px;top:510.41px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;reactor-core&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:102.18px;top:520.43px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:102.18px;top:541.76px" class="cls_039"><span class="cls_039">Reactor also provides some great testing support. You’re going to write a lot of tests</span></div>
<div style="position:absolute;left:102.18px;top:554.75px" class="cls_039"><span class="cls_039">around your Reactor code, so you’ll definitely want to add this dependency to your build:</span></div>
<div style="position:absolute;left:102.18px;top:574.43px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:111.78px;top:584.42px" class="cls_060"><span class="cls_060">&lt;groupId&gt;io.projectreactor&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:111.78px;top:594.44px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;reactor-test&lt;/artifactId&gt;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:177784px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background270.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">248</span></div>
<div style="position:absolute;left:201.03px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 10</span></div>
<div style="position:absolute;left:249.96px;top:24.35px" class="cls_055"><span class="cls_055">Introducing Reactor</span></div>
<div style="position:absolute;left:102.78px;top:51.32px" class="cls_060"><span class="cls_060">&lt;scope&gt;test&lt;/scope&gt;</span></div>
<div style="position:absolute;left:93.18px;top:61.34px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:93.18px;top:82.67px" class="cls_039"><span class="cls_039">I’m assuming that you’re adding these dependencies to a Spring Boot project, which</span></div>
<div style="position:absolute;left:93.18px;top:95.66px" class="cls_039"><span class="cls_039">handles dependency management for you, so there’s no need to specify the </span><span class="cls_059">&lt;version&gt;</span></div>
<div style="position:absolute;left:93.18px;top:108.65px" class="cls_039"><span class="cls_039">element for the dependencies. But if you want to use Reactor in a non-Spring Boot</span></div>
<div style="position:absolute;left:93.18px;top:121.67px" class="cls_039"><span class="cls_039">project, you’ll need to set up Reactor’s BOM (bill of materials) in the build. The fol-</span></div>
<div style="position:absolute;left:93.18px;top:134.66px" class="cls_039"><span class="cls_039">lowing dependency management entry adds Reactor’s Bismuth release to the build:</span></div>
<div style="position:absolute;left:93.18px;top:154.34px" class="cls_060"><span class="cls_060">&lt;dependencyManagement&gt;</span></div>
<div style="position:absolute;left:112.38px;top:164.33px" class="cls_060"><span class="cls_060">&lt;dependencies&gt;</span></div>
<div style="position:absolute;left:131.55px;top:174.35px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:150.75px;top:184.34px" class="cls_060"><span class="cls_060">&lt;groupId&gt;io.projectreactor&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:150.75px;top:194.33px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;reactor-bom&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:150.75px;top:204.35px" class="cls_060"><span class="cls_060">&lt;version&gt;Bismuth-RELEASE&lt;/version&gt;</span></div>
<div style="position:absolute;left:150.75px;top:214.34px" class="cls_060"><span class="cls_060">&lt;type&gt;pom&lt;/type&gt;</span></div>
<div style="position:absolute;left:150.75px;top:224.33px" class="cls_060"><span class="cls_060">&lt;scope&gt;import&lt;/scope&gt;</span></div>
<div style="position:absolute;left:131.55px;top:234.35px" class="cls_060"><span class="cls_060">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:112.38px;top:244.34px" class="cls_060"><span class="cls_060">&lt;/dependencies&gt;</span></div>
<div style="position:absolute;left:93.18px;top:254.33px" class="cls_061"><span class="cls_061">&lt;/dependencyManagement&gt;</span></div>
<div style="position:absolute;left:93.18px;top:275.66px" class="cls_039"><span class="cls_039">Now that Reactor is in your project build, you can start creating reactive pipelines with</span></div>
<div style="position:absolute;left:93.18px;top:288.65px" class="cls_059"><span class="cls_059">Mono</span><span class="cls_039"> and </span><span class="cls_059">Flux</span><span class="cls_039">. For the remainder of this chapter, we’ll walk through several opera-</span></div>
<div style="position:absolute;left:93.18px;top:301.67px" class="cls_039"><span class="cls_039">tions offered by </span><span class="cls_059">Mono</span><span class="cls_039"> and </span><span class="cls_059">Flux</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:57.18px;top:322.84px" class="cls_040"><span class="cls_040">10.3</span></div>
<div style="position:absolute;left:93.18px;top:322.84px" class="cls_040"><span class="cls_040">Applying common reactive operations</span></div>
<div style="position:absolute;left:93.18px;top:340.67px" class="cls_059"><span class="cls_059">Flux</span><span class="cls_039"> and </span><span class="cls_059">Mono</span><span class="cls_039"> are the most essential building blocks provided by Reactor, and the</span></div>
<div style="position:absolute;left:93.18px;top:353.66px" class="cls_039"><span class="cls_039">operations those two reactive types offer are the mortar that binds them together to</span></div>
<div style="position:absolute;left:93.18px;top:366.68px" class="cls_039"><span class="cls_039">create pipelines through which data can flow. Between </span><span class="cls_059">Flux</span><span class="cls_039"> and </span><span class="cls_059">Mono</span><span class="cls_039">, there are over</span></div>
<div style="position:absolute;left:93.18px;top:379.67px" class="cls_039"><span class="cls_039">500 operations, each of which can be loosely categorized as</span></div>
<div style="position:absolute;left:108.78px;top:396.68px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Creation operations</span></div>
<div style="position:absolute;left:108.78px;top:410.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Combination operations</span></div>
<div style="position:absolute;left:108.78px;top:424.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Transformation operations</span></div>
<div style="position:absolute;left:108.78px;top:438.68px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Logic operations</span></div>
<div style="position:absolute;left:93.18px;top:456.68px" class="cls_039"><span class="cls_039">As much fun as it would be to poke at each of the 500 operations to see how they tick,</span></div>
<div style="position:absolute;left:93.18px;top:469.67px" class="cls_039"><span class="cls_039">there’s simply not enough room in this chapter. I’ve selected a few of the most useful</span></div>
<div style="position:absolute;left:93.18px;top:482.66px" class="cls_039"><span class="cls_039">operations to experiment with in this section. We’ll start with creation operations.</span></div>
<div style="position:absolute;left:105.18px;top:503.66px" class="cls_083"><span class="cls_083">NOTE</span><span class="cls_039">  Where are the Mono examples?</span><span class="cls_083"> </span><span class="cls_059">Mono</span><span class="cls_039"> and </span><span class="cls_059">Flux</span><span class="cls_039"> share many of the same</span></div>
<div style="position:absolute;left:105.18px;top:515.66px" class="cls_039"><span class="cls_039">operations, so it’s mostly unnecessary to show the same operation twice, once</span></div>
<div style="position:absolute;left:105.18px;top:527.66px" class="cls_039"><span class="cls_039">for </span><span class="cls_059">Mono</span><span class="cls_039"> and again for </span><span class="cls_059">Flux</span><span class="cls_039">. Moreover, although the </span><span class="cls_059">Mono</span><span class="cls_039"> operations are use-</span></div>
<div style="position:absolute;left:105.18px;top:539.66px" class="cls_039"><span class="cls_039">ful, they’re slightly less interesting to look at than the same operations when</span></div>
<div style="position:absolute;left:105.18px;top:551.69px" class="cls_039"><span class="cls_039">given a </span><span class="cls_059">Flux</span><span class="cls_039">. Most of the examples we’ll work with will involve </span><span class="cls_059">Flux</span><span class="cls_039">. Just know</span></div>
<div style="position:absolute;left:105.18px;top:563.69px" class="cls_039"><span class="cls_039">that </span><span class="cls_059">Mono</span><span class="cls_039"> often has equivalent operations.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:178460px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background271.jpg" width="531" height="666"></div>
<div style="position:absolute;left:203.31px;top:24.35px" class="cls_055"><span class="cls_055">Applying common reactive operations</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">249</span></div>
<div style="position:absolute;left:66.18px;top:50.48px" class="cls_063"><span class="cls_063">10.3.1</span></div>
<div style="position:absolute;left:102.18px;top:50.48px" class="cls_063"><span class="cls_063">Creating reactive types</span></div>
<div style="position:absolute;left:102.18px;top:67.67px" class="cls_039"><span class="cls_039">Often when working with reactive types in Spring, you’ll be given a </span><span class="cls_059">Flux</span><span class="cls_039"> or a </span><span class="cls_059">Mono</span></div>
<div style="position:absolute;left:102.18px;top:80.66px" class="cls_039"><span class="cls_039">from a repository or a service, so you won’t need to create one yourself. But occasion-</span></div>
<div style="position:absolute;left:102.18px;top:93.65px" class="cls_039"><span class="cls_039">ally you’ll need to create a new reactive publisher.</span></div>
<div style="position:absolute;left:117.04px;top:106.67px" class="cls_039"><span class="cls_039">Reactor provides several operations for creating </span><span class="cls_059">Flux</span><span class="cls_039">es and </span><span class="cls_059">Mono</span><span class="cls_039">s. In this section,</span></div>
<div style="position:absolute;left:102.18px;top:119.66px" class="cls_039"><span class="cls_039">we’ll look at a few of the most useful creation operations.</span></div>
<div style="position:absolute;left:102.18px;top:137.84px" class="cls_064"><span class="cls_064">C</span><span class="cls_065">REATING</span><span class="cls_064"> </span><span class="cls_065">FROM</span><span class="cls_064"> </span><span class="cls_065">OBJECTS</span></div>
<div style="position:absolute;left:102.18px;top:150.17px" class="cls_039"><span class="cls_039">If you have one or more objects that you’d like to create a </span><span class="cls_059">Flux</span><span class="cls_039"> or </span><span class="cls_059">Mono</span><span class="cls_039"> from, you can</span></div>
<div style="position:absolute;left:102.18px;top:163.16px" class="cls_039"><span class="cls_039">use the static </span><span class="cls_059">just()</span><span class="cls_039"> method on </span><span class="cls_059">Flux</span><span class="cls_039"> or </span><span class="cls_059">Mono</span><span class="cls_039"> to create a reactive type whose data is</span></div>
<div style="position:absolute;left:102.18px;top:176.15px" class="cls_039"><span class="cls_039">driven by those objects. For example, the following test method creates a </span><span class="cls_059">Flux</span><span class="cls_039"> from</span></div>
<div style="position:absolute;left:102.18px;top:189.17px" class="cls_039"><span class="cls_039">five </span><span class="cls_059">String</span><span class="cls_039"> objects:</span></div>
<div style="position:absolute;left:102.18px;top:211.85px" class="cls_060"><span class="cls_060">@Test</span></div>
<div style="position:absolute;left:102.18px;top:221.84px" class="cls_060"><span class="cls_060">public void createAFlux_just() {</span></div>
<div style="position:absolute;left:111.78px;top:231.83px" class="cls_060"><span class="cls_060">Flux&lt;String&gt; fruitFlux = Flux</span></div>
<div style="position:absolute;left:130.96px;top:241.85px" class="cls_060"><span class="cls_060">.just("Apple", "Orange", "Grape", "Banana", "Strawberry");</span></div>
<div style="position:absolute;left:102.18px;top:251.84px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:276.17px" class="cls_039"><span class="cls_039">At this point, the </span><span class="cls_059">Flux</span><span class="cls_039"> has been created, but it has no subscribers. Without any sub-</span></div>
<div style="position:absolute;left:102.18px;top:289.16px" class="cls_039"><span class="cls_039">scribers, data won’t flow. Thinking of the garden hose analogy, you’ve attached the</span></div>
<div style="position:absolute;left:102.18px;top:302.18px" class="cls_039"><span class="cls_039">garden hose to the spigot, and there’s water from the utility company on the other</span></div>
<div style="position:absolute;left:102.18px;top:315.17px" class="cls_039"><span class="cls_039">side—but until you turn on the spigot, water won’t flow. Subscribing to a reactive type</span></div>
<div style="position:absolute;left:102.18px;top:328.16px" class="cls_039"><span class="cls_039">is how you turn on the flow of data.</span></div>
<div style="position:absolute;left:116.78px;top:341.18px" class="cls_039"><span class="cls_039">To add a subscriber, you can call the </span><span class="cls_059">subscribe()</span><span class="cls_039"> method on the </span><span class="cls_059">Flux</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:102.18px;top:363.83px" class="cls_060"><span class="cls_060">fruitFlux.subscribe(</span></div>
<div style="position:absolute;left:111.78px;top:373.85px" class="cls_060"><span class="cls_060">f -&gt; System.out.println("Here's some fruit: " + f)</span></div>
<div style="position:absolute;left:102.18px;top:383.84px" class="cls_061"><span class="cls_061">);</span></div>
<div style="position:absolute;left:102.18px;top:408.17px" class="cls_039"><span class="cls_039">The lambda given to </span><span class="cls_059">subscribe()</span><span class="cls_039"> here is actually a </span><span class="cls_059">java.util.Consumer</span><span class="cls_039"> that’s used</span></div>
<div style="position:absolute;left:102.18px;top:421.16px" class="cls_039"><span class="cls_039">to create a Reactive Streams </span><span class="cls_059">Subscriber</span><span class="cls_039">. Upon calling </span><span class="cls_059">subscribe()</span><span class="cls_039">, the data starts</span></div>
<div style="position:absolute;left:102.18px;top:434.18px" class="cls_039"><span class="cls_039">flowing. In this example, there are no intermediate operations, so the data flows</span></div>
<div style="position:absolute;left:102.18px;top:447.17px" class="cls_039"><span class="cls_039">directly from the </span><span class="cls_059">Flux</span><span class="cls_039"> to the </span><span class="cls_059">Subscriber</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.64px;top:460.16px" class="cls_039"><span class="cls_039">Printing the entries from a </span><span class="cls_059">Flux</span><span class="cls_039"> or </span><span class="cls_059">Mono</span><span class="cls_039"> to the console is a good way to see the</span></div>
<div style="position:absolute;left:102.18px;top:473.18px" class="cls_039"><span class="cls_039">reactive type in action. But a better way to actually test a </span><span class="cls_059">Flux</span><span class="cls_039"> or a </span><span class="cls_059">Mono</span><span class="cls_039"> is to use Reac-</span></div>
<div style="position:absolute;left:102.18px;top:486.17px" class="cls_039"><span class="cls_039">tor’s </span><span class="cls_059">StepVerifier</span><span class="cls_039">. Given a </span><span class="cls_059">Flux</span><span class="cls_039"> or </span><span class="cls_059">Mono</span><span class="cls_039">, </span><span class="cls_059">StepVerifier</span><span class="cls_039"> subscribes to the reactive</span></div>
<div style="position:absolute;left:102.18px;top:499.16px" class="cls_039"><span class="cls_039">type and then applies assertions against the data as it flows through the stream, finally</span></div>
<div style="position:absolute;left:102.18px;top:512.18px" class="cls_039"><span class="cls_039">verifying that the stream completes as expected.</span></div>
<div style="position:absolute;left:117.34px;top:525.17px" class="cls_039"><span class="cls_039">For example, to verify that the prescribed data flows through the </span><span class="cls_059">fruitFlux</span><span class="cls_039">, you</span></div>
<div style="position:absolute;left:102.18px;top:538.16px" class="cls_039"><span class="cls_039">can write a test that looks like this:</span></div>
<div style="position:absolute;left:102.18px;top:557.84px" class="cls_060"><span class="cls_060">StepVerifier.create(fruitFlux)</span></div>
<div style="position:absolute;left:121.38px;top:567.86px" class="cls_060"><span class="cls_060">.expectNext("Apple")</span></div>
<div style="position:absolute;left:121.38px;top:577.85px" class="cls_060"><span class="cls_060">.expectNext("Orange")</span></div>
<div style="position:absolute;left:121.38px;top:587.84px" class="cls_060"><span class="cls_060">.expectNext("Grape")</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:179136px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background272.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">250</span></div>
<div style="position:absolute;left:201.03px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 10</span></div>
<div style="position:absolute;left:249.96px;top:24.35px" class="cls_055"><span class="cls_055">Introducing Reactor</span></div>
<div style="position:absolute;left:112.38px;top:51.32px" class="cls_060"><span class="cls_060">.expectNext("Banana")</span></div>
<div style="position:absolute;left:112.38px;top:61.34px" class="cls_060"><span class="cls_060">.expectNext("Strawberry")</span></div>
<div style="position:absolute;left:112.38px;top:71.33px" class="cls_061"><span class="cls_061">.verifyComplete();</span></div>
<div style="position:absolute;left:93.18px;top:95.66px" class="cls_039"><span class="cls_039">In this case, </span><span class="cls_059">StepVerifier</span><span class="cls_039"> subscribes to the </span><span class="cls_059">Flux</span><span class="cls_039"> and then asserts that each item</span></div>
<div style="position:absolute;left:93.18px;top:108.65px" class="cls_039"><span class="cls_039">matches the expected fruit name. Finally, it verifies that after </span><span class="cls_059">Strawberry</span><span class="cls_039"> is produced</span></div>
<div style="position:absolute;left:93.18px;top:121.67px" class="cls_039"><span class="cls_039">by the </span><span class="cls_059">Flux</span><span class="cls_039">, the </span><span class="cls_059">Flux</span><span class="cls_039"> is complete.</span></div>
<div style="position:absolute;left:109.17px;top:134.66px" class="cls_039"><span class="cls_039">For the remainder of the examples in this chapter, you’ll use </span><span class="cls_059">StepVerifier</span><span class="cls_039"> to</span></div>
<div style="position:absolute;left:93.18px;top:147.65px" class="cls_039"><span class="cls_039">write learning tests—tests that verify behavior and help you understand how some-</span></div>
<div style="position:absolute;left:93.18px;top:160.67px" class="cls_039"><span class="cls_039">thing works—to get to know some of Reactor’s most useful operations.</span></div>
<div style="position:absolute;left:93.18px;top:178.85px" class="cls_064"><span class="cls_064">C</span><span class="cls_065">REATING</span><span class="cls_064"> </span><span class="cls_065">FROM</span><span class="cls_064"> </span><span class="cls_065">COLLECTIONS</span></div>
<div style="position:absolute;left:93.18px;top:191.15px" class="cls_039"><span class="cls_039">A </span><span class="cls_059">Flux</span><span class="cls_039"> can also be created from an array, </span><span class="cls_059">Iterable</span><span class="cls_039">, or Java </span><span class="cls_059">Stream</span><span class="cls_039">. Figure 10.3 illus-</span></div>
<div style="position:absolute;left:93.18px;top:204.17px" class="cls_039"><span class="cls_039">trates how this works with a marble diagram.</span></div>
<div style="position:absolute;left:124.43px;top:240.70px" class="cls_088"><span class="cls_088">1</span></div>
<div style="position:absolute;left:134.73px;top:240.70px" class="cls_088"><span class="cls_088">,</span></div>
<div style="position:absolute;left:143.87px;top:240.70px" class="cls_088"><span class="cls_088">2</span></div>
<div style="position:absolute;left:154.23px;top:240.70px" class="cls_088"><span class="cls_088">,</span></div>
<div style="position:absolute;left:163.31px;top:240.70px" class="cls_088"><span class="cls_088">3</span></div>
<div style="position:absolute;left:173.52px;top:240.70px" class="cls_088"><span class="cls_088">,</span></div>
<div style="position:absolute;left:182.75px;top:240.70px" class="cls_088"><span class="cls_088">4</span></div>
<div style="position:absolute;left:192.80px;top:240.70px" class="cls_088"><span class="cls_088">,</span></div>
<div style="position:absolute;left:202.19px;top:240.70px" class="cls_088"><span class="cls_088">5</span></div>
<div style="position:absolute;left:212.30px;top:240.70px" class="cls_088"><span class="cls_088">,</span></div>
<div style="position:absolute;left:221.64px;top:240.70px" class="cls_088"><span class="cls_088">6</span></div>
<div style="position:absolute;left:120.63px;top:274.72px" class="cls_088"><span class="cls_088">fromArray, fromIterable, fromStream</span></div>
<div style="position:absolute;left:278.22px;top:302.78px" class="cls_053"><span class="cls_053">Figure 10.3</span></div>
<div style="position:absolute;left:327.63px;top:302.48px" class="cls_053"><span class="cls_053">A </span><span class="cls_087">Flux</span><span class="cls_053"> can be created from</span></div>
<div style="position:absolute;left:124.43px;top:308.70px" class="cls_088"><span class="cls_088">1</span></div>
<div style="position:absolute;left:143.87px;top:308.70px" class="cls_088"><span class="cls_088">2</span></div>
<div style="position:absolute;left:163.31px;top:308.70px" class="cls_088"><span class="cls_088">3</span></div>
<div style="position:absolute;left:182.75px;top:308.70px" class="cls_088"><span class="cls_088">4</span></div>
<div style="position:absolute;left:202.19px;top:308.70px" class="cls_088"><span class="cls_088">5</span></div>
<div style="position:absolute;left:221.64px;top:308.70px" class="cls_088"><span class="cls_088">6</span></div>
<div style="position:absolute;left:278.22px;top:312.47px" class="cls_053"><span class="cls_053">an array, </span><span class="cls_087">Iterable</span><span class="cls_053">, or </span><span class="cls_087">Stream</span><span class="cls_053">.</span></div>
<div style="position:absolute;left:93.18px;top:348.86px" class="cls_039"><span class="cls_039">To create a </span><span class="cls_059">Flux</span><span class="cls_039"> from an array, call the static </span><span class="cls_059">fromArray()</span><span class="cls_039"> method, passing in the</span></div>
<div style="position:absolute;left:93.18px;top:361.85px" class="cls_039"><span class="cls_039">source array:</span></div>
<div style="position:absolute;left:93.18px;top:384.53px" class="cls_060"><span class="cls_060">@Test</span></div>
<div style="position:absolute;left:93.18px;top:394.52px" class="cls_060"><span class="cls_060">public void createAFlux_fromArray() {</span></div>
<div style="position:absolute;left:102.78px;top:404.51px" class="cls_060"><span class="cls_060">String[] fruits = new String[] {</span></div>
<div style="position:absolute;left:121.96px;top:414.53px" class="cls_060"><span class="cls_060">"Apple", "Orange", "Grape", "Banana", "Strawberry" };</span></div>
<div style="position:absolute;left:102.78px;top:434.54px" class="cls_060"><span class="cls_060">Flux&lt;String&gt; fruitFlux = Flux.fromArray(fruits);</span></div>
<div style="position:absolute;left:102.78px;top:454.52px" class="cls_060"><span class="cls_060">StepVerifier.create(fruitFlux)</span></div>
<div style="position:absolute;left:121.95px;top:464.54px" class="cls_060"><span class="cls_060">.expectNext("Apple")</span></div>
<div style="position:absolute;left:121.95px;top:474.53px" class="cls_060"><span class="cls_060">.expectNext("Orange")</span></div>
<div style="position:absolute;left:121.95px;top:484.52px" class="cls_060"><span class="cls_060">.expectNext("Grape")</span></div>
<div style="position:absolute;left:121.95px;top:494.54px" class="cls_060"><span class="cls_060">.expectNext("Banana")</span></div>
<div style="position:absolute;left:121.95px;top:504.53px" class="cls_060"><span class="cls_060">.expectNext("Strawberry")</span></div>
<div style="position:absolute;left:121.95px;top:514.52px" class="cls_060"><span class="cls_060">.verifyComplete();</span></div>
<div style="position:absolute;left:93.18px;top:524.54px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:548.84px" class="cls_039"><span class="cls_039">Because the source array contains the same fruit names you used when creating a</span></div>
<div style="position:absolute;left:93.18px;top:561.86px" class="cls_059"><span class="cls_059">Flux</span><span class="cls_039"> from a list of objects, the data emitted by the </span><span class="cls_059">Flux</span><span class="cls_039"> will have the same values.</span></div>
<div style="position:absolute;left:93.18px;top:574.85px" class="cls_039"><span class="cls_039">Thus, you can use the same </span><span class="cls_059">StepVerifier</span><span class="cls_039"> as before to verify this </span><span class="cls_059">Flux</span><span class="cls_039">.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:179812px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background273.jpg" width="531" height="666"></div>
<div style="position:absolute;left:203.31px;top:24.35px" class="cls_055"><span class="cls_055">Applying common reactive operations</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">251</span></div>
<div style="position:absolute;left:117.30px;top:50.66px" class="cls_039"><span class="cls_039">If you need to create a </span><span class="cls_059">Flux</span><span class="cls_039"> from a </span><span class="cls_059">java.util.List</span><span class="cls_039">, </span><span class="cls_059">java.util.Set</span><span class="cls_039">, or any other</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">implementation of </span><span class="cls_059">java.lang.Iterable</span><span class="cls_039">, you can pass it into the static </span><span class="cls_059">fromIterable()</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">method:</span></div>
<div style="position:absolute;left:102.18px;top:96.32px" class="cls_060"><span class="cls_060">@Test</span></div>
<div style="position:absolute;left:102.18px;top:106.34px" class="cls_060"><span class="cls_060">public void createAFlux_fromIterable() {</span></div>
<div style="position:absolute;left:111.78px;top:116.33px" class="cls_060"><span class="cls_060">List&lt;String&gt; fruitList = new ArrayList&lt;&gt;();</span></div>
<div style="position:absolute;left:111.78px;top:126.35px" class="cls_060"><span class="cls_060">fruitList.add("Apple");</span></div>
<div style="position:absolute;left:111.78px;top:136.34px" class="cls_060"><span class="cls_060">fruitList.add("Orange");</span></div>
<div style="position:absolute;left:111.78px;top:146.33px" class="cls_060"><span class="cls_060">fruitList.add("Grape");</span></div>
<div style="position:absolute;left:111.78px;top:156.35px" class="cls_060"><span class="cls_060">fruitList.add("Banana");</span></div>
<div style="position:absolute;left:111.78px;top:166.34px" class="cls_060"><span class="cls_060">fruitList.add("Strawberry");</span></div>
<div style="position:absolute;left:111.78px;top:183.35px" class="cls_060"><span class="cls_060">Flux&lt;String&gt; fruitFlux = Flux.fromIterable(fruitList);</span></div>
<div style="position:absolute;left:111.77px;top:200.33px" class="cls_060"><span class="cls_060">// ... verify steps</span></div>
<div style="position:absolute;left:102.18px;top:210.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:231.65px" class="cls_039"><span class="cls_039">Or, if you happen to have a Java </span><span class="cls_059">Stream</span><span class="cls_039"> that you’d like to use as the source for a </span><span class="cls_059">Flux</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:102.18px;top:244.67px" class="cls_059"><span class="cls_059">fromStream()</span><span class="cls_039"> is the method you’ll use:</span></div>
<div style="position:absolute;left:102.18px;top:264.35px" class="cls_060"><span class="cls_060">@Test</span></div>
<div style="position:absolute;left:102.18px;top:274.34px" class="cls_060"><span class="cls_060">public void createAFlux_fromStream() {</span></div>
<div style="position:absolute;left:111.78px;top:284.33px" class="cls_060"><span class="cls_060">Stream&lt;String&gt; fruitStream =</span></div>
<div style="position:absolute;left:135.75px;top:294.35px" class="cls_060"><span class="cls_060">Stream.of("Apple", "Orange", "Grape", "Banana", "Strawberry");</span></div>
<div style="position:absolute;left:111.78px;top:311.33px" class="cls_060"><span class="cls_060">Flux&lt;String&gt; fruitFlux = Flux.fromStream(fruitStream);</span></div>
<div style="position:absolute;left:111.77px;top:328.34px" class="cls_060"><span class="cls_060">// ... verify steps</span></div>
<div style="position:absolute;left:102.18px;top:338.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:359.66px" class="cls_039"><span class="cls_039">Again, the same </span><span class="cls_059">StepVerifier</span><span class="cls_039"> as before can be used to verify the data published by</span></div>
<div style="position:absolute;left:102.18px;top:372.68px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">Flux</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:102.18px;top:390.86px" class="cls_064"><span class="cls_064">G</span><span class="cls_065">ENERATING</span><span class="cls_064"> F</span><span class="cls_065">LUX</span><span class="cls_064"> </span><span class="cls_065">DATA</span></div>
<div style="position:absolute;left:102.18px;top:403.16px" class="cls_039"><span class="cls_039">Sometimes you don’t have any data to work with and just need </span><span class="cls_059">Flux</span><span class="cls_039"> to act as a counter,</span></div>
<div style="position:absolute;left:102.18px;top:416.18px" class="cls_039"><span class="cls_039">emitting a number that increments with each new value. To create a counter </span><span class="cls_059">Flux</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:102.18px;top:429.17px" class="cls_039"><span class="cls_039">you can use the static </span><span class="cls_059">range()</span><span class="cls_039"> method. The diagram in figure 10.4 illustrates how</span></div>
<div style="position:absolute;left:102.18px;top:442.16px" class="cls_059"><span class="cls_059">range()</span><span class="cls_039"> works.</span></div>
<div style="position:absolute;left:167.14px;top:475.87px" class="cls_057"><span class="cls_057">range(n, m)</span></div>
<div style="position:absolute;left:209.45px;top:505.30px" class="cls_094"><span class="cls_094">…</span></div>
<div style="position:absolute;left:287.85px;top:503.63px" class="cls_053"><span class="cls_053">Figure 10.4</span></div>
<div style="position:absolute;left:336.71px;top:503.33px" class="cls_053"><span class="cls_053">Creating a </span><span class="cls_087">Flux</span><span class="cls_053"> from a range results</span></div>
<div style="position:absolute;left:133.43px;top:509.85px" class="cls_057"><span class="cls_057">n   n+1</span></div>
<div style="position:absolute;left:170.08px;top:510.30px" class="cls_057"><span class="cls_057">n+1</span></div>
<div style="position:absolute;left:191.58px;top:510.30px" class="cls_057"><span class="cls_057">n+1</span></div>
<div style="position:absolute;left:221.95px;top:510.30px" class="cls_057"><span class="cls_057">n+m-1</span></div>
<div style="position:absolute;left:287.85px;top:513.65px" class="cls_053"><span class="cls_053">in a counter-style publishing of messages.</span></div>
<div style="position:absolute;left:102.18px;top:543.47px" class="cls_039"><span class="cls_039">The following test method demonstrates how to create a range </span><span class="cls_059">Flux</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:102.18px;top:563.15px" class="cls_060"><span class="cls_060">@Test</span></div>
<div style="position:absolute;left:102.18px;top:573.14px" class="cls_060"><span class="cls_060">public void createAFlux_range() {</span></div>
<div style="position:absolute;left:111.78px;top:583.13px" class="cls_060"><span class="cls_060">Flux&lt;Integer&gt; intervalFlux =</span></div>
<div style="position:absolute;left:130.95px;top:593.15px" class="cls_060"><span class="cls_060">Flux.range(1, 5);</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:180488px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background274.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">252</span></div>
<div style="position:absolute;left:201.03px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 10</span></div>
<div style="position:absolute;left:249.96px;top:24.35px" class="cls_055"><span class="cls_055">Introducing Reactor</span></div>
<div style="position:absolute;left:102.78px;top:51.32px" class="cls_060"><span class="cls_060">StepVerifier.create(intervalFlux)</span></div>
<div style="position:absolute;left:121.95px;top:61.34px" class="cls_060"><span class="cls_060">.expectNext(1)</span></div>
<div style="position:absolute;left:121.95px;top:71.33px" class="cls_060"><span class="cls_060">.expectNext(2)</span></div>
<div style="position:absolute;left:121.95px;top:81.32px" class="cls_060"><span class="cls_060">.expectNext(3)</span></div>
<div style="position:absolute;left:121.95px;top:91.34px" class="cls_060"><span class="cls_060">.expectNext(4)</span></div>
<div style="position:absolute;left:121.95px;top:101.33px" class="cls_060"><span class="cls_060">.expectNext(5)</span></div>
<div style="position:absolute;left:121.95px;top:111.32px" class="cls_060"><span class="cls_060">.verifyComplete();</span></div>
<div style="position:absolute;left:93.18px;top:121.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:142.67px" class="cls_039"><span class="cls_039">In this example, the range </span><span class="cls_059">Flux</span><span class="cls_039"> is created with a starting value of </span><span class="cls_059">1</span><span class="cls_039"> and an ending</span></div>
<div style="position:absolute;left:93.18px;top:155.66px" class="cls_039"><span class="cls_039">value of </span><span class="cls_059">5</span><span class="cls_039">. The </span><span class="cls_059">StepVerifier</span><span class="cls_039"> proves that it will publish five items, which are the inte-</span></div>
<div style="position:absolute;left:93.18px;top:168.65px" class="cls_039"><span class="cls_039">gers 1 through 5.</span></div>
<div style="position:absolute;left:108.75px;top:181.67px" class="cls_039"><span class="cls_039">Another </span><span class="cls_059">Flux</span><span class="cls_039">-creation method that’s similar to </span><span class="cls_059">range()</span><span class="cls_039"> is </span><span class="cls_059">interval()</span><span class="cls_039">. Like the</span></div>
<div style="position:absolute;left:93.18px;top:194.66px" class="cls_059"><span class="cls_059">range()</span><span class="cls_039"> method, </span><span class="cls_059">interval()</span><span class="cls_039"> creates a </span><span class="cls_059">Flux</span><span class="cls_039"> that emits an incrementing value. But</span></div>
<div style="position:absolute;left:93.18px;top:207.65px" class="cls_039"><span class="cls_039">what makes </span><span class="cls_059">interval()</span><span class="cls_039"> special is that instead of you giving it a starting and ending</span></div>
<div style="position:absolute;left:93.18px;top:220.67px" class="cls_039"><span class="cls_039">value, you specify a duration or how often a value should be emitted. Figure 10.5 shows</span></div>
<div style="position:absolute;left:93.18px;top:233.66px" class="cls_039"><span class="cls_039">a marble diagram for the </span><span class="cls_059">interval()</span><span class="cls_039"> creation method.</span></div>
<div style="position:absolute;left:153.80px;top:260.28px" class="cls_057"><span class="cls_057">interval(</span></div>
<div style="position:absolute;left:196.21px;top:260.28px" class="cls_057"><span class="cls_057">)</span></div>
<div style="position:absolute;left:278.22px;top:292.97px" class="cls_053"><span class="cls_053">Figure 10.5</span></div>
<div style="position:absolute;left:327.42px;top:292.67px" class="cls_053"><span class="cls_053">A </span><span class="cls_087">Flux</span><span class="cls_053"> created from an interval</span></div>
<div style="position:absolute;left:124.43px;top:300.50px" class="cls_057"><span class="cls_057">0</span></div>
<div style="position:absolute;left:143.87px;top:300.50px" class="cls_057"><span class="cls_057">1</span></div>
<div style="position:absolute;left:163.31px;top:300.50px" class="cls_057"><span class="cls_057">2</span></div>
<div style="position:absolute;left:182.75px;top:300.50px" class="cls_057"><span class="cls_057">3</span></div>
<div style="position:absolute;left:202.19px;top:300.50px" class="cls_057"><span class="cls_057">4</span></div>
<div style="position:absolute;left:221.64px;top:300.50px" class="cls_057"><span class="cls_057">5</span></div>
<div style="position:absolute;left:278.22px;top:302.99px" class="cls_053"><span class="cls_053">has a periodic entry published to it.</span></div>
<div style="position:absolute;left:93.18px;top:336.56px" class="cls_039"><span class="cls_039">For example, to create an interval </span><span class="cls_059">Flux</span><span class="cls_039"> that emits a value every second, you can use</span></div>
<div style="position:absolute;left:93.18px;top:349.55px" class="cls_039"><span class="cls_039">the static </span><span class="cls_059">interval()</span><span class="cls_039"> method as follows:</span></div>
<div style="position:absolute;left:93.18px;top:369.23px" class="cls_060"><span class="cls_060">@Test</span></div>
<div style="position:absolute;left:93.18px;top:379.25px" class="cls_060"><span class="cls_060">public void createAFlux_interval() {</span></div>
<div style="position:absolute;left:102.78px;top:389.24px" class="cls_060"><span class="cls_060">Flux&lt;Long&gt; intervalFlux =</span></div>
<div style="position:absolute;left:121.95px;top:399.23px" class="cls_060"><span class="cls_060">Flux.interval(Duration.ofSeconds(1))</span></div>
<div style="position:absolute;left:141.15px;top:409.25px" class="cls_060"><span class="cls_060">.take(5);</span></div>
<div style="position:absolute;left:102.78px;top:429.23px" class="cls_060"><span class="cls_060">StepVerifier.create(intervalFlux)</span></div>
<div style="position:absolute;left:121.95px;top:439.25px" class="cls_060"><span class="cls_060">.expectNext(0L)</span></div>
<div style="position:absolute;left:121.95px;top:449.24px" class="cls_060"><span class="cls_060">.expectNext(1L)</span></div>
<div style="position:absolute;left:121.95px;top:459.23px" class="cls_060"><span class="cls_060">.expectNext(2L)</span></div>
<div style="position:absolute;left:121.95px;top:469.25px" class="cls_060"><span class="cls_060">.expectNext(3L)</span></div>
<div style="position:absolute;left:121.95px;top:479.24px" class="cls_060"><span class="cls_060">.expectNext(4L)</span></div>
<div style="position:absolute;left:121.95px;top:489.23px" class="cls_060"><span class="cls_060">.verifyComplete();</span></div>
<div style="position:absolute;left:93.18px;top:499.25px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:520.58px" class="cls_039"><span class="cls_039">Notice that the value emitted by an interval </span><span class="cls_059">Flux</span><span class="cls_039"> starts with 0 and increments on each</span></div>
<div style="position:absolute;left:93.18px;top:533.57px" class="cls_039"><span class="cls_039">successive item. Also, because </span><span class="cls_059">interval()</span><span class="cls_039"> isn’t given a maximum value, it will poten-</span></div>
<div style="position:absolute;left:93.18px;top:546.56px" class="cls_039"><span class="cls_039">tially run forever. Therefore, you also use the </span><span class="cls_059">take()</span><span class="cls_039"> operation to limit the results to</span></div>
<div style="position:absolute;left:93.18px;top:559.58px" class="cls_039"><span class="cls_039">the first five entries. We’ll talk more about the </span><span class="cls_059">take()</span><span class="cls_039"> operation in the next section.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:181164px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background275.jpg" width="531" height="666"></div>
<div style="position:absolute;left:203.31px;top:24.35px" class="cls_055"><span class="cls_055">Applying common reactive operations</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">253</span></div>
<div style="position:absolute;left:66.18px;top:50.48px" class="cls_063"><span class="cls_063">10.3.2</span></div>
<div style="position:absolute;left:102.18px;top:50.48px" class="cls_063"><span class="cls_063">Combining reactive types</span></div>
<div style="position:absolute;left:102.18px;top:67.67px" class="cls_039"><span class="cls_039">You may find yourself with two reactive types that you need to somehow merge together.</span></div>
<div style="position:absolute;left:102.18px;top:80.66px" class="cls_039"><span class="cls_039">Or, in other cases, you may need to split a </span><span class="cls_059">Flux</span><span class="cls_039"> into more than one reactive type. In this</span></div>
<div style="position:absolute;left:102.18px;top:93.65px" class="cls_039"><span class="cls_039">section, we’ll examine operations that combine and split Reactor’s </span><span class="cls_059">Flux</span><span class="cls_039"> and </span><span class="cls_059">Mono</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:102.18px;top:111.83px" class="cls_064"><span class="cls_064">M</span><span class="cls_065">ERGING</span><span class="cls_064"> </span><span class="cls_065">REACTIVE</span><span class="cls_064"> </span><span class="cls_065">TYPES</span></div>
<div style="position:absolute;left:102.18px;top:124.16px" class="cls_039"><span class="cls_039">Suppose you have two </span><span class="cls_059">Flux</span><span class="cls_039"> streams and need to create a single resulting </span><span class="cls_059">Flux</span><span class="cls_039"> that will</span></div>
<div style="position:absolute;left:102.18px;top:137.15px" class="cls_039"><span class="cls_039">produce data as it becomes available from either of the upstream </span><span class="cls_059">Flux</span><span class="cls_039"> streams. To</span></div>
<div style="position:absolute;left:102.18px;top:150.17px" class="cls_039"><span class="cls_039">merge one </span><span class="cls_059">Flux</span><span class="cls_039"> with another, you can use the </span><span class="cls_059">mergeWith()</span><span class="cls_039"> operation, as illustrated</span></div>
<div style="position:absolute;left:102.18px;top:163.16px" class="cls_039"><span class="cls_039">with the marble diagram in figure 10.6.</span></div>
<div style="position:absolute;left:133.43px;top:193.00px" class="cls_088"><span class="cls_088">1</span></div>
<div style="position:absolute;left:172.31px;top:193.00px" class="cls_088"><span class="cls_088">3</span></div>
<div style="position:absolute;left:211.19px;top:193.00px" class="cls_088"><span class="cls_088">5</span></div>
<div style="position:absolute;left:152.87px;top:216.15px" class="cls_088"><span class="cls_088">2</span></div>
<div style="position:absolute;left:191.75px;top:216.15px" class="cls_088"><span class="cls_088">4</span></div>
<div style="position:absolute;left:175.27px;top:250.22px" class="cls_088"><span class="cls_088">merge</span></div>
<div style="position:absolute;left:285.72px;top:267.53px" class="cls_053"><span class="cls_053">Figure 10.6</span></div>
<div style="position:absolute;left:335.12px;top:267.23px" class="cls_053"><span class="cls_053">Merging two </span><span class="cls_087">Flux</span></div>
<div style="position:absolute;left:285.72px;top:277.52px" class="cls_053"><span class="cls_053">streams interleaves their messages</span></div>
<div style="position:absolute;left:133.43px;top:284.56px" class="cls_088"><span class="cls_088">1</span></div>
<div style="position:absolute;left:152.87px;top:284.56px" class="cls_088"><span class="cls_088">2</span></div>
<div style="position:absolute;left:172.31px;top:284.56px" class="cls_088"><span class="cls_088">3</span></div>
<div style="position:absolute;left:191.75px;top:284.56px" class="cls_088"><span class="cls_088">4</span></div>
<div style="position:absolute;left:211.19px;top:284.56px" class="cls_088"><span class="cls_088">5</span></div>
<div style="position:absolute;left:285.72px;top:287.21px" class="cls_053"><span class="cls_053">into a new </span><span class="cls_087">Flux</span><span class="cls_053">.</span></div>
<div style="position:absolute;left:102.18px;top:322.31px" class="cls_039"><span class="cls_039">For example, suppose you have a </span><span class="cls_059">Flux</span><span class="cls_039"> whose values are the names of TV and movie</span></div>
<div style="position:absolute;left:102.18px;top:335.30px" class="cls_039"><span class="cls_039">characters, and you have a second </span><span class="cls_059">Flux</span><span class="cls_039"> whose values are the names of foods that</span></div>
<div style="position:absolute;left:102.18px;top:348.32px" class="cls_039"><span class="cls_039">those characters enjoy eating. The following test method shows how you could merge</span></div>
<div style="position:absolute;left:102.18px;top:361.31px" class="cls_039"><span class="cls_039">the two </span><span class="cls_059">Flux</span><span class="cls_039"> objects with the </span><span class="cls_059">mergeWith()</span><span class="cls_039"> method:</span></div>
<div style="position:absolute;left:102.18px;top:380.99px" class="cls_060"><span class="cls_060">@Test</span></div>
<div style="position:absolute;left:102.18px;top:390.98px" class="cls_060"><span class="cls_060">public void mergeFluxes() {</span></div>
<div style="position:absolute;left:111.78px;top:410.99px" class="cls_060"><span class="cls_060">Flux&lt;String&gt; characterFlux = Flux</span></div>
<div style="position:absolute;left:130.96px;top:420.98px" class="cls_060"><span class="cls_060">.just("Garfield", "Kojak", "Barbossa")</span></div>
<div style="position:absolute;left:130.95px;top:431.00px" class="cls_060"><span class="cls_060">.delayElements(Duration.ofMillis(500));</span></div>
<div style="position:absolute;left:111.78px;top:440.99px" class="cls_060"><span class="cls_060">Flux&lt;String&gt; foodFlux = Flux</span></div>
<div style="position:absolute;left:130.96px;top:450.98px" class="cls_060"><span class="cls_060">.just("Lasagna", "Lollipops", "Apples")</span></div>
<div style="position:absolute;left:130.95px;top:461.00px" class="cls_060"><span class="cls_060">.delaySubscription(Duration.ofMillis(250))</span></div>
<div style="position:absolute;left:130.95px;top:470.99px" class="cls_060"><span class="cls_060">.delayElements(Duration.ofMillis(500));</span></div>
<div style="position:absolute;left:111.78px;top:491.00px" class="cls_060"><span class="cls_060">Flux&lt;String&gt; mergedFlux = characterFlux.mergeWith(foodFlux);</span></div>
<div style="position:absolute;left:111.78px;top:510.98px" class="cls_060"><span class="cls_060">StepVerifier.create(mergedFlux)</span></div>
<div style="position:absolute;left:130.95px;top:521.00px" class="cls_060"><span class="cls_060">.expectNext("Garfield")</span></div>
<div style="position:absolute;left:130.95px;top:530.99px" class="cls_060"><span class="cls_060">.expectNext("Lasagna")</span></div>
<div style="position:absolute;left:130.95px;top:540.98px" class="cls_060"><span class="cls_060">.expectNext("Kojak")</span></div>
<div style="position:absolute;left:130.95px;top:551.00px" class="cls_060"><span class="cls_060">.expectNext("Lollipops")</span></div>
<div style="position:absolute;left:130.95px;top:560.99px" class="cls_060"><span class="cls_060">.expectNext("Barbossa")</span></div>
<div style="position:absolute;left:130.95px;top:571.01px" class="cls_060"><span class="cls_060">.expectNext("Apples")</span></div>
<div style="position:absolute;left:130.95px;top:581.00px" class="cls_060"><span class="cls_060">.verifyComplete();</span></div>
<div style="position:absolute;left:102.18px;top:590.99px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:181840px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background276.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">254</span></div>
<div style="position:absolute;left:201.03px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 10</span></div>
<div style="position:absolute;left:249.96px;top:24.35px" class="cls_055"><span class="cls_055">Introducing Reactor</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">Normally, a </span><span class="cls_059">Flux</span><span class="cls_039"> will publish data as quickly as it possibly can. Therefore, you use a</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_059"><span class="cls_059">delayElements()</span><span class="cls_039"> operation on both of the created </span><span class="cls_059">Flux</span><span class="cls_039"> streams to slow them down</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">a little—only emitting an entry every 500 ms. Furthermore, so that the food </span><span class="cls_059">Flux</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">starts streaming after the character </span><span class="cls_059">Flux</span><span class="cls_039">, you apply a </span><span class="cls_059">delaySubscription()</span><span class="cls_039"> opera-</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">tion to the food </span><span class="cls_059">Flux</span><span class="cls_039"> so that it won’t emit any data until 250 ms have passed follow-</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">ing a subscription.</span></div>
<div style="position:absolute;left:108.71px;top:128.66px" class="cls_039"><span class="cls_039">After merging the two </span><span class="cls_059">Flux</span><span class="cls_039"> objects, a new merged </span><span class="cls_059">Flux</span><span class="cls_039"> is created. When </span><span class="cls_059">Step-</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_059"><span class="cls_059">Verifier</span><span class="cls_039"> subscribes to the merged </span><span class="cls_059">Flux</span><span class="cls_039">, it will, in turn, subscribe to the two source</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_059"><span class="cls_059">Flux</span><span class="cls_039"> streams, starting the flow of data.</span></div>
<div style="position:absolute;left:108.48px;top:167.66px" class="cls_039"><span class="cls_039">The order of items emitted from the merged </span><span class="cls_059">Flux</span><span class="cls_039"> aligns with the timing of how</span></div>
<div style="position:absolute;left:93.18px;top:180.65px" class="cls_039"><span class="cls_039">they’re emitted from the sources. Because both </span><span class="cls_059">Flux</span><span class="cls_039"> objects are set to emit at regular</span></div>
<div style="position:absolute;left:93.18px;top:193.67px" class="cls_039"><span class="cls_039">rates, the values will be interleaved through the merged </span><span class="cls_059">Flux</span><span class="cls_039">, resulting in a character,</span></div>
<div style="position:absolute;left:93.18px;top:206.66px" class="cls_039"><span class="cls_039">followed by a food, followed by a character, and so forth. If the timing of either </span><span class="cls_059">Flux</span></div>
<div style="position:absolute;left:93.18px;top:219.65px" class="cls_039"><span class="cls_039">were to change, it’s possible that you might see two character items or two food items</span></div>
<div style="position:absolute;left:93.18px;top:232.67px" class="cls_039"><span class="cls_039">published one after the other.</span></div>
<div style="position:absolute;left:107.52px;top:245.66px" class="cls_039"><span class="cls_039">Because </span><span class="cls_059">mergeWith()</span><span class="cls_039"> can’t guarantee a perfect back and forth between its sources,</span></div>
<div style="position:absolute;left:93.18px;top:258.65px" class="cls_039"><span class="cls_039">you may want to consider the </span><span class="cls_059">zip()</span><span class="cls_039"> operation instead. When two </span><span class="cls_059">Flux</span><span class="cls_039"> objects are</span></div>
<div style="position:absolute;left:93.18px;top:271.67px" class="cls_039"><span class="cls_039">zipped together, it results in a new </span><span class="cls_059">Flux</span><span class="cls_039"> that produces a tuple of items, where the</span></div>
<div style="position:absolute;left:93.18px;top:284.66px" class="cls_039"><span class="cls_039">tuple contains one item from each source </span><span class="cls_059">Flux</span><span class="cls_039">. Figure 10.7 illustrates how two </span><span class="cls_059">Flux</span></div>
<div style="position:absolute;left:93.18px;top:297.68px" class="cls_039"><span class="cls_039">objects can be zipped together.</span></div>
<div style="position:absolute;left:124.43px;top:329.17px" class="cls_088"><span class="cls_088">1</span></div>
<div style="position:absolute;left:163.31px;top:329.17px" class="cls_088"><span class="cls_088">3</span></div>
<div style="position:absolute;left:143.87px;top:352.07px" class="cls_088"><span class="cls_088">2</span></div>
<div style="position:absolute;left:182.75px;top:352.07px" class="cls_088"><span class="cls_088">4</span></div>
<div style="position:absolute;left:171.72px;top:386.39px" class="cls_088"><span class="cls_088">zip</span></div>
<div style="position:absolute;left:279.84px;top:406.16px" class="cls_053"><span class="cls_053">Figure 10.7</span></div>
<div style="position:absolute;left:329.22px;top:405.86px" class="cls_053"><span class="cls_053">Zipping two </span><span class="cls_087">Flux</span><span class="cls_053"> streams</span></div>
<div style="position:absolute;left:279.84px;top:415.88px" class="cls_053"><span class="cls_053">results in a </span><span class="cls_087">Flux</span><span class="cls_053"> containing tuples of one</span></div>
<div style="position:absolute;left:124.43px;top:420.73px" class="cls_088"><span class="cls_088">1</span></div>
<div style="position:absolute;left:143.87px;top:420.49px" class="cls_088"><span class="cls_088">2</span></div>
<div style="position:absolute;left:163.31px;top:420.73px" class="cls_088"><span class="cls_088">3</span></div>
<div style="position:absolute;left:182.75px;top:420.49px" class="cls_088"><span class="cls_088">4</span></div>
<div style="position:absolute;left:279.84px;top:425.87px" class="cls_053"><span class="cls_053">element from each </span><span class="cls_087">Flux</span><span class="cls_053">.</span></div>
<div style="position:absolute;left:93.18px;top:460.55px" class="cls_039"><span class="cls_039">To see the </span><span class="cls_059">zip()</span><span class="cls_039"> operation in action, consider the following test method, which zips</span></div>
<div style="position:absolute;left:93.18px;top:473.57px" class="cls_039"><span class="cls_039">the character </span><span class="cls_059">Flux</span><span class="cls_039"> and the food </span><span class="cls_059">Flux</span><span class="cls_039"> together:</span></div>
<div style="position:absolute;left:93.18px;top:496.25px" class="cls_060"><span class="cls_060">@Test</span></div>
<div style="position:absolute;left:93.18px;top:506.24px" class="cls_060"><span class="cls_060">public void zipFluxes() {</span></div>
<div style="position:absolute;left:102.78px;top:516.23px" class="cls_060"><span class="cls_060">Flux&lt;String&gt; characterFlux = Flux</span></div>
<div style="position:absolute;left:121.96px;top:526.25px" class="cls_060"><span class="cls_060">.just("Garfield", "Kojak", "Barbossa");</span></div>
<div style="position:absolute;left:102.78px;top:536.24px" class="cls_060"><span class="cls_060">Flux&lt;String&gt; foodFlux = Flux</span></div>
<div style="position:absolute;left:121.96px;top:546.23px" class="cls_060"><span class="cls_060">.just("Lasagna", "Lollipops", "Apples");</span></div>
<div style="position:absolute;left:102.77px;top:569.24px" class="cls_060"><span class="cls_060">Flux&lt;Tuple2&lt;String, String&gt;&gt; zippedFlux =</span></div>
<div style="position:absolute;left:121.93px;top:579.26px" class="cls_060"><span class="cls_060">Flux.zip(characterFlux, foodFlux);</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:182516px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background277.jpg" width="531" height="666"></div>
<div style="position:absolute;left:203.31px;top:24.35px" class="cls_055"><span class="cls_055">Applying common reactive operations</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">255</span></div>
<div style="position:absolute;left:111.78px;top:51.32px" class="cls_060"><span class="cls_060">StepVerifier.create(zippedFlux)</span></div>
<div style="position:absolute;left:130.95px;top:61.34px" class="cls_060"><span class="cls_060">.expectNextMatches(p -&gt;</span></div>
<div style="position:absolute;left:150.15px;top:71.33px" class="cls_060"><span class="cls_060">p.getT1().equals("Garfield") &amp;&amp;</span></div>
<div style="position:absolute;left:150.15px;top:81.32px" class="cls_060"><span class="cls_060">p.getT2().equals("Lasagna"))</span></div>
<div style="position:absolute;left:130.95px;top:91.34px" class="cls_060"><span class="cls_060">.expectNextMatches(p -&gt;</span></div>
<div style="position:absolute;left:150.15px;top:101.33px" class="cls_060"><span class="cls_060">p.getT1().equals("Kojak") &amp;&amp;</span></div>
<div style="position:absolute;left:150.15px;top:111.32px" class="cls_060"><span class="cls_060">p.getT2().equals("Lollipops"))</span></div>
<div style="position:absolute;left:130.95px;top:121.34px" class="cls_060"><span class="cls_060">.expectNextMatches(p -&gt;</span></div>
<div style="position:absolute;left:150.15px;top:131.33px" class="cls_060"><span class="cls_060">p.getT1().equals("Barbossa") &amp;&amp;</span></div>
<div style="position:absolute;left:150.15px;top:141.35px" class="cls_060"><span class="cls_060">p.getT2().equals("Apples"))</span></div>
<div style="position:absolute;left:150.15px;top:151.34px" class="cls_060"><span class="cls_060">.verifyComplete();</span></div>
<div style="position:absolute;left:102.18px;top:161.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">Notice that unlike </span><span class="cls_059">mergeWith()</span><span class="cls_039">, the </span><span class="cls_059">zip()</span><span class="cls_039"> operation is a static creation operation. The</span></div>
<div style="position:absolute;left:102.18px;top:193.67px" class="cls_039"><span class="cls_039">created </span><span class="cls_059">Flux</span><span class="cls_039"> has a perfect alignment between characters and their favorite foods. Each</span></div>
<div style="position:absolute;left:102.18px;top:206.66px" class="cls_039"><span class="cls_039">item emitted from the zipped </span><span class="cls_059">Flux</span><span class="cls_039"> is a </span><span class="cls_059">Tuple2</span><span class="cls_039"> (a container object that carries two other</span></div>
<div style="position:absolute;left:102.18px;top:219.65px" class="cls_039"><span class="cls_039">objects) containing items from each source </span><span class="cls_059">Flux</span><span class="cls_039">, in the order that they’re published.</span></div>
<div style="position:absolute;left:117.91px;top:232.67px" class="cls_039"><span class="cls_039">If you’d rather not work with a </span><span class="cls_059">Tuple2</span><span class="cls_039"> and would rather work with some other</span></div>
<div style="position:absolute;left:102.18px;top:245.66px" class="cls_039"><span class="cls_039">type, you can provide a </span><span class="cls_059">Function</span><span class="cls_039"> to </span><span class="cls_059">zip()</span><span class="cls_039"> that produces any object you’d like, given</span></div>
<div style="position:absolute;left:102.18px;top:258.65px" class="cls_039"><span class="cls_039">the two items (as shown in the marble diagram in figure 10.8).</span></div>
<div style="position:absolute;left:147.84px;top:344.65px" class="cls_088"><span class="cls_088">zip( (</span></div>
<div style="position:absolute;left:176.65px;top:344.65px" class="cls_088"><span class="cls_088">,</span></div>
<div style="position:absolute;left:192.58px;top:344.65px" class="cls_088"><span class="cls_088">)</span></div>
<div style="position:absolute;left:220.21px;top:344.65px" class="cls_088"><span class="cls_088">)</span></div>
<div style="position:absolute;left:288.39px;top:362.48px" class="cls_053"><span class="cls_053">Figure 10.8</span></div>
<div style="position:absolute;left:337.79px;top:362.48px" class="cls_053"><span class="cls_053">An alternative form of the zip</span></div>
<div style="position:absolute;left:288.39px;top:372.20px" class="cls_053"><span class="cls_053">operation results in a </span><span class="cls_087">Flux</span><span class="cls_053"> of messages created</span></div>
<div style="position:absolute;left:288.39px;top:382.19px" class="cls_053"><span class="cls_053">from one element of each incoming </span><span class="cls_087">Flux</span><span class="cls_053">.</span></div>
<div style="position:absolute;left:102.18px;top:411.92px" class="cls_039"><span class="cls_039">For example, the following test method shows how to zip the character </span><span class="cls_059">Flux</span><span class="cls_039"> with the</span></div>
<div style="position:absolute;left:102.18px;top:424.91px" class="cls_039"><span class="cls_039">food </span><span class="cls_059">Flux</span><span class="cls_039"> so that it results in a </span><span class="cls_059">Flux</span><span class="cls_039"> of </span><span class="cls_059">String</span><span class="cls_039"> objects:</span></div>
<div style="position:absolute;left:102.18px;top:444.59px" class="cls_060"><span class="cls_060">@Test</span></div>
<div style="position:absolute;left:102.18px;top:454.61px" class="cls_060"><span class="cls_060">public void zipFluxesToObject() {</span></div>
<div style="position:absolute;left:111.78px;top:464.60px" class="cls_060"><span class="cls_060">Flux&lt;String&gt; characterFlux = Flux</span></div>
<div style="position:absolute;left:130.96px;top:474.59px" class="cls_060"><span class="cls_060">.just("Garfield", "Kojak", "Barbossa");</span></div>
<div style="position:absolute;left:111.78px;top:484.61px" class="cls_060"><span class="cls_060">Flux&lt;String&gt; foodFlux = Flux</span></div>
<div style="position:absolute;left:130.96px;top:494.60px" class="cls_060"><span class="cls_060">.just("Lasagna", "Lollipops", "Apples");</span></div>
<div style="position:absolute;left:111.78px;top:514.61px" class="cls_060"><span class="cls_060">Flux&lt;String&gt; zippedFlux =</span></div>
<div style="position:absolute;left:130.95px;top:524.60px" class="cls_060"><span class="cls_060">Flux.zip(characterFlux, foodFlux, (c, f) -&gt; c + " eats " + f);</span></div>
<div style="position:absolute;left:111.78px;top:544.61px" class="cls_060"><span class="cls_060">StepVerifier.create(zippedFlux)</span></div>
<div style="position:absolute;left:140.53px;top:554.60px" class="cls_060"><span class="cls_060">.expectNext("Garfield eats Lasagna")</span></div>
<div style="position:absolute;left:140.56px;top:564.59px" class="cls_060"><span class="cls_060">.expectNext("Kojak eats Lollipops")</span></div>
<div style="position:absolute;left:140.53px;top:574.61px" class="cls_060"><span class="cls_060">.expectNext("Barbossa eats Apples")</span></div>
<div style="position:absolute;left:140.55px;top:584.60px" class="cls_060"><span class="cls_060">.verifyComplete();</span></div>
<div style="position:absolute;left:102.18px;top:594.59px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:183192px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background278.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">256</span></div>
<div style="position:absolute;left:201.03px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 10</span></div>
<div style="position:absolute;left:249.96px;top:24.35px" class="cls_055"><span class="cls_055">Introducing Reactor</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">Function</span><span class="cls_039"> given to </span><span class="cls_059">zip()</span><span class="cls_039"> (given here as a lambda) simply concatenates the two</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">items into a sentence to be emitted by the zipped </span><span class="cls_059">Flux</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:93.18px;top:83.84px" class="cls_064"><span class="cls_064">S</span><span class="cls_065">ELECTING</span><span class="cls_064"> </span><span class="cls_065">THE</span><span class="cls_064"> </span><span class="cls_065">FIRST</span><span class="cls_064"> </span><span class="cls_065">REACTIVE</span><span class="cls_064"> </span><span class="cls_065">TYPE</span><span class="cls_064"> </span><span class="cls_065">TO</span><span class="cls_064"> </span><span class="cls_065">PUBLISH</span></div>
<div style="position:absolute;left:93.18px;top:97.16px" class="cls_039"><span class="cls_039">Suppose you have two </span><span class="cls_059">Flux</span><span class="cls_039"> objects, and rather than merge them together, you merely</span></div>
<div style="position:absolute;left:93.18px;top:110.15px" class="cls_039"><span class="cls_039">want to create a new </span><span class="cls_059">Flux</span><span class="cls_039"> that emits the values from the first </span><span class="cls_059">Flux</span><span class="cls_039"> that produces a</span></div>
<div style="position:absolute;left:93.18px;top:123.17px" class="cls_039"><span class="cls_039">value. As shown in figure 10.9, the </span><span class="cls_059">first()</span><span class="cls_039"> operation picks the first of two </span><span class="cls_059">Flux</span></div>
<div style="position:absolute;left:93.18px;top:136.16px" class="cls_039"><span class="cls_039">objects and echoes the values it publishes.</span></div>
<div style="position:absolute;left:124.43px;top:167.07px" class="cls_088"><span class="cls_088">1</span></div>
<div style="position:absolute;left:163.31px;top:167.07px" class="cls_088"><span class="cls_088">3</span></div>
<div style="position:absolute;left:202.19px;top:167.07px" class="cls_088"><span class="cls_088">5</span></div>
<div style="position:absolute;left:143.87px;top:189.97px" class="cls_088"><span class="cls_088">2</span></div>
<div style="position:absolute;left:182.75px;top:189.97px" class="cls_088"><span class="cls_088">4</span></div>
<div style="position:absolute;left:170.55px;top:224.29px" class="cls_088"><span class="cls_088">first</span></div>
<div style="position:absolute;left:277.68px;top:242.12px" class="cls_053"><span class="cls_053">Figure 10.9</span></div>
<div style="position:absolute;left:327.08px;top:242.12px" class="cls_053"><span class="cls_053">The first operation chooses the</span></div>
<div style="position:absolute;left:277.68px;top:251.84px" class="cls_053"><span class="cls_053">first </span><span class="cls_087">Flux</span><span class="cls_053"> to emit a message and thereafter</span></div>
<div style="position:absolute;left:124.43px;top:258.63px" class="cls_088"><span class="cls_088">1</span></div>
<div style="position:absolute;left:163.31px;top:258.63px" class="cls_088"><span class="cls_088">3</span></div>
<div style="position:absolute;left:202.19px;top:258.63px" class="cls_088"><span class="cls_088">5</span></div>
<div style="position:absolute;left:277.68px;top:261.83px" class="cls_053"><span class="cls_053">only produces messages from that </span><span class="cls_087">Flux</span><span class="cls_053">.</span></div>
<div style="position:absolute;left:93.18px;top:296.93px" class="cls_039"><span class="cls_039">The following test method creates a fast </span><span class="cls_059">Flux</span><span class="cls_039"> and a slow </span><span class="cls_059">Flux</span><span class="cls_039"> (where “slow” means</span></div>
<div style="position:absolute;left:93.18px;top:309.92px" class="cls_039"><span class="cls_039">that it will not publish an item until 100 ms after subscription). Using </span><span class="cls_059">first()</span><span class="cls_039">, it</span></div>
<div style="position:absolute;left:93.18px;top:322.91px" class="cls_039"><span class="cls_039">creates a new </span><span class="cls_059">Flux</span><span class="cls_039"> that will only publish values from the first source </span><span class="cls_059">Flux</span><span class="cls_039"> to publish</span></div>
<div style="position:absolute;left:93.18px;top:335.93px" class="cls_039"><span class="cls_039">a value:</span></div>
<div style="position:absolute;left:93.18px;top:358.58px" class="cls_060"><span class="cls_060">@Test</span></div>
<div style="position:absolute;left:93.18px;top:368.60px" class="cls_060"><span class="cls_060">public void firstFlux() {</span></div>
<div style="position:absolute;left:102.78px;top:378.59px" class="cls_060"><span class="cls_060">Flux&lt;String&gt; slowFlux = Flux.just("tortoise", "snail", "sloth")</span></div>
<div style="position:absolute;left:131.55px;top:388.61px" class="cls_060"><span class="cls_060">.delaySubscription(Duration.ofMillis(100));</span></div>
<div style="position:absolute;left:102.78px;top:398.60px" class="cls_060"><span class="cls_060">Flux&lt;String&gt; fastFlux = Flux.just("hare", "cheetah", "squirrel");</span></div>
<div style="position:absolute;left:102.78px;top:418.61px" class="cls_060"><span class="cls_060">Flux&lt;String&gt; firstFlux = Flux.first(slowFlux, fastFlux);</span></div>
<div style="position:absolute;left:102.78px;top:438.59px" class="cls_060"><span class="cls_060">StepVerifier.create(firstFlux)</span></div>
<div style="position:absolute;left:121.95px;top:448.61px" class="cls_060"><span class="cls_060">.expectNext("hare")</span></div>
<div style="position:absolute;left:121.95px;top:458.60px" class="cls_060"><span class="cls_060">.expectNext("cheetah")</span></div>
<div style="position:absolute;left:121.95px;top:468.59px" class="cls_060"><span class="cls_060">.expectNext("squirrel")</span></div>
<div style="position:absolute;left:121.95px;top:478.61px" class="cls_060"><span class="cls_060">.verifyComplete();</span></div>
<div style="position:absolute;left:93.18px;top:488.60px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:512.93px" class="cls_039"><span class="cls_039">In this case, because the slow </span><span class="cls_059">Flux</span><span class="cls_039"> won’t publish any values until 100 ms after the fast</span></div>
<div style="position:absolute;left:93.18px;top:525.92px" class="cls_059"><span class="cls_059">Flux</span><span class="cls_039"> has started publishing, the newly created </span><span class="cls_059">Flux</span><span class="cls_039"> will simply ignore the slow </span><span class="cls_059">Flux</span></div>
<div style="position:absolute;left:93.18px;top:538.91px" class="cls_039"><span class="cls_039">and only publish values from the fast </span><span class="cls_059">Flux</span><span class="cls_039">.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:183868px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background279.jpg" width="531" height="666"></div>
<div style="position:absolute;left:203.31px;top:24.35px" class="cls_055"><span class="cls_055">Applying common reactive operations</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">257</span></div>
<div style="position:absolute;left:66.18px;top:50.48px" class="cls_063"><span class="cls_063">10.3.3</span></div>
<div style="position:absolute;left:102.18px;top:50.48px" class="cls_063"><span class="cls_063">Transforming and filtering reactive streams</span></div>
<div style="position:absolute;left:102.18px;top:67.67px" class="cls_039"><span class="cls_039">As data flows through a stream, you’ll likely need to filter out some values and modify</span></div>
<div style="position:absolute;left:102.18px;top:80.66px" class="cls_039"><span class="cls_039">other values. In this section, we’ll look at operations that transform and filter the data</span></div>
<div style="position:absolute;left:102.18px;top:93.65px" class="cls_039"><span class="cls_039">flowing through a reactive stream.</span></div>
<div style="position:absolute;left:102.18px;top:111.83px" class="cls_064"><span class="cls_064">F</span><span class="cls_065">ILTERING</span><span class="cls_064"> </span><span class="cls_065">DATA</span><span class="cls_064"> </span><span class="cls_065">FROM</span><span class="cls_064"> </span><span class="cls_065">REACTIVE</span><span class="cls_064"> </span><span class="cls_065">TYPES</span></div>
<div style="position:absolute;left:102.18px;top:124.16px" class="cls_039"><span class="cls_039">One of the most basic ways of filtering data as it flows from a </span><span class="cls_059">Flux</span><span class="cls_039"> is to simply disre-</span></div>
<div style="position:absolute;left:102.18px;top:137.15px" class="cls_039"><span class="cls_039">gard the first so many entries. The </span><span class="cls_059">skip()</span><span class="cls_039"> operation, illustrated in figure 10.10, does</span></div>
<div style="position:absolute;left:102.18px;top:150.17px" class="cls_039"><span class="cls_039">exactly that.</span></div>
<div style="position:absolute;left:133.43px;top:178.10px" class="cls_057"><span class="cls_057">1</span></div>
<div style="position:absolute;left:152.87px;top:178.10px" class="cls_057"><span class="cls_057">2</span></div>
<div style="position:absolute;left:172.31px;top:178.10px" class="cls_057"><span class="cls_057">3</span></div>
<div style="position:absolute;left:191.75px;top:178.10px" class="cls_057"><span class="cls_057">4</span></div>
<div style="position:absolute;left:211.20px;top:178.10px" class="cls_057"><span class="cls_057">5</span></div>
<div style="position:absolute;left:174.69px;top:212.12px" class="cls_057"><span class="cls_057">skip(3)</span></div>
<div style="position:absolute;left:287.34px;top:230.36px" class="cls_053"><span class="cls_053">Figure 10.10</span></div>
<div style="position:absolute;left:340.91px;top:230.36px" class="cls_053"><span class="cls_053">The skip operation skips a specified</span></div>
<div style="position:absolute;left:287.34px;top:240.38px" class="cls_053"><span class="cls_053">number of messages before passing the remaining</span></div>
<div style="position:absolute;left:191.75px;top:246.10px" class="cls_057"><span class="cls_057">4</span></div>
<div style="position:absolute;left:211.20px;top:246.10px" class="cls_057"><span class="cls_057">5</span></div>
<div style="position:absolute;left:287.34px;top:250.07px" class="cls_053"><span class="cls_053">messages on to the resulting </span><span class="cls_087">Flux</span><span class="cls_053">.</span></div>
<div style="position:absolute;left:102.18px;top:278.78px" class="cls_039"><span class="cls_039">Given a </span><span class="cls_059">Flux</span><span class="cls_039"> with several entries, the </span><span class="cls_059">skip()</span><span class="cls_039"> operation will create a new </span><span class="cls_059">Flux</span><span class="cls_039"> that</span></div>
<div style="position:absolute;left:102.18px;top:291.77px" class="cls_039"><span class="cls_039">skips over a specified number of items before emitting the remaining items from the</span></div>
<div style="position:absolute;left:102.18px;top:304.76px" class="cls_039"><span class="cls_039">source </span><span class="cls_059">Flux</span><span class="cls_039">. The following test method shows how to use </span><span class="cls_059">skip()</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:102.18px;top:324.44px" class="cls_060"><span class="cls_060">@Test</span></div>
<div style="position:absolute;left:102.18px;top:334.46px" class="cls_060"><span class="cls_060">public void skipAFew() {</span></div>
<div style="position:absolute;left:111.78px;top:344.45px" class="cls_060"><span class="cls_060">Flux&lt;String&gt; skipFlux = Flux.just(</span></div>
<div style="position:absolute;left:130.94px;top:354.44px" class="cls_060"><span class="cls_060">"one", "two", "skip a few", "ninety nine", "one hundred")</span></div>
<div style="position:absolute;left:130.95px;top:364.46px" class="cls_060"><span class="cls_060">.skip(3);</span></div>
<div style="position:absolute;left:111.78px;top:380.45px" class="cls_060"><span class="cls_060">StepVerifier.create(skipFlux)</span></div>
<div style="position:absolute;left:130.96px;top:390.44px" class="cls_060"><span class="cls_060">.expectNext("ninety nine", "one hundred")</span></div>
<div style="position:absolute;left:130.95px;top:400.46px" class="cls_060"><span class="cls_060">.verifyComplete();</span></div>
<div style="position:absolute;left:102.18px;top:410.45px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:429.77px" class="cls_039"><span class="cls_039">In this case, you have a </span><span class="cls_059">Flux</span><span class="cls_039"> of five </span><span class="cls_059">String</span><span class="cls_039"> items. Calling </span><span class="cls_059">skip(3)</span><span class="cls_039"> on that </span><span class="cls_059">Flux</span><span class="cls_039"> produces</span></div>
<div style="position:absolute;left:102.18px;top:442.79px" class="cls_039"><span class="cls_039">a new </span><span class="cls_059">Flux</span><span class="cls_039"> that skips over the first three items, and only publishes the last two items.</span></div>
<div style="position:absolute;left:117.15px;top:455.78px" class="cls_039"><span class="cls_039">But maybe you don’t want to skip a specific number of items, but instead need to</span></div>
<div style="position:absolute;left:102.18px;top:468.77px" class="cls_039"><span class="cls_039">skip the first so many items until some duration has passed. An alternate form of the</span></div>
<div style="position:absolute;left:102.18px;top:481.79px" class="cls_059"><span class="cls_059">skip()</span><span class="cls_039"> operation, illustrated in figure 10.11, produces a </span><span class="cls_059">Flux</span><span class="cls_039"> that waits until some</span></div>
<div style="position:absolute;left:102.18px;top:494.78px" class="cls_039"><span class="cls_039">specified time has passed before emitting items from the source </span><span class="cls_059">Flux</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:133.43px;top:522.69px" class="cls_057"><span class="cls_057">1</span></div>
<div style="position:absolute;left:152.87px;top:522.69px" class="cls_057"><span class="cls_057">2</span></div>
<div style="position:absolute;left:172.31px;top:522.69px" class="cls_057"><span class="cls_057">3</span></div>
<div style="position:absolute;left:191.75px;top:522.69px" class="cls_057"><span class="cls_057">4</span></div>
<div style="position:absolute;left:211.19px;top:522.69px" class="cls_057"><span class="cls_057">5</span></div>
<div style="position:absolute;left:143.55px;top:551.16px" class="cls_057"><span class="cls_057">skip(</span></div>
<div style="position:absolute;left:224.50px;top:551.16px" class="cls_057"><span class="cls_057">)</span></div>
<div style="position:absolute;left:287.22px;top:574.97px" class="cls_053"><span class="cls_053">Figure 10.11</span></div>
<div style="position:absolute;left:341.41px;top:574.97px" class="cls_053"><span class="cls_053">An alternative form of the skip</span></div>
<div style="position:absolute;left:287.22px;top:584.96px" class="cls_053"><span class="cls_053">operation waits until some duration has passed</span></div>
<div style="position:absolute;left:191.75px;top:590.69px" class="cls_057"><span class="cls_057">4</span></div>
<div style="position:absolute;left:211.19px;top:590.69px" class="cls_057"><span class="cls_057">5</span></div>
<div style="position:absolute;left:287.22px;top:594.65px" class="cls_053"><span class="cls_053">before passing messages on to the resulting </span><span class="cls_087">Flux</span><span class="cls_053">.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:184544px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background280.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">258</span></div>
<div style="position:absolute;left:201.03px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 10</span></div>
<div style="position:absolute;left:249.96px;top:24.35px" class="cls_055"><span class="cls_055">Introducing Reactor</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">The test method that follows uses </span><span class="cls_059">skip()</span><span class="cls_039"> to create a </span><span class="cls_059">Flux</span><span class="cls_039"> that waits four seconds</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">before emitting any values. Because that </span><span class="cls_059">Flux</span><span class="cls_039"> was created from a </span><span class="cls_059">Flux</span><span class="cls_039"> that has a</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">one-second delay between items (using </span><span class="cls_059">delayElements()</span><span class="cls_039">), only the last two items</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">will be emitted:</span></div>
<div style="position:absolute;left:93.18px;top:112.34px" class="cls_060"><span class="cls_060">@Test</span></div>
<div style="position:absolute;left:93.18px;top:122.33px" class="cls_060"><span class="cls_060">public void skipAFewSeconds() {</span></div>
<div style="position:absolute;left:102.78px;top:132.35px" class="cls_060"><span class="cls_060">Flux&lt;String&gt; skipFlux = Flux.just(</span></div>
<div style="position:absolute;left:121.95px;top:142.34px" class="cls_060"><span class="cls_060">"one", "two", "skip a few", "ninety nine", "one hundred")</span></div>
<div style="position:absolute;left:121.95px;top:152.33px" class="cls_060"><span class="cls_060">.delayElements(Duration.ofSeconds(1))</span></div>
<div style="position:absolute;left:121.95px;top:162.35px" class="cls_060"><span class="cls_060">.skip(Duration.ofSeconds(4));</span></div>
<div style="position:absolute;left:102.78px;top:182.33px" class="cls_060"><span class="cls_060">StepVerifier.create(skipFlux)</span></div>
<div style="position:absolute;left:121.96px;top:192.35px" class="cls_060"><span class="cls_060">.expectNext("ninety nine", "one hundred")</span></div>
<div style="position:absolute;left:121.95px;top:202.34px" class="cls_060"><span class="cls_060">.verifyComplete();</span></div>
<div style="position:absolute;left:93.18px;top:212.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:236.66px" class="cls_039"><span class="cls_039">You’ve already seen an example of the </span><span class="cls_059">take()</span><span class="cls_039"> operation, but in light of the </span><span class="cls_059">skip()</span></div>
<div style="position:absolute;left:93.18px;top:249.65px" class="cls_039"><span class="cls_039">operation, </span><span class="cls_059">take()</span><span class="cls_039"> can be thought of as the opposite of </span><span class="cls_059">skip()</span><span class="cls_039">. Whereas </span><span class="cls_059">skip()</span><span class="cls_039"> skips</span></div>
<div style="position:absolute;left:93.18px;top:262.67px" class="cls_039"><span class="cls_039">the first few items, </span><span class="cls_059">take()</span><span class="cls_039"> only emits the first so many items (as illustrated by the mar-</span></div>
<div style="position:absolute;left:93.18px;top:275.66px" class="cls_039"><span class="cls_039">ble diagram in figure 10.12):</span></div>
<div style="position:absolute;left:93.18px;top:298.34px" class="cls_060"><span class="cls_060">@Test</span></div>
<div style="position:absolute;left:93.18px;top:308.33px" class="cls_060"><span class="cls_060">public void take() {</span></div>
<div style="position:absolute;left:102.78px;top:318.35px" class="cls_060"><span class="cls_060">Flux&lt;String&gt; nationalParkFlux = Flux.just(</span></div>
<div style="position:absolute;left:141.16px;top:328.34px" class="cls_060"><span class="cls_060">"Yellowstone", "Yosemite", "Grand Canyon",</span></div>
<div style="position:absolute;left:141.15px;top:338.33px" class="cls_060"><span class="cls_060">"Zion", "Grand Teton")</span></div>
<div style="position:absolute;left:121.95px;top:348.35px" class="cls_060"><span class="cls_060">.take(3);</span></div>
<div style="position:absolute;left:102.78px;top:368.33px" class="cls_060"><span class="cls_060">StepVerifier.create(nationalParkFlux)</span></div>
<div style="position:absolute;left:121.96px;top:378.35px" class="cls_060"><span class="cls_060">.expectNext("Yellowstone", "Yosemite", "Grand Canyon")</span></div>
<div style="position:absolute;left:121.95px;top:388.34px" class="cls_060"><span class="cls_060">.verifyComplete();</span></div>
<div style="position:absolute;left:93.18px;top:398.36px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:124.43px;top:434.86px" class="cls_057"><span class="cls_057">1</span></div>
<div style="position:absolute;left:143.87px;top:434.86px" class="cls_057"><span class="cls_057">2</span></div>
<div style="position:absolute;left:163.31px;top:434.86px" class="cls_057"><span class="cls_057">3</span></div>
<div style="position:absolute;left:165.37px;top:468.88px" class="cls_057"><span class="cls_057">take(3)</span></div>
<div style="position:absolute;left:278.22px;top:486.59px" class="cls_053"><span class="cls_053">Figure 10.12</span></div>
<div style="position:absolute;left:332.41px;top:486.59px" class="cls_053"><span class="cls_053">The take operation passes only</span></div>
<div style="position:absolute;left:278.22px;top:496.61px" class="cls_053"><span class="cls_053">the first so many messages from the incoming</span></div>
<div style="position:absolute;left:124.43px;top:502.86px" class="cls_057"><span class="cls_057">1</span></div>
<div style="position:absolute;left:143.87px;top:502.86px" class="cls_057"><span class="cls_057">2</span></div>
<div style="position:absolute;left:163.31px;top:502.86px" class="cls_057"><span class="cls_057">3</span></div>
<div style="position:absolute;left:278.22px;top:506.30px" class="cls_087"><span class="cls_087">Flux</span><span class="cls_053"> and then cancels the subscription.</span></div>
<div style="position:absolute;left:93.18px;top:538.49px" class="cls_039"><span class="cls_039">Like </span><span class="cls_059">skip()</span><span class="cls_039">, </span><span class="cls_059">take()</span><span class="cls_039"> also has an alternative form that’s based on a duration rather</span></div>
<div style="position:absolute;left:93.18px;top:551.51px" class="cls_039"><span class="cls_039">than an item count. It will take and emit as many items as pass through the source</span></div>
<div style="position:absolute;left:93.18px;top:564.50px" class="cls_059"><span class="cls_059">Flux</span><span class="cls_039"> until some period of time has passed, after which the </span><span class="cls_059">Flux</span><span class="cls_039"> completes. This is</span></div>
<div style="position:absolute;left:93.18px;top:577.49px" class="cls_039"><span class="cls_039">illustrated in figure 10.13.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:185220px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background281.jpg" width="531" height="666"></div>
<div style="position:absolute;left:203.31px;top:24.35px" class="cls_055"><span class="cls_055">Applying common reactive operations</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">259</span></div>
<div style="position:absolute;left:133.43px;top:57.35px" class="cls_057"><span class="cls_057">1</span></div>
<div style="position:absolute;left:152.87px;top:57.35px" class="cls_057"><span class="cls_057">2</span></div>
<div style="position:absolute;left:172.31px;top:57.35px" class="cls_057"><span class="cls_057">3</span></div>
<div style="position:absolute;left:143.23px;top:85.90px" class="cls_057"><span class="cls_057">take(</span></div>
<div style="position:absolute;left:224.82px;top:85.90px" class="cls_057"><span class="cls_057">)</span></div>
<div style="position:absolute;left:286.80px;top:109.07px" class="cls_053"><span class="cls_053">Figure 10.13</span></div>
<div style="position:absolute;left:340.94px;top:109.07px" class="cls_053"><span class="cls_053">An alternative form of the take</span></div>
<div style="position:absolute;left:286.80px;top:119.09px" class="cls_053"><span class="cls_053">operation passes messages on to the resulting</span></div>
<div style="position:absolute;left:133.43px;top:125.35px" class="cls_057"><span class="cls_057">1</span></div>
<div style="position:absolute;left:152.87px;top:125.35px" class="cls_057"><span class="cls_057">2</span></div>
<div style="position:absolute;left:172.31px;top:125.35px" class="cls_057"><span class="cls_057">3</span></div>
<div style="position:absolute;left:286.80px;top:128.78px" class="cls_087"><span class="cls_087">Flux</span><span class="cls_053"> until some duration has passed.</span></div>
<div style="position:absolute;left:102.18px;top:159.29px" class="cls_039"><span class="cls_039">The following test method uses the alternative form of </span><span class="cls_059">take()</span><span class="cls_039"> to emit as many items</span></div>
<div style="position:absolute;left:102.18px;top:172.31px" class="cls_039"><span class="cls_039">as it can in the first 3.5 seconds after subscription:</span></div>
<div style="position:absolute;left:102.18px;top:191.99px" class="cls_060"><span class="cls_060">@Test</span></div>
<div style="position:absolute;left:102.18px;top:201.98px" class="cls_060"><span class="cls_060">public void take() {</span></div>
<div style="position:absolute;left:111.78px;top:211.97px" class="cls_060"><span class="cls_060">Flux&lt;String&gt; nationalParkFlux = Flux.just(</span></div>
<div style="position:absolute;left:150.16px;top:221.99px" class="cls_060"><span class="cls_060">"Yellowstone", "Yosemite", "Grand Canyon",</span></div>
<div style="position:absolute;left:150.12px;top:231.98px" class="cls_060"><span class="cls_060">"Zion", "Grand Teton")</span></div>
<div style="position:absolute;left:130.95px;top:241.97px" class="cls_060"><span class="cls_060">.delayElements(Duration.ofSeconds(1))</span></div>
<div style="position:absolute;left:130.95px;top:251.99px" class="cls_060"><span class="cls_060">.take(Duration.ofMillis(3500));</span></div>
<div style="position:absolute;left:111.78px;top:271.97px" class="cls_060"><span class="cls_060">StepVerifier.create(nationalParkFlux)</span></div>
<div style="position:absolute;left:130.96px;top:281.99px" class="cls_060"><span class="cls_060">.expectNext("Yellowstone", "Yosemite", "Grand Canyon")</span></div>
<div style="position:absolute;left:130.95px;top:291.98px" class="cls_060"><span class="cls_060">.verifyComplete();</span></div>
<div style="position:absolute;left:102.18px;top:301.97px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:323.30px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">skip()</span><span class="cls_039"> and </span><span class="cls_059">take()</span><span class="cls_039"> operations can be thought of as filter operations where the</span></div>
<div style="position:absolute;left:102.18px;top:336.32px" class="cls_039"><span class="cls_039">filter criteria are based on a count or a duration. For more general-purpose filtering</span></div>
<div style="position:absolute;left:102.18px;top:349.31px" class="cls_039"><span class="cls_039">of </span><span class="cls_059">Flux</span><span class="cls_039"> values, you’ll find the </span><span class="cls_059">filter()</span><span class="cls_039"> operation quite useful.</span></div>
<div style="position:absolute;left:116.70px;top:362.30px" class="cls_039"><span class="cls_039">Given a </span><span class="cls_059">Predicate</span><span class="cls_039"> that decides whether an item will pass through the </span><span class="cls_059">Flux</span><span class="cls_039"> or not,</span></div>
<div style="position:absolute;left:102.18px;top:375.32px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">filter()</span><span class="cls_039"> operation lets you selectively publish based on whatever criteria you</span></div>
<div style="position:absolute;left:102.18px;top:388.31px" class="cls_039"><span class="cls_039">want. The marble diagram in figure 10.14 shows how </span><span class="cls_059">filter()</span><span class="cls_039"> works.</span></div>
<div style="position:absolute;left:133.43px;top:417.86px" class="cls_057"><span class="cls_057">1</span></div>
<div style="position:absolute;left:152.87px;top:417.83px" class="cls_057"><span class="cls_057">2</span></div>
<div style="position:absolute;left:172.31px;top:417.83px" class="cls_057"><span class="cls_057">3</span></div>
<div style="position:absolute;left:191.75px;top:417.83px" class="cls_057"><span class="cls_057">4</span></div>
<div style="position:absolute;left:211.19px;top:417.86px" class="cls_057"><span class="cls_057">5</span></div>
<div style="position:absolute;left:166.52px;top:452.09px" class="cls_057"><span class="cls_057">filter(</span></div>
<div style="position:absolute;left:201.53px;top:452.09px" class="cls_057"><span class="cls_057">)</span></div>
<div style="position:absolute;left:286.26px;top:470.12px" class="cls_053"><span class="cls_053">Figure 10.14</span></div>
<div style="position:absolute;left:339.93px;top:469.82px" class="cls_053"><span class="cls_053">An incoming </span><span class="cls_087">Flux</span><span class="cls_053"> can be filtered so</span></div>
<div style="position:absolute;left:286.26px;top:479.84px" class="cls_053"><span class="cls_053">that the resulting </span><span class="cls_087">Flux</span><span class="cls_053"> only receives messages</span></div>
<div style="position:absolute;left:133.43px;top:485.86px" class="cls_057"><span class="cls_057">1</span></div>
<div style="position:absolute;left:211.19px;top:485.86px" class="cls_057"><span class="cls_057">5</span></div>
<div style="position:absolute;left:286.26px;top:490.13px" class="cls_053"><span class="cls_053">that match a given predicate.</span></div>
<div style="position:absolute;left:102.18px;top:516.92px" class="cls_039"><span class="cls_039">To see </span><span class="cls_059">filter()</span><span class="cls_039"> in action, consider the following test method:</span></div>
<div style="position:absolute;left:102.18px;top:536.60px" class="cls_060"><span class="cls_060">@Test</span></div>
<div style="position:absolute;left:102.18px;top:546.59px" class="cls_060"><span class="cls_060">public void filter() {</span></div>
<div style="position:absolute;left:111.78px;top:556.61px" class="cls_060"><span class="cls_060">Flux&lt;String&gt; nationalParkFlux = Flux.just(</span></div>
<div style="position:absolute;left:150.16px;top:566.60px" class="cls_060"><span class="cls_060">"Yellowstone", "Yosemite", "Grand Canyon",</span></div>
<div style="position:absolute;left:150.12px;top:576.59px" class="cls_060"><span class="cls_060">"Zion", "Grand Teton")</span></div>
<div style="position:absolute;left:130.96px;top:586.61px" class="cls_060"><span class="cls_060">.filter(np -&gt; !np.contains(" "));</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:185896px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background282.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">260</span></div>
<div style="position:absolute;left:201.03px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 10</span></div>
<div style="position:absolute;left:249.96px;top:24.35px" class="cls_055"><span class="cls_055">Introducing Reactor</span></div>
<div style="position:absolute;left:102.78px;top:51.32px" class="cls_060"><span class="cls_060">StepVerifier.create(nationalParkFlux)</span></div>
<div style="position:absolute;left:121.96px;top:61.34px" class="cls_060"><span class="cls_060">.expectNext("Yellowstone", "Yosemite", "Zion")</span></div>
<div style="position:absolute;left:121.95px;top:71.33px" class="cls_060"><span class="cls_060">.verifyComplete();</span></div>
<div style="position:absolute;left:93.18px;top:81.32px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:105.65px" class="cls_039"><span class="cls_039">Here, </span><span class="cls_059">filter()</span><span class="cls_039"> is given a </span><span class="cls_059">Predicate</span><span class="cls_039"> as a lambda that only accepts </span><span class="cls_059">String</span><span class="cls_039"> values that</span></div>
<div style="position:absolute;left:93.18px;top:118.67px" class="cls_039"><span class="cls_039">don’t have any spaces. Consequently, </span><span class="cls_059">"Grand</span><span class="cls_039"> </span><span class="cls_059">Canyon"</span><span class="cls_039"> and </span><span class="cls_059">"Grand</span><span class="cls_039"> </span><span class="cls_059">Teton"</span><span class="cls_039"> are filtered</span></div>
<div style="position:absolute;left:93.18px;top:131.66px" class="cls_039"><span class="cls_039">out of the resulting </span><span class="cls_059">Flux</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:108.03px;top:144.65px" class="cls_039"><span class="cls_039">Perhaps the filtering you need is to filter out any items that you’ve already received.</span></div>
<div style="position:absolute;left:93.18px;top:157.67px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">distinct()</span><span class="cls_039"> operation, as illustrated in figure 10.15, results in a </span><span class="cls_059">Flux</span><span class="cls_039"> that only</span></div>
<div style="position:absolute;left:93.18px;top:170.66px" class="cls_039"><span class="cls_039">publishes items from the source </span><span class="cls_059">Flux</span><span class="cls_039"> that haven’t already been published.</span></div>
<div style="position:absolute;left:165.30px;top:236.37px" class="cls_057"><span class="cls_057">distinct</span></div>
<div style="position:absolute;left:278.22px;top:264.26px" class="cls_053"><span class="cls_053">Figure 10.15</span></div>
<div style="position:absolute;left:331.54px;top:264.26px" class="cls_053"><span class="cls_053">The distinct operation filters</span></div>
<div style="position:absolute;left:278.22px;top:274.28px" class="cls_053"><span class="cls_053">out any duplicate messages.</span></div>
<div style="position:absolute;left:93.18px;top:306.77px" class="cls_039"><span class="cls_039">In the following test, only unique </span><span class="cls_059">String</span><span class="cls_039"> values will be emitted from the distinct </span><span class="cls_059">Flux</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:329.45px" class="cls_060"><span class="cls_060">@Test</span></div>
<div style="position:absolute;left:93.18px;top:339.44px" class="cls_060"><span class="cls_060">public void distinct() {</span></div>
<div style="position:absolute;left:102.78px;top:349.46px" class="cls_060"><span class="cls_060">Flux&lt;String&gt; animalFlux = Flux.just(</span></div>
<div style="position:absolute;left:121.96px;top:359.45px" class="cls_060"><span class="cls_060">"dog", "cat", "bird", "dog", "bird", "anteater")</span></div>
<div style="position:absolute;left:121.95px;top:369.44px" class="cls_060"><span class="cls_060">.distinct();</span></div>
<div style="position:absolute;left:102.78px;top:392.45px" class="cls_060"><span class="cls_060">StepVerifier.create(animalFlux)</span></div>
<div style="position:absolute;left:121.96px;top:402.44px" class="cls_060"><span class="cls_060">.expectNext("dog", "cat", "bird", "anteater")</span></div>
<div style="position:absolute;left:121.95px;top:412.46px" class="cls_060"><span class="cls_060">.verifyComplete();</span></div>
<div style="position:absolute;left:93.18px;top:422.45px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:446.78px" class="cls_039"><span class="cls_039">Although </span><span class="cls_059">"dog"</span><span class="cls_039"> and </span><span class="cls_059">"bird"</span><span class="cls_039"> are each published twice from the source </span><span class="cls_059">Flux</span><span class="cls_039">, the dis-</span></div>
<div style="position:absolute;left:93.18px;top:459.77px" class="cls_039"><span class="cls_039">tinct </span><span class="cls_059">Flux</span><span class="cls_039"> only publishes them once.</span></div>
<div style="position:absolute;left:93.18px;top:479.96px" class="cls_064"><span class="cls_064">M</span><span class="cls_065">APPING</span><span class="cls_064"> </span><span class="cls_065">REACTIVE</span><span class="cls_064"> </span><span class="cls_065">DATA</span></div>
<div style="position:absolute;left:93.18px;top:493.28px" class="cls_039"><span class="cls_039">One of the most common operations you’ll use on either a </span><span class="cls_059">Flux</span><span class="cls_039"> or a </span><span class="cls_059">Mono</span><span class="cls_039"> is to trans-</span></div>
<div style="position:absolute;left:93.18px;top:506.27px" class="cls_039"><span class="cls_039">form published items to some other form or type. Reactor’s types offer </span><span class="cls_059">map()</span><span class="cls_039"> and</span></div>
<div style="position:absolute;left:93.18px;top:519.29px" class="cls_059"><span class="cls_059">flatMap()</span><span class="cls_039"> operations for that purpose.</span></div>
<div style="position:absolute;left:109.11px;top:532.28px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">map()</span><span class="cls_039"> operation creates a </span><span class="cls_059">Flux</span><span class="cls_039"> that simply performs a transformation as</span></div>
<div style="position:absolute;left:93.18px;top:545.27px" class="cls_039"><span class="cls_039">prescribed by a given </span><span class="cls_059">Function</span><span class="cls_039"> on each object it receives before republishing it. Fig-</span></div>
<div style="position:absolute;left:93.18px;top:558.29px" class="cls_039"><span class="cls_039">ure 10.16 illustrates how the </span><span class="cls_059">map()</span><span class="cls_039"> operation works.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:186572px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background283.jpg" width="531" height="666"></div>
<div style="position:absolute;left:203.31px;top:24.35px" class="cls_055"><span class="cls_055">Applying common reactive operations</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">261</span></div>
<div style="position:absolute;left:133.43px;top:56.45px" class="cls_057"><span class="cls_057">1</span></div>
<div style="position:absolute;left:152.87px;top:56.45px" class="cls_057"><span class="cls_057">2</span></div>
<div style="position:absolute;left:172.31px;top:56.45px" class="cls_057"><span class="cls_057">3</span></div>
<div style="position:absolute;left:191.75px;top:56.45px" class="cls_057"><span class="cls_057">4</span></div>
<div style="position:absolute;left:156.59px;top:90.27px" class="cls_057"><span class="cls_057">map(</span></div>
<div style="position:absolute;left:211.46px;top:90.27px" class="cls_057"><span class="cls_057">)</span></div>
<div style="position:absolute;left:286.26px;top:108.62px" class="cls_053"><span class="cls_053">Figure 10.16</span></div>
<div style="position:absolute;left:340.42px;top:108.62px" class="cls_053"><span class="cls_053">The map operation performs a</span></div>
<div style="position:absolute;left:286.26px;top:118.61px" class="cls_053"><span class="cls_053">transformation of incoming messages into</span></div>
<div style="position:absolute;left:133.43px;top:124.00px" class="cls_057"><span class="cls_057">1</span></div>
<div style="position:absolute;left:152.87px;top:124.00px" class="cls_057"><span class="cls_057">2</span></div>
<div style="position:absolute;left:172.31px;top:124.00px" class="cls_057"><span class="cls_057">3</span></div>
<div style="position:absolute;left:191.76px;top:124.00px" class="cls_057"><span class="cls_057">4</span></div>
<div style="position:absolute;left:286.26px;top:128.63px" class="cls_053"><span class="cls_053">new messages on the resulting stream.</span></div>
<div style="position:absolute;left:102.18px;top:159.29px" class="cls_039"><span class="cls_039">In the following test method, a </span><span class="cls_059">Flux</span><span class="cls_039"> of </span><span class="cls_059">String</span><span class="cls_039"> values representing basketball players</span></div>
<div style="position:absolute;left:102.18px;top:172.31px" class="cls_039"><span class="cls_039">is mapped to a new </span><span class="cls_059">Flux</span><span class="cls_039"> of </span><span class="cls_059">Player</span><span class="cls_039"> objects:</span></div>
<div style="position:absolute;left:102.18px;top:191.99px" class="cls_060"><span class="cls_060">@Test</span></div>
<div style="position:absolute;left:102.18px;top:201.98px" class="cls_060"><span class="cls_060">public void map() {</span></div>
<div style="position:absolute;left:111.78px;top:211.97px" class="cls_060"><span class="cls_060">Flux&lt;Player&gt; playerFlux = Flux</span></div>
<div style="position:absolute;left:121.38px;top:221.99px" class="cls_060"><span class="cls_060">.just("Michael Jordan", "Scottie Pippen", "Steve Kerr")</span></div>
<div style="position:absolute;left:121.38px;top:231.98px" class="cls_060"><span class="cls_060">.map(n -&gt; {</span></div>
<div style="position:absolute;left:130.96px;top:241.97px" class="cls_060"><span class="cls_060">String[] split = n.split("\\s");</span></div>
<div style="position:absolute;left:130.96px;top:251.99px" class="cls_060"><span class="cls_060">return new Player(split[0], split[1]);</span></div>
<div style="position:absolute;left:121.38px;top:261.98px" class="cls_060"><span class="cls_060">});</span></div>
<div style="position:absolute;left:111.78px;top:281.99px" class="cls_060"><span class="cls_060">StepVerifier.create(playerFlux)</span></div>
<div style="position:absolute;left:130.96px;top:291.98px" class="cls_060"><span class="cls_060">.expectNext(new Player("Michael", "Jordan"))</span></div>
<div style="position:absolute;left:130.96px;top:301.97px" class="cls_060"><span class="cls_060">.expectNext(new Player("Scottie", "Pippen"))</span></div>
<div style="position:absolute;left:130.96px;top:311.99px" class="cls_060"><span class="cls_060">.expectNext(new Player("Steve", "Kerr"))</span></div>
<div style="position:absolute;left:130.95px;top:321.98px" class="cls_060"><span class="cls_060">.verifyComplete();</span></div>
<div style="position:absolute;left:102.18px;top:332.00px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:353.30px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">Function</span><span class="cls_039"> given to </span><span class="cls_059">map()</span><span class="cls_039"> (as a lambda) splits the incoming </span><span class="cls_059">String</span><span class="cls_039"> at a space and</span></div>
<div style="position:absolute;left:102.18px;top:366.32px" class="cls_039"><span class="cls_039">uses the resulting </span><span class="cls_059">String</span><span class="cls_039"> array to create a </span><span class="cls_059">Player</span><span class="cls_039"> object. Although the </span><span class="cls_059">Flux</span><span class="cls_039"> created</span></div>
<div style="position:absolute;left:102.18px;top:379.31px" class="cls_039"><span class="cls_039">with </span><span class="cls_059">just()</span><span class="cls_039"> carried </span><span class="cls_059">String</span><span class="cls_039"> objects, the </span><span class="cls_059">Flux</span><span class="cls_039"> resulting from </span><span class="cls_059">map()</span><span class="cls_039"> carries </span><span class="cls_059">Player</span></div>
<div style="position:absolute;left:102.18px;top:392.30px" class="cls_039"><span class="cls_039">objects.</span></div>
<div style="position:absolute;left:116.55px;top:405.32px" class="cls_039"><span class="cls_039">What’s important to understand about </span><span class="cls_059">map()</span><span class="cls_039"> is that the mapping is performed syn-</span></div>
<div style="position:absolute;left:102.18px;top:418.31px" class="cls_039"><span class="cls_039">chronously, as each item is published by the source </span><span class="cls_059">Flux</span><span class="cls_039">. If you want to perform the</span></div>
<div style="position:absolute;left:102.18px;top:431.30px" class="cls_039"><span class="cls_039">mapping asynchronously, you should consider the </span><span class="cls_059">flatMap()</span><span class="cls_039"> operation.</span></div>
<div style="position:absolute;left:116.58px;top:444.32px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">flatMap()</span><span class="cls_039"> operation requires some thought and practice to acquire full profi-</span></div>
<div style="position:absolute;left:102.18px;top:457.31px" class="cls_039"><span class="cls_039">ciency. As shown in figure 10.17, instead of simply mapping one object to another, as</span></div>
<div style="position:absolute;left:102.18px;top:470.30px" class="cls_039"><span class="cls_039">in the case of </span><span class="cls_059">map()</span><span class="cls_039">, </span><span class="cls_059">flatMap()</span><span class="cls_039"> maps each object to a new </span><span class="cls_059">Mono</span><span class="cls_039"> or </span><span class="cls_059">Flux</span><span class="cls_039">. The results</span></div>
<div style="position:absolute;left:102.18px;top:483.32px" class="cls_039"><span class="cls_039">of the </span><span class="cls_059">Mono</span><span class="cls_039"> or </span><span class="cls_059">Flux</span><span class="cls_039"> are flattened into a new resulting </span><span class="cls_059">Flux</span><span class="cls_039">. When used along with</span></div>
<div style="position:absolute;left:102.18px;top:496.31px" class="cls_059"><span class="cls_059">subscribeOn()</span><span class="cls_039">, </span><span class="cls_059">flatMap()</span><span class="cls_039"> can unleash the asynchronous power of Reactor’s types.</span></div>
<div style="position:absolute;left:133.43px;top:522.32px" class="cls_057"><span class="cls_057">1</span></div>
<div style="position:absolute;left:172.32px;top:522.32px" class="cls_057"><span class="cls_057">2</span></div>
<div style="position:absolute;left:191.75px;top:522.32px" class="cls_057"><span class="cls_057">3</span></div>
<div style="position:absolute;left:138.30px;top:556.35px" class="cls_057"><span class="cls_057">flatMap(</span></div>
<div style="position:absolute;left:229.75px;top:556.35px" class="cls_057"><span class="cls_057">)</span></div>
<div style="position:absolute;left:287.22px;top:564.86px" class="cls_053"><span class="cls_053">Figure 10.17</span></div>
<div style="position:absolute;left:341.42px;top:564.86px" class="cls_053"><span class="cls_053">The flat map operation uses an</span></div>
<div style="position:absolute;left:287.22px;top:574.55px" class="cls_053"><span class="cls_053">intermediate </span><span class="cls_087">Flux</span><span class="cls_053"> to perform a transformation,</span></div>
<div style="position:absolute;left:287.22px;top:584.84px" class="cls_053"><span class="cls_053">consequently allowing for asynchronous</span></div>
<div style="position:absolute;left:133.10px;top:589.87px" class="cls_057"><span class="cls_057">1</span></div>
<div style="position:absolute;left:152.54px;top:589.87px" class="cls_057"><span class="cls_057">1</span></div>
<div style="position:absolute;left:171.98px;top:589.87px" class="cls_057"><span class="cls_057">2</span></div>
<div style="position:absolute;left:191.42px;top:589.87px" class="cls_057"><span class="cls_057">3</span></div>
<div style="position:absolute;left:211.20px;top:589.87px" class="cls_057"><span class="cls_057">2</span></div>
<div style="position:absolute;left:230.64px;top:589.87px" class="cls_057"><span class="cls_057">3</span></div>
<div style="position:absolute;left:287.22px;top:594.86px" class="cls_053"><span class="cls_053">transformations.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:187248px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background284.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">262</span></div>
<div style="position:absolute;left:201.03px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 10</span></div>
<div style="position:absolute;left:249.96px;top:24.35px" class="cls_055"><span class="cls_055">Introducing Reactor</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">The following test method demonstrates the use of </span><span class="cls_059">flatMap()</span><span class="cls_039"> and </span><span class="cls_059">subscribeOn()</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:70.34px" class="cls_060"><span class="cls_060">@Test</span></div>
<div style="position:absolute;left:93.18px;top:80.33px" class="cls_060"><span class="cls_060">public void flatMap() {</span></div>
<div style="position:absolute;left:102.78px;top:90.32px" class="cls_060"><span class="cls_060">Flux&lt;Player&gt; playerFlux = Flux</span></div>
<div style="position:absolute;left:112.38px;top:100.34px" class="cls_060"><span class="cls_060">.just("Michael Jordan", "Scottie Pippen", "Steve Kerr")</span></div>
<div style="position:absolute;left:112.38px;top:110.33px" class="cls_060"><span class="cls_060">.flatMap(n -&gt; Mono.just(n)</span></div>
<div style="position:absolute;left:131.56px;top:120.32px" class="cls_060"><span class="cls_060">.map(p -&gt; {</span></div>
<div style="position:absolute;left:150.76px;top:130.34px" class="cls_060"><span class="cls_060">String[] split = p.split("\\s");</span></div>
<div style="position:absolute;left:150.76px;top:140.33px" class="cls_060"><span class="cls_060">return new Player(split[0], split[1]);</span></div>
<div style="position:absolute;left:141.15px;top:150.35px" class="cls_060"><span class="cls_060">})</span></div>
<div style="position:absolute;left:131.55px;top:160.34px" class="cls_060"><span class="cls_060">.subscribeOn(Schedulers.parallel())</span></div>
<div style="position:absolute;left:121.95px;top:170.33px" class="cls_060"><span class="cls_060">);</span></div>
<div style="position:absolute;left:102.78px;top:188.33px" class="cls_060"><span class="cls_060">List&lt;Player&gt; playerList = Arrays.asList(</span></div>
<div style="position:absolute;left:121.96px;top:198.35px" class="cls_060"><span class="cls_060">new Player("Michael", "Jordan"),</span></div>
<div style="position:absolute;left:121.96px;top:208.34px" class="cls_060"><span class="cls_060">new Player("Scottie", "Pippen"),</span></div>
<div style="position:absolute;left:121.96px;top:218.33px" class="cls_060"><span class="cls_060">new Player("Steve", "Kerr"));</span></div>
<div style="position:absolute;left:102.78px;top:236.33px" class="cls_060"><span class="cls_060">StepVerifier.create(playerFlux)</span></div>
<div style="position:absolute;left:121.93px;top:246.35px" class="cls_060"><span class="cls_060">.expectNextMatches(p -&gt; playerList.contains(p))</span></div>
<div style="position:absolute;left:121.93px;top:256.34px" class="cls_060"><span class="cls_060">.expectNextMatches(p -&gt; playerList.contains(p))</span></div>
<div style="position:absolute;left:121.93px;top:266.33px" class="cls_060"><span class="cls_060">.expectNextMatches(p -&gt; playerList.contains(p))</span></div>
<div style="position:absolute;left:121.95px;top:276.35px" class="cls_060"><span class="cls_060">.verifyComplete();</span></div>
<div style="position:absolute;left:93.18px;top:286.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:305.66px" class="cls_039"><span class="cls_039">Notice that </span><span class="cls_059">flatMap()</span><span class="cls_039"> is given a lambda </span><span class="cls_059">Function</span><span class="cls_039"> that transforms the incoming</span></div>
<div style="position:absolute;left:93.18px;top:318.68px" class="cls_059"><span class="cls_059">String</span><span class="cls_039"> into a </span><span class="cls_059">Mono</span><span class="cls_039"> of type </span><span class="cls_059">String</span><span class="cls_039">. A </span><span class="cls_059">map()</span><span class="cls_039"> operation is then applied to the </span><span class="cls_059">Mono</span><span class="cls_039"> to</span></div>
<div style="position:absolute;left:93.18px;top:331.67px" class="cls_039"><span class="cls_039">transform the </span><span class="cls_059">String</span><span class="cls_039"> to a </span><span class="cls_059">Player</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:109.30px;top:344.66px" class="cls_039"><span class="cls_039">If you stopped right there, the resulting </span><span class="cls_059">Flux</span><span class="cls_039"> would carry </span><span class="cls_059">Player</span><span class="cls_039"> objects, pro-</span></div>
<div style="position:absolute;left:93.18px;top:357.68px" class="cls_039"><span class="cls_039">duced synchronously in the same order as with the </span><span class="cls_059">map()</span><span class="cls_039"> example. But the last thing</span></div>
<div style="position:absolute;left:93.18px;top:370.67px" class="cls_039"><span class="cls_039">you do with the </span><span class="cls_059">Mono</span><span class="cls_039"> is call </span><span class="cls_059">subscribeOn()</span><span class="cls_039"> to indicate that each subscription should</span></div>
<div style="position:absolute;left:93.18px;top:383.66px" class="cls_039"><span class="cls_039">take place in a parallel thread. Consequently, the mapping operations for multiple</span></div>
<div style="position:absolute;left:93.18px;top:396.68px" class="cls_039"><span class="cls_039">incoming </span><span class="cls_059">String</span><span class="cls_039"> objects can be performed asynchronously and in parallel.</span></div>
<div style="position:absolute;left:107.70px;top:409.67px" class="cls_039"><span class="cls_039">Although </span><span class="cls_059">subscribeOn()</span><span class="cls_039"> is named similarly to </span><span class="cls_059">subscribe()</span><span class="cls_039">, they’re quite different.</span></div>
<div style="position:absolute;left:93.18px;top:422.66px" class="cls_039"><span class="cls_039">Whereas </span><span class="cls_059">subscribe()</span><span class="cls_039"> is a verb, subscribing to a reactive flow and effectively kicking it</span></div>
<div style="position:absolute;left:93.18px;top:435.68px" class="cls_039"><span class="cls_039">off, </span><span class="cls_059">subscribeOn()</span><span class="cls_039"> is more descriptive, specifying </span><span class="cls_036">how</span><span class="cls_039"> a subscription should be handled</span></div>
<div style="position:absolute;left:93.18px;top:448.67px" class="cls_039"><span class="cls_039">concurrently. Reactor doesn’t force any particular concurrency model; it’s through </span><span class="cls_059">sub-</span></div>
<div style="position:absolute;left:93.18px;top:461.66px" class="cls_059"><span class="cls_059">scribeOn()</span><span class="cls_039"> that you can specify the concurrency model, using one of the static meth-</span></div>
<div style="position:absolute;left:93.18px;top:474.68px" class="cls_039"><span class="cls_039">ods from </span><span class="cls_059">Schedulers</span><span class="cls_039">, that you want to use. In this example, you used </span><span class="cls_059">parallel()</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:93.18px;top:487.67px" class="cls_039"><span class="cls_039">which uses worker threads from a fixed pool (sized to the number of CPU cores). But</span></div>
<div style="position:absolute;left:93.18px;top:500.66px" class="cls_059"><span class="cls_059">Schedulers</span><span class="cls_039"> supports several concurrency models, such as those described in table 10.1.</span></div>
<div style="position:absolute;left:93.18px;top:521.54px" class="cls_053"><span class="cls_053">Table 10.1</span></div>
<div style="position:absolute;left:139.71px;top:521.24px" class="cls_053"><span class="cls_053">Concurrency models for </span><span class="cls_087">Schedulers</span></div>
<div style="position:absolute;left:103.17px;top:542.54px" class="cls_091"><span class="cls_091">Schedulers</span><span class="cls_073"> method</span></div>
<div style="position:absolute;left:308.19px;top:542.81px" class="cls_073"><span class="cls_073">Description</span></div>
<div style="position:absolute;left:99.18px;top:561.95px" class="cls_060"><span class="cls_060">.immediate()</span></div>
<div style="position:absolute;left:201.18px;top:561.95px" class="cls_074"><span class="cls_074">Executes the subscription in the current thread.</span></div>
<div style="position:absolute;left:99.18px;top:578.96px" class="cls_060"><span class="cls_060">.single()</span></div>
<div style="position:absolute;left:201.18px;top:578.96px" class="cls_074"><span class="cls_074">Executes the subscription in a single, reusable thread. Reuses the same</span></div>
<div style="position:absolute;left:201.18px;top:588.95px" class="cls_074"><span class="cls_074">thread for all callers.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:187924px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background285.jpg" width="531" height="666"></div>
<div style="position:absolute;left:203.31px;top:24.35px" class="cls_055"><span class="cls_055">Applying common reactive operations</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">263</span></div>
<div style="position:absolute;left:102.18px;top:51.53px" class="cls_053"><span class="cls_053">Table 10.1</span></div>
<div style="position:absolute;left:148.71px;top:51.23px" class="cls_053"><span class="cls_053">Concurrency models for </span><span class="cls_087">Schedulers</span><span class="cls_084"> (continued)</span></div>
<div style="position:absolute;left:112.20px;top:72.53px" class="cls_091"><span class="cls_091">Schedulers</span><span class="cls_073"> method</span></div>
<div style="position:absolute;left:317.19px;top:72.77px" class="cls_073"><span class="cls_073">Description</span></div>
<div style="position:absolute;left:108.18px;top:91.94px" class="cls_060"><span class="cls_060">.newSingle()</span></div>
<div style="position:absolute;left:210.18px;top:91.94px" class="cls_074"><span class="cls_074">Executes the subscription in a per-call dedicated thread.</span></div>
<div style="position:absolute;left:108.18px;top:108.92px" class="cls_060"><span class="cls_060">.elastic()</span></div>
<div style="position:absolute;left:210.18px;top:108.92px" class="cls_074"><span class="cls_074">Executes the subscription in a worker pulled from an unbounded, elastic</span></div>
<div style="position:absolute;left:210.18px;top:118.94px" class="cls_074"><span class="cls_074">pool. New worker threads are created as needed, and idle workers are dis-</span></div>
<div style="position:absolute;left:210.18px;top:128.93px" class="cls_074"><span class="cls_074">posed of (by default, after 60 seconds).</span></div>
<div style="position:absolute;left:108.18px;top:145.94px" class="cls_060"><span class="cls_060">.parallel()</span></div>
<div style="position:absolute;left:210.18px;top:145.94px" class="cls_074"><span class="cls_074">Executes the subscription in a worker pulled from a fixed-size pool, sized to</span></div>
<div style="position:absolute;left:210.18px;top:155.93px" class="cls_074"><span class="cls_074">the number of CPU cores.</span></div>
<div style="position:absolute;left:102.18px;top:179.27px" class="cls_039"><span class="cls_039">The upside to using </span><span class="cls_059">flatMap()</span><span class="cls_039"> and </span><span class="cls_059">subscribeOn()</span><span class="cls_039"> is that you can increase the through-</span></div>
<div style="position:absolute;left:102.18px;top:192.26px" class="cls_039"><span class="cls_039">put of the stream by splitting the work across multiple parallel threads. But because the</span></div>
<div style="position:absolute;left:102.18px;top:205.25px" class="cls_039"><span class="cls_039">work is being done in parallel, with no guarantees on which will finish first, there’s no</span></div>
<div style="position:absolute;left:102.18px;top:218.27px" class="cls_039"><span class="cls_039">way to know the order of items emitted in the resulting </span><span class="cls_059">Flux</span><span class="cls_039">. Therefore, </span><span class="cls_059">StepVerifier</span></div>
<div style="position:absolute;left:102.18px;top:231.26px" class="cls_039"><span class="cls_039">is only able to verify that each item emitted exists in the expected list of </span><span class="cls_059">Player</span><span class="cls_039"> objects</span></div>
<div style="position:absolute;left:102.18px;top:244.25px" class="cls_039"><span class="cls_039">and that there will be three such items before the </span><span class="cls_059">Flux</span><span class="cls_039"> completes.</span></div>
<div style="position:absolute;left:102.18px;top:262.43px" class="cls_064"><span class="cls_064">B</span><span class="cls_065">UFFERING</span><span class="cls_064"> </span><span class="cls_065">DATA</span><span class="cls_064"> </span><span class="cls_065">ON</span><span class="cls_064"> </span><span class="cls_065">A</span><span class="cls_064"> </span><span class="cls_065">REACTIVE</span><span class="cls_064"> </span><span class="cls_065">STREAM</span></div>
<div style="position:absolute;left:102.18px;top:274.76px" class="cls_039"><span class="cls_039">In the course of processing the data flowing through a </span><span class="cls_059">Flux</span><span class="cls_039">, you might find it helpful</span></div>
<div style="position:absolute;left:102.18px;top:287.75px" class="cls_039"><span class="cls_039">to break the stream of data into bite-size chunks. The </span><span class="cls_059">buffer()</span><span class="cls_039"> operation, shown in</span></div>
<div style="position:absolute;left:102.18px;top:300.77px" class="cls_039"><span class="cls_039">figure 10.18, can help with that.</span></div>
<div style="position:absolute;left:133.43px;top:328.60px" class="cls_057"><span class="cls_057">1</span></div>
<div style="position:absolute;left:152.87px;top:328.60px" class="cls_057"><span class="cls_057">2</span></div>
<div style="position:absolute;left:172.31px;top:328.60px" class="cls_057"><span class="cls_057">3</span></div>
<div style="position:absolute;left:197.75px;top:328.60px" class="cls_057"><span class="cls_057">4</span></div>
<div style="position:absolute;left:217.19px;top:328.60px" class="cls_057"><span class="cls_057">5</span></div>
<div style="position:absolute;left:156.73px;top:362.42px" class="cls_057"><span class="cls_057">buffer(maxSize=3)</span></div>
<div style="position:absolute;left:287.34px;top:381.53px" class="cls_053"><span class="cls_053">Figure 10.18</span></div>
<div style="position:absolute;left:341.29px;top:381.53px" class="cls_053"><span class="cls_053">The buffer operation results</span></div>
<div style="position:absolute;left:287.34px;top:391.22px" class="cls_053"><span class="cls_053">in a </span><span class="cls_087">Flux</span><span class="cls_053"> of lists of a given maximum size</span></div>
<div style="position:absolute;left:157.24px;top:396.40px" class="cls_057"><span class="cls_057">1</span></div>
<div style="position:absolute;left:172.31px;top:396.40px" class="cls_057"><span class="cls_057">2</span></div>
<div style="position:absolute;left:187.39px;top:396.40px" class="cls_057"><span class="cls_057">3</span></div>
<div style="position:absolute;left:209.66px;top:396.40px" class="cls_057"><span class="cls_057">4</span></div>
<div style="position:absolute;left:224.73px;top:396.40px" class="cls_057"><span class="cls_057">5</span></div>
<div style="position:absolute;left:287.34px;top:401.21px" class="cls_053"><span class="cls_053">that are collected from the incoming </span><span class="cls_087">Flux</span><span class="cls_053">.</span></div>
<div style="position:absolute;left:102.18px;top:428.84px" class="cls_039"><span class="cls_039">Given a </span><span class="cls_059">Flux</span><span class="cls_039"> of </span><span class="cls_059">String</span><span class="cls_039"> values, each containing the name of a fruit, you can create a</span></div>
<div style="position:absolute;left:102.18px;top:441.83px" class="cls_039"><span class="cls_039">new </span><span class="cls_059">Flux</span><span class="cls_039"> of </span><span class="cls_059">List</span><span class="cls_039"> collections, where each </span><span class="cls_059">List</span><span class="cls_039"> has no more than a specified number</span></div>
<div style="position:absolute;left:102.18px;top:454.85px" class="cls_039"><span class="cls_039">of elements:</span></div>
<div style="position:absolute;left:102.18px;top:474.53px" class="cls_060"><span class="cls_060">@Test</span></div>
<div style="position:absolute;left:102.18px;top:484.52px" class="cls_060"><span class="cls_060">public void buffer() {</span></div>
<div style="position:absolute;left:111.78px;top:494.51px" class="cls_060"><span class="cls_060">Flux&lt;String&gt; fruitFlux = Flux.just(</span></div>
<div style="position:absolute;left:130.96px;top:504.53px" class="cls_060"><span class="cls_060">"apple", "orange", "banana", "kiwi", "strawberry");</span></div>
<div style="position:absolute;left:111.78px;top:524.51px" class="cls_060"><span class="cls_060">Flux&lt;List&lt;String&gt;&gt; bufferedFlux = fruitFlux.buffer(3);</span></div>
<div style="position:absolute;left:111.78px;top:544.52px" class="cls_060"><span class="cls_060">StepVerifier</span></div>
<div style="position:absolute;left:130.95px;top:554.51px" class="cls_060"><span class="cls_060">.create(bufferedFlux)</span></div>
<div style="position:absolute;left:130.96px;top:564.53px" class="cls_060"><span class="cls_060">.expectNext(Arrays.asList("apple", "orange", "banana"))</span></div>
<div style="position:absolute;left:130.95px;top:574.52px" class="cls_060"><span class="cls_060">.expectNext(Arrays.asList("kiwi", "strawberry"))</span></div>
<div style="position:absolute;left:130.95px;top:584.51px" class="cls_060"><span class="cls_060">.verifyComplete();</span></div>
<div style="position:absolute;left:102.18px;top:594.53px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:188600px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background286.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">264</span></div>
<div style="position:absolute;left:201.03px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 10</span></div>
<div style="position:absolute;left:249.96px;top:24.35px" class="cls_055"><span class="cls_055">Introducing Reactor</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">In this case, the </span><span class="cls_059">Flux</span><span class="cls_039"> of </span><span class="cls_059">String</span><span class="cls_039"> elements is buffered into a new </span><span class="cls_059">Flux</span><span class="cls_039"> of </span><span class="cls_059">List</span><span class="cls_039"> collec-</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">tions containing no more than three items each. Consequently, the original </span><span class="cls_059">Flux</span><span class="cls_039"> that</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">emits five </span><span class="cls_059">String</span><span class="cls_039"> values will be converted to a </span><span class="cls_059">Flux</span><span class="cls_039"> that emits two </span><span class="cls_059">List</span><span class="cls_039"> collections,</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">one containing three fruits and the other with two fruits.</span></div>
<div style="position:absolute;left:108.40px;top:102.65px" class="cls_039"><span class="cls_039">So what? Buffering values from a reactive </span><span class="cls_059">Flux</span><span class="cls_039"> into non-reactive </span><span class="cls_059">List</span><span class="cls_039"> collections</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">seems counterproductive. But when you combine </span><span class="cls_059">buffer()</span><span class="cls_039"> with </span><span class="cls_059">flatMap()</span><span class="cls_039">, it enables</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">each of the </span><span class="cls_059">List</span><span class="cls_039"> collections to be processed in parallel:</span></div>
<div style="position:absolute;left:93.18px;top:151.34px" class="cls_060"><span class="cls_060">Flux.just(</span></div>
<div style="position:absolute;left:112.38px;top:161.33px" class="cls_060"><span class="cls_060">"apple", "orange", "banana", "kiwi", "strawberry")</span></div>
<div style="position:absolute;left:112.38px;top:171.35px" class="cls_060"><span class="cls_060">.buffer(3)</span></div>
<div style="position:absolute;left:112.38px;top:181.34px" class="cls_060"><span class="cls_060">.flatMap(x -&gt;</span></div>
<div style="position:absolute;left:121.95px;top:191.33px" class="cls_060"><span class="cls_060">Flux.fromIterable(x)</span></div>
<div style="position:absolute;left:131.56px;top:201.35px" class="cls_060"><span class="cls_060">.map(y -&gt; y.toUpperCase())</span></div>
<div style="position:absolute;left:131.55px;top:211.34px" class="cls_060"><span class="cls_060">.subscribeOn(Schedulers.parallel())</span></div>
<div style="position:absolute;left:131.55px;top:221.33px" class="cls_060"><span class="cls_060">.log()</span></div>
<div style="position:absolute;left:112.38px;top:231.35px" class="cls_061"><span class="cls_061">).subscribe();</span></div>
<div style="position:absolute;left:93.18px;top:255.65px" class="cls_039"><span class="cls_039">In this new example, you still buffer a </span><span class="cls_059">Flux</span><span class="cls_039"> of five </span><span class="cls_059">String</span><span class="cls_039"> values into a new </span><span class="cls_059">Flux</span><span class="cls_039"> of</span></div>
<div style="position:absolute;left:93.18px;top:268.67px" class="cls_059"><span class="cls_059">List</span><span class="cls_039"> collections. But then you apply </span><span class="cls_059">flatMap()</span><span class="cls_039"> to that </span><span class="cls_059">Flux</span><span class="cls_039"> of </span><span class="cls_059">List</span><span class="cls_039"> collections. This</span></div>
<div style="position:absolute;left:93.18px;top:281.66px" class="cls_039"><span class="cls_039">takes each </span><span class="cls_059">List</span><span class="cls_039"> buffer and creates a new </span><span class="cls_059">Flux</span><span class="cls_039"> from its elements, and then applies a</span></div>
<div style="position:absolute;left:93.18px;top:294.68px" class="cls_059"><span class="cls_059">map()</span><span class="cls_039"> operation on it. Consequently, each buffered </span><span class="cls_059">List</span><span class="cls_039"> is further processed in paral-</span></div>
<div style="position:absolute;left:93.18px;top:307.67px" class="cls_039"><span class="cls_039">lel in individual threads.</span></div>
<div style="position:absolute;left:108.11px;top:320.66px" class="cls_039"><span class="cls_039">To prove that it works, I’ve also included a </span><span class="cls_059">log()</span><span class="cls_039"> operation to be applied to each</span></div>
<div style="position:absolute;left:93.18px;top:333.68px" class="cls_039"><span class="cls_039">sub-</span><span class="cls_059">Flux</span><span class="cls_039">. The </span><span class="cls_059">log()</span><span class="cls_039"> operation simply logs all Reactive Streams events, so that you can</span></div>
<div style="position:absolute;left:93.18px;top:346.67px" class="cls_039"><span class="cls_039">see what’s really happening. As a result, the following entries are written to the log</span></div>
<div style="position:absolute;left:93.18px;top:359.66px" class="cls_039"><span class="cls_039">(with the time component removed for brevity’s sake):</span></div>
<div style="position:absolute;left:93.18px;top:382.34px" class="cls_060"><span class="cls_060">[main] INFO reactor.Flux.SubscribeOn.1 -</span></div>
<div style="position:absolute;left:179.52px;top:392.36px" class="cls_060"><span class="cls_060">onSubscribe(FluxSubscribeOn.SubscribeOnSubscriber)</span></div>
<div style="position:absolute;left:93.18px;top:402.35px" class="cls_060"><span class="cls_060">[main] INFO reactor.Flux.SubscribeOn.1 - request(32)</span></div>
<div style="position:absolute;left:93.18px;top:412.34px" class="cls_060"><span class="cls_060">[main] INFO reactor.Flux.SubscribeOn.2 -</span></div>
<div style="position:absolute;left:179.52px;top:422.36px" class="cls_060"><span class="cls_060">onSubscribe(FluxSubscribeOn.SubscribeOnSubscriber)</span></div>
<div style="position:absolute;left:93.18px;top:432.35px" class="cls_060"><span class="cls_060">[main] INFO reactor.Flux.SubscribeOn.2 - request(32)</span></div>
<div style="position:absolute;left:93.18px;top:442.34px" class="cls_060"><span class="cls_060">[parallel-1] INFO reactor.Flux.SubscribeOn.1 - onNext(APPLE)</span></div>
<div style="position:absolute;left:93.18px;top:452.36px" class="cls_060"><span class="cls_060">[parallel-2] INFO reactor.Flux.SubscribeOn.2 - onNext(KIWI)</span></div>
<div style="position:absolute;left:93.18px;top:462.35px" class="cls_060"><span class="cls_060">[parallel-1] INFO reactor.Flux.SubscribeOn.1 - onNext(ORANGE)</span></div>
<div style="position:absolute;left:93.18px;top:472.34px" class="cls_060"><span class="cls_060">[parallel-2] INFO reactor.Flux.SubscribeOn.2 - onNext(STRAWBERRY)</span></div>
<div style="position:absolute;left:93.18px;top:482.36px" class="cls_060"><span class="cls_060">[parallel-1] INFO reactor.Flux.SubscribeOn.1 - onNext(BANANA)</span></div>
<div style="position:absolute;left:93.18px;top:492.35px" class="cls_060"><span class="cls_060">[parallel-1] INFO reactor.Flux.SubscribeOn.1 - onComplete()</span></div>
<div style="position:absolute;left:93.18px;top:502.34px" class="cls_061"><span class="cls_061">[parallel-2] INFO reactor.Flux.SubscribeOn.2 - onComplete()</span></div>
<div style="position:absolute;left:93.18px;top:526.67px" class="cls_039"><span class="cls_039">As the log entries clearly show, the fruits in the first buffer (apple, orange, and</span></div>
<div style="position:absolute;left:93.18px;top:539.66px" class="cls_039"><span class="cls_039">banana) are handled in the </span><span class="cls_059">parallel-1</span><span class="cls_039"> thread. Meanwhile, the fruits in the second</span></div>
<div style="position:absolute;left:93.18px;top:552.68px" class="cls_039"><span class="cls_039">buffer (kiwi and strawberry) are processed in the </span><span class="cls_059">parallel-2</span><span class="cls_039"> thread. As is apparent</span></div>
<div style="position:absolute;left:93.18px;top:565.67px" class="cls_039"><span class="cls_039">by the fact that the log entries from each buffer are woven together, the two buffers</span></div>
<div style="position:absolute;left:93.18px;top:578.69px" class="cls_039"><span class="cls_039">are processed in parallel.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:189276px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background287.jpg" width="531" height="666"></div>
<div style="position:absolute;left:203.31px;top:24.35px" class="cls_055"><span class="cls_055">Applying common reactive operations</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">265</span></div>
<div style="position:absolute;left:117.45px;top:50.66px" class="cls_039"><span class="cls_039">If, for some reason, you need to collect everything that a </span><span class="cls_059">Flux</span><span class="cls_039"> emits into a </span><span class="cls_059">List</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">you can call </span><span class="cls_059">buffer()</span><span class="cls_039"> with no arguments:</span></div>
<div style="position:absolute;left:102.18px;top:86.33px" class="cls_061"><span class="cls_061">Flux&lt;List&lt;String&gt;&gt; bufferedFlux = fruitFlux.buffer();</span></div>
<div style="position:absolute;left:102.18px;top:106.67px" class="cls_039"><span class="cls_039">This results in a new </span><span class="cls_059">Flux</span><span class="cls_039"> that emits a </span><span class="cls_059">List</span><span class="cls_039"> that contains all the items published by</span></div>
<div style="position:absolute;left:102.18px;top:119.66px" class="cls_039"><span class="cls_039">the source </span><span class="cls_059">Flux</span><span class="cls_039">. You can achieve the same thing with the </span><span class="cls_059">collectList()</span><span class="cls_039"> operation,</span></div>
<div style="position:absolute;left:102.18px;top:132.65px" class="cls_039"><span class="cls_039">illustrated by the marble diagram in figure 10.19.</span></div>
<div style="position:absolute;left:133.43px;top:160.49px" class="cls_057"><span class="cls_057">1</span></div>
<div style="position:absolute;left:152.87px;top:160.49px" class="cls_057"><span class="cls_057">2</span></div>
<div style="position:absolute;left:172.31px;top:160.49px" class="cls_057"><span class="cls_057">3</span></div>
<div style="position:absolute;left:191.76px;top:160.49px" class="cls_057"><span class="cls_057">4</span></div>
<div style="position:absolute;left:169.83px;top:194.31px" class="cls_057"><span class="cls_057">collectList</span></div>
<div style="position:absolute;left:286.26px;top:213.41px" class="cls_053"><span class="cls_053">Figure 10.19</span></div>
<div style="position:absolute;left:340.24px;top:213.41px" class="cls_053"><span class="cls_053">The collect-list operation results</span></div>
<div style="position:absolute;left:286.26px;top:223.10px" class="cls_053"><span class="cls_053">in a </span><span class="cls_087">Mono</span><span class="cls_053"> containing a list of all messages</span></div>
<div style="position:absolute;left:185.50px;top:228.29px" class="cls_057"><span class="cls_057">1</span></div>
<div style="position:absolute;left:200.58px;top:228.29px" class="cls_057"><span class="cls_057">2</span></div>
<div style="position:absolute;left:215.65px;top:228.29px" class="cls_057"><span class="cls_057">3</span></div>
<div style="position:absolute;left:230.72px;top:228.29px" class="cls_057"><span class="cls_057">4</span></div>
<div style="position:absolute;left:286.26px;top:233.12px" class="cls_053"><span class="cls_053">emitted by the incoming </span><span class="cls_087">Flux</span><span class="cls_053">.</span></div>
<div style="position:absolute;left:102.18px;top:265.01px" class="cls_039"><span class="cls_039">Rather than produce a </span><span class="cls_059">Flux</span><span class="cls_039"> that publishes a </span><span class="cls_059">List</span><span class="cls_039">, </span><span class="cls_059">collectList()</span><span class="cls_039"> produces a </span><span class="cls_059">Mono</span></div>
<div style="position:absolute;left:102.18px;top:278.03px" class="cls_039"><span class="cls_039">that publishes a </span><span class="cls_059">List</span><span class="cls_039">. The following test method shows how it might be used:</span></div>
<div style="position:absolute;left:102.18px;top:299.69px" class="cls_060"><span class="cls_060">@Test</span></div>
<div style="position:absolute;left:102.18px;top:309.71px" class="cls_060"><span class="cls_060">public void collectList() {</span></div>
<div style="position:absolute;left:111.78px;top:319.70px" class="cls_060"><span class="cls_060">Flux&lt;String&gt; fruitFlux = Flux.just(</span></div>
<div style="position:absolute;left:130.96px;top:329.69px" class="cls_060"><span class="cls_060">"apple", "orange", "banana", "kiwi", "strawberry");</span></div>
<div style="position:absolute;left:111.78px;top:349.70px" class="cls_060"><span class="cls_060">Mono&lt;List&lt;String&gt;&gt; fruitListMono = fruitFlux.collectList();</span></div>
<div style="position:absolute;left:111.78px;top:369.71px" class="cls_060"><span class="cls_060">StepVerifier</span></div>
<div style="position:absolute;left:130.95px;top:379.70px" class="cls_060"><span class="cls_060">.create(fruitListMono)</span></div>
<div style="position:absolute;left:130.95px;top:389.69px" class="cls_060"><span class="cls_060">.expectNext(Arrays.asList(</span></div>
<div style="position:absolute;left:150.16px;top:399.71px" class="cls_060"><span class="cls_060">"apple", "orange", "banana", "kiwi", "strawberry"))</span></div>
<div style="position:absolute;left:130.95px;top:409.70px" class="cls_060"><span class="cls_060">.verifyComplete();</span></div>
<div style="position:absolute;left:102.18px;top:419.69px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:441.02px" class="cls_039"><span class="cls_039">An even more interesting way of collecting items emitted by a </span><span class="cls_059">Flux</span><span class="cls_039"> is to collect them</span></div>
<div style="position:absolute;left:102.18px;top:454.04px" class="cls_039"><span class="cls_039">into a </span><span class="cls_059">Map</span><span class="cls_039">. As shown in figure 10.20, the </span><span class="cls_059">collectMap()</span><span class="cls_039"> operation results in a </span><span class="cls_059">Mono</span></div>
<div style="position:absolute;left:102.18px;top:467.03px" class="cls_039"><span class="cls_039">that publishes a </span><span class="cls_059">Map</span><span class="cls_039"> that’s populated with entries whose key is calculated by a given</span></div>
<div style="position:absolute;left:102.18px;top:480.02px" class="cls_059"><span class="cls_059">Function</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:133.58px;top:511.77px" class="cls_057"><span class="cls_057">1</span></div>
<div style="position:absolute;left:153.02px;top:511.77px" class="cls_057"><span class="cls_057">2</span></div>
<div style="position:absolute;left:172.46px;top:511.77px" class="cls_057"><span class="cls_057">3</span></div>
<div style="position:absolute;left:191.90px;top:511.77px" class="cls_057"><span class="cls_057">4</span></div>
<div style="position:absolute;left:211.19px;top:511.77px" class="cls_057"><span class="cls_057">5</span></div>
<div style="position:absolute;left:155.24px;top:545.66px" class="cls_057"><span class="cls_057">collectMap( k(</span></div>
<div style="position:absolute;left:208.53px;top:545.66px" class="cls_057"><span class="cls_057">) )</span></div>
<div style="position:absolute;left:286.26px;top:553.82px" class="cls_053"><span class="cls_053">Figure 10.20</span></div>
<div style="position:absolute;left:339.75px;top:553.82px" class="cls_053"><span class="cls_053">The collect-map operation results in</span></div>
<div style="position:absolute;left:286.26px;top:563.51px" class="cls_053"><span class="cls_053">a </span><span class="cls_087">Mono</span><span class="cls_053"> containing a </span><span class="cls_087">Map</span><span class="cls_053"> of messages emitted by</span></div>
<div style="position:absolute;left:286.26px;top:573.53px" class="cls_053"><span class="cls_053">the incoming </span><span class="cls_087">Flux</span><span class="cls_053">, where the key is derived from</span></div>
<div style="position:absolute;left:133.22px;top:579.11px" class="cls_057"><span class="cls_057">k(</span></div>
<div style="position:absolute;left:144.89px;top:579.11px" class="cls_057"><span class="cls_057">):</span></div>
<div style="position:absolute;left:155.35px;top:579.57px" class="cls_057"><span class="cls_057">4</span></div>
<div style="position:absolute;left:164.73px;top:579.11px" class="cls_057"><span class="cls_057">, k(</span></div>
<div style="position:absolute;left:180.70px;top:579.11px" class="cls_057"><span class="cls_057">) :</span></div>
<div style="position:absolute;left:192.08px;top:579.57px" class="cls_057"><span class="cls_057">5</span></div>
<div style="position:absolute;left:201.24px;top:579.11px" class="cls_057"><span class="cls_057">, k (</span></div>
<div style="position:absolute;left:218.03px;top:579.11px" class="cls_057"><span class="cls_057">):</span></div>
<div style="position:absolute;left:228.81px;top:579.57px" class="cls_057"><span class="cls_057">3</span></div>
<div style="position:absolute;left:286.26px;top:583.82px" class="cls_053"><span class="cls_053">some characteristic of the incoming messages.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:189952px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background288.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">266</span></div>
<div style="position:absolute;left:201.03px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 10</span></div>
<div style="position:absolute;left:249.96px;top:24.35px" class="cls_055"><span class="cls_055">Introducing Reactor</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">To see </span><span class="cls_059">collectMap()</span><span class="cls_039"> in action, have a look at the following test method:</span></div>
<div style="position:absolute;left:93.18px;top:70.34px" class="cls_060"><span class="cls_060">@Test</span></div>
<div style="position:absolute;left:93.18px;top:80.33px" class="cls_060"><span class="cls_060">public void collectMap() {</span></div>
<div style="position:absolute;left:102.78px;top:90.32px" class="cls_060"><span class="cls_060">Flux&lt;String&gt; animalFlux = Flux.just(</span></div>
<div style="position:absolute;left:121.94px;top:100.34px" class="cls_060"><span class="cls_060">"aardvark", "elephant", "koala", "eagle", "kangaroo");</span></div>
<div style="position:absolute;left:102.78px;top:115.34px" class="cls_060"><span class="cls_060">Mono&lt;Map&lt;Character, String&gt;&gt; animalMapMono =</span></div>
<div style="position:absolute;left:121.93px;top:125.33px" class="cls_060"><span class="cls_060">animalFlux.collectMap(a -&gt; a.charAt(0));</span></div>
<div style="position:absolute;left:102.78px;top:140.33px" class="cls_060"><span class="cls_060">StepVerifier</span></div>
<div style="position:absolute;left:121.95px;top:150.35px" class="cls_060"><span class="cls_060">.create(animalMapMono)</span></div>
<div style="position:absolute;left:121.96px;top:160.34px" class="cls_060"><span class="cls_060">.expectNextMatches(map -&gt; {</span></div>
<div style="position:absolute;left:131.55px;top:170.33px" class="cls_060"><span class="cls_060">return</span></div>
<div style="position:absolute;left:150.75px;top:180.35px" class="cls_060"><span class="cls_060">map.size() == 3 &amp;&amp;</span></div>
<div style="position:absolute;left:150.76px;top:190.34px" class="cls_060"><span class="cls_060">map.get('a').equals("aardvark") &amp;&amp;</span></div>
<div style="position:absolute;left:150.76px;top:200.33px" class="cls_060"><span class="cls_060">map.get('e').equals("eagle") &amp;&amp;</span></div>
<div style="position:absolute;left:150.75px;top:210.35px" class="cls_060"><span class="cls_060">map.get('k').equals("kangaroo");</span></div>
<div style="position:absolute;left:121.95px;top:220.34px" class="cls_060"><span class="cls_060">})</span></div>
<div style="position:absolute;left:121.95px;top:230.33px" class="cls_060"><span class="cls_060">.verifyComplete();</span></div>
<div style="position:absolute;left:93.18px;top:240.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:259.67px" class="cls_039"><span class="cls_039">The source </span><span class="cls_059">Flux</span><span class="cls_039"> emits the names of a handful of animals. From that </span><span class="cls_059">Flux</span><span class="cls_039">, you use</span></div>
<div style="position:absolute;left:93.18px;top:272.66px" class="cls_059"><span class="cls_059">collectMap()</span><span class="cls_039"> to create a new </span><span class="cls_059">Mono</span><span class="cls_039"> that emits a </span><span class="cls_059">Map</span><span class="cls_039">, where the key value is determined</span></div>
<div style="position:absolute;left:93.18px;top:285.65px" class="cls_039"><span class="cls_039">by the first letter of the animal name and the value is the animal name itself. In the</span></div>
<div style="position:absolute;left:93.18px;top:298.67px" class="cls_039"><span class="cls_039">event that two animal names start with the same letter (as with </span><span class="cls_036">elephant</span><span class="cls_039"> and </span><span class="cls_036">eagle</span><span class="cls_039"> or </span><span class="cls_036">koala</span></div>
<div style="position:absolute;left:93.18px;top:311.66px" class="cls_039"><span class="cls_039">and </span><span class="cls_036">kangaroo</span><span class="cls_039">), the last entry flowing through the stream overrides any earlier entries.</span></div>
<div style="position:absolute;left:57.18px;top:332.48px" class="cls_063"><span class="cls_063">10.3.4</span></div>
<div style="position:absolute;left:93.18px;top:332.48px" class="cls_063"><span class="cls_063">Performing logic operations on reactive types</span></div>
<div style="position:absolute;left:93.18px;top:349.67px" class="cls_039"><span class="cls_039">Sometimes you just need to know if the entries published by a </span><span class="cls_059">Mono</span><span class="cls_039"> or </span><span class="cls_059">Flux</span><span class="cls_039"> match</span></div>
<div style="position:absolute;left:93.18px;top:362.66px" class="cls_039"><span class="cls_039">some criteria. The </span><span class="cls_059">all()</span><span class="cls_039"> and </span><span class="cls_059">any()</span><span class="cls_039"> operations perform such logic. Figures 10.21 and</span></div>
<div style="position:absolute;left:93.18px;top:375.68px" class="cls_039"><span class="cls_039">10.22 illustrate how </span><span class="cls_059">all()</span><span class="cls_039"> and </span><span class="cls_059">any()</span><span class="cls_039"> work.</span></div>
<div style="position:absolute;left:165.50px;top:435.57px" class="cls_057"><span class="cls_057">all(</span></div>
<div style="position:absolute;left:184.56px;top:435.57px" class="cls_057"><span class="cls_057">)</span></div>
<div style="position:absolute;left:278.22px;top:454.28px" class="cls_053"><span class="cls_053">Figure 10.21</span></div>
<div style="position:absolute;left:331.84px;top:454.28px" class="cls_053"><span class="cls_053">A flux can be tested to ensure that</span></div>
<div style="position:absolute;left:278.22px;top:464.27px" class="cls_053"><span class="cls_053">all messages meet some condition with the all</span></div>
<div style="position:absolute;left:214.92px;top:469.30px" class="cls_057"><span class="cls_057">True</span></div>
<div style="position:absolute;left:278.22px;top:474.29px" class="cls_053"><span class="cls_053">operation.</span></div>
<div style="position:absolute;left:164.25px;top:546.40px" class="cls_088"><span class="cls_088">any(</span></div>
<div style="position:absolute;left:187.53px;top:546.40px" class="cls_088"><span class="cls_088">)</span></div>
<div style="position:absolute;left:269.22px;top:574.70px" class="cls_053"><span class="cls_053">Figure 10.22</span></div>
<div style="position:absolute;left:323.41px;top:574.70px" class="cls_053"><span class="cls_053">A flux can be tested to ensure</span></div>
<div style="position:absolute;left:133.01px;top:580.14px" class="cls_088"><span class="cls_088">False</span></div>
<div style="position:absolute;left:222.53px;top:580.14px" class="cls_088"><span class="cls_088">True</span></div>
<div style="position:absolute;left:269.22px;top:584.72px" class="cls_053"><span class="cls_053">that at least one message meets some</span></div>
<div style="position:absolute;left:269.22px;top:594.71px" class="cls_053"><span class="cls_053">condition with the any operation.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:190628px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background289.jpg" width="531" height="666"></div>
<div style="position:absolute;left:203.31px;top:24.35px" class="cls_055"><span class="cls_055">Applying common reactive operations</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">267</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">Suppose you want to know that every </span><span class="cls_059">String</span><span class="cls_039"> published by a </span><span class="cls_059">Flux</span><span class="cls_039"> contains the letter </span><span class="cls_036">a</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">or the letter </span><span class="cls_036">k</span><span class="cls_039">. The following test shows how to use </span><span class="cls_059">all()</span><span class="cls_039"> to check for that condition:</span></div>
<div style="position:absolute;left:102.18px;top:83.33px" class="cls_060"><span class="cls_060">@Test</span></div>
<div style="position:absolute;left:102.18px;top:93.32px" class="cls_060"><span class="cls_060">public void all() {</span></div>
<div style="position:absolute;left:111.78px;top:103.34px" class="cls_060"><span class="cls_060">Flux&lt;String&gt; animalFlux = Flux.just(</span></div>
<div style="position:absolute;left:130.93px;top:113.33px" class="cls_060"><span class="cls_060">"aardvark", "elephant", "koala", "eagle", "kangaroo");</span></div>
<div style="position:absolute;left:111.78px;top:133.34px" class="cls_060"><span class="cls_060">Mono&lt;Boolean&gt; hasAMono = animalFlux.all(a -&gt; a.contains("a"));</span></div>
<div style="position:absolute;left:111.78px;top:143.33px" class="cls_060"><span class="cls_060">StepVerifier.create(hasAMono)</span></div>
<div style="position:absolute;left:121.38px;top:153.35px" class="cls_060"><span class="cls_060">.expectNext(true)</span></div>
<div style="position:absolute;left:121.38px;top:163.34px" class="cls_060"><span class="cls_060">.verifyComplete();</span></div>
<div style="position:absolute;left:111.78px;top:183.35px" class="cls_060"><span class="cls_060">Mono&lt;Boolean&gt; hasKMono = animalFlux.all(a -&gt; a.contains("k"));</span></div>
<div style="position:absolute;left:111.78px;top:193.34px" class="cls_060"><span class="cls_060">StepVerifier.create(hasKMono)</span></div>
<div style="position:absolute;left:121.38px;top:203.33px" class="cls_060"><span class="cls_060">.expectNext(false)</span></div>
<div style="position:absolute;left:121.38px;top:213.35px" class="cls_060"><span class="cls_060">.verifyComplete();</span></div>
<div style="position:absolute;left:102.18px;top:223.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:244.67px" class="cls_039"><span class="cls_039">In the first </span><span class="cls_059">StepVerifier</span><span class="cls_039">, you check for the letter </span><span class="cls_036">a</span><span class="cls_039">. The </span><span class="cls_059">all</span><span class="cls_039"> operation is applied to</span></div>
<div style="position:absolute;left:102.18px;top:257.66px" class="cls_039"><span class="cls_039">the source </span><span class="cls_059">Flux</span><span class="cls_039">, resulting in a </span><span class="cls_059">Mono</span><span class="cls_039"> of type </span><span class="cls_059">Boolean</span><span class="cls_039">. In this case, all of the animal</span></div>
<div style="position:absolute;left:102.18px;top:270.65px" class="cls_039"><span class="cls_039">names contain the letter </span><span class="cls_036">a</span><span class="cls_039">, so </span><span class="cls_059">true</span><span class="cls_039"> is emitted from the resulting </span><span class="cls_059">Mono</span><span class="cls_039">. But in the sec-</span></div>
<div style="position:absolute;left:102.18px;top:283.67px" class="cls_039"><span class="cls_039">ond </span><span class="cls_059">StepVerifier</span><span class="cls_039">, the resulting </span><span class="cls_059">Mono</span><span class="cls_039"> will emit </span><span class="cls_059">false</span><span class="cls_039"> because not all of the animal</span></div>
<div style="position:absolute;left:102.18px;top:296.66px" class="cls_039"><span class="cls_039">names contain a </span><span class="cls_036">k</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:116.90px;top:309.68px" class="cls_039"><span class="cls_039">Rather than perform an all-or-nothing check, maybe you’re satisfied if at least one</span></div>
<div style="position:absolute;left:102.18px;top:322.67px" class="cls_039"><span class="cls_039">entry matches. In that case, the </span><span class="cls_059">any()</span><span class="cls_039"> operation is what you want. This new test case</span></div>
<div style="position:absolute;left:102.18px;top:335.66px" class="cls_039"><span class="cls_039">uses </span><span class="cls_059">any()</span><span class="cls_039"> to check for the letters </span><span class="cls_036">t</span><span class="cls_039"> and </span><span class="cls_036">z</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:102.18px;top:355.34px" class="cls_060"><span class="cls_060">@Test</span></div>
<div style="position:absolute;left:102.18px;top:365.33px" class="cls_060"><span class="cls_060">public void any() {</span></div>
<div style="position:absolute;left:111.78px;top:375.35px" class="cls_060"><span class="cls_060">Flux&lt;String&gt; animalFlux = Flux.just(</span></div>
<div style="position:absolute;left:130.93px;top:385.34px" class="cls_060"><span class="cls_060">"aardvark", "elephant", "koala", "eagle", "kangaroo");</span></div>
<div style="position:absolute;left:111.78px;top:405.35px" class="cls_060"><span class="cls_060">Mono&lt;Boolean&gt; hasAMono = animalFlux.any(a -&gt; a.contains("t"));</span></div>
<div style="position:absolute;left:111.78px;top:425.36px" class="cls_060"><span class="cls_060">StepVerifier.create(hasAMono)</span></div>
<div style="position:absolute;left:121.38px;top:435.35px" class="cls_060"><span class="cls_060">.expectNext(true)</span></div>
<div style="position:absolute;left:121.38px;top:445.34px" class="cls_060"><span class="cls_060">.verifyComplete();</span></div>
<div style="position:absolute;left:111.78px;top:465.35px" class="cls_060"><span class="cls_060">Mono&lt;Boolean&gt; hasZMono = animalFlux.any(a -&gt; a.contains("z"));</span></div>
<div style="position:absolute;left:111.78px;top:475.34px" class="cls_060"><span class="cls_060">StepVerifier.create(hasZMono)</span></div>
<div style="position:absolute;left:121.38px;top:485.36px" class="cls_060"><span class="cls_060">.expectNext(false)</span></div>
<div style="position:absolute;left:121.38px;top:495.35px" class="cls_060"><span class="cls_060">.verifyComplete();</span></div>
<div style="position:absolute;left:102.18px;top:505.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:526.67px" class="cls_039"><span class="cls_039">In the first </span><span class="cls_059">StepVerifier</span><span class="cls_039">, you see that the resulting </span><span class="cls_059">Mono</span><span class="cls_039"> emits </span><span class="cls_059">true</span><span class="cls_039">, because at least</span></div>
<div style="position:absolute;left:102.18px;top:539.66px" class="cls_039"><span class="cls_039">one animal name has the letter </span><span class="cls_036">t</span><span class="cls_039"> (specifically, </span><span class="cls_036">elephant</span><span class="cls_039">). In the second case, the result-</span></div>
<div style="position:absolute;left:102.18px;top:552.68px" class="cls_039"><span class="cls_039">ing </span><span class="cls_059">Mono</span><span class="cls_039"> emits </span><span class="cls_059">false</span><span class="cls_039">, because none of the animal names contain </span><span class="cls_036">z</span><span class="cls_039">.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:191304px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background290.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">268</span></div>
<div style="position:absolute;left:201.03px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 10</span></div>
<div style="position:absolute;left:249.96px;top:24.35px" class="cls_055"><span class="cls_055">Introducing Reactor</span></div>
<div style="position:absolute;left:93.18px;top:49.81px" class="cls_040"><span class="cls_040">Summary</span></div>
<div style="position:absolute;left:108.78px;top:68.15px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Reactive programming involves creating pipelines through which data flows.</span></div>
<div style="position:absolute;left:108.78px;top:82.16px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  The Reactive Streams specification defines four types: </span><span class="cls_059">Publisher</span><span class="cls_039">, </span><span class="cls_059">Subscriber</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:120.78px;top:95.15px" class="cls_059"><span class="cls_059">Subscription</span><span class="cls_039">, and </span><span class="cls_059">Transformer</span><span class="cls_039"> (which is a combination of </span><span class="cls_059">Publisher</span><span class="cls_039"> and</span></div>
<div style="position:absolute;left:120.78px;top:108.17px" class="cls_059"><span class="cls_059">Subscriber</span><span class="cls_039">).</span></div>
<div style="position:absolute;left:108.78px;top:122.15px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Project Reactor implements Reactive Streams and abstracts stream definitions</span></div>
<div style="position:absolute;left:120.78px;top:135.17px" class="cls_039"><span class="cls_039">into two primary types, </span><span class="cls_059">Flux</span><span class="cls_039"> and </span><span class="cls_059">Mono</span><span class="cls_039">, each of which offers several hundred</span></div>
<div style="position:absolute;left:120.78px;top:148.16px" class="cls_039"><span class="cls_039">operations.</span></div>
<div style="position:absolute;left:108.78px;top:162.17px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Spring 5 leverages Reactor to create reactive controllers, repositories, REST cli-</span></div>
<div style="position:absolute;left:120.78px;top:175.16px" class="cls_039"><span class="cls_039">ents, and other reactive framework support.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:191980px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background291.jpg" width="531" height="666"></div>
<div style="position:absolute;left:186.78px;top:111.83px" class="cls_014"><span class="cls_014">Developing reactive APIs</span></div>
<div style="position:absolute;left:96.18px;top:264.85px" class="cls_049"><span class="cls_049">This chapter covers</span></div>
<div style="position:absolute;left:96.18px;top:283.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Using Spring WebFlux</span></div>
<div style="position:absolute;left:96.18px;top:298.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Writing and testing reactive controllers and</span></div>
<div style="position:absolute;left:108.18px;top:310.55px" class="cls_051"><span class="cls_051">clients</span></div>
<div style="position:absolute;left:96.18px;top:325.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Consuming REST APIs</span></div>
<div style="position:absolute;left:96.18px;top:340.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Securing reactive web applications</span></div>
<div style="position:absolute;left:114.18px;top:410.54px" class="cls_039"><span class="cls_039">Now that you’ve a good introduction to reactive programming and Project Reactor,</span></div>
<div style="position:absolute;left:114.18px;top:423.53px" class="cls_039"><span class="cls_039">you’re ready to start applying those techniques in your Spring applications. In this</span></div>
<div style="position:absolute;left:114.18px;top:436.55px" class="cls_039"><span class="cls_039">chapter, we’re going to revisit some of the controllers you wrote in chapter 6 to take</span></div>
<div style="position:absolute;left:114.18px;top:449.54px" class="cls_039"><span class="cls_039">advantage of Spring 5’s reactive programming model.</span></div>
<div style="position:absolute;left:130.41px;top:462.56px" class="cls_039"><span class="cls_039">More specifically, we’re going to take a look at Spring 5’s new reactive web</span></div>
<div style="position:absolute;left:114.18px;top:475.55px" class="cls_039"><span class="cls_039">framework—Spring WebFlux. As you’ll quickly discover, Spring WebFlux is remark-</span></div>
<div style="position:absolute;left:114.18px;top:488.54px" class="cls_039"><span class="cls_039">ably similar to Spring MVC, making it easy to apply, along with what you already</span></div>
<div style="position:absolute;left:114.18px;top:501.56px" class="cls_039"><span class="cls_039">know about building REST APIs in Spring.</span></div>
<div style="position:absolute;left:78.18px;top:522.70px" class="cls_040"><span class="cls_040">11.1</span></div>
<div style="position:absolute;left:114.18px;top:522.70px" class="cls_040"><span class="cls_040">Working with Spring WebFlux</span></div>
<div style="position:absolute;left:114.18px;top:540.56px" class="cls_039"><span class="cls_039">Typical Servlet-based web frameworks, such as Spring MVC, are blocking and multi-</span></div>
<div style="position:absolute;left:114.18px;top:553.55px" class="cls_039"><span class="cls_039">threaded in nature, using a single thread per connection. As requests are handled,</span></div>
<div style="position:absolute;left:269.16px;top:596.99px" class="cls_048"><span class="cls_048">269</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:192656px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background292.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">270</span></div>
<div style="position:absolute;left:192.03px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 11</span></div>
<div style="position:absolute;left:240.99px;top:24.35px" class="cls_055"><span class="cls_055">Developing reactive APIs</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">a worker thread is pulled from a thread pool to process the request. Meanwhile, the</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">request thread is blocked until it’s notified by the worker thread that it’s finished.</span></div>
<div style="position:absolute;left:111.16px;top:76.67px" class="cls_039"><span class="cls_039">Consequently, blocking web frameworks won’t scale effectively under heavy</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">request volume. Latency in slow worker threads makes things even worse because it’ll</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">take longer for the worker thread to be returned to the pool, ready to handle another</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">request. In some use cases, this arrangement is perfectly acceptable. In fact, this is</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">largely how most web applications have been developed for well over a decade. But</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">times are changing.</span></div>
<div style="position:absolute;left:107.65px;top:154.67px" class="cls_039"><span class="cls_039">The clients of those web applications have grown from people occasionally viewing</span></div>
<div style="position:absolute;left:93.18px;top:167.66px" class="cls_039"><span class="cls_039">websites to people frequently consuming content and using applications that coordi-</span></div>
<div style="position:absolute;left:93.18px;top:180.65px" class="cls_039"><span class="cls_039">nate with HTTP APIs. And these days, the so-called </span><span class="cls_036">Internet of Things</span><span class="cls_039"> (where humans</span></div>
<div style="position:absolute;left:93.18px;top:193.67px" class="cls_039"><span class="cls_039">aren’t even involved) yields cars, jet engines, and other non-traditional clients constantly</span></div>
<div style="position:absolute;left:93.18px;top:206.66px" class="cls_039"><span class="cls_039">exchanging data with web APIs. With an increasing number of clients consuming web</span></div>
<div style="position:absolute;left:93.18px;top:219.65px" class="cls_039"><span class="cls_039">applications, scalability is more important than ever.</span></div>
<div style="position:absolute;left:108.85px;top:232.67px" class="cls_039"><span class="cls_039">Asynchronous web frameworks, in contrast, achieve higher scalability with fewer</span></div>
<div style="position:absolute;left:93.18px;top:245.66px" class="cls_039"><span class="cls_039">threads—generally one per CPU core. By applying a technique known as </span><span class="cls_036">event looping</span></div>
<div style="position:absolute;left:93.18px;top:258.65px" class="cls_039"><span class="cls_039">(as illustrated in figure 11.1), these frameworks are able to handle many requests per</span></div>
<div style="position:absolute;left:93.18px;top:271.67px" class="cls_039"><span class="cls_039">thread, making the per-connection cost more economical.</span></div>
<div style="position:absolute;left:291.37px;top:299.00px" class="cls_056"><span class="cls_056">CPU core</span></div>
<div style="position:absolute;left:297.70px;top:312.53px" class="cls_094"><span class="cls_094">Thread</span></div>
<div style="position:absolute;left:349.62px;top:330.91px" class="cls_057"><span class="cls_057">Register</span></div>
<div style="position:absolute;left:223.70px;top:329.31px" class="cls_057"><span class="cls_057">Push request</span></div>
<div style="position:absolute;left:103.03px;top:334.59px" class="cls_057"><span class="cls_057">Client</span></div>
<div style="position:absolute;left:235.95px;top:338.31px" class="cls_057"><span class="cls_057">event</span></div>
<div style="position:absolute;left:350.08px;top:339.91px" class="cls_057"><span class="cls_057">callback</span></div>
<div style="position:absolute;left:395.53px;top:337.11px" class="cls_057"><span class="cls_057">Intensive</span></div>
<div style="position:absolute;left:394.89px;top:346.11px" class="cls_057"><span class="cls_057">operation</span></div>
<div style="position:absolute;left:140.27px;top:361.07px" class="cls_057"><span class="cls_057">Request</span></div>
<div style="position:absolute;left:194.75px;top:361.84px" class="cls_057"><span class="cls_057">Request</span></div>
<div style="position:absolute;left:287.32px;top:363.93px" class="cls_094"><span class="cls_094">Event loop</span></div>
<div style="position:absolute;left:103.03px;top:366.34px" class="cls_057"><span class="cls_057">Client</span></div>
<div style="position:absolute;left:395.62px;top:364.11px" class="cls_057"><span class="cls_057">Network,</span></div>
<div style="position:absolute;left:196.11px;top:370.84px" class="cls_057"><span class="cls_057">handler</span></div>
<div style="position:absolute;left:394.13px;top:373.11px" class="cls_057"><span class="cls_057">database,</span></div>
<div style="position:absolute;left:391.95px;top:382.11px" class="cls_057"><span class="cls_057">file system,</span></div>
<div style="position:absolute;left:391.94px;top:391.11px" class="cls_057"><span class="cls_057">calculation,</span></div>
<div style="position:absolute;left:103.03px;top:398.09px" class="cls_057"><span class="cls_057">Client</span></div>
<div style="position:absolute;left:233.61px;top:398.82px" class="cls_057"><span class="cls_057">Trigger</span></div>
<div style="position:absolute;left:339.19px;top:398.09px" class="cls_057"><span class="cls_057">Push operation</span></div>
<div style="position:absolute;left:404.78px;top:400.11px" class="cls_057"><span class="cls_057">etc</span></div>
<div style="position:absolute;left:231.75px;top:407.82px" class="cls_057"><span class="cls_057">callback</span></div>
<div style="position:absolute;left:339.16px;top:407.09px" class="cls_057"><span class="cls_057">complete event</span></div>
<div style="position:absolute;left:93.66px;top:453.86px" class="cls_053"><span class="cls_053">Figure 11.1</span></div>
<div style="position:absolute;left:143.10px;top:453.86px" class="cls_053"><span class="cls_053">Asynchronous web frameworks apply event looping to handle more requests with</span></div>
<div style="position:absolute;left:93.66px;top:463.85px" class="cls_053"><span class="cls_053">fewer threads.</span></div>
<div style="position:absolute;left:93.18px;top:500.18px" class="cls_039"><span class="cls_039">In an event loop, everything is handled as an event, including requests and callbacks</span></div>
<div style="position:absolute;left:93.18px;top:513.17px" class="cls_039"><span class="cls_039">from intensive operations like database and network operations. When a costly opera-</span></div>
<div style="position:absolute;left:93.18px;top:526.16px" class="cls_039"><span class="cls_039">tion is needed, the event loop registers a callback for that operation to be performed</span></div>
<div style="position:absolute;left:93.18px;top:539.18px" class="cls_039"><span class="cls_039">in parallel, while it moves on to handle other events.</span></div>
<div style="position:absolute;left:109.01px;top:552.17px" class="cls_039"><span class="cls_039">When the operation is complete, it’s treated as an event by the event loop, the</span></div>
<div style="position:absolute;left:93.18px;top:565.19px" class="cls_039"><span class="cls_039">same as requests. As a result, asynchronous web frameworks are able to scale better</span></div>
<div style="position:absolute;left:93.18px;top:578.18px" class="cls_039"><span class="cls_039">under heavy request volume with fewer threads, resulting in reduced overhead for</span></div>
<div style="position:absolute;left:93.18px;top:591.17px" class="cls_039"><span class="cls_039">thread management.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:193332px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background293.jpg" width="531" height="666"></div>
<div style="position:absolute;left:216.15px;top:24.35px" class="cls_055"><span class="cls_055">Working with Spring WebFlux</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">271</span></div>
<div style="position:absolute;left:118.17px;top:50.66px" class="cls_039"><span class="cls_039">Spring 5 has introduced a non-blocking, asynchronous web framework based</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">largely on its Project Reactor to address the need for greater scalability in web</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">applications and APIs. Let’s take a look at Spring WebFlux—a reactive web frame-</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">work for Spring.</span></div>
<div style="position:absolute;left:66.18px;top:111.47px" class="cls_063"><span class="cls_063">11.1.1</span></div>
<div style="position:absolute;left:102.18px;top:111.47px" class="cls_063"><span class="cls_063">Introducing Spring WebFlux</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">As the Spring team was considering how to add a reactive programming model to</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">the web layer, it quickly became apparent that it would be difficult to do so without a</span></div>
<div style="position:absolute;left:102.18px;top:154.67px" class="cls_039"><span class="cls_039">great deal of work in Spring MVC. That would involve branching code to decide</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">whether to handle requests reactively or not. In essence, the result would be two web</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">frameworks packaged as one, with </span><span class="cls_059">if</span><span class="cls_039"> statements to separate the reactive from the</span></div>
<div style="position:absolute;left:102.18px;top:193.67px" class="cls_039"><span class="cls_039">non-reactive.</span></div>
<div style="position:absolute;left:117.21px;top:206.66px" class="cls_039"><span class="cls_039">Instead of trying to shoehorn a reactive programming model into Spring MVC, it</span></div>
<div style="position:absolute;left:102.18px;top:219.65px" class="cls_039"><span class="cls_039">was decided to create a separate reactive web framework, borrowing as much from</span></div>
<div style="position:absolute;left:102.18px;top:232.67px" class="cls_039"><span class="cls_039">Spring MVC as possible. Spring WebFlux is the result. Figure 11.2 illustrates the com-</span></div>
<div style="position:absolute;left:102.18px;top:245.66px" class="cls_039"><span class="cls_039">plete web development stack defined by Spring 5.</span></div>
<div style="position:absolute;left:110.20px;top:278.52px" class="cls_057"><span class="cls_057">@Controller, @RequestMapping, etc</span></div>
<div style="position:absolute;left:242.17px;top:278.72px" class="cls_057"><span class="cls_057">Router functions</span></div>
<div style="position:absolute;left:114.91px;top:308.72px" class="cls_057"><span class="cls_057">Spring MVC</span></div>
<div style="position:absolute;left:209.61px;top:308.72px" class="cls_057"><span class="cls_057">Spring WebFlux</span></div>
<div style="position:absolute;left:116.21px;top:338.92px" class="cls_057"><span class="cls_057">Servlet API</span></div>
<div style="position:absolute;left:210.68px;top:338.92px" class="cls_057"><span class="cls_057">Reactive HTTP</span></div>
<div style="position:absolute;left:310.68px;top:346.34px" class="cls_053"><span class="cls_053">Figure 11.2</span></div>
<div style="position:absolute;left:359.94px;top:346.34px" class="cls_053"><span class="cls_053">Spring 5 supports reactive web</span></div>
<div style="position:absolute;left:310.68px;top:356.33px" class="cls_053"><span class="cls_053">applications with a new web framework called</span></div>
<div style="position:absolute;left:192.28px;top:364.63px" class="cls_057"><span class="cls_057">Tomcat, Jetty, Servlet 3.1+,</span></div>
<div style="position:absolute;left:106.64px;top:369.13px" class="cls_057"><span class="cls_057">Servlet Container</span></div>
<div style="position:absolute;left:310.68px;top:366.35px" class="cls_053"><span class="cls_053">WebFlux, which is a sibling to Spring MVC and</span></div>
<div style="position:absolute;left:209.49px;top:373.63px" class="cls_057"><span class="cls_057">Netty, Undertow</span></div>
<div style="position:absolute;left:310.68px;top:376.34px" class="cls_053"><span class="cls_053">shares many of its core components.</span></div>
<div style="position:absolute;left:102.18px;top:407.66px" class="cls_039"><span class="cls_039">On the left side of figure 11.2, you see the Spring MVC stack that was introduced in</span></div>
<div style="position:absolute;left:102.18px;top:420.68px" class="cls_039"><span class="cls_039">version 2.5 of the Spring Framework. Spring MVC (covered in chapters 2 and 6) sits</span></div>
<div style="position:absolute;left:102.18px;top:433.67px" class="cls_039"><span class="cls_039">atop the Java Servlet API, which requires a servlet container (such as Tomcat) to exe-</span></div>
<div style="position:absolute;left:102.18px;top:446.66px" class="cls_039"><span class="cls_039">cute on.</span></div>
<div style="position:absolute;left:117.90px;top:459.68px" class="cls_039"><span class="cls_039">By contrast, Spring WebFlux (on the right side) doesn’t have ties to the Servlet</span></div>
<div style="position:absolute;left:102.18px;top:472.67px" class="cls_039"><span class="cls_039">API, so it builds on top of a Reactive HTTP API, which is a reactive approximation of</span></div>
<div style="position:absolute;left:102.18px;top:485.66px" class="cls_039"><span class="cls_039">the same functionality provided by the Servlet API. And because Spring WebFlux isn’t</span></div>
<div style="position:absolute;left:102.18px;top:498.68px" class="cls_039"><span class="cls_039">coupled to the Servlet API, it doesn’t require a servlet container to run on. Instead, it</span></div>
<div style="position:absolute;left:102.18px;top:511.67px" class="cls_039"><span class="cls_039">can run on any non-blocking web container including Netty, Undertow, Tomcat, Jetty,</span></div>
<div style="position:absolute;left:102.18px;top:524.66px" class="cls_039"><span class="cls_039">or any Servlet 3.1 or higher container.</span></div>
<div style="position:absolute;left:116.86px;top:537.68px" class="cls_039"><span class="cls_039">What’s most noteworthy about figure 11.2 is the top left box, which represents the</span></div>
<div style="position:absolute;left:102.18px;top:550.67px" class="cls_039"><span class="cls_039">components that are common between Spring MVC and Spring WebFlux, primarily</span></div>
<div style="position:absolute;left:102.18px;top:563.69px" class="cls_039"><span class="cls_039">the annotations used to define controllers. Because Spring MVC and Spring WebFlux</span></div>
<div style="position:absolute;left:102.18px;top:576.68px" class="cls_039"><span class="cls_039">share the same annotations, Spring WebFlux is, in many ways, indistinguishable from</span></div>
<div style="position:absolute;left:102.18px;top:589.67px" class="cls_039"><span class="cls_039">Spring MVC.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:194008px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background294.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">272</span></div>
<div style="position:absolute;left:192.03px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 11</span></div>
<div style="position:absolute;left:240.99px;top:24.35px" class="cls_055"><span class="cls_055">Developing reactive APIs</span></div>
<div style="position:absolute;left:108.37px;top:50.66px" class="cls_039"><span class="cls_039">The box in the top right corner represents an alternative programming model</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">that defines controllers with a functional programming paradigm instead of using</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">annotations. We’ll talk more about Spring’s functional web programming model in</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">section 11.2.</span></div>
<div style="position:absolute;left:108.82px;top:102.65px" class="cls_039"><span class="cls_039">The most significant difference between Spring MVC and Spring WebFlux boils</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">down to which dependency you add to your build. When working with Spring Web-</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">Flux, you’ll need to add the Spring Boot WebFlux starter dependency instead of the stan-</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">dard web starter (for example, </span><span class="cls_059">spring-boot-starter-web</span><span class="cls_039">). In the project’s pom.xml</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_039"><span class="cls_039">file, it looks like this:</span></div>
<div style="position:absolute;left:93.18px;top:173.33px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:183.35px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:193.34px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-boot-starter-webflux&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:93.18px;top:203.33px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:105.18px;top:222.65px" class="cls_083"><span class="cls_083">NOTE</span><span class="cls_039">  As with most of Spring Boot’s starter dependencies, this starter can also</span></div>
<div style="position:absolute;left:105.18px;top:234.65px" class="cls_039"><span class="cls_039">be added to a project by checking the Reactive Web checkbox in the Initializr.</span></div>
<div style="position:absolute;left:93.18px;top:252.65px" class="cls_039"><span class="cls_039">An interesting side-effect of using WebFlux instead of Spring MVC is that the default</span></div>
<div style="position:absolute;left:93.18px;top:265.67px" class="cls_039"><span class="cls_039">embedded server for WebFlux is Netty instead of Tomcat. Netty is one of a handful of</span></div>
<div style="position:absolute;left:93.18px;top:278.66px" class="cls_039"><span class="cls_039">asynchronous, event-driven servers and is a natural fit for a reactive web framework</span></div>
<div style="position:absolute;left:93.18px;top:291.68px" class="cls_039"><span class="cls_039">like Spring WebFlux.</span></div>
<div style="position:absolute;left:107.76px;top:304.67px" class="cls_039"><span class="cls_039">Aside from using a different starter dependency, Spring WebFlux controller meth-</span></div>
<div style="position:absolute;left:93.18px;top:317.66px" class="cls_039"><span class="cls_039">ods usually accept and return reactive types, like </span><span class="cls_059">Mono</span><span class="cls_039"> and </span><span class="cls_059">Flux</span><span class="cls_039">, instead of domain</span></div>
<div style="position:absolute;left:93.18px;top:330.68px" class="cls_039"><span class="cls_039">types and collections. Spring WebFlux controllers can also deal with RxJava types like</span></div>
<div style="position:absolute;left:93.18px;top:343.67px" class="cls_059"><span class="cls_059">Observable</span><span class="cls_039">, </span><span class="cls_059">Single</span><span class="cls_039">, and </span><span class="cls_059">Completable</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:93.18px;top:361.85px" class="cls_064"><span class="cls_064">R</span><span class="cls_065">EACTIVE</span><span class="cls_064"> S</span><span class="cls_065">PRING</span><span class="cls_064"> MVC?</span></div>
<div style="position:absolute;left:93.18px;top:374.18px" class="cls_039"><span class="cls_039">Although Spring WebFlux controllers typically return </span><span class="cls_059">Mono</span><span class="cls_039"> and </span><span class="cls_059">Flux</span><span class="cls_039">, that doesn’t</span></div>
<div style="position:absolute;left:93.18px;top:387.17px" class="cls_039"><span class="cls_039">mean that Spring MVC doesn’t get to have some fun with reactive types. Spring MVC</span></div>
<div style="position:absolute;left:93.18px;top:400.16px" class="cls_039"><span class="cls_039">controller methods can also return a </span><span class="cls_059">Mono</span><span class="cls_039"> or </span><span class="cls_059">Flux</span><span class="cls_039">, if you’d like.</span></div>
<div style="position:absolute;left:108.27px;top:413.18px" class="cls_039"><span class="cls_039">The difference is in how those types are used. Whereas Spring WebFlux is a truly</span></div>
<div style="position:absolute;left:93.18px;top:426.17px" class="cls_039"><span class="cls_039">reactive web framework, allowing for requests to be handled in an event loop, Spring</span></div>
<div style="position:absolute;left:93.18px;top:439.16px" class="cls_039"><span class="cls_039">MVC is Servlet-based, relying on multithreading to handle multiple requests.</span></div>
<div style="position:absolute;left:108.07px;top:452.18px" class="cls_039"><span class="cls_039">Let’s put Spring WebFlux to work by rewriting some of Taco Cloud’s API control-</span></div>
<div style="position:absolute;left:93.18px;top:465.17px" class="cls_039"><span class="cls_039">lers to take advantage of Spring WebFlux.</span></div>
<div style="position:absolute;left:57.18px;top:485.99px" class="cls_063"><span class="cls_063">11.1.2</span></div>
<div style="position:absolute;left:93.18px;top:485.99px" class="cls_063"><span class="cls_063">Writing reactive controllers</span></div>
<div style="position:absolute;left:93.18px;top:503.18px" class="cls_039"><span class="cls_039">You may recall that in chapter 6, you created a few controllers for Taco Cloud’s REST</span></div>
<div style="position:absolute;left:93.18px;top:516.17px" class="cls_039"><span class="cls_039">API. Those controllers had request-handling methods that dealt with input and out-</span></div>
<div style="position:absolute;left:93.18px;top:529.16px" class="cls_039"><span class="cls_039">put in terms of domain types (such as </span><span class="cls_059">Order</span><span class="cls_039"> and </span><span class="cls_059">Taco</span><span class="cls_039">) or collections of those domain</span></div>
<div style="position:absolute;left:93.18px;top:542.18px" class="cls_039"><span class="cls_039">types. As a reminder, consider the following snippet from </span><span class="cls_059">DesignTacoController</span><span class="cls_039"> that</span></div>
<div style="position:absolute;left:93.18px;top:555.17px" class="cls_039"><span class="cls_039">you wrote back in chapter 6:</span></div>
<div style="position:absolute;left:93.18px;top:574.85px" class="cls_060"><span class="cls_060">@RestController</span></div>
<div style="position:absolute;left:93.18px;top:584.84px" class="cls_060"><span class="cls_060">@RequestMapping(path="/design",</span></div>
<div style="position:absolute;left:169.95px;top:594.86px" class="cls_060"><span class="cls_060">produces="application/json")</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:194684px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background295.jpg" width="531" height="666"></div>
<div style="position:absolute;left:216.15px;top:24.35px" class="cls_055"><span class="cls_055">Working with Spring WebFlux</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">273</span></div>
<div style="position:absolute;left:102.18px;top:51.32px" class="cls_060"><span class="cls_060">@CrossOrigin(origins="*")</span></div>
<div style="position:absolute;left:102.18px;top:61.34px" class="cls_060"><span class="cls_060">public class DesignTacoController {</span></div>
<div style="position:absolute;left:111.78px;top:107.33px" class="cls_060"><span class="cls_060">@GetMapping("/recent")</span></div>
<div style="position:absolute;left:111.78px;top:117.32px" class="cls_060"><span class="cls_060">public Iterable&lt;Taco&gt; recentTacos() {</span></div>
<div style="position:absolute;left:121.38px;top:127.34px" class="cls_060"><span class="cls_060">PageRequest page = PageRequest.of(</span></div>
<div style="position:absolute;left:159.76px;top:137.33px" class="cls_060"><span class="cls_060">0, 12, Sort.by("createdAt").descending());</span></div>
<div style="position:absolute;left:121.38px;top:147.35px" class="cls_060"><span class="cls_060">return tacoRepo.findAll(page).getContent();</span></div>
<div style="position:absolute;left:111.78px;top:157.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:200.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:224.66px" class="cls_039"><span class="cls_039">As written, the </span><span class="cls_059">recentTacos()</span><span class="cls_039"> controller handles HTTP GET requests for /design/</span></div>
<div style="position:absolute;left:102.18px;top:237.65px" class="cls_039"><span class="cls_039">recent to return a list of recently created tacos. More specifically, it returns an </span><span class="cls_059">Iterable</span></div>
<div style="position:absolute;left:102.18px;top:250.67px" class="cls_039"><span class="cls_039">of type </span><span class="cls_059">Taco</span><span class="cls_039">. That’s primarily because that’s what’s returned from the repository’s</span></div>
<div style="position:absolute;left:102.18px;top:263.66px" class="cls_059"><span class="cls_059">findAll()</span><span class="cls_039"> method, or, more accurately, from the </span><span class="cls_059">getContent()</span><span class="cls_039"> method on the </span><span class="cls_059">Page</span></div>
<div style="position:absolute;left:102.18px;top:276.65px" class="cls_039"><span class="cls_039">object returned from </span><span class="cls_059">findAll()</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.00px;top:289.67px" class="cls_039"><span class="cls_039">That works fine, but </span><span class="cls_059">Iterable</span><span class="cls_039"> isn’t a reactive type. You won’t be able to apply any</span></div>
<div style="position:absolute;left:102.18px;top:302.66px" class="cls_039"><span class="cls_039">reactive operations on it, nor can you let the framework take advantage of it as a reac-</span></div>
<div style="position:absolute;left:102.18px;top:315.68px" class="cls_039"><span class="cls_039">tive type to split any work over multiple threads. What you’d like is for </span><span class="cls_059">recentTacos()</span></div>
<div style="position:absolute;left:102.18px;top:328.67px" class="cls_039"><span class="cls_039">to return a </span><span class="cls_059">Flux&lt;Taco&gt;</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:116.57px;top:341.66px" class="cls_039"><span class="cls_039">A simple, but somewhat limited option here is to rewrite </span><span class="cls_059">recentTacos()</span><span class="cls_039"> to convert</span></div>
<div style="position:absolute;left:102.18px;top:354.68px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">Iterable</span><span class="cls_039"> to a </span><span class="cls_059">Flux</span><span class="cls_039">. And, while you’re at it, you can do away with the paging code</span></div>
<div style="position:absolute;left:102.18px;top:367.67px" class="cls_039"><span class="cls_039">and replace it with a call to </span><span class="cls_059">take()</span><span class="cls_039"> on the </span><span class="cls_059">Flux</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:102.18px;top:391.34px" class="cls_060"><span class="cls_060">@GetMapping("/recent")</span></div>
<div style="position:absolute;left:102.18px;top:401.36px" class="cls_060"><span class="cls_060">public Flux&lt;Taco&gt; recentTacos() {</span></div>
<div style="position:absolute;left:111.78px;top:411.35px" class="cls_060"><span class="cls_060">return Flux.fromIterable(tacoRepo.findAll()).take(12);</span></div>
<div style="position:absolute;left:102.18px;top:421.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:445.67px" class="cls_039"><span class="cls_039">Using </span><span class="cls_059">Flux.fromIterable()</span><span class="cls_039">, you convert the </span><span class="cls_059">Iterable&lt;Taco&gt;</span><span class="cls_039"> to a </span><span class="cls_059">Flux&lt;Taco&gt;</span><span class="cls_039">. And</span></div>
<div style="position:absolute;left:102.18px;top:458.66px" class="cls_039"><span class="cls_039">now that you’re working with a </span><span class="cls_059">Flux</span><span class="cls_039">, you can use the </span><span class="cls_059">take()</span><span class="cls_039"> operation to limit the</span></div>
<div style="position:absolute;left:102.18px;top:471.68px" class="cls_039"><span class="cls_039">returned </span><span class="cls_059">Flux</span><span class="cls_039"> to 12 </span><span class="cls_059">Taco</span><span class="cls_039"> objects at most. Not only is the code simpler, it also deals</span></div>
<div style="position:absolute;left:102.18px;top:484.67px" class="cls_039"><span class="cls_039">with a reactive </span><span class="cls_059">Flux</span><span class="cls_039"> rather than a plain </span><span class="cls_059">Iterable</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:116.99px;top:497.66px" class="cls_039"><span class="cls_039">Writing reactive code has been a winning move so far. But it would be even bet-</span></div>
<div style="position:absolute;left:102.18px;top:510.68px" class="cls_039"><span class="cls_039">ter if the repository gave you a </span><span class="cls_059">Flux</span><span class="cls_039"> to start with so that you wouldn’t need to do</span></div>
<div style="position:absolute;left:102.18px;top:523.67px" class="cls_039"><span class="cls_039">the conversion. If that were the case, then </span><span class="cls_059">recentTacos()</span><span class="cls_039"> could be written to look</span></div>
<div style="position:absolute;left:102.18px;top:536.66px" class="cls_039"><span class="cls_039">like this:</span></div>
<div style="position:absolute;left:102.18px;top:560.36px" class="cls_060"><span class="cls_060">@GetMapping("/recent")</span></div>
<div style="position:absolute;left:102.18px;top:570.35px" class="cls_060"><span class="cls_060">public Flux&lt;Taco&gt; recentTacos() {</span></div>
<div style="position:absolute;left:111.78px;top:580.34px" class="cls_060"><span class="cls_060">return tacoRepo.findAll().take(12);</span></div>
<div style="position:absolute;left:102.18px;top:590.36px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:195360px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background296.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">274</span></div>
<div style="position:absolute;left:192.03px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 11</span></div>
<div style="position:absolute;left:240.99px;top:24.35px" class="cls_055"><span class="cls_055">Developing reactive APIs</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">That’s even better! Ideally, a reactive controller will be the tip of a stack that’s reactive</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">end to end, including controllers, repositories, the database, and any services that may</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">sit in between. Such an end-to-end reactive stack is illustrated in figure 11.3.</span></div>
<div style="position:absolute;left:118.52px;top:108.12px" class="cls_057"><span class="cls_057">Client</span></div>
<div style="position:absolute;left:96.45px;top:132.32px" class="cls_057"><span class="cls_057">Request/</span></div>
<div style="position:absolute;left:92.95px;top:141.32px" class="cls_057"><span class="cls_057">Response</span></div>
<div style="position:absolute;left:113.71px;top:160.55px" class="cls_057"><span class="cls_057">WebFlux</span></div>
<div style="position:absolute;left:153.75px;top:159.78px" class="cls_057"><span class="cls_057">Flux/Mono</span></div>
<div style="position:absolute;left:200.83px;top:160.55px" class="cls_057"><span class="cls_057">Service</span></div>
<div style="position:absolute;left:239.18px;top:159.78px" class="cls_057"><span class="cls_057">Flux/Mono</span></div>
<div style="position:absolute;left:281.35px;top:165.05px" class="cls_057"><span class="cls_057">Repository</span></div>
<div style="position:absolute;left:112.25px;top:169.55px" class="cls_057"><span class="cls_057">Controller</span></div>
<div style="position:absolute;left:198.02px;top:169.55px" class="cls_057"><span class="cls_057">(optional)</span></div>
<div style="position:absolute;left:301.18px;top:188.98px" class="cls_057"><span class="cls_057">Data</span></div>
<div style="position:absolute;left:301.18px;top:197.98px" class="cls_057"><span class="cls_057">stream</span></div>
<div style="position:absolute;left:331.17px;top:232.85px" class="cls_053"><span class="cls_053">Figure 11.3</span></div>
<div style="position:absolute;left:380.61px;top:232.85px" class="cls_053"><span class="cls_053">To maximize the</span></div>
<div style="position:absolute;left:331.17px;top:242.84px" class="cls_053"><span class="cls_053">benefit of a reactive web framework,</span></div>
<div style="position:absolute;left:331.17px;top:252.83px" class="cls_053"><span class="cls_053">it should be part of a full end-to-end</span></div>
<div style="position:absolute;left:283.45px;top:264.57px" class="cls_095"><span class="cls_095">Database</span></div>
<div style="position:absolute;left:331.17px;top:262.85px" class="cls_053"><span class="cls_053">reactive stack.</span></div>
<div style="position:absolute;left:93.18px;top:291.17px" class="cls_039"><span class="cls_039">Such an end-to-end stack requires that the repository be written to return a </span><span class="cls_059">Flux</span></div>
<div style="position:absolute;left:93.18px;top:304.16px" class="cls_039"><span class="cls_039">instead of an </span><span class="cls_059">Iterable</span><span class="cls_039">. We’ll look into writing reactive repositories in the next chap-</span></div>
<div style="position:absolute;left:93.18px;top:317.18px" class="cls_039"><span class="cls_039">ter, but here’s a sneak peek at what a reactive </span><span class="cls_059">TacoRepository</span><span class="cls_039"> might look like:</span></div>
<div style="position:absolute;left:93.18px;top:336.86px" class="cls_060"><span class="cls_060">public interface TacoRepository</span></div>
<div style="position:absolute;left:136.33px;top:346.85px" class="cls_060"><span class="cls_060">extends ReactiveCrudRepository&lt;Taco, Long&gt; {</span></div>
<div style="position:absolute;left:93.18px;top:356.84px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:378.17px" class="cls_039"><span class="cls_039">What’s most important to note at this point, however, is that aside from working with a</span></div>
<div style="position:absolute;left:93.18px;top:391.16px" class="cls_059"><span class="cls_059">Flux</span><span class="cls_039"> instead of an </span><span class="cls_059">Iterable</span><span class="cls_039">, as well as how you obtain that </span><span class="cls_059">Flux</span><span class="cls_039">, the programming</span></div>
<div style="position:absolute;left:93.18px;top:404.18px" class="cls_039"><span class="cls_039">model for defining a reactive WebFlux controller is no different than for a non-reactive</span></div>
<div style="position:absolute;left:93.18px;top:417.17px" class="cls_039"><span class="cls_039">Spring MVC controller. Both are annotated with </span><span class="cls_059">@RestController</span><span class="cls_039"> and a high-level</span></div>
<div style="position:absolute;left:93.18px;top:430.16px" class="cls_059"><span class="cls_059">@RequestMapping</span><span class="cls_039"> at the class level. And both have request-handling functions that are</span></div>
<div style="position:absolute;left:93.18px;top:443.18px" class="cls_039"><span class="cls_039">annotated with </span><span class="cls_059">@GetMapping</span><span class="cls_039"> at the method level. It’s truly a matter of what type the</span></div>
<div style="position:absolute;left:93.18px;top:456.17px" class="cls_039"><span class="cls_039">handler methods return.</span></div>
<div style="position:absolute;left:107.85px;top:469.19px" class="cls_039"><span class="cls_039">Another important observation to make is that although you’re getting a </span><span class="cls_059">Flux&lt;Taco&gt;</span></div>
<div style="position:absolute;left:93.18px;top:482.18px" class="cls_039"><span class="cls_039">back from the repository, you can return it without calling </span><span class="cls_059">subscribe()</span><span class="cls_039">. Indeed, the</span></div>
<div style="position:absolute;left:93.18px;top:495.17px" class="cls_039"><span class="cls_039">framework will call </span><span class="cls_059">subscribe()</span><span class="cls_039"> for you. This means that when a request for /design/</span></div>
<div style="position:absolute;left:93.18px;top:508.19px" class="cls_039"><span class="cls_039">recent is handled, the </span><span class="cls_059">recentTacos()</span><span class="cls_039"> method will be called and will return before the</span></div>
<div style="position:absolute;left:93.18px;top:521.18px" class="cls_039"><span class="cls_039">data is even fetched from the database!</span></div>
<div style="position:absolute;left:93.18px;top:539.36px" class="cls_064"><span class="cls_064">R</span><span class="cls_065">ETURNING</span><span class="cls_064"> </span><span class="cls_065">SINGLE</span><span class="cls_064"> </span><span class="cls_065">VALUES</span></div>
<div style="position:absolute;left:93.18px;top:551.69px" class="cls_039"><span class="cls_039">As another example, consider the </span><span class="cls_059">tacoById()</span><span class="cls_039"> method from the </span><span class="cls_059">DesignTacoController</span></div>
<div style="position:absolute;left:93.18px;top:564.68px" class="cls_039"><span class="cls_039">as it was written in chapter 6:</span></div>
<div style="position:absolute;left:93.18px;top:584.36px" class="cls_060"><span class="cls_060">@GetMapping("/{id}")</span></div>
<div style="position:absolute;left:93.18px;top:594.35px" class="cls_060"><span class="cls_060">public Taco tacoById(@PathVariable("id") Long id) {</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:196036px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background297.jpg" width="531" height="666"></div>
<div style="position:absolute;left:216.15px;top:24.35px" class="cls_055"><span class="cls_055">Working with Spring WebFlux</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">275</span></div>
<div style="position:absolute;left:111.78px;top:51.32px" class="cls_060"><span class="cls_060">Optional&lt;Taco&gt; optTaco = tacoRepo.findById(id);</span></div>
<div style="position:absolute;left:111.77px;top:61.34px" class="cls_060"><span class="cls_060">if (optTaco.isPresent()) {</span></div>
<div style="position:absolute;left:121.38px;top:71.33px" class="cls_060"><span class="cls_060">return optTaco.get();</span></div>
<div style="position:absolute;left:111.78px;top:81.32px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:91.34px" class="cls_060"><span class="cls_060">return null;</span></div>
<div style="position:absolute;left:102.18px;top:101.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:122.66px" class="cls_039"><span class="cls_039">Here, this method handles GET requests for /design/</span><span class="cls_036">{id}</span><span class="cls_039"> and returns a single </span><span class="cls_059">Taco</span></div>
<div style="position:absolute;left:102.18px;top:135.65px" class="cls_039"><span class="cls_039">object. Because the repository’s </span><span class="cls_059">findById()</span><span class="cls_039"> returns an </span><span class="cls_059">Optional</span><span class="cls_039">, you also had to</span></div>
<div style="position:absolute;left:102.18px;top:148.67px" class="cls_039"><span class="cls_039">write some clunky code to deal with that. But suppose for a minute that the </span><span class="cls_059">find-</span></div>
<div style="position:absolute;left:102.18px;top:161.66px" class="cls_059"><span class="cls_059">ById()</span><span class="cls_039"> returns a </span><span class="cls_059">Mono&lt;Taco&gt;</span><span class="cls_039"> instead of an </span><span class="cls_059">Optional&lt;Taco&gt;</span><span class="cls_039">. In that case, you can</span></div>
<div style="position:absolute;left:102.18px;top:174.65px" class="cls_039"><span class="cls_039">rewrite the controller’s </span><span class="cls_059">tacoById()</span><span class="cls_039"> to look like this:</span></div>
<div style="position:absolute;left:102.18px;top:194.33px" class="cls_060"><span class="cls_060">@GetMapping("/{id}")</span></div>
<div style="position:absolute;left:102.18px;top:204.35px" class="cls_060"><span class="cls_060">public Mono&lt;Taco&gt; tacoById(@PathVariable("id") Long id) {</span></div>
<div style="position:absolute;left:111.78px;top:214.34px" class="cls_060"><span class="cls_060">return tacoRepo.findById(id);</span></div>
<div style="position:absolute;left:102.18px;top:224.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:245.66px" class="cls_039"><span class="cls_039">Wow! That’s a lot simpler. What’s more important, however, is that by returning a</span></div>
<div style="position:absolute;left:102.18px;top:258.65px" class="cls_059"><span class="cls_059">Mono&lt;Taco&gt;</span><span class="cls_039"> instead of a </span><span class="cls_059">Taco</span><span class="cls_039">, you’re enabling Spring WebFlux to handle the</span></div>
<div style="position:absolute;left:102.18px;top:271.67px" class="cls_039"><span class="cls_039">response in a reactive manner. Consequently, your API will scale better in response</span></div>
<div style="position:absolute;left:102.18px;top:284.66px" class="cls_039"><span class="cls_039">to heavy loads.</span></div>
<div style="position:absolute;left:102.18px;top:302.84px" class="cls_064"><span class="cls_064">W</span><span class="cls_065">ORKING</span><span class="cls_064"> </span><span class="cls_065">WITH</span><span class="cls_064"> R</span><span class="cls_065">X</span><span class="cls_064">J</span><span class="cls_065">AVA</span><span class="cls_064"> </span><span class="cls_065">TYPES</span></div>
<div style="position:absolute;left:102.18px;top:315.17px" class="cls_039"><span class="cls_039">It’s worth pointing out that although Reactor types like </span><span class="cls_059">Flux</span><span class="cls_039"> and </span><span class="cls_059">Mono</span><span class="cls_039"> are a natural</span></div>
<div style="position:absolute;left:102.18px;top:328.16px" class="cls_039"><span class="cls_039">choice when working with Spring WebFlux, you can also choose to work with RxJava</span></div>
<div style="position:absolute;left:102.18px;top:341.18px" class="cls_039"><span class="cls_039">types like </span><span class="cls_059">Observable</span><span class="cls_039"> and </span><span class="cls_059">Single</span><span class="cls_039">. For example, suppose that there’s a service sitting</span></div>
<div style="position:absolute;left:102.18px;top:354.17px" class="cls_039"><span class="cls_039">between </span><span class="cls_059">DesignTacoController</span><span class="cls_039"> and the backend repository that deals in terms of</span></div>
<div style="position:absolute;left:102.18px;top:367.16px" class="cls_039"><span class="cls_039">RxJava types. In that case, the </span><span class="cls_059">recentTacos()</span><span class="cls_039"> method might be written like this:</span></div>
<div style="position:absolute;left:102.18px;top:386.84px" class="cls_060"><span class="cls_060">@GetMapping("/recent")</span></div>
<div style="position:absolute;left:102.18px;top:396.86px" class="cls_060"><span class="cls_060">public Observable&lt;Taco&gt; recentTacos() {</span></div>
<div style="position:absolute;left:111.78px;top:406.85px" class="cls_060"><span class="cls_060">return tacoService.getRecentTacos();</span></div>
<div style="position:absolute;left:102.18px;top:416.84px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:438.17px" class="cls_039"><span class="cls_039">Similarly, the </span><span class="cls_059">tacoById()</span><span class="cls_039"> method could be written to deal with an RxJava </span><span class="cls_059">Single</span></div>
<div style="position:absolute;left:102.18px;top:451.16px" class="cls_039"><span class="cls_039">rather than a </span><span class="cls_059">Mono</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:102.18px;top:470.84px" class="cls_060"><span class="cls_060">@GetMapping("/{id}")</span></div>
<div style="position:absolute;left:102.18px;top:480.86px" class="cls_060"><span class="cls_060">public Single&lt;Taco&gt; tacoById(@PathVariable("id") Long id) {</span></div>
<div style="position:absolute;left:111.78px;top:490.85px" class="cls_060"><span class="cls_060">return tacoService.lookupTaco(id);</span></div>
<div style="position:absolute;left:102.18px;top:500.84px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:522.17px" class="cls_039"><span class="cls_039">In addition, Spring WebFlux controller methods can also return RxJava’s </span><span class="cls_059">Completable</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:102.18px;top:535.16px" class="cls_039"><span class="cls_039">which is equivalent to a </span><span class="cls_059">Mono&lt;Void&gt;</span><span class="cls_039"> in Reactor. WebFlux can also return a </span><span class="cls_059">Flowable</span><span class="cls_039"> as</span></div>
<div style="position:absolute;left:102.18px;top:548.18px" class="cls_039"><span class="cls_039">an alternative to </span><span class="cls_059">Observable</span><span class="cls_039"> or Reactor’s </span><span class="cls_059">Flux</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:102.18px;top:566.36px" class="cls_064"><span class="cls_064">H</span><span class="cls_065">ANDLING</span><span class="cls_064"> </span><span class="cls_065">INPUT</span><span class="cls_064"> </span><span class="cls_065">REACTIVELY</span></div>
<div style="position:absolute;left:102.18px;top:578.69px" class="cls_039"><span class="cls_039">So far, we’ve only concerned ourselves with what reactive types the controller methods</span></div>
<div style="position:absolute;left:102.18px;top:591.68px" class="cls_039"><span class="cls_039">return. But with Spring WebFlux, you can also accept a </span><span class="cls_059">Mono</span><span class="cls_039"> or a </span><span class="cls_059">Flux</span><span class="cls_039"> as input to a</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:196712px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background298.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">276</span></div>
<div style="position:absolute;left:192.03px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 11</span></div>
<div style="position:absolute;left:240.99px;top:24.35px" class="cls_055"><span class="cls_055">Developing reactive APIs</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">handler method. To demonstrate, consider the original implementation of </span><span class="cls_059">postTaco()</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">from </span><span class="cls_059">DesignTacoController</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:83.33px" class="cls_060"><span class="cls_060">@PostMapping(consumes="application/json")</span></div>
<div style="position:absolute;left:93.18px;top:93.32px" class="cls_060"><span class="cls_060">@ResponseStatus(HttpStatus.CREATED)</span></div>
<div style="position:absolute;left:93.18px;top:103.34px" class="cls_060"><span class="cls_060">public Taco postTaco(@RequestBody Taco taco) {</span></div>
<div style="position:absolute;left:102.78px;top:113.33px" class="cls_060"><span class="cls_060">return tacoRepo.save(taco);</span></div>
<div style="position:absolute;left:93.18px;top:123.32px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:144.65px" class="cls_039"><span class="cls_039">As originally written, </span><span class="cls_059">postTaco()</span><span class="cls_039"> not only returns a simple </span><span class="cls_059">Taco</span><span class="cls_039"> object, but also</span></div>
<div style="position:absolute;left:93.18px;top:157.67px" class="cls_039"><span class="cls_039">accepts a </span><span class="cls_059">Taco</span><span class="cls_039"> object that’s bound to the content in the body of the request. This</span></div>
<div style="position:absolute;left:93.18px;top:170.66px" class="cls_039"><span class="cls_039">means that </span><span class="cls_059">postTaco()</span><span class="cls_039"> can’t be invoked until the request payload has been fully</span></div>
<div style="position:absolute;left:93.18px;top:183.65px" class="cls_039"><span class="cls_039">resolved and used to instantiate a </span><span class="cls_059">Taco</span><span class="cls_039"> object. It also means </span><span class="cls_059">postTaco()</span><span class="cls_039"> can’t return</span></div>
<div style="position:absolute;left:93.18px;top:196.67px" class="cls_039"><span class="cls_039">until the blocking call to the repository’s </span><span class="cls_059">save()</span><span class="cls_039"> method returns. In short, the request</span></div>
<div style="position:absolute;left:93.18px;top:209.66px" class="cls_039"><span class="cls_039">is blocked twice: as it enters </span><span class="cls_059">postTaco()</span><span class="cls_039"> and again, inside of </span><span class="cls_059">postTaco()</span><span class="cls_039">. But by</span></div>
<div style="position:absolute;left:93.18px;top:222.65px" class="cls_039"><span class="cls_039">applying a little reactive coding to </span><span class="cls_059">postTaco()</span><span class="cls_039">, you can make it a fully non-blocking,</span></div>
<div style="position:absolute;left:93.18px;top:235.67px" class="cls_039"><span class="cls_039">request-handling method:</span></div>
<div style="position:absolute;left:93.18px;top:255.35px" class="cls_060"><span class="cls_060">@PostMapping(consumes="application/json")</span></div>
<div style="position:absolute;left:93.18px;top:265.34px" class="cls_060"><span class="cls_060">@ResponseStatus(HttpStatus.CREATED)</span></div>
<div style="position:absolute;left:93.18px;top:275.33px" class="cls_060"><span class="cls_060">public Mono&lt;Taco&gt; postTaco(@RequestBody Mono&lt;Taco&gt; tacoMono) {</span></div>
<div style="position:absolute;left:102.78px;top:285.35px" class="cls_060"><span class="cls_060">return tacoRepo.saveAll(tacoMono).next();</span></div>
<div style="position:absolute;left:93.18px;top:295.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:316.67px" class="cls_039"><span class="cls_039">Here, </span><span class="cls_059">postTaco()</span><span class="cls_039"> accepts a </span><span class="cls_059">Mono&lt;Taco&gt;</span><span class="cls_039"> and calls the repository’s </span><span class="cls_059">saveAll()</span><span class="cls_039"> method,</span></div>
<div style="position:absolute;left:93.18px;top:329.66px" class="cls_039"><span class="cls_039">which, as you’ll see in the next chapter, accepts any implementation of Reactive Streams’</span></div>
<div style="position:absolute;left:93.18px;top:342.68px" class="cls_039"><span class="cls_039">Publisher, including </span><span class="cls_059">Mono</span><span class="cls_039"> or </span><span class="cls_059">Flux</span><span class="cls_039">. The </span><span class="cls_059">saveAll()</span><span class="cls_039"> method returns a </span><span class="cls_059">Flux&lt;Taco&gt;</span><span class="cls_039">, but</span></div>
<div style="position:absolute;left:93.18px;top:355.67px" class="cls_039"><span class="cls_039">because you started with a </span><span class="cls_059">Mono</span><span class="cls_039">, you know there’s at most one </span><span class="cls_059">Taco</span><span class="cls_039"> that will be pub-</span></div>
<div style="position:absolute;left:93.18px;top:368.66px" class="cls_039"><span class="cls_039">lished by the </span><span class="cls_059">Flux</span><span class="cls_039">. You can therefore call </span><span class="cls_059">next()</span><span class="cls_039"> to obtain a </span><span class="cls_059">Mono&lt;Taco&gt;</span><span class="cls_039"> that will</span></div>
<div style="position:absolute;left:93.18px;top:381.68px" class="cls_039"><span class="cls_039">return from </span><span class="cls_059">postTaco()</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:108.33px;top:394.67px" class="cls_039"><span class="cls_039">By accepting a </span><span class="cls_059">Mono&lt;Taco&gt;</span><span class="cls_039"> as input, the method is invoked immediately without</span></div>
<div style="position:absolute;left:93.18px;top:407.66px" class="cls_039"><span class="cls_039">waiting for the </span><span class="cls_059">Taco</span><span class="cls_039"> to be resolved from the request body. And because the reposi-</span></div>
<div style="position:absolute;left:93.18px;top:420.68px" class="cls_039"><span class="cls_039">tory is also reactive, it’ll accept a </span><span class="cls_059">Mono</span><span class="cls_039"> and immediately return a </span><span class="cls_059">Flux&lt;Taco&gt;</span><span class="cls_039">, from</span></div>
<div style="position:absolute;left:93.18px;top:433.67px" class="cls_039"><span class="cls_039">which you call </span><span class="cls_059">next()</span><span class="cls_039"> and return the resulting </span><span class="cls_059">Mono&lt;Taco&gt;</span><span class="cls_039"> … all before the request</span></div>
<div style="position:absolute;left:93.18px;top:446.66px" class="cls_039"><span class="cls_039">is even processed!</span></div>
<div style="position:absolute;left:109.01px;top:459.68px" class="cls_039"><span class="cls_039">Spring WebFlux is a fantastic alternative to Spring MVC, offering the option of</span></div>
<div style="position:absolute;left:93.18px;top:472.67px" class="cls_039"><span class="cls_039">writing reactive web applications using the same development model as Spring MVC.</span></div>
<div style="position:absolute;left:93.18px;top:485.66px" class="cls_039"><span class="cls_039">But Spring 5 has another new trick up its sleeve. Let’s take a look at how to create</span></div>
<div style="position:absolute;left:93.18px;top:498.68px" class="cls_039"><span class="cls_039">reactive APIs using Spring 5’s new functional programming style.</span></div>
<div style="position:absolute;left:57.18px;top:523.84px" class="cls_040"><span class="cls_040">11.2</span></div>
<div style="position:absolute;left:93.18px;top:523.84px" class="cls_040"><span class="cls_040">Defining functional request handlers</span></div>
<div style="position:absolute;left:93.18px;top:543.17px" class="cls_039"><span class="cls_039">Spring MVC’s annotation-based programming model has been around since Spring 2.5</span></div>
<div style="position:absolute;left:93.18px;top:556.19px" class="cls_039"><span class="cls_039">and is widely popular. It comes with a few downsides, however.</span></div>
<div style="position:absolute;left:107.58px;top:569.18px" class="cls_039"><span class="cls_039">First, any annotation-based programming involves a split in the definition of </span><span class="cls_036">what</span><span class="cls_039"> the</span></div>
<div style="position:absolute;left:93.18px;top:582.17px" class="cls_039"><span class="cls_039">annotation is supposed to do and </span><span class="cls_036">how</span><span class="cls_039"> it’s supposed to do it. Annotations themselves</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:197388px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background299.jpg" width="531" height="666"></div>
<div style="position:absolute;left:205.47px;top:24.35px" class="cls_055"><span class="cls_055">Defining functional request handlers</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">277</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">define the what; the how is defined elsewhere in the framework code. This compli-</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">cates the programming model when it comes to any sort of customization or exten-</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">sion because such changes require working in code that’s external to the annotation.</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">Moreover, debugging such code is tricky because you can’t set a breakpoint on an</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">annotation.</span></div>
<div style="position:absolute;left:117.97px;top:115.67px" class="cls_039"><span class="cls_039">Also, as Spring continues to grow in popularity, developers new to Spring from</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">other languages and frameworks may find annotation-based Spring MVC (and Web-</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">Flux) quite unlike what they already know. As an alternative to WebFlux, Spring 5 has</span></div>
<div style="position:absolute;left:102.18px;top:154.67px" class="cls_039"><span class="cls_039">introduced a new functional programming model for defining reactive APIs.</span></div>
<div style="position:absolute;left:117.94px;top:167.66px" class="cls_039"><span class="cls_039">This new programming model is used more like a library and less like a frame-</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">work, letting you map requests to handler code without annotations. Writing an API</span></div>
<div style="position:absolute;left:102.18px;top:193.67px" class="cls_039"><span class="cls_039">using Spring’s functional programming model involves four primary types:</span></div>
<div style="position:absolute;left:117.78px;top:212.66px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> RequestPredicate</span><span class="cls_039">—Declares the kind(s) of requests that will be handled</span></div>
<div style="position:absolute;left:117.78px;top:226.67px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> RouterFunction</span><span class="cls_039">—Declares how a matching request should be routed to han-</span></div>
<div style="position:absolute;left:129.78px;top:239.66px" class="cls_039"><span class="cls_039">dler code</span></div>
<div style="position:absolute;left:117.78px;top:253.67px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> ServerRequest</span><span class="cls_039">—Represents an HTTP request, including access to header and</span></div>
<div style="position:absolute;left:129.78px;top:266.66px" class="cls_039"><span class="cls_039">body information</span></div>
<div style="position:absolute;left:117.78px;top:280.67px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> ServerResponse</span><span class="cls_039">—Represents an HTTP response, including header and body</span></div>
<div style="position:absolute;left:129.78px;top:293.66px" class="cls_039"><span class="cls_039">information</span></div>
<div style="position:absolute;left:102.18px;top:313.67px" class="cls_039"><span class="cls_039">As a simple example that pulls all of these types together, consider the following Hello</span></div>
<div style="position:absolute;left:102.18px;top:326.66px" class="cls_039"><span class="cls_039">World example:</span></div>
<div style="position:absolute;left:102.18px;top:349.34px" class="cls_060"><span class="cls_060">package demo;</span></div>
<div style="position:absolute;left:102.18px;top:359.33px" class="cls_060"><span class="cls_060">import static org.springframework.web.</span></div>
<div style="position:absolute;left:193.33px;top:369.35px" class="cls_060"><span class="cls_060">reactive.function.server.RequestPredicates.GET;</span></div>
<div style="position:absolute;left:102.18px;top:379.34px" class="cls_060"><span class="cls_060">import static org.springframework.web.</span></div>
<div style="position:absolute;left:193.33px;top:389.36px" class="cls_060"><span class="cls_060">reactive.function.server.RouterFunctions.route;</span></div>
<div style="position:absolute;left:102.18px;top:399.35px" class="cls_060"><span class="cls_060">import static org.springframework.web.</span></div>
<div style="position:absolute;left:193.33px;top:409.34px" class="cls_060"><span class="cls_060">reactive.function.server.ServerResponse.ok;</span></div>
<div style="position:absolute;left:102.18px;top:419.36px" class="cls_060"><span class="cls_060">import static reactor.core.publisher.Mono.just;</span></div>
<div style="position:absolute;left:102.18px;top:441.35px" class="cls_060"><span class="cls_060">import org.springframework.context.annotation.Bean;</span></div>
<div style="position:absolute;left:102.18px;top:451.34px" class="cls_060"><span class="cls_060">import org.springframework.context.annotation.Configuration;</span></div>
<div style="position:absolute;left:102.18px;top:461.36px" class="cls_060"><span class="cls_060">import org.springframework.web.reactive.function.server.RouterFunction;</span></div>
<div style="position:absolute;left:102.18px;top:483.35px" class="cls_060"><span class="cls_060">@Configuration</span></div>
<div style="position:absolute;left:102.18px;top:493.34px" class="cls_060"><span class="cls_060">public class RouterFunctionConfig {</span></div>
<div style="position:absolute;left:111.78px;top:515.36px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:111.78px;top:525.35px" class="cls_060"><span class="cls_060">public RouterFunction&lt;?&gt; helloRouterFunction() {</span></div>
<div style="position:absolute;left:121.38px;top:535.34px" class="cls_060"><span class="cls_060">return route(GET("/hello"),</span></div>
<div style="position:absolute;left:140.56px;top:545.36px" class="cls_060"><span class="cls_060">request -&gt; ok().body(just("Hello World!"), String.class));</span></div>
<div style="position:absolute;left:111.78px;top:555.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:575.36px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:198064px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background300.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">278</span></div>
<div style="position:absolute;left:192.03px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 11</span></div>
<div style="position:absolute;left:240.99px;top:24.35px" class="cls_055"><span class="cls_055">Developing reactive APIs</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">The first thing to notice is that you’ve chosen to statically import a few helper classes</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">that you can use to create the aforementioned functional types. You’ve also statically</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">imported </span><span class="cls_059">Mono</span><span class="cls_039"> to keep the rest of the code easier to read and understand.</span></div>
<div style="position:absolute;left:109.24px;top:89.66px" class="cls_039"><span class="cls_039">In this </span><span class="cls_059">@Configuration</span><span class="cls_039"> class, you have a single </span><span class="cls_059">@Bean</span><span class="cls_039"> method of type </span><span class="cls_059">Router-</span></div>
<div style="position:absolute;left:93.33px;top:102.65px" class="cls_059"><span class="cls_059">Function&lt;?&gt;</span><span class="cls_039">. As mentioned, a </span><span class="cls_059">RouterFunction</span><span class="cls_039"> declares mappings between one or more</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_059"><span class="cls_059">RequestPredicate</span><span class="cls_039"> objects and the functions that will handle the matching request(s).</span></div>
<div style="position:absolute;left:108.21px;top:128.66px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">route()</span><span class="cls_039"> method from </span><span class="cls_059">RouterFunctions</span><span class="cls_039"> accepts two parameters: a </span><span class="cls_059">Request-</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_059"><span class="cls_059">Predicate</span><span class="cls_039"> and a function to handle matching requests. In this case, the </span><span class="cls_059">GET()</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_039"><span class="cls_039">method from </span><span class="cls_059">RequestPredicates</span><span class="cls_039"> declares a </span><span class="cls_059">RequestPredicate</span><span class="cls_039"> that matches HTTP</span></div>
<div style="position:absolute;left:93.18px;top:167.66px" class="cls_039"><span class="cls_039">GET requests for the /hello path.</span></div>
<div style="position:absolute;left:109.20px;top:180.65px" class="cls_039"><span class="cls_039">As for the handler function, it’s written as a lambda, although it can also be a</span></div>
<div style="position:absolute;left:93.18px;top:193.67px" class="cls_039"><span class="cls_039">method reference. Although it isn’t explicitly declared, the handler lambda accepts a</span></div>
<div style="position:absolute;left:93.18px;top:206.66px" class="cls_059"><span class="cls_059">ServerRequest</span><span class="cls_039"> as a parameter. It returns a </span><span class="cls_059">ServerResponse</span><span class="cls_039"> using </span><span class="cls_059">ok()</span><span class="cls_039"> from </span><span class="cls_059">Server-</span></div>
<div style="position:absolute;left:93.18px;top:219.65px" class="cls_059"><span class="cls_059">Response</span><span class="cls_039"> and </span><span class="cls_059">body()</span><span class="cls_039"> from </span><span class="cls_059">BodyBuilder</span><span class="cls_039">, which was returned from </span><span class="cls_059">ok()</span><span class="cls_039">. This was</span></div>
<div style="position:absolute;left:93.18px;top:232.67px" class="cls_039"><span class="cls_039">done to create a response with an HTTP 200 (OK) status code and a body payload</span></div>
<div style="position:absolute;left:93.18px;top:245.66px" class="cls_039"><span class="cls_039">that says Hello World!</span></div>
<div style="position:absolute;left:108.67px;top:258.65px" class="cls_039"><span class="cls_039">As written, the </span><span class="cls_059">helloRouterFunction()</span><span class="cls_039"> method declares a </span><span class="cls_059">RouterFunction</span><span class="cls_039"> that</span></div>
<div style="position:absolute;left:93.18px;top:271.67px" class="cls_039"><span class="cls_039">only handles a single kind of request. But if you need to handle a different kind of</span></div>
<div style="position:absolute;left:93.18px;top:284.66px" class="cls_039"><span class="cls_039">request, you don’t have to write another </span><span class="cls_059">@Bean</span><span class="cls_039"> method, although you can. You only</span></div>
<div style="position:absolute;left:93.18px;top:297.68px" class="cls_039"><span class="cls_039">need to call </span><span class="cls_059">andRoute()</span><span class="cls_039"> to declare another </span><span class="cls_059">RequestPredicate</span><span class="cls_039">-to-function mapping.</span></div>
<div style="position:absolute;left:93.18px;top:310.67px" class="cls_039"><span class="cls_039">For example, here’s how you might add another handler for GET requests for /bye:</span></div>
<div style="position:absolute;left:93.18px;top:330.35px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:93.18px;top:340.34px" class="cls_060"><span class="cls_060">public RouterFunction&lt;?&gt; helloRouterFunction() {</span></div>
<div style="position:absolute;left:102.78px;top:350.33px" class="cls_060"><span class="cls_060">return route(GET("/hello"),</span></div>
<div style="position:absolute;left:121.94px;top:360.35px" class="cls_060"><span class="cls_060">request -&gt; ok().body(just("Hello World!"), String.class))</span></div>
<div style="position:absolute;left:112.38px;top:370.34px" class="cls_060"><span class="cls_060">.andRoute(GET("/bye"),</span></div>
<div style="position:absolute;left:121.95px;top:380.36px" class="cls_060"><span class="cls_060">request -&gt; ok().body(just("See ya!"), String.class));</span></div>
<div style="position:absolute;left:93.18px;top:390.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:411.68px" class="cls_039"><span class="cls_039">Hello World samples are fine for dipping your toes into something new. But let’s amp</span></div>
<div style="position:absolute;left:93.18px;top:424.67px" class="cls_039"><span class="cls_039">it up a bit and see how to use Spring’s functional web programming model to handle</span></div>
<div style="position:absolute;left:93.18px;top:437.66px" class="cls_039"><span class="cls_039">requests that resemble real-world scenarios.</span></div>
<div style="position:absolute;left:108.14px;top:450.68px" class="cls_039"><span class="cls_039">To demonstrate how the functional programming model might be used in a real-</span></div>
<div style="position:absolute;left:93.18px;top:463.67px" class="cls_039"><span class="cls_039">world application, let’s reinvent the functionality of </span><span class="cls_059">DesignTacoController</span><span class="cls_039"> in the</span></div>
<div style="position:absolute;left:93.18px;top:476.66px" class="cls_039"><span class="cls_039">functional style. The following configuration class is a functional analog to </span><span class="cls_059">Design-</span></div>
<div style="position:absolute;left:93.18px;top:489.68px" class="cls_059"><span class="cls_059">TacoController</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:509.36px" class="cls_060"><span class="cls_060">@Configuration</span></div>
<div style="position:absolute;left:93.18px;top:519.35px" class="cls_060"><span class="cls_060">public class RouterFunctionConfig {</span></div>
<div style="position:absolute;left:102.78px;top:539.36px" class="cls_060"><span class="cls_060">@Autowired</span></div>
<div style="position:absolute;left:102.78px;top:549.35px" class="cls_060"><span class="cls_060">private TacoRepository tacoRepo;</span></div>
<div style="position:absolute;left:102.78px;top:569.36px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:102.78px;top:579.35px" class="cls_060"><span class="cls_060">public RouterFunction&lt;?&gt; routerFunction() {</span></div>
<div style="position:absolute;left:112.38px;top:589.34px" class="cls_060"><span class="cls_060">return route(GET("/design/taco"), this::recents)</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:198740px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background301.jpg" width="531" height="666"></div>
<div style="position:absolute;left:222.45px;top:24.35px" class="cls_055"><span class="cls_055">Testing reactive controllers</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">279</span></div>
<div style="position:absolute;left:135.76px;top:51.32px" class="cls_060"><span class="cls_060">.andRoute(POST("/design"), this::postTaco);</span></div>
<div style="position:absolute;left:111.78px;top:61.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.77px;top:81.32px" class="cls_060"><span class="cls_060">public Mono&lt;ServerResponse&gt; recents(ServerRequest request) {</span></div>
<div style="position:absolute;left:121.38px;top:91.34px" class="cls_060"><span class="cls_060">return ServerResponse.ok()</span></div>
<div style="position:absolute;left:140.56px;top:101.33px" class="cls_060"><span class="cls_060">.body(tacoRepo.findAll().take(12), Taco.class);</span></div>
<div style="position:absolute;left:111.78px;top:111.32px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.77px;top:131.33px" class="cls_060"><span class="cls_060">public Mono&lt;ServerResponse&gt; postTaco(ServerRequest request) {</span></div>
<div style="position:absolute;left:121.38px;top:141.35px" class="cls_060"><span class="cls_060">Mono&lt;Taco&gt; taco = request.bodyToMono(Taco.class);</span></div>
<div style="position:absolute;left:121.38px;top:151.34px" class="cls_060"><span class="cls_060">Mono&lt;Taco&gt; savedTaco = tacoRepo.save(taco);</span></div>
<div style="position:absolute;left:121.38px;top:161.33px" class="cls_060"><span class="cls_060">return ServerResponse</span></div>
<div style="position:absolute;left:140.56px;top:171.35px" class="cls_060"><span class="cls_060">.created(URI.create(</span></div>
<div style="position:absolute;left:164.57px;top:181.34px" class="cls_060"><span class="cls_060">"</span><a href="http://localhost:8080/design/taco/" "="">http://localhost:8080/design/taco/"</a> +</div>
<div style="position:absolute;left:164.57px;top:191.33px" class="cls_060"><span class="cls_060">savedTaco.getId()))</span></div>
<div style="position:absolute;left:140.56px;top:201.35px" class="cls_060"><span class="cls_060">.body(savedTaco, Taco.class);</span></div>
<div style="position:absolute;left:111.78px;top:211.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:221.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:244.67px" class="cls_039"><span class="cls_039">As you can see, the </span><span class="cls_059">routerFunction()</span><span class="cls_039"> method declares a </span><span class="cls_059">RouterFunction&lt;?&gt;</span><span class="cls_039"> bean,</span></div>
<div style="position:absolute;left:102.18px;top:257.66px" class="cls_039"><span class="cls_039">like the Hello World example. But it differs in what types of requests are handled and</span></div>
<div style="position:absolute;left:102.18px;top:270.65px" class="cls_039"><span class="cls_039">how they’re handled. In this case, the </span><span class="cls_059">RouterFunction</span><span class="cls_039"> is created to handle GET</span></div>
<div style="position:absolute;left:102.18px;top:283.67px" class="cls_039"><span class="cls_039">requests for /design/taco and POST requests for /design.</span></div>
<div style="position:absolute;left:118.11px;top:296.66px" class="cls_039"><span class="cls_039">What stands out even more is that the routes are handled by method references.</span></div>
<div style="position:absolute;left:102.18px;top:309.68px" class="cls_039"><span class="cls_039">Lambdas are great when the behavior behind a </span><span class="cls_059">RouterFunction</span><span class="cls_039"> is relatively simple and</span></div>
<div style="position:absolute;left:102.18px;top:322.67px" class="cls_039"><span class="cls_039">brief. In many cases, however, it’s better to extract that functionality into a separate</span></div>
<div style="position:absolute;left:102.18px;top:335.66px" class="cls_039"><span class="cls_039">method (or even into a separate method in a separate class) to maintain code readability.</span></div>
<div style="position:absolute;left:117.18px;top:348.68px" class="cls_039"><span class="cls_039">For your needs, GET requests for /design/taco will be handled by the </span><span class="cls_059">recents()</span></div>
<div style="position:absolute;left:102.18px;top:361.67px" class="cls_039"><span class="cls_039">method. It uses the injected </span><span class="cls_059">TacoRepository</span><span class="cls_039"> to fetch a </span><span class="cls_059">Mono&lt;Taco&gt;</span><span class="cls_039"> from which it</span></div>
<div style="position:absolute;left:102.18px;top:374.66px" class="cls_039"><span class="cls_039">takes 12 items. And POST requests for /design are handled by the </span><span class="cls_059">postTaco()</span></div>
<div style="position:absolute;left:102.18px;top:387.68px" class="cls_039"><span class="cls_039">method, which extracts a </span><span class="cls_059">Mono&lt;Taco&gt;</span><span class="cls_039"> from the incoming </span><span class="cls_059">ServerRequest</span><span class="cls_039">. The </span><span class="cls_059">post-</span></div>
<div style="position:absolute;left:102.18px;top:400.67px" class="cls_059"><span class="cls_059">Taco()</span><span class="cls_039"> method then uses the </span><span class="cls_059">TacoRepository</span><span class="cls_039"> to save it before responding with the</span></div>
<div style="position:absolute;left:102.18px;top:413.66px" class="cls_059"><span class="cls_059">Mono&lt;Taco&gt;</span><span class="cls_039"> that’s returned from the </span><span class="cls_059">save()</span><span class="cls_039"> method.</span></div>
<div style="position:absolute;left:66.18px;top:438.85px" class="cls_040"><span class="cls_040">11.3</span></div>
<div style="position:absolute;left:102.18px;top:438.85px" class="cls_040"><span class="cls_040">Testing reactive controllers</span></div>
<div style="position:absolute;left:102.18px;top:458.18px" class="cls_039"><span class="cls_039">When it comes to testing reactive controllers, Spring 5 hasn’t left us in the lurch.</span></div>
<div style="position:absolute;left:102.18px;top:471.17px" class="cls_039"><span class="cls_039">Indeed, Spring 5 has introduced </span><span class="cls_059">WebTestClient</span><span class="cls_039">, a new test utility that makes it easy to</span></div>
<div style="position:absolute;left:102.18px;top:484.16px" class="cls_039"><span class="cls_039">write tests for reactive controllers written with Spring WebFlux. To see how to write</span></div>
<div style="position:absolute;left:102.18px;top:497.18px" class="cls_039"><span class="cls_039">tests with </span><span class="cls_059">WebTestClient</span><span class="cls_039">, let’s start by using it to test the </span><span class="cls_059">recentTacos()</span><span class="cls_039"> method from</span></div>
<div style="position:absolute;left:102.18px;top:510.17px" class="cls_059"><span class="cls_059">DesignTacoController</span><span class="cls_039"> that you wrote in section 11.1.2.</span></div>
<div style="position:absolute;left:66.18px;top:536.00px" class="cls_063"><span class="cls_063">11.3.1</span></div>
<div style="position:absolute;left:102.18px;top:536.00px" class="cls_063"><span class="cls_063">Testing GET requests</span></div>
<div style="position:absolute;left:102.18px;top:553.67px" class="cls_039"><span class="cls_039">One thing we’d like to assert about the </span><span class="cls_059">recentTacos()</span><span class="cls_039"> method is that if an HTTP GET</span></div>
<div style="position:absolute;left:102.18px;top:566.69px" class="cls_039"><span class="cls_039">request is issued for the path /design/recent, then the response will contain a JSON pay-</span></div>
<div style="position:absolute;left:102.18px;top:579.68px" class="cls_039"><span class="cls_039">load with no more than 12 tacos. The test class in the next listing is a good start.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:199416px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background302.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">280</span></div>
<div style="position:absolute;left:192.03px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 11</span></div>
<div style="position:absolute;left:240.99px;top:24.35px" class="cls_055"><span class="cls_055">Developing reactive APIs</span></div>
<div style="position:absolute;left:105.18px;top:54.65px" class="cls_066"><span class="cls_066">Listing 11.1</span></div>
<div style="position:absolute;left:162.68px;top:54.26px" class="cls_066"><span class="cls_066">Using </span><span class="cls_077">WebTestClient</span><span class="cls_066"> to test </span><span class="cls_077">DesignTacoController</span></div>
<div style="position:absolute;left:93.18px;top:71.63px" class="cls_060"><span class="cls_060">package tacos;</span></div>
<div style="position:absolute;left:93.18px;top:94.64px" class="cls_060"><span class="cls_060">import static org.mockito.Mockito.*;</span></div>
<div style="position:absolute;left:93.18px;top:104.63px" class="cls_060"><span class="cls_060">import java.util.ArrayList;</span></div>
<div style="position:absolute;left:93.18px;top:114.62px" class="cls_060"><span class="cls_060">import java.util.List;</span></div>
<div style="position:absolute;left:93.18px;top:124.64px" class="cls_060"><span class="cls_060">import org.junit.Test;</span></div>
<div style="position:absolute;left:93.18px;top:134.63px" class="cls_060"><span class="cls_060">import org.mockito.Mockito;</span></div>
<div style="position:absolute;left:93.18px;top:144.65px" class="cls_060"><span class="cls_060">import org.springframework.http.MediaType;</span></div>
<div style="position:absolute;left:93.18px;top:154.64px" class="cls_060"><span class="cls_060">import org.springframework.test.web.reactive.server.WebTestClient;</span></div>
<div style="position:absolute;left:93.18px;top:164.63px" class="cls_060"><span class="cls_060">import reactor.core.publisher.Flux;</span></div>
<div style="position:absolute;left:93.18px;top:174.65px" class="cls_060"><span class="cls_060">import tacos.Ingredient.Type;</span></div>
<div style="position:absolute;left:93.18px;top:184.64px" class="cls_060"><span class="cls_060">import tacos.data.TacoRepository;</span></div>
<div style="position:absolute;left:93.18px;top:194.63px" class="cls_060"><span class="cls_060">import tacos.web.api.DesignTacoController;</span></div>
<div style="position:absolute;left:93.18px;top:217.64px" class="cls_060"><span class="cls_060">public class DesignTacoControllerTest {</span></div>
<div style="position:absolute;left:102.78px;top:240.65px" class="cls_060"><span class="cls_060">@Test</span></div>
<div style="position:absolute;left:102.78px;top:250.64px" class="cls_060"><span class="cls_060">public void shouldReturnRecentTacos() {</span></div>
<div style="position:absolute;left:112.36px;top:260.63px" class="cls_060"><span class="cls_060">Taco[] tacos = {</span></div>
<div style="position:absolute;left:316.71px;top:266.93px" class="cls_067"><span class="cls_067">Creates some</span></div>
<div style="position:absolute;left:131.55px;top:270.65px" class="cls_060"><span class="cls_060">testTaco(1L), testTaco(2L),</span></div>
<div style="position:absolute;left:316.71px;top:276.44px" class="cls_067"><span class="cls_067">test data</span></div>
<div style="position:absolute;left:131.55px;top:280.64px" class="cls_060"><span class="cls_060">testTaco(3L), testTaco(4L),</span></div>
<div style="position:absolute;left:131.55px;top:290.63px" class="cls_060"><span class="cls_060">testTaco(5L), testTaco(6L),</span></div>
<div style="position:absolute;left:131.55px;top:300.65px" class="cls_060"><span class="cls_060">testTaco(7L), testTaco(8L),</span></div>
<div style="position:absolute;left:131.55px;top:310.64px" class="cls_060"><span class="cls_060">testTaco(9L), testTaco(10L),</span></div>
<div style="position:absolute;left:131.55px;top:320.63px" class="cls_060"><span class="cls_060">testTaco(11L), testTaco(12L),</span></div>
<div style="position:absolute;left:131.55px;top:330.65px" class="cls_060"><span class="cls_060">testTaco(13L), testTaco(14L),</span></div>
<div style="position:absolute;left:131.55px;top:340.64px" class="cls_060"><span class="cls_060">testTaco(15L), testTaco(16L)};</span></div>
<div style="position:absolute;left:112.38px;top:350.63px" class="cls_060"><span class="cls_060">Flux&lt;Taco&gt; tacoFlux = Flux.just(tacos);</span></div>
<div style="position:absolute;left:112.36px;top:373.64px" class="cls_060"><span class="cls_060">TacoRepository tacoRepo = Mockito.mock(TacoRepository.class);</span></div>
<div style="position:absolute;left:112.38px;top:383.63px" class="cls_060"><span class="cls_060">when(tacoRepo.findAll()).thenReturn(tacoFlux);</span></div>
<div style="position:absolute;left:427.08px;top:386.93px" class="cls_067"><span class="cls_067">Mocks</span></div>
<div style="position:absolute;left:427.08px;top:396.44px" class="cls_067"><span class="cls_067">TacoRepository</span></div>
<div style="position:absolute;left:112.38px;top:406.64px" class="cls_060"><span class="cls_060">WebTestClient testClient = WebTestClient.bindToController(</span></div>
<div style="position:absolute;left:131.55px;top:416.66px" class="cls_060"><span class="cls_060">new DesignTacoController(tacoRepo))</span></div>
<div style="position:absolute;left:141.16px;top:426.65px" class="cls_060"><span class="cls_060">.build();</span></div>
<div style="position:absolute;left:326.43px;top:429.95px" class="cls_067"><span class="cls_067">Creates a</span></div>
<div style="position:absolute;left:326.43px;top:439.43px" class="cls_067"><span class="cls_067">WebTestClient</span></div>
<div style="position:absolute;left:112.38px;top:449.66px" class="cls_060"><span class="cls_060">testClient.get().uri("/design/recent")</span></div>
<div style="position:absolute;left:121.96px;top:459.65px" class="cls_060"><span class="cls_060">.exchange()</span></div>
<div style="position:absolute;left:350.70px;top:462.95px" class="cls_067"><span class="cls_067">Requests</span></div>
<div style="position:absolute;left:121.96px;top:469.64px" class="cls_060"><span class="cls_060">.expectStatus().isOk()</span></div>
<div style="position:absolute;left:350.70px;top:472.43px" class="cls_067"><span class="cls_067">recent tacos</span></div>
<div style="position:absolute;left:121.95px;top:479.66px" class="cls_060"><span class="cls_060">.expectBody()</span></div>
<div style="position:absolute;left:131.55px;top:489.65px" class="cls_060"><span class="cls_060">.jsonPath("$").isArray()</span></div>
<div style="position:absolute;left:319.17px;top:492.14px" class="cls_067"><span class="cls_067">Verifies expected response</span></div>
<div style="position:absolute;left:131.55px;top:499.64px" class="cls_060"><span class="cls_060">.jsonPath("$").isNotEmpty()</span></div>
<div style="position:absolute;left:131.55px;top:509.66px" class="cls_060"><span class="cls_060">.jsonPath("$[0].id").isEqualTo(tacos[0].getId().toString())</span></div>
<div style="position:absolute;left:131.55px;top:519.65px" class="cls_060"><span class="cls_060">.jsonPath("$[0].name").isEqualTo("Taco 1").jsonPath("$[1].id")</span></div>
<div style="position:absolute;left:131.55px;top:529.64px" class="cls_060"><span class="cls_060">.isEqualTo(tacos[1].getId().toString()).jsonPath("$[1].name")</span></div>
<div style="position:absolute;left:131.55px;top:539.66px" class="cls_060"><span class="cls_060">.isEqualTo("Taco 2").jsonPath("$[11].id")</span></div>
<div style="position:absolute;left:131.55px;top:549.65px" class="cls_060"><span class="cls_060">.isEqualTo(tacos[11].getId().toString())</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:200092px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background303.jpg" width="531" height="666"></div>
<div style="position:absolute;left:222.45px;top:24.35px" class="cls_055"><span class="cls_055">Testing reactive controllers</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">281</span></div>
<div style="position:absolute;left:140.55px;top:51.32px" class="cls_060"><span class="cls_060">.jsonPath("$[11].name").isEqualTo("Taco 12").jsonPath("$[12]")</span></div>
<div style="position:absolute;left:126.18px;top:61.34px" class="cls_060"><span class="cls_060">.doesNotExist();</span></div>
<div style="position:absolute;left:140.55px;top:71.33px" class="cls_060"><span class="cls_060">.jsonPath("$[12]").doesNotExist();</span></div>
<div style="position:absolute;left:111.78px;top:81.32px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:121.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:142.67px" class="cls_039"><span class="cls_039">The first thing that the </span><span class="cls_059">shouldReturnRecentTacos()</span><span class="cls_039"> method does is set up test data</span></div>
<div style="position:absolute;left:102.18px;top:155.66px" class="cls_039"><span class="cls_039">in the form of a </span><span class="cls_059">Flux&lt;Taco&gt;</span><span class="cls_039">. This </span><span class="cls_059">Flux</span><span class="cls_039"> is then provided as the return value from the</span></div>
<div style="position:absolute;left:102.18px;top:168.65px" class="cls_059"><span class="cls_059">findAll()</span><span class="cls_039"> method of a mock </span><span class="cls_059">TacoRepository</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:116.63px;top:181.67px" class="cls_039"><span class="cls_039">With regard to the </span><span class="cls_059">Taco</span><span class="cls_039"> objects that will be published by </span><span class="cls_059">Flux</span><span class="cls_039">, they’re created with</span></div>
<div style="position:absolute;left:102.18px;top:194.66px" class="cls_039"><span class="cls_039">a utility method named </span><span class="cls_059">testTaco()</span><span class="cls_039"> that, when given a number, produces a </span><span class="cls_059">Taco</span></div>
<div style="position:absolute;left:102.18px;top:207.65px" class="cls_039"><span class="cls_039">object whose ID and name are based on that number. The </span><span class="cls_059">testTaco()</span><span class="cls_039"> method is</span></div>
<div style="position:absolute;left:102.18px;top:220.67px" class="cls_039"><span class="cls_039">implemented as follows:</span></div>
<div style="position:absolute;left:102.18px;top:240.35px" class="cls_060"><span class="cls_060">private Taco testTaco(Long number) {</span></div>
<div style="position:absolute;left:121.38px;top:250.34px" class="cls_060"><span class="cls_060">Taco taco = new Taco();</span></div>
<div style="position:absolute;left:121.38px;top:260.33px" class="cls_060"><span class="cls_060">taco.setId(UUID.randomUUID());</span></div>
<div style="position:absolute;left:121.38px;top:270.35px" class="cls_060"><span class="cls_060">taco.setName("Taco " + number);</span></div>
<div style="position:absolute;left:121.37px;top:280.34px" class="cls_060"><span class="cls_060">List&lt;IngredientUDT&gt; ingredients = new ArrayList&lt;&gt;();</span></div>
<div style="position:absolute;left:121.38px;top:290.33px" class="cls_060"><span class="cls_060">ingredients.add(</span></div>
<div style="position:absolute;left:140.56px;top:300.35px" class="cls_060"><span class="cls_060">new IngredientUDT("INGA", "Ingredient A", Type.WRAP));</span></div>
<div style="position:absolute;left:121.38px;top:310.34px" class="cls_060"><span class="cls_060">ingredients.add(</span></div>
<div style="position:absolute;left:140.56px;top:320.33px" class="cls_060"><span class="cls_060">new IngredientUDT("INGB", "Ingredient B", Type.PROTEIN));</span></div>
<div style="position:absolute;left:121.38px;top:330.35px" class="cls_060"><span class="cls_060">taco.setIngredients(ingredients);</span></div>
<div style="position:absolute;left:121.38px;top:340.34px" class="cls_060"><span class="cls_060">return taco;</span></div>
<div style="position:absolute;left:111.78px;top:350.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:371.66px" class="cls_039"><span class="cls_039">For the sake of simplicity, all test tacos will have the same two ingredients. But their ID</span></div>
<div style="position:absolute;left:102.18px;top:384.68px" class="cls_039"><span class="cls_039">and name will be determined by the given number.</span></div>
<div style="position:absolute;left:117.55px;top:397.67px" class="cls_039"><span class="cls_039">Meanwhile, back in the </span><span class="cls_059">shouldReturnRecentTacos()</span><span class="cls_039"> method, you instantiated a</span></div>
<div style="position:absolute;left:102.18px;top:410.66px" class="cls_059"><span class="cls_059">DesignTacoController</span><span class="cls_039">, injecting the mock </span><span class="cls_059">TacoRepository</span><span class="cls_039"> into the constructor.</span></div>
<div style="position:absolute;left:102.18px;top:423.68px" class="cls_039"><span class="cls_039">The controller is given to </span><span class="cls_059">WebTestClient.bindToController()</span><span class="cls_039"> to create an instance</span></div>
<div style="position:absolute;left:102.18px;top:436.67px" class="cls_039"><span class="cls_039">of </span><span class="cls_059">WebTestClient</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:116.63px;top:449.66px" class="cls_039"><span class="cls_039">With all of the setup complete, you’re now ready to use </span><span class="cls_059">WebTestClient</span><span class="cls_039"> to submit a</span></div>
<div style="position:absolute;left:102.18px;top:462.68px" class="cls_039"><span class="cls_039">GET request to /design/recent and verify that the response meets your expectations.</span></div>
<div style="position:absolute;left:102.18px;top:475.67px" class="cls_039"><span class="cls_039">Calling </span><span class="cls_059">get().uri("/design/recent")</span><span class="cls_039"> describes the request you want to issue. Then</span></div>
<div style="position:absolute;left:102.18px;top:488.66px" class="cls_039"><span class="cls_039">a call to </span><span class="cls_059">exchange()</span><span class="cls_039"> submits the request, which will be handled by the controller that</span></div>
<div style="position:absolute;left:102.18px;top:501.68px" class="cls_059"><span class="cls_059">WebTestClient</span><span class="cls_039"> is bound to—the </span><span class="cls_059">DesignTacoController</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:116.51px;top:514.67px" class="cls_039"><span class="cls_039">Finally, you can affirm that the response is as expected. By calling </span><span class="cls_059">expectStatus()</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:102.18px;top:527.66px" class="cls_039"><span class="cls_039">you assert that the response has an HTTP 200 (OK) status code. After that you see sev-</span></div>
<div style="position:absolute;left:102.18px;top:540.68px" class="cls_039"><span class="cls_039">eral calls to </span><span class="cls_059">jsonPath()</span><span class="cls_039"> that assert that the JSON in the response body has the values</span></div>
<div style="position:absolute;left:102.18px;top:553.67px" class="cls_039"><span class="cls_039">it should have. The final assertion checks that the 12th element (in a zero-based</span></div>
<div style="position:absolute;left:102.18px;top:566.69px" class="cls_039"><span class="cls_039">array) is nonexistent, as the result should never have more than 12 elements.</span></div>
<div style="position:absolute;left:117.09px;top:579.68px" class="cls_039"><span class="cls_039">If the JSON returns are complex, with a lot of data or highly nested data, it can</span></div>
<div style="position:absolute;left:102.18px;top:592.67px" class="cls_039"><span class="cls_039">be tedious to use </span><span class="cls_059">jsonPath()</span><span class="cls_039">. In fact, I left out many of the calls to </span><span class="cls_059">jsonPath()</span><span class="cls_039"> in</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:200768px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background304.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">282</span></div>
<div style="position:absolute;left:192.03px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 11</span></div>
<div style="position:absolute;left:240.99px;top:24.35px" class="cls_055"><span class="cls_055">Developing reactive APIs</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">listing 11.1 to conserve space. For those cases where it may be clumsy to use </span><span class="cls_059">jsonPath()</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_059"><span class="cls_059">WebTestClient</span><span class="cls_039"> offers </span><span class="cls_059">json()</span><span class="cls_039">, which accepts a </span><span class="cls_059">String</span><span class="cls_039"> parameter containing the</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">JSON to compare the response against.</span></div>
<div style="position:absolute;left:108.84px;top:89.66px" class="cls_039"><span class="cls_039">For example, suppose that you’ve created the complete response JSON in a file</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">named recent-tacos.json and placed it in the classpath under the path /tacos. Then</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">you can rewrite the </span><span class="cls_059">WebTestClient</span><span class="cls_039"> assertions to look like this:</span></div>
<div style="position:absolute;left:93.18px;top:137.33px" class="cls_060"><span class="cls_060">ClassPathResource recentsResource =</span></div>
<div style="position:absolute;left:112.38px;top:147.35px" class="cls_060"><span class="cls_060">new ClassPathResource("/tacos/recent-tacos.json");</span></div>
<div style="position:absolute;left:93.18px;top:157.34px" class="cls_060"><span class="cls_060">String recentsJson = StreamUtils.copyToString(</span></div>
<div style="position:absolute;left:112.38px;top:167.33px" class="cls_060"><span class="cls_060">recentsResource.getInputStream(), Charset.defaultCharset());</span></div>
<div style="position:absolute;left:93.18px;top:190.34px" class="cls_060"><span class="cls_060">testClient.get().uri("/design/recent")</span></div>
<div style="position:absolute;left:102.78px;top:200.33px" class="cls_060"><span class="cls_060">.accept(MediaType.APPLICATION_JSON)</span></div>
<div style="position:absolute;left:102.78px;top:210.35px" class="cls_060"><span class="cls_060">.exchange()</span></div>
<div style="position:absolute;left:102.78px;top:220.34px" class="cls_060"><span class="cls_060">.expectStatus().isOk()</span></div>
<div style="position:absolute;left:102.78px;top:230.33px" class="cls_060"><span class="cls_060">.expectBody()</span></div>
<div style="position:absolute;left:112.38px;top:240.35px" class="cls_061"><span class="cls_061">.json(recentsJson);</span></div>
<div style="position:absolute;left:93.18px;top:261.65px" class="cls_039"><span class="cls_039">Because </span><span class="cls_059">json()</span><span class="cls_039"> accepts a </span><span class="cls_059">String</span><span class="cls_039">, you must first load the classpath resource into a</span></div>
<div style="position:absolute;left:93.18px;top:274.67px" class="cls_059"><span class="cls_059">String</span><span class="cls_039">. Thankfully, Spring’s </span><span class="cls_059">StreamUtils</span><span class="cls_039"> makes this easy with </span><span class="cls_059">copyToString()</span><span class="cls_039">. The</span></div>
<div style="position:absolute;left:93.18px;top:287.66px" class="cls_059"><span class="cls_059">String</span><span class="cls_039"> that’s returned from </span><span class="cls_059">copyToString()</span><span class="cls_039"> will contain the entire JSON you expect</span></div>
<div style="position:absolute;left:93.18px;top:300.68px" class="cls_039"><span class="cls_039">in the response to your request. Giving it to the </span><span class="cls_059">json()</span><span class="cls_039"> method ensures that the con-</span></div>
<div style="position:absolute;left:93.18px;top:313.67px" class="cls_039"><span class="cls_039">troller is producing the correct output.</span></div>
<div style="position:absolute;left:108.81px;top:326.66px" class="cls_039"><span class="cls_039">Another option offered by </span><span class="cls_059">WebTestClient</span><span class="cls_039"> allows you to compare the response</span></div>
<div style="position:absolute;left:93.18px;top:339.68px" class="cls_039"><span class="cls_039">body with a list of values. The </span><span class="cls_059">expectBodyList()</span><span class="cls_039"> method accepts either a </span><span class="cls_059">Class</span><span class="cls_039"> or a</span></div>
<div style="position:absolute;left:93.18px;top:352.67px" class="cls_059"><span class="cls_059">ParameterizedTypeReference</span><span class="cls_039"> indicating the type of elements in the list and returns a</span></div>
<div style="position:absolute;left:93.18px;top:365.66px" class="cls_059"><span class="cls_059">ListBodySpec</span><span class="cls_039"> object to make assertions against. Using </span><span class="cls_059">expectBodyList()</span><span class="cls_039">, you can</span></div>
<div style="position:absolute;left:93.18px;top:378.68px" class="cls_039"><span class="cls_039">rewrite the test to use a subset of the same test data you used to create the mock</span></div>
<div style="position:absolute;left:93.18px;top:391.67px" class="cls_059"><span class="cls_059">TacoRepository</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:413.36px" class="cls_060"><span class="cls_060">testClient.get().uri("/design/recent")</span></div>
<div style="position:absolute;left:102.78px;top:423.35px" class="cls_060"><span class="cls_060">.accept(MediaType.APPLICATION_JSON)</span></div>
<div style="position:absolute;left:102.78px;top:433.34px" class="cls_060"><span class="cls_060">.exchange()</span></div>
<div style="position:absolute;left:102.78px;top:443.36px" class="cls_060"><span class="cls_060">.expectStatus().isOk()</span></div>
<div style="position:absolute;left:102.78px;top:453.35px" class="cls_060"><span class="cls_060">.expectBodyList(Taco.class)</span></div>
<div style="position:absolute;left:112.38px;top:463.34px" class="cls_061"><span class="cls_061">.contains(Arrays.copyOf(tacos, 12));</span></div>
<div style="position:absolute;left:93.18px;top:484.67px" class="cls_039"><span class="cls_039">Here you assert that the response body contains a list that has the same elements as</span></div>
<div style="position:absolute;left:93.18px;top:497.66px" class="cls_039"><span class="cls_039">the first 12 elements of the original </span><span class="cls_059">Taco</span><span class="cls_039"> array you created at the beginning of the</span></div>
<div style="position:absolute;left:93.18px;top:510.68px" class="cls_039"><span class="cls_039">test method.</span></div>
<div style="position:absolute;left:57.18px;top:532.49px" class="cls_063"><span class="cls_063">11.3.2</span></div>
<div style="position:absolute;left:93.18px;top:532.49px" class="cls_063"><span class="cls_063">Testing POST requests</span></div>
<div style="position:absolute;left:93.18px;top:549.68px" class="cls_059"><span class="cls_059">WebTestClient</span><span class="cls_039"> can do more than just test GET requests against controllers. It can</span></div>
<div style="position:absolute;left:93.18px;top:562.67px" class="cls_039"><span class="cls_039">also be used to test any kind of HTTP method, including GET, POST, PUT, PATCH,</span></div>
<div style="position:absolute;left:93.18px;top:575.69px" class="cls_039"><span class="cls_039">DELETE, and HEAD requests. Table 11.1 maps HTTP methods to </span><span class="cls_059">WebTestClient</span></div>
<div style="position:absolute;left:93.18px;top:588.68px" class="cls_039"><span class="cls_039">methods.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:201444px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background305.jpg" width="531" height="666"></div>
<div style="position:absolute;left:222.45px;top:24.35px" class="cls_055"><span class="cls_055">Testing reactive controllers</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">283</span></div>
<div style="position:absolute;left:102.18px;top:51.53px" class="cls_053"><span class="cls_053">Table 11.1</span></div>
<div style="position:absolute;left:148.71px;top:51.23px" class="cls_087"><span class="cls_087">WebTestClient</span><span class="cls_053"> tests any kind of request against Spring WebFlux controllers.</span></div>
<div style="position:absolute;left:157.50px;top:72.77px" class="cls_073"><span class="cls_073">HTTP Method</span></div>
<div style="position:absolute;left:301.56px;top:72.53px" class="cls_091"><span class="cls_091">WebTestClient</span><span class="cls_073"> method</span></div>
<div style="position:absolute;left:108.18px;top:91.94px" class="cls_074"><span class="cls_074">GET</span></div>
<div style="position:absolute;left:270.42px;top:91.94px" class="cls_060"><span class="cls_060">.get()</span></div>
<div style="position:absolute;left:108.18px;top:108.92px" class="cls_074"><span class="cls_074">POST</span></div>
<div style="position:absolute;left:270.42px;top:108.92px" class="cls_060"><span class="cls_060">.post()</span></div>
<div style="position:absolute;left:108.18px;top:125.93px" class="cls_074"><span class="cls_074">PUT</span></div>
<div style="position:absolute;left:270.42px;top:125.93px" class="cls_060"><span class="cls_060">.put()</span></div>
<div style="position:absolute;left:108.18px;top:142.94px" class="cls_074"><span class="cls_074">PATCH</span></div>
<div style="position:absolute;left:270.42px;top:142.94px" class="cls_060"><span class="cls_060">.patch()</span></div>
<div style="position:absolute;left:108.18px;top:159.95px" class="cls_074"><span class="cls_074">DELETE</span></div>
<div style="position:absolute;left:270.42px;top:159.95px" class="cls_060"><span class="cls_060">.delete()</span></div>
<div style="position:absolute;left:108.18px;top:176.93px" class="cls_074"><span class="cls_074">HEAD</span></div>
<div style="position:absolute;left:270.42px;top:176.93px" class="cls_060"><span class="cls_060">.head()</span></div>
<div style="position:absolute;left:102.18px;top:202.25px" class="cls_039"><span class="cls_039">As an example of testing another HTTP method request against a Spring WebFlux con-</span></div>
<div style="position:absolute;left:102.18px;top:215.27px" class="cls_039"><span class="cls_039">troller, let’s look at another test against </span><span class="cls_059">DesignTacoController</span><span class="cls_039">. This time, you’ll write a</span></div>
<div style="position:absolute;left:102.18px;top:228.26px" class="cls_039"><span class="cls_039">test of your API’s taco creation endpoint by submitting a POST request to /design:</span></div>
<div style="position:absolute;left:102.18px;top:247.94px" class="cls_060"><span class="cls_060">@Test</span></div>
<div style="position:absolute;left:102.18px;top:257.93px" class="cls_060"><span class="cls_060">public void shouldSaveATaco() {</span></div>
<div style="position:absolute;left:111.78px;top:267.95px" class="cls_060"><span class="cls_060">TacoRepository tacoRepo = Mockito.mock(</span></div>
<div style="position:absolute;left:169.38px;top:277.94px" class="cls_060"><span class="cls_060">TacoRepository.class);</span></div>
<div style="position:absolute;left:398.85px;top:277.58px" class="cls_067"><span class="cls_067">Sets up test data</span></div>
<div style="position:absolute;left:111.78px;top:287.93px" class="cls_060"><span class="cls_060">Mono&lt;Taco&gt; unsavedTacoMono = Mono.just(testTaco(null));</span></div>
<div style="position:absolute;left:111.78px;top:297.95px" class="cls_060"><span class="cls_060">Taco savedTaco = testTaco(null);</span></div>
<div style="position:absolute;left:111.78px;top:307.94px" class="cls_060"><span class="cls_060">savedTaco.setId(1L);</span></div>
<div style="position:absolute;left:111.78px;top:317.93px" class="cls_060"><span class="cls_060">Mono&lt;Taco&gt; savedTacoMono = Mono.just(savedTaco);</span></div>
<div style="position:absolute;left:404.10px;top:324.74px" class="cls_067"><span class="cls_067">Mocks</span></div>
<div style="position:absolute;left:111.78px;top:337.94px" class="cls_060"><span class="cls_060">when(tacoRepo.save(any())).thenReturn(savedTacoMono);</span></div>
<div style="position:absolute;left:404.10px;top:334.25px" class="cls_067"><span class="cls_067">TacoRepository</span></div>
<div style="position:absolute;left:111.78px;top:357.95px" class="cls_060"><span class="cls_060">WebTestClient testClient = WebTestClient.bindToController(</span></div>
<div style="position:absolute;left:428.91px;top:360.98px" class="cls_067"><span class="cls_067">Creates</span></div>
<div style="position:absolute;left:130.95px;top:367.94px" class="cls_060"><span class="cls_060">new DesignTacoController(tacoRepo)).build();</span></div>
<div style="position:absolute;left:428.91px;top:370.49px" class="cls_067"><span class="cls_067">WebTestClient</span></div>
<div style="position:absolute;left:111.78px;top:387.95px" class="cls_060"><span class="cls_060">testClient.post()</span></div>
<div style="position:absolute;left:268.95px;top:387.35px" class="cls_067"><span class="cls_067">POSTs a taco</span></div>
<div style="position:absolute;left:130.95px;top:397.94px" class="cls_060"><span class="cls_060">.uri("/design")</span></div>
<div style="position:absolute;left:130.95px;top:407.96px" class="cls_060"><span class="cls_060">.contentType(MediaType.APPLICATION_JSON)</span></div>
<div style="position:absolute;left:130.95px;top:417.95px" class="cls_060"><span class="cls_060">.body(unsavedTacoMono, Taco.class)</span></div>
<div style="position:absolute;left:121.38px;top:427.94px" class="cls_060"><span class="cls_060">.exchange()</span></div>
<div style="position:absolute;left:121.38px;top:437.96px" class="cls_060"><span class="cls_060">.expectStatus().isCreated()</span></div>
<div style="position:absolute;left:317.22px;top:437.87px" class="cls_067"><span class="cls_067">Verifies response</span></div>
<div style="position:absolute;left:121.38px;top:447.95px" class="cls_060"><span class="cls_060">.expectBody(Taco.class)</span></div>
<div style="position:absolute;left:130.95px;top:457.94px" class="cls_060"><span class="cls_060">.isEqualTo(savedTaco);</span></div>
<div style="position:absolute;left:102.18px;top:467.96px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:489.26px" class="cls_039"><span class="cls_039">As with the previous test method, </span><span class="cls_059">shouldSaveATaco()</span><span class="cls_039"> starts by setting up some test</span></div>
<div style="position:absolute;left:102.18px;top:502.28px" class="cls_039"><span class="cls_039">data, mocking </span><span class="cls_059">TacoRepository</span><span class="cls_039">, and building a </span><span class="cls_059">WebTestClient</span><span class="cls_039"> that’s bound to the</span></div>
<div style="position:absolute;left:102.18px;top:515.27px" class="cls_039"><span class="cls_039">controller. Then, it uses the </span><span class="cls_059">WebTestClient</span><span class="cls_039"> to submit a POST request to /design,</span></div>
<div style="position:absolute;left:102.18px;top:528.26px" class="cls_039"><span class="cls_039">with a body of type application/json and a payload that’s a JSON-serialized form of</span></div>
<div style="position:absolute;left:102.18px;top:541.28px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">Taco</span><span class="cls_039"> in the unsaved </span><span class="cls_059">Mono</span><span class="cls_039">. After performing </span><span class="cls_059">exchange()</span><span class="cls_039">, the test asserts that the</span></div>
<div style="position:absolute;left:102.18px;top:554.27px" class="cls_039"><span class="cls_039">response has an HTTP 201 (CREATED) status and a payload in the body equal to</span></div>
<div style="position:absolute;left:102.18px;top:567.29px" class="cls_039"><span class="cls_039">the saved </span><span class="cls_059">Taco</span><span class="cls_039"> object.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:202120px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background306.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">284</span></div>
<div style="position:absolute;left:192.03px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 11</span></div>
<div style="position:absolute;left:240.99px;top:24.35px" class="cls_055"><span class="cls_055">Developing reactive APIs</span></div>
<div style="position:absolute;left:57.18px;top:50.48px" class="cls_063"><span class="cls_063">11.3.3</span></div>
<div style="position:absolute;left:93.18px;top:50.48px" class="cls_063"><span class="cls_063">Testing with a live server</span></div>
<div style="position:absolute;left:93.18px;top:67.67px" class="cls_039"><span class="cls_039">The tests you’ve written so far have relied on a mock implementation of the Spring</span></div>
<div style="position:absolute;left:93.18px;top:80.66px" class="cls_039"><span class="cls_039">WebFlux framework so that a real server wouldn’t be necessary. But you may need to</span></div>
<div style="position:absolute;left:93.18px;top:93.65px" class="cls_039"><span class="cls_039">test a WebFlux controller in the context of a server like Netty or Tomcat and maybe</span></div>
<div style="position:absolute;left:93.18px;top:106.67px" class="cls_039"><span class="cls_039">with a repository or other dependencies. That is to say, you may want to write an inte-</span></div>
<div style="position:absolute;left:93.18px;top:119.66px" class="cls_039"><span class="cls_039">gration test.</span></div>
<div style="position:absolute;left:108.91px;top:132.65px" class="cls_039"><span class="cls_039">To write a </span><span class="cls_059">WebTestClient</span><span class="cls_039"> integration test, you start by annotating the test class</span></div>
<div style="position:absolute;left:93.18px;top:145.67px" class="cls_039"><span class="cls_039">with </span><span class="cls_059">@RunWith</span><span class="cls_039"> and </span><span class="cls_059">@SpringBootTest</span><span class="cls_039"> like any other Spring Boot integration test:</span></div>
<div style="position:absolute;left:93.18px;top:165.35px" class="cls_060"><span class="cls_060">@RunWith(SpringRunner.class)</span></div>
<div style="position:absolute;left:93.18px;top:175.34px" class="cls_060"><span class="cls_060">@SpringBootTest(webEnvironment=WebEnvironment.RANDOM_PORT)</span></div>
<div style="position:absolute;left:93.18px;top:185.33px" class="cls_060"><span class="cls_060">public class DesignTacoControllerWebTest {</span></div>
<div style="position:absolute;left:102.78px;top:205.34px" class="cls_060"><span class="cls_060">@Autowired</span></div>
<div style="position:absolute;left:102.78px;top:215.33px" class="cls_060"><span class="cls_060">private WebTestClient testClient;</span></div>
<div style="position:absolute;left:93.18px;top:235.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:256.67px" class="cls_039"><span class="cls_039">By setting the </span><span class="cls_059">webEnvironment</span><span class="cls_039"> attribute to </span><span class="cls_059">WebEnvironment.RANDOM_PORT</span><span class="cls_039">, you’re ask-</span></div>
<div style="position:absolute;left:93.18px;top:269.48px" class="cls_039"><span class="cls_039">ing Spring to start a running server listening on a randomly chosen port.</span><span class="cls_069"><sup>1</sup></span></div>
<div style="position:absolute;left:108.52px;top:282.65px" class="cls_039"><span class="cls_039">You’ll notice that you’ve also autowired a </span><span class="cls_059">WebTestClient</span><span class="cls_039"> into the test class. This</span></div>
<div style="position:absolute;left:93.18px;top:295.67px" class="cls_039"><span class="cls_039">not only means that you’ll no longer have to create one in your test methods, but also</span></div>
<div style="position:absolute;left:93.18px;top:308.66px" class="cls_039"><span class="cls_039">that you won’t need to specify a full URL when making requests. That’s because the</span></div>
<div style="position:absolute;left:93.18px;top:321.68px" class="cls_059"><span class="cls_059">WebTestClient</span><span class="cls_039"> will be rigged to know which port the test server is running on. Now</span></div>
<div style="position:absolute;left:93.18px;top:334.67px" class="cls_039"><span class="cls_039">you can rewrite </span><span class="cls_059">shouldReturnRecentTacos()</span><span class="cls_039"> as an integration test that uses the</span></div>
<div style="position:absolute;left:93.18px;top:347.66px" class="cls_039"><span class="cls_039">autowired </span><span class="cls_059">WebTestClient</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:367.34px" class="cls_060"><span class="cls_060">@Test</span></div>
<div style="position:absolute;left:93.18px;top:377.33px" class="cls_060"><span class="cls_060">public void shouldReturnRecentTacos() throws IOException {</span></div>
<div style="position:absolute;left:102.78px;top:387.35px" class="cls_060"><span class="cls_060">testClient.get().uri("/design/recent")</span></div>
<div style="position:absolute;left:112.38px;top:397.34px" class="cls_060"><span class="cls_060">.accept(MediaType.APPLICATION_JSON).exchange()</span></div>
<div style="position:absolute;left:112.38px;top:407.36px" class="cls_060"><span class="cls_060">.expectStatus().isOk()</span></div>
<div style="position:absolute;left:112.38px;top:417.35px" class="cls_060"><span class="cls_060">.expectBody()</span></div>
<div style="position:absolute;left:131.56px;top:427.34px" class="cls_060"><span class="cls_060">.jsonPath("$[?(@.id == 'TACO1')].name")</span></div>
<div style="position:absolute;left:150.75px;top:437.36px" class="cls_060"><span class="cls_060">.isEqualTo("Carnivore")</span></div>
<div style="position:absolute;left:131.56px;top:447.35px" class="cls_060"><span class="cls_060">.jsonPath("$[?(@.id == 'TACO2')].name")</span></div>
<div style="position:absolute;left:150.76px;top:457.34px" class="cls_060"><span class="cls_060">.isEqualTo("Bovine Bounty")</span></div>
<div style="position:absolute;left:131.56px;top:467.36px" class="cls_060"><span class="cls_060">.jsonPath("$[?(@.id == 'TACO3')].name")</span></div>
<div style="position:absolute;left:150.75px;top:477.35px" class="cls_060"><span class="cls_060">.isEqualTo("Veg-Out");</span></div>
<div style="position:absolute;left:93.18px;top:487.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:508.67px" class="cls_039"><span class="cls_039">You’ve no doubt noticed that this new version of </span><span class="cls_059">shouldReturnRecentTacos()</span><span class="cls_039"> has</span></div>
<div style="position:absolute;left:93.18px;top:521.66px" class="cls_039"><span class="cls_039">much less code. There’s no longer any need to create a </span><span class="cls_059">WebTestClient</span><span class="cls_039"> because you’ll</span></div>
<div style="position:absolute;left:93.18px;top:534.68px" class="cls_039"><span class="cls_039">be making use of the autowired instance. And there’s no need to mock </span><span class="cls_059">TacoRepository</span></div>
<div style="position:absolute;left:93.18px;top:547.67px" class="cls_039"><span class="cls_039">because Spring will create an instance of </span><span class="cls_059">DesignTacoController</span><span class="cls_039"> and inject it with a</span></div>
<div style="position:absolute;left:57.18px;top:573.50px" class="cls_070"><span class="cls_070">1</span></div>
<div style="position:absolute;left:67.90px;top:573.68px" class="cls_071"><span class="cls_071">You could have also set </span><span class="cls_060">webEnvironment</span><span class="cls_071"> to </span><span class="cls_060">WebEnvironment.DEFINED_PORT</span><span class="cls_071"> and specified a port with the</span></div>
<div style="position:absolute;left:66.18px;top:583.19px" class="cls_071"><span class="cls_071">properties attribute, but that’s generally inadvisable. Doing so opens the risk of a port clash with a concur-</span></div>
<div style="position:absolute;left:66.18px;top:592.67px" class="cls_071"><span class="cls_071">rently running server.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:202796px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background307.jpg" width="531" height="666"></div>
<div style="position:absolute;left:210.96px;top:24.35px" class="cls_055"><span class="cls_055">Consuming REST APIs reactively</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">285</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">real </span><span class="cls_059">TacoRepository</span><span class="cls_039">. In this new version of the test method, you use JSONPath expres-</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">sions to verify values served from the database.</span></div>
<div style="position:absolute;left:117.69px;top:76.67px" class="cls_059"><span class="cls_059">WebTestClient</span><span class="cls_039"> is useful when, in the course of a test, you need to consume the</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">API exposed by a WebFlux controller. But what about when your application itself</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">consumes some other API? Let’s turn our attention to the client side of Spring’s reac-</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">tive web story and see how </span><span class="cls_059">WebClient</span><span class="cls_039"> provides a REST client that deals in reactive</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">types such as </span><span class="cls_059">Mono</span><span class="cls_039"> and </span><span class="cls_059">Flux</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:66.18px;top:153.82px" class="cls_040"><span class="cls_040">11.4</span></div>
<div style="position:absolute;left:102.18px;top:153.82px" class="cls_040"><span class="cls_040">Consuming REST APIs reactively</span></div>
<div style="position:absolute;left:102.18px;top:173.15px" class="cls_039"><span class="cls_039">In chapter 7, you used </span><span class="cls_059">RestTemplate</span><span class="cls_039"> to make client requests to the Taco Cloud API.</span></div>
<div style="position:absolute;left:102.18px;top:186.17px" class="cls_059"><span class="cls_059">RestTemplate</span><span class="cls_039"> is an old-timer, having been introduced in Spring version 3.0. In its</span></div>
<div style="position:absolute;left:102.18px;top:199.16px" class="cls_039"><span class="cls_039">time, it has been used to make countless requests on behalf of the applications that</span></div>
<div style="position:absolute;left:102.18px;top:212.15px" class="cls_039"><span class="cls_039">employ it.</span></div>
<div style="position:absolute;left:118.26px;top:225.17px" class="cls_039"><span class="cls_039">But all of the methods provided by </span><span class="cls_059">RestTemplate</span><span class="cls_039"> deal in non-reactive domain</span></div>
<div style="position:absolute;left:102.18px;top:238.16px" class="cls_039"><span class="cls_039">types and collections. This means that if you want to work with a response’s data in a</span></div>
<div style="position:absolute;left:102.18px;top:251.15px" class="cls_039"><span class="cls_039">reactive way, you’ll need to wrap it with a </span><span class="cls_059">Flux</span><span class="cls_039"> or </span><span class="cls_059">Mono</span><span class="cls_039">. And if you already have a </span><span class="cls_059">Flux</span></div>
<div style="position:absolute;left:102.18px;top:264.17px" class="cls_039"><span class="cls_039">or </span><span class="cls_059">Mono</span><span class="cls_039"> and you want to send it in a POST or PUT request, then you’ll need to extract</span></div>
<div style="position:absolute;left:102.18px;top:277.16px" class="cls_039"><span class="cls_039">the data into a non-reactive type before making the request.</span></div>
<div style="position:absolute;left:117.75px;top:290.18px" class="cls_039"><span class="cls_039">It would be nice if there was a way to use </span><span class="cls_059">RestTemplate</span><span class="cls_039"> natively with reactive</span></div>
<div style="position:absolute;left:102.18px;top:303.17px" class="cls_039"><span class="cls_039">types. Fear not. Spring 5 offers </span><span class="cls_059">WebClient</span><span class="cls_039"> as a reactive alternative to </span><span class="cls_059">RestTemplate</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:102.18px;top:316.16px" class="cls_059"><span class="cls_059">WebClient</span><span class="cls_039"> lets you both send and receive reactive types when making requests to exter-</span></div>
<div style="position:absolute;left:102.18px;top:329.18px" class="cls_039"><span class="cls_039">nal APIs.</span></div>
<div style="position:absolute;left:118.11px;top:342.17px" class="cls_039"><span class="cls_039">Using </span><span class="cls_059">WebClient</span><span class="cls_039"> is quite different from using </span><span class="cls_059">RestTemplate</span><span class="cls_039">. Rather than have</span></div>
<div style="position:absolute;left:102.18px;top:355.16px" class="cls_039"><span class="cls_039">several methods to handle different kinds of requests, </span><span class="cls_059">WebClient</span><span class="cls_039"> has a fluent builder-</span></div>
<div style="position:absolute;left:102.18px;top:368.18px" class="cls_039"><span class="cls_039">style interface that lets you describe and send requests. The general usage pattern for</span></div>
<div style="position:absolute;left:102.18px;top:381.17px" class="cls_039"><span class="cls_039">working with </span><span class="cls_059">WebClient</span><span class="cls_039"> is</span></div>
<div style="position:absolute;left:117.78px;top:398.18px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Create an instance of </span><span class="cls_059">WebClient</span><span class="cls_039"> (or inject a </span><span class="cls_059">WebClient</span><span class="cls_039"> bean)</span></div>
<div style="position:absolute;left:117.78px;top:412.16px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Specify the HTTP method of the request to send</span></div>
<div style="position:absolute;left:117.78px;top:426.17px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Specify the URI and any headers that should be in the request</span></div>
<div style="position:absolute;left:117.78px;top:440.18px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Submit the request</span></div>
<div style="position:absolute;left:117.78px;top:454.16px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Consume the response</span></div>
<div style="position:absolute;left:102.18px;top:472.16px" class="cls_039"><span class="cls_039">Let’s look at several examples of </span><span class="cls_059">WebClient</span><span class="cls_039"> in action, starting with how to use </span><span class="cls_059">Web-</span></div>
<div style="position:absolute;left:102.18px;top:485.18px" class="cls_059"><span class="cls_059">Client</span><span class="cls_039"> to send HTTP GET requests.</span></div>
<div style="position:absolute;left:66.18px;top:506.99px" class="cls_063"><span class="cls_063">11.4.1</span></div>
<div style="position:absolute;left:102.18px;top:506.99px" class="cls_063"><span class="cls_063">GETting resources</span></div>
<div style="position:absolute;left:102.18px;top:524.18px" class="cls_039"><span class="cls_039">As an example of </span><span class="cls_059">WebClient</span><span class="cls_039"> usage, suppose that you need to fetch an </span><span class="cls_059">Ingredient</span></div>
<div style="position:absolute;left:102.18px;top:537.17px" class="cls_039"><span class="cls_039">object by its ID from the Taco Cloud API. Using </span><span class="cls_059">RestTemplate</span><span class="cls_039">, you might use the</span></div>
<div style="position:absolute;left:102.18px;top:550.19px" class="cls_059"><span class="cls_059">getForObject()</span><span class="cls_039"> method. But with </span><span class="cls_059">WebClient</span><span class="cls_039">, you build the request, retrieve a</span></div>
<div style="position:absolute;left:102.18px;top:563.18px" class="cls_039"><span class="cls_039">response, and then extract a </span><span class="cls_059">Mono</span><span class="cls_039"> that publishes the </span><span class="cls_059">Ingredient</span><span class="cls_039"> object:</span></div>
<div style="position:absolute;left:102.18px;top:582.86px" class="cls_060"><span class="cls_060">Mono&lt;Ingredient&gt; ingredient = WebClient.create()</span></div>
<div style="position:absolute;left:121.38px;top:592.85px" class="cls_060"><span class="cls_060">.get()</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:203472px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background308.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">286</span></div>
<div style="position:absolute;left:192.03px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 11</span></div>
<div style="position:absolute;left:240.99px;top:24.35px" class="cls_055"><span class="cls_055">Developing reactive APIs</span></div>
<div style="position:absolute;left:112.38px;top:51.32px" class="cls_060"><span class="cls_060">.uri("</span><a href="http://localhost:8080/ingredients/%7Bid%7D" "="">http://localhost:8080/ingredients/{id}"</a>, ingredientId)</div>
<div style="position:absolute;left:112.38px;top:61.34px" class="cls_060"><span class="cls_060">.retrieve()</span></div>
<div style="position:absolute;left:112.38px;top:71.33px" class="cls_060"><span class="cls_060">.bodyToMono(Ingredient.class);</span></div>
<div style="position:absolute;left:93.18px;top:91.34px" class="cls_061"><span class="cls_061">ingredient.subscribe(i -&gt; { ... })</span></div>
<div style="position:absolute;left:93.18px;top:112.67px" class="cls_039"><span class="cls_039">Here you create a new </span><span class="cls_059">WebClient</span><span class="cls_039"> instance with </span><span class="cls_059">create()</span><span class="cls_039">. Then you use </span><span class="cls_059">get()</span><span class="cls_039"> and</span></div>
<div style="position:absolute;left:93.18px;top:125.66px" class="cls_059"><span class="cls_059">uri()</span><span class="cls_039"> to define a GET request to </span><a href="http://localhost:8080/ingredients/%7Bid%7D">http://localhost:8080/ingredients/{id}</a> <span class="cls_039">, where the</span></div>
<div style="position:absolute;left:93.18px;top:138.65px" class="cls_036"><span class="cls_036">{id}</span><span class="cls_039"> placeholder will be replaced by the value in </span><span class="cls_059">ingredientId</span><span class="cls_039">. The </span><span class="cls_059">retrieve()</span></div>
<div style="position:absolute;left:93.18px;top:151.67px" class="cls_039"><span class="cls_039">method executes the request. Finally, a call to </span><span class="cls_059">bodyToMono()</span><span class="cls_039"> extracts the response’s</span></div>
<div style="position:absolute;left:93.18px;top:164.66px" class="cls_039"><span class="cls_039">body payload into a </span><span class="cls_059">Mono&lt;Ingredient&gt;</span><span class="cls_039"> on which you can continue applying addition</span></div>
<div style="position:absolute;left:93.18px;top:177.65px" class="cls_059"><span class="cls_059">Mono</span><span class="cls_039"> operations.</span></div>
<div style="position:absolute;left:109.77px;top:190.67px" class="cls_039"><span class="cls_039">To apply additional operations on the </span><span class="cls_059">Mono</span><span class="cls_039"> returned from </span><span class="cls_059">bodyToMono()</span><span class="cls_039">, it’s</span></div>
<div style="position:absolute;left:93.18px;top:203.66px" class="cls_039"><span class="cls_039">important to subscribe to it before the request will even be sent. Making requests that</span></div>
<div style="position:absolute;left:93.18px;top:216.65px" class="cls_039"><span class="cls_039">can return a collection of values is as easy. For example, the following snippet of code</span></div>
<div style="position:absolute;left:93.18px;top:229.67px" class="cls_039"><span class="cls_039">fetches all ingredients:</span></div>
<div style="position:absolute;left:93.18px;top:249.35px" class="cls_060"><span class="cls_060">Flux&lt;Ingredient&gt; ingredients = WebClient.create()</span></div>
<div style="position:absolute;left:112.38px;top:259.34px" class="cls_060"><span class="cls_060">.get()</span></div>
<div style="position:absolute;left:112.38px;top:269.33px" class="cls_060"><span class="cls_060">.uri("</span><a href="http://localhost:8080/ingredients" "="">http://localhost:8080/ingredients"</a>)</div>
<div style="position:absolute;left:112.38px;top:279.35px" class="cls_060"><span class="cls_060">.retrieve()</span></div>
<div style="position:absolute;left:112.38px;top:289.34px" class="cls_060"><span class="cls_060">.bodyToFlux(Ingredient.class);</span></div>
<div style="position:absolute;left:93.18px;top:309.35px" class="cls_061"><span class="cls_061">ingredients.subscribe(i -&gt; { ... })</span></div>
<div style="position:absolute;left:93.18px;top:330.68px" class="cls_039"><span class="cls_039">For the most part, fetching multiple items is the same as making a request for a single</span></div>
<div style="position:absolute;left:93.18px;top:343.67px" class="cls_039"><span class="cls_039">item. The big difference is that instead of using </span><span class="cls_059">bodyToMono()</span><span class="cls_039"> to extract the response’s</span></div>
<div style="position:absolute;left:93.18px;top:356.66px" class="cls_039"><span class="cls_039">body into a </span><span class="cls_059">Mono</span><span class="cls_039">, you use </span><span class="cls_059">bodyToFlux()</span><span class="cls_039"> to extract it into a </span><span class="cls_059">Flux</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:107.94px;top:369.68px" class="cls_039"><span class="cls_039">As with </span><span class="cls_059">bodyToMono()</span><span class="cls_039">, the </span><span class="cls_059">Flux</span><span class="cls_039"> returned from </span><span class="cls_059">bodyToFlux()</span><span class="cls_039"> hasn’t yet been sub-</span></div>
<div style="position:absolute;left:93.18px;top:382.67px" class="cls_039"><span class="cls_039">scribed to. This allows additional operations (filters, maps, and so forth) to be applied</span></div>
<div style="position:absolute;left:93.18px;top:395.66px" class="cls_039"><span class="cls_039">to the </span><span class="cls_059">Flux</span><span class="cls_039"> before the data starts flowing through it. Therefore, it’s important to sub-</span></div>
<div style="position:absolute;left:93.18px;top:408.68px" class="cls_039"><span class="cls_039">scribe to the resulting </span><span class="cls_059">Flux</span><span class="cls_039"> or else the request will never even be sent.</span></div>
<div style="position:absolute;left:93.18px;top:426.86px" class="cls_064"><span class="cls_064">M</span><span class="cls_065">AKING</span><span class="cls_064"> </span><span class="cls_065">REQUESTS</span><span class="cls_064"> </span><span class="cls_065">WITH</span><span class="cls_064"> </span><span class="cls_065">A</span><span class="cls_064"> </span><span class="cls_065">BASE</span><span class="cls_064"> URI</span></div>
<div style="position:absolute;left:93.18px;top:439.16px" class="cls_039"><span class="cls_039">You may find yourself using a common base URI for many different requests. In that</span></div>
<div style="position:absolute;left:93.18px;top:452.18px" class="cls_039"><span class="cls_039">case, it can be useful to create a </span><span class="cls_059">WebClient</span><span class="cls_039"> bean with a base URI and inject it any-</span></div>
<div style="position:absolute;left:93.18px;top:465.17px" class="cls_039"><span class="cls_039">where it’s needed. Such a bean could be declared like this:</span></div>
<div style="position:absolute;left:93.18px;top:484.85px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:93.18px;top:494.84px" class="cls_060"><span class="cls_060">public WebClient webClient() {</span></div>
<div style="position:absolute;left:102.78px;top:504.86px" class="cls_060"><span class="cls_060">return WebClient.create("</span><a href="http://localhost:8080/" "="">http://localhost:8080"</a>);</div>
<div style="position:absolute;left:93.18px;top:514.85px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:536.18px" class="cls_039"><span class="cls_039">Then, anywhere you need to make requests using that base URI, the </span><span class="cls_059">WebClient</span><span class="cls_039"> bean</span></div>
<div style="position:absolute;left:93.18px;top:549.17px" class="cls_039"><span class="cls_039">can be injected and used like this:</span></div>
<div style="position:absolute;left:93.18px;top:572.84px" class="cls_060"><span class="cls_060">@Autowired</span></div>
<div style="position:absolute;left:93.18px;top:582.86px" class="cls_060"><span class="cls_060">WebClient webClient;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:204148px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background309.jpg" width="531" height="666"></div>
<div style="position:absolute;left:210.96px;top:24.35px" class="cls_055"><span class="cls_055">Consuming REST APIs reactively</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">287</span></div>
<div style="position:absolute;left:102.18px;top:51.32px" class="cls_060"><span class="cls_060">public Mono&lt;Ingredient&gt; getIngredientById(String ingredientId) {</span></div>
<div style="position:absolute;left:111.77px;top:61.34px" class="cls_060"><span class="cls_060">Mono&lt;Ingredient&gt; ingredient = webClient</span></div>
<div style="position:absolute;left:121.38px;top:71.33px" class="cls_060"><span class="cls_060">.get()</span></div>
<div style="position:absolute;left:121.36px;top:81.32px" class="cls_060"><span class="cls_060">.uri("/ingredients/{id}", ingredientId)</span></div>
<div style="position:absolute;left:121.38px;top:91.34px" class="cls_060"><span class="cls_060">.retrieve()</span></div>
<div style="position:absolute;left:121.38px;top:101.33px" class="cls_060"><span class="cls_060">.bodyToMono(Ingredient.class);</span></div>
<div style="position:absolute;left:111.77px;top:121.34px" class="cls_060"><span class="cls_060">ingredient.subscribe(i -&gt; { ... })</span></div>
<div style="position:absolute;left:102.18px;top:131.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:154.67px" class="cls_039"><span class="cls_039">Because the </span><span class="cls_059">WebClient</span><span class="cls_039"> had already been created, you’re able to get right to work by</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">calling </span><span class="cls_059">get()</span><span class="cls_039">. As for the URI, you need to specify only the path relative to the base</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">URI when calling </span><span class="cls_059">uri()</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:102.18px;top:198.83px" class="cls_064"><span class="cls_064">T</span><span class="cls_065">IMING</span><span class="cls_064"> </span><span class="cls_065">OUT</span><span class="cls_064"> </span><span class="cls_065">ON</span><span class="cls_064"> </span><span class="cls_065">LONG</span><span class="cls_064">-</span><span class="cls_065">RUNNING</span><span class="cls_064"> </span><span class="cls_065">REQUESTS</span></div>
<div style="position:absolute;left:102.18px;top:211.16px" class="cls_039"><span class="cls_039">One thing that you can count on is that networks aren’t always reliable or as fast as</span></div>
<div style="position:absolute;left:102.18px;top:224.15px" class="cls_039"><span class="cls_039">you’d expect them to be. Or maybe a remote server is sluggish in handling a</span></div>
<div style="position:absolute;left:102.18px;top:237.17px" class="cls_039"><span class="cls_039">request. Ideally, a request to a remote service will return in a reasonable amount of</span></div>
<div style="position:absolute;left:102.18px;top:250.16px" class="cls_039"><span class="cls_039">time. But if not, it would be great if the client didn’t get stuck waiting on a response</span></div>
<div style="position:absolute;left:102.18px;top:263.15px" class="cls_039"><span class="cls_039">for too long.</span></div>
<div style="position:absolute;left:117.03px;top:276.17px" class="cls_039"><span class="cls_039">To avoid having your client requests held up by a sluggish network or service, you</span></div>
<div style="position:absolute;left:102.18px;top:289.16px" class="cls_039"><span class="cls_039">can use the </span><span class="cls_059">timeout()</span><span class="cls_039"> method from </span><span class="cls_059">Flux</span><span class="cls_039"> or </span><span class="cls_059">Mono</span><span class="cls_039"> to put a limit on how long you’ll</span></div>
<div style="position:absolute;left:102.18px;top:302.18px" class="cls_039"><span class="cls_039">wait for data to be published. As an example, consider how you might use </span><span class="cls_059">timeout()</span></div>
<div style="position:absolute;left:102.18px;top:315.17px" class="cls_039"><span class="cls_039">when fetching ingredient data:</span></div>
<div style="position:absolute;left:102.18px;top:335.84px" class="cls_060"><span class="cls_060">Flux&lt;Ingredient&gt; ingredients = WebClient.create()</span></div>
<div style="position:absolute;left:121.38px;top:345.83px" class="cls_060"><span class="cls_060">.get()</span></div>
<div style="position:absolute;left:121.38px;top:355.85px" class="cls_060"><span class="cls_060">.uri("</span><a href="http://localhost:8080/ingredients" "="">http://localhost:8080/ingredients"</a>)</div>
<div style="position:absolute;left:121.38px;top:365.84px" class="cls_060"><span class="cls_060">.retrieve()</span></div>
<div style="position:absolute;left:121.38px;top:375.83px" class="cls_060"><span class="cls_060">.bodyToFlux(Ingredient.class);</span></div>
<div style="position:absolute;left:102.18px;top:395.84px" class="cls_060"><span class="cls_060">ingredients</span></div>
<div style="position:absolute;left:111.78px;top:405.86px" class="cls_060"><span class="cls_060">.timeout(Duration.ofSeconds(1))</span></div>
<div style="position:absolute;left:111.78px;top:415.85px" class="cls_060"><span class="cls_060">.subscribe(</span></div>
<div style="position:absolute;left:130.96px;top:425.84px" class="cls_060"><span class="cls_060">i -&gt; { ... },</span></div>
<div style="position:absolute;left:130.96px;top:435.86px" class="cls_060"><span class="cls_060">e -&gt; {</span></div>
<div style="position:absolute;left:140.53px;top:445.85px" class="cls_060"><span class="cls_060">// handle timeout error</span></div>
<div style="position:absolute;left:130.95px;top:455.84px" class="cls_061"><span class="cls_061">})</span></div>
<div style="position:absolute;left:102.18px;top:479.18px" class="cls_039"><span class="cls_039">As you can see, before subscribing to the </span><span class="cls_059">Flux</span><span class="cls_039">, you called </span><span class="cls_059">timeout()</span><span class="cls_039">, specifying a</span></div>
<div style="position:absolute;left:102.18px;top:492.17px" class="cls_039"><span class="cls_039">duration of 1 s. If the request can be fulfilled in less than 1 s, then there’s no problem.</span></div>
<div style="position:absolute;left:102.18px;top:505.16px" class="cls_039"><span class="cls_039">But if the request is taking longer than 1 s, it’ll timeout and the error handler given as</span></div>
<div style="position:absolute;left:102.18px;top:518.18px" class="cls_039"><span class="cls_039">the second parameter to </span><span class="cls_059">subscribe()</span><span class="cls_039"> is invoked.</span></div>
<div style="position:absolute;left:66.18px;top:544.01px" class="cls_063"><span class="cls_063">11.4.2</span></div>
<div style="position:absolute;left:102.18px;top:544.01px" class="cls_063"><span class="cls_063">Sending resources</span></div>
<div style="position:absolute;left:102.18px;top:561.68px" class="cls_039"><span class="cls_039">Sending data with </span><span class="cls_059">WebClient</span><span class="cls_039"> isn’t much different from receiving data. As an example,</span></div>
<div style="position:absolute;left:102.18px;top:574.67px" class="cls_039"><span class="cls_039">let’s say that you’ve a </span><span class="cls_059">Mono&lt;Ingredient&gt;</span><span class="cls_039"> and want to send a POST request with the</span></div>
<div style="position:absolute;left:102.18px;top:587.69px" class="cls_059"><span class="cls_059">Ingredient</span><span class="cls_039"> that’s published by the </span><span class="cls_059">Mono</span><span class="cls_039"> to the URI with a relative path of /ingredients.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:204824px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background310.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">288</span></div>
<div style="position:absolute;left:192.03px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 11</span></div>
<div style="position:absolute;left:240.99px;top:24.35px" class="cls_055"><span class="cls_055">Developing reactive APIs</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">All you must do is use the </span><span class="cls_059">post()</span><span class="cls_039"> method instead of </span><span class="cls_059">get()</span><span class="cls_039"> and specify that the </span><span class="cls_059">Mono</span><span class="cls_039"> is</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">to be used to populate the request body by calling </span><span class="cls_059">body()</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:83.33px" class="cls_060"><span class="cls_060">Mono&lt;Ingredient&gt; ingredientMono = ...;</span></div>
<div style="position:absolute;left:93.18px;top:103.34px" class="cls_060"><span class="cls_060">Mono&lt;Ingredient&gt; result = webClient</span></div>
<div style="position:absolute;left:102.78px;top:113.33px" class="cls_060"><span class="cls_060">.post()</span></div>
<div style="position:absolute;left:102.78px;top:123.32px" class="cls_060"><span class="cls_060">.uri("/ingredients")</span></div>
<div style="position:absolute;left:102.78px;top:133.34px" class="cls_060"><span class="cls_060">.body(ingredientMono, Ingredient.class)</span></div>
<div style="position:absolute;left:102.78px;top:143.33px" class="cls_060"><span class="cls_060">.retrieve()</span></div>
<div style="position:absolute;left:102.78px;top:153.35px" class="cls_060"><span class="cls_060">.bodyToMono(Ingredient.class);</span></div>
<div style="position:absolute;left:93.18px;top:173.33px" class="cls_061"><span class="cls_061">result.subscribe(i -&gt; { ... })</span></div>
<div style="position:absolute;left:93.18px;top:192.65px" class="cls_039"><span class="cls_039">If you don’t have a </span><span class="cls_059">Mono</span><span class="cls_039"> or </span><span class="cls_059">Flux</span><span class="cls_039"> to send, but instead have the raw domain object on</span></div>
<div style="position:absolute;left:93.18px;top:205.67px" class="cls_039"><span class="cls_039">hand, you can use </span><span class="cls_059">syncBody()</span><span class="cls_039">. For example, suppose that instead of a </span><span class="cls_059">Mono&lt;Ingre-</span></div>
<div style="position:absolute;left:93.18px;top:218.66px" class="cls_059"><span class="cls_059">dient&gt;</span><span class="cls_039">, you have an </span><span class="cls_059">Ingredient</span><span class="cls_039"> that you want to send in the request body:</span></div>
<div style="position:absolute;left:93.18px;top:238.34px" class="cls_060"><span class="cls_060">Ingedient ingredient = ...;</span></div>
<div style="position:absolute;left:93.18px;top:258.35px" class="cls_060"><span class="cls_060">Mono&lt;Ingredient&gt; result = webClient</span></div>
<div style="position:absolute;left:102.78px;top:268.34px" class="cls_060"><span class="cls_060">.post()</span></div>
<div style="position:absolute;left:102.78px;top:278.33px" class="cls_060"><span class="cls_060">.uri("/ingredients")</span></div>
<div style="position:absolute;left:102.78px;top:288.35px" class="cls_060"><span class="cls_060">.syncBody(ingredient)</span></div>
<div style="position:absolute;left:102.78px;top:298.34px" class="cls_060"><span class="cls_060">.retrieve()</span></div>
<div style="position:absolute;left:102.78px;top:308.33px" class="cls_060"><span class="cls_060">.bodyToMono(Ingredient.class);</span></div>
<div style="position:absolute;left:93.18px;top:328.34px" class="cls_061"><span class="cls_061">result.subscribe(i -&gt; { ... })</span></div>
<div style="position:absolute;left:93.18px;top:347.66px" class="cls_039"><span class="cls_039">If instead of a POST request you want to update an </span><span class="cls_059">Ingredient</span><span class="cls_039"> with a PUT request,</span></div>
<div style="position:absolute;left:93.18px;top:360.68px" class="cls_039"><span class="cls_039">you call </span><span class="cls_059">put()</span><span class="cls_039"> instead of </span><span class="cls_059">post()</span><span class="cls_039"> and adjust the URI path accordingly:</span></div>
<div style="position:absolute;left:93.18px;top:380.33px" class="cls_060"><span class="cls_060">Mono&lt;Void&gt; result = webClient</span></div>
<div style="position:absolute;left:102.78px;top:390.35px" class="cls_060"><span class="cls_060">.put()</span></div>
<div style="position:absolute;left:102.78px;top:400.34px" class="cls_060"><span class="cls_060">.uri("/ingredients/{id}", ingredient.getId())</span></div>
<div style="position:absolute;left:102.78px;top:410.36px" class="cls_060"><span class="cls_060">.syncBody(ingredient)</span></div>
<div style="position:absolute;left:102.78px;top:420.35px" class="cls_060"><span class="cls_060">.retrieve()</span></div>
<div style="position:absolute;left:102.78px;top:430.34px" class="cls_060"><span class="cls_060">.bodyToMono(Void.class)</span></div>
<div style="position:absolute;left:102.78px;top:440.36px" class="cls_061"><span class="cls_061">.subscribe();</span></div>
<div style="position:absolute;left:93.18px;top:459.68px" class="cls_039"><span class="cls_039">PUT requests typically have empty response payloads, so you must ask </span><span class="cls_059">bodyToMono()</span></div>
<div style="position:absolute;left:93.18px;top:472.67px" class="cls_039"><span class="cls_039">to return a </span><span class="cls_059">Mono</span><span class="cls_039"> of type </span><span class="cls_059">Void</span><span class="cls_039">. On subscribing to that </span><span class="cls_059">Mono</span><span class="cls_039">, the request will be sent.</span></div>
<div style="position:absolute;left:57.18px;top:494.51px" class="cls_063"><span class="cls_063">11.4.3</span></div>
<div style="position:absolute;left:93.18px;top:494.51px" class="cls_063"><span class="cls_063">Deleting resources</span></div>
<div style="position:absolute;left:93.18px;top:511.67px" class="cls_059"><span class="cls_059">WebClient</span><span class="cls_039"> also allows the removal of resources by way of its </span><span class="cls_059">delete()</span><span class="cls_039"> method. For</span></div>
<div style="position:absolute;left:93.18px;top:524.66px" class="cls_039"><span class="cls_039">example, the following code deletes an ingredient for a given ID:</span></div>
<div style="position:absolute;left:93.18px;top:544.34px" class="cls_060"><span class="cls_060">Mono&lt;Void&gt; result = webClient</span></div>
<div style="position:absolute;left:102.78px;top:554.36px" class="cls_060"><span class="cls_060">.delete()</span></div>
<div style="position:absolute;left:102.78px;top:564.35px" class="cls_060"><span class="cls_060">.uri("/ingredients/{id}", ingredientId)</span></div>
<div style="position:absolute;left:102.78px;top:574.34px" class="cls_060"><span class="cls_060">.retrieve()</span></div>
<div style="position:absolute;left:102.78px;top:584.36px" class="cls_060"><span class="cls_060">.bodyToMono(Void.class)</span></div>
<div style="position:absolute;left:102.78px;top:594.35px" class="cls_061"><span class="cls_061">.subscribe();</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:205500px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background311.jpg" width="531" height="666"></div>
<div style="position:absolute;left:210.96px;top:24.35px" class="cls_055"><span class="cls_055">Consuming REST APIs reactively</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">289</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">As with PUT requests, DELETE requests don’t typically have a payload. Once again,</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">you return and subscribe to a </span><span class="cls_059">Mono&lt;Void&gt;</span><span class="cls_039"> to send the request.</span></div>
<div style="position:absolute;left:66.18px;top:85.49px" class="cls_063"><span class="cls_063">11.4.4</span></div>
<div style="position:absolute;left:102.18px;top:85.49px" class="cls_063"><span class="cls_063">Handling errors</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">All of the </span><span class="cls_059">WebClient</span><span class="cls_039"> examples thus far have assumed a happy ending; there were no</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">responses with 400-level or 500-level status codes. Should either kind of error statuses</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">be returned, </span><span class="cls_059">WebClient</span><span class="cls_039"> will log the failure; otherwise, it’ll silently ignore it.</span></div>
<div style="position:absolute;left:116.76px;top:141.65px" class="cls_039"><span class="cls_039">If you need to handle such errors, then a call to </span><span class="cls_059">onStatus()</span><span class="cls_039"> can be used to specify</span></div>
<div style="position:absolute;left:102.18px;top:154.67px" class="cls_039"><span class="cls_039">how various HTTP status codes should be dealt with. </span><span class="cls_059">onStatus()</span><span class="cls_039"> accepts two func-</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">tions: a predicate function, which is used to match the HTTP status, and a function</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">that, given a </span><span class="cls_059">ClientResponse</span><span class="cls_039"> object, returns a </span><span class="cls_059">Mono&lt;Throwable&gt;</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.75px;top:193.67px" class="cls_039"><span class="cls_039">To demonstrate how </span><span class="cls_059">onStatus()</span><span class="cls_039"> can be used to create a custom error handler,</span></div>
<div style="position:absolute;left:102.18px;top:206.66px" class="cls_039"><span class="cls_039">consider the following use of </span><span class="cls_059">WebClient</span><span class="cls_039"> that aims to fetch an ingredient given its ID:</span></div>
<div style="position:absolute;left:102.18px;top:226.34px" class="cls_060"><span class="cls_060">Mono&lt;Ingredient&gt; ingredientMono = webClient</span></div>
<div style="position:absolute;left:121.38px;top:236.33px" class="cls_060"><span class="cls_060">.get()</span></div>
<div style="position:absolute;left:121.38px;top:246.35px" class="cls_060"><span class="cls_060">.uri("</span><a href="http://localhost:8080/ingredients/%7Bid%7D" "="">http://localhost:8080/ingredients/{id}"</a>, ingredientId)</div>
<div style="position:absolute;left:121.38px;top:256.34px" class="cls_060"><span class="cls_060">.retrieve()</span></div>
<div style="position:absolute;left:121.38px;top:266.33px" class="cls_061"><span class="cls_061">.bodyToMono(Ingredient.class);</span></div>
<div style="position:absolute;left:102.18px;top:287.66px" class="cls_039"><span class="cls_039">As long as the value in </span><span class="cls_059">ingredientId</span><span class="cls_039"> matches a known ingredient resource, then the</span></div>
<div style="position:absolute;left:102.18px;top:300.68px" class="cls_039"><span class="cls_039">resulting </span><span class="cls_059">Mono</span><span class="cls_039"> will publish the </span><span class="cls_059">Ingredient</span><span class="cls_039"> object when it’s subscribed to. But what</span></div>
<div style="position:absolute;left:102.18px;top:313.67px" class="cls_039"><span class="cls_039">would happen if there were no matching ingredient?</span></div>
<div style="position:absolute;left:116.55px;top:326.66px" class="cls_039"><span class="cls_039">When subscribing to a </span><span class="cls_059">Mono</span><span class="cls_039"> or </span><span class="cls_059">Flux</span><span class="cls_039"> that might end in error, it’s important to regis-</span></div>
<div style="position:absolute;left:102.18px;top:339.68px" class="cls_039"><span class="cls_039">ter an error consumer as well as a data consumer in the call to </span><span class="cls_059">subscribe()</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:102.18px;top:359.33px" class="cls_060"><span class="cls_060">ingredientMono.subscribe(</span></div>
<div style="position:absolute;left:121.36px;top:369.35px" class="cls_060"><span class="cls_060">ingredient -&gt; {</span></div>
<div style="position:absolute;left:130.96px;top:379.34px" class="cls_060"><span class="cls_060">// handle the ingredient data</span></div>
<div style="position:absolute;left:121.38px;top:399.35px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:121.38px;top:409.34px" class="cls_060"><span class="cls_060">error-&gt; {</span></div>
<div style="position:absolute;left:130.96px;top:419.36px" class="cls_060"><span class="cls_060">// deal with the error</span></div>
<div style="position:absolute;left:121.38px;top:439.34px" class="cls_061"><span class="cls_061">});</span></div>
<div style="position:absolute;left:102.18px;top:460.67px" class="cls_039"><span class="cls_039">If the ingredient resource is found, then the first lambda (the data consumer) given</span></div>
<div style="position:absolute;left:102.18px;top:473.66px" class="cls_039"><span class="cls_039">to </span><span class="cls_059">subscribe()</span><span class="cls_039"> is invoked with the matching </span><span class="cls_059">Ingredient</span><span class="cls_039"> object. But if it isn’t found,</span></div>
<div style="position:absolute;left:102.18px;top:486.68px" class="cls_039"><span class="cls_039">then the request responds with a status code of HTTP 404 (NOT FOUND), which</span></div>
<div style="position:absolute;left:102.18px;top:499.67px" class="cls_039"><span class="cls_039">results in the second lambda (the error consumer) being given by default a </span><span class="cls_059">Web-</span></div>
<div style="position:absolute;left:102.18px;top:512.66px" class="cls_059"><span class="cls_059">ClientResponseException</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.39px;top:525.68px" class="cls_039"><span class="cls_039">The biggest problem with </span><span class="cls_059">WebClientResponseException</span><span class="cls_039"> is that it’s rather non-</span></div>
<div style="position:absolute;left:102.18px;top:538.67px" class="cls_039"><span class="cls_039">specific as to what may have gone wrong to cause the </span><span class="cls_059">Mono</span><span class="cls_039"> to fail. Its name suggests</span></div>
<div style="position:absolute;left:102.18px;top:551.69px" class="cls_039"><span class="cls_039">that there was an error in the response from a request made by </span><span class="cls_059">WebClient</span><span class="cls_039">, but you’ll</span></div>
<div style="position:absolute;left:102.18px;top:564.68px" class="cls_039"><span class="cls_039">need to dig into </span><span class="cls_059">WebClientResponseException</span><span class="cls_039"> to know what went wrong. And in any</span></div>
<div style="position:absolute;left:102.18px;top:577.67px" class="cls_039"><span class="cls_039">event, it would be nice if the exception given to the error consumer were more</span></div>
<div style="position:absolute;left:102.18px;top:590.69px" class="cls_039"><span class="cls_039">domain-specific instead of </span><span class="cls_059">WebClient</span><span class="cls_039">-specific.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:206176px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background312.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">290</span></div>
<div style="position:absolute;left:192.03px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 11</span></div>
<div style="position:absolute;left:240.99px;top:24.35px" class="cls_055"><span class="cls_055">Developing reactive APIs</span></div>
<div style="position:absolute;left:108.82px;top:50.66px" class="cls_039"><span class="cls_039">By adding a custom error handler, you can provide code that translates a status</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">code to a </span><span class="cls_059">Throwable</span><span class="cls_039"> of your own choosing. Let’s say that you want a failed request for</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">an ingredient resource to result in the </span><span class="cls_059">Mono</span><span class="cls_039"> completing in error with a </span><span class="cls_059">Unknown-</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_059"><span class="cls_059">IngredientException</span><span class="cls_039">. You can add a call to </span><span class="cls_059">onStatus()</span><span class="cls_039"> after the call to </span><span class="cls_059">retrieve()</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">to achieve that:</span></div>
<div style="position:absolute;left:93.18px;top:122.33px" class="cls_060"><span class="cls_060">Mono&lt;Ingredient&gt; ingredientMono = webClient</span></div>
<div style="position:absolute;left:112.38px;top:132.35px" class="cls_060"><span class="cls_060">.get()</span></div>
<div style="position:absolute;left:112.38px;top:142.34px" class="cls_060"><span class="cls_060">.uri("</span><a href="http://localhost:8080/ingredients/%7Bid%7D" "="">http://localhost:8080/ingredients/{id}"</a>, ingredientId)</div>
<div style="position:absolute;left:112.38px;top:152.33px" class="cls_060"><span class="cls_060">.retrieve()</span></div>
<div style="position:absolute;left:112.38px;top:162.35px" class="cls_060"><span class="cls_060">.onStatus(HttpStatus::is4xxClientError,</span></div>
<div style="position:absolute;left:150.75px;top:172.34px" class="cls_060"><span class="cls_060">response -&gt; Mono.just(new UnknownIngredientException()))</span></div>
<div style="position:absolute;left:112.38px;top:182.33px" class="cls_061"><span class="cls_061">.bodyToMono(Ingredient.class);</span></div>
<div style="position:absolute;left:93.18px;top:203.66px" class="cls_039"><span class="cls_039">The first argument in the </span><span class="cls_059">onStatus()</span><span class="cls_039"> call is a predicate that’s given an </span><span class="cls_059">HttpStatus</span></div>
<div style="position:absolute;left:93.18px;top:216.65px" class="cls_039"><span class="cls_039">and returns </span><span class="cls_059">true</span><span class="cls_039"> if the status code is one you want to handle. And if the status code</span></div>
<div style="position:absolute;left:93.18px;top:229.67px" class="cls_039"><span class="cls_039">matches, then the response will be returned to the function in the second argument</span></div>
<div style="position:absolute;left:93.18px;top:242.66px" class="cls_039"><span class="cls_039">to handle as it sees fit, ultimately returning a </span><span class="cls_059">Mono</span><span class="cls_039"> of type </span><span class="cls_059">Throwable</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:108.35px;top:255.65px" class="cls_039"><span class="cls_039">In the example, if the status code is a 400-level status code (for example, a client</span></div>
<div style="position:absolute;left:93.18px;top:268.67px" class="cls_039"><span class="cls_039">error), then a </span><span class="cls_059">Mono</span><span class="cls_039"> will be returned with an </span><span class="cls_059">UnknownIngredientException</span><span class="cls_039">. This</span></div>
<div style="position:absolute;left:93.18px;top:281.66px" class="cls_039"><span class="cls_039">causes the </span><span class="cls_059">ingredientMono</span><span class="cls_039"> to fail with that exception.</span></div>
<div style="position:absolute;left:108.90px;top:294.68px" class="cls_039"><span class="cls_039">Note that </span><span class="cls_059">HttpStatus::is4xxClientError</span><span class="cls_039"> is a method reference to the </span><span class="cls_059">is4xx-</span></div>
<div style="position:absolute;left:93.18px;top:307.67px" class="cls_059"><span class="cls_059">ClientError</span><span class="cls_039"> method of </span><span class="cls_059">HttpStatus</span><span class="cls_039">. It’s this method that will be invoked on the</span></div>
<div style="position:absolute;left:93.18px;top:320.66px" class="cls_039"><span class="cls_039">given </span><span class="cls_059">HttpStatus</span><span class="cls_039"> object. If you want, you can use another method on </span><span class="cls_059">HttpStatus</span><span class="cls_039"> as a</span></div>
<div style="position:absolute;left:93.18px;top:333.68px" class="cls_039"><span class="cls_039">method reference; or you can provide your own function in the form of a lambda or</span></div>
<div style="position:absolute;left:93.18px;top:346.67px" class="cls_039"><span class="cls_039">method reference that returns a </span><span class="cls_059">boolean</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:108.55px;top:359.66px" class="cls_039"><span class="cls_039">For example, you can get even more precise in your error handling by checking</span></div>
<div style="position:absolute;left:93.18px;top:372.68px" class="cls_039"><span class="cls_039">specifically for an HTTP 404 (NOT FOUND) status by changing the call to </span><span class="cls_059">onSta-</span></div>
<div style="position:absolute;left:93.18px;top:385.67px" class="cls_059"><span class="cls_059">tus()</span><span class="cls_039"> to look like this:</span></div>
<div style="position:absolute;left:93.18px;top:405.35px" class="cls_060"><span class="cls_060">Mono&lt;Ingredient&gt; ingredientMono = webClient</span></div>
<div style="position:absolute;left:112.38px;top:415.34px" class="cls_060"><span class="cls_060">.get()</span></div>
<div style="position:absolute;left:112.38px;top:425.36px" class="cls_060"><span class="cls_060">.uri("</span><a href="http://localhost:8080/ingredients/%7Bid%7D" "="">http://localhost:8080/ingredients/{id}"</a>, ingredientId)</div>
<div style="position:absolute;left:112.38px;top:435.35px" class="cls_060"><span class="cls_060">.retrieve()</span></div>
<div style="position:absolute;left:112.38px;top:445.34px" class="cls_060"><span class="cls_060">.onStatus(status -&gt; status == HttpStatus.NOT_FOUND,</span></div>
<div style="position:absolute;left:150.75px;top:455.36px" class="cls_060"><span class="cls_060">response -&gt; Mono.just(new UnknownIngredientException()))</span></div>
<div style="position:absolute;left:112.38px;top:465.35px" class="cls_061"><span class="cls_061">.bodyToMono(Ingredient.class);</span></div>
<div style="position:absolute;left:93.18px;top:486.68px" class="cls_039"><span class="cls_039">It’s also worth noting that you can have as many calls to </span><span class="cls_059">onStatus()</span><span class="cls_039"> as you need to</span></div>
<div style="position:absolute;left:93.18px;top:499.67px" class="cls_039"><span class="cls_039">handle any variety of HTTP status codes that might come back in the response.</span></div>
<div style="position:absolute;left:57.18px;top:521.51px" class="cls_063"><span class="cls_063">11.4.5</span></div>
<div style="position:absolute;left:93.18px;top:521.51px" class="cls_063"><span class="cls_063">Exchanging requests</span></div>
<div style="position:absolute;left:93.18px;top:538.67px" class="cls_039"><span class="cls_039">Up to this point, you’ve used the </span><span class="cls_059">retrieve()</span><span class="cls_039"> method to signify sending a request</span></div>
<div style="position:absolute;left:93.18px;top:551.69px" class="cls_039"><span class="cls_039">when working with </span><span class="cls_059">WebClient</span><span class="cls_039">. In those cases, the </span><span class="cls_059">retrieve()</span><span class="cls_039"> method returned an</span></div>
<div style="position:absolute;left:93.18px;top:564.68px" class="cls_039"><span class="cls_039">object of type </span><span class="cls_059">ResponseSpec</span><span class="cls_039">, through which you were able to handle the response</span></div>
<div style="position:absolute;left:93.18px;top:577.67px" class="cls_039"><span class="cls_039">with calls to methods such as </span><span class="cls_059">onStatus()</span><span class="cls_039">, </span><span class="cls_059">bodyToFlux()</span><span class="cls_039">, and </span><span class="cls_059">bodyToMono()</span><span class="cls_039">. Working</span></div>
<div style="position:absolute;left:93.18px;top:590.69px" class="cls_039"><span class="cls_039">with </span><span class="cls_059">ResponseSpec</span><span class="cls_039"> is fine for simple cases, but it’s limited in a few ways. If you need</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:206852px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background313.jpg" width="531" height="666"></div>
<div style="position:absolute;left:210.96px;top:24.35px" class="cls_055"><span class="cls_055">Consuming REST APIs reactively</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">291</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">access to the response’s headers or cookie values, for example, then </span><span class="cls_059">ResponseSpec</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">isn’t going to work for you.</span></div>
<div style="position:absolute;left:118.02px;top:76.67px" class="cls_039"><span class="cls_039">When </span><span class="cls_059">ResponseSpec</span><span class="cls_039"> comes up short, you can try calling </span><span class="cls_059">exchange()</span><span class="cls_039"> instead of</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_059"><span class="cls_059">retrieve()</span><span class="cls_039">. The </span><span class="cls_059">exchange()</span><span class="cls_039"> method returns a </span><span class="cls_059">Mono</span><span class="cls_039"> of type </span><span class="cls_059">ClientResponse</span><span class="cls_039">, on</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">which you can apply reactive operations to inspect and use data from the entire</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">response, including the payload, headers, and cookies.</span></div>
<div style="position:absolute;left:116.79px;top:128.66px" class="cls_039"><span class="cls_039">Before we look at what makes </span><span class="cls_059">exchange()</span><span class="cls_039"> different from </span><span class="cls_059">retrieve()</span><span class="cls_039">, let’s start by</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">looking at how similar they are. The following snippet of code uses a </span><span class="cls_059">WebClient</span><span class="cls_039"> and</span></div>
<div style="position:absolute;left:102.18px;top:154.67px" class="cls_059"><span class="cls_059">exchange()</span><span class="cls_039"> to fetch a single ingredient by the ingredient’s ID:</span></div>
<div style="position:absolute;left:102.18px;top:174.35px" class="cls_060"><span class="cls_060">Mono&lt;Ingredient&gt; ingredientMono = webClient</span></div>
<div style="position:absolute;left:121.38px;top:184.34px" class="cls_060"><span class="cls_060">.get()</span></div>
<div style="position:absolute;left:121.38px;top:194.33px" class="cls_060"><span class="cls_060">.uri("</span><a href="http://localhost:8080/ingredients/%7Bid%7D" "="">http://localhost:8080/ingredients/{id}"</a>, ingredientId)</div>
<div style="position:absolute;left:121.38px;top:204.35px" class="cls_060"><span class="cls_060">.exchange()</span></div>
<div style="position:absolute;left:121.38px;top:214.34px" class="cls_061"><span class="cls_061">.flatMap(cr -&gt; cr.bodyToMono(Ingredient.class));</span></div>
<div style="position:absolute;left:102.18px;top:236.66px" class="cls_039"><span class="cls_039">This is roughly equivalent to the following example that uses </span><span class="cls_059">retrieve()</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:102.18px;top:256.34px" class="cls_060"><span class="cls_060">Mono&lt;Ingredient&gt; ingredientMono = webClient</span></div>
<div style="position:absolute;left:121.38px;top:266.33px" class="cls_060"><span class="cls_060">.get()</span></div>
<div style="position:absolute;left:121.38px;top:276.35px" class="cls_060"><span class="cls_060">.uri("</span><a href="http://localhost:8080/ingredients/%7Bid%7D" "="">http://localhost:8080/ingredients/{id}"</a>, ingredientId)</div>
<div style="position:absolute;left:121.38px;top:286.34px" class="cls_060"><span class="cls_060">.retrieve()</span></div>
<div style="position:absolute;left:121.38px;top:296.33px" class="cls_061"><span class="cls_061">.bodyToMono(Ingredient.class);</span></div>
<div style="position:absolute;left:102.18px;top:318.68px" class="cls_039"><span class="cls_039">In the </span><span class="cls_059">exchange()</span><span class="cls_039"> example, rather than use the </span><span class="cls_059">ResponseSpec</span><span class="cls_039"> object’s </span><span class="cls_059">bodyToMono()</span></div>
<div style="position:absolute;left:102.18px;top:331.67px" class="cls_039"><span class="cls_039">to get a </span><span class="cls_059">Mono&lt;Ingredient&gt;</span><span class="cls_039">, you get a </span><span class="cls_059">Mono&lt;ClientResponse&gt;</span><span class="cls_039"> on which you can apply</span></div>
<div style="position:absolute;left:102.18px;top:344.66px" class="cls_039"><span class="cls_039">a flat-mapping function to map the </span><span class="cls_059">ClientResponse</span><span class="cls_039"> to a </span><span class="cls_059">Mono&lt;Ingredient&gt;</span><span class="cls_039">, which is</span></div>
<div style="position:absolute;left:102.18px;top:357.68px" class="cls_039"><span class="cls_039">flattened into the resulting </span><span class="cls_059">Mono</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.81px;top:370.67px" class="cls_039"><span class="cls_039">Now let’s see what makes </span><span class="cls_059">exchange()</span><span class="cls_039"> different. Let’s suppose that the response</span></div>
<div style="position:absolute;left:102.18px;top:383.66px" class="cls_039"><span class="cls_039">from the request might include a header named X_UNAVAILABLE with a value of</span></div>
<div style="position:absolute;left:102.18px;top:396.68px" class="cls_059"><span class="cls_059">true</span><span class="cls_039"> to indicate that (for some reason) the ingredient in question is unavailable. And</span></div>
<div style="position:absolute;left:102.18px;top:409.67px" class="cls_039"><span class="cls_039">for the sake of discussion, suppose that if that header exists, you want the resulting</span></div>
<div style="position:absolute;left:102.18px;top:422.66px" class="cls_059"><span class="cls_059">Mono</span><span class="cls_039"> to be empty—to not return anything. You can achieve this scenario by adding</span></div>
<div style="position:absolute;left:102.18px;top:435.68px" class="cls_039"><span class="cls_039">another call to </span><span class="cls_059">flatMap()</span><span class="cls_039"> such that the entire </span><span class="cls_059">WebClient</span><span class="cls_039"> call looks like this:</span></div>
<div style="position:absolute;left:102.18px;top:455.36px" class="cls_060"><span class="cls_060">Mono&lt;Ingredient&gt; ingredientMono = webClient</span></div>
<div style="position:absolute;left:121.38px;top:465.35px" class="cls_060"><span class="cls_060">.get()</span></div>
<div style="position:absolute;left:121.38px;top:475.34px" class="cls_060"><span class="cls_060">.uri("</span><a href="http://localhost:8080/ingredients/%7Bid%7D" "="">http://localhost:8080/ingredients/{id}"</a>, ingredientId)</div>
<div style="position:absolute;left:121.38px;top:485.36px" class="cls_060"><span class="cls_060">.exchange()</span></div>
<div style="position:absolute;left:121.38px;top:495.35px" class="cls_060"><span class="cls_060">.flatMap(cr -&gt; {</span></div>
<div style="position:absolute;left:130.96px;top:505.34px" class="cls_060"><span class="cls_060">if (cr.headers().header("X_UNAVAILABLE").contains("true")) {</span></div>
<div style="position:absolute;left:140.55px;top:515.36px" class="cls_060"><span class="cls_060">return Mono.empty();</span></div>
<div style="position:absolute;left:130.95px;top:525.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:130.95px;top:535.34px" class="cls_060"><span class="cls_060">return Mono.just(cr);</span></div>
<div style="position:absolute;left:121.38px;top:545.36px" class="cls_060"><span class="cls_060">})</span></div>
<div style="position:absolute;left:121.38px;top:555.35px" class="cls_061"><span class="cls_061">.flatMap(cr -&gt; cr.bodyToMono(Ingredient.class));</span></div>
<div style="position:absolute;left:102.18px;top:577.67px" class="cls_039"><span class="cls_039">The new </span><span class="cls_059">flatMap()</span><span class="cls_039"> call inspects the given </span><span class="cls_059">ClientRequest</span><span class="cls_039"> object’s headers, looking</span></div>
<div style="position:absolute;left:102.18px;top:590.69px" class="cls_039"><span class="cls_039">for a header named X_UNAVAILABLE with a value of </span><span class="cls_059">true</span><span class="cls_039">. If found, it returns an</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:207528px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background314.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">292</span></div>
<div style="position:absolute;left:192.03px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 11</span></div>
<div style="position:absolute;left:240.99px;top:24.35px" class="cls_055"><span class="cls_055">Developing reactive APIs</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">empty </span><span class="cls_059">Mono</span><span class="cls_039">. Otherwise, it returns a new </span><span class="cls_059">Mono</span><span class="cls_039"> that contains the </span><span class="cls_059">ClientResponse</span><span class="cls_039">. In</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">either event, the </span><span class="cls_059">Mono</span><span class="cls_039"> returned will be flattened into the </span><span class="cls_059">Mono</span><span class="cls_039"> that the next </span><span class="cls_059">flatMap()</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">call will operate on.</span></div>
<div style="position:absolute;left:57.18px;top:100.81px" class="cls_040"><span class="cls_040">11.5</span></div>
<div style="position:absolute;left:93.18px;top:100.81px" class="cls_040"><span class="cls_040">Securing reactive web APIs</span></div>
<div style="position:absolute;left:93.18px;top:120.17px" class="cls_039"><span class="cls_039">For as long as there has been Spring Security (and even before that when it was known</span></div>
<div style="position:absolute;left:93.18px;top:133.16px" class="cls_039"><span class="cls_039">as Acegi Security), its web security model has been built around servlet filters. After</span></div>
<div style="position:absolute;left:93.18px;top:146.15px" class="cls_039"><span class="cls_039">all, it just makes sense. If you need to intercept a request bound for a servlet-based</span></div>
<div style="position:absolute;left:93.18px;top:159.17px" class="cls_039"><span class="cls_039">web framework to ensure that the requester has proper authority, a servlet filter is an</span></div>
<div style="position:absolute;left:93.18px;top:172.16px" class="cls_039"><span class="cls_039">obvious choice. But Spring WebFlux puts a kink into that approach.</span></div>
<div style="position:absolute;left:108.66px;top:185.15px" class="cls_039"><span class="cls_039">When writing a web application with Spring WebFlux, there’s no guarantee that</span></div>
<div style="position:absolute;left:93.18px;top:198.17px" class="cls_039"><span class="cls_039">servlets are even involved. In fact, a reactive web application is debatably more likely</span></div>
<div style="position:absolute;left:93.18px;top:211.16px" class="cls_039"><span class="cls_039">to be built on Netty or some other non-servlet server. Does this mean that the servlet</span></div>
<div style="position:absolute;left:93.18px;top:224.15px" class="cls_039"><span class="cls_039">filter-based Spring Security can’t be used to secure Spring WebFlux applications?</span></div>
<div style="position:absolute;left:108.36px;top:237.17px" class="cls_039"><span class="cls_039">It’s true that using servlet filters isn’t an option when securing a Spring WebFlux</span></div>
<div style="position:absolute;left:93.18px;top:250.16px" class="cls_039"><span class="cls_039">application. But Spring Security is still up to the task. Starting with version 5.0.0,</span></div>
<div style="position:absolute;left:93.18px;top:263.15px" class="cls_039"><span class="cls_039">Spring Security can be used to secure both servlet-based Spring MVC and reactive</span></div>
<div style="position:absolute;left:93.18px;top:276.17px" class="cls_039"><span class="cls_039">Spring WebFlux applications. It does this using Spring’s </span><span class="cls_059">WebFilter</span><span class="cls_039">, a Spring-specific</span></div>
<div style="position:absolute;left:93.18px;top:289.16px" class="cls_039"><span class="cls_039">analog to servlet filters that doesn’t demand dependence on the servlet API.</span></div>
<div style="position:absolute;left:107.58px;top:302.18px" class="cls_039"><span class="cls_039">What’s even more remarkable, though, is that the configuration model for reactive</span></div>
<div style="position:absolute;left:93.18px;top:315.17px" class="cls_039"><span class="cls_039">Spring Security isn’t much different from what you saw in chapter 4. In fact, unlike</span></div>
<div style="position:absolute;left:93.18px;top:328.16px" class="cls_039"><span class="cls_039">Spring WebFlux, which has a separate dependency from Spring MVC, Spring Security</span></div>
<div style="position:absolute;left:93.18px;top:341.18px" class="cls_039"><span class="cls_039">comes as the same Spring Boot security starter, regardless of whether you intend to</span></div>
<div style="position:absolute;left:93.18px;top:354.17px" class="cls_039"><span class="cls_039">use it to secure a Spring MVC web application or one written with Spring WebFlux. As</span></div>
<div style="position:absolute;left:93.18px;top:367.16px" class="cls_039"><span class="cls_039">a reminder, here’s what the security starter looks like:</span></div>
<div style="position:absolute;left:93.18px;top:389.84px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:399.86px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:409.85px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:93.18px;top:419.84px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:93.18px;top:443.18px" class="cls_039"><span class="cls_039">That said, there are a few small differences between Spring Security’s reactive and</span></div>
<div style="position:absolute;left:93.18px;top:456.17px" class="cls_039"><span class="cls_039">non-reactive configuration models. It’s worth taking a quick look at how the two con-</span></div>
<div style="position:absolute;left:93.18px;top:469.16px" class="cls_039"><span class="cls_039">figuration models compare.</span></div>
<div style="position:absolute;left:57.18px;top:494.99px" class="cls_063"><span class="cls_063">11.5.1</span></div>
<div style="position:absolute;left:93.18px;top:494.99px" class="cls_063"><span class="cls_063">Configuring reactive web security</span></div>
<div style="position:absolute;left:93.18px;top:512.66px" class="cls_039"><span class="cls_039">As a reminder, configuring Spring Security to secure a Spring MVC web application</span></div>
<div style="position:absolute;left:93.18px;top:525.68px" class="cls_039"><span class="cls_039">typically involves creating a new configuration class that extends </span><span class="cls_059">WebSecurity-</span></div>
<div style="position:absolute;left:93.18px;top:538.67px" class="cls_059"><span class="cls_059">ConfigurerAdapter</span><span class="cls_039"> and is annotated with </span><span class="cls_059">@EnableWebSecurity</span><span class="cls_039">. Such a configuration</span></div>
<div style="position:absolute;left:93.18px;top:551.69px" class="cls_039"><span class="cls_039">class would override a </span><span class="cls_059">configuration()</span><span class="cls_039"> method to specify web security specifics such</span></div>
<div style="position:absolute;left:93.18px;top:564.68px" class="cls_039"><span class="cls_039">as what authorizations are required for certain request paths. The following simple</span></div>
<div style="position:absolute;left:93.18px;top:577.67px" class="cls_039"><span class="cls_039">Spring Security configuration class serves as a reminder of how to configure security</span></div>
<div style="position:absolute;left:93.18px;top:590.69px" class="cls_039"><span class="cls_039">for a non-reactive Spring MVC application:</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:208204px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background315.jpg" width="531" height="666"></div>
<div style="position:absolute;left:222.00px;top:24.35px" class="cls_055"><span class="cls_055">Securing reactive web APIs</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">293</span></div>
<div style="position:absolute;left:102.18px;top:51.32px" class="cls_060"><span class="cls_060">@Configuration</span></div>
<div style="position:absolute;left:102.18px;top:61.34px" class="cls_060"><span class="cls_060">@EnableWebSecurity</span></div>
<div style="position:absolute;left:102.18px;top:71.33px" class="cls_060"><span class="cls_060">public class SecurityConfig extends WebSecurityConfigurerAdapter {</span></div>
<div style="position:absolute;left:111.78px;top:91.34px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:111.78px;top:101.33px" class="cls_060"><span class="cls_060">protected void configure(HttpSecurity http) throws Exception {</span></div>
<div style="position:absolute;left:121.38px;top:111.32px" class="cls_060"><span class="cls_060">http</span></div>
<div style="position:absolute;left:130.95px;top:121.34px" class="cls_060"><span class="cls_060">.authorizeRequests()</span></div>
<div style="position:absolute;left:140.55px;top:131.33px" class="cls_060"><span class="cls_060">.antMatchers("/design", "/orders").hasAuthority("USER")</span></div>
<div style="position:absolute;left:140.55px;top:141.35px" class="cls_060"><span class="cls_060">.antMatchers("/**").permitAll();</span></div>
<div style="position:absolute;left:111.78px;top:151.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:171.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:192.65px" class="cls_039"><span class="cls_039">Now let’s see what this same configuration might look like for a reactive Spring Web-</span></div>
<div style="position:absolute;left:102.18px;top:205.67px" class="cls_039"><span class="cls_039">Flux application. The following listing shows a reactive security configuration class</span></div>
<div style="position:absolute;left:102.18px;top:218.66px" class="cls_039"><span class="cls_039">that’s roughly equivalent to the simple security configuration from before.</span></div>
<div style="position:absolute;left:114.18px;top:242.39px" class="cls_066"><span class="cls_066">Listing 11.2</span></div>
<div style="position:absolute;left:171.67px;top:242.39px" class="cls_066"><span class="cls_066">Configuring Spring Security for a Spring WebFlux application</span></div>
<div style="position:absolute;left:102.18px;top:262.25px" class="cls_060"><span class="cls_060">@Configuration</span></div>
<div style="position:absolute;left:102.18px;top:272.24px" class="cls_060"><span class="cls_060">@EnableWebFluxSecurity</span></div>
<div style="position:absolute;left:102.18px;top:282.23px" class="cls_060"><span class="cls_060">public class SecurityConfig {</span></div>
<div style="position:absolute;left:111.78px;top:302.24px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:111.78px;top:312.23px" class="cls_060"><span class="cls_060">public SecurityWebFilterChain securityWebFilterChain(</span></div>
<div style="position:absolute;left:308.47px;top:322.25px" class="cls_060"><span class="cls_060">ServerHttpSecurity http) {</span></div>
<div style="position:absolute;left:121.38px;top:332.24px" class="cls_060"><span class="cls_060">return http</span></div>
<div style="position:absolute;left:140.55px;top:342.23px" class="cls_060"><span class="cls_060">.authorizeExchange()</span></div>
<div style="position:absolute;left:150.15px;top:352.25px" class="cls_060"><span class="cls_060">.pathMatchers("/design", "/orders").hasAuthority("USER")</span></div>
<div style="position:absolute;left:150.15px;top:362.24px" class="cls_060"><span class="cls_060">.anyExchange().permitAll()</span></div>
<div style="position:absolute;left:130.95px;top:372.23px" class="cls_060"><span class="cls_060">.and()</span></div>
<div style="position:absolute;left:140.55px;top:382.25px" class="cls_060"><span class="cls_060">.build();</span></div>
<div style="position:absolute;left:111.78px;top:392.24px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:412.25px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:433.58px" class="cls_039"><span class="cls_039">As you can see, there’s a lot that’s familiar, while at the same time different. Rather</span></div>
<div style="position:absolute;left:102.18px;top:446.57px" class="cls_039"><span class="cls_039">than </span><span class="cls_059">@EnableWebSecurity</span><span class="cls_039">, this new configuration class is annotated with </span><span class="cls_059">@Enable-</span></div>
<div style="position:absolute;left:102.18px;top:459.56px" class="cls_059"><span class="cls_059">WebFluxSecurity</span><span class="cls_039">. What’s more, the configuration class doesn’t extend </span><span class="cls_059">WebSecurity-</span></div>
<div style="position:absolute;left:102.18px;top:472.58px" class="cls_059"><span class="cls_059">ConfigurerAdapter</span><span class="cls_039"> or any other base class whatsoever. Therefore, it also doesn’t</span></div>
<div style="position:absolute;left:102.18px;top:485.57px" class="cls_039"><span class="cls_039">override any </span><span class="cls_059">configure()</span><span class="cls_039"> methods.</span></div>
<div style="position:absolute;left:116.91px;top:498.56px" class="cls_039"><span class="cls_039">In place of a </span><span class="cls_059">configure()</span><span class="cls_039"> method, you declare a bean of type </span><span class="cls_059">SecurityWebFilter-</span></div>
<div style="position:absolute;left:102.27px;top:511.58px" class="cls_059"><span class="cls_059">Chain</span><span class="cls_039"> with the </span><span class="cls_059">securityWebFilterChain()</span><span class="cls_039"> method. The body of </span><span class="cls_059">securityWebFilter-</span></div>
<div style="position:absolute;left:102.27px;top:524.57px" class="cls_059"><span class="cls_059">Chain()</span><span class="cls_039"> isn’t much different from the previous configuration’s </span><span class="cls_059">configure()</span><span class="cls_039"> method,</span></div>
<div style="position:absolute;left:102.18px;top:537.56px" class="cls_039"><span class="cls_039">but there are some subtle changes.</span></div>
<div style="position:absolute;left:117.14px;top:550.58px" class="cls_039"><span class="cls_039">Primarily, the configuration is declared using a given </span><span class="cls_059">ServerHttpSecurity</span><span class="cls_039"> object</span></div>
<div style="position:absolute;left:102.18px;top:563.57px" class="cls_039"><span class="cls_039">instead of a </span><span class="cls_059">HttpSecurity</span><span class="cls_039"> object. Using the given </span><span class="cls_059">ServerHttpSecurity</span><span class="cls_039">, you can call</span></div>
<div style="position:absolute;left:102.18px;top:576.59px" class="cls_059"><span class="cls_059">authorizeExchange()</span><span class="cls_039">,  which  is  roughly  equivalent  to </span><span class="cls_059"> authorizeRequests()</span><span class="cls_039">,  to</span></div>
<div style="position:absolute;left:102.18px;top:589.58px" class="cls_039"><span class="cls_039">declare request-level security.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:208880px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background316.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">294</span></div>
<div style="position:absolute;left:192.03px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 11</span></div>
<div style="position:absolute;left:240.99px;top:24.35px" class="cls_055"><span class="cls_055">Developing reactive APIs</span></div>
<div style="position:absolute;left:105.18px;top:50.66px" class="cls_083"><span class="cls_083">NOTE</span><span class="cls_059">  ServerHttpSecurity</span><span class="cls_039"> is new to Spring Security 5 and is the reactive</span></div>
<div style="position:absolute;left:105.18px;top:62.66px" class="cls_039"><span class="cls_039">analog to </span><span class="cls_059">HttpSecurity</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:93.18px;top:82.67px" class="cls_039"><span class="cls_039">When matching paths, you can still use Ant-style wildcard paths, but do so with the</span></div>
<div style="position:absolute;left:93.18px;top:95.66px" class="cls_059"><span class="cls_059">pathMatchers()</span><span class="cls_039"> method instead of </span><span class="cls_059">antMatchers()</span><span class="cls_039">. And as a convenience, you no</span></div>
<div style="position:absolute;left:93.18px;top:108.65px" class="cls_039"><span class="cls_039">longer need to specify a catch-all Ant-style path of /** because the </span><span class="cls_059">anyExchange()</span></div>
<div style="position:absolute;left:93.18px;top:121.67px" class="cls_039"><span class="cls_039">returns the catch-all you need.</span></div>
<div style="position:absolute;left:108.49px;top:134.66px" class="cls_039"><span class="cls_039">Finally, because you’re declaring the </span><span class="cls_059">SecurityWebFilterChain</span><span class="cls_039"> as a bean instead</span></div>
<div style="position:absolute;left:93.18px;top:147.65px" class="cls_039"><span class="cls_039">of overriding a framework method, you must call the </span><span class="cls_059">build()</span><span class="cls_039"> method to assemble all</span></div>
<div style="position:absolute;left:93.18px;top:160.67px" class="cls_039"><span class="cls_039">of the security rules into the </span><span class="cls_059">SecurityWebFilterChain</span><span class="cls_039"> to be returned.</span></div>
<div style="position:absolute;left:107.69px;top:173.66px" class="cls_039"><span class="cls_039">Aside from those small differences, configuring web security isn’t that different for</span></div>
<div style="position:absolute;left:93.18px;top:186.65px" class="cls_039"><span class="cls_039">Spring WebFlux than for Spring MVC. But what about user details?</span></div>
<div style="position:absolute;left:57.18px;top:211.49px" class="cls_063"><span class="cls_063">11.5.2</span></div>
<div style="position:absolute;left:93.18px;top:211.49px" class="cls_063"><span class="cls_063">Configuring a reactive user details service</span></div>
<div style="position:absolute;left:93.18px;top:228.65px" class="cls_039"><span class="cls_039">When extending </span><span class="cls_059">WebSecurityConfigurerAdapter</span><span class="cls_039">, you override one </span><span class="cls_059">configure()</span></div>
<div style="position:absolute;left:93.18px;top:241.67px" class="cls_039"><span class="cls_039">method to declare web security rules and another </span><span class="cls_059">configure()</span><span class="cls_039"> method to configure</span></div>
<div style="position:absolute;left:93.18px;top:254.66px" class="cls_039"><span class="cls_039">authentication logic, typically by defining a </span><span class="cls_059">UserDetails</span><span class="cls_039"> object. As a reminder of</span></div>
<div style="position:absolute;left:93.18px;top:267.65px" class="cls_039"><span class="cls_039">what this looks like, consider the following overridden </span><span class="cls_059">configure()</span><span class="cls_039"> method that uses</span></div>
<div style="position:absolute;left:93.18px;top:280.67px" class="cls_039"><span class="cls_039">an injected </span><span class="cls_059">UserRepository</span><span class="cls_039"> object in an anonymous implementation of </span><span class="cls_059">UserDetails-</span></div>
<div style="position:absolute;left:93.27px;top:293.66px" class="cls_059"><span class="cls_059">Service</span><span class="cls_039"> to look up a user by username:</span></div>
<div style="position:absolute;left:93.18px;top:313.34px" class="cls_060"><span class="cls_060">@Autowired</span></div>
<div style="position:absolute;left:93.18px;top:323.33px" class="cls_060"><span class="cls_060">UserRepository userRepo;</span></div>
<div style="position:absolute;left:93.18px;top:343.34px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:93.18px;top:353.33px" class="cls_060"><span class="cls_060">protected void</span></div>
<div style="position:absolute;left:112.38px;top:363.35px" class="cls_060"><span class="cls_060">configure(AuthenticationManagerBuilder auth)</span></div>
<div style="position:absolute;left:112.38px;top:373.34px" class="cls_060"><span class="cls_060">throws Exception {</span></div>
<div style="position:absolute;left:102.78px;top:383.36px" class="cls_060"><span class="cls_060">auth</span></div>
<div style="position:absolute;left:112.38px;top:393.35px" class="cls_060"><span class="cls_060">.userDetailsService(new UserDetailsService() {</span></div>
<div style="position:absolute;left:121.95px;top:403.34px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:121.96px;top:413.36px" class="cls_060"><span class="cls_060">public UserDetails loadUserByUsername(String username)</span></div>
<div style="position:absolute;left:256.26px;top:423.35px" class="cls_060"><span class="cls_060">throws UsernameNotFoundException {</span></div>
<div style="position:absolute;left:131.56px;top:433.34px" class="cls_060"><span class="cls_060">User user = userRepo.findByUsername(username)</span></div>
<div style="position:absolute;left:131.54px;top:443.36px" class="cls_060"><span class="cls_060">if (user == null) {</span></div>
<div style="position:absolute;left:141.15px;top:453.35px" class="cls_060"><span class="cls_060">throw new UsernameNotFoundException(</span></div>
<div style="position:absolute;left:208.34px;top:463.34px" class="cls_060"><span class="cls_060">username " + not found")</span></div>
<div style="position:absolute;left:131.55px;top:473.36px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:131.55px;top:483.35px" class="cls_060"><span class="cls_060">return user.toUserDetails();</span></div>
<div style="position:absolute;left:121.95px;top:493.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:112.38px;top:503.36px" class="cls_060"><span class="cls_060">});</span></div>
<div style="position:absolute;left:93.18px;top:513.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:536.66px" class="cls_039"><span class="cls_039">In this non-reactive configuration, you override the only method required by </span><span class="cls_059">User-</span></div>
<div style="position:absolute;left:93.18px;top:549.68px" class="cls_059"><span class="cls_059">DetailsService</span><span class="cls_039">, </span><span class="cls_059">loadUserByUsername()</span><span class="cls_039">. Inside of that method, you use the given</span></div>
<div style="position:absolute;left:93.18px;top:562.67px" class="cls_059"><span class="cls_059">UserRepository</span><span class="cls_039"> to look up the user by the given username. If the name isn’t found,</span></div>
<div style="position:absolute;left:93.18px;top:575.69px" class="cls_039"><span class="cls_039">you throw a </span><span class="cls_059">UsernameNotFoundException</span><span class="cls_039">. But if it’s found, then you call a helper</span></div>
<div style="position:absolute;left:93.18px;top:588.68px" class="cls_039"><span class="cls_039">method </span><span class="cls_059">toUserDetails()</span><span class="cls_039"> to return the resulting </span><span class="cls_059">UserDetails</span><span class="cls_039"> object.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:209556px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background317.jpg" width="531" height="666"></div>
<div style="position:absolute;left:253.20px;top:24.35px" class="cls_055"><span class="cls_055">Summary</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">295</span></div>
<div style="position:absolute;left:118.11px;top:50.66px" class="cls_039"><span class="cls_039">In a reactive security configuration, you don’t override a </span><span class="cls_059">configure()</span><span class="cls_039"> method.</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">Instead, you declare a </span><span class="cls_059">ReactiveUserDetailsService</span><span class="cls_039"> bean. </span><span class="cls_059">ReactiveUserDetails-</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_059"><span class="cls_059">Service</span><span class="cls_039"> is the reactive equivalent to </span><span class="cls_059">UserDetailsService</span><span class="cls_039">. Like </span><span class="cls_059">UserDetailsService</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_059"><span class="cls_059">ReactiveUserDetailsService</span><span class="cls_039"> requires implementation of only a single method. Spe-</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">cifically, the </span><span class="cls_059">findByUsername()</span><span class="cls_039"> method returns a </span><span class="cls_059">Mono&lt;userDetails&gt;</span><span class="cls_039"> instead of a raw</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_059"><span class="cls_059">UserDetails</span><span class="cls_039"> object.</span></div>
<div style="position:absolute;left:117.62px;top:128.66px" class="cls_039"><span class="cls_039">In the following example, the </span><span class="cls_059">ReactiveUserDetailsService</span><span class="cls_039"> bean is declared to</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">use a given </span><span class="cls_059">UserRepository</span><span class="cls_039">, which is presumed to be a reactive Spring Data reposi-</span></div>
<div style="position:absolute;left:102.18px;top:154.67px" class="cls_039"><span class="cls_039">tory (which we’ll talk more about in the next chapter):</span></div>
<div style="position:absolute;left:102.18px;top:174.35px" class="cls_060"><span class="cls_060">@Service</span></div>
<div style="position:absolute;left:102.18px;top:184.34px" class="cls_060"><span class="cls_060">public ReactiveUserDetailsService userDetailsService(</span></div>
<div style="position:absolute;left:303.64px;top:194.33px" class="cls_060"><span class="cls_060">UserRepository userRepo) {</span></div>
<div style="position:absolute;left:111.77px;top:204.35px" class="cls_060"><span class="cls_060">return new ReactiveUserDetailsService() {</span></div>
<div style="position:absolute;left:121.38px;top:214.34px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:121.38px;top:224.33px" class="cls_060"><span class="cls_060">public Mono&lt;UserDetails&gt; findByUsername(String username) {</span></div>
<div style="position:absolute;left:130.95px;top:234.35px" class="cls_060"><span class="cls_060">return userRepo.findByUsername(username)</span></div>
<div style="position:absolute;left:140.53px;top:244.34px" class="cls_060"><span class="cls_060">.map(user -&gt; {</span></div>
<div style="position:absolute;left:150.15px;top:254.33px" class="cls_060"><span class="cls_060">return user.toUserDetails();</span></div>
<div style="position:absolute;left:140.55px;top:264.35px" class="cls_060"><span class="cls_060">});</span></div>
<div style="position:absolute;left:121.38px;top:274.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:284.33px" class="cls_060"><span class="cls_060">};</span></div>
<div style="position:absolute;left:102.18px;top:294.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:315.68px" class="cls_039"><span class="cls_039">Here, a </span><span class="cls_059">Mono&lt;UserDetails&gt;</span><span class="cls_039"> is returned as required, but the </span><span class="cls_059">UserRepository.findBy-</span></div>
<div style="position:absolute;left:102.18px;top:328.67px" class="cls_059"><span class="cls_059">Username()</span><span class="cls_039"> method returns a </span><span class="cls_059">Mono&lt;User&gt;</span><span class="cls_039">. Because it’s a </span><span class="cls_059">Mono</span><span class="cls_039">, you can chain opera-</span></div>
<div style="position:absolute;left:102.18px;top:341.66px" class="cls_039"><span class="cls_039">tions on it, such as a </span><span class="cls_059">map()</span><span class="cls_039"> operation to map the </span><span class="cls_059">Mono&lt;User&gt;</span><span class="cls_039"> to a </span><span class="cls_059">Mono&lt;UserDetails&gt;</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:118.07px;top:354.68px" class="cls_039"><span class="cls_039">In this case, the </span><span class="cls_059">map()</span><span class="cls_039"> operation is applied with a lambda that calls the helper</span></div>
<div style="position:absolute;left:102.18px;top:367.67px" class="cls_059"><span class="cls_059">toUserDetails()</span><span class="cls_039"> method on the </span><span class="cls_059">User</span><span class="cls_039"> object published by the </span><span class="cls_059">Mono</span><span class="cls_039">. This converts the</span></div>
<div style="position:absolute;left:102.18px;top:380.66px" class="cls_059"><span class="cls_059">User</span><span class="cls_039"> to a </span><span class="cls_059">UserDetails</span><span class="cls_039">. As a consequence, the </span><span class="cls_059">.map()</span><span class="cls_039"> operation returns a </span><span class="cls_059">Mono&lt;User-</span></div>
<div style="position:absolute;left:102.33px;top:393.68px" class="cls_059"><span class="cls_059">Details&gt;</span><span class="cls_039">, which is precisely what the </span><span class="cls_059">ReactiveUserDetailsService.findByUsername()</span></div>
<div style="position:absolute;left:102.18px;top:406.67px" class="cls_039"><span class="cls_039">requires.</span></div>
<div style="position:absolute;left:102.18px;top:427.84px" class="cls_040"><span class="cls_040">Summary</span></div>
<div style="position:absolute;left:117.78px;top:446.18px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Spring WebFlux offers a reactive web framework whose programming model</span></div>
<div style="position:absolute;left:129.78px;top:459.17px" class="cls_039"><span class="cls_039">mirrors that of Spring MVC, even sharing many of the same annotations.</span></div>
<div style="position:absolute;left:117.78px;top:473.18px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Spring 5 also offers a functional programming model as an alternative to Spring</span></div>
<div style="position:absolute;left:129.78px;top:486.17px" class="cls_039"><span class="cls_039">WebFlux.</span></div>
<div style="position:absolute;left:117.78px;top:500.18px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Reactive controllers can be tested with </span><span class="cls_059">WebTestClient</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.78px;top:514.16px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  On the client-side, Spring 5 offers </span><span class="cls_059">WebClient</span><span class="cls_039">, a reactive analog to Spring’s</span></div>
<div style="position:absolute;left:129.78px;top:527.18px" class="cls_059"><span class="cls_059">RestTemplate</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.78px;top:541.16px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Although WebFlux has some significant implications for the underlying mecha-</span></div>
<div style="position:absolute;left:129.78px;top:554.18px" class="cls_039"><span class="cls_039">nisms for securing a web application, Spring Security 5 supports reactive secu-</span></div>
<div style="position:absolute;left:129.78px;top:567.17px" class="cls_039"><span class="cls_039">rity with a programming model that isn’t dramatically different from non-</span></div>
<div style="position:absolute;left:129.78px;top:580.19px" class="cls_039"><span class="cls_039">reactive Spring MVC applications.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:210232px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background318.jpg" width="531" height="666"></div>
<div style="position:absolute;left:173.58px;top:111.83px" class="cls_014"><span class="cls_014">Persisting data reactively</span></div>
<div style="position:absolute;left:84.18px;top:264.85px" class="cls_049"><span class="cls_049">This chapter covers</span></div>
<div style="position:absolute;left:84.18px;top:283.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Spring Data’s reactive repositories</span></div>
<div style="position:absolute;left:84.18px;top:298.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Writing reactive repositories for Cassandra and</span></div>
<div style="position:absolute;left:96.18px;top:310.55px" class="cls_051"><span class="cls_051">MongoDB</span></div>
<div style="position:absolute;left:84.18px;top:325.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Adapting non-reactive repositories for reactive use</span></div>
<div style="position:absolute;left:84.18px;top:340.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Data modeling with Cassandra</span></div>
<div style="position:absolute;left:102.18px;top:410.54px" class="cls_039"><span class="cls_039">As I think about non-blocking reactive code and blocking imperative code, I start</span></div>
<div style="position:absolute;left:102.18px;top:423.53px" class="cls_039"><span class="cls_039">to think about rush hour. </span><span class="cls_036">Rush hour</span><span class="cls_039"> is strangely named. Everybody seems to be in a</span></div>
<div style="position:absolute;left:102.18px;top:436.55px" class="cls_039"><span class="cls_039">rush to get where they’re going, but usually they’re all sitting near-motionless in</span></div>
<div style="position:absolute;left:102.18px;top:449.54px" class="cls_039"><span class="cls_039">traffic. If it weren’t for everyone else on the road, I’d have no trouble getting to</span></div>
<div style="position:absolute;left:102.18px;top:462.53px" class="cls_039"><span class="cls_039">my destination.</span></div>
<div style="position:absolute;left:118.78px;top:475.55px" class="cls_039"><span class="cls_039">Even though I’m eager to get somewhere (I’m non-blocking), that doesn’t</span></div>
<div style="position:absolute;left:102.18px;top:488.54px" class="cls_039"><span class="cls_039">mean that someone else on the road isn’t blocking me somehow. There may be</span></div>
<div style="position:absolute;left:102.18px;top:501.56px" class="cls_039"><span class="cls_039">other motorists ahead who have had a fender bender and are literally blocking the</span></div>
<div style="position:absolute;left:102.18px;top:514.55px" class="cls_039"><span class="cls_039">road for other commuters. So even though my efforts to get home are essentially</span></div>
<div style="position:absolute;left:102.18px;top:527.54px" class="cls_039"><span class="cls_039">non-blocking, I’m still blocked until the accident scene is cleared up.</span></div>
<div style="position:absolute;left:116.99px;top:540.56px" class="cls_039"><span class="cls_039">In the previous chapter, you saw how to create reactive, non-blocking controllers</span></div>
<div style="position:absolute;left:102.18px;top:553.55px" class="cls_039"><span class="cls_039">with Spring WebFlux. This helps to improve scalability in the web layer. But those</span></div>
<div style="position:absolute;left:257.16px;top:596.99px" class="cls_024"><span class="cls_024">296</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:210908px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background319.jpg" width="531" height="666"></div>
<div style="position:absolute;left:193.05px;top:24.35px" class="cls_055"><span class="cls_055">Understanding Spring Data’s reactive story</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">297</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">controllers are only truly non-blocking if other components that they work with are also</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">non-blocking. If we write Spring WebFlux controllers that still depend on blocking</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">repositories, our reactive controllers will be blocked waiting for them to produce data.</span></div>
<div style="position:absolute;left:116.94px;top:89.66px" class="cls_039"><span class="cls_039">Therefore, it’s important that the entire flow of data, all the way from the control-</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">lers to the database, be reactive and non-blocking. In this chapter, you’ll see how to</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">write reactive repositories using Spring Data that follow a similar programming model</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">as those you created in chapter 3. We’ll start by taking a high-level survey of Spring</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">Data’s reactive support.</span></div>
<div style="position:absolute;left:66.18px;top:162.82px" class="cls_040"><span class="cls_040">12.1</span></div>
<div style="position:absolute;left:102.18px;top:162.82px" class="cls_040"><span class="cls_040">Understanding Spring Data’s reactive story</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">Beginning with the Spring Data Kay release train, Spring Data offered its first support</span></div>
<div style="position:absolute;left:102.18px;top:193.67px" class="cls_039"><span class="cls_039">for working with reactive repositories. This includes support for a reactive program-</span></div>
<div style="position:absolute;left:102.18px;top:206.66px" class="cls_039"><span class="cls_039">ming model when persisting data with Cassandra, MongoDB, Couchbase, or Redis.</span></div>
<div style="position:absolute;left:114.18px;top:240.50px" class="cls_075"><span class="cls_075">What’s in a name?</span></div>
<div style="position:absolute;left:114.18px;top:254.33px" class="cls_076"><span class="cls_076">Although Spring Data projects are versioned at their own pace, they’re collectively</span></div>
<div style="position:absolute;left:114.18px;top:265.34px" class="cls_076"><span class="cls_076">published in a </span><span class="cls_092">release train</span><span class="cls_076">, where each version of the release train is named for a</span></div>
<div style="position:absolute;left:114.18px;top:276.35px" class="cls_076"><span class="cls_076">significant figure in computer science.</span></div>
<div style="position:absolute;left:114.18px;top:294.35px" class="cls_076"><span class="cls_076">These names are alphabetical in nature and include names such as Babbage, Codd,</span></div>
<div style="position:absolute;left:114.18px;top:305.33px" class="cls_076"><span class="cls_076">Dijkstra, Evans, Fowler, Gosling, Hopper, and Ingalls. At the time this is being written,</span></div>
<div style="position:absolute;left:114.18px;top:316.34px" class="cls_076"><span class="cls_076">the most recent release train version is Spring Data Kay, named after Alan Kay, one</span></div>
<div style="position:absolute;left:114.18px;top:327.35px" class="cls_076"><span class="cls_076">of the designers of the Smalltalk programming language.</span></div>
<div style="position:absolute;left:102.18px;top:361.67px" class="cls_039"><span class="cls_039">You may have noticed that I failed to mention relational databases or JPA. Unfortu-</span></div>
<div style="position:absolute;left:102.18px;top:374.66px" class="cls_039"><span class="cls_039">nately, there’s no support for reactive JPA. Although relational databases are certainly</span></div>
<div style="position:absolute;left:102.18px;top:387.68px" class="cls_039"><span class="cls_039">the most prolific databases in the industry, supporting a reactive programming model</span></div>
<div style="position:absolute;left:102.18px;top:400.67px" class="cls_039"><span class="cls_039">with Spring Data JPA would require that the databases and JDBC drivers involved also</span></div>
<div style="position:absolute;left:102.18px;top:413.66px" class="cls_039"><span class="cls_039">support non-blocking reactive models. It’s unfortunate that, at least for now, there’s</span></div>
<div style="position:absolute;left:102.18px;top:426.68px" class="cls_039"><span class="cls_039">no support for working with relational databases reactively. Hopefully, this situation</span></div>
<div style="position:absolute;left:102.18px;top:439.67px" class="cls_039"><span class="cls_039">will be resolved in the near future.</span></div>
<div style="position:absolute;left:116.58px;top:452.66px" class="cls_039"><span class="cls_039">In the meantime, this chapter focuses on using Spring Data to develop repositories</span></div>
<div style="position:absolute;left:102.18px;top:465.68px" class="cls_039"><span class="cls_039">that deal in reactive types for those databases that do support a reactive model. Let’s</span></div>
<div style="position:absolute;left:102.18px;top:478.67px" class="cls_039"><span class="cls_039">see how Spring Data’s reactive model compares to its non-reactive model.</span></div>
<div style="position:absolute;left:66.18px;top:500.51px" class="cls_063"><span class="cls_063">12.1.1</span></div>
<div style="position:absolute;left:102.18px;top:500.51px" class="cls_063"><span class="cls_063">Spring Data reactive distilled</span></div>
<div style="position:absolute;left:102.18px;top:517.67px" class="cls_039"><span class="cls_039">The essence of Spring Data’s reactive story can be summed up by saying that reactive</span></div>
<div style="position:absolute;left:102.18px;top:530.66px" class="cls_039"><span class="cls_039">repositories have methods that accept and return </span><span class="cls_059">Mono</span><span class="cls_039"> and </span><span class="cls_059">Flux</span><span class="cls_039"> instead of domain</span></div>
<div style="position:absolute;left:102.18px;top:543.68px" class="cls_039"><span class="cls_039">entities and collections. A repository method that fetches </span><span class="cls_059">Ingredient</span><span class="cls_039"> objects by</span></div>
<div style="position:absolute;left:102.18px;top:556.67px" class="cls_039"><span class="cls_039">ingredient type from the backing database might be declared as follows in the reposi-</span></div>
<div style="position:absolute;left:102.18px;top:569.69px" class="cls_039"><span class="cls_039">tory interface:</span></div>
<div style="position:absolute;left:102.18px;top:592.34px" class="cls_061"><span class="cls_061">Flux&lt;Ingredient&gt; findByType(Ingredient.Type type);</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:211584px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background320.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">298</span></div>
<div style="position:absolute;left:191.76px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 12</span></div>
<div style="position:absolute;left:240.72px;top:24.35px" class="cls_055"><span class="cls_055">Persisting data reactively</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">As you can see, this </span><span class="cls_059">findByType()</span><span class="cls_039"> method returns a </span><span class="cls_059">Flux&lt;Ingredient&gt;</span><span class="cls_039"> instead of a</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_059"><span class="cls_059">List&lt;Ingredient&gt;</span><span class="cls_039"> or an </span><span class="cls_059">Iterable&lt;Ingredient&gt;</span><span class="cls_039"> as its non-reactive analog would.</span></div>
<div style="position:absolute;left:107.87px;top:76.67px" class="cls_039"><span class="cls_039">Likewise, when saving a </span><span class="cls_059">Taco</span><span class="cls_039">, the repository would have a </span><span class="cls_059">saveAll()</span><span class="cls_039"> method with</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">the following signature:</span></div>
<div style="position:absolute;left:93.18px;top:114.32px" class="cls_061"><span class="cls_061">&lt;Taco&gt; Flux&lt;Taco&gt; saveAll(Publisher&lt;Taco&gt; tacoPublisher);</span></div>
<div style="position:absolute;left:93.18px;top:138.65px" class="cls_039"><span class="cls_039">In this case, the </span><span class="cls_059">saveAll()</span><span class="cls_039"> method accepts a </span><span class="cls_059">Publisher</span><span class="cls_039"> of type </span><span class="cls_059">Taco</span><span class="cls_039"> (either a</span></div>
<div style="position:absolute;left:93.18px;top:151.67px" class="cls_059"><span class="cls_059">Mono&lt;Taco&gt;</span><span class="cls_039"> or a </span><span class="cls_059">Flux&lt;Taco&gt;</span><span class="cls_039">) and returns a </span><span class="cls_059">Flux&lt;Taco&gt;</span><span class="cls_039">. This is in contrast to a non-</span></div>
<div style="position:absolute;left:93.18px;top:164.66px" class="cls_039"><span class="cls_039">reactive repository, which would have a </span><span class="cls_059">save()</span><span class="cls_039"> method that deals with the domain</span></div>
<div style="position:absolute;left:93.18px;top:177.65px" class="cls_039"><span class="cls_039">type directly, accepting a </span><span class="cls_059">Taco</span><span class="cls_039"> object and returning the saved </span><span class="cls_059">Taco</span><span class="cls_039"> object.</span></div>
<div style="position:absolute;left:107.76px;top:190.67px" class="cls_039"><span class="cls_039">Put simply, Spring Data’s reactive repositories share a near-identical programming</span></div>
<div style="position:absolute;left:93.18px;top:203.66px" class="cls_039"><span class="cls_039">model with Spring Data’s non-reactive repositories, like those in chapter 3. The only</span></div>
<div style="position:absolute;left:93.18px;top:216.65px" class="cls_039"><span class="cls_039">material difference is that reactive repositories have methods that take and return</span></div>
<div style="position:absolute;left:93.18px;top:229.67px" class="cls_059"><span class="cls_059">Flux</span><span class="cls_039"> and </span><span class="cls_059">Mono</span><span class="cls_039"> instead of raw domain types and collections.</span></div>
<div style="position:absolute;left:57.18px;top:255.50px" class="cls_063"><span class="cls_063">12.1.2</span></div>
<div style="position:absolute;left:93.18px;top:255.50px" class="cls_063"><span class="cls_063">Converting between reactive and non-reactive types</span></div>
<div style="position:absolute;left:93.18px;top:273.17px" class="cls_039"><span class="cls_039">Before we look any further at how to write reactive repositories with Spring Data, let’s</span></div>
<div style="position:absolute;left:93.18px;top:286.16px" class="cls_039"><span class="cls_039">take a moment to address the elephant in the room. You may have an existing rela-</span></div>
<div style="position:absolute;left:93.18px;top:299.18px" class="cls_039"><span class="cls_039">tional database and it may not be practical to migrate your data to one of the four</span></div>
<div style="position:absolute;left:93.18px;top:312.17px" class="cls_039"><span class="cls_039">databases that Spring Data supports with its reactive programming model. Does that</span></div>
<div style="position:absolute;left:93.18px;top:325.16px" class="cls_039"><span class="cls_039">mean you can’t apply reactive programming in your application at all?</span></div>
<div style="position:absolute;left:107.61px;top:338.18px" class="cls_039"><span class="cls_039">Although the full benefit of reactive programming comes when you have a reactive</span></div>
<div style="position:absolute;left:93.18px;top:351.17px" class="cls_039"><span class="cls_039">model from end to end, including at the database level, there’s still some benefit to be</span></div>
<div style="position:absolute;left:93.18px;top:364.16px" class="cls_039"><span class="cls_039">had by using reactive flows on top of a non-reactive database. Even though your cho-</span></div>
<div style="position:absolute;left:93.18px;top:377.18px" class="cls_039"><span class="cls_039">sen database doesn’t support non-blocking reactive queries, you can still fetch data in</span></div>
<div style="position:absolute;left:93.18px;top:390.17px" class="cls_039"><span class="cls_039">a blocking fashion and then translate it into a reactive type as soon as possible for the</span></div>
<div style="position:absolute;left:93.18px;top:403.16px" class="cls_039"><span class="cls_039">benefit of upstream components.</span></div>
<div style="position:absolute;left:108.98px;top:416.18px" class="cls_039"><span class="cls_039">Suppose, for example, that you’re working with a relational database and using</span></div>
<div style="position:absolute;left:93.18px;top:429.17px" class="cls_039"><span class="cls_039">Spring Data JPA for persistence. Your </span><span class="cls_059">OrderRepository</span><span class="cls_039"> may have a method with the</span></div>
<div style="position:absolute;left:93.18px;top:442.16px" class="cls_039"><span class="cls_039">following signature:</span></div>
<div style="position:absolute;left:93.18px;top:466.85px" class="cls_061"><span class="cls_061">List&lt;Order&gt; findByUser(User user);</span></div>
<div style="position:absolute;left:93.18px;top:491.18px" class="cls_039"><span class="cls_039">This method will return a non-reactive </span><span class="cls_059">List&lt;Order&gt;</span><span class="cls_039"> containing all of the </span><span class="cls_059">Order</span><span class="cls_039"> enti-</span></div>
<div style="position:absolute;left:93.18px;top:504.17px" class="cls_039"><span class="cls_039">ties for a given </span><span class="cls_059">User</span><span class="cls_039">. When </span><span class="cls_059">findByUser()</span><span class="cls_039"> is called, it will block while the query is exe-</span></div>
<div style="position:absolute;left:93.18px;top:517.16px" class="cls_039"><span class="cls_039">cuted and the results are collected into </span><span class="cls_059">List</span><span class="cls_039">. Because </span><span class="cls_059">List</span><span class="cls_039"> isn’t a reactive type, you</span></div>
<div style="position:absolute;left:93.18px;top:530.18px" class="cls_039"><span class="cls_039">won’t be able to perform any of the operations afforded by </span><span class="cls_059">Flux</span><span class="cls_039"> on it. Moreover, if the</span></div>
<div style="position:absolute;left:93.18px;top:543.17px" class="cls_039"><span class="cls_039">caller is a controller, it won’t be able to work with the results reactively to achieve</span></div>
<div style="position:absolute;left:93.18px;top:556.19px" class="cls_039"><span class="cls_039">improved scalability.</span></div>
<div style="position:absolute;left:108.44px;top:569.18px" class="cls_039"><span class="cls_039">You can’t do anything about the blocking nature of invoking a method on a JPA</span></div>
<div style="position:absolute;left:93.18px;top:582.17px" class="cls_039"><span class="cls_039">repository. What you can do, however, is convert the non-reactive </span><span class="cls_059">List</span><span class="cls_039"> into a </span><span class="cls_059">Flux</span><span class="cls_039"> as</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:212260px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background321.jpg" width="531" height="666"></div>
<div style="position:absolute;left:193.05px;top:24.35px" class="cls_055"><span class="cls_055">Understanding Spring Data’s reactive story</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">299</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">soon as you receive it, so that you can deal with the results reactively from there on. To</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">do so, you simply use </span><span class="cls_059">Flux.fromIterable()</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:102.18px;top:85.34px" class="cls_060"><span class="cls_060">List&lt;Order&gt; orders = repo.findByUser(someUser);</span></div>
<div style="position:absolute;left:102.18px;top:95.33px" class="cls_061"><span class="cls_061">Flux&lt;Order&gt; orderFlux = Flux.fromIterable(orders);</span></div>
<div style="position:absolute;left:102.18px;top:117.65px" class="cls_039"><span class="cls_039">Likewise, if you were to fetch a single </span><span class="cls_059">Order</span><span class="cls_039"> by its ID, you could immediately convert it</span></div>
<div style="position:absolute;left:102.18px;top:130.67px" class="cls_039"><span class="cls_039">to a </span><span class="cls_059">Mono</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:102.18px;top:152.33px" class="cls_060"><span class="cls_060">Order order repo.findById(Long id);</span></div>
<div style="position:absolute;left:102.18px;top:162.35px" class="cls_061"><span class="cls_061">Mono&lt;Order&gt; orderMono = Mono.just(order);</span></div>
<div style="position:absolute;left:102.18px;top:182.66px" class="cls_039"><span class="cls_039">By using </span><span class="cls_059">Mono.just()</span><span class="cls_039"> and the </span><span class="cls_059">fromIterable()</span><span class="cls_039">, </span><span class="cls_059">fromArray()</span><span class="cls_039">, and </span><span class="cls_059">fromStream()</span></div>
<div style="position:absolute;left:102.18px;top:195.65px" class="cls_039"><span class="cls_039">methods of </span><span class="cls_059">Flux</span><span class="cls_039">, you can isolate the non-reactive blocking code in your repositories</span></div>
<div style="position:absolute;left:102.18px;top:208.67px" class="cls_039"><span class="cls_039">and deal with reactive types elsewhere in your application.</span></div>
<div style="position:absolute;left:117.68px;top:221.66px" class="cls_039"><span class="cls_039">What about going the other way? What if you have a </span><span class="cls_059">Mono</span><span class="cls_039"> or </span><span class="cls_059">Flux</span><span class="cls_039"> given to you</span></div>
<div style="position:absolute;left:102.18px;top:234.65px" class="cls_039"><span class="cls_039">and you need to call </span><span class="cls_059">save()</span><span class="cls_039"> on a non-reactive JPA repository? Fortunately, </span><span class="cls_059">Mono</span><span class="cls_039"> and</span></div>
<div style="position:absolute;left:102.18px;top:247.67px" class="cls_059"><span class="cls_059">Flux</span><span class="cls_039"> both have operations to extract the data that they publish into domain types or</span></div>
<div style="position:absolute;left:102.18px;top:260.66px" class="cls_039"><span class="cls_039">an </span><span class="cls_059">Iterable</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:116.49px;top:273.65px" class="cls_039"><span class="cls_039">For example, suppose a WebFlux controller accepts a </span><span class="cls_059">Mono&lt;Taco&gt;</span><span class="cls_039">, and you need to</span></div>
<div style="position:absolute;left:102.18px;top:286.67px" class="cls_039"><span class="cls_039">save it using the </span><span class="cls_059">save()</span><span class="cls_039"> method in a Spring Data JPA repository. No problem—just</span></div>
<div style="position:absolute;left:102.18px;top:299.66px" class="cls_039"><span class="cls_039">call the </span><span class="cls_059">block()</span><span class="cls_039"> method on the </span><span class="cls_059">Mono</span><span class="cls_039"> to extract the </span><span class="cls_059">Taco</span><span class="cls_039"> object:</span></div>
<div style="position:absolute;left:102.18px;top:319.34px" class="cls_060"><span class="cls_060">Taco taco = tacoMono.block();</span></div>
<div style="position:absolute;left:102.18px;top:329.33px" class="cls_061"><span class="cls_061">tacoRepo.save(taco);</span></div>
<div style="position:absolute;left:102.18px;top:349.67px" class="cls_039"><span class="cls_039">As its name implies, the </span><span class="cls_059">block()</span><span class="cls_039"> method will perform a blocking operation to per-</span></div>
<div style="position:absolute;left:102.18px;top:362.66px" class="cls_039"><span class="cls_039">form the extractions.</span></div>
<div style="position:absolute;left:116.65px;top:375.68px" class="cls_039"><span class="cls_039">As for extracting data from a </span><span class="cls_059">Flux</span><span class="cls_039">, you’ll likely want to use </span><span class="cls_059">toIterable()</span><span class="cls_039">. Let’s say</span></div>
<div style="position:absolute;left:102.18px;top:388.67px" class="cls_039"><span class="cls_039">you’re given a </span><span class="cls_059">Flux&lt;Taco&gt;</span><span class="cls_039"> and need to call </span><span class="cls_059">saveAll()</span><span class="cls_039"> on a Spring Data JPA reposi-</span></div>
<div style="position:absolute;left:102.18px;top:401.66px" class="cls_039"><span class="cls_039">tory. The following snippet of code shows how to extract an </span><span class="cls_059">Iterable&lt;Taco&gt;</span><span class="cls_039"> from a</span></div>
<div style="position:absolute;left:102.18px;top:414.68px" class="cls_059"><span class="cls_059">Flux&lt;Taco&gt;</span><span class="cls_039"> to do precisely that:</span></div>
<div style="position:absolute;left:102.18px;top:434.36px" class="cls_060"><span class="cls_060">Iterable&lt;Taco&gt; tacos = tacoFlux.toIterable();</span></div>
<div style="position:absolute;left:102.18px;top:444.35px" class="cls_061"><span class="cls_061">tacoRepo.saveAll(tacos);</span></div>
<div style="position:absolute;left:102.18px;top:464.66px" class="cls_039"><span class="cls_039">As with </span><span class="cls_059">Mono.block()</span><span class="cls_039">, </span><span class="cls_059">Flux.toIterable()</span><span class="cls_039"> blocks as it collects all the objects pub-</span></div>
<div style="position:absolute;left:102.18px;top:477.68px" class="cls_039"><span class="cls_039">lished by the </span><span class="cls_059">Flux</span><span class="cls_039"> into an </span><span class="cls_059">Iterable</span><span class="cls_039">. Because of their blocking nature, </span><span class="cls_059">Mono.block()</span></div>
<div style="position:absolute;left:102.18px;top:490.67px" class="cls_039"><span class="cls_039">and </span><span class="cls_059">Flux.toIterable()</span><span class="cls_039"> should be used sparingly and with the clear understanding</span></div>
<div style="position:absolute;left:102.18px;top:503.66px" class="cls_039"><span class="cls_039">that using them breaks out of the reactive programming model.</span></div>
<div style="position:absolute;left:117.22px;top:516.68px" class="cls_039"><span class="cls_039">Another more reactive approach that avoids a blocking extraction operation is to</span></div>
<div style="position:absolute;left:102.18px;top:529.67px" class="cls_039"><span class="cls_039">subscribe to the </span><span class="cls_059">Mono</span><span class="cls_039"> or </span><span class="cls_059">Flux</span><span class="cls_039"> and perform the desired operation on each element as</span></div>
<div style="position:absolute;left:102.18px;top:542.66px" class="cls_039"><span class="cls_039">it’s published. For example, to save all </span><span class="cls_059">Taco</span><span class="cls_039"> objects published by a </span><span class="cls_059">Flux&lt;Taco&gt;</span><span class="cls_039"> when</span></div>
<div style="position:absolute;left:102.18px;top:555.68px" class="cls_039"><span class="cls_039">the repository is non-reactive, you might do something like this:</span></div>
<div style="position:absolute;left:102.18px;top:575.36px" class="cls_060"><span class="cls_060">tacoFlux.subscribe(taco -&gt; {</span></div>
<div style="position:absolute;left:111.78px;top:585.35px" class="cls_060"><span class="cls_060">tacoRepo.save(taco);</span></div>
<div style="position:absolute;left:102.18px;top:595.34px" class="cls_061"><span class="cls_061">});</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:212936px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background322.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">300</span></div>
<div style="position:absolute;left:191.76px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 12</span></div>
<div style="position:absolute;left:240.72px;top:24.35px" class="cls_055"><span class="cls_055">Persisting data reactively</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">Even though the call to the repository’s </span><span class="cls_059">save()</span><span class="cls_039"> method is still a non-reactive blocking</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">operation, using </span><span class="cls_059">subscribe()</span><span class="cls_039"> is a more natural, reactive approach to consuming and</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">processing the data published by a </span><span class="cls_059">Flux</span><span class="cls_039"> or </span><span class="cls_059">Mono</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:107.72px;top:89.66px" class="cls_039"><span class="cls_039">But that’s enough talk about how to work with non-reactive repositories. Let’s start</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">using the real power of Spring Data’s reactive support to create reactive repositories</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">for the Taco Cloud application.</span></div>
<div style="position:absolute;left:57.18px;top:141.47px" class="cls_063"><span class="cls_063">12.1.3</span></div>
<div style="position:absolute;left:93.18px;top:141.47px" class="cls_063"><span class="cls_063">Developing reactive repositories</span></div>
<div style="position:absolute;left:93.18px;top:159.17px" class="cls_039"><span class="cls_039">As you saw in chapter 3, one of the most amazing features of Spring Data is the ability</span></div>
<div style="position:absolute;left:93.18px;top:172.16px" class="cls_039"><span class="cls_039">to declare repository interfaces and have Spring Data automatically implement them</span></div>
<div style="position:absolute;left:93.18px;top:185.15px" class="cls_039"><span class="cls_039">at runtime. In that chapter, we focused primarily on Spring Data JPA, but the same</span></div>
<div style="position:absolute;left:93.18px;top:198.17px" class="cls_039"><span class="cls_039">programming model is applicable for nonrelational databases, including Cassandra</span></div>
<div style="position:absolute;left:93.18px;top:211.16px" class="cls_039"><span class="cls_039">and MongoDB.</span></div>
<div style="position:absolute;left:108.46px;top:224.15px" class="cls_039"><span class="cls_039">Built on top of their non-reactive repository support, Spring Data Cassandra and</span></div>
<div style="position:absolute;left:93.18px;top:237.17px" class="cls_039"><span class="cls_039">Spring Data MongoDB both support a reactive model. With these databases in the</span></div>
<div style="position:absolute;left:93.18px;top:250.16px" class="cls_039"><span class="cls_039">backend providing data persistence, Spring applications can truly offer end-to-end</span></div>
<div style="position:absolute;left:93.18px;top:263.15px" class="cls_039"><span class="cls_039">reactive flows that span from the web layer to the database. Let’s start by looking at</span></div>
<div style="position:absolute;left:93.18px;top:276.17px" class="cls_039"><span class="cls_039">how to persist data to Cassandra using reactive Spring Data repositories.</span></div>
<div style="position:absolute;left:57.18px;top:297.34px" class="cls_040"><span class="cls_040">12.2</span></div>
<div style="position:absolute;left:93.18px;top:297.34px" class="cls_040"><span class="cls_040">Working with reactive Cassandra repositories</span></div>
<div style="position:absolute;left:93.18px;top:315.17px" class="cls_039"><span class="cls_039">Cassandra is a distributed, high-performance, always available, eventually consistent,</span></div>
<div style="position:absolute;left:93.18px;top:328.16px" class="cls_039"><span class="cls_039">partitioned-row-store, NoSQL database.</span></div>
<div style="position:absolute;left:109.12px;top:341.18px" class="cls_039"><span class="cls_039">That’s a mouthful of adjectives to describe a database, but each one accurately</span></div>
<div style="position:absolute;left:93.18px;top:354.17px" class="cls_039"><span class="cls_039">speaks to the power of working with Cassandra. To put it in simpler terms, Cassandra</span></div>
<div style="position:absolute;left:93.18px;top:367.16px" class="cls_039"><span class="cls_039">deals in rows of data, which are written to tables, which are partitioned across one-to-</span></div>
<div style="position:absolute;left:93.18px;top:380.18px" class="cls_039"><span class="cls_039">many distributed nodes. No single node carries all the data, but any given row may be</span></div>
<div style="position:absolute;left:93.18px;top:393.17px" class="cls_039"><span class="cls_039">replicated across multiple nodes, thus eliminating any single point of failure.</span></div>
<div style="position:absolute;left:109.63px;top:406.16px" class="cls_039"><span class="cls_039">Spring Data Cassandra provides automatic repository support for the Cassandra</span></div>
<div style="position:absolute;left:93.18px;top:419.18px" class="cls_039"><span class="cls_039">database that’s quite similar to—and yet quite different from—what’s offered by Spring</span></div>
<div style="position:absolute;left:93.18px;top:432.17px" class="cls_039"><span class="cls_039">Data JPA for relational databases. In addition, Spring Data Cassandra offers mapping</span></div>
<div style="position:absolute;left:93.18px;top:445.16px" class="cls_039"><span class="cls_039">annotations to map application domain types to the backing database structures.</span></div>
<div style="position:absolute;left:109.92px;top:458.18px" class="cls_039"><span class="cls_039">Before we explore Cassandra any further, it’s important to understand that</span></div>
<div style="position:absolute;left:93.18px;top:471.17px" class="cls_039"><span class="cls_039">although Cassandra shares many similar concepts with relational databases like Ora-</span></div>
<div style="position:absolute;left:93.18px;top:484.16px" class="cls_039"><span class="cls_039">cle and SQL Server, Cassandra isn’t a relational database and is in many ways quite a</span></div>
<div style="position:absolute;left:93.18px;top:497.18px" class="cls_039"><span class="cls_039">different beast. I’ll try to explain the idiosyncrasies of Cassandra as they pertain to</span></div>
<div style="position:absolute;left:93.18px;top:510.17px" class="cls_039"><span class="cls_039">working with Spring Data. But I encourage you to read Cassandra’s own documenta-</span></div>
<div style="position:absolute;left:93.18px;top:523.16px" class="cls_039"><span class="cls_039">tion (</span><a href="http://cassandra.apache.org/doc/latest/">http://cassandra.apache.org/doc/latest/</a> <span class="cls_039">) for a thorough understanding of what</span></div>
<div style="position:absolute;left:93.18px;top:536.18px" class="cls_039"><span class="cls_039">makes Cassandra tick.</span></div>
<div style="position:absolute;left:107.79px;top:549.17px" class="cls_039"><span class="cls_039">Let’s get started by enabling Spring Data Cassandra in the Taco Cloud project.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:213612px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background323.jpg" width="531" height="666"></div>
<div style="position:absolute;left:188.67px;top:24.35px" class="cls_055"><span class="cls_055">Working with reactive Cassandra repositories</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">301</span></div>
<div style="position:absolute;left:66.18px;top:50.48px" class="cls_063"><span class="cls_063">12.2.1</span></div>
<div style="position:absolute;left:102.18px;top:50.48px" class="cls_063"><span class="cls_063">Enabling Spring Data Cassandra</span></div>
<div style="position:absolute;left:102.18px;top:68.15px" class="cls_039"><span class="cls_039">To get started using Spring Data Cassandra’s reactive repository support, you’ll need</span></div>
<div style="position:absolute;left:102.18px;top:81.17px" class="cls_039"><span class="cls_039">to add the Spring Boot starter dependency for reactive Spring Data Cassandra. There</span></div>
<div style="position:absolute;left:102.18px;top:94.16px" class="cls_039"><span class="cls_039">are actually two separate Spring Data Cassandra starter dependencies to choose from.</span></div>
<div style="position:absolute;left:116.92px;top:107.15px" class="cls_039"><span class="cls_039">If you aren’t planning to write reactive repositories for Cassandra, you can use the</span></div>
<div style="position:absolute;left:102.18px;top:120.17px" class="cls_039"><span class="cls_039">following dependency in your build:</span></div>
<div style="position:absolute;left:102.18px;top:141.83px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:111.78px;top:151.85px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:111.78px;top:161.84px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-boot-starter-data-cassandra&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:102.18px;top:171.83px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:102.18px;top:196.16px" class="cls_039"><span class="cls_039">This dependency is also available from the Initializr by checking the Cassandra</span></div>
<div style="position:absolute;left:102.18px;top:209.15px" class="cls_039"><span class="cls_039">check box.</span></div>
<div style="position:absolute;left:116.63px;top:222.17px" class="cls_039"><span class="cls_039">In this chapter, however, we focus on writing reactive repositories, so you’ll want to</span></div>
<div style="position:absolute;left:102.18px;top:235.16px" class="cls_039"><span class="cls_039">use the other starter dependency that enables reactive Cassandra repositories:</span></div>
<div style="position:absolute;left:102.18px;top:256.85px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:111.78px;top:266.84px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:111.78px;top:276.83px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;</span></div>
<div style="position:absolute;left:121.38px;top:286.85px" class="cls_060"><span class="cls_060">spring-boot-starter-data-cassandra-reactive</span></div>
<div style="position:absolute;left:111.78px;top:296.84px" class="cls_060"><span class="cls_060">&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:102.18px;top:306.83px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:102.18px;top:331.16px" class="cls_039"><span class="cls_039">If you’re using the Spring Initializr to create your project, you can get this depen-</span></div>
<div style="position:absolute;left:102.18px;top:344.18px" class="cls_039"><span class="cls_039">dency in your build by checking the Reactive Cassandra check box.</span></div>
<div style="position:absolute;left:117.58px;top:357.17px" class="cls_039"><span class="cls_039">It’s important to understand that this dependency is in lieu of the Spring Data</span></div>
<div style="position:absolute;left:102.18px;top:370.16px" class="cls_039"><span class="cls_039">JPA starter dependency. Instead of persisting Taco Cloud data to a relational data-</span></div>
<div style="position:absolute;left:102.18px;top:383.18px" class="cls_039"><span class="cls_039">base with JPA, you’ll be using Spring Data to persist data to a Cassandra database.</span></div>
<div style="position:absolute;left:102.18px;top:396.17px" class="cls_039"><span class="cls_039">Therefore, you’ll probably want to remove the Spring Data JPA starter dependency</span></div>
<div style="position:absolute;left:102.18px;top:409.16px" class="cls_039"><span class="cls_039">and any relational database dependencies (such as JDBC drivers or the H2 depen-</span></div>
<div style="position:absolute;left:102.18px;top:422.18px" class="cls_039"><span class="cls_039">dency) from the build.</span></div>
<div style="position:absolute;left:119.34px;top:435.17px" class="cls_039"><span class="cls_039">The Spring Data Reactive Cassandra starter dependency brings a handful of</span></div>
<div style="position:absolute;left:102.18px;top:448.16px" class="cls_039"><span class="cls_039">dependencies to the project, among which are the Spring Data Cassandra library and</span></div>
<div style="position:absolute;left:102.18px;top:461.18px" class="cls_039"><span class="cls_039">Reactor. As a result of those libraries being in the runtime classpath, autoconfigura-</span></div>
<div style="position:absolute;left:102.18px;top:474.17px" class="cls_039"><span class="cls_039">tion for creating reactive Cassandra libraries is triggered. This means you’re able to</span></div>
<div style="position:absolute;left:102.18px;top:487.16px" class="cls_039"><span class="cls_039">begin writing reactive Cassandra repositories with little explicit configuration.</span></div>
<div style="position:absolute;left:117.10px;top:500.18px" class="cls_039"><span class="cls_039">You’ll need to provide a small amount of configuration, though. At the very least,</span></div>
<div style="position:absolute;left:102.18px;top:513.17px" class="cls_039"><span class="cls_039">you’ll need to configure the name of a key space within which your repositories will</span></div>
<div style="position:absolute;left:102.18px;top:526.16px" class="cls_039"><span class="cls_039">operate. To do that, you’ll first need to create such a key space.</span></div>
<div style="position:absolute;left:114.18px;top:547.19px" class="cls_083"><span class="cls_083">NOTE</span><span class="cls_039">   In Cassandra, a keyspace is a grouping of tables in a Cassandra node.</span></div>
<div style="position:absolute;left:114.18px;top:559.19px" class="cls_039"><span class="cls_039">It’s roughly analogous to how tables, views, and constraints are grouped in a</span></div>
<div style="position:absolute;left:114.18px;top:571.19px" class="cls_039"><span class="cls_039">relational database.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:214288px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background324.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">302</span></div>
<div style="position:absolute;left:191.76px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 12</span></div>
<div style="position:absolute;left:240.72px;top:24.35px" class="cls_055"><span class="cls_055">Persisting data reactively</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">Although it’s possible to configure Spring Data Cassandra to create the key space</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">automatically, it’s typically much easier to manually create it yourself (or to use an</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">existing key space). Using the Cassandra CQL (Cassandra Query Language) shell, you</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">can create a key space for the Taco Cloud application with the following </span><span class="cls_059">create</span><span class="cls_039"> </span><span class="cls_059">key-</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_059"><span class="cls_059">space</span><span class="cls_039"> command:</span></div>
<div style="position:absolute;left:93.18px;top:124.34px" class="cls_060"><span class="cls_060">cqlsh&gt; create keyspace tacocloud</span></div>
<div style="position:absolute;left:107.58px;top:134.33px" class="cls_060"><span class="cls_060">... with replication={'class':'SimpleStrategy', 'replication_factor':1}</span></div>
<div style="position:absolute;left:107.58px;top:144.35px" class="cls_061"><span class="cls_061">... and durable_writes=true;</span></div>
<div style="position:absolute;left:93.18px;top:165.65px" class="cls_039"><span class="cls_039">Put simply, this will create a key space named </span><span class="cls_059">tacocloud</span><span class="cls_039"> with simple replication and</span></div>
<div style="position:absolute;left:93.18px;top:178.67px" class="cls_039"><span class="cls_039">durable writes. By setting the replication factor to 2, you ask Cassandra to keep one</span></div>
<div style="position:absolute;left:93.18px;top:191.66px" class="cls_039"><span class="cls_039">copy of each row. The replication strategy determines how replication is handled. The</span></div>
<div style="position:absolute;left:93.18px;top:204.65px" class="cls_059"><span class="cls_059">SimpleStrategy</span><span class="cls_039"> replication strategy is fine for single data center use (and for demo</span></div>
<div style="position:absolute;left:93.18px;top:217.67px" class="cls_039"><span class="cls_039">code), but you might consider the </span><span class="cls_059">NetworkTopologyStrategy</span><span class="cls_039"> if you have your Cas-</span></div>
<div style="position:absolute;left:93.18px;top:230.66px" class="cls_039"><span class="cls_039">sandra cluster spread across multiple data centers. I refer you to the Cassandra docu-</span></div>
<div style="position:absolute;left:93.18px;top:243.65px" class="cls_039"><span class="cls_039">mentation for more details of how replication strategies work and alternative ways of</span></div>
<div style="position:absolute;left:93.18px;top:256.67px" class="cls_039"><span class="cls_039">creating key spaces.</span></div>
<div style="position:absolute;left:109.70px;top:269.66px" class="cls_039"><span class="cls_039">Now that you’ve created a key space, you need to configure the </span><span class="cls_059">spring.data</span></div>
<div style="position:absolute;left:93.18px;top:282.65px" class="cls_059"><span class="cls_059">.cassandra.keyspace-name</span><span class="cls_039"> property to tell Spring Data Cassandra to use that key space:</span></div>
<div style="position:absolute;left:93.18px;top:304.34px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:102.78px;top:314.33px" class="cls_060"><span class="cls_060">data:</span></div>
<div style="position:absolute;left:112.38px;top:324.35px" class="cls_060"><span class="cls_060">cassandra:</span></div>
<div style="position:absolute;left:121.95px;top:334.34px" class="cls_060"><span class="cls_060">keyspace-name: tacocloud</span></div>
<div style="position:absolute;left:121.95px;top:344.33px" class="cls_061"><span class="cls_061">schema-action: recreate-drop-unused</span></div>
<div style="position:absolute;left:93.18px;top:365.66px" class="cls_039"><span class="cls_039">Here, you also set the </span><span class="cls_059">spring.data.cassandra.schema-action</span><span class="cls_039"> to </span><span class="cls_059">recreate-drop-</span></div>
<div style="position:absolute;left:93.18px;top:378.68px" class="cls_059"><span class="cls_059">unused</span><span class="cls_039">. This setting is very useful for development purposes because it ensures that</span></div>
<div style="position:absolute;left:93.18px;top:391.67px" class="cls_039"><span class="cls_039">any tables and user-defined types will be dropped and recreated every time the appli-</span></div>
<div style="position:absolute;left:93.18px;top:404.66px" class="cls_039"><span class="cls_039">cation starts. The default value, </span><span class="cls_059">none</span><span class="cls_039">, takes no action against the schema and is useful</span></div>
<div style="position:absolute;left:93.18px;top:417.68px" class="cls_039"><span class="cls_039">in production settings where you’d rather not drop all tables whenever an application</span></div>
<div style="position:absolute;left:93.18px;top:430.67px" class="cls_039"><span class="cls_039">starts up.</span></div>
<div style="position:absolute;left:108.35px;top:443.66px" class="cls_039"><span class="cls_039">These are the only properties you’ll need for working with a locally running Cas-</span></div>
<div style="position:absolute;left:93.18px;top:456.68px" class="cls_039"><span class="cls_039">sandra database. In addition to these two properties, however, you may wish to set oth-</span></div>
<div style="position:absolute;left:93.18px;top:469.67px" class="cls_039"><span class="cls_039">ers, depending on how you’ve configured your Cassandra cluster.</span></div>
<div style="position:absolute;left:107.97px;top:482.66px" class="cls_039"><span class="cls_039">By default, Spring Data Cassandra assumes that Cassandra is running locally and</span></div>
<div style="position:absolute;left:93.18px;top:495.68px" class="cls_039"><span class="cls_039">listening on port 9092. If that’s not the case, as in a production setting, you may want to</span></div>
<div style="position:absolute;left:93.18px;top:508.67px" class="cls_039"><span class="cls_039">set the </span><span class="cls_059">spring.data.cassandra.contact-points</span><span class="cls_039"> and </span><span class="cls_059">spring.data.cassandra.port</span></div>
<div style="position:absolute;left:93.18px;top:521.66px" class="cls_039"><span class="cls_039">properties:</span></div>
<div style="position:absolute;left:93.18px;top:543.35px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:102.78px;top:553.34px" class="cls_060"><span class="cls_060">data:</span></div>
<div style="position:absolute;left:112.38px;top:563.36px" class="cls_060"><span class="cls_060">cassandra:</span></div>
<div style="position:absolute;left:121.95px;top:573.35px" class="cls_060"><span class="cls_060">keyspace-name: tacocloud</span></div>
<div style="position:absolute;left:121.95px;top:583.34px" class="cls_060"><span class="cls_060">contact-points:</span></div>
<div style="position:absolute;left:121.95px;top:593.36px" class="cls_060"><span class="cls_060">- casshost-1.tacocloud.com</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:214964px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background325.jpg" width="531" height="666"></div>
<div style="position:absolute;left:188.67px;top:24.35px" class="cls_055"><span class="cls_055">Working with reactive Cassandra repositories</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">303</span></div>
<div style="position:absolute;left:130.95px;top:51.32px" class="cls_060"><span class="cls_060">- casshost-2.tacocloud.com</span></div>
<div style="position:absolute;left:130.95px;top:61.34px" class="cls_060"><span class="cls_060">- casshost-3.tacocloud.com</span></div>
<div style="position:absolute;left:130.95px;top:71.33px" class="cls_061"><span class="cls_061">port: 9043</span></div>
<div style="position:absolute;left:102.18px;top:92.66px" class="cls_039"><span class="cls_039">Notice that the </span><span class="cls_059">spring.data.cassandra.contact-points</span><span class="cls_039"> property is where you iden-</span></div>
<div style="position:absolute;left:102.18px;top:105.65px" class="cls_039"><span class="cls_039">tify the hostname(s) of Cassandra. A contact point is the host where a Cassandra node</span></div>
<div style="position:absolute;left:102.18px;top:118.67px" class="cls_039"><span class="cls_039">is running. By default, it’s set to </span><span class="cls_059">localhost</span><span class="cls_039">, but you can set it to a list of hostnames. It</span></div>
<div style="position:absolute;left:102.18px;top:131.66px" class="cls_039"><span class="cls_039">will try each contact point until it’s able to connect to one. This is to ensure that</span></div>
<div style="position:absolute;left:102.18px;top:144.65px" class="cls_039"><span class="cls_039">there’s no single point of failure in the Cassandra cluster and that the application will</span></div>
<div style="position:absolute;left:102.18px;top:157.67px" class="cls_039"><span class="cls_039">be able to connect with the cluster through one of the given contact points.</span></div>
<div style="position:absolute;left:116.85px;top:170.66px" class="cls_039"><span class="cls_039">You may also need to specify a username and password for your Cassandra cluster.</span></div>
<div style="position:absolute;left:102.18px;top:183.65px" class="cls_039"><span class="cls_039">This can be done by setting the </span><span class="cls_059">spring.data.cassandra.username</span><span class="cls_039"> and </span><span class="cls_059">spring.data</span></div>
<div style="position:absolute;left:102.18px;top:196.67px" class="cls_059"><span class="cls_059">.cassandra.password</span><span class="cls_039"> properties:</span></div>
<div style="position:absolute;left:102.18px;top:218.33px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:111.78px;top:228.35px" class="cls_060"><span class="cls_060">data:</span></div>
<div style="position:absolute;left:121.38px;top:238.34px" class="cls_060"><span class="cls_060">cassandra:</span></div>
<div style="position:absolute;left:130.95px;top:258.35px" class="cls_060"><span class="cls_060">username: tacocloud</span></div>
<div style="position:absolute;left:130.95px;top:268.34px" class="cls_061"><span class="cls_061">password: s3cr3tP455w0rd</span></div>
<div style="position:absolute;left:102.18px;top:289.67px" class="cls_039"><span class="cls_039">Now that Spring Data Cassandra is enabled and configured in your project, you’re</span></div>
<div style="position:absolute;left:102.18px;top:302.66px" class="cls_039"><span class="cls_039">almost ready to map your domain types to Cassandra tables and write repositories. But</span></div>
<div style="position:absolute;left:102.18px;top:315.68px" class="cls_039"><span class="cls_039">first, let’s step back and consider a few basic points of Cassandra data modeling.</span></div>
<div style="position:absolute;left:66.18px;top:341.48px" class="cls_063"><span class="cls_063">12.2.2</span></div>
<div style="position:absolute;left:102.18px;top:341.48px" class="cls_063"><span class="cls_063">Understanding Cassandra data modeling</span></div>
<div style="position:absolute;left:102.18px;top:359.18px" class="cls_039"><span class="cls_039">As I mentioned, Cassandra is quite different from a relational database. Before you</span></div>
<div style="position:absolute;left:102.18px;top:372.17px" class="cls_039"><span class="cls_039">can start mapping your domain types to Cassandra tables, it’s important to understand</span></div>
<div style="position:absolute;left:102.18px;top:385.16px" class="cls_039"><span class="cls_039">a few of the ways that Cassandra data modeling is different from how you might model</span></div>
<div style="position:absolute;left:102.18px;top:398.18px" class="cls_039"><span class="cls_039">your data for persistence in a relational database.</span></div>
<div style="position:absolute;left:118.16px;top:411.17px" class="cls_039"><span class="cls_039">These are a few of the most important things to understand about Cassandra</span></div>
<div style="position:absolute;left:102.18px;top:424.16px" class="cls_039"><span class="cls_039">data modeling:</span></div>
<div style="position:absolute;left:117.78px;top:443.18px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Cassandra tables may have any number of columns, but not all rows will neces-</span></div>
<div style="position:absolute;left:129.78px;top:456.17px" class="cls_039"><span class="cls_039">sarily use all of those columns.</span></div>
<div style="position:absolute;left:117.78px;top:470.18px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Cassandra databases are split across multiple partitions. Any row in a given table</span></div>
<div style="position:absolute;left:129.78px;top:483.17px" class="cls_039"><span class="cls_039">may be managed by one or more partitions, but it’s unlikely that all partitions</span></div>
<div style="position:absolute;left:129.78px;top:496.16px" class="cls_039"><span class="cls_039">will have all rows.</span></div>
<div style="position:absolute;left:117.78px;top:510.17px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  A Cassandra table has two kinds of keys: partition keys and clustering keys. Hash</span></div>
<div style="position:absolute;left:129.78px;top:523.16px" class="cls_039"><span class="cls_039">operations are performed on each row’s partition key to determine which parti-</span></div>
<div style="position:absolute;left:129.78px;top:536.18px" class="cls_039"><span class="cls_039">tion(s) that row will be managed by. Clustering keys determine the order in</span></div>
<div style="position:absolute;left:129.78px;top:549.17px" class="cls_039"><span class="cls_039">which the rows are maintained within a partition (not necessarily the order that</span></div>
<div style="position:absolute;left:129.78px;top:562.19px" class="cls_039"><span class="cls_039">they may appear in the results of a query).</span></div>
<div style="position:absolute;left:117.78px;top:576.17px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Cassandra is highly optimized for read operations. As such, it’s common and desir-</span></div>
<div style="position:absolute;left:129.78px;top:589.19px" class="cls_039"><span class="cls_039">able for tables to be highly denormalized and for data to be duplicated across</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:215640px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background326.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">304</span></div>
<div style="position:absolute;left:191.76px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 12</span></div>
<div style="position:absolute;left:240.72px;top:24.35px" class="cls_055"><span class="cls_055">Persisting data reactively</span></div>
<div style="position:absolute;left:120.78px;top:50.66px" class="cls_039"><span class="cls_039">multiple tables. (For example, customer information may be kept in a customer</span></div>
<div style="position:absolute;left:120.78px;top:63.65px" class="cls_039"><span class="cls_039">table as well as duplicated in a table containing orders placed by customers.)</span></div>
<div style="position:absolute;left:93.18px;top:81.65px" class="cls_039"><span class="cls_039">Suffice it to say that adapting the Taco Cloud domain types to work with Cassandra</span></div>
<div style="position:absolute;left:93.18px;top:94.67px" class="cls_039"><span class="cls_039">won’t be a matter of simply swapping out a few JPA annotations for Cassandra annota-</span></div>
<div style="position:absolute;left:93.18px;top:107.66px" class="cls_039"><span class="cls_039">tions. You’ll have to rethink how you model the data.</span></div>
<div style="position:absolute;left:57.18px;top:129.47px" class="cls_063"><span class="cls_063">12.2.3</span></div>
<div style="position:absolute;left:93.18px;top:129.47px" class="cls_063"><span class="cls_063">Mapping domain types for Cassandra persistence</span></div>
<div style="position:absolute;left:93.18px;top:146.66px" class="cls_039"><span class="cls_039">In chapter 3, you marked up your domain types (</span><span class="cls_059">Taco</span><span class="cls_039">, </span><span class="cls_059">Ingredient</span><span class="cls_039">, </span><span class="cls_059">Order</span><span class="cls_039">, and so on)</span></div>
<div style="position:absolute;left:93.18px;top:159.65px" class="cls_039"><span class="cls_039">with annotations provided by the JPA specification. These annotations mapped your</span></div>
<div style="position:absolute;left:93.18px;top:172.67px" class="cls_039"><span class="cls_039">domain types as entities to be persisted to a relational database. Although those anno-</span></div>
<div style="position:absolute;left:93.18px;top:185.66px" class="cls_039"><span class="cls_039">tations won’t work for Cassandra persistence, Spring Data Cassandra provides its own</span></div>
<div style="position:absolute;left:93.18px;top:198.65px" class="cls_039"><span class="cls_039">set of mapping annotations for a similar purpose.</span></div>
<div style="position:absolute;left:107.77px;top:211.67px" class="cls_039"><span class="cls_039">Let’s start with the </span><span class="cls_059">Ingredient</span><span class="cls_039"> class, as it’s the simplest to map for Cassandra. The</span></div>
<div style="position:absolute;left:93.18px;top:224.66px" class="cls_039"><span class="cls_039">new Cassandra-ready </span><span class="cls_059">Ingredient</span><span class="cls_039"> class looks like this:</span></div>
<div style="position:absolute;left:93.18px;top:244.34px" class="cls_060"><span class="cls_060">package tacos;</span></div>
<div style="position:absolute;left:93.18px;top:254.33px" class="cls_060"><span class="cls_060">import org.springframework.data.cassandra.core.mapping.PrimaryKey;</span></div>
<div style="position:absolute;left:93.18px;top:264.35px" class="cls_060"><span class="cls_060">import org.springframework.data.cassandra.core.mapping.Table;</span></div>
<div style="position:absolute;left:93.18px;top:274.34px" class="cls_060"><span class="cls_060">import lombok.AccessLevel;</span></div>
<div style="position:absolute;left:93.18px;top:284.33px" class="cls_060"><span class="cls_060">import lombok.Data;</span></div>
<div style="position:absolute;left:93.18px;top:294.35px" class="cls_060"><span class="cls_060">import lombok.NoArgsConstructor;</span></div>
<div style="position:absolute;left:93.18px;top:304.34px" class="cls_060"><span class="cls_060">import lombok.RequiredArgsConstructor;</span></div>
<div style="position:absolute;left:93.18px;top:320.33px" class="cls_060"><span class="cls_060">@Data</span></div>
<div style="position:absolute;left:93.18px;top:330.35px" class="cls_060"><span class="cls_060">@RequiredArgsConstructor</span></div>
<div style="position:absolute;left:93.18px;top:340.34px" class="cls_060"><span class="cls_060">@NoArgsConstructor(access=AccessLevel.PRIVATE, force=true)</span></div>
<div style="position:absolute;left:93.18px;top:350.33px" class="cls_060"><span class="cls_060">@Table("ingredients")</span></div>
<div style="position:absolute;left:93.18px;top:360.35px" class="cls_060"><span class="cls_060">public class Ingredient {</span></div>
<div style="position:absolute;left:102.78px;top:377.33px" class="cls_060"><span class="cls_060">@PrimaryKey</span></div>
<div style="position:absolute;left:102.78px;top:387.35px" class="cls_060"><span class="cls_060">private final String id;</span></div>
<div style="position:absolute;left:102.78px;top:397.34px" class="cls_060"><span class="cls_060">private final String name;</span></div>
<div style="position:absolute;left:102.78px;top:407.36px" class="cls_060"><span class="cls_060">private final Type type;</span></div>
<div style="position:absolute;left:102.78px;top:424.34px" class="cls_060"><span class="cls_060">public static enum Type {</span></div>
<div style="position:absolute;left:112.38px;top:434.36px" class="cls_060"><span class="cls_060">WRAP, PROTEIN, VEGGIES, CHEESE, SAUCE</span></div>
<div style="position:absolute;left:102.78px;top:444.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:464.36px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:488.66px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">Ingredient</span><span class="cls_039"> class seems to contradict everything I said about just swapping out a</span></div>
<div style="position:absolute;left:93.18px;top:501.68px" class="cls_039"><span class="cls_039">few annotations. Rather than annotating the class with </span><span class="cls_059">@Entity</span><span class="cls_039"> as you did for JPA per-</span></div>
<div style="position:absolute;left:93.18px;top:514.67px" class="cls_039"><span class="cls_039">sistence, it’s annotated with </span><span class="cls_059">@Table</span><span class="cls_039"> to indicate that ingredients should be persisted to</span></div>
<div style="position:absolute;left:93.18px;top:527.66px" class="cls_039"><span class="cls_039">a table named </span><span class="cls_059">ingredients</span><span class="cls_039">. And rather than annotate the </span><span class="cls_059">id</span><span class="cls_039"> property with </span><span class="cls_059">@Id</span><span class="cls_039">, this</span></div>
<div style="position:absolute;left:93.18px;top:540.68px" class="cls_039"><span class="cls_039">time it’s annotated with </span><span class="cls_059">@PrimaryKey</span><span class="cls_039">. So far, it seems that you’re only swapping out a</span></div>
<div style="position:absolute;left:93.18px;top:553.67px" class="cls_039"><span class="cls_039">few annotations.</span></div>
<div style="position:absolute;left:108.78px;top:566.69px" class="cls_039"><span class="cls_039">But don’t let the </span><span class="cls_059">Ingredient</span><span class="cls_039"> mapping fool you. The </span><span class="cls_059">Ingredient</span><span class="cls_039"> class is one of</span></div>
<div style="position:absolute;left:93.18px;top:579.68px" class="cls_039"><span class="cls_039">your simplest domain types. Things get more interesting when you map the </span><span class="cls_059">Taco</span><span class="cls_039"> class</span></div>
<div style="position:absolute;left:93.18px;top:592.67px" class="cls_039"><span class="cls_039">for Cassandra persistence.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:216316px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background327.jpg" width="531" height="666"></div>
<div style="position:absolute;left:188.67px;top:24.35px" class="cls_055"><span class="cls_055">Working with reactive Cassandra repositories</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">305</span></div>
<div style="position:absolute;left:114.18px;top:54.65px" class="cls_066"><span class="cls_066">Listing 12.1</span></div>
<div style="position:absolute;left:171.68px;top:54.26px" class="cls_066"><span class="cls_066">Annotating the </span><span class="cls_077">Taco</span><span class="cls_066"> class for Cassandra persistence</span></div>
<div style="position:absolute;left:102.18px;top:71.63px" class="cls_060"><span class="cls_060">package tacos;</span></div>
<div style="position:absolute;left:102.18px;top:81.62px" class="cls_060"><span class="cls_060">import java.util.Date;</span></div>
<div style="position:absolute;left:102.18px;top:91.64px" class="cls_060"><span class="cls_060">import java.util.List;</span></div>
<div style="position:absolute;left:102.18px;top:101.63px" class="cls_060"><span class="cls_060">import java.util.UUID;</span></div>
<div style="position:absolute;left:102.18px;top:111.62px" class="cls_060"><span class="cls_060">import javax.validation.constraints.NotNull;</span></div>
<div style="position:absolute;left:102.18px;top:121.64px" class="cls_060"><span class="cls_060">import javax.validation.constraints.Size;</span></div>
<div style="position:absolute;left:102.18px;top:131.63px" class="cls_060"><span class="cls_060">import org.springframework.data.cassandra.core.cql.Ordering;</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_060"><span class="cls_060">import org.springframework.data.cassandra.core.cql.PrimaryKeyType;</span></div>
<div style="position:absolute;left:102.18px;top:151.64px" class="cls_060"><span class="cls_060">import org.springframework.data.cassandra.core.mapping.Column;</span></div>
<div style="position:absolute;left:102.18px;top:161.63px" class="cls_060"><span class="cls_060">import org.springframework.data.cassandra.core.mapping.PrimaryKeyColumn;</span></div>
<div style="position:absolute;left:102.18px;top:171.65px" class="cls_060"><span class="cls_060">import org.springframework.data.cassandra.core.mapping.Table;</span></div>
<div style="position:absolute;left:102.18px;top:181.64px" class="cls_060"><span class="cls_060">import org.springframework.data.rest.core.annotation.RestResource;</span></div>
<div style="position:absolute;left:102.18px;top:191.63px" class="cls_060"><span class="cls_060">import com.datastax.driver.core.utils.UUIDs;</span></div>
<div style="position:absolute;left:102.18px;top:201.65px" class="cls_060"><span class="cls_060">import lombok.Data;</span></div>
<div style="position:absolute;left:102.18px;top:221.63px" class="cls_060"><span class="cls_060">@Data</span></div>
<div style="position:absolute;left:102.18px;top:231.65px" class="cls_060"><span class="cls_060">@RestResource(rel="tacos", path="tacos")</span></div>
<div style="position:absolute;left:321.00px;top:230.21px" class="cls_067"><span class="cls_067">Persists to</span></div>
<div style="position:absolute;left:102.18px;top:241.64px" class="cls_060"><span class="cls_060">@Table("tacos")</span></div>
<div style="position:absolute;left:321.00px;top:239.72px" class="cls_067"><span class="cls_067">tacos table</span></div>
<div style="position:absolute;left:102.18px;top:251.63px" class="cls_060"><span class="cls_060">public class Taco {</span></div>
<div style="position:absolute;left:391.38px;top:259.22px" class="cls_067"><span class="cls_067">Defines the</span></div>
<div style="position:absolute;left:111.78px;top:271.64px" class="cls_060"><span class="cls_060">@PrimaryKeyColumn(type=PrimaryKeyType.PARTITIONED)</span></div>
<div style="position:absolute;left:391.38px;top:268.73px" class="cls_067"><span class="cls_067">partition key</span></div>
<div style="position:absolute;left:111.77px;top:281.63px" class="cls_060"><span class="cls_060">private UUID id = UUIDs.timeBased();</span></div>
<div style="position:absolute;left:111.78px;top:301.64px" class="cls_060"><span class="cls_060">@NotNull</span></div>
<div style="position:absolute;left:111.78px;top:311.63px" class="cls_060"><span class="cls_060">@Size(min=5, message="Name must be at least 5 characters long")</span></div>
<div style="position:absolute;left:111.78px;top:321.65px" class="cls_060"><span class="cls_060">private String name;</span></div>
<div style="position:absolute;left:111.77px;top:341.63px" class="cls_060"><span class="cls_060">@PrimaryKeyColumn(type=PrimaryKeyType.CLUSTERED,</span></div>
<div style="position:absolute;left:387.09px;top:344.93px" class="cls_067"><span class="cls_067">Defines the</span></div>
<div style="position:absolute;left:198.13px;top:351.65px" class="cls_060"><span class="cls_060">ordering=Ordering.DESCENDING)</span></div>
<div style="position:absolute;left:387.09px;top:354.44px" class="cls_067"><span class="cls_067">clustering key</span></div>
<div style="position:absolute;left:111.78px;top:361.64px" class="cls_060"><span class="cls_060">private Date createdAt = new Date();</span></div>
<div style="position:absolute;left:111.78px;top:381.65px" class="cls_060"><span class="cls_060">@Size(min=1, message="You must choose at least 1 ingredient")</span></div>
<div style="position:absolute;left:111.78px;top:391.64px" class="cls_060"><span class="cls_060">@Column("ingredients")</span></div>
<div style="position:absolute;left:410.04px;top:394.94px" class="cls_067"><span class="cls_067">Maps list to</span></div>
<div style="position:absolute;left:111.76px;top:401.66px" class="cls_060"><span class="cls_060">private List&lt;IngredientUDT&gt; ingredients;</span></div>
<div style="position:absolute;left:410.04px;top:404.45px" class="cls_067"><span class="cls_067">ingredients</span></div>
<div style="position:absolute;left:410.04px;top:413.93px" class="cls_067"><span class="cls_067">column</span></div>
<div style="position:absolute;left:102.18px;top:421.64px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:445.97px" class="cls_039"><span class="cls_039">As you can see, mapping the </span><span class="cls_059">Taco</span><span class="cls_039"> class is a bit more involved. As with </span><span class="cls_059">Ingredient</span><span class="cls_039">, the</span></div>
<div style="position:absolute;left:102.18px;top:458.96px" class="cls_059"><span class="cls_059">@Table</span><span class="cls_039"> annotation is used to identify </span><span class="cls_059">tacos</span><span class="cls_039"> as the name of the table that tacos should</span></div>
<div style="position:absolute;left:102.18px;top:471.98px" class="cls_039"><span class="cls_039">be written to. But that’s the only thing similar to </span><span class="cls_059">Ingredient</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.24px;top:484.97px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">id</span><span class="cls_039"> property is still your primary key, but it’s only one of two primary key col-</span></div>
<div style="position:absolute;left:102.18px;top:497.96px" class="cls_039"><span class="cls_039">umns. More specifically, the </span><span class="cls_059">id</span><span class="cls_039"> property is annotated with </span><span class="cls_059">@PrimaryKeyColumn</span><span class="cls_039"> with a</span></div>
<div style="position:absolute;left:102.18px;top:510.98px" class="cls_059"><span class="cls_059">type</span><span class="cls_039"> of </span><span class="cls_059">PrimaryKeyType.PARTITIONED</span><span class="cls_039">. This specifies that the </span><span class="cls_059">id</span><span class="cls_039"> property serves as</span></div>
<div style="position:absolute;left:102.18px;top:523.97px" class="cls_039"><span class="cls_039">the partition key, used to determine which Cassandra partition(s) each row of taco</span></div>
<div style="position:absolute;left:102.18px;top:536.96px" class="cls_039"><span class="cls_039">data will be written to.</span></div>
<div style="position:absolute;left:116.55px;top:549.98px" class="cls_039"><span class="cls_039">You’ll also notice that the </span><span class="cls_059">id</span><span class="cls_039"> property is now a </span><span class="cls_059">UUID</span><span class="cls_039"> instead of a </span><span class="cls_059">Long</span><span class="cls_039">. Although it’s</span></div>
<div style="position:absolute;left:102.18px;top:562.97px" class="cls_039"><span class="cls_039">not required, properties that hold a generated ID value are commonly of type </span><span class="cls_059">UUID</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:102.18px;top:575.99px" class="cls_039"><span class="cls_039">Moreover, the </span><span class="cls_059">UUID</span><span class="cls_039"> is initialized with a time-based UUID value for new </span><span class="cls_059">Taco</span><span class="cls_039"> objects</span></div>
<div style="position:absolute;left:102.18px;top:588.98px" class="cls_039"><span class="cls_039">(but which may be overridden when reading an existing </span><span class="cls_059">Taco</span><span class="cls_039"> from the database).</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:216992px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background328.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">306</span></div>
<div style="position:absolute;left:191.76px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 12</span></div>
<div style="position:absolute;left:240.72px;top:24.35px" class="cls_055"><span class="cls_055">Persisting data reactively</span></div>
<div style="position:absolute;left:108.75px;top:50.66px" class="cls_039"><span class="cls_039">A little further down, you see the </span><span class="cls_059">createdAt</span><span class="cls_039"> property that’s mapped as another</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">primary key column. But in this case, the </span><span class="cls_059">type</span><span class="cls_039"> attribute of </span><span class="cls_059">@PrimaryKeyColumn</span><span class="cls_039"> is set</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">to </span><span class="cls_059">PrimaryKeyType.CLUSTERED</span><span class="cls_039">, which designates the </span><span class="cls_059">createdAt</span><span class="cls_039"> property as a cluster-</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">ing key. As mentioned earlier, clustering keys are used to determine the ordering of</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">rows </span><span class="cls_036">within a partition</span><span class="cls_039">. More specifically, the ordering is set to descending order—</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">therefore, within a given partition, newer rows appear first in the </span><span class="cls_059">tacos</span><span class="cls_039"> table.</span></div>
<div style="position:absolute;left:108.03px;top:128.66px" class="cls_039"><span class="cls_039">Finally, the </span><span class="cls_059">ingredients</span><span class="cls_039"> property is now a </span><span class="cls_059">List</span><span class="cls_039"> of </span><span class="cls_059">IngredientUDT</span><span class="cls_039"> objects instead</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">of a </span><span class="cls_059">List</span><span class="cls_039"> of </span><span class="cls_059">Ingredient</span><span class="cls_039"> objects. As you’ll recall, Cassandra tables are highly denor-</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_039"><span class="cls_039">malized and may contain data that’s duplicated from other tables. Although the</span></div>
<div style="position:absolute;left:93.18px;top:167.66px" class="cls_059"><span class="cls_059">ingredient</span><span class="cls_039"> table will serve as the table of record for all available ingredients, the</span></div>
<div style="position:absolute;left:93.18px;top:180.65px" class="cls_039"><span class="cls_039">ingredients chosen for a taco will be duplicated in the </span><span class="cls_059">ingredients</span><span class="cls_039"> column. Rather</span></div>
<div style="position:absolute;left:93.18px;top:193.67px" class="cls_039"><span class="cls_039">than simply reference one or more rows in the </span><span class="cls_059">ingredients</span><span class="cls_039"> table, the </span><span class="cls_059">ingredients</span></div>
<div style="position:absolute;left:93.18px;top:206.66px" class="cls_039"><span class="cls_039">property will contain full data for each chosen ingredient.</span></div>
<div style="position:absolute;left:108.11px;top:219.65px" class="cls_039"><span class="cls_039">But why do you need to introduce a new </span><span class="cls_059">IngredientUDT</span><span class="cls_039"> class? Why can’t you just</span></div>
<div style="position:absolute;left:93.18px;top:232.67px" class="cls_039"><span class="cls_039">reuse the </span><span class="cls_059">Ingredient</span><span class="cls_039"> class? Put simply, columns that contain collections of data, such</span></div>
<div style="position:absolute;left:93.18px;top:245.66px" class="cls_039"><span class="cls_039">as the </span><span class="cls_059">ingredients</span><span class="cls_039"> column, must be collections of native types (integers, strings, and</span></div>
<div style="position:absolute;left:93.18px;top:258.65px" class="cls_039"><span class="cls_039">so on) or must be collections of user-defined types.</span></div>
<div style="position:absolute;left:109.02px;top:271.67px" class="cls_039"><span class="cls_039">In Cassandra, user-defined types enable you to declare table columns that are</span></div>
<div style="position:absolute;left:93.18px;top:284.66px" class="cls_039"><span class="cls_039">richer than simple native types. Often they’re used as a denormalized analog for</span></div>
<div style="position:absolute;left:93.18px;top:297.68px" class="cls_039"><span class="cls_039">relational foreign keys. In contrast to foreign keys, which only hold a reference to a</span></div>
<div style="position:absolute;left:93.18px;top:310.67px" class="cls_039"><span class="cls_039">row in another table, columns with user-defined types actually carry data that may</span></div>
<div style="position:absolute;left:93.18px;top:323.66px" class="cls_039"><span class="cls_039">be copied from a row in another table. In the case of the </span><span class="cls_059">ingredients</span><span class="cls_039"> column in</span></div>
<div style="position:absolute;left:93.18px;top:336.68px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">tacos</span><span class="cls_039"> table, it will contain a collection of data structures that define the ingredi-</span></div>
<div style="position:absolute;left:93.18px;top:349.67px" class="cls_039"><span class="cls_039">ents themselves.</span></div>
<div style="position:absolute;left:108.78px;top:362.66px" class="cls_039"><span class="cls_039">You can’t use the </span><span class="cls_059">Ingredient</span><span class="cls_039"> class as a user-defined type, because the </span><span class="cls_059">@Table</span></div>
<div style="position:absolute;left:93.18px;top:375.68px" class="cls_039"><span class="cls_039">annotation has already mapped it as an entity for persistence in Cassandra. There-</span></div>
<div style="position:absolute;left:93.18px;top:388.67px" class="cls_039"><span class="cls_039">fore, you must create a new class to define how ingredients will be stored in the</span></div>
<div style="position:absolute;left:93.18px;top:401.66px" class="cls_059"><span class="cls_059">ingredients</span><span class="cls_039"> column of the </span><span class="cls_059">taco</span><span class="cls_039"> table. </span><span class="cls_059">IngredientUDT</span><span class="cls_039"> (where “UDT” means </span><span class="cls_036">user-</span></div>
<div style="position:absolute;left:93.18px;top:414.68px" class="cls_036"><span class="cls_036">defined type</span><span class="cls_039">) is the class for the job:</span></div>
<div style="position:absolute;left:93.18px;top:434.36px" class="cls_060"><span class="cls_060">package tacos;</span></div>
<div style="position:absolute;left:93.18px;top:450.35px" class="cls_060"><span class="cls_060">import org.springframework.data.cassandra.core.mapping.UserDefinedType;</span></div>
<div style="position:absolute;left:93.18px;top:466.34px" class="cls_060"><span class="cls_060">import lombok.AccessLevel;</span></div>
<div style="position:absolute;left:93.18px;top:476.36px" class="cls_060"><span class="cls_060">import lombok.Data;</span></div>
<div style="position:absolute;left:93.18px;top:486.35px" class="cls_060"><span class="cls_060">import lombok.NoArgsConstructor;</span></div>
<div style="position:absolute;left:93.18px;top:496.34px" class="cls_060"><span class="cls_060">import lombok.RequiredArgsConstructor;</span></div>
<div style="position:absolute;left:93.18px;top:512.36px" class="cls_060"><span class="cls_060">@Data</span></div>
<div style="position:absolute;left:93.18px;top:522.35px" class="cls_060"><span class="cls_060">@RequiredArgsConstructor</span></div>
<div style="position:absolute;left:93.18px;top:532.34px" class="cls_060"><span class="cls_060">@NoArgsConstructor(access=AccessLevel.PRIVATE, force=true)</span></div>
<div style="position:absolute;left:93.18px;top:542.36px" class="cls_060"><span class="cls_060">@UserDefinedType("ingredient")</span></div>
<div style="position:absolute;left:93.18px;top:552.35px" class="cls_060"><span class="cls_060">public class IngredientUDT {</span></div>
<div style="position:absolute;left:102.78px;top:568.34px" class="cls_060"><span class="cls_060">private final String name;</span></div>
<div style="position:absolute;left:102.78px;top:578.36px" class="cls_060"><span class="cls_060">private final Ingredient.Type type;</span></div>
<div style="position:absolute;left:93.18px;top:594.35px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:217668px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background329.jpg" width="531" height="666"></div>
<div style="position:absolute;left:188.67px;top:24.35px" class="cls_055"><span class="cls_055">Working with reactive Cassandra repositories</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">307</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">Although </span><span class="cls_059">IngredientUDT</span><span class="cls_039"> looks a lot like </span><span class="cls_059">Ingredient</span><span class="cls_039">, its mapping requirements are</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">much simpler. It’s annotated with </span><span class="cls_059">@UserDefinedType</span><span class="cls_039"> to identify it as a user-defined</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">type in Cassandra. But otherwise, it’s a simple class with a few properties.</span></div>
<div style="position:absolute;left:118.75px;top:89.66px" class="cls_039"><span class="cls_039">You’ll also note that the </span><span class="cls_059">IngredientUDT</span><span class="cls_039"> class doesn’t include an </span><span class="cls_059">id</span><span class="cls_039"> property.</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">Although it could include a copy of the </span><span class="cls_059">id</span><span class="cls_039"> property from the source </span><span class="cls_059">Ingredient</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">that’s not necessary. In fact, the user-defined type may include any properties you</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">wish—it doesn’t need to be a one-to-one mapping with any table definition.</span></div>
<div style="position:absolute;left:116.56px;top:141.65px" class="cls_039"><span class="cls_039">I realize that it might be difficult to visualize how data in a user-defined type relates</span></div>
<div style="position:absolute;left:102.18px;top:154.67px" class="cls_039"><span class="cls_039">to data that’s persisted to a table. Figure 12.1 shows the data model for the entire Taco</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">Cloud database, including user-defined types.</span></div>
<div style="position:absolute;left:128.14px;top:192.72px" class="cls_057"><span class="cls_057">Stored in “tacoorders” table</span></div>
<div style="position:absolute;left:276.15px;top:194.61px" class="cls_057"><span class="cls_057">Stored in “users” table</span></div>
<div style="position:absolute;left:162.05px;top:207.84px" class="cls_096"><span class="cls_096">has a</span></div>
<div style="position:absolute;left:239.95px;top:207.84px" class="cls_097"><span class="cls_097">copied from</span></div>
<div style="position:absolute;left:121.13px;top:212.05px" class="cls_057"><span class="cls_057">Order</span></div>
<div style="position:absolute;left:197.11px;top:212.05px" class="cls_057"><span class="cls_057">UserUDT</span></div>
<div style="position:absolute;left:303.21px;top:212.05px" class="cls_057"><span class="cls_057">User</span></div>
<div style="position:absolute;left:276.37px;top:267.74px" class="cls_057"><span class="cls_057">Stored in “tacos” table</span></div>
<div style="position:absolute;left:239.73px;top:281.99px" class="cls_098"><span class="cls_098">copied from</span></div>
<div style="position:absolute;left:197.07px;top:285.82px" class="cls_057"><span class="cls_057">TacoUDT</span></div>
<div style="position:absolute;left:303.22px;top:285.82px" class="cls_057"><span class="cls_057">Taco</span></div>
<div style="position:absolute;left:374.89px;top:337.27px" class="cls_057"><span class="cls_057">Stored in “ingredients” table</span></div>
<div style="position:absolute;left:352.12px;top:343.09px" class="cls_097"><span class="cls_097">copied</span></div>
<div style="position:absolute;left:354.88px;top:350.17px" class="cls_097"><span class="cls_097">from</span></div>
<div style="position:absolute;left:287.83px;top:354.70px" class="cls_057"><span class="cls_057">IngredientUDT</span></div>
<div style="position:absolute;left:397.03px;top:354.67px" class="cls_096"><span class="cls_096">In</span><span class="cls_057">Ingred</span></div>
<div style="position:absolute;left:422.34px;top:354.71px" class="cls_057"><span class="cls_057">ient</span></div>
<div style="position:absolute;left:102.18px;top:384.50px" class="cls_053"><span class="cls_053">Figure 12.1</span></div>
<div style="position:absolute;left:151.61px;top:384.50px" class="cls_053"><span class="cls_053">Instead of using foreign keys and joins, Cassandra tables are denormalized, with user-</span></div>
<div style="position:absolute;left:102.18px;top:394.49px" class="cls_053"><span class="cls_053">defined types containing data copied from related tables.</span></div>
<div style="position:absolute;left:102.18px;top:427.82px" class="cls_039"><span class="cls_039">Specific to the user-defined type that you just created, notice how </span><span class="cls_059">Taco</span><span class="cls_039"> has a list of</span></div>
<div style="position:absolute;left:102.18px;top:440.81px" class="cls_059"><span class="cls_059">IngredientUDT</span><span class="cls_039">, which holds data copied from </span><span class="cls_059">Ingredient</span><span class="cls_039"> objects. When a </span><span class="cls_059">Taco</span><span class="cls_039"> is per-</span></div>
<div style="position:absolute;left:102.18px;top:453.80px" class="cls_039"><span class="cls_039">sisted, it’s the </span><span class="cls_059">Taco</span><span class="cls_039"> object and the list of </span><span class="cls_059">IngredientUDT</span><span class="cls_039"> that’s persisted to the </span><span class="cls_059">tacos</span></div>
<div style="position:absolute;left:102.18px;top:466.82px" class="cls_039"><span class="cls_039">table. The list of </span><span class="cls_059">IngredientUDT</span><span class="cls_039"> is persisted entirely within the </span><span class="cls_059">ingredients</span><span class="cls_039"> column.</span></div>
<div style="position:absolute;left:117.42px;top:479.81px" class="cls_039"><span class="cls_039">Another way of looking at this that might help you understand how user-defined</span></div>
<div style="position:absolute;left:102.18px;top:492.83px" class="cls_039"><span class="cls_039">types are used is to query the database for rows from the </span><span class="cls_059">tacos</span><span class="cls_039"> table. Using CQL and</span></div>
<div style="position:absolute;left:102.18px;top:505.82px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">cqlsh</span><span class="cls_039"> tool that comes with Cassandra, you see the following results:</span></div>
<div style="position:absolute;left:102.18px;top:528.50px" class="cls_060"><span class="cls_060">cqlsh:tacocloud&gt; select id, name, createdAt, ingredients from tacos;</span></div>
<div style="position:absolute;left:106.98px;top:548.48px" class="cls_060"><span class="cls_060">id</span></div>
<div style="position:absolute;left:150.15px;top:548.48px" class="cls_060"><span class="cls_060">| name</span></div>
<div style="position:absolute;left:207.71px;top:548.48px" class="cls_060"><span class="cls_060">| createdat | ingredients</span></div>
<div style="position:absolute;left:102.18px;top:558.50px" class="cls_060"><span class="cls_060">----------+-----------+-----------+----------------------------------------</span></div>
<div style="position:absolute;left:106.98px;top:568.49px" class="cls_060"><span class="cls_060">827390...| Carnivore | 2018-04...| [{name: 'Flour Tortilla', type: 'WRAP'},</span></div>
<div style="position:absolute;left:279.69px;top:578.51px" class="cls_060"><span class="cls_060">{name: 'Carnitas', type: 'PROTEIN'},</span></div>
<div style="position:absolute;left:279.69px;top:588.50px" class="cls_060"><span class="cls_060">{name: 'Sour Cream', type: 'SAUCE'},</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:218344px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background330.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">308</span></div>
<div style="position:absolute;left:191.76px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 12</span></div>
<div style="position:absolute;left:240.72px;top:24.35px" class="cls_055"><span class="cls_055">Persisting data reactively</span></div>
<div style="position:absolute;left:270.69px;top:51.32px" class="cls_060"><span class="cls_060">{name: 'Salsa', type: 'SAUCE'},</span></div>
<div style="position:absolute;left:270.69px;top:61.34px" class="cls_060"><span class="cls_060">{name: 'Cheddar', type: 'CHEESE'}]</span></div>
<div style="position:absolute;left:93.18px;top:81.32px" class="cls_061"><span class="cls_061">(1 rows)</span></div>
<div style="position:absolute;left:93.18px;top:105.65px" class="cls_039"><span class="cls_039">As you can see, the </span><span class="cls_059">id</span><span class="cls_039">, </span><span class="cls_059">name</span><span class="cls_039">, and </span><span class="cls_059">createdat</span><span class="cls_039"> columns contain simple values. In that</span></div>
<div style="position:absolute;left:93.18px;top:118.67px" class="cls_039"><span class="cls_039">regard, they aren’t much different than what you’d expect from a similar query</span></div>
<div style="position:absolute;left:93.18px;top:131.66px" class="cls_039"><span class="cls_039">against a relational database. But the </span><span class="cls_059">ingredients</span><span class="cls_039"> column is a little different. Because</span></div>
<div style="position:absolute;left:93.18px;top:144.65px" class="cls_039"><span class="cls_039">it’s defined as containing a collection of the user-defined </span><span class="cls_059">ingredient</span><span class="cls_039"> type (defined by</span></div>
<div style="position:absolute;left:93.18px;top:157.67px" class="cls_059"><span class="cls_059">IngredientUDT</span><span class="cls_039">), its value appears as a JSON array filled with JSON objects.</span></div>
<div style="position:absolute;left:107.86px;top:170.66px" class="cls_039"><span class="cls_039">You likely noticed other user-defined types in figure 12.1. You’ll certainly be creat-</span></div>
<div style="position:absolute;left:93.18px;top:183.65px" class="cls_039"><span class="cls_039">ing some more as you continue mapping your domain to Cassandra tables, including</span></div>
<div style="position:absolute;left:93.18px;top:196.67px" class="cls_039"><span class="cls_039">some that will be used by the </span><span class="cls_059">Order</span><span class="cls_039"> class. The next listing shows the </span><span class="cls_059">Order</span><span class="cls_039"> class, mod-</span></div>
<div style="position:absolute;left:93.18px;top:209.66px" class="cls_039"><span class="cls_039">ified for Cassandra persistence.</span></div>
<div style="position:absolute;left:105.18px;top:236.66px" class="cls_066"><span class="cls_066">Listing 12.2</span></div>
<div style="position:absolute;left:162.68px;top:236.27px" class="cls_066"><span class="cls_066">Mapping the </span><span class="cls_077">Order</span><span class="cls_066"> class to a Cassandra </span><span class="cls_077">tacoorders</span><span class="cls_066"> table</span></div>
<div style="position:absolute;left:329.04px;top:256.10px" class="cls_067"><span class="cls_067">Maps to</span></div>
<div style="position:absolute;left:93.18px;top:260.63px" class="cls_060"><span class="cls_060">@Data</span></div>
<div style="position:absolute;left:329.04px;top:265.61px" class="cls_067"><span class="cls_067">tacoorders table</span></div>
<div style="position:absolute;left:93.18px;top:270.65px" class="cls_060"><span class="cls_060">@Table("tacoorders")</span></div>
<div style="position:absolute;left:93.18px;top:280.64px" class="cls_060"><span class="cls_060">public class Order implements Serializable {</span></div>
<div style="position:absolute;left:102.77px;top:300.65px" class="cls_060"><span class="cls_060">private static final long serialVersionUID = 1L;</span></div>
<div style="position:absolute;left:102.77px;top:322.64px" class="cls_060"><span class="cls_060">@PrimaryKey</span></div>
<div style="position:absolute;left:298.56px;top:325.94px" class="cls_067"><span class="cls_067">Declares the</span></div>
<div style="position:absolute;left:102.78px;top:332.63px" class="cls_060"><span class="cls_060">private UUID id = UUIDs.timeBased();</span></div>
<div style="position:absolute;left:298.56px;top:335.45px" class="cls_067"><span class="cls_067">primary key</span></div>
<div style="position:absolute;left:102.77px;top:352.64px" class="cls_060"><span class="cls_060">private Date placedAt = new Date();</span></div>
<div style="position:absolute;left:227.40px;top:367.67px" class="cls_067"><span class="cls_067">Maps to the</span></div>
<div style="position:absolute;left:102.78px;top:372.65px" class="cls_060"><span class="cls_060">@Column("user")</span></div>
<div style="position:absolute;left:227.40px;top:377.18px" class="cls_067"><span class="cls_067">user column</span></div>
<div style="position:absolute;left:102.78px;top:382.64px" class="cls_060"><span class="cls_060">private UserUDT user;</span></div>
<div style="position:absolute;left:102.77px;top:402.65px" class="cls_060"><span class="cls_060">// delivery and credit card properties omitted for brevity's sake</span></div>
<div style="position:absolute;left:102.78px;top:424.64px" class="cls_060"><span class="cls_060">@Column("tacos")</span></div>
<div style="position:absolute;left:354.00px;top:427.94px" class="cls_067"><span class="cls_067">Maps a list to the</span></div>
<div style="position:absolute;left:102.77px;top:434.66px" class="cls_060"><span class="cls_060">private List&lt;TacoUDT&gt; tacos = new ArrayList&lt;&gt;();</span></div>
<div style="position:absolute;left:354.00px;top:437.45px" class="cls_067"><span class="cls_067">tacos column</span></div>
<div style="position:absolute;left:102.78px;top:456.65px" class="cls_060"><span class="cls_060">public void addDesign(TacoUTD design) {</span></div>
<div style="position:absolute;left:112.38px;top:466.64px" class="cls_060"><span class="cls_060">this.tacos.add(design);</span></div>
<div style="position:absolute;left:102.78px;top:476.66px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:496.64px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:520.97px" class="cls_039"><span class="cls_039">Listing 12.2 purposefully omits many of the properties of </span><span class="cls_059">Order</span><span class="cls_039"> that don’t lend them-</span></div>
<div style="position:absolute;left:93.18px;top:533.96px" class="cls_039"><span class="cls_039">selves to a discussion of Cassandra data modeling. What’s left are a few properties</span></div>
<div style="position:absolute;left:93.18px;top:546.98px" class="cls_039"><span class="cls_039">and mappings, similar to how </span><span class="cls_059">Taco</span><span class="cls_039"> was defined. </span><span class="cls_059">@Table</span><span class="cls_039"> is used to map </span><span class="cls_059">Order</span><span class="cls_039"> to the</span></div>
<div style="position:absolute;left:93.18px;top:559.97px" class="cls_059"><span class="cls_059">tacoorders</span><span class="cls_039"> table, much as </span><span class="cls_059">@Table</span><span class="cls_039"> has been used before. In this case, you’re uncon-</span></div>
<div style="position:absolute;left:93.18px;top:572.99px" class="cls_039"><span class="cls_039">cerned with ordering, so the </span><span class="cls_059">id</span><span class="cls_039"> property is simply annotated with </span><span class="cls_059">@PrimaryKey</span><span class="cls_039">, desig-</span></div>
<div style="position:absolute;left:93.18px;top:585.98px" class="cls_039"><span class="cls_039">nating it as both a partition key and a clustering key with default ordering.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:219020px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background331.jpg" width="531" height="666"></div>
<div style="position:absolute;left:188.67px;top:24.35px" class="cls_055"><span class="cls_055">Working with reactive Cassandra repositories</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">309</span></div>
<div style="position:absolute;left:116.76px;top:50.66px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">tacos</span><span class="cls_039"> property is of some interest in that it’s a </span><span class="cls_059">List&lt;TacoUDT&gt;</span><span class="cls_039"> instead of a list</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">of </span><span class="cls_059">Taco</span><span class="cls_039"> objects. The relationship between </span><span class="cls_059">Order</span><span class="cls_039"> and </span><span class="cls_059">Taco</span><span class="cls_039">/</span><span class="cls_059">TacoUDT</span><span class="cls_039"> here is similar to</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">the relationship between </span><span class="cls_059">Taco</span><span class="cls_039"> and </span><span class="cls_059">Ingredient</span><span class="cls_039">/</span><span class="cls_059">IngredientUDT</span><span class="cls_039">. That is, rather than</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">joining data from several rows in a separate table through foreign keys, the </span><span class="cls_059">Order</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">table will contain all of the pertinent taco data, optimizing the table for quick reads.</span></div>
<div style="position:absolute;left:117.36px;top:115.67px" class="cls_039"><span class="cls_039">Similarly, the </span><span class="cls_059">user</span><span class="cls_039"> property references a </span><span class="cls_059">UserUDT</span><span class="cls_039"> property to be persisted within</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">user</span><span class="cls_039"> column. Again, this is in contrast to the relational database strategy of join-</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">ing in another table.</span></div>
<div style="position:absolute;left:117.30px;top:154.67px" class="cls_039"><span class="cls_039">As for the </span><span class="cls_059">TacoUDT</span><span class="cls_039"> class, it’s quite similar to the </span><span class="cls_059">IngredientUDT</span><span class="cls_039"> class, although it</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">does include a collection that references another user-defined type:</span></div>
<div style="position:absolute;left:102.18px;top:189.35px" class="cls_060"><span class="cls_060">@Data</span></div>
<div style="position:absolute;left:102.18px;top:199.34px" class="cls_060"><span class="cls_060">@UserDefinedType("taco")</span></div>
<div style="position:absolute;left:102.18px;top:209.33px" class="cls_060"><span class="cls_060">public class TacoUDT {</span></div>
<div style="position:absolute;left:111.78px;top:229.34px" class="cls_060"><span class="cls_060">private final String name;</span></div>
<div style="position:absolute;left:111.78px;top:239.33px" class="cls_060"><span class="cls_060">private final List&lt;IngredientUDT&gt; ingredients;</span></div>
<div style="position:absolute;left:102.18px;top:259.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:282.65px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">UserUDT</span><span class="cls_039"> class is only marginally more interesting in that it has three properties</span></div>
<div style="position:absolute;left:102.18px;top:295.67px" class="cls_039"><span class="cls_039">instead of two:</span></div>
<div style="position:absolute;left:102.18px;top:317.33px" class="cls_060"><span class="cls_060">@UserDefinedType("user")</span></div>
<div style="position:absolute;left:102.18px;top:327.35px" class="cls_060"><span class="cls_060">@Data</span></div>
<div style="position:absolute;left:102.18px;top:337.34px" class="cls_060"><span class="cls_060">public class UserUDT {</span></div>
<div style="position:absolute;left:111.78px;top:357.35px" class="cls_060"><span class="cls_060">private final String username;</span></div>
<div style="position:absolute;left:111.78px;top:367.34px" class="cls_060"><span class="cls_060">private final String fullname;</span></div>
<div style="position:absolute;left:111.78px;top:377.33px" class="cls_060"><span class="cls_060">private final String phoneNumber;</span></div>
<div style="position:absolute;left:102.18px;top:397.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:420.68px" class="cls_039"><span class="cls_039">Although it would have been nice to reuse the same domain classes you created in</span></div>
<div style="position:absolute;left:102.18px;top:433.67px" class="cls_039"><span class="cls_039">chapter 3, or at most to swap out some JPA annotations for Cassandra annotations, the</span></div>
<div style="position:absolute;left:102.18px;top:446.66px" class="cls_039"><span class="cls_039">nature of Cassandra persistence is such that it requires you to rethink how your data is</span></div>
<div style="position:absolute;left:102.18px;top:459.68px" class="cls_039"><span class="cls_039">modeled. But now that you’ve mapped your domain, you’re ready to write repositories.</span></div>
<div style="position:absolute;left:66.18px;top:481.49px" class="cls_063"><span class="cls_063">12.2.4</span></div>
<div style="position:absolute;left:102.18px;top:481.49px" class="cls_063"><span class="cls_063">Writing reactive Cassandra repositories</span></div>
<div style="position:absolute;left:102.18px;top:498.68px" class="cls_039"><span class="cls_039">As you saw in chapter 3, writing a repository with Spring Data involves simply declar-</span></div>
<div style="position:absolute;left:102.18px;top:511.67px" class="cls_039"><span class="cls_039">ing an interface that extends one of Spring Data’s base repository interfaces and</span></div>
<div style="position:absolute;left:102.18px;top:524.66px" class="cls_039"><span class="cls_039">optionally declaring additional query methods for custom queries. As it turns out,</span></div>
<div style="position:absolute;left:102.18px;top:537.68px" class="cls_039"><span class="cls_039">writing reactive repositories isn’t much different. The primary difference is that you’ll</span></div>
<div style="position:absolute;left:102.18px;top:550.67px" class="cls_039"><span class="cls_039">extend a different base repository interface, and your methods will deal with reactive</span></div>
<div style="position:absolute;left:102.18px;top:563.69px" class="cls_039"><span class="cls_039">publishers such as </span><span class="cls_059">Mono</span><span class="cls_039"> and </span><span class="cls_059">Flux</span><span class="cls_039">, instead of domain types and collections.</span></div>
<div style="position:absolute;left:116.67px;top:576.68px" class="cls_039"><span class="cls_039">When it comes to writing reactive Cassandra repositories, you have the choice of two</span></div>
<div style="position:absolute;left:102.18px;top:589.67px" class="cls_039"><span class="cls_039">base interfaces: </span><span class="cls_059">ReactiveCassandraRepository</span><span class="cls_039"> and </span><span class="cls_059">ReactiveCrudRepository</span><span class="cls_039">. Which</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:219696px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background332.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">310</span></div>
<div style="position:absolute;left:191.76px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 12</span></div>
<div style="position:absolute;left:240.72px;top:24.35px" class="cls_055"><span class="cls_055">Persisting data reactively</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">we choose largely depends on how the repository will be used. </span><span class="cls_059">ReactiveCassandra-</span></div>
<div style="position:absolute;left:93.27px;top:63.65px" class="cls_059"><span class="cls_059">Repository</span><span class="cls_039"> extends </span><span class="cls_059">ReactiveCrudRepository</span><span class="cls_039"> to offer a few variations of an </span><span class="cls_059">insert()</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">method, which is optimized when the object to be saved is new. Otherwise, </span><span class="cls_059">Reactive-</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_059"><span class="cls_059">CassandraRepository</span><span class="cls_039"> offers the same operations as </span><span class="cls_059">ReactiveCrudRepository</span><span class="cls_039">. If you’ll</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">be inserting a lot of data, you might choose </span><span class="cls_059">ReactiveCassandraRepository</span><span class="cls_039">. Otherwise,</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">it’s better to stick with </span><span class="cls_059">ReactiveCrudRepository</span><span class="cls_039">, which is more portable across other</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">database types.</span></div>
<div style="position:absolute;left:105.18px;top:162.47px" class="cls_075"><span class="cls_075">Do my Cassandra repositories have to be reactive?</span></div>
<div style="position:absolute;left:105.18px;top:176.33px" class="cls_076"><span class="cls_076">Although this chapter is about writing reactive repositories with Spring Data, you</span></div>
<div style="position:absolute;left:105.18px;top:187.34px" class="cls_076"><span class="cls_076">may be interested to know that you can write non-reactive repositories for Cassan-</span></div>
<div style="position:absolute;left:105.18px;top:198.35px" class="cls_076"><span class="cls_076">dra as well. Rather than extend </span><span class="cls_059">ReactiveCrudRepository</span><span class="cls_076"> or </span><span class="cls_059">ReactiveCassandra-</span></div>
<div style="position:absolute;left:105.18px;top:209.33px" class="cls_059"><span class="cls_059">Repository</span><span class="cls_076">, your repository interfaces can extend the non-reactive </span><span class="cls_059">CrudRepository</span></div>
<div style="position:absolute;left:105.18px;top:220.34px" class="cls_076"><span class="cls_076">or </span><span class="cls_059">CassandraRepository</span><span class="cls_076"> interfaces. Then your repository methods can simply return</span></div>
<div style="position:absolute;left:105.18px;top:231.35px" class="cls_076"><span class="cls_076">Cassandra-annotated domain types and collections of those domain types instead of</span></div>
<div style="position:absolute;left:105.18px;top:242.33px" class="cls_059"><span class="cls_059">Flux</span><span class="cls_076"> and </span><span class="cls_059">Mono</span><span class="cls_076">.</span></div>
<div style="position:absolute;left:105.18px;top:260.33px" class="cls_076"><span class="cls_076">If you decide to work with non-reactive repositories, you can also change the starter</span></div>
<div style="position:absolute;left:105.18px;top:271.34px" class="cls_076"><span class="cls_076">dependency to </span><span class="cls_059">spring-boot-starter-data-cassandra</span><span class="cls_076"> instead of </span><span class="cls_059">spring-boot-</span></div>
<div style="position:absolute;left:105.18px;top:282.35px" class="cls_059"><span class="cls_059">starter-data-cassandra-reactive</span><span class="cls_076">, although it’s not strictly required that you</span></div>
<div style="position:absolute;left:105.18px;top:293.33px" class="cls_076"><span class="cls_076">do so.</span></div>
<div style="position:absolute;left:93.18px;top:327.68px" class="cls_039"><span class="cls_039">Revisiting some of the repositories you’ve already written for the Taco Cloud application,</span></div>
<div style="position:absolute;left:93.18px;top:340.67px" class="cls_039"><span class="cls_039">the first thing you should do to make them reactive is to have them extend </span><span class="cls_059">Reactive-</span></div>
<div style="position:absolute;left:93.18px;top:353.66px" class="cls_059"><span class="cls_059">CrudRepository</span><span class="cls_039"> or </span><span class="cls_059">ReactiveCassandraRepository</span><span class="cls_039"> instead of </span><span class="cls_059">CrudRepository</span><span class="cls_039">. For</span></div>
<div style="position:absolute;left:93.18px;top:366.68px" class="cls_039"><span class="cls_039">example, consider </span><span class="cls_059">IngredientRepository</span><span class="cls_039">. Aside from initializing the database with</span></div>
<div style="position:absolute;left:93.18px;top:379.67px" class="cls_039"><span class="cls_039">ingredient data, you won’t be inserting many new ingredients. Therefore, </span><span class="cls_059">Ingredient-</span></div>
<div style="position:absolute;left:93.21px;top:392.66px" class="cls_059"><span class="cls_059">Repository</span><span class="cls_039"> can extend </span><span class="cls_059">ReactiveCrudRepository</span><span class="cls_039"> as shown here:</span></div>
<div style="position:absolute;left:93.18px;top:415.34px" class="cls_060"><span class="cls_060">public interface IngredientRepository</span></div>
<div style="position:absolute;left:136.33px;top:425.36px" class="cls_060"><span class="cls_060">extends ReactiveCrudRepository&lt;Ingredient, String&gt; {</span></div>
<div style="position:absolute;left:93.18px;top:435.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:458.66px" class="cls_039"><span class="cls_039">You never defined any custom query methods in </span><span class="cls_059">IngredientRepository</span><span class="cls_039">, so there’s not</span></div>
<div style="position:absolute;left:93.18px;top:471.68px" class="cls_039"><span class="cls_039">much else you need to do to make </span><span class="cls_059">IngredientRepository</span><span class="cls_039"> a reactive repository. But</span></div>
<div style="position:absolute;left:93.18px;top:484.67px" class="cls_039"><span class="cls_039">because it now extends </span><span class="cls_059">ReactiveCrudRepository</span><span class="cls_039">, its methods will deal in terms of</span></div>
<div style="position:absolute;left:93.18px;top:497.66px" class="cls_059"><span class="cls_059">Flux</span><span class="cls_039"> and </span><span class="cls_059">Mono</span><span class="cls_039">. For example, the </span><span class="cls_059">findAll()</span><span class="cls_039"> method now returns </span><span class="cls_059">Flux&lt;Ingredient&gt;</span></div>
<div style="position:absolute;left:93.18px;top:510.68px" class="cls_039"><span class="cls_039">instead of an </span><span class="cls_059">Iterable&lt;Ingredient&gt;</span><span class="cls_039">. Consequently, you’ll need to be sure that it’s being</span></div>
<div style="position:absolute;left:93.18px;top:523.67px" class="cls_039"><span class="cls_039">used properly wherever it is being used. The </span><span class="cls_059">allIngredients()</span><span class="cls_039"> method in </span><span class="cls_059">Ingredient-</span></div>
<div style="position:absolute;left:93.18px;top:536.66px" class="cls_059"><span class="cls_059">Controller</span><span class="cls_039">, for instance, will need to be rewritten to return a </span><span class="cls_059">Flux&lt;Ingredient&gt;</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:559.34px" class="cls_060"><span class="cls_060">@GetMapping</span></div>
<div style="position:absolute;left:93.18px;top:569.36px" class="cls_060"><span class="cls_060">public Flux&lt;Ingredient&gt; allIngredients() {</span></div>
<div style="position:absolute;left:102.78px;top:579.35px" class="cls_060"><span class="cls_060">return repo.findAll();</span></div>
<div style="position:absolute;left:93.18px;top:589.34px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:220372px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background333.jpg" width="531" height="666"></div>
<div style="position:absolute;left:188.67px;top:24.35px" class="cls_055"><span class="cls_055">Working with reactive Cassandra repositories</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">311</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">The changes to </span><span class="cls_059">TacoRepository</span><span class="cls_039"> are only subtly more complicated. Instead of extending</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_059"><span class="cls_059">PagingAndSortingRepository</span><span class="cls_039">, it will need to extend </span><span class="cls_059">ReactiveCassandraRepository</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">And instead of being parameterized for </span><span class="cls_059">Taco</span><span class="cls_039"> objects with </span><span class="cls_059">Long</span><span class="cls_039"> ID properties, it will</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">need to work with </span><span class="cls_059">Taco</span><span class="cls_039"> objects with </span><span class="cls_059">UUID</span><span class="cls_039"> properties for their IDs:</span></div>
<div style="position:absolute;left:102.18px;top:109.34px" class="cls_060"><span class="cls_060">public interface TacoRepository</span></div>
<div style="position:absolute;left:145.36px;top:119.33px" class="cls_060"><span class="cls_060">extends ReactiveCrudRepository&lt;Taco, UUID&gt; {</span></div>
<div style="position:absolute;left:102.18px;top:129.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:150.65px" class="cls_039"><span class="cls_039">Because this new </span><span class="cls_059">TacoRepository</span><span class="cls_039"> will return </span><span class="cls_059">Flux&lt;Ingredient&gt;</span><span class="cls_039"> from its </span><span class="cls_059">findAll()</span></div>
<div style="position:absolute;left:102.18px;top:163.67px" class="cls_039"><span class="cls_039">method, you no longer need to worry about it extending </span><span class="cls_059">PagingAndSortingRepository</span></div>
<div style="position:absolute;left:102.18px;top:176.66px" class="cls_039"><span class="cls_039">or working with a page of results. Instead, the </span><span class="cls_059">recentTacos()</span><span class="cls_039"> method of </span><span class="cls_059">Design-</span></div>
<div style="position:absolute;left:102.18px;top:189.65px" class="cls_059"><span class="cls_059">TacoController</span><span class="cls_039"> will just need to call </span><span class="cls_059">take()</span><span class="cls_039"> on the returned </span><span class="cls_059">Flux</span><span class="cls_039"> to limit the number</span></div>
<div style="position:absolute;left:102.18px;top:202.67px" class="cls_039"><span class="cls_039">of </span><span class="cls_059">Taco</span><span class="cls_039"> objects consumed. (In fact, you already made this change to </span><span class="cls_059">DesignTaco-</span></div>
<div style="position:absolute;left:102.27px;top:215.66px" class="cls_059"><span class="cls_059">Controller</span><span class="cls_039"> and its </span><span class="cls_059">recentTacos()</span><span class="cls_039"> method in section 11.1.2.)</span></div>
<div style="position:absolute;left:117.60px;top:228.65px" class="cls_039"><span class="cls_039">The changes required for </span><span class="cls_059">OrderRepository</span><span class="cls_039"> are similarly straightforward. Rather</span></div>
<div style="position:absolute;left:102.18px;top:241.67px" class="cls_039"><span class="cls_039">than extend </span><span class="cls_059">CrudRepository</span><span class="cls_039">, it will now extend </span><span class="cls_059">ReactiveCassandraRepository</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:102.18px;top:261.35px" class="cls_060"><span class="cls_060">public interface OrderRepository</span></div>
<div style="position:absolute;left:145.36px;top:271.34px" class="cls_060"><span class="cls_060">extends ReactiveCassandraRepository&lt;Order, UUID&gt; {</span></div>
<div style="position:absolute;left:102.18px;top:281.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:302.66px" class="cls_039"><span class="cls_039">Finally, let’s look at </span><span class="cls_059">UserRepository</span><span class="cls_039">. As you’ll recall, </span><span class="cls_059">UserRepository</span><span class="cls_039"> has a custom</span></div>
<div style="position:absolute;left:102.18px;top:315.68px" class="cls_039"><span class="cls_039">query method, </span><span class="cls_059">findByUsername()</span><span class="cls_039">. This method adds a little twist to how you must</span></div>
<div style="position:absolute;left:102.18px;top:328.67px" class="cls_039"><span class="cls_039">define the repository for Cassandra persistence. Here’s what a Cassandra-ready </span><span class="cls_059">User-</span></div>
<div style="position:absolute;left:102.18px;top:341.66px" class="cls_059"><span class="cls_059">Repository</span><span class="cls_039"> interface looks like:</span></div>
<div style="position:absolute;left:102.18px;top:361.34px" class="cls_060"><span class="cls_060">public interface UserRepository</span></div>
<div style="position:absolute;left:145.36px;top:371.33px" class="cls_060"><span class="cls_060">extends ReactiveCassandraRepository&lt;User, UUID&gt; {</span></div>
<div style="position:absolute;left:111.78px;top:391.34px" class="cls_060"><span class="cls_060">@AllowFiltering</span></div>
<div style="position:absolute;left:111.78px;top:401.36px" class="cls_060"><span class="cls_060">Mono&lt;User&gt; findByUsername(String username);</span></div>
<div style="position:absolute;left:102.18px;top:421.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:442.67px" class="cls_039"><span class="cls_039">Following suit with all of the other repository interfaces</span></div>
<div style="position:absolute;left:377.32px;top:442.67px" class="cls_039"><span class="cls_039">(except </span><span class="cls_059">Ingredient-</span></div>
<div style="position:absolute;left:102.27px;top:455.66px" class="cls_059"><span class="cls_059">Repository</span><span class="cls_039">), </span><span class="cls_059">UserRepository</span><span class="cls_039"> extends </span><span class="cls_059">ReactiveCassandraRepository</span><span class="cls_039">. No surprises so</span></div>
<div style="position:absolute;left:102.18px;top:468.68px" class="cls_039"><span class="cls_039">far. But its </span><span class="cls_059">findByUsername()</span><span class="cls_039"> method demands a little bit of extra attention.</span></div>
<div style="position:absolute;left:118.48px;top:481.67px" class="cls_039"><span class="cls_039">First, because this is intended to be a reactive repository, a </span><span class="cls_059">findByUsername()</span></div>
<div style="position:absolute;left:102.18px;top:494.66px" class="cls_039"><span class="cls_039">method that simply returns a </span><span class="cls_059">User</span><span class="cls_039"> object won’t do. You redefine it to return a</span></div>
<div style="position:absolute;left:102.18px;top:507.68px" class="cls_059"><span class="cls_059">Mono&lt;User&gt;</span><span class="cls_039">. Generally speaking, any custom query methods you write in a reactive</span></div>
<div style="position:absolute;left:102.18px;top:520.67px" class="cls_039"><span class="cls_039">repository should return either a </span><span class="cls_059">Mono</span><span class="cls_039"> (if there will be no more than one value</span></div>
<div style="position:absolute;left:102.18px;top:533.66px" class="cls_039"><span class="cls_039">returned) or a </span><span class="cls_059">Flux</span><span class="cls_039"> (if there could be many values returned).</span></div>
<div style="position:absolute;left:117.55px;top:546.68px" class="cls_039"><span class="cls_039">Also, the nature of Cassandra is such that you can’t simply query a table with a</span></div>
<div style="position:absolute;left:102.18px;top:559.67px" class="cls_059"><span class="cls_059">where</span><span class="cls_039"> clause, like you might do in SQL against a relational database. Cassandra is</span></div>
<div style="position:absolute;left:102.18px;top:572.69px" class="cls_039"><span class="cls_039">optimized for reading. But filtering results with a where clause could potentially</span></div>
<div style="position:absolute;left:102.18px;top:585.68px" class="cls_039"><span class="cls_039">slow down an otherwise fast query. Even so, querying a table where the results are</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:221048px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background334.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">312</span></div>
<div style="position:absolute;left:191.76px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 12</span></div>
<div style="position:absolute;left:240.72px;top:24.35px" class="cls_055"><span class="cls_055">Persisting data reactively</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">filtered by one or more columns is very useful. Therefore, the </span><span class="cls_059">@AllowFiltering</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">annotation makes it possible to filter the results, acting as an opt-in for those cases</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">where it’s needed.</span></div>
<div style="position:absolute;left:107.78px;top:89.66px" class="cls_039"><span class="cls_039">In the case of </span><span class="cls_059">findByUsername()</span><span class="cls_039">, you’d expect a CQL query that looks like this:</span></div>
<div style="position:absolute;left:93.18px;top:112.34px" class="cls_061"><span class="cls_061">select * from users where username='some username';</span></div>
<div style="position:absolute;left:93.18px;top:136.67px" class="cls_039"><span class="cls_039">Again, that isn’t allowed by Cassandra. But when the </span><span class="cls_059">@AllowFiltering</span><span class="cls_039"> annotation is</span></div>
<div style="position:absolute;left:93.18px;top:149.66px" class="cls_039"><span class="cls_039">placed on </span><span class="cls_059">findByUsername()</span><span class="cls_039">, the resulting CQL query looks like this:</span></div>
<div style="position:absolute;left:93.18px;top:172.34px" class="cls_061"><span class="cls_061">select * from users where username='some username' allow filtering;</span></div>
<div style="position:absolute;left:93.18px;top:196.67px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">allow</span><span class="cls_039"> </span><span class="cls_059">filtering</span><span class="cls_039"> clause at the end of the query alerts Cassandra that you’re aware</span></div>
<div style="position:absolute;left:93.18px;top:209.66px" class="cls_039"><span class="cls_039">of the potential impacts to the query’s performance and that you need it anyway. In that</span></div>
<div style="position:absolute;left:93.18px;top:222.65px" class="cls_039"><span class="cls_039">case, Cassandra will allow the </span><span class="cls_059">where</span><span class="cls_039"> clause and filter the results accordingly.</span></div>
<div style="position:absolute;left:107.59px;top:235.67px" class="cls_039"><span class="cls_039">There’s a lot of power in Cassandra, and when it’s teamed up with Spring Data and</span></div>
<div style="position:absolute;left:93.18px;top:248.66px" class="cls_039"><span class="cls_039">Reactor, you can wield that power in your Spring applications. But let’s shift our atten-</span></div>
<div style="position:absolute;left:93.18px;top:261.65px" class="cls_039"><span class="cls_039">tion to another database for which reactive repository support is available: MongoDB.</span></div>
<div style="position:absolute;left:57.18px;top:286.84px" class="cls_040"><span class="cls_040">12.3</span></div>
<div style="position:absolute;left:93.18px;top:286.84px" class="cls_040"><span class="cls_040">Writing reactive MongoDB repositories</span></div>
<div style="position:absolute;left:93.18px;top:306.17px" class="cls_039"><span class="cls_039">MongoDB is a another well-known NoSQL database. Whereas Cassandra is a row-</span></div>
<div style="position:absolute;left:93.18px;top:319.16px" class="cls_039"><span class="cls_039">store database, MongoDB is considered a document database. More specifically,</span></div>
<div style="position:absolute;left:93.18px;top:332.18px" class="cls_039"><span class="cls_039">MongoDB stores documents in BSON (Binary JSON) format, which can be queried</span></div>
<div style="position:absolute;left:93.18px;top:345.17px" class="cls_039"><span class="cls_039">for and retrieved in a way that’s roughly similar to how you might query for data in</span></div>
<div style="position:absolute;left:93.18px;top:358.16px" class="cls_039"><span class="cls_039">any other database.</span></div>
<div style="position:absolute;left:108.12px;top:371.18px" class="cls_039"><span class="cls_039">As with Cassandra, it’s important to understand that MongoDB isn’t a relational</span></div>
<div style="position:absolute;left:93.18px;top:384.17px" class="cls_039"><span class="cls_039">database. The way you manage your MongoDB server cluster, as well as how you</span></div>
<div style="position:absolute;left:93.18px;top:397.16px" class="cls_039"><span class="cls_039">model your data, requires a different mindset than when working with other kinds</span></div>
<div style="position:absolute;left:93.18px;top:410.18px" class="cls_039"><span class="cls_039">of databases.</span></div>
<div style="position:absolute;left:109.32px;top:423.17px" class="cls_039"><span class="cls_039">That said, working with MongoDB and Spring Data isn’t dramatically different</span></div>
<div style="position:absolute;left:93.18px;top:436.16px" class="cls_039"><span class="cls_039">from how you might use Spring Data for working with JPA or Cassandra. You’ll anno-</span></div>
<div style="position:absolute;left:93.18px;top:449.18px" class="cls_039"><span class="cls_039">tate your domain classes with annotations that map the domain type to a document</span></div>
<div style="position:absolute;left:93.18px;top:462.17px" class="cls_039"><span class="cls_039">structure. And you’ll write repository interfaces that very much follow the same pro-</span></div>
<div style="position:absolute;left:93.18px;top:475.16px" class="cls_039"><span class="cls_039">gramming model as those you’ve seen for JPA and Cassandra. Before you can do any</span></div>
<div style="position:absolute;left:93.18px;top:488.18px" class="cls_039"><span class="cls_039">of that, though, you must enable Spring Data MongoDB in your project.</span></div>
<div style="position:absolute;left:57.18px;top:514.01px" class="cls_063"><span class="cls_063">12.3.1</span></div>
<div style="position:absolute;left:93.18px;top:514.01px" class="cls_063"><span class="cls_063">Enabling Spring Data MongoDB</span></div>
<div style="position:absolute;left:93.18px;top:531.68px" class="cls_039"><span class="cls_039">To get started with Spring Data MongoDB, you’ll need to add the Spring Data Mon-</span></div>
<div style="position:absolute;left:93.18px;top:544.67px" class="cls_039"><span class="cls_039">goDB starter to the project build. Spring Data MongoDB has two separate starters to</span></div>
<div style="position:absolute;left:93.18px;top:557.69px" class="cls_039"><span class="cls_039">choose from.</span></div>
<div style="position:absolute;left:109.34px;top:570.68px" class="cls_039"><span class="cls_039">If you’re working with non-reactive MongoDB, you’ll add the following depen-</span></div>
<div style="position:absolute;left:93.18px;top:583.67px" class="cls_039"><span class="cls_039">dency to the build:</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:221724px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background335.jpg" width="531" height="666"></div>
<div style="position:absolute;left:200.34px;top:24.35px" class="cls_055"><span class="cls_055">Writing reactive MongoDB repositories</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">313</span></div>
<div style="position:absolute;left:102.18px;top:51.32px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:111.78px;top:61.34px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:111.78px;top:71.33px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;</span></div>
<div style="position:absolute;left:121.38px;top:81.32px" class="cls_060"><span class="cls_060">spring-boot-starter-data-mongodb</span></div>
<div style="position:absolute;left:111.78px;top:91.34px" class="cls_060"><span class="cls_060">&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:102.18px;top:101.33px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:102.18px;top:122.66px" class="cls_039"><span class="cls_039">This dependency is also available from the Spring Initializr by checking the MongoDB</span></div>
<div style="position:absolute;left:102.18px;top:135.65px" class="cls_039"><span class="cls_039">check box. But this chapter is all about writing reactive repositories, so you’ll choose</span></div>
<div style="position:absolute;left:102.18px;top:148.67px" class="cls_039"><span class="cls_039">the reactive Spring Data MongoDB starter dependency instead:</span></div>
<div style="position:absolute;left:102.18px;top:168.35px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:111.78px;top:178.34px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:111.78px;top:188.33px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;</span></div>
<div style="position:absolute;left:121.38px;top:198.35px" class="cls_060"><span class="cls_060">spring-boot-starter-data-mongodb-reactive</span></div>
<div style="position:absolute;left:111.78px;top:208.34px" class="cls_060"><span class="cls_060">&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:102.18px;top:218.33px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:102.18px;top:239.66px" class="cls_039"><span class="cls_039">The reactive Spring Data MongoDB starter can also be added to the build by checking</span></div>
<div style="position:absolute;left:102.18px;top:252.65px" class="cls_039"><span class="cls_039">the Reactive MongoDB check box from the Initializr. By adding the starter to the</span></div>
<div style="position:absolute;left:102.18px;top:265.67px" class="cls_039"><span class="cls_039">build, autoconfiguration will be triggered to enable Spring Data support for writing</span></div>
<div style="position:absolute;left:102.18px;top:278.66px" class="cls_039"><span class="cls_039">automatic repository interfaces, such as those you wrote for JPA in chapter 3 or for</span></div>
<div style="position:absolute;left:102.18px;top:291.65px" class="cls_039"><span class="cls_039">Cassandra earlier in this chapter.</span></div>
<div style="position:absolute;left:117.30px;top:304.67px" class="cls_039"><span class="cls_039">By default, Spring Data MongoDB assumes that you have a MongoDB server run-</span></div>
<div style="position:absolute;left:102.18px;top:317.66px" class="cls_039"><span class="cls_039">ning locally and listening on port 27017. But for convenience in testing or developing,</span></div>
<div style="position:absolute;left:102.18px;top:330.68px" class="cls_039"><span class="cls_039">you can choose to work with an embedded Mongo database instead. To do that, add</span></div>
<div style="position:absolute;left:102.18px;top:343.67px" class="cls_039"><span class="cls_039">the Flapdoodle Embedded MongoDB dependency to your build:</span></div>
<div style="position:absolute;left:102.18px;top:363.35px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:111.78px;top:373.34px" class="cls_060"><span class="cls_060">&lt;groupId&gt;de.flapdoodle.embed&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:111.78px;top:383.36px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;de.flapdoodle.embed.mongo&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:102.18px;top:393.35px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:102.18px;top:414.68px" class="cls_039"><span class="cls_039">The Flapdoodle embedded database affords you all of the same convenience of working</span></div>
<div style="position:absolute;left:102.18px;top:427.67px" class="cls_039"><span class="cls_039">with an in-memory Mongo database as you’d get with H2 when working with rela-</span></div>
<div style="position:absolute;left:102.18px;top:440.66px" class="cls_039"><span class="cls_039">tional data. That is, you won’t need to have a separate database running, but all data</span></div>
<div style="position:absolute;left:102.18px;top:453.68px" class="cls_039"><span class="cls_039">will be wiped clean when you restart the application.</span></div>
<div style="position:absolute;left:118.31px;top:466.67px" class="cls_039"><span class="cls_039">Embedded databases are fine for development and testing, but once you take</span></div>
<div style="position:absolute;left:102.18px;top:479.66px" class="cls_039"><span class="cls_039">your application to production, you’ll want to be sure you set a few properties to let</span></div>
<div style="position:absolute;left:102.18px;top:492.68px" class="cls_039"><span class="cls_039">Spring Data MongoDB know where and how your production Mongo database can</span></div>
<div style="position:absolute;left:102.18px;top:505.67px" class="cls_039"><span class="cls_039">be accessed:</span></div>
<div style="position:absolute;left:102.18px;top:525.35px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:111.78px;top:535.34px" class="cls_060"><span class="cls_060">data:</span></div>
<div style="position:absolute;left:121.38px;top:545.36px" class="cls_060"><span class="cls_060">mongodb:</span></div>
<div style="position:absolute;left:130.95px;top:555.35px" class="cls_060"><span class="cls_060">host: mongodb.tacocloud.com</span></div>
<div style="position:absolute;left:130.95px;top:565.34px" class="cls_060"><span class="cls_060">port: 27018</span></div>
<div style="position:absolute;left:130.95px;top:575.36px" class="cls_060"><span class="cls_060">username: tacocloud</span></div>
<div style="position:absolute;left:130.95px;top:585.35px" class="cls_060"><span class="cls_060">password: s3cr3tp455w0rd</span></div>
<div style="position:absolute;left:130.95px;top:595.34px" class="cls_061"><span class="cls_061">database: tacoclouddb</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:222400px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background336.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">314</span></div>
<div style="position:absolute;left:191.76px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 12</span></div>
<div style="position:absolute;left:240.72px;top:24.35px" class="cls_055"><span class="cls_055">Persisting data reactively</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">Not all of these properties are required, but they’re available to help point Spring</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">Data MongoDB in the right direction in the event that your Mongo database isn’t run-</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">ning locally. Breaking it down, here’s what each property configures:</span></div>
<div style="position:absolute;left:108.78px;top:93.65px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> spring.data.mongodb.host</span><span class="cls_039">—The hostname where Mongo is running (default:</span></div>
<div style="position:absolute;left:120.78px;top:106.67px" class="cls_059"><span class="cls_059">localhost</span><span class="cls_039">)</span></div>
<div style="position:absolute;left:108.78px;top:120.65px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> spring.data.mongodb.port</span><span class="cls_039">—The port that the Mongo server is listening on</span></div>
<div style="position:absolute;left:120.78px;top:133.67px" class="cls_039"><span class="cls_039">(default: </span><span class="cls_059">27017</span><span class="cls_039">)</span></div>
<div style="position:absolute;left:108.78px;top:147.65px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> spring.data.mongodb.username</span><span class="cls_039">—The username to use to access a secured</span></div>
<div style="position:absolute;left:120.78px;top:160.67px" class="cls_039"><span class="cls_039">Mongo database</span></div>
<div style="position:absolute;left:108.78px;top:174.65px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> spring.data.mongodb.password</span><span class="cls_039">—The password to use to access a secured</span></div>
<div style="position:absolute;left:120.78px;top:187.67px" class="cls_039"><span class="cls_039">Mongo database</span></div>
<div style="position:absolute;left:108.78px;top:201.65px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> spring.data.mongodb.database</span><span class="cls_039">—The database name (default: test)</span></div>
<div style="position:absolute;left:93.18px;top:219.65px" class="cls_039"><span class="cls_039">Now that you have Spring Data MongoDB enabled in your project, you need to anno-</span></div>
<div style="position:absolute;left:93.18px;top:232.67px" class="cls_039"><span class="cls_039">tate your domain objects for persistence as documents in MongoDB.</span></div>
<div style="position:absolute;left:57.18px;top:254.48px" class="cls_063"><span class="cls_063">12.3.2</span></div>
<div style="position:absolute;left:93.18px;top:254.48px" class="cls_063"><span class="cls_063">Mapping domain types to documents</span></div>
<div style="position:absolute;left:93.18px;top:271.67px" class="cls_039"><span class="cls_039">Spring Data MongoDB offers a handful of annotations that are useful for mapping</span></div>
<div style="position:absolute;left:93.18px;top:284.66px" class="cls_039"><span class="cls_039">domain types to document structures to be persisted in MongoDB. Although Spring</span></div>
<div style="position:absolute;left:93.18px;top:297.68px" class="cls_039"><span class="cls_039">Data MongoDB provides a half dozen annotations for mapping, only three of them</span></div>
<div style="position:absolute;left:93.18px;top:310.67px" class="cls_039"><span class="cls_039">are useful for most common use cases:</span></div>
<div style="position:absolute;left:108.78px;top:329.18px" class="cls_062"><span class="cls_062"></span></div>
<div style="position:absolute;left:120.78px;top:327.68px" class="cls_059"><span class="cls_059">@Id</span><span class="cls_039">—Designates a property as the document ID (from Spring Data Commons)</span></div>
<div style="position:absolute;left:108.78px;top:343.16px" class="cls_062"><span class="cls_062"></span></div>
<div style="position:absolute;left:120.78px;top:341.66px" class="cls_059"><span class="cls_059">@Document</span><span class="cls_039">—Declares a domain type as a document to be persisted to MongoDB</span></div>
<div style="position:absolute;left:108.78px;top:357.17px" class="cls_062"><span class="cls_062"></span></div>
<div style="position:absolute;left:120.78px;top:355.67px" class="cls_059"><span class="cls_059">@Field</span><span class="cls_039">—Specifies the field name (and optionally the order) for storing a prop-</span></div>
<div style="position:absolute;left:120.78px;top:368.66px" class="cls_039"><span class="cls_039">erty in the persisted document</span></div>
<div style="position:absolute;left:93.18px;top:386.66px" class="cls_039"><span class="cls_039">Of those three annotations, only the </span><span class="cls_059">@Id</span><span class="cls_039"> and </span><span class="cls_059">@Document</span><span class="cls_039"> annotations are strictly</span></div>
<div style="position:absolute;left:93.18px;top:399.68px" class="cls_039"><span class="cls_039">required. Unless you specify otherwise, properties that aren’t annotated with </span><span class="cls_059">@Field</span></div>
<div style="position:absolute;left:93.18px;top:412.67px" class="cls_039"><span class="cls_039">will assume a field name equal to the property name.</span></div>
<div style="position:absolute;left:107.77px;top:425.66px" class="cls_039"><span class="cls_039">Applying these annotations to the </span><span class="cls_059">Ingredient</span><span class="cls_039"> class, you get the following:</span></div>
<div style="position:absolute;left:93.18px;top:445.34px" class="cls_060"><span class="cls_060">package tacos;</span></div>
<div style="position:absolute;left:93.18px;top:455.36px" class="cls_060"><span class="cls_060">import org.springframework.data.annotation.Id;</span></div>
<div style="position:absolute;left:93.18px;top:465.35px" class="cls_060"><span class="cls_060">import org.springframework.data.mongodb.core.mapping.Document;</span></div>
<div style="position:absolute;left:93.18px;top:475.34px" class="cls_060"><span class="cls_060">import lombok.AccessLevel;</span></div>
<div style="position:absolute;left:93.18px;top:485.36px" class="cls_060"><span class="cls_060">import lombok.Data;</span></div>
<div style="position:absolute;left:93.18px;top:495.35px" class="cls_060"><span class="cls_060">import lombok.NoArgsConstructor;</span></div>
<div style="position:absolute;left:93.18px;top:505.34px" class="cls_060"><span class="cls_060">import lombok.RequiredArgsConstructor;</span></div>
<div style="position:absolute;left:93.18px;top:525.35px" class="cls_060"><span class="cls_060">@Data</span></div>
<div style="position:absolute;left:93.18px;top:535.34px" class="cls_060"><span class="cls_060">@RequiredArgsConstructor</span></div>
<div style="position:absolute;left:93.18px;top:545.36px" class="cls_060"><span class="cls_060">@NoArgsConstructor(access=AccessLevel.PRIVATE, force=true)</span></div>
<div style="position:absolute;left:93.18px;top:555.35px" class="cls_060"><span class="cls_060">@Document</span></div>
<div style="position:absolute;left:93.18px;top:565.34px" class="cls_060"><span class="cls_060">public class Ingredient {</span></div>
<div style="position:absolute;left:102.78px;top:585.35px" class="cls_060"><span class="cls_060">@Id</span></div>
<div style="position:absolute;left:102.78px;top:595.34px" class="cls_060"><span class="cls_060">private final String id;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:223076px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background337.jpg" width="531" height="666"></div>
<div style="position:absolute;left:200.34px;top:24.35px" class="cls_055"><span class="cls_055">Writing reactive MongoDB repositories</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">315</span></div>
<div style="position:absolute;left:111.78px;top:51.32px" class="cls_060"><span class="cls_060">private final String name;</span></div>
<div style="position:absolute;left:111.78px;top:61.34px" class="cls_060"><span class="cls_060">private final Type type;</span></div>
<div style="position:absolute;left:111.78px;top:81.32px" class="cls_060"><span class="cls_060">public static enum Type {</span></div>
<div style="position:absolute;left:121.38px;top:91.34px" class="cls_060"><span class="cls_060">WRAP, PROTEIN, VEGGIES, CHEESE, SAUCE</span></div>
<div style="position:absolute;left:111.78px;top:101.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:121.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:140.66px" class="cls_039"><span class="cls_039">As you can see, you place the </span><span class="cls_059">@Document</span><span class="cls_039"> annotation at the class level to indicate that</span></div>
<div style="position:absolute;left:102.18px;top:153.65px" class="cls_059"><span class="cls_059">Ingredient</span><span class="cls_039"> is a document entity that can be written to and read from a Mongo data-</span></div>
<div style="position:absolute;left:102.18px;top:166.67px" class="cls_039"><span class="cls_039">base. By default, the collection name (the Mongo analog to a relational database</span></div>
<div style="position:absolute;left:102.18px;top:179.66px" class="cls_039"><span class="cls_039">table) is based on the class name, with the first letter lowercased. Because you haven’t</span></div>
<div style="position:absolute;left:102.18px;top:192.65px" class="cls_039"><span class="cls_039">specified otherwise, </span><span class="cls_059">Ingredient</span><span class="cls_039"> objects will be persisted to a collection named </span><span class="cls_059">ingre-</span></div>
<div style="position:absolute;left:102.18px;top:205.67px" class="cls_059"><span class="cls_059">dient</span><span class="cls_039">. But you can change that by setting the </span><span class="cls_059">collection</span><span class="cls_039"> attribute of </span><span class="cls_059">@Document</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:102.18px;top:225.35px" class="cls_060"><span class="cls_060">@Data</span></div>
<div style="position:absolute;left:102.18px;top:235.34px" class="cls_060"><span class="cls_060">@RequiredArgsConstructor</span></div>
<div style="position:absolute;left:102.18px;top:245.33px" class="cls_060"><span class="cls_060">@NoArgsConstructor(access=AccessLevel.PRIVATE, force=true)</span></div>
<div style="position:absolute;left:102.18px;top:255.35px" class="cls_060"><span class="cls_060">@Document(collection="ingredients")</span></div>
<div style="position:absolute;left:102.18px;top:265.34px" class="cls_060"><span class="cls_060">public class Ingredient {</span></div>
<div style="position:absolute;left:102.18px;top:285.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:306.68px" class="cls_039"><span class="cls_039">You’ll also notice that the </span><span class="cls_059">id</span><span class="cls_039"> property has been annotated with </span><span class="cls_059">@Id</span><span class="cls_039">. This designates</span></div>
<div style="position:absolute;left:102.18px;top:319.67px" class="cls_039"><span class="cls_039">the property as being the ID of the persisted document. You can use </span><span class="cls_059">@Id</span><span class="cls_039"> on any prop-</span></div>
<div style="position:absolute;left:102.18px;top:332.66px" class="cls_039"><span class="cls_039">erty whose type is </span><span class="cls_059">Serializable</span><span class="cls_039">, including </span><span class="cls_059">String</span><span class="cls_039"> and </span><span class="cls_059">Long</span><span class="cls_039">. In this case, you’re</span></div>
<div style="position:absolute;left:102.18px;top:345.68px" class="cls_039"><span class="cls_039">already using the </span><span class="cls_059">String</span><span class="cls_039">-defined </span><span class="cls_059">id</span><span class="cls_039"> property as a natural identifier, so there’s no</span></div>
<div style="position:absolute;left:102.18px;top:358.67px" class="cls_039"><span class="cls_039">need to change it to any other type.</span></div>
<div style="position:absolute;left:117.27px;top:371.66px" class="cls_039"><span class="cls_039">So far, so good. But you’ll recall from earlier in this chapter that </span><span class="cls_059">Ingredient</span><span class="cls_039"> was</span></div>
<div style="position:absolute;left:102.18px;top:384.68px" class="cls_039"><span class="cls_039">the easy domain type to map for Cassandra. The other domain types, such as </span><span class="cls_059">Taco</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:102.18px;top:397.67px" class="cls_039"><span class="cls_039">were a bit more challenging. Let’s look at how you can map the </span><span class="cls_059">Taco</span><span class="cls_039"> class to see what</span></div>
<div style="position:absolute;left:102.18px;top:410.66px" class="cls_039"><span class="cls_039">surprises it might hold.</span></div>
<div style="position:absolute;left:117.20px;top:423.68px" class="cls_039"><span class="cls_039">As with any domain-to-document mapping for MongoDB, you’ll certainly need to</span></div>
<div style="position:absolute;left:102.18px;top:436.67px" class="cls_039"><span class="cls_039">annotate </span><span class="cls_059">Taco</span><span class="cls_039"> with </span><span class="cls_059">@Document</span><span class="cls_039">. And you’ll also need to designate an ID property with</span></div>
<div style="position:absolute;left:102.18px;top:449.66px" class="cls_059"><span class="cls_059">@Id</span><span class="cls_039">. Doing so yields the following </span><span class="cls_059">Taco</span><span class="cls_039"> class annotated for MongoDB persistence:</span></div>
<div style="position:absolute;left:102.18px;top:469.34px" class="cls_060"><span class="cls_060">@Data</span></div>
<div style="position:absolute;left:102.18px;top:479.36px" class="cls_060"><span class="cls_060">@RestResource(rel="tacos", path="tacos")</span></div>
<div style="position:absolute;left:102.18px;top:489.35px" class="cls_060"><span class="cls_060">@Document</span></div>
<div style="position:absolute;left:102.18px;top:499.34px" class="cls_060"><span class="cls_060">public class Taco {</span></div>
<div style="position:absolute;left:111.78px;top:519.35px" class="cls_060"><span class="cls_060">@Id</span></div>
<div style="position:absolute;left:111.78px;top:529.34px" class="cls_060"><span class="cls_060">private String id;</span></div>
<div style="position:absolute;left:111.78px;top:549.35px" class="cls_060"><span class="cls_060">@NotNull</span></div>
<div style="position:absolute;left:111.78px;top:559.34px" class="cls_060"><span class="cls_060">@Size(min=5, message="Name must be at least 5 characters long")</span></div>
<div style="position:absolute;left:111.78px;top:569.36px" class="cls_060"><span class="cls_060">private String name;</span></div>
<div style="position:absolute;left:111.78px;top:589.34px" class="cls_060"><span class="cls_060">private Date createdAt = new Date();</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:223752px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background338.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">316</span></div>
<div style="position:absolute;left:191.76px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 12</span></div>
<div style="position:absolute;left:240.72px;top:24.35px" class="cls_055"><span class="cls_055">Persisting data reactively</span></div>
<div style="position:absolute;left:102.78px;top:51.32px" class="cls_060"><span class="cls_060">@Size(min=1, message="You must choose at least 1 ingredient")</span></div>
<div style="position:absolute;left:102.78px;top:61.34px" class="cls_060"><span class="cls_060">private List&lt;Ingredient&gt; ingredients;</span></div>
<div style="position:absolute;left:93.18px;top:81.32px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">Believe it or not, that’s it! The challenges of dealing with two different primary key</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">fields and referencing user-defined types were specific to Cassandra. For MongoDB,</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">Taco</span><span class="cls_039"> mapping is much simpler.</span></div>
<div style="position:absolute;left:108.45px;top:141.65px" class="cls_039"><span class="cls_039">Even so, there are a few interesting things to point out in </span><span class="cls_059">Taco</span><span class="cls_039">. First, notice that</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">id</span><span class="cls_039"> property has been changed to be a </span><span class="cls_059">String</span><span class="cls_039"> (as opposed to a </span><span class="cls_059">Long</span><span class="cls_039"> in the JPA ver-</span></div>
<div style="position:absolute;left:93.18px;top:167.66px" class="cls_039"><span class="cls_039">sion or a </span><span class="cls_059">UUID</span><span class="cls_039"> in the Cassandra version). As I said earlier, </span><span class="cls_059">@Id</span><span class="cls_039"> can be applied to any</span></div>
<div style="position:absolute;left:93.18px;top:180.65px" class="cls_059"><span class="cls_059">Serializable</span><span class="cls_039"> type. But if you choose to use a </span><span class="cls_059">String</span><span class="cls_039"> property as the ID, you get the</span></div>
<div style="position:absolute;left:93.18px;top:193.67px" class="cls_039"><span class="cls_039">benefit of Mongo automatically assigning a value to it when it’s saved (assuming that</span></div>
<div style="position:absolute;left:93.18px;top:206.66px" class="cls_039"><span class="cls_039">it’s </span><span class="cls_059">null</span><span class="cls_039">). By choosing </span><span class="cls_059">String</span><span class="cls_039">, you get a database-managed ID assignment and</span></div>
<div style="position:absolute;left:93.18px;top:219.65px" class="cls_039"><span class="cls_039">needn’t worry about setting that property manually.</span></div>
<div style="position:absolute;left:107.50px;top:232.67px" class="cls_039"><span class="cls_039">Also, take a look at the </span><span class="cls_059">ingredients</span><span class="cls_039"> property. Notice that it’s a </span><span class="cls_059">List&lt;Ingredient&gt;</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:93.18px;top:245.66px" class="cls_039"><span class="cls_039">just like it was in the JPA version from chapter 3. But unlike the JPA version, the list</span></div>
<div style="position:absolute;left:93.18px;top:258.65px" class="cls_039"><span class="cls_039">isn’t stored in a separate MongoDB collection. Much like its Cassandra counterpart,</span></div>
<div style="position:absolute;left:93.18px;top:271.67px" class="cls_039"><span class="cls_039">the list of ingredients is stored directly, denormalized, in the taco document. But</span></div>
<div style="position:absolute;left:93.18px;top:284.66px" class="cls_039"><span class="cls_039">unlike the Cassandra implementation, you don’t need to make up a user-defined</span></div>
<div style="position:absolute;left:93.18px;top:297.68px" class="cls_039"><span class="cls_039">type—MongoDB is happy to use any type here, whether it’s another </span><span class="cls_059">@Document</span><span class="cls_039">-</span></div>
<div style="position:absolute;left:93.18px;top:310.67px" class="cls_039"><span class="cls_039">annotated type or just a POJO.</span></div>
<div style="position:absolute;left:108.54px;top:323.66px" class="cls_039"><span class="cls_039">It certainly is a relief to see that mapping </span><span class="cls_059">Taco</span><span class="cls_039"> for document persistence is easy.</span></div>
<div style="position:absolute;left:93.18px;top:336.68px" class="cls_039"><span class="cls_039">Will that ease of mapping carry over to the </span><span class="cls_059">Order</span><span class="cls_039"> domain class? Take a look at the fol-</span></div>
<div style="position:absolute;left:93.18px;top:349.67px" class="cls_039"><span class="cls_039">lowing MongoDB-annotated </span><span class="cls_059">Order</span><span class="cls_039"> class to see for yourself:</span></div>
<div style="position:absolute;left:93.18px;top:369.35px" class="cls_060"><span class="cls_060">@Data</span></div>
<div style="position:absolute;left:93.18px;top:379.34px" class="cls_060"><span class="cls_060">@Document</span></div>
<div style="position:absolute;left:93.18px;top:389.36px" class="cls_060"><span class="cls_060">public class Order implements Serializable {</span></div>
<div style="position:absolute;left:102.77px;top:409.34px" class="cls_060"><span class="cls_060">private static final long serialVersionUID = 1L;</span></div>
<div style="position:absolute;left:102.78px;top:429.35px" class="cls_060"><span class="cls_060">@Id</span></div>
<div style="position:absolute;left:102.77px;top:439.34px" class="cls_060"><span class="cls_060">private String id;</span></div>
<div style="position:absolute;left:102.77px;top:459.35px" class="cls_060"><span class="cls_060">private Date placedAt = new Date();</span></div>
<div style="position:absolute;left:102.78px;top:479.36px" class="cls_060"><span class="cls_060">@Field("customer")</span></div>
<div style="position:absolute;left:102.78px;top:489.35px" class="cls_060"><span class="cls_060">private User user;</span></div>
<div style="position:absolute;left:102.77px;top:509.36px" class="cls_060"><span class="cls_060">// other properties omitted for brevity's sake</span></div>
<div style="position:absolute;left:102.78px;top:529.34px" class="cls_060"><span class="cls_060">private List&lt;Taco&gt; tacos = new ArrayList&lt;&gt;();</span></div>
<div style="position:absolute;left:102.78px;top:549.35px" class="cls_060"><span class="cls_060">public void addDesign(Taco design) {</span></div>
<div style="position:absolute;left:112.38px;top:559.34px" class="cls_060"><span class="cls_060">this.tacos.add(design);</span></div>
<div style="position:absolute;left:102.78px;top:569.36px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:589.34px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:224428px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background339.jpg" width="531" height="666"></div>
<div style="position:absolute;left:200.34px;top:24.35px" class="cls_055"><span class="cls_055">Writing reactive MongoDB repositories</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">317</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">For brevity’s sake, I’ve snipped out the various delivery and credit card fields. But from</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">what’s left, it’s clear that all you need is </span><span class="cls_059">@Document</span><span class="cls_039"> and </span><span class="cls_059">@Id</span><span class="cls_039">, as with the other domain</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">types. Even so, you annotate the </span><span class="cls_059">user</span><span class="cls_039"> property with </span><span class="cls_059">@Field</span><span class="cls_039"> to specify that it be stored</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">as </span><span class="cls_059">customer</span><span class="cls_039"> in the persisted document.</span></div>
<div style="position:absolute;left:116.55px;top:102.65px" class="cls_039"><span class="cls_039">By now, it shouldn’t be surprising that mapping the </span><span class="cls_059">User</span><span class="cls_039"> domain class for MongoDB</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">persistence should be just as easy:</span></div>
<div style="position:absolute;left:102.18px;top:139.34px" class="cls_060"><span class="cls_060">@Data</span></div>
<div style="position:absolute;left:102.18px;top:149.33px" class="cls_060"><span class="cls_060">@NoArgsConstructor(access=AccessLevel.PRIVATE, force=true)</span></div>
<div style="position:absolute;left:102.18px;top:159.35px" class="cls_060"><span class="cls_060">@RequiredArgsConstructor</span></div>
<div style="position:absolute;left:102.18px;top:169.34px" class="cls_060"><span class="cls_060">@Document</span></div>
<div style="position:absolute;left:102.18px;top:179.33px" class="cls_060"><span class="cls_060">public class User implements UserDetails {</span></div>
<div style="position:absolute;left:111.78px;top:199.34px" class="cls_060"><span class="cls_060">private static final long serialVersionUID = 1L;</span></div>
<div style="position:absolute;left:111.78px;top:219.35px" class="cls_060"><span class="cls_060">@Id</span></div>
<div style="position:absolute;left:111.78px;top:229.34px" class="cls_060"><span class="cls_060">private String id;</span></div>
<div style="position:absolute;left:111.78px;top:249.35px" class="cls_060"><span class="cls_060">private final String username;</span></div>
<div style="position:absolute;left:111.78px;top:269.33px" class="cls_060"><span class="cls_060">private final String password;</span></div>
<div style="position:absolute;left:111.78px;top:279.35px" class="cls_060"><span class="cls_060">private final String fullname;</span></div>
<div style="position:absolute;left:111.78px;top:289.34px" class="cls_060"><span class="cls_060">private final String street;</span></div>
<div style="position:absolute;left:111.78px;top:299.33px" class="cls_060"><span class="cls_060">private final String city;</span></div>
<div style="position:absolute;left:111.78px;top:309.35px" class="cls_060"><span class="cls_060">private final String state;</span></div>
<div style="position:absolute;left:111.78px;top:319.34px" class="cls_060"><span class="cls_060">private final String zip;</span></div>
<div style="position:absolute;left:111.78px;top:329.33px" class="cls_060"><span class="cls_060">private final String phoneNumber;</span></div>
<div style="position:absolute;left:111.77px;top:349.34px" class="cls_060"><span class="cls_060">// UserDetails method omitted for brevity's sake</span></div>
<div style="position:absolute;left:102.18px;top:369.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:393.68px" class="cls_039"><span class="cls_039">Although there are some more-advanced and unusual use cases that require addi-</span></div>
<div style="position:absolute;left:102.18px;top:406.67px" class="cls_039"><span class="cls_039">tional mapping, you’ll find that for most cases, </span><span class="cls_059">@Document</span><span class="cls_039"> and </span><span class="cls_059">@Id</span><span class="cls_039">, along with an</span></div>
<div style="position:absolute;left:102.18px;top:419.66px" class="cls_039"><span class="cls_039">occasional </span><span class="cls_059">@Field</span><span class="cls_039">, are sufficient for MongoDB mapping. They certainly do the job for</span></div>
<div style="position:absolute;left:102.18px;top:432.68px" class="cls_039"><span class="cls_039">the Taco Cloud domain types.</span></div>
<div style="position:absolute;left:116.78px;top:445.67px" class="cls_039"><span class="cls_039">All that’s left is to write the repository interfaces.</span></div>
<div style="position:absolute;left:66.18px;top:471.50px" class="cls_063"><span class="cls_063">12.3.3</span></div>
<div style="position:absolute;left:102.18px;top:471.50px" class="cls_063"><span class="cls_063">Writing reactive MongoDB repository interfaces</span></div>
<div style="position:absolute;left:102.18px;top:489.17px" class="cls_039"><span class="cls_039">Spring Data MongoDB offers automatic repository support similar to what’s provided</span></div>
<div style="position:absolute;left:102.18px;top:502.16px" class="cls_039"><span class="cls_039">by Spring Data JPA and Spring Data Cassandra. When it comes to writing reactive</span></div>
<div style="position:absolute;left:102.18px;top:515.18px" class="cls_039"><span class="cls_039">repositories for MongoDB, you have a choice between </span><span class="cls_059">ReactiveCrudRepository</span><span class="cls_039"> and</span></div>
<div style="position:absolute;left:102.18px;top:528.17px" class="cls_059"><span class="cls_059">ReactiveMongoRepository</span><span class="cls_039">. The key difference is that </span><span class="cls_059">ReactiveMongoRepository</span><span class="cls_039"> pro-</span></div>
<div style="position:absolute;left:102.18px;top:541.16px" class="cls_039"><span class="cls_039">vides a handful of special </span><span class="cls_059">insert()</span><span class="cls_039"> methods that are optimized for persisting new</span></div>
<div style="position:absolute;left:102.18px;top:554.18px" class="cls_039"><span class="cls_039">documents, whereas </span><span class="cls_059">ReactiveCrudRepository</span><span class="cls_039"> relies on </span><span class="cls_059">save()</span><span class="cls_039"> methods for new and</span></div>
<div style="position:absolute;left:102.18px;top:567.17px" class="cls_039"><span class="cls_039">existing documents.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:225104px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background340.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">318</span></div>
<div style="position:absolute;left:191.76px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 12</span></div>
<div style="position:absolute;left:240.72px;top:24.35px" class="cls_055"><span class="cls_055">Persisting data reactively</span></div>
<div style="position:absolute;left:105.18px;top:62.48px" class="cls_075"><span class="cls_075">What about non-reactive MongoDB repositories?</span></div>
<div style="position:absolute;left:105.18px;top:76.34px" class="cls_076"><span class="cls_076">The focus of this chapter is on writing reactive repositories with Spring Data. But if</span></div>
<div style="position:absolute;left:105.18px;top:87.32px" class="cls_076"><span class="cls_076">for some reason you wish to work with non-reactive repositories, you can do so by</span></div>
<div style="position:absolute;left:105.18px;top:98.33px" class="cls_076"><span class="cls_076">simply  having  your  repository  interfaces  extend </span><span class="cls_059"> CrudRepository</span><span class="cls_076">  or </span><span class="cls_059"> Mongo-</span></div>
<div style="position:absolute;left:105.18px;top:109.34px" class="cls_059"><span class="cls_059">Repository</span><span class="cls_076"> instead of </span><span class="cls_059">ReactiveCrudRepository</span><span class="cls_076"> or </span><span class="cls_059">ReactiveMongoRepository</span><span class="cls_076">.</span></div>
<div style="position:absolute;left:105.18px;top:120.32px" class="cls_076"><span class="cls_076">Then you can have the repository methods return Mongo-annotated domain types and</span></div>
<div style="position:absolute;left:105.18px;top:131.33px" class="cls_076"><span class="cls_076">collections of those domain types.</span></div>
<div style="position:absolute;left:105.18px;top:149.33px" class="cls_076"><span class="cls_076">It’s not strictly required that you do so, but you can also choose to change the </span><span class="cls_059">spring-</span></div>
<div style="position:absolute;left:105.18px;top:160.34px" class="cls_059"><span class="cls_059">boot-starter-data-mongodb-reactive</span><span class="cls_076"> dependency to </span><span class="cls_059">spring-boot-starter-</span></div>
<div style="position:absolute;left:105.18px;top:171.35px" class="cls_059"><span class="cls_059">data-mongodb</span><span class="cls_076">.</span></div>
<div style="position:absolute;left:93.18px;top:202.67px" class="cls_039"><span class="cls_039">You’ll start by defining a repository for persisting </span><span class="cls_059">Ingredient</span><span class="cls_039"> objects as docu-</span></div>
<div style="position:absolute;left:93.18px;top:215.66px" class="cls_039"><span class="cls_039">ments. You won’t be creating ingredient documents frequently, or at all, after the</span></div>
<div style="position:absolute;left:93.18px;top:228.65px" class="cls_039"><span class="cls_039">database is initialized. Therefore, the optimizations offered by </span><span class="cls_059">ReactiveMongo-</span></div>
<div style="position:absolute;left:93.33px;top:241.67px" class="cls_059"><span class="cls_059">Repository</span><span class="cls_039"> won’t be as helpful. You can write </span><span class="cls_059">IngredientRepository</span><span class="cls_039"> to extend</span></div>
<div style="position:absolute;left:93.18px;top:254.66px" class="cls_059"><span class="cls_059">ReactiveCrudRepository</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:274.34px" class="cls_060"><span class="cls_060">package tacos.data;</span></div>
<div style="position:absolute;left:93.18px;top:284.33px" class="cls_060"><span class="cls_060">import org.springframework.data.repository.reactive.ReactiveCrudRepository;</span></div>
<div style="position:absolute;left:93.18px;top:294.35px" class="cls_060"><span class="cls_060">import org.springframework.web.bind.annotation.CrossOrigin;</span></div>
<div style="position:absolute;left:93.18px;top:304.34px" class="cls_060"><span class="cls_060">import tacos.Ingredient;</span></div>
<div style="position:absolute;left:93.18px;top:324.35px" class="cls_060"><span class="cls_060">@CrossOrigin(origins="*")</span></div>
<div style="position:absolute;left:93.18px;top:334.34px" class="cls_060"><span class="cls_060">public interface IngredientRepository</span></div>
<div style="position:absolute;left:136.33px;top:344.33px" class="cls_060"><span class="cls_060">extends ReactiveCrudRepository&lt;Ingredient, String&gt; {</span></div>
<div style="position:absolute;left:93.18px;top:354.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:375.68px" class="cls_039"><span class="cls_039">Wait a minute! That looks </span><span class="cls_036">identical</span><span class="cls_039"> to the </span><span class="cls_059">IngredientRepository</span><span class="cls_039"> interface you</span></div>
<div style="position:absolute;left:93.18px;top:388.67px" class="cls_039"><span class="cls_039">wrote in section 12.2.4 for Cassandra! Indeed, it’s the same interface, with no changes.</span></div>
<div style="position:absolute;left:93.18px;top:401.66px" class="cls_039"><span class="cls_039">This highlights one of the benefits of extending </span><span class="cls_059">ReactiveCrudRepository</span><span class="cls_039">—it’s</span></div>
<div style="position:absolute;left:93.18px;top:414.68px" class="cls_039"><span class="cls_039">more portable across various database types and works equally well for MongoDB as</span></div>
<div style="position:absolute;left:93.18px;top:427.67px" class="cls_039"><span class="cls_039">for Cassandra.</span></div>
<div style="position:absolute;left:108.00px;top:440.66px" class="cls_039"><span class="cls_039">Because it’s a reactive repository, its methods deal in terms of </span><span class="cls_059">Flux</span><span class="cls_039"> and </span><span class="cls_059">Mono</span><span class="cls_039"> rather</span></div>
<div style="position:absolute;left:93.18px;top:453.68px" class="cls_039"><span class="cls_039">than raw domain types and collections of those domain types. The </span><span class="cls_059">findAll()</span><span class="cls_039"> method,</span></div>
<div style="position:absolute;left:93.18px;top:466.67px" class="cls_039"><span class="cls_039">for instance, will return </span><span class="cls_059">Flux&lt;Ingredient&gt;</span><span class="cls_039"> instead of </span><span class="cls_059">Iterable&lt;Ingredient&gt;</span><span class="cls_039">. Likewise,</span></div>
<div style="position:absolute;left:93.18px;top:479.66px" class="cls_059"><span class="cls_059">findById()</span><span class="cls_039"> will return </span><span class="cls_059">Mono&lt;Ingredient&gt;</span><span class="cls_039"> instead of </span><span class="cls_059">Optional&lt;Ingredient&gt;</span><span class="cls_039">. As a</span></div>
<div style="position:absolute;left:93.18px;top:492.68px" class="cls_039"><span class="cls_039">result, this reactive repository could be part of an end-to-end reactive flow.</span></div>
<div style="position:absolute;left:109.44px;top:505.67px" class="cls_039"><span class="cls_039">Now let’s try defining a repository for persisting </span><span class="cls_059">Taco</span><span class="cls_039"> objects as documents in</span></div>
<div style="position:absolute;left:93.18px;top:518.66px" class="cls_039"><span class="cls_039">MongoDB. Unlike ingredient documents, you’ll be creating taco documents rather</span></div>
<div style="position:absolute;left:93.18px;top:531.68px" class="cls_039"><span class="cls_039">frequently. Thus, the optimized </span><span class="cls_059">insert()</span><span class="cls_039"> methods from </span><span class="cls_059">ReactiveMongoRepository</span></div>
<div style="position:absolute;left:93.18px;top:544.67px" class="cls_039"><span class="cls_039">might prove valuable. Here’s your new MongoDB-ready </span><span class="cls_059">TacoRepository</span><span class="cls_039"> interface:</span></div>
<div style="position:absolute;left:93.18px;top:564.35px" class="cls_060"><span class="cls_060">package tacos.data;</span></div>
<div style="position:absolute;left:93.18px;top:574.34px" class="cls_060"><span class="cls_060">import org.springframework.data.mongodb.repository.ReactiveMongoRepository;</span></div>
<div style="position:absolute;left:93.18px;top:584.36px" class="cls_060"><span class="cls_060">import reactor.core.publisher.Flux;</span></div>
<div style="position:absolute;left:93.18px;top:594.35px" class="cls_060"><span class="cls_060">import tacos.Taco;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:225780px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background341.jpg" width="531" height="666"></div>
<div style="position:absolute;left:200.34px;top:24.35px" class="cls_055"><span class="cls_055">Writing reactive MongoDB repositories</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">319</span></div>
<div style="position:absolute;left:102.18px;top:51.32px" class="cls_060"><span class="cls_060">public interface TacoRepository</span></div>
<div style="position:absolute;left:145.36px;top:61.34px" class="cls_060"><span class="cls_060">extends ReactiveMongoRepository&lt;Taco, String&gt; {</span></div>
<div style="position:absolute;left:111.78px;top:81.32px" class="cls_060"><span class="cls_060">Flux&lt;Taco&gt; findByOrderByCreatedAtDesc();</span></div>
<div style="position:absolute;left:102.18px;top:101.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:122.66px" class="cls_039"><span class="cls_039">The only drawback of using </span><span class="cls_059">ReactiveMongoRepository</span><span class="cls_039"> as opposed to </span><span class="cls_059">Reactive-</span></div>
<div style="position:absolute;left:102.18px;top:135.65px" class="cls_059"><span class="cls_059">CrudRepository</span><span class="cls_039"> is that it’s very specific to MongoDB and not portable to other data-</span></div>
<div style="position:absolute;left:102.18px;top:148.67px" class="cls_039"><span class="cls_039">bases. In your projects, you’ll need to decide if that trade-off is worth it or not. If you</span></div>
<div style="position:absolute;left:102.18px;top:161.66px" class="cls_039"><span class="cls_039">don’t anticipate switching to a different database at some point, it’s safe enough to</span></div>
<div style="position:absolute;left:102.18px;top:174.65px" class="cls_039"><span class="cls_039">choose </span><span class="cls_059">ReactiveMongoRepository</span><span class="cls_039"> and benefit from the insertion optimizations.</span></div>
<div style="position:absolute;left:117.86px;top:187.67px" class="cls_039"><span class="cls_039">Notice that you introduce a new method in </span><span class="cls_059">TacoRepository</span><span class="cls_039">. This method is to</span></div>
<div style="position:absolute;left:102.18px;top:200.66px" class="cls_039"><span class="cls_039">support the use case of presenting a list of recently created tacos. In the JPA version of</span></div>
<div style="position:absolute;left:102.18px;top:213.65px" class="cls_039"><span class="cls_039">this repository, you achieved that by extending </span><span class="cls_059">PagingAndSortingRepository</span><span class="cls_039">. But</span></div>
<div style="position:absolute;left:102.18px;top:226.67px" class="cls_059"><span class="cls_059">PagingAndSortingRepository</span><span class="cls_039"> doesn’t make much sense (especially the paging part</span></div>
<div style="position:absolute;left:102.18px;top:239.66px" class="cls_039"><span class="cls_039">of it) in a reactive repository. In the Cassandra version, sorting was determined by the</span></div>
<div style="position:absolute;left:102.18px;top:252.65px" class="cls_039"><span class="cls_039">clustering key in the table definition, so you didn’t have anything special in the repos-</span></div>
<div style="position:absolute;left:102.18px;top:265.67px" class="cls_039"><span class="cls_039">itory to support fetching recent taco creations.</span></div>
<div style="position:absolute;left:117.45px;top:278.66px" class="cls_039"><span class="cls_039">But for MongoDB, you’d like to be able to fetch the most recently created tacos.</span></div>
<div style="position:absolute;left:102.18px;top:291.65px" class="cls_039"><span class="cls_039">Despite its odd name, the </span><span class="cls_059">findByOrderByCreatedAtDesc()</span><span class="cls_039"> method follows the cus-</span></div>
<div style="position:absolute;left:102.18px;top:304.67px" class="cls_039"><span class="cls_039">tom query method-naming convention. It says that you’re finding a </span><span class="cls_059">Taco</span><span class="cls_039"> object by,</span></div>
<div style="position:absolute;left:102.18px;top:317.66px" class="cls_039"><span class="cls_039">well, by nothing. You don’t specify any properties that must match. Then you tell it to</span></div>
<div style="position:absolute;left:102.18px;top:330.68px" class="cls_039"><span class="cls_039">order the results by the </span><span class="cls_059">createdAt</span><span class="cls_039"> property in descending order.</span></div>
<div style="position:absolute;left:117.00px;top:343.67px" class="cls_039"><span class="cls_039">The reason to name it with an empty </span><span class="cls_059">By</span><span class="cls_039"> clause is to avoid a misinterpretation of</span></div>
<div style="position:absolute;left:102.18px;top:356.66px" class="cls_039"><span class="cls_039">the method name, given that there’s another </span><span class="cls_059">By</span><span class="cls_039"> in the method name. Had you named</span></div>
<div style="position:absolute;left:102.18px;top:369.68px" class="cls_039"><span class="cls_039">it </span><span class="cls_059">findAllOrderByCreatedAtDesc()</span><span class="cls_039">, the </span><span class="cls_059">AllOrder</span><span class="cls_039"> portion of the name would’ve been</span></div>
<div style="position:absolute;left:102.18px;top:382.67px" class="cls_039"><span class="cls_039">ignored, and Spring Data would try to find tacos by matching against a </span><span class="cls_059">createdAt-</span></div>
<div style="position:absolute;left:102.18px;top:395.66px" class="cls_059"><span class="cls_059">Desc</span><span class="cls_039"> property. Because no such property exists, the application would fail to start,</span></div>
<div style="position:absolute;left:102.18px;top:408.68px" class="cls_039"><span class="cls_039">with an error.</span></div>
<div style="position:absolute;left:120.15px;top:421.67px" class="cls_039"><span class="cls_039">Because </span><span class="cls_059">findByOrderByCreatedAtDesc()</span><span class="cls_039"> returns a </span><span class="cls_059">Flux&lt;Taco&gt;</span><span class="cls_039">, you needn’t</span></div>
<div style="position:absolute;left:102.18px;top:434.66px" class="cls_039"><span class="cls_039">worry about paging. Instead, you can simply apply the </span><span class="cls_059">take()</span><span class="cls_039"> operation to take only</span></div>
<div style="position:absolute;left:102.18px;top:447.68px" class="cls_039"><span class="cls_039">the first dozen </span><span class="cls_059">Taco</span><span class="cls_039"> objects published in the </span><span class="cls_059">Flux</span><span class="cls_039"> returned. For example, your con-</span></div>
<div style="position:absolute;left:102.18px;top:460.67px" class="cls_039"><span class="cls_039">troller that displays the recently created tacos could make a call to </span><span class="cls_059">findByOrderBy-</span></div>
<div style="position:absolute;left:102.18px;top:473.66px" class="cls_059"><span class="cls_059">CreatedAtDesc()</span><span class="cls_039"> like this:</span></div>
<div style="position:absolute;left:102.18px;top:493.34px" class="cls_060"><span class="cls_060">Flux&lt;Taco&gt; recents = repo.findByOrderByCreatedAtDesc()</span></div>
<div style="position:absolute;left:222.13px;top:503.36px" class="cls_061"><span class="cls_061">.take(12);</span></div>
<div style="position:absolute;left:102.18px;top:524.66px" class="cls_039"><span class="cls_039">The resulting </span><span class="cls_059">Flux</span><span class="cls_039"> would only ever have, at most, 12 </span><span class="cls_059">Taco</span><span class="cls_039"> items published.</span></div>
<div style="position:absolute;left:116.76px;top:537.68px" class="cls_039"><span class="cls_039">Moving on to the </span><span class="cls_059">OrderRepository</span><span class="cls_039"> interface, you can see that it’s straightforward:</span></div>
<div style="position:absolute;left:102.18px;top:557.36px" class="cls_060"><span class="cls_060">package tacos.data;</span></div>
<div style="position:absolute;left:102.18px;top:567.35px" class="cls_060"><span class="cls_060">import org.springframework.data.mongodb.repository.ReactiveMongoRepository;</span></div>
<div style="position:absolute;left:102.18px;top:577.34px" class="cls_060"><span class="cls_060">import reactor.core.publisher.Flux;</span></div>
<div style="position:absolute;left:102.18px;top:587.36px" class="cls_060"><span class="cls_060">import tacos.Order;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:226456px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background342.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">320</span></div>
<div style="position:absolute;left:191.76px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 12</span></div>
<div style="position:absolute;left:240.72px;top:24.35px" class="cls_055"><span class="cls_055">Persisting data reactively</span></div>
<div style="position:absolute;left:93.18px;top:51.32px" class="cls_060"><span class="cls_060">public interface OrderRepository</span></div>
<div style="position:absolute;left:136.34px;top:61.34px" class="cls_060"><span class="cls_060">extends ReactiveMongoRepository&lt;Order, String&gt; {</span></div>
<div style="position:absolute;left:93.18px;top:81.32px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">You’ll be frequently creating </span><span class="cls_059">Order</span><span class="cls_039"> documents, so </span><span class="cls_059">OrderRepository</span><span class="cls_039"> extends </span><span class="cls_059">Reactive-</span></div>
<div style="position:absolute;left:93.27px;top:115.67px" class="cls_059"><span class="cls_059">MongoRepository</span><span class="cls_039"> to gain the optimizations afforded in its </span><span class="cls_059">insert()</span><span class="cls_039"> methods. Other-</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">wise, there’s nothing terribly special about this repository, compared to some of the</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">other repositories you’ve defined thus far.</span></div>
<div style="position:absolute;left:107.67px;top:154.67px" class="cls_039"><span class="cls_039">Finally, let’s take a look at the repository that will persist </span><span class="cls_059">User</span><span class="cls_039"> objects as documents:</span></div>
<div style="position:absolute;left:93.18px;top:174.35px" class="cls_060"><span class="cls_060">package tacos.data;</span></div>
<div style="position:absolute;left:93.18px;top:184.34px" class="cls_060"><span class="cls_060">import org.springframework.data.mongodb.repository.ReactiveMongoRepository;</span></div>
<div style="position:absolute;left:93.18px;top:194.33px" class="cls_060"><span class="cls_060">import reactor.core.publisher.Mono;</span></div>
<div style="position:absolute;left:93.18px;top:204.35px" class="cls_060"><span class="cls_060">import tacos.User;</span></div>
<div style="position:absolute;left:93.18px;top:224.33px" class="cls_060"><span class="cls_060">public interface UserRepository</span></div>
<div style="position:absolute;left:136.34px;top:234.35px" class="cls_060"><span class="cls_060">extends ReactiveMongoRepository&lt;User, String&gt; {</span></div>
<div style="position:absolute;left:102.78px;top:254.33px" class="cls_060"><span class="cls_060">Mono&lt;User&gt; findByUsername(String username);</span></div>
<div style="position:absolute;left:93.18px;top:274.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:295.67px" class="cls_039"><span class="cls_039">By now, there should be nothing terribly surprising about this repository interface.</span></div>
<div style="position:absolute;left:93.18px;top:308.66px" class="cls_039"><span class="cls_039">Like the others, it extends </span><span class="cls_059">ReactiveMongoRepository</span><span class="cls_039"> (although it could have also</span></div>
<div style="position:absolute;left:93.18px;top:321.68px" class="cls_039"><span class="cls_039">extended </span><span class="cls_059">ReactiveCrudRepository</span><span class="cls_039">). The only thing unique is the addition of a</span></div>
<div style="position:absolute;left:93.18px;top:334.67px" class="cls_059"><span class="cls_059">findByUsername()</span><span class="cls_039"> method, which you added in chapter 4 to support authentication</span></div>
<div style="position:absolute;left:93.18px;top:347.66px" class="cls_039"><span class="cls_039">against this repository. Here, it’s been tweaked to return a </span><span class="cls_059">Mono&lt;User&gt;</span><span class="cls_039"> instead of a raw</span></div>
<div style="position:absolute;left:93.18px;top:360.68px" class="cls_059"><span class="cls_059">User</span><span class="cls_039"> object.</span></div>
<div style="position:absolute;left:93.18px;top:381.85px" class="cls_040"><span class="cls_040">Summary</span></div>
<div style="position:absolute;left:108.78px;top:400.16px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Spring Data supports reactive repositories for Cassandra, MongoDB, Couch-</span></div>
<div style="position:absolute;left:120.78px;top:413.18px" class="cls_039"><span class="cls_039">base, and Redis databases.</span></div>
<div style="position:absolute;left:108.78px;top:427.16px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Spring Data’s reactive repositories follow the same programming model as non-</span></div>
<div style="position:absolute;left:120.78px;top:440.18px" class="cls_039"><span class="cls_039">reactive repositories, except that they deal in terms of reactive publishers such</span></div>
<div style="position:absolute;left:120.78px;top:453.17px" class="cls_039"><span class="cls_039">as </span><span class="cls_059">Flux</span><span class="cls_039"> and </span><span class="cls_059">Mono</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:108.78px;top:467.18px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Non-reactive repositories (such as JPA repositories) can be adapted to work with</span></div>
<div style="position:absolute;left:120.78px;top:480.17px" class="cls_059"><span class="cls_059">Mono</span><span class="cls_039"> and </span><span class="cls_059">Flux</span><span class="cls_039">, but they ultimately still block while data is saved and fetched.</span></div>
<div style="position:absolute;left:108.78px;top:494.18px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Working with nonrelational databases demands an understanding of how to</span></div>
<div style="position:absolute;left:120.78px;top:507.17px" class="cls_039"><span class="cls_039">model data appropriately for how the database ultimately stores the data.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:227132px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background343.jpg" width="531" height="666"></div>
<div style="position:absolute;left:388.38px;top:82.94px" class="cls_014"><span class="cls_014">Part 4</span></div>
<div style="position:absolute;left:237.78px;top:142.94px" class="cls_014"><span class="cls_014">Cloud-native Spring</span></div>
<div style="position:absolute;left:126.18px;top:215.61px" class="cls_047"><span class="cls_047">P</span></div>
<div style="position:absolute;left:145.38px;top:253.67px" class="cls_039"><span class="cls_039">art 4 breaks down the monolithic application model, introducing you to</span></div>
<div style="position:absolute;left:126.18px;top:266.66px" class="cls_039"><span class="cls_039">Spring Cloud and microservice development. In chapter 13, after a brief introduc-</span></div>
<div style="position:absolute;left:126.18px;top:279.65px" class="cls_039"><span class="cls_039">tion to microservices, we’ll dive into service discovery, using Spring with Netflix’s</span></div>
<div style="position:absolute;left:126.18px;top:292.67px" class="cls_039"><span class="cls_039">Eureka service registry to both register and discover Spring-based microservices.</span></div>
<div style="position:absolute;left:126.18px;top:305.66px" class="cls_039"><span class="cls_039">Chapter 14 explores centralized configuration using Spring Cloud’s Config</span></div>
<div style="position:absolute;left:126.18px;top:318.68px" class="cls_039"><span class="cls_039">Server, a service that provides centralized configuration for all services in a given</span></div>
<div style="position:absolute;left:126.18px;top:331.67px" class="cls_039"><span class="cls_039">application. In chapter 15, you’ll see how to apply the circuit breaker pattern to</span></div>
<div style="position:absolute;left:126.18px;top:344.66px" class="cls_039"><span class="cls_039">make services more resilient to failure with Netflix Hystrix.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:227808px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background344.jpg" width="531" height="666"></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:227808px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background345.jpg" width="531" height="666"></div>
<div style="position:absolute;left:246.78px;top:111.83px" class="cls_014"><span class="cls_014">Discovering services</span></div>
<div style="position:absolute;left:96.18px;top:264.85px" class="cls_049"><span class="cls_049">This chapter covers</span></div>
<div style="position:absolute;left:96.18px;top:283.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Thinking in microservices</span></div>
<div style="position:absolute;left:96.18px;top:298.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Creating a service registry</span></div>
<div style="position:absolute;left:96.18px;top:313.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Registering and discovering services</span></div>
<div style="position:absolute;left:114.18px;top:383.54px" class="cls_039"><span class="cls_039">Have you ever watched </span><span class="cls_036">Finding Nemo</span><span class="cls_039">? In that movie, Marlin (a clown fish) and</span></div>
<div style="position:absolute;left:114.18px;top:396.53px" class="cls_039"><span class="cls_039">Dory (a blue tang fish) are trying to get to Sydney, Australia to find Marlin’s</span></div>
<div style="position:absolute;left:114.18px;top:409.55px" class="cls_039"><span class="cls_039">missing son, Nemo. Along the way, they encounter a school of moonfish. For</span></div>
<div style="position:absolute;left:114.18px;top:422.54px" class="cls_039"><span class="cls_039">fun, the moonfish arrange themselves into several shapes—a swordfish, an octo-</span></div>
<div style="position:absolute;left:114.18px;top:435.53px" class="cls_039"><span class="cls_039">pus, and they even mock Marlin by arranging themselves to look like him. When</span></div>
<div style="position:absolute;left:114.18px;top:448.55px" class="cls_039"><span class="cls_039">Dory asks them if they know how to get to Sydney, they form the shape of the</span></div>
<div style="position:absolute;left:114.18px;top:461.54px" class="cls_039"><span class="cls_039">Sydney Opera House and then change into an arrow pointing toward the east</span></div>
<div style="position:absolute;left:114.18px;top:474.56px" class="cls_039"><span class="cls_039">Australian current.</span></div>
<div style="position:absolute;left:129.65px;top:487.55px" class="cls_039"><span class="cls_039">Although the movie doesn’t delve into the lives of any particular moonfish, it</span></div>
<div style="position:absolute;left:114.18px;top:500.54px" class="cls_039"><span class="cls_039">can be assumed that each of them is an individual, independent of the other moon-</span></div>
<div style="position:absolute;left:114.18px;top:513.56px" class="cls_039"><span class="cls_039">fish. Each has its own scales, fins, gills, eyes, internal organs, and (as far as we know)</span></div>
<div style="position:absolute;left:114.18px;top:526.55px" class="cls_039"><span class="cls_039">their own hopes and dreams. Even so, they still work together to form those fun</span></div>
<div style="position:absolute;left:114.18px;top:539.54px" class="cls_039"><span class="cls_039">shapes and help Marlin and Dory make their way to Australia.</span></div>
<div style="position:absolute;left:269.16px;top:596.99px" class="cls_048"><span class="cls_048">323</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:228484px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background346.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">324</span></div>
<div style="position:absolute;left:201.12px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 13</span></div>
<div style="position:absolute;left:250.05px;top:24.35px" class="cls_055"><span class="cls_055">Discovering services</span></div>
<div style="position:absolute;left:107.94px;top:50.66px" class="cls_039"><span class="cls_039">This chapter is the first of a handful of chapters that discuss how to develop appli-</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">cations that are composed of moonfish. That is, you’ll see how to develop with </span><span class="cls_036">micro-</span></div>
<div style="position:absolute;left:93.33px;top:76.67px" class="cls_036"><span class="cls_036">services</span><span class="cls_039">—small, independent applications that work together to provide the functionality</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">of a complete application.</span></div>
<div style="position:absolute;left:107.73px;top:102.65px" class="cls_039"><span class="cls_039">More specifically, you’re going to see how to use a few of the most useful compo-</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">nents in the Spring Cloud portfolio, including configuration management, failure</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">tolerance, and the subject of this chapter—service discovery. But before we get started,</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">let’s take a quick, high-level look at what it means to develop with microservices and</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_039"><span class="cls_039">the benefits they offer.</span></div>
<div style="position:absolute;left:57.18px;top:175.84px" class="cls_040"><span class="cls_040">13.1</span></div>
<div style="position:absolute;left:93.18px;top:175.84px" class="cls_040"><span class="cls_040">Thinking in microservices</span></div>
<div style="position:absolute;left:93.18px;top:193.67px" class="cls_039"><span class="cls_039">Up to this point, you’ve developed the Taco Cloud application as a single application</span></div>
<div style="position:absolute;left:93.18px;top:206.66px" class="cls_039"><span class="cls_039">that builds into a single, deployable JAR or WAR file. A single, deployable file seemed</span></div>
<div style="position:absolute;left:93.18px;top:219.65px" class="cls_039"><span class="cls_039">like a natural move. After all, that’s exactly how most applications have been built for</span></div>
<div style="position:absolute;left:93.18px;top:232.67px" class="cls_039"><span class="cls_039">decades. Even when the application is broken down into a multi-module build, you</span></div>
<div style="position:absolute;left:93.18px;top:245.66px" class="cls_039"><span class="cls_039">still end up with a single JAR or WAR file that you push into production.</span></div>
<div style="position:absolute;left:108.28px;top:258.65px" class="cls_039"><span class="cls_039">This is certainly the most obvious way to build small, simple applications. But the</span></div>
<div style="position:absolute;left:93.18px;top:271.67px" class="cls_039"><span class="cls_039">funny thing about small applications is that they tend to grow. It’s easy enough to drop</span></div>
<div style="position:absolute;left:93.18px;top:284.66px" class="cls_039"><span class="cls_039">more code into the project when a new feature is needed. Before you know it, you</span></div>
<div style="position:absolute;left:93.18px;top:297.68px" class="cls_039"><span class="cls_039">have a complex, monolithic application that has a mind of its own. Like the Mogwai in</span></div>
<div style="position:absolute;left:93.18px;top:310.67px" class="cls_039"><span class="cls_039">the movie </span><span class="cls_036">Gremlins</span><span class="cls_039">, if you keep feeding it, it’ll eventually become a monster that turns</span></div>
<div style="position:absolute;left:93.18px;top:323.48px" class="cls_039"><span class="cls_039">against you.</span><span class="cls_069"><sup>1</sup></span></div>
<div style="position:absolute;left:107.78px;top:336.68px" class="cls_039"><span class="cls_039">Monolithic applications are deceptively simple, but they present a few challenges:</span></div>
<div style="position:absolute;left:108.78px;top:351.64px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Monoliths are difficult to reason about</span><span class="cls_099"> —</span><span class="cls_039">The bigger the codebase gets, the harder it</span></div>
<div style="position:absolute;left:120.78px;top:366.68px" class="cls_039"><span class="cls_039">is to comprehend each component’s role in the whole application.</span></div>
<div style="position:absolute;left:108.78px;top:378.64px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Monoliths are more difficult to test</span><span class="cls_099"> —</span><span class="cls_039">As the application grows, comprehensive inte-</span></div>
<div style="position:absolute;left:120.78px;top:393.68px" class="cls_039"><span class="cls_039">gration and acceptance testing gets more complicated.</span></div>
<div style="position:absolute;left:108.78px;top:405.64px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Monoliths are more prone to library conflicts</span><span class="cls_099"> —</span><span class="cls_039">One feature may require a depen-</span></div>
<div style="position:absolute;left:120.78px;top:420.68px" class="cls_039"><span class="cls_039">dency that’s incompatible with the dependency required by another.</span></div>
<div style="position:absolute;left:108.78px;top:432.64px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Monoliths scale inefficiently</span><span class="cls_099">—</span><span class="cls_039">If you need to deploy the application to more</span></div>
<div style="position:absolute;left:120.78px;top:447.68px" class="cls_039"><span class="cls_039">hardware for scaling purposes, you must deploy the entire application to</span></div>
<div style="position:absolute;left:120.78px;top:460.67px" class="cls_039"><span class="cls_039">more servers—even if it’s only a small fraction of the application that</span></div>
<div style="position:absolute;left:120.78px;top:473.66px" class="cls_039"><span class="cls_039">requires scaling.</span></div>
<div style="position:absolute;left:108.78px;top:485.65px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Technology decisions for a monolith are made for the entire monolith</span><span class="cls_099"> —</span><span class="cls_039">When you</span></div>
<div style="position:absolute;left:120.78px;top:500.66px" class="cls_039"><span class="cls_039">choose a language, runtime platform, framework, or library for your applica-</span></div>
<div style="position:absolute;left:120.78px;top:513.68px" class="cls_039"><span class="cls_039">tion, you choose it for the entire application, even if the choice is made to only</span></div>
<div style="position:absolute;left:120.78px;top:526.67px" class="cls_039"><span class="cls_039">support a single use case.</span></div>
<div style="position:absolute;left:108.78px;top:538.66px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Monoliths require a great deal of ceremony to get to production</span><span class="cls_099"> —</span><span class="cls_039">It would seem that</span></div>
<div style="position:absolute;left:120.78px;top:553.67px" class="cls_039"><span class="cls_039">when an application has only a single deployment unit, it would be easier to get</span></div>
<div style="position:absolute;left:57.18px;top:583.01px" class="cls_070"><span class="cls_070">1</span></div>
<div style="position:absolute;left:66.18px;top:583.19px" class="cls_071"><span class="cls_071">Yes, I realize that the timing of when you feed Mogwai—after midnight—was the real issue in the movie. No</span></div>
<div style="position:absolute;left:66.18px;top:592.67px" class="cls_071"><span class="cls_071">analogy is perfect.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:229160px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background347.jpg" width="531" height="666"></div>
<div style="position:absolute;left:224.25px;top:24.35px" class="cls_055"><span class="cls_055">Thinking in microservices</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">325</span></div>
<div style="position:absolute;left:129.78px;top:50.66px" class="cls_039"><span class="cls_039">into production. In reality, however, the size and complexity of monolithic</span></div>
<div style="position:absolute;left:129.78px;top:63.65px" class="cls_039"><span class="cls_039">applications generally require a more rigid development process and a more</span></div>
<div style="position:absolute;left:129.78px;top:76.67px" class="cls_039"><span class="cls_039">thorough testing cycle to ensure that what’s deployed is of high quality and</span></div>
<div style="position:absolute;left:129.78px;top:89.66px" class="cls_039"><span class="cls_039">doesn’t introduce bugs.</span></div>
<div style="position:absolute;left:102.18px;top:107.66px" class="cls_039"><span class="cls_039">In the past few years, microservice architecture has risen to address these challenges.</span></div>
<div style="position:absolute;left:102.18px;top:120.65px" class="cls_039"><span class="cls_039">In simple terms, </span><span class="cls_036">microservice architecture</span><span class="cls_039"> is a way of factoring an application into small-</span></div>
<div style="position:absolute;left:102.18px;top:133.67px" class="cls_039"><span class="cls_039">scale, miniature applications that are independently developed and deployed. These</span></div>
<div style="position:absolute;left:102.18px;top:146.66px" class="cls_039"><span class="cls_039">microservices coordinate with each other to provide the functionality of a greater</span></div>
<div style="position:absolute;left:102.18px;top:159.65px" class="cls_039"><span class="cls_039">application. In contrast to monolithic application architecture, microservice architec-</span></div>
<div style="position:absolute;left:102.18px;top:172.67px" class="cls_039"><span class="cls_039">ture has these traits:</span></div>
<div style="position:absolute;left:117.78px;top:191.15px" class="cls_062"><span class="cls_062"></span></div>
<div style="position:absolute;left:129.78px;top:187.63px" class="cls_036"><span class="cls_036">Microservices can be easily understood</span><span class="cls_099"> —</span><span class="cls_039">Each microservice has a small, finite con-</span></div>
<div style="position:absolute;left:129.78px;top:202.67px" class="cls_039"><span class="cls_039">tract with other microservices in the greater application. As a result, microser-</span></div>
<div style="position:absolute;left:129.78px;top:215.66px" class="cls_039"><span class="cls_039">vices are more focused in purpose and, therefore, easier to understand as a unit.</span></div>
<div style="position:absolute;left:117.78px;top:231.17px" class="cls_062"><span class="cls_062"></span></div>
<div style="position:absolute;left:129.78px;top:227.65px" class="cls_036"><span class="cls_036">Microservices are easier to test</span><span class="cls_099"> —</span><span class="cls_039">The smaller something is, the easier it is to test.</span></div>
<div style="position:absolute;left:129.78px;top:242.66px" class="cls_039"><span class="cls_039">This is certainly evident when you consider unit testing versus integration test-</span></div>
<div style="position:absolute;left:129.78px;top:255.65px" class="cls_039"><span class="cls_039">ing versus acceptance testing. That also applies when testing microservices ver-</span></div>
<div style="position:absolute;left:129.78px;top:268.67px" class="cls_039"><span class="cls_039">sus monolithic applications.</span></div>
<div style="position:absolute;left:117.78px;top:284.15px" class="cls_062"><span class="cls_062"></span></div>
<div style="position:absolute;left:129.78px;top:280.63px" class="cls_036"><span class="cls_036">Microservices are unlikely to suffer from library incompatibilities</span><span class="cls_099">—</span><span class="cls_039">Because each</span></div>
<div style="position:absolute;left:129.78px;top:295.67px" class="cls_039"><span class="cls_039">microservice has its own set of build dependencies that isn’t shared with other</span></div>
<div style="position:absolute;left:129.78px;top:308.66px" class="cls_039"><span class="cls_039">microservices, it’s less likely that there’ll be library conflicts.</span></div>
<div style="position:absolute;left:117.78px;top:324.17px" class="cls_062"><span class="cls_062"></span></div>
<div style="position:absolute;left:129.78px;top:320.65px" class="cls_036"><span class="cls_036">Microservices scale independently</span><span class="cls_099"> —</span><span class="cls_039">If any given microservice needs more horse-</span></div>
<div style="position:absolute;left:129.78px;top:335.66px" class="cls_039"><span class="cls_039">power, then the memory allotment and/or the number of instances can be</span></div>
<div style="position:absolute;left:129.78px;top:348.68px" class="cls_039"><span class="cls_039">scaled up without impacting the memory or instance count of other microser-</span></div>
<div style="position:absolute;left:129.78px;top:361.67px" class="cls_039"><span class="cls_039">vices in the greater application.</span></div>
<div style="position:absolute;left:117.78px;top:377.18px" class="cls_062"><span class="cls_062"></span></div>
<div style="position:absolute;left:129.78px;top:373.66px" class="cls_036"><span class="cls_036">Technology choices can be made differently for each microservice</span><span class="cls_099">—</span><span class="cls_039">Entirely different</span></div>
<div style="position:absolute;left:129.78px;top:388.67px" class="cls_039"><span class="cls_039">decisions can be made with regard to the language, platform, framework,</span></div>
<div style="position:absolute;left:129.78px;top:401.66px" class="cls_039"><span class="cls_039">and library choices for each microservice. In fact, it’s entirely reasonable for</span></div>
<div style="position:absolute;left:129.78px;top:414.68px" class="cls_039"><span class="cls_039">one microservice written in Java to coordinate with another microservice</span></div>
<div style="position:absolute;left:129.78px;top:427.49px" class="cls_039"><span class="cls_039">written in C#.</span><span class="cls_069"><sup>2</sup></span></div>
<div style="position:absolute;left:117.78px;top:443.18px" class="cls_062"><span class="cls_062"></span></div>
<div style="position:absolute;left:129.78px;top:439.66px" class="cls_036"><span class="cls_036">Microservices can be published to production more frequently</span><span class="cls_099"> —</span><span class="cls_039">Even though a micros-</span></div>
<div style="position:absolute;left:129.78px;top:454.67px" class="cls_039"><span class="cls_039">ervice-architected application is made up of many microservices, each one can</span></div>
<div style="position:absolute;left:129.78px;top:467.66px" class="cls_039"><span class="cls_039">be deployed without requiring that any of the other microservices also be</span></div>
<div style="position:absolute;left:129.78px;top:480.68px" class="cls_039"><span class="cls_039">deployed. And because they’re smaller, more focused, and easier to test, there’s</span></div>
<div style="position:absolute;left:129.78px;top:493.67px" class="cls_039"><span class="cls_039">less ceremony in taking a microservice into production. The time between hav-</span></div>
<div style="position:absolute;left:129.78px;top:506.66px" class="cls_039"><span class="cls_039">ing an idea and seeing it in production can potentially be measured in minutes</span></div>
<div style="position:absolute;left:129.78px;top:519.68px" class="cls_039"><span class="cls_039">and hours, instead of weeks and months.</span></div>
<div style="position:absolute;left:102.18px;top:537.68px" class="cls_039"><span class="cls_039">Microservices certainly seem to make things a lot easier. But to be fair, microservice</span></div>
<div style="position:absolute;left:102.18px;top:550.67px" class="cls_039"><span class="cls_039">architecture isn’t exactly a free lunch. Microservice architecture is a distributed</span></div>
<div style="position:absolute;left:66.18px;top:583.01px" class="cls_070"><span class="cls_070">2</span></div>
<div style="position:absolute;left:75.18px;top:583.19px" class="cls_071"><span class="cls_071">We’ll focus on microservices written with Java and Spring. But if you’re interested in how to write micro-</span></div>
<div style="position:absolute;left:75.18px;top:592.67px" class="cls_071"><span class="cls_071">services in .NET that work with Spring Cloud Services, have a look at Steeltoe (</span><a href="http://steeltoe.io/">http://steeltoe.io/</a> <span class="cls_071">).</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:229836px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background348.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">326</span></div>
<div style="position:absolute;left:201.12px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 13</span></div>
<div style="position:absolute;left:250.05px;top:24.35px" class="cls_055"><span class="cls_055">Discovering services</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">architecture that brings its own challenges to the table, including network latency. As</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">you make the move to microservice architecture, you should keep this in mind as</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">many remote calls can add up and slow down an application.</span></div>
<div style="position:absolute;left:107.64px;top:89.66px" class="cls_039"><span class="cls_039">You should also consider whether it even makes sense to architect your application</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">in microservices. Not all applications require or benefit from such an architecture. If</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">the application is relatively small or simple, perhaps it’s best to leave it as a monolith</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">… for now. As it grows, you can begin to consider breaking it into microservices.</span></div>
<div style="position:absolute;left:107.63px;top:141.65px" class="cls_039"><span class="cls_039">There’s a lot of thought that goes into developing cloud-native, microservice-archi-</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_039"><span class="cls_039">tected applications. This chapter and the next few chapters will focus primarily on the</span></div>
<div style="position:absolute;left:93.18px;top:167.66px" class="cls_039"><span class="cls_039">technology afforded by Spring Cloud to develop applications that are made up of</span></div>
<div style="position:absolute;left:93.18px;top:180.65px" class="cls_039"><span class="cls_039">microservices. But if you’re interested in digging deeper into the design and thought</span></div>
<div style="position:absolute;left:93.18px;top:193.67px" class="cls_039"><span class="cls_039">process around cloud-native applications, may I suggest that you read </span><span class="cls_036">Cloud Native </span><span class="cls_039">by</span></div>
<div style="position:absolute;left:93.18px;top:206.66px" class="cls_039"><span class="cls_039">Cornelia Davis (Manning, 2019, </span><a href="https://www.manning.com/books/cloud-native">www.manning.com/books/cloud-native</a> <span class="cls_039">).</span></div>
<div style="position:absolute;left:108.63px;top:219.65px" class="cls_039"><span class="cls_039">Another common challenge faced by microservice architecture is how each service</span></div>
<div style="position:absolute;left:93.18px;top:232.67px" class="cls_039"><span class="cls_039">even knows about the other services it coordinates with. That’s precisely the topic of this</span></div>
<div style="position:absolute;left:93.18px;top:245.66px" class="cls_039"><span class="cls_039">chapter. Without further delay, let’s see how to set up a service registry with Spring Cloud.</span></div>
<div style="position:absolute;left:57.18px;top:266.83px" class="cls_040"><span class="cls_040">13.2</span></div>
<div style="position:absolute;left:93.18px;top:266.83px" class="cls_040"><span class="cls_040">Setting up a service registry</span></div>
<div style="position:absolute;left:93.18px;top:284.66px" class="cls_039"><span class="cls_039">Spring Cloud is a rather large umbrella project, made up of several separate sub-</span></div>
<div style="position:absolute;left:93.18px;top:297.68px" class="cls_039"><span class="cls_039">projects that each enables microservice development in some way. One of those</span></div>
<div style="position:absolute;left:93.18px;top:310.67px" class="cls_039"><span class="cls_039">subprojects is Spring Cloud Netflix, which offers several components from the Net-</span></div>
<div style="position:absolute;left:93.18px;top:323.66px" class="cls_039"><span class="cls_039">flix open source portfolio with a Spring twist. Among those components is Eureka,</span></div>
<div style="position:absolute;left:93.18px;top:336.68px" class="cls_039"><span class="cls_039">the Netflix service registry.</span></div>
<div style="position:absolute;left:93.18px;top:356.84px" class="cls_064"><span class="cls_064">T</span><span class="cls_065">HE</span><span class="cls_064"> </span><span class="cls_065">NAKED</span><span class="cls_064"> </span><span class="cls_065">TRUTH</span><span class="cls_064"> </span><span class="cls_065">CONCERNING</span><span class="cls_064"> E</span><span class="cls_065">UREKA</span></div>
<div style="position:absolute;left:93.18px;top:370.16px" class="cls_039"><span class="cls_039">The word </span><span class="cls_036">Eureka</span><span class="cls_039"> is an exclamation of joy when one finds or discovers something. This</span></div>
<div style="position:absolute;left:93.18px;top:383.18px" class="cls_039"><span class="cls_039">makes it a fitting name for the service registries that will be used by microservices to</span></div>
<div style="position:absolute;left:93.18px;top:396.17px" class="cls_039"><span class="cls_039">discover each other.</span></div>
<div style="position:absolute;left:107.98px;top:409.16px" class="cls_039"><span class="cls_039">Legend says that Eureka was first uttered by Greek physicist Archimedes when, on</span></div>
<div style="position:absolute;left:93.18px;top:422.18px" class="cls_039"><span class="cls_039">discovering the principal of buoyant force while sitting in a bath, he leapt out of the</span></div>
<div style="position:absolute;left:93.18px;top:435.17px" class="cls_039"><span class="cls_039">bath and ran home naked shouting “Eureka!”</span></div>
<div style="position:absolute;left:108.94px;top:448.16px" class="cls_039"><span class="cls_039">There’s some debate whether or not Archimedes actually ran home in the buff</span></div>
<div style="position:absolute;left:93.18px;top:461.18px" class="cls_039"><span class="cls_039">shouting “Eureka!” But the story is amusing, nonetheless. Regardless, we’re able to</span></div>
<div style="position:absolute;left:93.18px;top:474.17px" class="cls_039"><span class="cls_039">work with the Eureka service registry fully-clothed.</span></div>
<div style="position:absolute;left:109.90px;top:487.16px" class="cls_039"><span class="cls_039">Eureka acts as a central registry for all services in a microservice application.</span></div>
<div style="position:absolute;left:93.18px;top:500.18px" class="cls_039"><span class="cls_039">Eureka itself can be thought of as a microservice—one whose purpose in the greater</span></div>
<div style="position:absolute;left:93.18px;top:513.17px" class="cls_039"><span class="cls_039">application is to help the other services discover each other.</span></div>
<div style="position:absolute;left:109.43px;top:526.16px" class="cls_039"><span class="cls_039">Because of its role in a microservice application, it’s probably best to set up a</span></div>
<div style="position:absolute;left:93.18px;top:539.18px" class="cls_039"><span class="cls_039">Eureka service registry before creating any of the services that register with it. To</span></div>
<div style="position:absolute;left:93.18px;top:552.17px" class="cls_039"><span class="cls_039">understand how Eureka works, consider the flow as described in figure 13.1.</span></div>
<div style="position:absolute;left:107.67px;top:565.19px" class="cls_039"><span class="cls_039">When a service instance starts, it’ll register itself by name with Eureka. In figure 13.1,</span></div>
<div style="position:absolute;left:93.18px;top:578.18px" class="cls_039"><span class="cls_039">the service name is some-service. There may be multiple equivalent instances of some-</span></div>
<div style="position:absolute;left:93.18px;top:591.17px" class="cls_039"><span class="cls_039">service, but all of them register with Eureka with the same name.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:230512px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background349.jpg" width="531" height="666"></div>
<div style="position:absolute;left:221.37px;top:24.35px" class="cls_055"><span class="cls_055">Setting up a service registry</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">327</span></div>
<div style="position:absolute;left:241.50px;top:92.67px" class="cls_057"><span class="cls_057">Spring Cloud</span></div>
<div style="position:absolute;left:239.95px;top:102.17px" class="cls_057"><span class="cls_057">Netflix Eureka</span></div>
<div style="position:absolute;left:224.82px;top:197.25px" class="cls_057"><span class="cls_057">Select an instance and...</span></div>
<div style="position:absolute;left:123.77px;top:203.29px" class="cls_057"><span class="cls_057">“some-service”</span></div>
<div style="position:absolute;left:366.25px;top:203.29px" class="cls_057"><span class="cls_057">“other-service”</span></div>
<div style="position:absolute;left:203.55px;top:210.25px" class="cls_057"><span class="cls_057">consume endpoints on “some-service”</span></div>
<div style="position:absolute;left:102.18px;top:234.35px" class="cls_053"><span class="cls_053">Figure 13.1</span></div>
<div style="position:absolute;left:150.95px;top:234.35px" class="cls_053"><span class="cls_053">Services register with the Eureka service registry so that other services can</span></div>
<div style="position:absolute;left:102.18px;top:244.34px" class="cls_053"><span class="cls_053">discover and consume them.</span></div>
<div style="position:absolute;left:102.18px;top:278.69px" class="cls_039"><span class="cls_039">At some point, another service (named other-service in figure 13.1) needs to consume</span></div>
<div style="position:absolute;left:102.18px;top:291.71px" class="cls_039"><span class="cls_039">endpoints on some-service. Rather than hard coding other-service with specific host</span></div>
<div style="position:absolute;left:102.18px;top:304.70px" class="cls_039"><span class="cls_039">and port information for some-service, other-service only knows to look up some-service</span></div>
<div style="position:absolute;left:102.18px;top:317.69px" class="cls_039"><span class="cls_039">from Eureka by its name. Eureka replies with information for all instances of some-</span></div>
<div style="position:absolute;left:102.18px;top:330.71px" class="cls_039"><span class="cls_039">service that it knows about.</span></div>
<div style="position:absolute;left:116.90px;top:343.70px" class="cls_039"><span class="cls_039">Now other-service needs to make a decision. Which instance of some-service will it</span></div>
<div style="position:absolute;left:102.18px;top:356.69px" class="cls_039"><span class="cls_039">use? If they’re all equivalent, then it doesn’t matter much. But to avoid any given</span></div>
<div style="position:absolute;left:102.18px;top:369.71px" class="cls_039"><span class="cls_039">instance being chosen every time, it’s best to apply some client-side, load-balancing</span></div>
<div style="position:absolute;left:102.18px;top:382.70px" class="cls_039"><span class="cls_039">algorithm to spread the requests around. That’s where another Netflix project—Rib-</span></div>
<div style="position:absolute;left:102.18px;top:395.69px" class="cls_039"><span class="cls_039">bon—comes into play.</span></div>
<div style="position:absolute;left:116.85px;top:408.71px" class="cls_039"><span class="cls_039">Although other-service could be solely responsible for both looking up and choos-</span></div>
<div style="position:absolute;left:102.18px;top:421.70px" class="cls_039"><span class="cls_039">ing an instance of some-service, it relies on Ribbon instead. Ribbon is a client-side</span></div>
<div style="position:absolute;left:102.18px;top:434.69px" class="cls_039"><span class="cls_039">load balancer that makes the choice on behalf of other-service. Once Ribbon has</span></div>
<div style="position:absolute;left:102.18px;top:447.71px" class="cls_039"><span class="cls_039">made its choice, all that’s left is for other-service to make requests to the instance that</span></div>
<div style="position:absolute;left:102.18px;top:460.70px" class="cls_039"><span class="cls_039">Ribbon chooses.</span></div>
<div style="position:absolute;left:102.18px;top:480.89px" class="cls_064"><span class="cls_064">W</span><span class="cls_065">HY</span><span class="cls_064"> </span><span class="cls_065">A</span><span class="cls_064"> </span><span class="cls_065">CLIENT</span><span class="cls_064">-</span><span class="cls_065">SIDE</span><span class="cls_064"> </span><span class="cls_065">LOAD</span><span class="cls_064"> </span><span class="cls_065">BALANCER</span><span class="cls_064">?</span></div>
<div style="position:absolute;left:102.18px;top:494.21px" class="cls_039"><span class="cls_039">Often, load balancers are thought of as a single centralized service that handles all</span></div>
<div style="position:absolute;left:102.18px;top:507.20px" class="cls_039"><span class="cls_039">requests and distributes them across many instances of the intended target. In contrast,</span></div>
<div style="position:absolute;left:102.18px;top:520.22px" class="cls_039"><span class="cls_039">Ribbon is a client-side load balancer that’s local to each client making the requests.</span></div>
<div style="position:absolute;left:117.31px;top:533.21px" class="cls_039"><span class="cls_039">As a client-side load balancer, Ribbon has several benefits over a centralized load</span></div>
<div style="position:absolute;left:102.18px;top:546.20px" class="cls_039"><span class="cls_039">balancer. Because there’s one load balancer local to each client, the load balancer nat-</span></div>
<div style="position:absolute;left:102.18px;top:559.22px" class="cls_039"><span class="cls_039">urally scales proportional to the number of clients. Furthermore, each load balancer</span></div>
<div style="position:absolute;left:102.18px;top:572.21px" class="cls_039"><span class="cls_039">can be configured to employ a load-balancing algorithm best suited for each client,</span></div>
<div style="position:absolute;left:102.18px;top:585.20px" class="cls_039"><span class="cls_039">rather than apply the same configuration for all services.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:231188px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background350.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">328</span></div>
<div style="position:absolute;left:201.12px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 13</span></div>
<div style="position:absolute;left:250.05px;top:24.35px" class="cls_055"><span class="cls_055">Discovering services</span></div>
<div style="position:absolute;left:107.69px;top:50.66px" class="cls_039"><span class="cls_039">If this seems complex, don’t worry. As you’ll soon see, most of this is handled auto-</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">matically and transparently. But before you can register and consume services, you</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">need to enable a Eureka server.</span></div>
<div style="position:absolute;left:108.12px;top:89.66px" class="cls_039"><span class="cls_039">To get started with Spring Cloud and Eureka, you’ll need to create a brand new</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">project for the Eureka server itself. The easiest way to get started is with the Spring</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">Initializr. Name the project whatever you want, although I’m inclined to name it ser-</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">vice-registry. When it comes time to select starter dependencies, there’s only one</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">dependency you’ll need: the one whose checkbox is labeled Eureka Server. After</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_039"><span class="cls_039">creating the new project, Initializr gives you a project whose pom.xml file contains</span></div>
<div style="position:absolute;left:93.18px;top:167.66px" class="cls_039"><span class="cls_039">the following dependency:</span></div>
<div style="position:absolute;left:93.18px;top:189.35px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:199.34px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:209.33px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:93.18px;top:219.35px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:93.18px;top:243.65px" class="cls_039"><span class="cls_039">You’ll also see a property named </span><span class="cls_059">spring-cloud.version</span><span class="cls_039"> and a </span><span class="cls_059">&lt;dependency-</span></div>
<div style="position:absolute;left:93.27px;top:256.67px" class="cls_059"><span class="cls_059">Management&gt;</span><span class="cls_039"> section in the pom.xml file that specifies the Spring Cloud release</span></div>
<div style="position:absolute;left:93.18px;top:269.66px" class="cls_039"><span class="cls_039">train version. When I created my service-registry, it referenced the first service</span></div>
<div style="position:absolute;left:93.18px;top:282.65px" class="cls_039"><span class="cls_039">release (SR1) of the Finchley release train:</span></div>
<div style="position:absolute;left:93.18px;top:304.34px" class="cls_060"><span class="cls_060">&lt;properties&gt;</span></div>
<div style="position:absolute;left:102.78px;top:324.35px" class="cls_060"><span class="cls_060">&lt;spring-cloud.version&gt;Finchley.SR1&lt;/spring-cloud.version&gt;</span></div>
<div style="position:absolute;left:93.18px;top:334.34px" class="cls_060"><span class="cls_060">&lt;/properties&gt;</span></div>
<div style="position:absolute;left:93.18px;top:374.33px" class="cls_060"><span class="cls_060">&lt;dependencyManagement&gt;</span></div>
<div style="position:absolute;left:102.78px;top:384.35px" class="cls_060"><span class="cls_060">&lt;dependencies&gt;</span></div>
<div style="position:absolute;left:112.38px;top:394.34px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:121.95px;top:404.36px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:121.95px;top:414.35px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:121.95px;top:424.34px" class="cls_060"><span class="cls_060">&lt;version&gt;${spring-cloud.version}&lt;/version&gt;</span></div>
<div style="position:absolute;left:121.95px;top:434.36px" class="cls_060"><span class="cls_060">&lt;type&gt;pom&lt;/type&gt;</span></div>
<div style="position:absolute;left:121.95px;top:444.35px" class="cls_060"><span class="cls_060">&lt;scope&gt;import&lt;/scope&gt;</span></div>
<div style="position:absolute;left:112.38px;top:454.34px" class="cls_060"><span class="cls_060">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:464.36px" class="cls_060"><span class="cls_060">&lt;/dependencies&gt;</span></div>
<div style="position:absolute;left:93.18px;top:474.35px" class="cls_061"><span class="cls_061">&lt;/dependencyManagement&gt;</span></div>
<div style="position:absolute;left:93.18px;top:498.68px" class="cls_039"><span class="cls_039">If you’d like to use a different version of Spring Cloud, you only need to change the</span></div>
<div style="position:absolute;left:93.18px;top:511.67px" class="cls_059"><span class="cls_059">spring-cloud.version</span><span class="cls_039"> property to the desired version.</span></div>
<div style="position:absolute;left:107.82px;top:524.66px" class="cls_039"><span class="cls_039">With the Eureka starter dependency in the build, there’s only one other thing you</span></div>
<div style="position:absolute;left:93.18px;top:537.68px" class="cls_039"><span class="cls_039">must do to enable the Eureka server. Open the application’s main bootstrap class and</span></div>
<div style="position:absolute;left:93.18px;top:550.67px" class="cls_039"><span class="cls_039">annotate it with </span><span class="cls_059">@EnableEurekaServer</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:570.35px" class="cls_060"><span class="cls_060">@SpringBootApplication</span></div>
<div style="position:absolute;left:93.18px;top:580.34px" class="cls_060"><span class="cls_060">@EnableEurekaServer</span></div>
<div style="position:absolute;left:93.18px;top:590.36px" class="cls_060"><span class="cls_060">public class ServiceRegistryApplication {</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:231864px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background351.jpg" width="531" height="666"></div>
<div style="position:absolute;left:221.37px;top:24.35px" class="cls_055"><span class="cls_055">Setting up a service registry</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">329</span></div>
<div style="position:absolute;left:111.78px;top:51.32px" class="cls_060"><span class="cls_060">public static void main(String[] args) {</span></div>
<div style="position:absolute;left:121.38px;top:61.34px" class="cls_060"><span class="cls_060">SpringApplication.run(ServiceRegistryApplication.class, args);</span></div>
<div style="position:absolute;left:111.78px;top:71.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:91.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">And that’s it! If you start the application, you’ll have a Eureka service registry running</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">and listening on port 8080. If you point your web browser to </span><a href="http://localhost:8080/">http://localhost:8080</a> <span class="cls_039">,</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">you’ll see the web interface shown in figure 13.2.</span></div>
<div style="position:absolute;left:116.85px;top:154.67px" class="cls_039"><span class="cls_039">The Eureka dashboard is informative, telling you (among other things) what service</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">instances are registered with Eureka. You’ll find yourself viewing this UI frequently as</span></div>
<div style="position:absolute;left:66.18px;top:590.48px" class="cls_053"><span class="cls_053">Figure 13.2</span></div>
<div style="position:absolute;left:115.60px;top:590.48px" class="cls_053"><span class="cls_053">The Eureka web dashboard</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:232540px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background352.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">330</span></div>
<div style="position:absolute;left:201.12px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 13</span></div>
<div style="position:absolute;left:250.05px;top:24.35px" class="cls_055"><span class="cls_055">Discovering services</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">you register services to ensure that they’re registered as expected. At this point, no</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">services are registered, thus the message No Instances Available.</span></div>
<div style="position:absolute;left:108.22px;top:76.67px" class="cls_039"><span class="cls_039">Eureka also exposes a REST API, through which services register themselves and</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">discover other services. You likely won’t use the REST API directly, but you might find</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">the /eureka/apps endpoint interesting. It lists in detail all of the service instances in</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">the registry. At this point, with no service instances registered, the response you’ll</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">get follows. We’ll revisit this endpoint a little later in the chapter as you start register-</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">ing services:</span></div>
<div style="position:absolute;left:93.18px;top:163.34px" class="cls_060"><span class="cls_060">&lt;applications&gt;</span></div>
<div style="position:absolute;left:102.78px;top:173.33px" class="cls_060"><span class="cls_060">&lt;versions__delta&gt;1&lt;/versions__delta&gt;</span></div>
<div style="position:absolute;left:102.78px;top:183.35px" class="cls_060"><span class="cls_060">&lt;apps__hashcode&gt;&lt;/apps__hashcode&gt;</span></div>
<div style="position:absolute;left:93.18px;top:193.34px" class="cls_061"><span class="cls_061">&lt;/applications&gt;</span></div>
<div style="position:absolute;left:93.18px;top:217.67px" class="cls_039"><span class="cls_039">You may have noticed that Eureka logs several exceptions in its log every 30 s or so.</span></div>
<div style="position:absolute;left:93.18px;top:230.66px" class="cls_039"><span class="cls_039">Don’t worry! Eureka is running and will work as expected. But those exceptions are</span></div>
<div style="position:absolute;left:93.18px;top:243.65px" class="cls_039"><span class="cls_039">indicative of the fact that you’ve not fully configured the service registry yet. Let’s add</span></div>
<div style="position:absolute;left:93.18px;top:256.67px" class="cls_039"><span class="cls_039">a few configuration properties to make those exceptions disappear.</span></div>
<div style="position:absolute;left:57.18px;top:282.50px" class="cls_063"><span class="cls_063">13.2.1</span></div>
<div style="position:absolute;left:93.18px;top:282.50px" class="cls_063"><span class="cls_063">Configuring Eureka</span></div>
<div style="position:absolute;left:93.18px;top:300.17px" class="cls_039"><span class="cls_039">Eureka doesn’t like working alone. Eureka believes in the concept of safety in num-</span></div>
<div style="position:absolute;left:93.18px;top:313.16px" class="cls_039"><span class="cls_039">bers and wants to be part of a cluster of Eureka servers. If there’s more than one</span></div>
<div style="position:absolute;left:93.18px;top:326.18px" class="cls_039"><span class="cls_039">Eureka server, then there’s no single point of failure should one of those servers run</span></div>
<div style="position:absolute;left:93.18px;top:339.17px" class="cls_039"><span class="cls_039">into trouble. Therefore, Eureka’s default behavior is to attempt to make friends with</span></div>
<div style="position:absolute;left:93.18px;top:352.16px" class="cls_039"><span class="cls_039">other Eureka servers. It’ll try to fetch the service registry from other Eureka servers</span></div>
<div style="position:absolute;left:93.18px;top:365.18px" class="cls_039"><span class="cls_039">and even register itself as a service with other Eureka servers.</span></div>
<div style="position:absolute;left:107.73px;top:378.17px" class="cls_039"><span class="cls_039">High availability of Eureka is desirable in a production setting. For development,</span></div>
<div style="position:absolute;left:93.18px;top:391.16px" class="cls_039"><span class="cls_039">however, it’s inconvenient and unnecessary to fire up more than one Eureka server.</span></div>
<div style="position:absolute;left:93.18px;top:404.18px" class="cls_039"><span class="cls_039">A single, lonely Eureka server is sufficient for development purposes. But unless you</span></div>
<div style="position:absolute;left:93.18px;top:417.17px" class="cls_039"><span class="cls_039">configure the Eureka server properly, it’ll whine about its loneliness incessantly,</span></div>
<div style="position:absolute;left:93.18px;top:430.16px" class="cls_039"><span class="cls_039">every 30 s, in the form of exceptions in the log file. That’s because every 30 s, Eureka</span></div>
<div style="position:absolute;left:93.18px;top:443.18px" class="cls_039"><span class="cls_039">is trying to get in touch with another Eureka server to register itself and to share reg-</span></div>
<div style="position:absolute;left:93.18px;top:456.17px" class="cls_039"><span class="cls_039">istry information.</span></div>
<div style="position:absolute;left:107.84px;top:469.16px" class="cls_039"><span class="cls_039">What you need to do is configure Eureka to accept a solitary existence. To do this,</span></div>
<div style="position:absolute;left:93.18px;top:482.18px" class="cls_039"><span class="cls_039">you’ll need to set a handful of configuration properties as shown in the following snip-</span></div>
<div style="position:absolute;left:93.18px;top:495.17px" class="cls_039"><span class="cls_039">pet from application.yml:</span></div>
<div style="position:absolute;left:93.18px;top:516.86px" class="cls_060"><span class="cls_060">eureka:</span></div>
<div style="position:absolute;left:102.78px;top:526.85px" class="cls_060"><span class="cls_060">instance:</span></div>
<div style="position:absolute;left:112.38px;top:536.84px" class="cls_060"><span class="cls_060">hostname: localhost</span></div>
<div style="position:absolute;left:102.78px;top:546.86px" class="cls_060"><span class="cls_060">client:</span></div>
<div style="position:absolute;left:112.38px;top:556.85px" class="cls_060"><span class="cls_060">fetch-registry: false</span></div>
<div style="position:absolute;left:112.38px;top:566.84px" class="cls_060"><span class="cls_060">register-with-eureka: false</span></div>
<div style="position:absolute;left:112.38px;top:576.86px" class="cls_060"><span class="cls_060">service-url:</span></div>
<div style="position:absolute;left:121.95px;top:586.85px" class="cls_061"><span class="cls_061">defaultZone: </span><a href="http://%24%7Beureka.instance.hostname%7D:${server.port}/eureka/">http://${eureka.instance.hostname}:${server.port}/eureka</a> </div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:233216px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background353.jpg" width="531" height="666"></div>
<div style="position:absolute;left:221.37px;top:24.35px" class="cls_055"><span class="cls_055">Setting up a service registry</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">331</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">First, you set the </span><span class="cls_059">eureka.instance.hostname</span><span class="cls_039"> property to </span><span class="cls_059">localhost</span><span class="cls_039">. This tells Eureka</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">what host it’s running on. It’s optional, but if you don’t specify it, then Eureka</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">attempts to determine its host from environment variables. Explicitly setting this prop-</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">erty gives you more certainty of what its value will be.</span></div>
<div style="position:absolute;left:119.04px;top:102.65px" class="cls_039"><span class="cls_039">The next two properties, </span><span class="cls_059">eureka.client.fetch-registry</span><span class="cls_039"> and </span><span class="cls_059">eureka.client</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_059"><span class="cls_059">.register-with-eureka</span><span class="cls_039">, are properties that you might set on another microservice</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">to tell them how they should interact with Eureka. But recall that Eureka is also a</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">microservice, so these properties can be used with a Eureka server to tell it how it</span></div>
<div style="position:absolute;left:102.18px;top:154.67px" class="cls_039"><span class="cls_039">should interact with other Eureka servers.</span></div>
<div style="position:absolute;left:118.65px;top:167.66px" class="cls_039"><span class="cls_039">The default value for both of these properties is </span><span class="cls_059">true</span><span class="cls_039">, indicating that Eureka</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">should fetch the registry from other Eureka instances, and it should register itself as a</span></div>
<div style="position:absolute;left:102.18px;top:193.67px" class="cls_039"><span class="cls_039">service with the other Eureka servers. Because there aren’t other Eureka servers when</span></div>
<div style="position:absolute;left:102.18px;top:206.66px" class="cls_039"><span class="cls_039">in development mode, you’re setting them to </span><span class="cls_059">false</span><span class="cls_039"> so that Eureka won’t try to reach</span></div>
<div style="position:absolute;left:102.18px;top:219.65px" class="cls_039"><span class="cls_039">out to other Eureka servers.</span></div>
<div style="position:absolute;left:117.05px;top:232.67px" class="cls_039"><span class="cls_039">Finally, you set the </span><span class="cls_059">eureka.client.service-url</span><span class="cls_039"> property. This property contains</span></div>
<div style="position:absolute;left:102.18px;top:245.66px" class="cls_039"><span class="cls_039">a map of zone names to one or more URLs of Eureka servers in that zone. The map</span></div>
<div style="position:absolute;left:102.18px;top:258.65px" class="cls_039"><span class="cls_039">key of </span><span class="cls_059">defaultZone</span><span class="cls_039"> is a special zone name, which is the zone that should be used if</span></div>
<div style="position:absolute;left:102.18px;top:271.67px" class="cls_039"><span class="cls_039">the client (in this case, Eureka itself) hasn’t specified a desired zone. Because this is</span></div>
<div style="position:absolute;left:102.18px;top:284.66px" class="cls_039"><span class="cls_039">the only Eureka instance, the URL mapped to the default zone is for the Eureka</span></div>
<div style="position:absolute;left:102.18px;top:297.68px" class="cls_039"><span class="cls_039">server itself, using placeholder variables populated from other properties.</span></div>
<div style="position:absolute;left:102.18px;top:317.84px" class="cls_064"><span class="cls_064">S</span><span class="cls_065">PECIFYING</span><span class="cls_064"> E</span><span class="cls_065">UREKA</span><span class="cls_064">’</span><span class="cls_065">S</span><span class="cls_064"> </span><span class="cls_065">SERVER</span><span class="cls_064"> </span><span class="cls_065">PORT</span></div>
<div style="position:absolute;left:102.18px;top:331.16px" class="cls_039"><span class="cls_039">Although it’s optional, you’ll probably want to override the default server port.</span></div>
<div style="position:absolute;left:102.18px;top:344.18px" class="cls_039"><span class="cls_039">Whereas Eureka is perfectly happy to listen on port 8080, you’ll run several applica-</span></div>
<div style="position:absolute;left:102.18px;top:357.17px" class="cls_039"><span class="cls_039">tions (microservices) simultaneously on the local machine as you develop the code,</span></div>
<div style="position:absolute;left:102.18px;top:370.16px" class="cls_039"><span class="cls_039">and the applications can’t all listen on port 8080. Therefore, it’s generally a good idea</span></div>
<div style="position:absolute;left:102.18px;top:383.18px" class="cls_039"><span class="cls_039">to set the </span><span class="cls_059">server.port</span><span class="cls_039"> property for local development purposes:</span></div>
<div style="position:absolute;left:102.18px;top:404.84px" class="cls_060"><span class="cls_060">server:</span></div>
<div style="position:absolute;left:111.78px;top:414.86px" class="cls_061"><span class="cls_061">port: 8761</span></div>
<div style="position:absolute;left:102.18px;top:439.16px" class="cls_039"><span class="cls_039">Here you’re setting it to port 8761, which is the default port that the Eureka client</span></div>
<div style="position:absolute;left:102.18px;top:452.18px" class="cls_039"><span class="cls_039">(which we’ll discuss in section 13.3) listens on.</span></div>
<div style="position:absolute;left:102.18px;top:472.34px" class="cls_064"><span class="cls_064">D</span><span class="cls_065">ISABLING</span><span class="cls_064"> </span><span class="cls_065">SELF</span><span class="cls_064">-</span><span class="cls_065">PERSERVATION</span><span class="cls_064"> </span><span class="cls_065">MODE</span></div>
<div style="position:absolute;left:102.18px;top:485.66px" class="cls_039"><span class="cls_039">One other property that you may consider setting is </span><span class="cls_059">eureka.server.enable-self-</span></div>
<div style="position:absolute;left:102.18px;top:498.68px" class="cls_059"><span class="cls_059">preservation</span><span class="cls_039">. If you ever start the Eureka server and let it sit idle for more than a</span></div>
<div style="position:absolute;left:102.18px;top:511.67px" class="cls_039"><span class="cls_039">minute or so, you may see a scary message in the Eureka UI that looks like figure 13.3.</span></div>
<div style="position:absolute;left:116.77px;top:524.66px" class="cls_039"><span class="cls_039">In spite of the red lettering and all uppercase text, this message isn’t nearly as seri-</span></div>
<div style="position:absolute;left:102.18px;top:537.68px" class="cls_039"><span class="cls_039">ous as it sounds. Eureka expects service instances to register themselves and to continue</span></div>
<div style="position:absolute;left:102.18px;top:550.67px" class="cls_039"><span class="cls_039">to send registration renewal requests every 30 s. Normally, if Eureka doesn’t receive a</span></div>
<div style="position:absolute;left:102.18px;top:563.69px" class="cls_039"><span class="cls_039">renewal from a service for three renewal periods (or 90 s), it deregisters that instance. In</span></div>
<div style="position:absolute;left:102.18px;top:576.68px" class="cls_039"><span class="cls_039">this case, Eureka assumes there’s a network problem, enters self-preservation mode, and</span></div>
<div style="position:absolute;left:102.18px;top:589.67px" class="cls_039"><span class="cls_039">won’t deregister service instances.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:233892px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background354.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">332</span></div>
<div style="position:absolute;left:201.12px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 13</span></div>
<div style="position:absolute;left:250.05px;top:24.35px" class="cls_055"><span class="cls_055">Discovering services</span></div>
<div style="position:absolute;left:57.18px;top:222.35px" class="cls_053"><span class="cls_053">Figure 13.3</span></div>
<div style="position:absolute;left:106.31px;top:222.35px" class="cls_053"><span class="cls_053">When in self-preservation mode, Eureka displays this message in its dashboard.</span></div>
<div style="position:absolute;left:93.18px;top:254.90px" class="cls_039"><span class="cls_039">Self-preservation mode is actually a good thing in a production setting, preventing the</span></div>
<div style="position:absolute;left:93.18px;top:267.89px" class="cls_039"><span class="cls_039">deregistration of active services when some network hiccup has stopped the renewal</span></div>
<div style="position:absolute;left:93.18px;top:280.88px" class="cls_039"><span class="cls_039">request from making its way to Eureka. But it can be quite alarming when you’re first</span></div>
<div style="position:absolute;left:93.18px;top:293.90px" class="cls_039"><span class="cls_039">starting up and haven’t registered any services yet. You can disable self-preservation</span></div>
<div style="position:absolute;left:93.18px;top:306.89px" class="cls_039"><span class="cls_039">mode by setting the </span><span class="cls_059">eureka.server.enable-self-preservation</span><span class="cls_039"> property to </span><span class="cls_059">false</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:328.58px" class="cls_060"><span class="cls_060">eureka:</span></div>
<div style="position:absolute;left:102.78px;top:348.56px" class="cls_060"><span class="cls_060">server:</span></div>
<div style="position:absolute;left:112.36px;top:358.58px" class="cls_061"><span class="cls_061">enable-self-preservation: false</span></div>
<div style="position:absolute;left:93.18px;top:381.89px" class="cls_039"><span class="cls_039">This property is useful in a development environment where it’s likely that for a num-</span></div>
<div style="position:absolute;left:93.18px;top:394.91px" class="cls_039"><span class="cls_039">ber of reasons, Eureka may not receive renewal requests. In those cases where you may</span></div>
<div style="position:absolute;left:93.18px;top:407.90px" class="cls_039"><span class="cls_039">be bringing service instances up and down frequently, self-preservation mode results</span></div>
<div style="position:absolute;left:93.18px;top:420.89px" class="cls_039"><span class="cls_039">in registry entries for stopped services being retained, creating problems when another</span></div>
<div style="position:absolute;left:93.18px;top:433.91px" class="cls_039"><span class="cls_039">service tries to consume the service that’s long gone. Disabling self-preservation mode</span></div>
<div style="position:absolute;left:93.18px;top:446.90px" class="cls_039"><span class="cls_039">will prevent strange behavior like that. The tradeoff, however, is that you’ve traded</span></div>
<div style="position:absolute;left:93.18px;top:459.89px" class="cls_039"><span class="cls_039">one scary red-letter message for another (figure 13.4).</span></div>
<div style="position:absolute;left:94.68px;top:519.59px" class="cls_053"><span class="cls_053">Figure 13.4</span></div>
<div style="position:absolute;left:143.88px;top:519.59px" class="cls_053"><span class="cls_053">When self-preservation mode is disabled, you’ll get a different message reminding</span></div>
<div style="position:absolute;left:94.68px;top:529.58px" class="cls_053"><span class="cls_053">you that self-preservation mode is disabled.</span></div>
<div style="position:absolute;left:93.18px;top:562.01px" class="cls_039"><span class="cls_039">Even if you decide to disable self-preservation mode for development, you should leave</span></div>
<div style="position:absolute;left:93.18px;top:575.03px" class="cls_039"><span class="cls_039">it enabled when you go into production.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:234568px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background355.jpg" width="531" height="666"></div>
<div style="position:absolute;left:221.37px;top:24.35px" class="cls_055"><span class="cls_055">Setting up a service registry</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">333</span></div>
<div style="position:absolute;left:66.18px;top:50.48px" class="cls_063"><span class="cls_063">13.2.2</span></div>
<div style="position:absolute;left:102.18px;top:50.48px" class="cls_063"><span class="cls_063">Scaling Eureka</span></div>
<div style="position:absolute;left:102.18px;top:67.67px" class="cls_039"><span class="cls_039">Even though a single Eureka instance is more convenient in development, you’ll proba-</span></div>
<div style="position:absolute;left:102.18px;top:80.66px" class="cls_039"><span class="cls_039">bly want to have at least two Eureka instances for high-availability purposes when you</span></div>
<div style="position:absolute;left:102.18px;top:93.65px" class="cls_039"><span class="cls_039">take the application to production.</span></div>
<div style="position:absolute;left:102.18px;top:111.83px" class="cls_064"><span class="cls_064">P</span><span class="cls_065">RODUCTION</span><span class="cls_064">-</span><span class="cls_065">READY</span><span class="cls_064"> S</span><span class="cls_065">PRING</span><span class="cls_064"> C</span><span class="cls_065">LOUD</span><span class="cls_064"> S</span><span class="cls_065">ERVICES</span></div>
<div style="position:absolute;left:102.18px;top:124.16px" class="cls_039"><span class="cls_039">There’s a lot to consider when deploying microservices into a production environ-</span></div>
<div style="position:absolute;left:102.18px;top:137.15px" class="cls_039"><span class="cls_039">ment. High availability and security of the Eureka server are a few of the concerns that</span></div>
<div style="position:absolute;left:102.18px;top:150.17px" class="cls_039"><span class="cls_039">aren’t as important at development time, but are critical in production. If you’re a Piv-</span></div>
<div style="position:absolute;left:102.18px;top:163.16px" class="cls_039"><span class="cls_039">otal Cloud Foundry or Pivotal Web Services customer, then you can let someone else</span></div>
<div style="position:absolute;left:102.18px;top:176.15px" class="cls_039"><span class="cls_039">worry about those things.</span></div>
<div style="position:absolute;left:117.93px;top:189.17px" class="cls_039"><span class="cls_039">Spring Cloud Services offers a production-ready implementation of Eureka, as</span></div>
<div style="position:absolute;left:102.18px;top:202.16px" class="cls_039"><span class="cls_039">well as a configuration server and a circuit breaker dashboard. All you need to do is</span></div>
<div style="position:absolute;left:102.18px;top:215.15px" class="cls_039"><span class="cls_039">provision a p-service-registry service from the marketplace and then bind your</span></div>
<div style="position:absolute;left:102.18px;top:228.17px" class="cls_039"><span class="cls_039">microservices to that service. For the configuration server and the circuit breaker</span></div>
<div style="position:absolute;left:102.18px;top:241.16px" class="cls_039"><span class="cls_039">dashboard (which we’ll discuss in the next couple of chapters), the marketplace</span></div>
<div style="position:absolute;left:102.18px;top:254.15px" class="cls_039"><span class="cls_039">names are p-config-server and p-circuit-breaker-dashboard.</span></div>
<div style="position:absolute;left:116.73px;top:267.17px" class="cls_039"><span class="cls_039">The easiest, most straightforward way to configure two (or more) Eureka instances</span></div>
<div style="position:absolute;left:102.18px;top:280.16px" class="cls_039"><span class="cls_039">is to use Spring profiles in the application.yml file and then start the Eureka server</span></div>
<div style="position:absolute;left:102.18px;top:293.18px" class="cls_039"><span class="cls_039">twice, once for each profile. For example, the configuration in the next listing shows</span></div>
<div style="position:absolute;left:102.18px;top:306.17px" class="cls_039"><span class="cls_039">how you might configure two Eureka servers that act as peers to each other.</span></div>
<div style="position:absolute;left:114.18px;top:329.90px" class="cls_066"><span class="cls_066">Listing 13.1</span></div>
<div style="position:absolute;left:171.66px;top:329.90px" class="cls_066"><span class="cls_066">Configuring Eureka for two peers using Spring profiles</span></div>
<div style="position:absolute;left:102.18px;top:349.73px" class="cls_060"><span class="cls_060">eureka:</span></div>
<div style="position:absolute;left:111.78px;top:359.75px" class="cls_060"><span class="cls_060">client:</span></div>
<div style="position:absolute;left:121.38px;top:369.74px" class="cls_060"><span class="cls_060">service-url:</span></div>
<div style="position:absolute;left:130.95px;top:379.76px" class="cls_060"><span class="cls_060">defaultZone: </span><a href="http://%24%7Bother.eureka.host%7D:${other.eureka.port}/eureka/">http://${other.eureka.host}:${other.eureka.port}/eureka</a> </div>
<div style="position:absolute;left:102.18px;top:399.74px" class="cls_060"><span class="cls_060">---</span></div>
<div style="position:absolute;left:102.18px;top:409.76px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:111.78px;top:419.75px" class="cls_060"><span class="cls_060">profiles: eureka-1</span></div>
<div style="position:absolute;left:111.78px;top:429.74px" class="cls_060"><span class="cls_060">application:</span></div>
<div style="position:absolute;left:121.38px;top:439.76px" class="cls_060"><span class="cls_060">name: eureka-1</span></div>
<div style="position:absolute;left:102.18px;top:459.74px" class="cls_060"><span class="cls_060">server:</span></div>
<div style="position:absolute;left:111.78px;top:469.76px" class="cls_060"><span class="cls_060">port: 8761</span></div>
<div style="position:absolute;left:102.18px;top:489.74px" class="cls_060"><span class="cls_060">eureka:</span></div>
<div style="position:absolute;left:111.78px;top:499.76px" class="cls_060"><span class="cls_060">instance:</span></div>
<div style="position:absolute;left:121.38px;top:509.75px" class="cls_060"><span class="cls_060">hostname: eureka1.tacocloud.com</span></div>
<div style="position:absolute;left:102.18px;top:529.76px" class="cls_060"><span class="cls_060">other:</span></div>
<div style="position:absolute;left:111.78px;top:539.75px" class="cls_060"><span class="cls_060">eureka:</span></div>
<div style="position:absolute;left:121.38px;top:549.74px" class="cls_060"><span class="cls_060">host: eureka2.tacocloud.com</span></div>
<div style="position:absolute;left:121.38px;top:559.76px" class="cls_060"><span class="cls_060">port: 8761</span></div>
<div style="position:absolute;left:102.18px;top:579.74px" class="cls_060"><span class="cls_060">---</span></div>
<div style="position:absolute;left:102.18px;top:589.76px" class="cls_060"><span class="cls_060">spring:</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:235244px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background356.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">334</span></div>
<div style="position:absolute;left:201.12px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 13</span></div>
<div style="position:absolute;left:250.05px;top:24.35px" class="cls_055"><span class="cls_055">Discovering services</span></div>
<div style="position:absolute;left:102.78px;top:51.32px" class="cls_060"><span class="cls_060">profiles: eureka-2</span></div>
<div style="position:absolute;left:102.78px;top:61.34px" class="cls_060"><span class="cls_060">application:</span></div>
<div style="position:absolute;left:112.38px;top:71.33px" class="cls_060"><span class="cls_060">name: eureka-2</span></div>
<div style="position:absolute;left:93.18px;top:91.34px" class="cls_060"><span class="cls_060">server:</span></div>
<div style="position:absolute;left:102.78px;top:101.33px" class="cls_060"><span class="cls_060">port: 8762</span></div>
<div style="position:absolute;left:93.18px;top:121.34px" class="cls_060"><span class="cls_060">eureka:</span></div>
<div style="position:absolute;left:102.78px;top:131.33px" class="cls_060"><span class="cls_060">instance:</span></div>
<div style="position:absolute;left:112.38px;top:141.35px" class="cls_060"><span class="cls_060">hostname: eureka2.tacocloud.com</span></div>
<div style="position:absolute;left:93.18px;top:161.33px" class="cls_060"><span class="cls_060">other:</span></div>
<div style="position:absolute;left:102.78px;top:171.35px" class="cls_060"><span class="cls_060">eureka:</span></div>
<div style="position:absolute;left:112.38px;top:181.34px" class="cls_060"><span class="cls_060">host: eureka1.tacocloud.com</span></div>
<div style="position:absolute;left:112.38px;top:191.33px" class="cls_061"><span class="cls_061">port: 8762</span></div>
<div style="position:absolute;left:93.18px;top:210.65px" class="cls_039"><span class="cls_039">In the default profile (at the top of listing 13.1), you set </span><span class="cls_059">eureka.client.service-</span></div>
<div style="position:absolute;left:93.18px;top:223.67px" class="cls_059"><span class="cls_059">url.defaultZone</span><span class="cls_039"> to take advantage of placeholder variables that you set in each of</span></div>
<div style="position:absolute;left:93.18px;top:236.66px" class="cls_039"><span class="cls_039">the profile-specific configurations.</span></div>
<div style="position:absolute;left:108.63px;top:249.65px" class="cls_039"><span class="cls_039">After the default profile, you configure two profiles, one named </span><span class="cls_059">eureka-1</span><span class="cls_039"> and the</span></div>
<div style="position:absolute;left:93.18px;top:262.67px" class="cls_039"><span class="cls_039">other named </span><span class="cls_059">eureka-2</span><span class="cls_039">. Each profile specifies its own port and </span><span class="cls_059">eureka.instance</span></div>
<div style="position:absolute;left:93.18px;top:275.66px" class="cls_059"><span class="cls_059">.hostname</span><span class="cls_039"> for its own configuration needs. But then you set </span><span class="cls_059">other.eureka.host</span><span class="cls_039"> and</span></div>
<div style="position:absolute;left:93.18px;top:288.65px" class="cls_059"><span class="cls_059">other.eureka.port</span><span class="cls_039">, two contrived properties, in each profile to reference the other</span></div>
<div style="position:absolute;left:93.18px;top:301.67px" class="cls_039"><span class="cls_039">Eureka instance. There’s nothing about these properties that’s specific to the framework,</span></div>
<div style="position:absolute;left:93.18px;top:314.66px" class="cls_039"><span class="cls_039">but these properties are what get referenced by the placeholders in the default profile.</span></div>
<div style="position:absolute;left:109.05px;top:327.68px" class="cls_039"><span class="cls_039">Notice that you’re not setting </span><span class="cls_059">eureka.client.fetch-registry</span><span class="cls_039"> or </span><span class="cls_059">eureka.client</span></div>
<div style="position:absolute;left:93.18px;top:340.67px" class="cls_059"><span class="cls_059">.register-with-eureka</span><span class="cls_039">. The default value of </span><span class="cls_059">true</span><span class="cls_039"> ensures that each Eureka server</span></div>
<div style="position:absolute;left:93.18px;top:353.66px" class="cls_039"><span class="cls_039">registers itself and fetches registry information from the other Eureka server.</span></div>
<div style="position:absolute;left:109.00px;top:366.68px" class="cls_039"><span class="cls_039">Now you have a Eureka service registry up and running. But at this point, it’s</span></div>
<div style="position:absolute;left:93.18px;top:379.67px" class="cls_039"><span class="cls_039">essentially a phonebook with empty pages that nobody ever looks at. Until services</span></div>
<div style="position:absolute;left:93.18px;top:392.66px" class="cls_039"><span class="cls_039">start registering themselves in the service registry and other services look up those</span></div>
<div style="position:absolute;left:93.18px;top:405.68px" class="cls_039"><span class="cls_039">services and call them, it’s all for naught. Let’s see how to enable some microservices</span></div>
<div style="position:absolute;left:93.18px;top:418.67px" class="cls_039"><span class="cls_039">as Eureka clients.</span></div>
<div style="position:absolute;left:57.18px;top:439.84px" class="cls_040"><span class="cls_040">13.3</span></div>
<div style="position:absolute;left:93.18px;top:439.84px" class="cls_040"><span class="cls_040">Registering and discovering services</span></div>
<div style="position:absolute;left:93.18px;top:457.67px" class="cls_039"><span class="cls_039">A Eureka service registry is useless unless services register themselves. If your services</span></div>
<div style="position:absolute;left:93.18px;top:470.66px" class="cls_039"><span class="cls_039">are going to be discovered and consumed by other services, then you need to enable</span></div>
<div style="position:absolute;left:93.18px;top:483.68px" class="cls_039"><span class="cls_039">them as clients of the service registry. To enable an application (any application, but</span></div>
<div style="position:absolute;left:93.18px;top:496.67px" class="cls_039"><span class="cls_039">presumably a microservice) as a service registry client, the least you must do is add the</span></div>
<div style="position:absolute;left:93.18px;top:509.66px" class="cls_039"><span class="cls_039">Eureka client dependency to the service application’s build:</span></div>
<div style="position:absolute;left:93.18px;top:529.34px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:539.36px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:549.35px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:93.18px;top:559.34px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:93.18px;top:578.69px" class="cls_039"><span class="cls_039">As with the Eureka server starter dependency, you’ll also need the Spring Cloud ver-</span></div>
<div style="position:absolute;left:93.18px;top:591.68px" class="cls_039"><span class="cls_039">sion property set for Spring Cloud’s dependency management:</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:235920px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background357.jpg" width="531" height="666"></div>
<div style="position:absolute;left:206.28px;top:24.35px" class="cls_055"><span class="cls_055">Registering and discovering services</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">335</span></div>
<div style="position:absolute;left:102.18px;top:51.32px" class="cls_060"><span class="cls_060">&lt;properties&gt;</span></div>
<div style="position:absolute;left:111.78px;top:71.33px" class="cls_060"><span class="cls_060">&lt;spring-cloud.version&gt;Finchley.SR1&lt;/spring-cloud.version&gt;</span></div>
<div style="position:absolute;left:102.18px;top:81.32px" class="cls_060"><span class="cls_060">&lt;/properties&gt;</span></div>
<div style="position:absolute;left:102.18px;top:121.34px" class="cls_060"><span class="cls_060">&lt;dependencyManagement&gt;</span></div>
<div style="position:absolute;left:111.78px;top:131.33px" class="cls_060"><span class="cls_060">&lt;dependencies&gt;</span></div>
<div style="position:absolute;left:121.38px;top:141.35px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:130.95px;top:151.34px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:130.95px;top:161.33px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:130.95px;top:171.35px" class="cls_060"><span class="cls_060">&lt;version&gt;${spring-cloud.version}&lt;/version&gt;</span></div>
<div style="position:absolute;left:130.95px;top:181.34px" class="cls_060"><span class="cls_060">&lt;type&gt;pom&lt;/type&gt;</span></div>
<div style="position:absolute;left:130.95px;top:191.33px" class="cls_060"><span class="cls_060">&lt;scope&gt;import&lt;/scope&gt;</span></div>
<div style="position:absolute;left:121.38px;top:201.35px" class="cls_060"><span class="cls_060">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:111.78px;top:211.34px" class="cls_060"><span class="cls_060">&lt;/dependencies&gt;</span></div>
<div style="position:absolute;left:102.18px;top:221.33px" class="cls_061"><span class="cls_061">&lt;/dependencyManagement&gt;</span></div>
<div style="position:absolute;left:102.18px;top:245.66px" class="cls_039"><span class="cls_039">You can add these entries to your service application’s pom.xml file manually, but the</span></div>
<div style="position:absolute;left:102.18px;top:258.65px" class="cls_039"><span class="cls_039">easier way to get them is to select the Eureka Discovery dependency from the Spring</span></div>
<div style="position:absolute;left:102.18px;top:271.67px" class="cls_039"><span class="cls_039">Initializr’s selection of checkboxes.</span></div>
<div style="position:absolute;left:116.59px;top:284.66px" class="cls_039"><span class="cls_039">The Eureka client starter dependency adds all you need for discovering services via</span></div>
<div style="position:absolute;left:102.18px;top:297.65px" class="cls_039"><span class="cls_039">Eureka, including Eureka’s client-side library, as well as the Ribbon load balancer. By</span></div>
<div style="position:absolute;left:102.18px;top:310.67px" class="cls_039"><span class="cls_039">doing nothing more than adding this dependency, you’ll enable your application as a</span></div>
<div style="position:absolute;left:102.18px;top:323.66px" class="cls_039"><span class="cls_039">client of the Eureka service registry. When the application starts, it attempts to contact</span></div>
<div style="position:absolute;left:102.18px;top:336.68px" class="cls_039"><span class="cls_039">a Eureka server running locally and listening on port 8761 to register itself under the</span></div>
<div style="position:absolute;left:102.18px;top:349.67px" class="cls_039"><span class="cls_039">name UNKNOWN.</span></div>
<div style="position:absolute;left:66.18px;top:375.50px" class="cls_063"><span class="cls_063">13.3.1</span></div>
<div style="position:absolute;left:102.18px;top:375.50px" class="cls_063"><span class="cls_063">Configuring Eureka client properties</span></div>
<div style="position:absolute;left:102.18px;top:393.17px" class="cls_039"><span class="cls_039">Although the default location of the Eureka server is fine for development purposes,</span></div>
<div style="position:absolute;left:102.18px;top:406.16px" class="cls_039"><span class="cls_039">you’ll most certainly want to override it once your services are deployed outside of</span></div>
<div style="position:absolute;left:102.18px;top:419.18px" class="cls_039"><span class="cls_039">localhost. What’s more, that default service name of UNKNOWN is a horrible choice</span></div>
<div style="position:absolute;left:102.18px;top:432.17px" class="cls_039"><span class="cls_039">… but truthfully, any default choice would be equally bad, as all services would have</span></div>
<div style="position:absolute;left:102.18px;top:445.16px" class="cls_039"><span class="cls_039">the same name.</span></div>
<div style="position:absolute;left:117.45px;top:458.18px" class="cls_039"><span class="cls_039">Changing the name under which the service is registered in Eureka is as easy as</span></div>
<div style="position:absolute;left:102.18px;top:471.17px" class="cls_039"><span class="cls_039">setting the </span><span class="cls_059">spring.application.name</span><span class="cls_039"> property. For example, if you’re registering a</span></div>
<div style="position:absolute;left:102.18px;top:484.16px" class="cls_039"><span class="cls_039">service that handles all operations that involve dealing with taco ingredients, you</span></div>
<div style="position:absolute;left:102.18px;top:497.18px" class="cls_039"><span class="cls_039">might register it as ingredient-service. In application.yml that would look like this:</span></div>
<div style="position:absolute;left:102.18px;top:518.84px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:111.78px;top:528.86px" class="cls_060"><span class="cls_060">application:</span></div>
<div style="position:absolute;left:121.38px;top:538.85px" class="cls_061"><span class="cls_061">name: ingredient-service</span></div>
<div style="position:absolute;left:102.18px;top:563.18px" class="cls_039"><span class="cls_039">As a result of setting this property, the service can be looked up by the name ingredi-</span></div>
<div style="position:absolute;left:102.18px;top:576.17px" class="cls_039"><span class="cls_039">ent-service. What’s more, if you were to fire up multiple instances of the ingredient</span></div>
<div style="position:absolute;left:102.18px;top:589.19px" class="cls_039"><span class="cls_039">service, they’d all appear under the same name, effectively scaling the service up to</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:236596px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background358.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">336</span></div>
<div style="position:absolute;left:201.12px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 13</span></div>
<div style="position:absolute;left:250.05px;top:24.35px" class="cls_055"><span class="cls_055">Discovering services</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">multiple, presumably equivalent, instances that a consuming service can choose from.</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">When you view the Eureka dashboard, this service appears as shown in figure 13.5.</span></div>
<div style="position:absolute;left:57.18px;top:159.11px" class="cls_053"><span class="cls_053">Figure 13.5</span></div>
<div style="position:absolute;left:106.61px;top:159.11px" class="cls_053"><span class="cls_053">The ingredient service as it appears in Eureka’s dashboard</span></div>
<div style="position:absolute;left:93.18px;top:196.28px" class="cls_039"><span class="cls_039">You’ll find as you continue to work with Spring Cloud that the </span><span class="cls_059">spring.application</span></div>
<div style="position:absolute;left:93.18px;top:209.27px" class="cls_059"><span class="cls_059">.name</span><span class="cls_039"> property is one of the most important properties that you’ll ever set. It deter-</span></div>
<div style="position:absolute;left:93.18px;top:222.29px" class="cls_039"><span class="cls_039">mines the registry name in Eureka. And in the next chapter, you’ll see that it identifies</span></div>
<div style="position:absolute;left:93.18px;top:235.28px" class="cls_039"><span class="cls_039">the application to the configuration service for managing application-specific configu-</span></div>
<div style="position:absolute;left:93.18px;top:248.27px" class="cls_039"><span class="cls_039">rations. Other Spring Cloud projects, such as Spring Cloud Task (ephemeral micro-</span></div>
<div style="position:absolute;left:93.27px;top:261.29px" class="cls_039"><span class="cls_039">services) and Spring Cloud Sleuth (distributed tracing), also rely on the </span><span class="cls_059">spring</span></div>
<div style="position:absolute;left:93.18px;top:274.28px" class="cls_059"><span class="cls_059">.application.name</span><span class="cls_039"> property to identify the service.</span></div>
<div style="position:absolute;left:109.38px;top:287.30px" class="cls_039"><span class="cls_039">As you’ve learned from the first chapter, all Spring MVC and Spring WebFlux</span></div>
<div style="position:absolute;left:93.18px;top:300.29px" class="cls_039"><span class="cls_039">applications are listening on port 8080 by default. Because you’ll only be looking up</span></div>
<div style="position:absolute;left:93.18px;top:313.28px" class="cls_039"><span class="cls_039">services through Eureka, it doesn’t matter what port they’re listening on—Eureka</span></div>
<div style="position:absolute;left:93.18px;top:326.30px" class="cls_039"><span class="cls_039">knows what port they’re on. Therefore, to avoid potential port conflicts when running</span></div>
<div style="position:absolute;left:93.18px;top:339.29px" class="cls_039"><span class="cls_039">locally, you can set the port to 0:</span></div>
<div style="position:absolute;left:93.18px;top:360.95px" class="cls_060"><span class="cls_060">server:</span></div>
<div style="position:absolute;left:102.78px;top:370.97px" class="cls_061"><span class="cls_061">port: 0</span></div>
<div style="position:absolute;left:105.18px;top:395.30px" class="cls_083"><span class="cls_083">NOTE</span><span class="cls_039">: Setting the port to 0 results in the application starting on a randomly</span></div>
<div style="position:absolute;left:105.18px;top:407.30px" class="cls_039"><span class="cls_039">chosen available port.</span></div>
<div style="position:absolute;left:93.18px;top:430.28px" class="cls_039"><span class="cls_039">Now, regarding the location of the Eureka servers. By default, Eureka clients assume</span></div>
<div style="position:absolute;left:93.18px;top:443.30px" class="cls_039"><span class="cls_039">that Eureka is listening on localhost (port 8761). That’s great for development, but in</span></div>
<div style="position:absolute;left:93.18px;top:456.29px" class="cls_039"><span class="cls_039">production that most certainly isn’t the case. Therefore, you’ll need to specify the</span></div>
<div style="position:absolute;left:93.18px;top:469.28px" class="cls_039"><span class="cls_039">location of your Eureka server(s). That’s accomplished the same way you achieved it</span></div>
<div style="position:absolute;left:93.18px;top:482.30px" class="cls_039"><span class="cls_039">for the Eureka server itself, with the </span><span class="cls_059">eureka.client.service-url</span><span class="cls_039"> property:</span></div>
<div style="position:absolute;left:93.18px;top:504.98px" class="cls_060"><span class="cls_060">eureka:</span></div>
<div style="position:absolute;left:97.98px;top:514.97px" class="cls_060"><span class="cls_060">client:</span></div>
<div style="position:absolute;left:107.58px;top:524.96px" class="cls_060"><span class="cls_060">service-url:</span></div>
<div style="position:absolute;left:117.16px;top:534.98px" class="cls_061"><span class="cls_061">defaultZone: </span><a href="http://eureka1.tacocloud.com:8761/eureka/">http://eureka1.tacocloud.com:8761/eureka/</a> </div>
<div style="position:absolute;left:93.18px;top:559.31px" class="cls_039"><span class="cls_039">This configures the client to register with the Eureka server listening on host eure-</span></div>
<div style="position:absolute;left:93.18px;top:572.30px" class="cls_039"><span class="cls_039">ka1.tacocloud.com (port 8761). That’s fine, so long as that Eureka server is in work-</span></div>
<div style="position:absolute;left:93.18px;top:585.29px" class="cls_039"><span class="cls_039">ing order. But if that Eureka server is down for any reason, then the service fails to</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:237272px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background359.jpg" width="531" height="666"></div>
<div style="position:absolute;left:206.28px;top:24.35px" class="cls_055"><span class="cls_055">Registering and discovering services</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">337</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">register. To avoid registration failure, it’s best to configure your service with two or</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">more Eureka servers:</span></div>
<div style="position:absolute;left:102.18px;top:83.33px" class="cls_060"><span class="cls_060">eureka:</span></div>
<div style="position:absolute;left:106.98px;top:93.32px" class="cls_060"><span class="cls_060">client:</span></div>
<div style="position:absolute;left:116.58px;top:103.34px" class="cls_060"><span class="cls_060">service-url:</span></div>
<div style="position:absolute;left:126.13px;top:113.33px" class="cls_060"><span class="cls_060">defaultZone: </span><a href="http://eureka1.tacocloud.com:8761/eureka/">http://eureka1.tacocloud.com:8761/eureka/</a>,</div>
<div style="position:absolute;left:188.53px;top:123.32px" class="cls_061"><span class="cls_061"> </span><a href="http://eureka2.tacocloud.com:8762/eureka/">http://eureka2.tacocloud.com:8762/eureka/</a> </div>
<div style="position:absolute;left:102.18px;top:142.67px" class="cls_039"><span class="cls_039">When the service starts, it attempts to register with the first server in the zone. If that</span></div>
<div style="position:absolute;left:102.18px;top:155.66px" class="cls_039"><span class="cls_039">fails for any reason, then it attempts to register with the next one in the list. Eventu-</span></div>
<div style="position:absolute;left:102.18px;top:168.65px" class="cls_039"><span class="cls_039">ally, when the failing Eureka comes back online, it replicates the registry from its peer,</span></div>
<div style="position:absolute;left:102.18px;top:181.67px" class="cls_039"><span class="cls_039">containing a registry entry for the service.</span></div>
<div style="position:absolute;left:117.87px;top:194.66px" class="cls_039"><span class="cls_039">Registering a service in Eureka is only half of the story. Once services are regis-</span></div>
<div style="position:absolute;left:102.18px;top:207.65px" class="cls_039"><span class="cls_039">tered in Eureka, other services can discover them and start consuming them. Let’s see</span></div>
<div style="position:absolute;left:102.18px;top:220.67px" class="cls_039"><span class="cls_039">how to consume services registered with Eureka.</span></div>
<div style="position:absolute;left:66.18px;top:242.48px" class="cls_063"><span class="cls_063">13.3.2</span></div>
<div style="position:absolute;left:102.18px;top:242.48px" class="cls_063"><span class="cls_063">Consuming services</span></div>
<div style="position:absolute;left:102.18px;top:259.67px" class="cls_039"><span class="cls_039">It would be a mistake to hard code any service instance’s URL in the consumer’s code.</span></div>
<div style="position:absolute;left:102.18px;top:272.66px" class="cls_039"><span class="cls_039">This not only couples the consumer to a specific instance of the service, but also can</span></div>
<div style="position:absolute;left:102.18px;top:285.65px" class="cls_039"><span class="cls_039">cause the consumer to break if the service’s host and/or port were to change.</span></div>
<div style="position:absolute;left:117.37px;top:298.67px" class="cls_039"><span class="cls_039">On the other hand, the consuming application has a lot of responsibility when it</span></div>
<div style="position:absolute;left:102.18px;top:311.66px" class="cls_039"><span class="cls_039">comes to looking up a service in Eureka. Eureka may reply to the lookup with many</span></div>
<div style="position:absolute;left:102.18px;top:324.68px" class="cls_039"><span class="cls_039">instances for the same service. If the consumer asks for ingredient-service and receives</span></div>
<div style="position:absolute;left:102.18px;top:337.67px" class="cls_039"><span class="cls_039">a half-dozen or so service instances in return, how does it choose the correct service?</span></div>
<div style="position:absolute;left:117.16px;top:350.66px" class="cls_039"><span class="cls_039">The good news is that consuming applications don’t need to make that choice or</span></div>
<div style="position:absolute;left:102.18px;top:363.68px" class="cls_039"><span class="cls_039">even explicitly look up a service on their own. Spring Cloud’s Eureka client support,</span></div>
<div style="position:absolute;left:102.18px;top:376.67px" class="cls_039"><span class="cls_039">along with the Ribbon client-side load balancer, makes it simple work to look up,</span></div>
<div style="position:absolute;left:102.18px;top:389.66px" class="cls_039"><span class="cls_039">select, and consume a service instance. Two ways to consume a service looked up from</span></div>
<div style="position:absolute;left:102.18px;top:402.68px" class="cls_039"><span class="cls_039">Eureka include:</span></div>
<div style="position:absolute;left:117.78px;top:418.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  A load-balanced </span><span class="cls_059">RestTemplate</span></div>
<div style="position:absolute;left:117.78px;top:432.68px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Feign-generated client interfaces</span></div>
<div style="position:absolute;left:102.18px;top:449.66px" class="cls_039"><span class="cls_039">Which you choose is largely a matter of personal taste. We’ll look at both options, start-</span></div>
<div style="position:absolute;left:102.18px;top:462.68px" class="cls_039"><span class="cls_039">ing with the load-balanced </span><span class="cls_059">RestTemplate</span><span class="cls_039">. Then you can choose which you like best.</span></div>
<div style="position:absolute;left:102.18px;top:480.86px" class="cls_064"><span class="cls_064">C</span><span class="cls_065">ONSUMING</span><span class="cls_064"> </span><span class="cls_065">SERVICES</span><span class="cls_064"> </span><span class="cls_065">WITH</span><span class="cls_064"> R</span><span class="cls_065">EST</span><span class="cls_064">T</span><span class="cls_065">EMPLATE</span></div>
<div style="position:absolute;left:102.18px;top:493.16px" class="cls_039"><span class="cls_039">You got your first look at Spring’s </span><span class="cls_059">RestTemplate</span><span class="cls_039"> client in chapter 7. As a quick</span></div>
<div style="position:absolute;left:102.18px;top:506.18px" class="cls_039"><span class="cls_039">reminder of how it works, once a </span><span class="cls_059">RestTemplate</span><span class="cls_039"> has been created or injected, you can</span></div>
<div style="position:absolute;left:102.18px;top:519.17px" class="cls_039"><span class="cls_039">make an HTTP call and have the responses bound to domain types. For example, to</span></div>
<div style="position:absolute;left:102.18px;top:532.16px" class="cls_039"><span class="cls_039">perform an HTTP GET request to retrieve an ingredient by its ID, you could use the</span></div>
<div style="position:absolute;left:102.18px;top:545.18px" class="cls_039"><span class="cls_039">following </span><span class="cls_059">RestTemplate</span><span class="cls_039"> code:</span></div>
<div style="position:absolute;left:102.18px;top:564.86px" class="cls_060"><span class="cls_060">public Ingredient getIngredientById(String ingredientId) {</span></div>
<div style="position:absolute;left:111.78px;top:574.85px" class="cls_060"><span class="cls_060">return rest.getForObject("</span><a href="http://localhost:8080/ingredients/%7Bid%7D" "="">http://localhost:8080/ingredients/{id}"</a>,</div>
<div style="position:absolute;left:231.73px;top:584.84px" class="cls_060"><span class="cls_060">Ingredient.class, ingredientId);</span></div>
<div style="position:absolute;left:102.18px;top:594.86px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:237948px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background360.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">338</span></div>
<div style="position:absolute;left:201.12px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 13</span></div>
<div style="position:absolute;left:250.05px;top:24.35px" class="cls_055"><span class="cls_055">Discovering services</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">The only problem with this code is that the URL passed into </span><span class="cls_059">getForObject()</span><span class="cls_039"> is hard-</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">coded to a specific host and port. I suppose that you could extract that detail into a</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">property, but if the request is destined for one of many instances of an ingredient ser-</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">vice, then any URL you configure would target a specific instance; there’d be no load</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">balancer in play to spread requests across the service instances.</span></div>
<div style="position:absolute;left:107.78px;top:115.67px" class="cls_039"><span class="cls_039">Once you’ve enabled an application as being a Eureka client, however, you have the</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">option of declaring a load-balanced </span><span class="cls_059">RestTemplate</span><span class="cls_039"> bean. All you need to do is declare a</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">regular </span><span class="cls_059">RestTemplate</span><span class="cls_039"> bean, but annotate the </span><span class="cls_059">@Bean</span><span class="cls_039"> method with </span><span class="cls_059">@LoadBalanced</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:161.33px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:93.18px;top:171.35px" class="cls_060"><span class="cls_060">@LoadBalanced</span></div>
<div style="position:absolute;left:93.18px;top:181.34px" class="cls_060"><span class="cls_060">public RestTemplate restTemplate() {</span></div>
<div style="position:absolute;left:102.78px;top:191.33px" class="cls_060"><span class="cls_060">return new RestTemplate();</span></div>
<div style="position:absolute;left:93.18px;top:201.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:224.66px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">@LoadBalanced</span><span class="cls_039"> annotation has two purposes: first, and most importantly, it tells</span></div>
<div style="position:absolute;left:93.18px;top:237.65px" class="cls_039"><span class="cls_039">Spring Cloud that this </span><span class="cls_059">RestTemplate</span><span class="cls_039"> should be instrumented with the ability to look</span></div>
<div style="position:absolute;left:93.18px;top:250.67px" class="cls_039"><span class="cls_039">up services through Ribbon. Secondly, it acts as an injection qualifier, so that if you</span></div>
<div style="position:absolute;left:93.18px;top:263.66px" class="cls_039"><span class="cls_039">have two or more </span><span class="cls_059">RestTemplate</span><span class="cls_039"> beans, you can specify that you want the load-balanced</span></div>
<div style="position:absolute;left:93.18px;top:276.65px" class="cls_059"><span class="cls_059">RestTemplate</span><span class="cls_039"> at the injection point.</span></div>
<div style="position:absolute;left:109.22px;top:289.67px" class="cls_039"><span class="cls_039">For example, suppose that you want to use the load-balanced </span><span class="cls_059">RestTemplate</span><span class="cls_039"> to</span></div>
<div style="position:absolute;left:93.18px;top:302.66px" class="cls_039"><span class="cls_039">look up an ingredient as in the previous code. First, you’d inject the load-balanced</span></div>
<div style="position:absolute;left:93.18px;top:315.68px" class="cls_059"><span class="cls_059">RestTemplate</span><span class="cls_039"> into the bean that needs it:</span></div>
<div style="position:absolute;left:93.18px;top:335.33px" class="cls_060"><span class="cls_060">@Component</span></div>
<div style="position:absolute;left:93.18px;top:345.35px" class="cls_060"><span class="cls_060">public class IngredientServiceClient {</span></div>
<div style="position:absolute;left:102.78px;top:365.33px" class="cls_060"><span class="cls_060">private RestTemplate rest;</span></div>
<div style="position:absolute;left:102.78px;top:385.34px" class="cls_060"><span class="cls_060">public IngredientServiceClient(@LoadBalanced RestTemplate rest) {</span></div>
<div style="position:absolute;left:112.38px;top:395.36px" class="cls_060"><span class="cls_060">this.rest = rest;</span></div>
<div style="position:absolute;left:102.78px;top:405.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:445.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:468.68px" class="cls_039"><span class="cls_039">Then rewrite the </span><span class="cls_059">getIngredientById()</span><span class="cls_039"> method slightly so that it uses the service’s</span></div>
<div style="position:absolute;left:93.18px;top:481.67px" class="cls_039"><span class="cls_039">registered name instead of an explicit host and port:</span></div>
<div style="position:absolute;left:93.18px;top:501.35px" class="cls_060"><span class="cls_060">public Ingredient getIngredientById(String ingredientId) {</span></div>
<div style="position:absolute;left:102.78px;top:511.34px" class="cls_060"><span class="cls_060">return rest.getForObject(</span></div>
<div style="position:absolute;left:160.35px;top:521.36px" class="cls_060"><span class="cls_060">"</span><a href="http://ingredient-service/ingredients/%7Bid%7D" "="">http://ingredient-service/ingredients/{id}"</a>,</div>
<div style="position:absolute;left:160.35px;top:531.35px" class="cls_060"><span class="cls_060">Ingredient.class, ingredientId);</span></div>
<div style="position:absolute;left:93.18px;top:541.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:564.68px" class="cls_039"><span class="cls_039">Did you notice the difference? The URL given to </span><span class="cls_059">getForObject()</span><span class="cls_039"> doesn’t use any</span></div>
<div style="position:absolute;left:93.18px;top:577.67px" class="cls_039"><span class="cls_039">specific hostname or port. In place of the hostname and port, the service name</span></div>
<div style="position:absolute;left:93.18px;top:590.69px" class="cls_039"><span class="cls_039">ingredient-service is used. Internally, </span><span class="cls_059">RestTemplate</span><span class="cls_039"> asks Ribbon to look up a service</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:238624px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background361.jpg" width="531" height="666"></div>
<div style="position:absolute;left:206.28px;top:24.35px" class="cls_055"><span class="cls_055">Registering and discovering services</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">339</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">by that name and to select an instance. Ribbon, happy to oblige, rewrites the URL to</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">include the host and port information for the chosen service instance and then lets</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_059"><span class="cls_059">RestTemplate</span><span class="cls_039"> proceed as usual.</span></div>
<div style="position:absolute;left:116.76px;top:89.66px" class="cls_039"><span class="cls_039">As you can see, using a load-balanced </span><span class="cls_059">RestTemplate</span><span class="cls_039"> isn’t that different from using</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">a standard </span><span class="cls_059">RestTemplate</span><span class="cls_039">. The key difference is that the client code only needs to deal</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">with service names instead of explicit hostnames and ports. But what if you’re using</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_059"><span class="cls_059">WebClient</span><span class="cls_039"> instead of </span><span class="cls_059">RestTemplate</span><span class="cls_039">? Can </span><span class="cls_059">WebClient</span><span class="cls_039"> also be used along with Ribbon</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">to consume services by name?</span></div>
<div style="position:absolute;left:102.18px;top:161.84px" class="cls_064"><span class="cls_064">C</span><span class="cls_065">ONSUMING</span><span class="cls_064"> </span><span class="cls_065">SERVICES</span><span class="cls_064"> </span><span class="cls_065">WITH</span><span class="cls_064"> W</span><span class="cls_065">EB</span><span class="cls_064">C</span><span class="cls_065">LIENT</span></div>
<div style="position:absolute;left:102.18px;top:175.16px" class="cls_039"><span class="cls_039">In chapter 11, you saw how </span><span class="cls_059">WebClient</span><span class="cls_039"> offers an HTTP client similar to </span><span class="cls_059">RestTemplate</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:102.18px;top:188.15px" class="cls_039"><span class="cls_039">but that works with reactive types such as </span><span class="cls_059">Flux</span><span class="cls_039"> and </span><span class="cls_059">Mono</span><span class="cls_039">. If you’ve been bit by the reac-</span></div>
<div style="position:absolute;left:102.18px;top:201.17px" class="cls_039"><span class="cls_039">tive programming bug, you might prefer to use </span><span class="cls_059">WebClient</span><span class="cls_039"> instead of </span><span class="cls_059">RestTemplate</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:102.18px;top:214.16px" class="cls_039"><span class="cls_039">The good news is that you can use </span><span class="cls_059">WebClient</span><span class="cls_039"> as a load-balanced client in much the</span></div>
<div style="position:absolute;left:102.18px;top:227.15px" class="cls_039"><span class="cls_039">same way as you’ve seen </span><span class="cls_059">RestTemplate</span><span class="cls_039"> used. The first thing to do is declare a</span></div>
<div style="position:absolute;left:102.18px;top:240.17px" class="cls_059"><span class="cls_059">WebClient.Builder</span><span class="cls_039"> bean method that’s annotated with </span><span class="cls_059">@LoadBalanced</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:102.18px;top:259.85px" class="cls_060"><span class="cls_060">@Bean</span></div>
<div style="position:absolute;left:102.18px;top:269.84px" class="cls_060"><span class="cls_060">@LoadBalanced</span></div>
<div style="position:absolute;left:102.18px;top:279.83px" class="cls_060"><span class="cls_060">public WebClient.Builder webClientBuilder() {</span></div>
<div style="position:absolute;left:111.78px;top:289.85px" class="cls_060"><span class="cls_060">return WebClient.builder();</span></div>
<div style="position:absolute;left:102.18px;top:299.84px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:321.17px" class="cls_039"><span class="cls_039">With a </span><span class="cls_059">WebClient.Builder</span><span class="cls_039"> bean declared, you can now inject the load-balanced </span><span class="cls_059">Web-</span></div>
<div style="position:absolute;left:102.18px;top:334.16px" class="cls_059"><span class="cls_059">Client.Builder</span><span class="cls_039"> into any bean that needs it. For example, you might inject it into the</span></div>
<div style="position:absolute;left:102.18px;top:347.18px" class="cls_039"><span class="cls_039">constructor of </span><span class="cls_059">IngredientServiceClient</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:102.18px;top:366.83px" class="cls_060"><span class="cls_060">@Component</span></div>
<div style="position:absolute;left:102.18px;top:376.85px" class="cls_060"><span class="cls_060">public class IngredientServiceClient {</span></div>
<div style="position:absolute;left:111.78px;top:396.86px" class="cls_060"><span class="cls_060">private WebClient.Builder wcBuilder;</span></div>
<div style="position:absolute;left:111.78px;top:416.84px" class="cls_060"><span class="cls_060">public IngredientServiceClient(</span></div>
<div style="position:absolute;left:140.55px;top:426.86px" class="cls_060"><span class="cls_060">@LoadBalanced WebClient.Builder webclientBuilder wcBuilder) {</span></div>
<div style="position:absolute;left:121.38px;top:436.85px" class="cls_060"><span class="cls_060">this.wcBuilder = wcBuilder;</span></div>
<div style="position:absolute;left:111.78px;top:446.84px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:486.86px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:508.16px" class="cls_039"><span class="cls_039">Finally, when you’re ready to use it, you can use the </span><span class="cls_059">WebClient.Builder</span><span class="cls_039"> to build a </span><span class="cls_059">Web-</span></div>
<div style="position:absolute;left:102.18px;top:521.18px" class="cls_059"><span class="cls_059">Client</span><span class="cls_039"> and then make requests using the service’s name as it’s registered in Eureka:</span></div>
<div style="position:absolute;left:102.18px;top:540.86px" class="cls_060"><span class="cls_060">public Mono&lt;Ingredient&gt; getIngredientById(String ingredientId) {</span></div>
<div style="position:absolute;left:111.78px;top:550.85px" class="cls_060"><span class="cls_060">return wcBuilder.build()</span></div>
<div style="position:absolute;left:121.38px;top:560.84px" class="cls_060"><span class="cls_060">.get()</span></div>
<div style="position:absolute;left:130.95px;top:570.86px" class="cls_060"><span class="cls_060">.uri("</span><a href="http://ingredient-service/ingredients/%7Bid%7D" "="">http://ingredient-service/ingredients/{id}"</a>, ingredientId)</div>
<div style="position:absolute;left:121.38px;top:580.85px" class="cls_060"><span class="cls_060">.retrieve().bodyToMono(Ingredient.class);</span></div>
<div style="position:absolute;left:102.18px;top:590.84px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:239300px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background362.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">340</span></div>
<div style="position:absolute;left:201.12px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 13</span></div>
<div style="position:absolute;left:250.05px;top:24.35px" class="cls_055"><span class="cls_055">Discovering services</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">As with the load-balanced </span><span class="cls_059">RestTemplate</span><span class="cls_039">, there’s no need to explicitly specify a host or</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">port when making requests. The service name will be extracted from the given URL</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">and used to look up a service from Eureka. Then Ribbon will select an instance of the</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">service and the URL will be rewritten with the chosen instance’s host and port before</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">making the request.</span></div>
<div style="position:absolute;left:109.61px;top:115.67px" class="cls_039"><span class="cls_039">Although this programming model is easy to grasp, especially if you’re already</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">familiar with </span><span class="cls_059">RestTemplate</span><span class="cls_039"> or </span><span class="cls_059">WebClient</span><span class="cls_039">, Spring Cloud has another trick up its sleeve.</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">Next, let’s take a look at how to use Feign to create interface-based service clients.</span></div>
<div style="position:absolute;left:93.18px;top:159.83px" class="cls_064"><span class="cls_064">D</span><span class="cls_065">EFINING</span><span class="cls_064"> F</span><span class="cls_065">EIGN</span><span class="cls_064"> </span><span class="cls_065">CLIENT</span><span class="cls_064"> </span><span class="cls_065">INTERFACES</span></div>
<div style="position:absolute;left:93.18px;top:172.16px" class="cls_039"><span class="cls_039">Feign is a REST client library that applies a unique, interface-driven approach to</span></div>
<div style="position:absolute;left:93.18px;top:185.15px" class="cls_039"><span class="cls_039">defining REST clients. Put simply, if you enjoy how Spring Data automatically imple-</span></div>
<div style="position:absolute;left:93.18px;top:198.17px" class="cls_039"><span class="cls_039">ments repository interfaces, then you’re going to love Feign.</span></div>
<div style="position:absolute;left:108.23px;top:211.16px" class="cls_039"><span class="cls_039">Feign was originally a Netflix project, but has since been turned loose as an inde-</span></div>
<div style="position:absolute;left:93.18px;top:224.15px" class="cls_039"><span class="cls_039">pendent open-source project called OpenFeign (</span><a href="https://github.com/OpenFeign">https://github.com/OpenFeign</a> <span class="cls_039">).</span></div>
<div style="position:absolute;left:93.18px;top:237.17px" class="cls_039"><span class="cls_039">The word </span><span class="cls_036">feign</span><span class="cls_039"> means “to pretend,” which you’ll soon see is an appropriate name for a</span></div>
<div style="position:absolute;left:93.18px;top:250.16px" class="cls_039"><span class="cls_039">project that pretends to be a REST client.</span></div>
<div style="position:absolute;left:109.17px;top:263.15px" class="cls_039"><span class="cls_039">The first step to using Feign is to add the dependency to the project build. In</span></div>
<div style="position:absolute;left:93.18px;top:276.17px" class="cls_039"><span class="cls_039">pom.xml, the following </span><span class="cls_059">&lt;dependency&gt;</span><span class="cls_039"> does the trick:</span></div>
<div style="position:absolute;left:93.18px;top:297.83px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:307.85px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:317.84px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:93.18px;top:327.83px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:93.18px;top:351.17px" class="cls_039"><span class="cls_039">This same starter dependency can be added automatically by checking the Feign</span></div>
<div style="position:absolute;left:93.18px;top:364.16px" class="cls_039"><span class="cls_039">checkbox when using Spring Initializr. Unfortunately, there’s no autoconfiguration to</span></div>
<div style="position:absolute;left:93.18px;top:377.18px" class="cls_039"><span class="cls_039">enable Feign based on the existence of this dependency. Therefore, you’ll need to</span></div>
<div style="position:absolute;left:93.18px;top:390.17px" class="cls_039"><span class="cls_039">add the </span><span class="cls_059">@EnableFeignClients</span><span class="cls_039"> annotation to one of the configuration classes:</span></div>
<div style="position:absolute;left:93.18px;top:411.86px" class="cls_060"><span class="cls_060">@Configuration</span></div>
<div style="position:absolute;left:93.18px;top:421.85px" class="cls_060"><span class="cls_060">@EnableFeignClients</span></div>
<div style="position:absolute;left:93.18px;top:431.84px" class="cls_060"><span class="cls_060">public RestClientConfiguration {</span></div>
<div style="position:absolute;left:93.18px;top:441.86px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:465.17px" class="cls_039"><span class="cls_039">Now comes the fun part. Let’s say that you want to write a client that fetches an </span><span class="cls_059">Ingre-</span></div>
<div style="position:absolute;left:93.18px;top:478.16px" class="cls_059"><span class="cls_059">dient</span><span class="cls_039"> from the service that’s registered in Eureka as ingredient-service. The following</span></div>
<div style="position:absolute;left:93.18px;top:491.18px" class="cls_039"><span class="cls_039">interface is all you need:</span></div>
<div style="position:absolute;left:93.18px;top:510.86px" class="cls_060"><span class="cls_060">package tacos.ingredientclient.feign;</span></div>
<div style="position:absolute;left:93.18px;top:520.85px" class="cls_060"><span class="cls_060">import org.springframework.cloud.openfeign.FeignClient;</span></div>
<div style="position:absolute;left:93.18px;top:530.84px" class="cls_060"><span class="cls_060">import org.springframework.web.bind.annotation.GetMapping;</span></div>
<div style="position:absolute;left:93.18px;top:540.86px" class="cls_060"><span class="cls_060">import org.springframework.web.bind.annotation.PathVariable;</span></div>
<div style="position:absolute;left:93.18px;top:550.85px" class="cls_060"><span class="cls_060">import tacos.ingredientclient.Ingredient;</span></div>
<div style="position:absolute;left:93.18px;top:570.86px" class="cls_060"><span class="cls_060">@FeignClient("ingredient-service")</span></div>
<div style="position:absolute;left:93.18px;top:580.85px" class="cls_060"><span class="cls_060">public interface IngredientClient {</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:239976px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background363.jpg" width="531" height="666"></div>
<div style="position:absolute;left:206.28px;top:24.35px" class="cls_055"><span class="cls_055">Registering and discovering services</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">341</span></div>
<div style="position:absolute;left:111.78px;top:51.32px" class="cls_060"><span class="cls_060">@GetMapping("/ingredients/{id}")</span></div>
<div style="position:absolute;left:111.77px;top:61.34px" class="cls_060"><span class="cls_060">Ingredient getIngredient(@PathVariable("id") String id);</span></div>
<div style="position:absolute;left:102.18px;top:81.32px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">It’s a simple interface, with no implementations. But at runtime, when Feign gets hold</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">of it, none of that matters. Feign automatically creates an implementation and exposes</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">it as a bean in the Spring application context.</span></div>
<div style="position:absolute;left:117.48px;top:141.65px" class="cls_039"><span class="cls_039">Looking closer, you’ll see that there are a few annotations in play that make this</span></div>
<div style="position:absolute;left:102.18px;top:154.67px" class="cls_039"><span class="cls_039">come together. The </span><span class="cls_059">@FeignClient</span><span class="cls_039">annotation at the interface-level specifies that any</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">methods you declare in this interface will make requests against the service whose</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">name is ingredient-service. Internally, this service will be looked up via Ribbon, the</span></div>
<div style="position:absolute;left:102.18px;top:193.67px" class="cls_039"><span class="cls_039">same way as it worked for the load-balanced </span><span class="cls_059">RestTemplate</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:118.79px;top:206.66px" class="cls_039"><span class="cls_039">Then there’s the </span><span class="cls_059">getIngredient()</span><span class="cls_039"> method, annotated with </span><span class="cls_059">@RequestMapping</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:102.18px;top:219.65px" class="cls_039"><span class="cls_039">You’ll no doubt recognize </span><span class="cls_059">@GetMapping</span><span class="cls_039"> from Spring MVC. Indeed, it’s the very same</span></div>
<div style="position:absolute;left:102.18px;top:232.67px" class="cls_039"><span class="cls_039">annotation! But this time, it’s on the client instead of the controller. It says that any</span></div>
<div style="position:absolute;left:102.18px;top:245.66px" class="cls_039"><span class="cls_039">calls to </span><span class="cls_059">getIngredient()</span><span class="cls_039"> will result in a GET request to the /ingredients/</span><span class="cls_036">{id}</span><span class="cls_039"> path at</span></div>
<div style="position:absolute;left:102.18px;top:258.65px" class="cls_039"><span class="cls_039">the host and port chosen by Ribbon. The </span><span class="cls_059">@PathVariable</span><span class="cls_039"> annotation, also from</span></div>
<div style="position:absolute;left:102.18px;top:271.67px" class="cls_039"><span class="cls_039">Spring MVC, maps the method parameter to the placeholder in the given path.</span></div>
<div style="position:absolute;left:116.56px;top:284.66px" class="cls_039"><span class="cls_039">All that’s left is to inject the Feign-implemented interface wherever it’s needed and</span></div>
<div style="position:absolute;left:102.18px;top:297.68px" class="cls_039"><span class="cls_039">start using it. For instance, to use it in a controller, you might do something like this:</span></div>
<div style="position:absolute;left:102.18px;top:317.33px" class="cls_060"><span class="cls_060">@Controller</span></div>
<div style="position:absolute;left:102.18px;top:327.35px" class="cls_060"><span class="cls_060">@RequestMapping("/ingredients")</span></div>
<div style="position:absolute;left:102.18px;top:337.34px" class="cls_060"><span class="cls_060">public class IngredientController {</span></div>
<div style="position:absolute;left:111.78px;top:357.35px" class="cls_060"><span class="cls_060">private IngredientClient client;</span></div>
<div style="position:absolute;left:111.78px;top:377.33px" class="cls_060"><span class="cls_060">@Autowired</span></div>
<div style="position:absolute;left:111.78px;top:387.35px" class="cls_060"><span class="cls_060">public IngredientController(IngredientClient client) {</span></div>
<div style="position:absolute;left:121.36px;top:397.34px" class="cls_060"><span class="cls_060">this.client = client;</span></div>
<div style="position:absolute;left:111.78px;top:407.36px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:427.34px" class="cls_060"><span class="cls_060">@GetMapping("/{id}")</span></div>
<div style="position:absolute;left:111.78px;top:437.36px" class="cls_060"><span class="cls_060">public String ingredientDetailPage(@PathVariable("id") String id,</span></div>
<div style="position:absolute;left:279.71px;top:447.35px" class="cls_060"><span class="cls_060">Model model) {</span></div>
<div style="position:absolute;left:121.38px;top:457.34px" class="cls_060"><span class="cls_060">model.addAttribute("ingredient", client.getIngredient(id));</span></div>
<div style="position:absolute;left:121.38px;top:467.36px" class="cls_060"><span class="cls_060">return "ingredientDetail";</span></div>
<div style="position:absolute;left:111.78px;top:477.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:487.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:510.68px" class="cls_039"><span class="cls_039">I don’t know about you, but I think that’s mighty slick! It’s hard to decide which I like</span></div>
<div style="position:absolute;left:102.18px;top:523.67px" class="cls_039"><span class="cls_039">best: the load-balanced </span><span class="cls_059">RestTemplate</span><span class="cls_039">, </span><span class="cls_059">WebClient</span><span class="cls_039">, or this magical Feign client inter-</span></div>
<div style="position:absolute;left:102.18px;top:536.66px" class="cls_039"><span class="cls_039">face. Whichever you choose, you can rest assured that your REST clients (no pun</span></div>
<div style="position:absolute;left:102.18px;top:549.68px" class="cls_039"><span class="cls_039">intended) will be able to consume services registered in Eureka by their name, with-</span></div>
<div style="position:absolute;left:102.18px;top:562.67px" class="cls_039"><span class="cls_039">out being hard-coded with any specific hostname or port.</span></div>
<div style="position:absolute;left:116.58px;top:575.69px" class="cls_039"><span class="cls_039">For what it’s worth, Feign comes with its own set of annotations. </span><span class="cls_059">@RequestLine</span><span class="cls_039"> and</span></div>
<div style="position:absolute;left:102.18px;top:588.68px" class="cls_059"><span class="cls_059">@Param</span><span class="cls_039"> are roughly analogous to Spring MVC’s </span><span class="cls_059">@RequestMapping</span><span class="cls_039"> and </span><span class="cls_059">@PathVariable</span><span class="cls_039">,</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:240652px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background364.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">342</span></div>
<div style="position:absolute;left:201.12px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 13</span></div>
<div style="position:absolute;left:250.05px;top:24.35px" class="cls_055"><span class="cls_055">Discovering services</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">but their use is slightly different. It’s rather nice, though, to be able to use Spring</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">MVC annotations on clients that are already familiar and, perhaps, identical to the</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">ones you used when defining the service controllers.</span></div>
<div style="position:absolute;left:93.18px;top:97.81px" class="cls_040"><span class="cls_040">Summary</span></div>
<div style="position:absolute;left:108.78px;top:116.15px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Spring Cloud Netflix enables the simple creation of a Netflix Eureka service</span></div>
<div style="position:absolute;left:120.78px;top:129.17px" class="cls_039"><span class="cls_039">registry with autoconfiguration and the </span><span class="cls_059">@EnableEurekaServer</span><span class="cls_039"> annotation.</span></div>
<div style="position:absolute;left:108.78px;top:143.15px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Microservices register themselves by name with Eureka for discovery by other</span></div>
<div style="position:absolute;left:120.78px;top:156.17px" class="cls_039"><span class="cls_039">services.</span></div>
<div style="position:absolute;left:108.78px;top:170.15px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  On the client-side, Ribbon acts as a client-side load balancer, looking up ser-</span></div>
<div style="position:absolute;left:120.78px;top:183.17px" class="cls_039"><span class="cls_039">vices by name and selecting an instance.</span></div>
<div style="position:absolute;left:108.78px;top:197.15px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Client code has the choice of either a </span><span class="cls_059">RestTemplate</span><span class="cls_039"> that’s instrumented for</span></div>
<div style="position:absolute;left:120.78px;top:210.17px" class="cls_039"><span class="cls_039">Ribbon load balancing or defining its REST client code as interfaces that are</span></div>
<div style="position:absolute;left:120.78px;top:223.16px" class="cls_039"><span class="cls_039">implemented automatically at runtime by Feign.</span></div>
<div style="position:absolute;left:108.78px;top:237.17px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  In any event, client code is not hard-coded with the location of the services that</span></div>
<div style="position:absolute;left:120.78px;top:250.16px" class="cls_039"><span class="cls_039">it consumes.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:241328px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background365.jpg" width="531" height="666"></div>
<div style="position:absolute;left:183.18px;top:111.83px" class="cls_014"><span class="cls_014">Managing configuration</span></div>
<div style="position:absolute;left:96.18px;top:264.85px" class="cls_049"><span class="cls_049">This chapter covers</span></div>
<div style="position:absolute;left:96.18px;top:283.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Running Spring Cloud Config Server</span></div>
<div style="position:absolute;left:96.18px;top:298.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Creating Config Server clients</span></div>
<div style="position:absolute;left:96.18px;top:313.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Storing sensitive configuration</span></div>
<div style="position:absolute;left:96.18px;top:328.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Automatically refreshing configuration</span></div>
<div style="position:absolute;left:114.18px;top:398.54px" class="cls_039"><span class="cls_039">Anyone who has bought a house or a car has probably encountered a thick stack</span></div>
<div style="position:absolute;left:114.18px;top:411.53px" class="cls_039"><span class="cls_039">of paper. The contracts you sign when making major purchases tend to thumb</span></div>
<div style="position:absolute;left:114.18px;top:424.55px" class="cls_039"><span class="cls_039">their nose at the promise of a paperless society. Whenever I sit across the table</span></div>
<div style="position:absolute;left:114.18px;top:437.54px" class="cls_039"><span class="cls_039">from a car dealer or a title agent, I feel as if I should request a stack of bandages</span></div>
<div style="position:absolute;left:114.18px;top:450.53px" class="cls_039"><span class="cls_039">before getting started, in preparation for the paper cuts I’ll almost certainly receive</span></div>
<div style="position:absolute;left:114.18px;top:463.55px" class="cls_039"><span class="cls_039">before we’re done.</span></div>
<div style="position:absolute;left:129.04px;top:476.54px" class="cls_039"><span class="cls_039">I’ve noticed that although the number of pages I must sign has stayed constant</span></div>
<div style="position:absolute;left:114.18px;top:489.56px" class="cls_039"><span class="cls_039">in recent years, I don’t have to fill out as many fields on the forms as I once did.</span></div>
<div style="position:absolute;left:114.18px;top:502.55px" class="cls_039"><span class="cls_039">Where forms were once manually filled in, modern forms are more often prepopu-</span></div>
<div style="position:absolute;left:114.18px;top:515.54px" class="cls_039"><span class="cls_039">lated with basic data that was gathered before the forms were printed. This has not</span></div>
<div style="position:absolute;left:114.18px;top:528.56px" class="cls_039"><span class="cls_039">only made the process quicker, but has also reduced mistakes resulting from man-</span></div>
<div style="position:absolute;left:114.18px;top:541.55px" class="cls_039"><span class="cls_039">ual duplication of data across multiple forms.</span></div>
<div style="position:absolute;left:269.16px;top:596.99px" class="cls_048"><span class="cls_048">343</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:242004px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background366.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">344</span></div>
<div style="position:absolute;left:193.29px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 14</span></div>
<div style="position:absolute;left:242.25px;top:24.35px" class="cls_055"><span class="cls_055">Managing configuration</span></div>
<div style="position:absolute;left:107.84px;top:50.66px" class="cls_039"><span class="cls_039">Likewise, many applications have some form of configuration in play. In chapter 5</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">we talked about ways you can configure Spring Boot applications by setting configura-</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">tion properties. Often, properties you might set are unique to the application, and it’s</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">easy enough to specify those properties in the application.properties or applica-</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">tion.yml file that’s packaged in your application’s deployment.</span></div>
<div style="position:absolute;left:109.74px;top:115.67px" class="cls_039"><span class="cls_039">When an application is architected with microservices, however, configuration</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">properties are often common across multiple services. Just as it once was tedious and</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">error-prone to manually fill in forms with duplicate data, duplicating configuration</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_039"><span class="cls_039">across multiple application services can be problematic.</span></div>
<div style="position:absolute;left:108.68px;top:167.66px" class="cls_039"><span class="cls_039">In this chapter, we’ll look at Spring Cloud’s Config Server, a service that provides</span></div>
<div style="position:absolute;left:93.18px;top:180.65px" class="cls_039"><span class="cls_039">centralized configuration for all services in a given application. With Config Server, you</span></div>
<div style="position:absolute;left:93.18px;top:193.67px" class="cls_039"><span class="cls_039">can manage all of an application’s configuration in one place, without duplication.</span></div>
<div style="position:absolute;left:108.14px;top:206.66px" class="cls_039"><span class="cls_039">Before we get started, let’s briefly consider the problems of configuring microser-</span></div>
<div style="position:absolute;left:93.18px;top:219.65px" class="cls_039"><span class="cls_039">vices individually, and how centralized configuration is better.</span></div>
<div style="position:absolute;left:57.18px;top:243.82px" class="cls_040"><span class="cls_040">14.1</span></div>
<div style="position:absolute;left:93.18px;top:243.82px" class="cls_040"><span class="cls_040">Sharing configuration</span></div>
<div style="position:absolute;left:93.18px;top:263.15px" class="cls_039"><span class="cls_039">As you saw in chapter 5, you can configure Spring applications by setting properties in</span></div>
<div style="position:absolute;left:93.18px;top:276.17px" class="cls_039"><span class="cls_039">any of several property sources. If a configuration property is likely to change or be</span></div>
<div style="position:absolute;left:93.18px;top:289.16px" class="cls_039"><span class="cls_039">unique to the runtime environment, Java system properties or operating system envi-</span></div>
<div style="position:absolute;left:93.18px;top:302.18px" class="cls_039"><span class="cls_039">ronment variables are a fitting choice. For properties that are unlikely to change and</span></div>
<div style="position:absolute;left:93.18px;top:315.17px" class="cls_039"><span class="cls_039">are specific to a given application, placing those property specifications in applica-</span></div>
<div style="position:absolute;left:93.18px;top:328.16px" class="cls_039"><span class="cls_039">tion.yml or application.properties to be deployed with the packaged application is a</span></div>
<div style="position:absolute;left:93.18px;top:341.18px" class="cls_039"><span class="cls_039">fine choice.</span></div>
<div style="position:absolute;left:108.42px;top:354.17px" class="cls_039"><span class="cls_039">These choices are okay for simple applications. But when you’re setting configura-</span></div>
<div style="position:absolute;left:93.18px;top:367.16px" class="cls_039"><span class="cls_039">tion properties in environment variables or Java system properties, you must accept that</span></div>
<div style="position:absolute;left:93.18px;top:380.18px" class="cls_039"><span class="cls_039">changing those properties will require the application to be restarted. And if you choose</span></div>
<div style="position:absolute;left:93.18px;top:393.17px" class="cls_039"><span class="cls_039">to package the properties inside the deployed JAR or WAR file, you must completely</span></div>
<div style="position:absolute;left:93.18px;top:406.16px" class="cls_039"><span class="cls_039">rebuild and redeploy the application should those properties need to change. These</span></div>
<div style="position:absolute;left:93.18px;top:419.18px" class="cls_039"><span class="cls_039">same constraints are in play should you need to roll back changes to configuration.</span></div>
<div style="position:absolute;left:108.28px;top:432.17px" class="cls_039"><span class="cls_039">Those limitations may be acceptable in some applications. In others, redeploying</span></div>
<div style="position:absolute;left:93.18px;top:445.16px" class="cls_039"><span class="cls_039">and restarting the application just to change a simple property is inconvenient at best</span></div>
<div style="position:absolute;left:93.18px;top:458.18px" class="cls_039"><span class="cls_039">and crippling at worst. Moreover, in microservice-architected applications, property</span></div>
<div style="position:absolute;left:93.18px;top:471.17px" class="cls_039"><span class="cls_039">management is spread across multiple codebases and deployment instances, making it</span></div>
<div style="position:absolute;left:93.18px;top:484.16px" class="cls_039"><span class="cls_039">unreasonable to apply the same change in every single instance of multiple services in</span></div>
<div style="position:absolute;left:93.18px;top:497.18px" class="cls_039"><span class="cls_039">a running application.</span></div>
<div style="position:absolute;left:107.88px;top:510.17px" class="cls_039"><span class="cls_039">Some properties are sensitive, such as database passwords and other types of secrets.</span></div>
<div style="position:absolute;left:93.18px;top:523.16px" class="cls_039"><span class="cls_039">Although those values can be encrypted when written to an individual application’s</span></div>
<div style="position:absolute;left:93.18px;top:536.18px" class="cls_039"><span class="cls_039">properties, the application must include the ability to decrypt those properties before</span></div>
<div style="position:absolute;left:93.18px;top:549.17px" class="cls_039"><span class="cls_039">they can be used. Even then, some properties may need to be kept from even the</span></div>
<div style="position:absolute;left:93.18px;top:562.19px" class="cls_039"><span class="cls_039">application developers, making it highly undesirable to set them in environment vari-</span></div>
<div style="position:absolute;left:93.18px;top:575.18px" class="cls_039"><span class="cls_039">ables or manage them with the same source code control system as the rest of the</span></div>
<div style="position:absolute;left:93.18px;top:588.17px" class="cls_039"><span class="cls_039">application code.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:242680px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background367.jpg" width="531" height="666"></div>
<div style="position:absolute;left:229.74px;top:24.35px" class="cls_055"><span class="cls_055">Running Config Server</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">345</span></div>
<div style="position:absolute;left:118.02px;top:50.66px" class="cls_039"><span class="cls_039">In contrast, consider how those scenarios play out when configuration manage-</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">ment is centralized:</span></div>
<div style="position:absolute;left:117.78px;top:80.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Configuration is no longer packaged and deployed with the application code,</span></div>
<div style="position:absolute;left:129.78px;top:93.65px" class="cls_039"><span class="cls_039">making it possible to change or roll back configuration without rebuilding or</span></div>
<div style="position:absolute;left:129.78px;top:106.67px" class="cls_039"><span class="cls_039">redeploying the application. Configuration can be changed on the fly without</span></div>
<div style="position:absolute;left:129.78px;top:119.66px" class="cls_039"><span class="cls_039">even restarting the application.</span></div>
<div style="position:absolute;left:117.78px;top:133.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Microservices that share common configuration needn’t manage their own</span></div>
<div style="position:absolute;left:129.78px;top:146.66px" class="cls_039"><span class="cls_039">copy of the property settings and can share the same properties. If changes to</span></div>
<div style="position:absolute;left:129.78px;top:159.65px" class="cls_039"><span class="cls_039">the properties are required, those changes can be made once, in a single place,</span></div>
<div style="position:absolute;left:129.78px;top:172.67px" class="cls_039"><span class="cls_039">and applied to all microservices.</span></div>
<div style="position:absolute;left:117.78px;top:186.65px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Sensitive configuration details can be encrypted and maintained separate from</span></div>
<div style="position:absolute;left:129.78px;top:199.67px" class="cls_039"><span class="cls_039">the application code. The unencrypted values can be made available to the</span></div>
<div style="position:absolute;left:129.78px;top:212.66px" class="cls_039"><span class="cls_039">application on demand, rather than requiring the application to carry code</span></div>
<div style="position:absolute;left:129.78px;top:225.65px" class="cls_039"><span class="cls_039">that decrypts the information.</span></div>
<div style="position:absolute;left:102.18px;top:243.65px" class="cls_039"><span class="cls_039">Spring Cloud Config Server provides centralized configuration with a server that all</span></div>
<div style="position:absolute;left:102.18px;top:256.67px" class="cls_039"><span class="cls_039">microservices within an application can rely on for their configuration. Because it’s</span></div>
<div style="position:absolute;left:102.18px;top:269.66px" class="cls_039"><span class="cls_039">centralized, it’s a one-stop shop for configuration that’s common across all services,</span></div>
<div style="position:absolute;left:102.18px;top:282.65px" class="cls_039"><span class="cls_039">but it’s also able to serve configuration that’s specific to a given service.</span></div>
<div style="position:absolute;left:116.78px;top:295.67px" class="cls_039"><span class="cls_039">The first step in using Config Server is to create and run the server.</span></div>
<div style="position:absolute;left:66.18px;top:319.84px" class="cls_040"><span class="cls_040">14.2</span></div>
<div style="position:absolute;left:102.18px;top:319.84px" class="cls_040"><span class="cls_040">Running Config Server</span></div>
<div style="position:absolute;left:102.18px;top:339.17px" class="cls_039"><span class="cls_039">Spring Cloud Config Server provides a centralized source for configuration data.</span></div>
<div style="position:absolute;left:102.18px;top:352.16px" class="cls_039"><span class="cls_039">Much like Eureka, Config Server can be considered just another microservice whose</span></div>
<div style="position:absolute;left:102.18px;top:365.18px" class="cls_039"><span class="cls_039">role in the greater application is to serve configuration data for other services in the</span></div>
<div style="position:absolute;left:102.18px;top:378.17px" class="cls_039"><span class="cls_039">same application.</span></div>
<div style="position:absolute;left:118.15px;top:391.16px" class="cls_039"><span class="cls_039">Config Server exposes a REST API through which clients (which are other ser-</span></div>
<div style="position:absolute;left:102.18px;top:404.18px" class="cls_039"><span class="cls_039">vices) can consume configuration properties. The configuration that’s served through</span></div>
<div style="position:absolute;left:102.18px;top:417.17px" class="cls_039"><span class="cls_039">the Config Server is housed external to the Config Server, typically in a source code</span></div>
<div style="position:absolute;left:102.18px;top:430.16px" class="cls_039"><span class="cls_039">control system such as Git. Figure 14.1 illustrates how this works.</span></div>
<div style="position:absolute;left:118.17px;top:443.18px" class="cls_039"><span class="cls_039">Take note of the fact that the box in figure 14.1 has the Git logo, but not the</span></div>
<div style="position:absolute;left:102.18px;top:456.17px" class="cls_039"><span class="cls_039">GitHub logo. That’s significant—you can use any implementation of Git to store your</span></div>
<div style="position:absolute;left:102.18px;top:469.16px" class="cls_039"><span class="cls_039">configuration, including but not limited to GitHub. GitLab, Microsoft’s Team Founda-</span></div>
<div style="position:absolute;left:102.18px;top:482.18px" class="cls_039"><span class="cls_039">tion Server, or Gogs are all valid choices as a backend for Config Server.</span></div>
<div style="position:absolute;left:114.18px;top:505.16px" class="cls_083"><span class="cls_083">NOTE</span><span class="cls_039">   Although it makes little difference which Git server you use with Con-</span></div>
<div style="position:absolute;left:114.18px;top:517.16px" class="cls_039"><span class="cls_039">fig Server, I’m using Gogs (</span><a href="http://gogs.io/">http://gogs.io</a> <span class="cls_039">), a lightweight, easy-to-set-up Git</span></div>
<div style="position:absolute;left:114.18px;top:529.16px" class="cls_039"><span class="cls_039">server. More specifically, I’m running Gogs on my development machine using</span></div>
<div style="position:absolute;left:114.18px;top:541.16px" class="cls_039"><span class="cls_039">the instructions for running Gogs in Docker at </span><a href="https://github.com/gogits/gogs/tree/master/docker">https://github.com/gogits/</a> </div>
<div style="position:absolute;left:114.18px;top:553.19px" class="cls_045"><span class="cls_045"> </span><a href="https://github.com/gogits/gogs/tree/master/docker">gogs/tree/master/docker</a> <span class="cls_039">.</span></div>
<div style="position:absolute;left:102.18px;top:575.18px" class="cls_039"><span class="cls_039">By storing the configuration in a source code control system such as Git, the configu-</span></div>
<div style="position:absolute;left:102.18px;top:588.17px" class="cls_039"><span class="cls_039">ration can be versioned, branched, labeled, reverted, and blamed, just like application</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:243356px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background368.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">346</span></div>
<div style="position:absolute;left:193.29px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 14</span></div>
<div style="position:absolute;left:242.25px;top:24.35px" class="cls_055"><span class="cls_055">Managing configuration</span></div>
<div style="position:absolute;left:106.54px;top:72.76px" class="cls_057"><span class="cls_057">Service A</span></div>
<div style="position:absolute;left:166.07px;top:97.00px" class="cls_057"><span class="cls_057">Configuration</span></div>
<div style="position:absolute;left:171.32px;top:105.40px" class="cls_057"><span class="cls_057">properties</span></div>
<div style="position:absolute;left:328.13px;top:105.98px" class="cls_057"><span class="cls_057">Configuration</span></div>
<div style="position:absolute;left:333.39px;top:114.38px" class="cls_057"><span class="cls_057">properties</span></div>
<div style="position:absolute;left:166.07px;top:131.05px" class="cls_057"><span class="cls_057">Configuration</span></div>
<div style="position:absolute;left:106.17px;top:134.17px" class="cls_057"><span class="cls_057">Service B</span></div>
<div style="position:absolute;left:404.54px;top:134.98px" class="cls_057"><span class="cls_057">and/or</span></div>
<div style="position:absolute;left:171.32px;top:139.46px" class="cls_057"><span class="cls_057">properties</span></div>
<div style="position:absolute;left:247.55px;top:146.49px" class="cls_057"><span class="cls_057">Spring Cloud</span></div>
<div style="position:absolute;left:246.38px;top:155.49px" class="cls_057"><span class="cls_057">Config Server</span></div>
<div style="position:absolute;left:337.09px;top:158.24px" class="cls_057"><span class="cls_057">Secrets</span></div>
<div style="position:absolute;left:166.07px;top:165.69px" class="cls_057"><span class="cls_057">Configuration</span></div>
<div style="position:absolute;left:171.32px;top:174.09px" class="cls_057"><span class="cls_057">properties</span></div>
<div style="position:absolute;left:105.98px;top:195.59px" class="cls_057"><span class="cls_057">Service C</span></div>
<div style="position:absolute;left:93.18px;top:230.90px" class="cls_053"><span class="cls_053">Figure 14.1</span></div>
<div style="position:absolute;left:142.61px;top:230.90px" class="cls_053"><span class="cls_053">Spring Cloud Config Server serves configuration properties from a backing Git</span></div>
<div style="position:absolute;left:93.18px;top:240.92px" class="cls_053"><span class="cls_053">repository or Vault secret store to other services.</span></div>
<div style="position:absolute;left:93.18px;top:269.66px" class="cls_039"><span class="cls_039">source code. But by keeping the configuration separate from the applications that</span></div>
<div style="position:absolute;left:93.18px;top:282.68px" class="cls_039"><span class="cls_039">consume it, it can evolve and be versioned independently of those applications.</span></div>
<div style="position:absolute;left:107.87px;top:295.67px" class="cls_039"><span class="cls_039">You probably also noticed that HashiCorp Vault is included in figure 14.1. Vault is</span></div>
<div style="position:absolute;left:93.18px;top:308.66px" class="cls_039"><span class="cls_039">especially useful when the configuration properties you wish to serve are to be kept</span></div>
<div style="position:absolute;left:93.18px;top:321.68px" class="cls_039"><span class="cls_039">completely secret and locked away until they’re needed. We’ll talk more about using</span></div>
<div style="position:absolute;left:93.18px;top:334.67px" class="cls_039"><span class="cls_039">Vault with Config Server in section 14.5.</span></div>
<div style="position:absolute;left:57.18px;top:356.48px" class="cls_063"><span class="cls_063">14.2.1</span></div>
<div style="position:absolute;left:93.18px;top:356.48px" class="cls_063"><span class="cls_063">Enabling Config Server</span></div>
<div style="position:absolute;left:93.18px;top:373.67px" class="cls_039"><span class="cls_039">As another microservice within a greater application system, Config Server is devel-</span></div>
<div style="position:absolute;left:93.18px;top:386.66px" class="cls_039"><span class="cls_039">oped and deployed as a distinct application. Therefore, you’ll need to create a brand</span></div>
<div style="position:absolute;left:93.18px;top:399.68px" class="cls_039"><span class="cls_039">new project for Config Server. The easiest way to do this is with the Spring Initializr or</span></div>
<div style="position:absolute;left:93.18px;top:412.67px" class="cls_039"><span class="cls_039">one of its clients (such as the New Spring Starter Project wizard in Spring Tool Suite).</span></div>
<div style="position:absolute;left:105.18px;top:446.51px" class="cls_075"><span class="cls_075">Configuration: the overloaded term</span></div>
<div style="position:absolute;left:105.18px;top:460.34px" class="cls_076"><span class="cls_076">When talking about Spring Cloud Config Server, the term “configuration” gets thrown</span></div>
<div style="position:absolute;left:105.18px;top:471.35px" class="cls_076"><span class="cls_076">about a lot, and it isn’t always referring to the same thing. There are configuration</span></div>
<div style="position:absolute;left:105.18px;top:482.36px" class="cls_076"><span class="cls_076">properties that you’ll write to configure the Config Server itself. There are also config-</span></div>
<div style="position:absolute;left:105.18px;top:493.34px" class="cls_076"><span class="cls_076">uration properties that the Config Server will serve to your applications. And the Con-</span></div>
<div style="position:absolute;left:105.18px;top:504.35px" class="cls_076"><span class="cls_076">fig Server itself has the word “Config” in its name, adding slightly to the confusion.</span></div>
<div style="position:absolute;left:105.18px;top:522.35px" class="cls_076"><span class="cls_076">I’ll do my best to make it clear which configuration I’m referring to whenever I use the</span></div>
<div style="position:absolute;left:105.18px;top:533.36px" class="cls_076"><span class="cls_076">word “configuration,” and I’ll always refer to the Config Server with the shortened</span></div>
<div style="position:absolute;left:105.18px;top:544.34px" class="cls_076"><span class="cls_076">word “Config.”</span></div>
<div style="position:absolute;left:93.18px;top:578.69px" class="cls_039"><span class="cls_039">I’m inclined to name the new project “config-server”, but you’re welcome to name it</span></div>
<div style="position:absolute;left:93.18px;top:591.68px" class="cls_039"><span class="cls_039">however you wish. The most important thing to do is to specify the Config Server</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:244032px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background369.jpg" width="531" height="666"></div>
<div style="position:absolute;left:229.74px;top:24.35px" class="cls_055"><span class="cls_055">Running Config Server</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">347</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">dependency by checking the Config Server check box. This will result in the following</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">dependency being added to the produced project’s pom.xml file:</span></div>
<div style="position:absolute;left:102.18px;top:85.34px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:111.78px;top:95.33px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:111.78px;top:105.32px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-cloud-config-server&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:102.18px;top:115.34px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:102.18px;top:138.65px" class="cls_039"><span class="cls_039">The Config Server version is ultimately determined by the Spring Cloud release train</span></div>
<div style="position:absolute;left:102.18px;top:151.67px" class="cls_039"><span class="cls_039">that’s chosen. It’s the version of the Spring Cloud release train that must be config-</span></div>
<div style="position:absolute;left:102.18px;top:164.66px" class="cls_039"><span class="cls_039">ured in the pom.xml file. At the time I’m writing this, the latest Spring Cloud release</span></div>
<div style="position:absolute;left:102.18px;top:177.65px" class="cls_039"><span class="cls_039">train version is Finchley.SR1. As a result, you’ll also find the following property and</span></div>
<div style="position:absolute;left:102.18px;top:190.67px" class="cls_059"><span class="cls_059">&lt;dependencyManagement&gt;</span><span class="cls_039"> block in the pom.xml file:</span></div>
<div style="position:absolute;left:102.18px;top:212.33px" class="cls_060"><span class="cls_060">&lt;properties&gt;</span></div>
<div style="position:absolute;left:111.78px;top:232.34px" class="cls_060"><span class="cls_060">&lt;spring-cloud.version&gt;Finchley.SR1&lt;/spring-cloud.version&gt;</span></div>
<div style="position:absolute;left:102.18px;top:242.33px" class="cls_060"><span class="cls_060">&lt;/properties&gt;</span></div>
<div style="position:absolute;left:102.18px;top:282.35px" class="cls_060"><span class="cls_060">&lt;dependencyManagement&gt;</span></div>
<div style="position:absolute;left:111.78px;top:292.34px" class="cls_060"><span class="cls_060">&lt;dependencies&gt;</span></div>
<div style="position:absolute;left:121.38px;top:302.33px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:130.95px;top:312.35px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:130.95px;top:322.34px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:130.95px;top:332.33px" class="cls_060"><span class="cls_060">&lt;version&gt;${spring-cloud.version}&lt;/version&gt;</span></div>
<div style="position:absolute;left:130.95px;top:342.35px" class="cls_060"><span class="cls_060">&lt;type&gt;pom&lt;/type&gt;</span></div>
<div style="position:absolute;left:130.95px;top:352.34px" class="cls_060"><span class="cls_060">&lt;scope&gt;import&lt;/scope&gt;</span></div>
<div style="position:absolute;left:121.38px;top:362.33px" class="cls_060"><span class="cls_060">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:111.78px;top:372.35px" class="cls_060"><span class="cls_060">&lt;/dependencies&gt;</span></div>
<div style="position:absolute;left:102.18px;top:382.34px" class="cls_061"><span class="cls_061">&lt;/dependencyManagement&gt;</span></div>
<div style="position:absolute;left:102.18px;top:405.68px" class="cls_039"><span class="cls_039">Although the Config Server dependency adds Spring Cloud to the project’s classpath,</span></div>
<div style="position:absolute;left:102.18px;top:418.67px" class="cls_039"><span class="cls_039">there’s no autoconfiguration to enable it, so you’ll need to annotate a configuration</span></div>
<div style="position:absolute;left:102.18px;top:431.66px" class="cls_039"><span class="cls_039">class with </span><span class="cls_059">@EnableConfigServer</span><span class="cls_039">. This annotation, as its name implies, enables a Con-</span></div>
<div style="position:absolute;left:102.18px;top:444.68px" class="cls_039"><span class="cls_039">fig Server when the application is running. I usually just drop </span><span class="cls_059">@EnableConfigServer</span></div>
<div style="position:absolute;left:102.18px;top:457.67px" class="cls_039"><span class="cls_039">on the main class like so:</span></div>
<div style="position:absolute;left:102.18px;top:479.36px" class="cls_060"><span class="cls_060">@EnableConfigServer</span></div>
<div style="position:absolute;left:102.18px;top:489.35px" class="cls_060"><span class="cls_060">@SpringBootApplication</span></div>
<div style="position:absolute;left:102.18px;top:499.34px" class="cls_060"><span class="cls_060">public class ConfigServerApplication {</span></div>
<div style="position:absolute;left:111.78px;top:509.36px" class="cls_060"><span class="cls_060">public static void main(String[] args) {</span></div>
<div style="position:absolute;left:121.38px;top:519.35px" class="cls_060"><span class="cls_060">SpringApplication.run(ConfigServerApplication.class, args);</span></div>
<div style="position:absolute;left:111.78px;top:529.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:539.36px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:562.67px" class="cls_039"><span class="cls_039">There’s only one more thing that must be done before you can fire up the application</span></div>
<div style="position:absolute;left:102.18px;top:575.69px" class="cls_039"><span class="cls_039">and see the Config Server at work: you must tell it where the configuration properties</span></div>
<div style="position:absolute;left:102.18px;top:588.68px" class="cls_039"><span class="cls_039">that it’s to serve can be found. To start, you’ll use configuration that’s served from a</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:244708px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background370.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">348</span></div>
<div style="position:absolute;left:193.29px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 14</span></div>
<div style="position:absolute;left:242.25px;top:24.35px" class="cls_055"><span class="cls_055">Managing configuration</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">Git repository, so you’ll need to set the </span><span class="cls_059">spring.cloud.config.server.git.uri</span><span class="cls_039"> prop-</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">erty with the URL of the configuration repository:</span></div>
<div style="position:absolute;left:93.18px;top:85.34px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:102.78px;top:95.33px" class="cls_060"><span class="cls_060">cloud:</span></div>
<div style="position:absolute;left:112.38px;top:105.32px" class="cls_060"><span class="cls_060">config:</span></div>
<div style="position:absolute;left:121.95px;top:115.34px" class="cls_060"><span class="cls_060">server:</span></div>
<div style="position:absolute;left:131.55px;top:125.33px" class="cls_060"><span class="cls_060">git:</span></div>
<div style="position:absolute;left:141.15px;top:135.35px" class="cls_061"><span class="cls_061">uri: </span><a href="https://github.com/tacocloud/tacocloud-config/">https://github.com/tacocloud/tacocloud-config</a> </div>
<div style="position:absolute;left:93.18px;top:158.66px" class="cls_039"><span class="cls_039">You’ll see how to populate the Git repository with properties in section 14.2.2.</span></div>
<div style="position:absolute;left:107.56px;top:171.65px" class="cls_039"><span class="cls_039">First, though, there’s one other property you may wish to set for local development</span></div>
<div style="position:absolute;left:93.18px;top:184.67px" class="cls_039"><span class="cls_039">purposes. When testing your services locally, you’ll end up having several services all</span></div>
<div style="position:absolute;left:93.18px;top:197.66px" class="cls_039"><span class="cls_039">running and listening on different ports on localhost. As a typical Spring Boot web</span></div>
<div style="position:absolute;left:93.18px;top:210.65px" class="cls_039"><span class="cls_039">application, the Config Server will listen on port 8080 by default. To avoid port colli-</span></div>
<div style="position:absolute;left:93.18px;top:223.67px" class="cls_039"><span class="cls_039">sions, you’ll want to specify a unique port number by setting </span><span class="cls_059">server.port</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:245.33px" class="cls_060"><span class="cls_060">server:</span></div>
<div style="position:absolute;left:102.78px;top:255.35px" class="cls_061"><span class="cls_061">port: 8888</span></div>
<div style="position:absolute;left:93.18px;top:278.66px" class="cls_039"><span class="cls_039">Here you’ve set </span><span class="cls_059">server.port</span><span class="cls_039"> to 8888 because, as you’ll see in section 14.3, that’s the</span></div>
<div style="position:absolute;left:93.18px;top:291.65px" class="cls_039"><span class="cls_039">default port that the configuration clients will attempt to retrieve configuration from.</span></div>
<div style="position:absolute;left:93.18px;top:304.67px" class="cls_039"><span class="cls_039">You’re welcome to set it to any value you wish, but you’ll need to be sure to configure</span></div>
<div style="position:absolute;left:93.18px;top:317.66px" class="cls_039"><span class="cls_039">the configuration client services to match.</span></div>
<div style="position:absolute;left:108.42px;top:330.68px" class="cls_039"><span class="cls_039">It’s important to realize that the configuration you’ve written thus far in this sec-</span></div>
<div style="position:absolute;left:93.18px;top:343.67px" class="cls_039"><span class="cls_039">tion is configuration for the Config Server itself. It’s not the same configuration that</span></div>
<div style="position:absolute;left:93.18px;top:356.66px" class="cls_039"><span class="cls_039">will be served by the Config Server. Config Server will serve configuration that it pulls</span></div>
<div style="position:absolute;left:93.18px;top:369.68px" class="cls_039"><span class="cls_039">from Git or Vault.</span></div>
<div style="position:absolute;left:108.27px;top:382.67px" class="cls_039"><span class="cls_039">At this point, if you start the application, you’ll have a Config Server listening for</span></div>
<div style="position:absolute;left:93.18px;top:395.66px" class="cls_039"><span class="cls_039">requests on port 8888, but it will be serving absolutely no configuration properties.</span></div>
<div style="position:absolute;left:93.18px;top:408.68px" class="cls_039"><span class="cls_039">You don’t have any Config Server clients yet, but you can pretend to be one by using</span></div>
<div style="position:absolute;left:93.18px;top:421.67px" class="cls_039"><span class="cls_039">the curl command-line client (or an equivalent HTTP client of your choosing):</span></div>
<div style="position:absolute;left:93.18px;top:443.36px" class="cls_060"><span class="cls_060">$ curl localhost:8888/application/default</span></div>
<div style="position:absolute;left:93.18px;top:453.35px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:102.78px;top:463.34px" class="cls_060"><span class="cls_060">"name": "application",</span></div>
<div style="position:absolute;left:102.78px;top:473.36px" class="cls_060"><span class="cls_060">"profiles": [</span></div>
<div style="position:absolute;left:112.38px;top:483.35px" class="cls_060"><span class="cls_060">"default"</span></div>
<div style="position:absolute;left:102.78px;top:493.34px" class="cls_060"><span class="cls_060">],</span></div>
<div style="position:absolute;left:102.78px;top:503.36px" class="cls_060"><span class="cls_060">"label": null,</span></div>
<div style="position:absolute;left:102.78px;top:513.35px" class="cls_060"><span class="cls_060">"version": "ca791b15df07ce41d30c24937eece4ec4b208f4d",</span></div>
<div style="position:absolute;left:102.78px;top:523.34px" class="cls_060"><span class="cls_060">"state": null,</span></div>
<div style="position:absolute;left:102.78px;top:533.36px" class="cls_060"><span class="cls_060">"propertySources": []</span></div>
<div style="position:absolute;left:93.18px;top:543.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:566.69px" class="cls_039"><span class="cls_039">The request made here is an HTTP </span><span class="cls_059">GET</span><span class="cls_039"> request for the path /application/default</span></div>
<div style="position:absolute;left:93.18px;top:579.68px" class="cls_039"><span class="cls_039">on the Config Server. This path is made up of two or three parts, as illustrated in fig-</span></div>
<div style="position:absolute;left:93.18px;top:592.67px" class="cls_039"><span class="cls_039">ure 14.2.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:245384px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background371.jpg" width="531" height="666"></div>
<div style="position:absolute;left:229.74px;top:24.35px" class="cls_055"><span class="cls_055">Running Config Server</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">349</span></div>
<div style="position:absolute;left:126.91px;top:53.02px" class="cls_088"><span class="cls_088">Config server</span></div>
<div style="position:absolute;left:118.54px;top:61.42px" class="cls_088"><span class="cls_088">hostname and port</span></div>
<div style="position:absolute;left:229.44px;top:61.42px" class="cls_088"><span class="cls_088">Active Spring profile</span></div>
<div style="position:absolute;left:102.38px;top:89.91px" class="cls_082"><span class="cls_082"> </span><a href="http://localhost:8888/application/default/master/">http://localhost:8888/application/default/master</a> </div>
<div style="position:absolute;left:335.22px;top:107.63px" class="cls_053"><span class="cls_053">Figure 14.2</span></div>
<div style="position:absolute;left:383.82px;top:107.63px" class="cls_053"><span class="cls_053">Config Server exposes a</span></div>
<div style="position:absolute;left:180.11px;top:118.29px" class="cls_088"><span class="cls_088">Application name</span></div>
<div style="position:absolute;left:276.45px;top:117.62px" class="cls_088"><span class="cls_088">Git label/branch</span><span class="cls_053">   REST API through which configuration</span></div>
<div style="position:absolute;left:156.32px;top:126.69px" class="cls_088"><span class="cls_088">(</span><span class="cls_082">spring.application.name</span><span class="cls_088">)</span></div>
<div style="position:absolute;left:286.37px;top:126.69px" class="cls_088"><span class="cls_088">(optional)</span></div>
<div style="position:absolute;left:335.22px;top:127.61px" class="cls_053"><span class="cls_053">properties can be consumed.</span></div>
<div style="position:absolute;left:102.18px;top:158.24px" class="cls_039"><span class="cls_039">The first part of the path, “application”, is the name of the application making the</span></div>
<div style="position:absolute;left:102.18px;top:171.23px" class="cls_039"><span class="cls_039">request. You’ll see later in section 14.4.1 how Config Server can use this part of the</span></div>
<div style="position:absolute;left:102.18px;top:184.22px" class="cls_039"><span class="cls_039">request path to serve application-specific configuration. For now you don’t have any</span></div>
<div style="position:absolute;left:102.18px;top:197.24px" class="cls_039"><span class="cls_039">application-specific configuration, so any value will do.</span></div>
<div style="position:absolute;left:117.34px;top:210.23px" class="cls_039"><span class="cls_039">The second part in the path is the name of the Spring profile that’s active in the</span></div>
<div style="position:absolute;left:102.18px;top:223.22px" class="cls_039"><span class="cls_039">application making the request. In section 14.4.2 we’ll look at how Config Server can</span></div>
<div style="position:absolute;left:102.18px;top:236.24px" class="cls_039"><span class="cls_039">use this profile in the request path to serve configuration that’s specific to an active</span></div>
<div style="position:absolute;left:102.18px;top:249.23px" class="cls_039"><span class="cls_039">profile. You don’t yet have any profile-specific configuration, so any profile name will</span></div>
<div style="position:absolute;left:102.18px;top:262.25px" class="cls_039"><span class="cls_039">work for now.</span></div>
<div style="position:absolute;left:117.37px;top:275.24px" class="cls_039"><span class="cls_039">The third part of the path, which is optional, specifies the label or branch in the</span></div>
<div style="position:absolute;left:102.18px;top:288.23px" class="cls_039"><span class="cls_039">backend Git repository from which to pull configuration. If not specified, this defaults</span></div>
<div style="position:absolute;left:102.18px;top:301.25px" class="cls_039"><span class="cls_039">to the “master” branch.</span></div>
<div style="position:absolute;left:116.67px;top:314.24px" class="cls_039"><span class="cls_039">The response gives us some basic information about what the Config Server is serv-</span></div>
<div style="position:absolute;left:102.18px;top:327.23px" class="cls_039"><span class="cls_039">ing, including the version and label of the Git commit that it’s serving configuration</span></div>
<div style="position:absolute;left:102.18px;top:340.25px" class="cls_039"><span class="cls_039">from. What are clearly missing, however, are any actual configuration properties. Nor-</span></div>
<div style="position:absolute;left:102.18px;top:353.24px" class="cls_039"><span class="cls_039">mally you’d see them in the </span><span class="cls_059">propertySources</span><span class="cls_039"> property, but it’s empty in this</span></div>
<div style="position:absolute;left:102.18px;top:366.23px" class="cls_039"><span class="cls_039">response. That’s because you still need to populate the Git repository with properties</span></div>
<div style="position:absolute;left:102.18px;top:379.25px" class="cls_039"><span class="cls_039">for the Config Server to serve. Let’s take care of that now.</span></div>
<div style="position:absolute;left:66.18px;top:404.06px" class="cls_063"><span class="cls_063">14.2.2</span></div>
<div style="position:absolute;left:102.18px;top:404.06px" class="cls_063"><span class="cls_063">Populating the configuration repository</span></div>
<div style="position:absolute;left:102.18px;top:421.25px" class="cls_039"><span class="cls_039">There are several ways to set up properties for the Config Server to serve. The most</span></div>
<div style="position:absolute;left:102.18px;top:434.24px" class="cls_039"><span class="cls_039">basic, straightforward option is to commit an application.properties or applica-</span></div>
<div style="position:absolute;left:102.18px;top:447.23px" class="cls_039"><span class="cls_039">tion.yml file to the root path of the Git repository.</span></div>
<div style="position:absolute;left:116.77px;top:460.25px" class="cls_039"><span class="cls_039">Let’s say you’ve pushed a file named application.yml to the Git repository config-</span></div>
<div style="position:absolute;left:102.18px;top:473.24px" class="cls_039"><span class="cls_039">ured in the previous section. This configuration file isn’t the same as the one you</span></div>
<div style="position:absolute;left:102.18px;top:486.23px" class="cls_039"><span class="cls_039">configured in the previous section; it’s the configuration that will be served by the</span></div>
<div style="position:absolute;left:102.18px;top:499.25px" class="cls_039"><span class="cls_039">Config Server. Suppose that in that application.yml file you’ve configured the fol-</span></div>
<div style="position:absolute;left:102.18px;top:512.24px" class="cls_039"><span class="cls_039">lowing properties:</span></div>
<div style="position:absolute;left:102.18px;top:533.93px" class="cls_060"><span class="cls_060">server:</span></div>
<div style="position:absolute;left:111.78px;top:543.92px" class="cls_060"><span class="cls_060">port: 0</span></div>
<div style="position:absolute;left:102.18px;top:563.93px" class="cls_060"><span class="cls_060">eureka:</span></div>
<div style="position:absolute;left:106.98px;top:573.92px" class="cls_060"><span class="cls_060">client:</span></div>
<div style="position:absolute;left:116.58px;top:583.91px" class="cls_060"><span class="cls_060">service-url:</span></div>
<div style="position:absolute;left:126.13px;top:593.93px" class="cls_061"><span class="cls_061">defaultZone: </span><a href="http://eureka1:8761/eureka/">http://eureka1:8761/eureka/</a> </div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:246060px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background372.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">350</span></div>
<div style="position:absolute;left:193.29px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 14</span></div>
<div style="position:absolute;left:242.25px;top:24.35px" class="cls_055"><span class="cls_055">Managing configuration</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">Although there isn’t much in this application.yml, what it does configure is rather sig-</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">nificant. It tells every service in the application to choose a randomly available port</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">and where it can register with Eureka. That means that when you adapt the services</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">into Config Server clients in section 14.3, you’ll be able to remove explicit Eureka con-</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">figuration from the services.</span></div>
<div style="position:absolute;left:107.61px;top:115.67px" class="cls_039"><span class="cls_039">Acting as a client of the Config Server, you can use curl at the command line to see</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">this new configuration data served from the Config Server:</span></div>
<div style="position:absolute;left:93.18px;top:151.34px" class="cls_060"><span class="cls_060">$ curl localhost:8888/someapp/someconfig</span></div>
<div style="position:absolute;left:93.18px;top:161.33px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:102.78px;top:171.35px" class="cls_060"><span class="cls_060">"name": "someapp",</span></div>
<div style="position:absolute;left:102.78px;top:181.34px" class="cls_060"><span class="cls_060">"profiles": [</span></div>
<div style="position:absolute;left:112.38px;top:191.33px" class="cls_060"><span class="cls_060">"someconfig"</span></div>
<div style="position:absolute;left:102.78px;top:201.35px" class="cls_060"><span class="cls_060">],</span></div>
<div style="position:absolute;left:102.78px;top:211.34px" class="cls_060"><span class="cls_060">"label": null,</span></div>
<div style="position:absolute;left:102.78px;top:221.33px" class="cls_060"><span class="cls_060">"version": "95df0cbc3bca106199bd804b27a1de7c3ef5c35e",</span></div>
<div style="position:absolute;left:102.78px;top:231.35px" class="cls_060"><span class="cls_060">"state": null,</span></div>
<div style="position:absolute;left:102.78px;top:241.34px" class="cls_060"><span class="cls_060">"propertySources": [</span></div>
<div style="position:absolute;left:112.38px;top:251.33px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:121.95px;top:261.35px" class="cls_060"><span class="cls_060">"name": "</span><a href="http://localhost:10080/habuma/tacocloud-/">http://localhost:10080/habuma/tacocloud-</a> </div>
<div style="position:absolute;left:117.18px;top:271.34px" class="cls_060"><span class="cls_060">config/application.yml",</span></div>
<div style="position:absolute;left:121.95px;top:281.33px" class="cls_060"><span class="cls_060">"source": {</span></div>
<div style="position:absolute;left:131.55px;top:291.35px" class="cls_060"><span class="cls_060">"server.port": 0,</span></div>
<div style="position:absolute;left:131.55px;top:301.34px" class="cls_060"><span class="cls_060">"eureka.client.service-url.defaultZone":</span></div>
<div style="position:absolute;left:117.18px;top:311.33px" class="cls_060"><span class="cls_060">"</span><a href="http://eureka1:8761/eureka/" "="">http://eureka1:8761/eureka/"</a> </div>
<div style="position:absolute;left:121.95px;top:321.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:112.38px;top:331.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.78px;top:341.33px" class="cls_060"><span class="cls_060">]</span></div>
<div style="position:absolute;left:93.18px;top:351.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:374.66px" class="cls_039"><span class="cls_039">Unlike your earlier request to the Config Server, this response has stuff in the </span><span class="cls_059">property-</span></div>
<div style="position:absolute;left:93.33px;top:387.68px" class="cls_059"><span class="cls_059">Sources</span><span class="cls_039"> array. Specifically, it contains a property source whose </span><span class="cls_059">name</span><span class="cls_039"> property refer-</span></div>
<div style="position:absolute;left:93.18px;top:400.67px" class="cls_039"><span class="cls_039">ences the Git repository and whose </span><span class="cls_059">source</span><span class="cls_039"> contains the properties you’ve pushed into</span></div>
<div style="position:absolute;left:93.18px;top:413.66px" class="cls_039"><span class="cls_039">the Git repository.</span></div>
<div style="position:absolute;left:93.18px;top:431.84px" class="cls_064"><span class="cls_064">S</span><span class="cls_065">ERVING</span><span class="cls_064"> </span><span class="cls_065">CONFIGURATION</span><span class="cls_064"> </span><span class="cls_065">FROM</span><span class="cls_064"> G</span><span class="cls_065">IT</span><span class="cls_064"> </span><span class="cls_065">SUBPATHS</span></div>
<div style="position:absolute;left:93.18px;top:444.17px" class="cls_039"><span class="cls_039">If it suits your organizational style, you may choose to store configuration in the Git</span></div>
<div style="position:absolute;left:93.18px;top:457.16px" class="cls_039"><span class="cls_039">repository in a subpath instead of at the root. For example, suppose you want to put</span></div>
<div style="position:absolute;left:93.18px;top:470.18px" class="cls_039"><span class="cls_039">the configuration in a subdirectory named “config” relative to the root of the Git</span></div>
<div style="position:absolute;left:93.18px;top:483.17px" class="cls_039"><span class="cls_039">repository. If so, setting </span><span class="cls_059">spring.cloud.config.server.git.search-paths</span><span class="cls_039"> as fol-</span></div>
<div style="position:absolute;left:93.18px;top:496.16px" class="cls_039"><span class="cls_039">lows will tell the Config Server to serve configuration from /config instead of from</span></div>
<div style="position:absolute;left:93.18px;top:509.18px" class="cls_039"><span class="cls_039">the root:</span></div>
<div style="position:absolute;left:102.78px;top:531.86px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:112.38px;top:541.85px" class="cls_060"><span class="cls_060">cloud:</span></div>
<div style="position:absolute;left:121.95px;top:551.84px" class="cls_060"><span class="cls_060">config:</span></div>
<div style="position:absolute;left:131.55px;top:561.86px" class="cls_060"><span class="cls_060">server:</span></div>
<div style="position:absolute;left:141.15px;top:571.85px" class="cls_060"><span class="cls_060">git:</span></div>
<div style="position:absolute;left:150.72px;top:581.84px" class="cls_060"><span class="cls_060">uri: </span><a href="http://localhost:10080/tacocloud/tacocloud-config/">http://localhost:10080/tacocloud/tacocloud-config</a> </div>
<div style="position:absolute;left:150.76px;top:591.86px" class="cls_061"><span class="cls_061">search-paths: config</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:246736px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background373.jpg" width="531" height="666"></div>
<div style="position:absolute;left:229.74px;top:24.35px" class="cls_055"><span class="cls_055">Running Config Server</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">351</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">Notice that the </span><span class="cls_059">spring.cloud.config.server.git.search-paths</span><span class="cls_039"> property is plural.</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">That means you can have Config Server serve from multiple paths by listing them, sep-</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">arated by commas:</span></div>
<div style="position:absolute;left:111.78px;top:99.32px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:121.38px;top:109.34px" class="cls_060"><span class="cls_060">cloud:</span></div>
<div style="position:absolute;left:130.95px;top:119.33px" class="cls_060"><span class="cls_060">config:</span></div>
<div style="position:absolute;left:140.55px;top:129.35px" class="cls_060"><span class="cls_060">server:</span></div>
<div style="position:absolute;left:150.15px;top:139.34px" class="cls_060"><span class="cls_060">git:</span></div>
<div style="position:absolute;left:159.76px;top:149.33px" class="cls_060"><span class="cls_060">uri: </span><a href="http://localhost:10080/tacocloud/tacocloud-config/">http://localhost:10080/tacocloud/tacocloud-config</a> </div>
<div style="position:absolute;left:159.76px;top:159.35px" class="cls_061"><span class="cls_061">search-paths: config,moreConfig</span></div>
<div style="position:absolute;left:102.18px;top:183.65px" class="cls_039"><span class="cls_039">This sets up Config Server to serve configuration from both the /config and /more-</span></div>
<div style="position:absolute;left:102.18px;top:196.67px" class="cls_039"><span class="cls_039">Config paths in the Git repository.</span></div>
<div style="position:absolute;left:116.77px;top:209.66px" class="cls_039"><span class="cls_039">You may also use wildcards when specifying search paths:</span></div>
<div style="position:absolute;left:111.78px;top:232.34px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:121.38px;top:242.33px" class="cls_060"><span class="cls_060">cloud:</span></div>
<div style="position:absolute;left:130.95px;top:252.35px" class="cls_060"><span class="cls_060">config:</span></div>
<div style="position:absolute;left:140.55px;top:262.34px" class="cls_060"><span class="cls_060">server:</span></div>
<div style="position:absolute;left:150.15px;top:272.33px" class="cls_060"><span class="cls_060">git:</span></div>
<div style="position:absolute;left:159.76px;top:282.35px" class="cls_060"><span class="cls_060">uri: </span><a href="http://localhost:10080/tacocloud/tacocloud-config/">http://localhost:10080/tacocloud/tacocloud-config</a> </div>
<div style="position:absolute;left:159.76px;top:292.34px" class="cls_061"><span class="cls_061">search-paths: config,more*</span></div>
<div style="position:absolute;left:102.18px;top:316.67px" class="cls_039"><span class="cls_039">Here, Config Server will serve configuration from /config as well as any subdirectory</span></div>
<div style="position:absolute;left:102.18px;top:329.66px" class="cls_039"><span class="cls_039">whose name begins with “more.”</span></div>
<div style="position:absolute;left:102.18px;top:347.84px" class="cls_064"><span class="cls_064">S</span><span class="cls_065">ERVING</span><span class="cls_064"> </span><span class="cls_065">CONFIGURATION</span><span class="cls_064"> </span><span class="cls_065">FROM</span><span class="cls_064"> </span><span class="cls_065">A</span><span class="cls_064"> </span><span class="cls_065">BRANCH</span><span class="cls_064"> </span><span class="cls_065">OR</span><span class="cls_064"> </span><span class="cls_065">LABEL</span></div>
<div style="position:absolute;left:102.18px;top:360.17px" class="cls_039"><span class="cls_039">By default, Config Server serves configuration from the master branch in Git. From</span></div>
<div style="position:absolute;left:102.18px;top:373.16px" class="cls_039"><span class="cls_039">the client, a specific branch or label can be specified as a third member of the request</span></div>
<div style="position:absolute;left:102.18px;top:386.18px" class="cls_039"><span class="cls_039">path to Config Server, as you saw in figure 14.2. But you might find it useful to have</span></div>
<div style="position:absolute;left:102.18px;top:399.17px" class="cls_039"><span class="cls_039">Config Server default to a specific label or branch in Git instead of the master branch.</span></div>
<div style="position:absolute;left:102.18px;top:412.16px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">spring.cloud.config.server.git.default-label</span><span class="cls_039"> property overrides the default</span></div>
<div style="position:absolute;left:102.18px;top:425.18px" class="cls_039"><span class="cls_039">label or branch.</span></div>
<div style="position:absolute;left:117.92px;top:438.17px" class="cls_039"><span class="cls_039">For instance, consider the following configuration that sets up Config Server to</span></div>
<div style="position:absolute;left:102.18px;top:451.16px" class="cls_039"><span class="cls_039">serve configuration from a branch (or label) named “sidework”:</span></div>
<div style="position:absolute;left:102.18px;top:473.84px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:111.78px;top:483.86px" class="cls_060"><span class="cls_060">cloud:</span></div>
<div style="position:absolute;left:121.38px;top:493.85px" class="cls_060"><span class="cls_060">config:</span></div>
<div style="position:absolute;left:130.95px;top:503.84px" class="cls_060"><span class="cls_060">server:</span></div>
<div style="position:absolute;left:140.55px;top:513.86px" class="cls_060"><span class="cls_060">git:</span></div>
<div style="position:absolute;left:150.15px;top:523.85px" class="cls_060"><span class="cls_060">uri: </span><a href="http://localhost:10080/tacocloud/tacocloud-config/">http://localhost:10080/tacocloud/tacocloud-config</a> </div>
<div style="position:absolute;left:150.15px;top:533.84px" class="cls_061"><span class="cls_061">default-label: sidework</span></div>
<div style="position:absolute;left:102.18px;top:558.17px" class="cls_039"><span class="cls_039">As configured here, configuration will be served from the “sidework” branch unless</span></div>
<div style="position:absolute;left:102.18px;top:571.19px" class="cls_039"><span class="cls_039">otherwise specified by the Config Server client requesting configuration.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:247412px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background374.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">352</span></div>
<div style="position:absolute;left:193.29px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 14</span></div>
<div style="position:absolute;left:242.25px;top:24.35px" class="cls_055"><span class="cls_055">Managing configuration</span></div>
<div style="position:absolute;left:93.18px;top:50.84px" class="cls_064"><span class="cls_064">A</span><span class="cls_065">UTHENTICATING</span><span class="cls_064"> </span><span class="cls_065">WITH</span><span class="cls_064"> </span><span class="cls_065">THE</span><span class="cls_064"> G</span><span class="cls_065">IT</span><span class="cls_064"> </span><span class="cls_065">BACKEND</span></div>
<div style="position:absolute;left:93.18px;top:63.17px" class="cls_039"><span class="cls_039">It’s quite likely that the backend Git repository your Config Server retrieves configura-</span></div>
<div style="position:absolute;left:93.18px;top:76.16px" class="cls_039"><span class="cls_039">tion from will be secured behind a username and password. In that case, you’ll defi-</span></div>
<div style="position:absolute;left:93.18px;top:89.15px" class="cls_039"><span class="cls_039">nitely need to provide the Config Server with the credentials for your Git repository.</span></div>
<div style="position:absolute;left:110.34px;top:102.17px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">spring.cloud.config.server.username</span><span class="cls_039"> and </span><span class="cls_059">spring.cloud.config.server</span></div>
<div style="position:absolute;left:93.18px;top:115.16px" class="cls_059"><span class="cls_059">.password</span><span class="cls_039"> properties set the username and password for the backend repository. The</span></div>
<div style="position:absolute;left:93.18px;top:128.15px" class="cls_039"><span class="cls_039">following Config Server configuration shows how you might set these properties:</span></div>
<div style="position:absolute;left:93.18px;top:147.83px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:102.78px;top:157.85px" class="cls_060"><span class="cls_060">cloud:</span></div>
<div style="position:absolute;left:112.38px;top:167.84px" class="cls_060"><span class="cls_060">config:</span></div>
<div style="position:absolute;left:121.95px;top:177.83px" class="cls_060"><span class="cls_060">server:</span></div>
<div style="position:absolute;left:131.55px;top:187.85px" class="cls_060"><span class="cls_060">git:</span></div>
<div style="position:absolute;left:141.15px;top:197.84px" class="cls_060"><span class="cls_060">uri: </span><a href="http://localhost:10080/tacocloud/tacocloud-config/">http://localhost:10080/tacocloud/tacocloud-config</a> </div>
<div style="position:absolute;left:141.15px;top:207.83px" class="cls_060"><span class="cls_060">username: tacocloud</span></div>
<div style="position:absolute;left:141.15px;top:217.85px" class="cls_061"><span class="cls_061">password: s3cr3tP455w0rd</span></div>
<div style="position:absolute;left:93.18px;top:240.17px" class="cls_039"><span class="cls_039">This sets the </span><span class="cls_059">username</span><span class="cls_039"> and </span><span class="cls_059">password</span><span class="cls_039"> to </span><span class="cls_059">tacocloud</span><span class="cls_039"> and </span><span class="cls_059">s3cr3tP455w0rd</span><span class="cls_039">, respectively.</span></div>
<div style="position:absolute;left:107.73px;top:253.16px" class="cls_039"><span class="cls_039">Using curl to pretend to be a Config Server client helps to give you some idea of how</span></div>
<div style="position:absolute;left:93.18px;top:266.15px" class="cls_039"><span class="cls_039">the Config Server works. And there’s a lot more that Config Server can do. But the micro-</span></div>
<div style="position:absolute;left:93.18px;top:279.17px" class="cls_039"><span class="cls_039">services you write won’t be using curl to fetch configuration data. So before we look at</span></div>
<div style="position:absolute;left:93.18px;top:292.16px" class="cls_039"><span class="cls_039">any more ways that Config Server can be used to serve configuration data, let’s shift our</span></div>
<div style="position:absolute;left:93.18px;top:305.18px" class="cls_039"><span class="cls_039">attention to the microservices and see how you can enable them as Config Server clients.</span></div>
<div style="position:absolute;left:57.18px;top:326.32px" class="cls_040"><span class="cls_040">14.3</span></div>
<div style="position:absolute;left:93.18px;top:326.32px" class="cls_040"><span class="cls_040">Consuming shared configuration</span></div>
<div style="position:absolute;left:93.18px;top:344.18px" class="cls_039"><span class="cls_039">In addition to offering a centralized configuration server, Spring Cloud Config Server</span></div>
<div style="position:absolute;left:93.18px;top:357.17px" class="cls_039"><span class="cls_039">also provides a client library that, when included in a Spring Boot application’s build,</span></div>
<div style="position:absolute;left:93.18px;top:370.16px" class="cls_039"><span class="cls_039">enables that application as a client of the Config Server.</span></div>
<div style="position:absolute;left:107.59px;top:383.18px" class="cls_039"><span class="cls_039">The easiest way to turn any Spring Boot application into a Config Server client is to</span></div>
<div style="position:absolute;left:93.18px;top:396.17px" class="cls_039"><span class="cls_039">add the following dependency to the project’s Maven build:</span></div>
<div style="position:absolute;left:93.18px;top:415.85px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:425.84px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:435.86px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:93.18px;top:445.85px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:93.18px;top:468.17px" class="cls_039"><span class="cls_039">This same dependency is also available in the Spring Initializr as the check box labeled</span></div>
<div style="position:absolute;left:93.18px;top:481.16px" class="cls_039"><span class="cls_039">Config Client.</span></div>
<div style="position:absolute;left:108.18px;top:494.18px" class="cls_039"><span class="cls_039">When the application is run, autoconfiguration will kick in to automatically regis-</span></div>
<div style="position:absolute;left:93.18px;top:507.17px" class="cls_039"><span class="cls_039">ter a property source that draws its properties from a Config Server. By default, it</span></div>
<div style="position:absolute;left:93.18px;top:520.16px" class="cls_039"><span class="cls_039">assumes that the Config Server is running on localhost and listening on port 8888.</span></div>
<div style="position:absolute;left:93.18px;top:533.18px" class="cls_039"><span class="cls_039">But if that’s not the case, you can configure the location of the Config Server by set-</span></div>
<div style="position:absolute;left:93.18px;top:546.17px" class="cls_039"><span class="cls_039">ting the </span><span class="cls_059">spring.cloud.config.uri</span><span class="cls_039"> property:</span></div>
<div style="position:absolute;left:93.18px;top:564.86px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:102.78px;top:574.85px" class="cls_060"><span class="cls_060">cloud:</span></div>
<div style="position:absolute;left:112.38px;top:584.84px" class="cls_060"><span class="cls_060">config:</span></div>
<div style="position:absolute;left:121.95px;top:594.86px" class="cls_061"><span class="cls_061">uri: </span><a href="http://config.tacocloud.com:8888/">http://config.tacocloud.com:8888</a> </div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:248088px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background375.jpg" width="531" height="666"></div>
<div style="position:absolute;left:180.39px;top:24.35px" class="cls_055"><span class="cls_055">Serving application- and profile-specific properties</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">353</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">Just to be clear, this property must be set local to the application that’s to become a cli-</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">ent of the Config Server, such as in the application.yml or application.properties file</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">that’s packaged and deployed with each microservice.</span></div>
<div style="position:absolute;left:116.96px;top:89.66px" class="cls_039"><span class="cls_039">Now that you have a centralized configuration server, almost all configuration will</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">be served from there, and each microservice won’t need to carry much of its own con-</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">figuration. Typically, you’ll only need to set </span><span class="cls_059">spring.cloud.config.uri</span><span class="cls_039"> to specify the</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">location of the configuration server and </span><span class="cls_059">spring.application.name</span><span class="cls_039"> to identify the</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">application to the configuration server.</span></div>
<div style="position:absolute;left:114.18px;top:174.47px" class="cls_075"><span class="cls_075">Which comes first: the Config Server or the Service Registry?</span></div>
<div style="position:absolute;left:114.18px;top:188.33px" class="cls_076"><span class="cls_076">You’re setting up your microservices to learn about the Eureka service registry from</span></div>
<div style="position:absolute;left:114.18px;top:199.34px" class="cls_076"><span class="cls_076">the Config Server. This is a common approach to avoid propagating service registry</span></div>
<div style="position:absolute;left:114.18px;top:210.35px" class="cls_076"><span class="cls_076">details across every single microservice in an application.</span></div>
<div style="position:absolute;left:114.18px;top:226.34px" class="cls_076"><span class="cls_076">Alternatively, it’s possible to have the Config Server register itself with Eureka and</span></div>
<div style="position:absolute;left:114.18px;top:237.35px" class="cls_076"><span class="cls_076">have each microservice discover the Config Server as it would any other service. If</span></div>
<div style="position:absolute;left:114.18px;top:248.33px" class="cls_076"><span class="cls_076">you prefer this model, you’ll need to configure the Config Server as a discovery client</span></div>
<div style="position:absolute;left:114.18px;top:259.34px" class="cls_076"><span class="cls_076">and set the </span><span class="cls_059">spring.cloud.config.discovery.enabled</span><span class="cls_076"> property to </span><span class="cls_059">true</span><span class="cls_076">. As a</span></div>
<div style="position:absolute;left:114.18px;top:270.35px" class="cls_076"><span class="cls_076">result, the Config Server will register itself in Eureka with the name “configserver.”</span></div>
<div style="position:absolute;left:114.18px;top:286.34px" class="cls_076"><span class="cls_076">The downside of this approach is that each service will need to make two calls at</span></div>
<div style="position:absolute;left:114.18px;top:297.35px" class="cls_076"><span class="cls_076">startup: one to Eureka to discover the Config Server, followed by one to Config Server</span></div>
<div style="position:absolute;left:114.18px;top:308.33px" class="cls_076"><span class="cls_076">to fetch configuration data.</span></div>
<div style="position:absolute;left:102.18px;top:342.68px" class="cls_039"><span class="cls_039">When the application starts up, the property source provided by the Config Server cli-</span></div>
<div style="position:absolute;left:102.18px;top:355.67px" class="cls_039"><span class="cls_039">ent will make a request to the Config Server. Whatever properties it receives will be</span></div>
<div style="position:absolute;left:102.18px;top:368.66px" class="cls_039"><span class="cls_039">made available in the application’s environment. What’s more, those properties will</span></div>
<div style="position:absolute;left:102.18px;top:381.68px" class="cls_039"><span class="cls_039">be effectively cached; they’ll be available even if the Config Server goes down. (We’ll</span></div>
<div style="position:absolute;left:102.18px;top:394.67px" class="cls_039"><span class="cls_039">look at a few ways to refresh properties when they change in section 14.6.)</span></div>
<div style="position:absolute;left:117.31px;top:407.66px" class="cls_039"><span class="cls_039">So far you’ve kept the configuration served by Config Server fairly simple, targeting</span></div>
<div style="position:absolute;left:102.18px;top:420.68px" class="cls_039"><span class="cls_039">all applications and any profile. But sometimes you’ll need to enable configuration that’s</span></div>
<div style="position:absolute;left:102.18px;top:433.67px" class="cls_039"><span class="cls_039">unique to a particular application or that should only be available when an application is</span></div>
<div style="position:absolute;left:102.18px;top:446.66px" class="cls_039"><span class="cls_039">running with a specific active profile. Let’s take another look at Config Server and see a</span></div>
<div style="position:absolute;left:102.18px;top:459.68px" class="cls_039"><span class="cls_039">few more ways to use it, including serving application- and profile-specific properties.</span></div>
<div style="position:absolute;left:66.18px;top:481.84px" class="cls_040"><span class="cls_040">14.4</span></div>
<div style="position:absolute;left:102.18px;top:481.84px" class="cls_040"><span class="cls_040">Serving application- and profile-specific properties</span></div>
<div style="position:absolute;left:102.18px;top:501.17px" class="cls_039"><span class="cls_039">As you’ll recall, when a Config Server client starts up, it makes a request to the Config</span></div>
<div style="position:absolute;left:102.18px;top:514.16px" class="cls_039"><span class="cls_039">Server with a request path that contains both the application name as well as the name</span></div>
<div style="position:absolute;left:102.18px;top:527.18px" class="cls_039"><span class="cls_039">of an active profile. When serving configuration data, Config Server will consider these</span></div>
<div style="position:absolute;left:102.18px;top:540.17px" class="cls_039"><span class="cls_039">values and return application-specific and profile-specific configuration to the client.</span></div>
<div style="position:absolute;left:116.91px;top:553.19px" class="cls_039"><span class="cls_039">From a client perspective, consuming application-specific and profile-specific con-</span></div>
<div style="position:absolute;left:102.18px;top:566.18px" class="cls_039"><span class="cls_039">figuration properties isn’t much different than if you weren’t using Config Server. An</span></div>
<div style="position:absolute;left:102.18px;top:579.17px" class="cls_039"><span class="cls_039">application’s name is specified by setting the </span><span class="cls_059">spring.application.name</span><span class="cls_039"> property</span></div>
<div style="position:absolute;left:102.18px;top:592.19px" class="cls_039"><span class="cls_039">(the same one used to identify the application to Eureka). And the active profile(s)</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:248764px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background376.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">354</span></div>
<div style="position:absolute;left:193.29px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 14</span></div>
<div style="position:absolute;left:242.25px;top:24.35px" class="cls_055"><span class="cls_055">Managing configuration</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">can be specified by setting the </span><span class="cls_059">spring.profiles.active</span><span class="cls_039"> property (often as an envi-</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">ronment variable named </span><span class="cls_059">SPRING_PROFILES_ACTIVE</span><span class="cls_039">).</span></div>
<div style="position:absolute;left:108.92px;top:76.67px" class="cls_039"><span class="cls_039">Similarly, there’s not much that needs to be done in the Config Server itself to</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">serve properties that target a specific application or profile. What does matter, how-</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">ever, is how those properties are stored in the backing Git repository.</span></div>
<div style="position:absolute;left:57.18px;top:124.49px" class="cls_063"><span class="cls_063">14.4.1</span></div>
<div style="position:absolute;left:93.18px;top:124.49px" class="cls_063"><span class="cls_063">Serving application-specific properties</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">As we’ve discussed, one of the benefits of using Config Server is that you’re able to</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_039"><span class="cls_039">share common configuration properties across all of the microservices in an applica-</span></div>
<div style="position:absolute;left:93.18px;top:167.66px" class="cls_039"><span class="cls_039">tion. That notwithstanding, there are often properties that are unique to one service</span></div>
<div style="position:absolute;left:93.18px;top:180.65px" class="cls_039"><span class="cls_039">and that need not (or should not) be shared across all services.</span></div>
<div style="position:absolute;left:108.80px;top:193.67px" class="cls_039"><span class="cls_039">Along with shared configuration, Config Server is able to manage configuration</span></div>
<div style="position:absolute;left:93.18px;top:206.66px" class="cls_039"><span class="cls_039">properties that are targeted to a specific application. The trick is to name the configu-</span></div>
<div style="position:absolute;left:93.18px;top:219.65px" class="cls_039"><span class="cls_039">ration file the same as the application’s </span><span class="cls_059">spring.application.name</span><span class="cls_039"> property.</span></div>
<div style="position:absolute;left:108.16px;top:232.67px" class="cls_039"><span class="cls_039">In the previous chapter, you used </span><span class="cls_059">spring.application.name</span><span class="cls_039"> to give your micros-</span></div>
<div style="position:absolute;left:93.18px;top:245.66px" class="cls_039"><span class="cls_039">ervices names that would be registered to Eureka. That same property is also used by a</span></div>
<div style="position:absolute;left:93.18px;top:258.65px" class="cls_039"><span class="cls_039">configuration client to identify itself to the Config Server, so that the Config Server</span></div>
<div style="position:absolute;left:93.18px;top:271.67px" class="cls_039"><span class="cls_039">can serve configuration specific to that application.</span></div>
<div style="position:absolute;left:107.75px;top:284.66px" class="cls_039"><span class="cls_039">For example, in the Taco Cloud application where you’ve broken your application</span></div>
<div style="position:absolute;left:93.18px;top:297.68px" class="cls_039"><span class="cls_039">down into a handful of microservices named ingredient-service, order-service, taco-</span></div>
<div style="position:absolute;left:93.18px;top:310.67px" class="cls_039"><span class="cls_039">service, and user-service, you would have specified those names in each of the service</span></div>
<div style="position:absolute;left:93.18px;top:323.66px" class="cls_039"><span class="cls_039">applications’ </span><span class="cls_059">spring.application.name</span><span class="cls_039"> properties. Then you could create individual</span></div>
<div style="position:absolute;left:93.18px;top:336.68px" class="cls_039"><span class="cls_039">configuration YAML files in the Config Server’s Git backend with filenames such as</span></div>
<div style="position:absolute;left:93.18px;top:349.67px" class="cls_039"><span class="cls_039">ingredient-service.yml, order-service.yml, taco-service.yml, and user-service.yml. The</span></div>
<div style="position:absolute;left:93.18px;top:362.66px" class="cls_039"><span class="cls_039">screenshot in figure 14.3 shows the files in the configuration repository as displayed in</span></div>
<div style="position:absolute;left:93.18px;top:375.68px" class="cls_039"><span class="cls_039">the Gogs web application.</span></div>
<div style="position:absolute;left:92.96px;top:495.79px" class="cls_081"><span class="cls_081">Common configuration</span></div>
<div style="position:absolute;left:103.68px;top:505.29px" class="cls_081"><span class="cls_081">(all applications)</span></div>
<div style="position:absolute;left:95.00px;top:548.65px" class="cls_081"><span class="cls_081">Application-specific</span></div>
<div style="position:absolute;left:105.52px;top:558.15px" class="cls_081"><span class="cls_081">configuration</span></div>
<div style="position:absolute;left:93.18px;top:584.12px" class="cls_053"><span class="cls_053">Figure 14.3</span></div>
<div style="position:absolute;left:142.62px;top:584.12px" class="cls_053"><span class="cls_053">Application-specific configuration files have names based on each application’s</span></div>
<div style="position:absolute;left:93.18px;top:593.81px" class="cls_087"><span class="cls_087">spring.application.name</span><span class="cls_053"> property.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:249440px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background377.jpg" width="531" height="666"></div>
<div style="position:absolute;left:180.39px;top:24.35px" class="cls_055"><span class="cls_055">Serving application- and profile-specific properties</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">355</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">No matter what an application is named, all applications will receive configuration</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">properties from the application.yml file. But each service application’s </span><span class="cls_059">spring</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_059"><span class="cls_059">.application.name</span><span class="cls_039"> property will be sent in the request to Config Server (in the first</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">part of the request path), and if there’s a matching configuration file, those proper-</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">ties will also be returned. In the event of duplicate property definitions between the</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">common properties in application.yml and those in an application-specific configura-</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">tion file, the application-specific properties will take precedence.</span></div>
<div style="position:absolute;left:118.03px;top:141.65px" class="cls_039"><span class="cls_039">It’s worth noting that although figure 14.3 shows YAML configuration files, the</span></div>
<div style="position:absolute;left:102.18px;top:154.67px" class="cls_039"><span class="cls_039">same behavior holds true if properties files are checked into the Git repository.</span></div>
<div style="position:absolute;left:66.18px;top:176.48px" class="cls_063"><span class="cls_063">14.4.2</span></div>
<div style="position:absolute;left:102.18px;top:176.48px" class="cls_063"><span class="cls_063">Serving properties from profiles</span></div>
<div style="position:absolute;left:102.18px;top:193.67px" class="cls_039"><span class="cls_039">You saw in chapter 5 how to take advantage of Spring profiles when writing configura-</span></div>
<div style="position:absolute;left:102.18px;top:206.66px" class="cls_039"><span class="cls_039">tion properties so that certain properties will only be applicable when a given profile</span></div>
<div style="position:absolute;left:102.18px;top:219.65px" class="cls_039"><span class="cls_039">is active. Spring Cloud Config Server supports profile-specific properties in exactly the</span></div>
<div style="position:absolute;left:102.18px;top:232.67px" class="cls_039"><span class="cls_039">same way that you’d use them in an individual Spring Boot application. This includes</span></div>
<div style="position:absolute;left:117.78px;top:249.65px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Providing profile-specific .properties or YAML files, such as configuration files</span></div>
<div style="position:absolute;left:129.78px;top:262.67px" class="cls_039"><span class="cls_039">named application-production.yml</span></div>
<div style="position:absolute;left:117.78px;top:276.65px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Including multiple profile configuration groups within a single YAML file, sepa-</span></div>
<div style="position:absolute;left:129.78px;top:289.67px" class="cls_039"><span class="cls_039">rated with </span><span class="cls_059">---</span><span class="cls_039"> and </span><span class="cls_059">spring.profiles</span></div>
<div style="position:absolute;left:102.18px;top:307.67px" class="cls_039"><span class="cls_039">For example, consider the Eureka configuration that you’re now sharing through the</span></div>
<div style="position:absolute;left:102.18px;top:320.66px" class="cls_039"><span class="cls_039">Config Server to all of your application’s microservices. As it stands, it only references</span></div>
<div style="position:absolute;left:102.18px;top:333.68px" class="cls_039"><span class="cls_039">a single Eureka development instance. That’s perfect for development environments.</span></div>
<div style="position:absolute;left:102.18px;top:346.67px" class="cls_039"><span class="cls_039">But if your services are running in production, you may want them to be configured</span></div>
<div style="position:absolute;left:102.18px;top:359.66px" class="cls_039"><span class="cls_039">with references to multiple Eureka nodes.</span></div>
<div style="position:absolute;left:117.17px;top:372.68px" class="cls_039"><span class="cls_039">What’s more, although you’ve set the </span><span class="cls_059">server.port</span><span class="cls_039"> property to </span><span class="cls_059">0</span><span class="cls_039"> in your develop-</span></div>
<div style="position:absolute;left:102.18px;top:385.67px" class="cls_039"><span class="cls_039">ment configuration, once the services go into production, they may each run in indi-</span></div>
<div style="position:absolute;left:102.18px;top:398.66px" class="cls_039"><span class="cls_039">vidual containers that map port 8080 to an external port, thus requiring that the</span></div>
<div style="position:absolute;left:102.18px;top:411.68px" class="cls_039"><span class="cls_039">applications all listen on port 8080.</span></div>
<div style="position:absolute;left:117.36px;top:424.67px" class="cls_039"><span class="cls_039">With profiles, you can declare multiple configurations. In addition to the default</span></div>
<div style="position:absolute;left:102.18px;top:437.66px" class="cls_039"><span class="cls_039">application.yml file that you pushed into the Config Server’s Git backend, you can</span></div>
<div style="position:absolute;left:102.18px;top:450.68px" class="cls_039"><span class="cls_039">push another YAML file named application-production.yml that looks like this:</span></div>
<div style="position:absolute;left:102.18px;top:470.36px" class="cls_060"><span class="cls_060">server:</span></div>
<div style="position:absolute;left:111.78px;top:480.35px" class="cls_060"><span class="cls_060">port: 8080</span></div>
<div style="position:absolute;left:102.18px;top:500.36px" class="cls_060"><span class="cls_060">eureka:</span></div>
<div style="position:absolute;left:106.98px;top:510.35px" class="cls_060"><span class="cls_060">client:</span></div>
<div style="position:absolute;left:116.58px;top:520.34px" class="cls_060"><span class="cls_060">service-url:</span></div>
<div style="position:absolute;left:126.13px;top:530.36px" class="cls_061"><span class="cls_061">defaultZone: </span><a href="http://eureka1:8761/eureka/">http://eureka1:8761/eureka/</a><span class="cls_061">,<a href="http://eureka2:8761/eureka/">http://eureka2:8761/eureka/</a> </span></div>
<div style="position:absolute;left:102.18px;top:551.69px" class="cls_039"><span class="cls_039">When the application fetches configuration from the Config Server, it will identify</span></div>
<div style="position:absolute;left:102.18px;top:564.68px" class="cls_039"><span class="cls_039">which profile is active (in the second part of the request path). If the active profile is</span></div>
<div style="position:absolute;left:102.18px;top:577.67px" class="cls_059"><span class="cls_059">production</span><span class="cls_039">, both sets of properties—application.yml and application-production.yml—</span></div>
<div style="position:absolute;left:102.18px;top:590.69px" class="cls_039"><span class="cls_039">will be returned, with those properties in application-production.yml taking precedence</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:250116px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background378.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">356</span></div>
<div style="position:absolute;left:193.29px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 14</span></div>
<div style="position:absolute;left:242.25px;top:24.35px" class="cls_055"><span class="cls_055">Managing configuration</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">over the default properties in application.yml. Figure 14.4 shows what this might look</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">like in the backend Git repository.</span></div>
<div style="position:absolute;left:133.03px;top:145.87px" class="cls_081"><span class="cls_081">Profile-specific</span></div>
<div style="position:absolute;left:135.26px;top:154.86px" class="cls_081"><span class="cls_081">configuration</span></div>
<div style="position:absolute;left:127.32px;top:163.86px" class="cls_081"><span class="cls_081">(all applications if</span></div>
<div style="position:absolute;left:135.26px;top:172.86px" class="cls_081"><span class="cls_081">“production”</span></div>
<div style="position:absolute;left:130.51px;top:181.86px" class="cls_081"><span class="cls_081">profile is active)</span></div>
<div style="position:absolute;left:102.14px;top:200.53px" class="cls_081"><span class="cls_081">Common configuration</span></div>
<div style="position:absolute;left:93.11px;top:209.53px" class="cls_081"><span class="cls_081">(all applications/all profiles)</span></div>
<div style="position:absolute;left:117.62px;top:228.21px" class="cls_081"><span class="cls_081">Application-specific</span></div>
<div style="position:absolute;left:128.14px;top:237.21px" class="cls_081"><span class="cls_081">configuration</span></div>
<div style="position:absolute;left:130.24px;top:246.21px" class="cls_081"><span class="cls_081">(all profiles)</span></div>
<div style="position:absolute;left:93.18px;top:268.94px" class="cls_053"><span class="cls_053">Figure 14.4</span></div>
<div style="position:absolute;left:142.47px;top:268.94px" class="cls_053"><span class="cls_053">Profile-specific configuration files can be named with a suffix equal to the name of the</span></div>
<div style="position:absolute;left:93.18px;top:278.96px" class="cls_053"><span class="cls_053">active profile.</span></div>
<div style="position:absolute;left:93.18px;top:305.30px" class="cls_039"><span class="cls_039">You can also specify properties that are specific to both a profile and an application</span></div>
<div style="position:absolute;left:93.18px;top:318.32px" class="cls_039"><span class="cls_039">using the same naming convention. That is, name the configuration file with the</span></div>
<div style="position:absolute;left:93.18px;top:331.31px" class="cls_039"><span class="cls_039">application name, hyphen, profile name.</span></div>
<div style="position:absolute;left:107.94px;top:344.30px" class="cls_039"><span class="cls_039">For example, suppose you need to set properties for the application named ingre-</span></div>
<div style="position:absolute;left:93.18px;top:357.32px" class="cls_039"><span class="cls_039">dient-service that should only be applicable if the </span><span class="cls_059">production</span><span class="cls_039"> profile is active. In that</span></div>
<div style="position:absolute;left:93.18px;top:370.31px" class="cls_039"><span class="cls_039">case, a configuration file named ingredient-service-production.yml could contain</span></div>
<div style="position:absolute;left:93.18px;top:383.30px" class="cls_039"><span class="cls_039">those application-specific and profile-specific properties, as illustrated in figure 14.5.</span></div>
<div style="position:absolute;left:97.03px;top:441.12px" class="cls_081"><span class="cls_081">Profile-specific configuration</span></div>
<div style="position:absolute;left:115.90px;top:450.12px" class="cls_081"><span class="cls_081">(all applications if</span></div>
<div style="position:absolute;left:94.52px;top:459.12px" class="cls_081"><span class="cls_081">“production” profile is active)</span></div>
<div style="position:absolute;left:102.14px;top:479.60px" class="cls_081"><span class="cls_081">Common configuration</span></div>
<div style="position:absolute;left:93.11px;top:488.60px" class="cls_081"><span class="cls_081">(all applications/all profiles)</span></div>
<div style="position:absolute;left:114.85px;top:506.49px" class="cls_081"><span class="cls_081">Application- and</span></div>
<div style="position:absolute;left:93.34px;top:515.49px" class="cls_081"><span class="cls_081">profile-specific configuration</span></div>
<div style="position:absolute;left:106.31px;top:524.49px" class="cls_081"><span class="cls_081">(“ingredient-service”</span></div>
<div style="position:absolute;left:122.87px;top:533.49px" class="cls_081"><span class="cls_081">application/</span></div>
<div style="position:absolute;left:106.21px;top:542.48px" class="cls_081"><span class="cls_081">“production” profile)</span></div>
<div style="position:absolute;left:122.87px;top:558.19px" class="cls_081"><span class="cls_081">Application-specific</span></div>
<div style="position:absolute;left:133.39px;top:567.19px" class="cls_081"><span class="cls_081">configuration</span></div>
<div style="position:absolute;left:135.49px;top:576.19px" class="cls_081"><span class="cls_081">(all profiles)</span></div>
<div style="position:absolute;left:93.18px;top:595.22px" class="cls_053"><span class="cls_053">Figure 14.5</span></div>
<div style="position:absolute;left:142.61px;top:595.22px" class="cls_053"><span class="cls_053">Configuration files can be both application-specific and profile-specific.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:250792px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background379.jpg" width="531" height="666"></div>
<div style="position:absolute;left:200.70px;top:24.35px" class="cls_055"><span class="cls_055">Keeping configuration properties secret</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">357</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">You can also use property files instead of YAML files in the backend Git repository</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">using this same naming convention for profile-specific properties. But with YAML</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">files, you can also include profile-specific properties in the same file as default profile</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">properties by using a triple-hyphen separator and </span><span class="cls_059">spring.profiles</span><span class="cls_039">, as you learned in</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">chapter 5.</span></div>
<div style="position:absolute;left:66.18px;top:123.82px" class="cls_040"><span class="cls_040">14.5</span></div>
<div style="position:absolute;left:102.18px;top:123.82px" class="cls_040"><span class="cls_040">Keeping configuration properties secret</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">Most configuration served by Config Server may not be all that secret. But you might</span></div>
<div style="position:absolute;left:102.18px;top:154.67px" class="cls_039"><span class="cls_039">need Config Server to serve properties containing sensitive information such as pass-</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">words or security tokens that are best kept secret in the backend repository.</span></div>
<div style="position:absolute;left:116.78px;top:180.65px" class="cls_039"><span class="cls_039">Config Server offers two options for working with secret configuration properties:</span></div>
<div style="position:absolute;left:117.78px;top:197.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Writing encrypted values in configuration files stored in Git</span></div>
<div style="position:absolute;left:117.78px;top:211.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Using HashiCorp’s Vault as a backend store for Config Server in addition to (or</span></div>
<div style="position:absolute;left:129.78px;top:224.66px" class="cls_039"><span class="cls_039">in place of) Git</span></div>
<div style="position:absolute;left:102.18px;top:242.66px" class="cls_039"><span class="cls_039">Let’s take a look at how each of these options can be used with Config Server to keep</span></div>
<div style="position:absolute;left:102.18px;top:255.65px" class="cls_039"><span class="cls_039">configuration properties secret. We’ll start with writing encrypted properties to the</span></div>
<div style="position:absolute;left:102.18px;top:268.67px" class="cls_039"><span class="cls_039">Git backend.</span></div>
<div style="position:absolute;left:66.18px;top:290.48px" class="cls_063"><span class="cls_063">14.5.1</span></div>
<div style="position:absolute;left:102.18px;top:290.48px" class="cls_063"><span class="cls_063">Encrypting properties in Git</span></div>
<div style="position:absolute;left:102.18px;top:307.67px" class="cls_039"><span class="cls_039">In addition to serving unencrypted values, Config Server can also serve encrypted val-</span></div>
<div style="position:absolute;left:102.18px;top:320.66px" class="cls_039"><span class="cls_039">ues written in configuration files stored in Git. The key to working with encrypted</span></div>
<div style="position:absolute;left:102.18px;top:333.68px" class="cls_039"><span class="cls_039">data stored in Git is literally a key—an encryption key.</span></div>
<div style="position:absolute;left:117.18px;top:346.67px" class="cls_039"><span class="cls_039">To enable encrypted properties, you need to configure the Config Server with an</span></div>
<div style="position:absolute;left:102.18px;top:359.66px" class="cls_039"><span class="cls_039">encryption key that it will use to decrypt values before serving them to its client appli-</span></div>
<div style="position:absolute;left:102.18px;top:372.68px" class="cls_039"><span class="cls_039">cations. Config Server supports both symmetric and asymmetric keys. To set a symmet-</span></div>
<div style="position:absolute;left:102.18px;top:385.67px" class="cls_039"><span class="cls_039">ric key, set the </span><span class="cls_059">encrypt.key</span><span class="cls_039"> property in the Config Server’s own configuration to</span></div>
<div style="position:absolute;left:102.18px;top:398.66px" class="cls_039"><span class="cls_039">some value that will act as the encryption and decryption key:</span></div>
<div style="position:absolute;left:102.18px;top:418.34px" class="cls_060"><span class="cls_060">encrypt:</span></div>
<div style="position:absolute;left:111.78px;top:428.36px" class="cls_061"><span class="cls_061">key: s3cr3t</span></div>
<div style="position:absolute;left:102.18px;top:449.66px" class="cls_039"><span class="cls_039">It’s important that this property be set in bootstrap configuration (for example, boot-</span></div>
<div style="position:absolute;left:102.18px;top:462.68px" class="cls_039"><span class="cls_039">strap.properties or bootstrap.yml) so that it’s loaded and available before autoconfigu-</span></div>
<div style="position:absolute;left:102.18px;top:475.67px" class="cls_039"><span class="cls_039">ration enables the Config Server.</span></div>
<div style="position:absolute;left:116.88px;top:488.66px" class="cls_039"><span class="cls_039">For a bit tighter security, you can opt to configure Config Server with an asymmet-</span></div>
<div style="position:absolute;left:102.18px;top:501.68px" class="cls_039"><span class="cls_039">ric RSA key pair or a reference to a keystore. To create such a key, you can use the</span></div>
<div style="position:absolute;left:102.18px;top:514.67px" class="cls_059"><span class="cls_059">keytool</span><span class="cls_039"> command-line tool:</span></div>
<div style="position:absolute;left:102.18px;top:534.35px" class="cls_060"><span class="cls_060">keytool -genkeypair -alias tacokey -keyalg RSA \</span></div>
<div style="position:absolute;left:102.18px;top:544.34px" class="cls_060"><span class="cls_060">-dname "CN=Web Server,OU=Unit,O=Organization,L=City,S=State,C=US" \</span></div>
<div style="position:absolute;left:102.18px;top:554.36px" class="cls_061"><span class="cls_061">-keypass s3cr3t -keystore keystore.jks -storepass l3tm31n</span></div>
<div style="position:absolute;left:102.18px;top:575.69px" class="cls_039"><span class="cls_039">The resulting keystore will be written to a file named keystore.jks. You can keep the</span></div>
<div style="position:absolute;left:102.18px;top:588.68px" class="cls_039"><span class="cls_039">keystore file on the filesystem or place it in the application itself. In either event, you’ll</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:251468px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background380.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">358</span></div>
<div style="position:absolute;left:193.29px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 14</span></div>
<div style="position:absolute;left:242.25px;top:24.35px" class="cls_055"><span class="cls_055">Managing configuration</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">need to configure the location and credentials for the keystore in the Config Server’s</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">bootstrap.yml file.</span></div>
<div style="position:absolute;left:105.18px;top:84.65px" class="cls_083"><span class="cls_083">NOTE</span><span class="cls_039">   In order to use encryption in Config Server, you must have installed</span></div>
<div style="position:absolute;left:105.18px;top:96.65px" class="cls_039"><span class="cls_039">the Java Cryptography Extensions Unlimited Strength policy files. See Oracle’s</span></div>
<div style="position:absolute;left:105.18px;top:108.65px" class="cls_039"><span class="cls_039">Java SE page for details: </span><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">http://www.oracle.com/technetwork/java/javase/</a> </div>
<div style="position:absolute;left:105.18px;top:120.65px" class="cls_045"><span class="cls_045"> </span><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">downloads/index.html</a> <span class="cls_039">.</span></div>
<div style="position:absolute;left:93.18px;top:140.66px" class="cls_039"><span class="cls_039">For example, suppose you choose to package the keystore in the application itself, at</span></div>
<div style="position:absolute;left:93.18px;top:153.65px" class="cls_039"><span class="cls_039">the root of the classpath. Then you can configure the Config Server to use that key-</span></div>
<div style="position:absolute;left:93.18px;top:166.67px" class="cls_039"><span class="cls_039">store with the following properties:</span></div>
<div style="position:absolute;left:93.18px;top:186.35px" class="cls_060"><span class="cls_060">encrypt:</span></div>
<div style="position:absolute;left:102.78px;top:196.34px" class="cls_060"><span class="cls_060">key-store:</span></div>
<div style="position:absolute;left:112.38px;top:206.33px" class="cls_060"><span class="cls_060">alias: tacokey</span></div>
<div style="position:absolute;left:112.38px;top:216.35px" class="cls_060"><span class="cls_060">location: classpath:/keystore.jks</span></div>
<div style="position:absolute;left:112.38px;top:226.34px" class="cls_060"><span class="cls_060">password: l3tm31n</span></div>
<div style="position:absolute;left:112.38px;top:236.33px" class="cls_061"><span class="cls_061">secret: s3cr3t</span></div>
<div style="position:absolute;left:93.18px;top:259.67px" class="cls_039"><span class="cls_039">With a key or a keystore in place, you now must encrypt some data. Config Server</span></div>
<div style="position:absolute;left:93.18px;top:272.66px" class="cls_039"><span class="cls_039">exposes an /encrypt endpoint to help. All you must do is submit a </span><span class="cls_059">POST</span><span class="cls_039"> request to the</span></div>
<div style="position:absolute;left:93.18px;top:285.65px" class="cls_039"><span class="cls_039">/encrypt endpoint with some data to be encrypted. For example, suppose you’d like</span></div>
<div style="position:absolute;left:93.18px;top:298.67px" class="cls_039"><span class="cls_039">to encrypt a password to the MongoDB database. Using curl, you can encrypt the pass-</span></div>
<div style="position:absolute;left:93.18px;top:311.66px" class="cls_039"><span class="cls_039">word like this:</span></div>
<div style="position:absolute;left:93.18px;top:331.34px" class="cls_060"><span class="cls_060">$ curl localhost:8888/encrypt -d "s3cr3tP455w0rd"</span></div>
<div style="position:absolute;left:93.18px;top:341.33px" class="cls_061"><span class="cls_061">93912a660a7f3c04e811b5df9a3cf6e1f63850cdcd4aa092cf5a3f7e1662fab7</span></div>
<div style="position:absolute;left:93.18px;top:364.67px" class="cls_039"><span class="cls_039">After submitting the </span><span class="cls_059">POST</span><span class="cls_039"> request, you’ll receive an encrypted value as the response.</span></div>
<div style="position:absolute;left:93.18px;top:377.66px" class="cls_039"><span class="cls_039">All that’s left is to copy that value and paste it into the configuration that’s hosted in</span></div>
<div style="position:absolute;left:93.18px;top:390.68px" class="cls_039"><span class="cls_039">the Git repository.</span></div>
<div style="position:absolute;left:107.76px;top:403.67px" class="cls_039"><span class="cls_039">To set the MongoDB password, add the </span><span class="cls_059">spring.data.mongodb.password</span><span class="cls_039"> property</span></div>
<div style="position:absolute;left:93.18px;top:416.66px" class="cls_039"><span class="cls_039">to the application.yml file stored in the Git repository:</span></div>
<div style="position:absolute;left:93.18px;top:436.34px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:102.78px;top:446.36px" class="cls_060"><span class="cls_060">data:</span></div>
<div style="position:absolute;left:112.38px;top:456.35px" class="cls_060"><span class="cls_060">mongodb:</span></div>
<div style="position:absolute;left:121.95px;top:466.34px" class="cls_061"><span class="cls_061">password: '{cipher}93912a660a7f3c04e811b5df9a3cf6e1f63850...'</span></div>
<div style="position:absolute;left:93.18px;top:489.68px" class="cls_039"><span class="cls_039">Notice that the value given to </span><span class="cls_059">spring.data.mongodb.password</span><span class="cls_039"> is wrapped in single</span></div>
<div style="position:absolute;left:93.18px;top:502.67px" class="cls_039"><span class="cls_039">quotes (</span><span class="cls_059">'</span><span class="cls_039">) and is prefixed with </span><span class="cls_059">{cipher}</span><span class="cls_039">. This is a clue to Config Server that the value</span></div>
<div style="position:absolute;left:93.18px;top:515.66px" class="cls_039"><span class="cls_039">is an encrypted value and not a plain, unencrypted value.</span></div>
<div style="position:absolute;left:107.78px;top:528.68px" class="cls_039"><span class="cls_039">After committing and pushing the changes in application.yml file to the Git repos-</span></div>
<div style="position:absolute;left:93.18px;top:541.67px" class="cls_039"><span class="cls_039">itory, Config Server is ready to serve encrypted properties. To see it in action, use curl</span></div>
<div style="position:absolute;left:93.18px;top:554.69px" class="cls_039"><span class="cls_039">to pretend to be a Config Server client:</span></div>
<div style="position:absolute;left:93.18px;top:574.34px" class="cls_060"><span class="cls_060">$ curl localhost:8888/application/default | jq</span></div>
<div style="position:absolute;left:93.18px;top:584.36px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:102.78px;top:594.35px" class="cls_060"><span class="cls_060">"name": "app",</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:252144px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background381.jpg" width="531" height="666"></div>
<div style="position:absolute;left:200.70px;top:24.35px" class="cls_055"><span class="cls_055">Keeping configuration properties secret</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">359</span></div>
<div style="position:absolute;left:111.78px;top:51.32px" class="cls_060"><span class="cls_060">"profiles": [</span></div>
<div style="position:absolute;left:121.38px;top:61.34px" class="cls_060"><span class="cls_060">"prof"</span></div>
<div style="position:absolute;left:111.78px;top:71.33px" class="cls_060"><span class="cls_060">],</span></div>
<div style="position:absolute;left:111.78px;top:81.32px" class="cls_060"><span class="cls_060">"label": null,</span></div>
<div style="position:absolute;left:111.78px;top:91.34px" class="cls_060"><span class="cls_060">"version": "464adfd43485182e4e0af08c2aaaa64d2f78c4cf",</span></div>
<div style="position:absolute;left:111.78px;top:101.33px" class="cls_060"><span class="cls_060">"state": null,</span></div>
<div style="position:absolute;left:111.78px;top:111.32px" class="cls_060"><span class="cls_060">"propertySources": [</span></div>
<div style="position:absolute;left:121.38px;top:121.34px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:130.95px;top:131.33px" class="cls_060"><span class="cls_060">"name": "</span><a href="http://localhost:10080/tacocloud/tacocloud-/">http://localhost:10080/tacocloud/tacocloud-</a> </div>
<div style="position:absolute;left:126.18px;top:141.35px" class="cls_060"><span class="cls_060">config/application.yml",</span></div>
<div style="position:absolute;left:130.95px;top:151.34px" class="cls_060"><span class="cls_060">"source": {</span></div>
<div style="position:absolute;left:140.55px;top:161.33px" class="cls_060"><span class="cls_060">"spring.data.mongodb.password": "s3cr3tP455w0rd"</span></div>
<div style="position:absolute;left:130.95px;top:171.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:121.38px;top:181.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:191.33px" class="cls_060"><span class="cls_060">]</span></div>
<div style="position:absolute;left:102.18px;top:201.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:222.65px" class="cls_039"><span class="cls_039">As you can see, the value served for </span><span class="cls_059">spring.data.mongodb.password</span><span class="cls_039"> is served in a</span></div>
<div style="position:absolute;left:102.18px;top:235.67px" class="cls_039"><span class="cls_039">decrypted form. By default, any encrypted values served by Config Server are only</span></div>
<div style="position:absolute;left:102.18px;top:248.66px" class="cls_039"><span class="cls_039">encrypted while at rest in the backend Git repository; they’ll be decrypted before being</span></div>
<div style="position:absolute;left:102.18px;top:261.65px" class="cls_039"><span class="cls_039">served. This means the client application that consumes the configuration doesn’t</span></div>
<div style="position:absolute;left:102.18px;top:274.67px" class="cls_039"><span class="cls_039">require any special code or configuration to receive properties that are encrypted in Git.</span></div>
<div style="position:absolute;left:119.10px;top:287.66px" class="cls_039"><span class="cls_039">If you’d prefer that Config Server serve encrypted properties in their still-</span></div>
<div style="position:absolute;left:102.18px;top:300.68px" class="cls_039"><span class="cls_039">encrypted form, you can set the </span><span class="cls_059">spring.cloud.config.server.encrypt.enabled</span></div>
<div style="position:absolute;left:102.18px;top:313.67px" class="cls_039"><span class="cls_039">property to </span><span class="cls_059">false</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:102.18px;top:333.35px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:111.78px;top:343.34px" class="cls_060"><span class="cls_060">cloud:</span></div>
<div style="position:absolute;left:121.38px;top:353.33px" class="cls_060"><span class="cls_060">config:</span></div>
<div style="position:absolute;left:130.95px;top:363.35px" class="cls_060"><span class="cls_060">server:</span></div>
<div style="position:absolute;left:140.55px;top:373.34px" class="cls_060"><span class="cls_060">git:</span></div>
<div style="position:absolute;left:150.15px;top:383.33px" class="cls_060"><span class="cls_060">uri: </span><a href="http://localhost:10080/tacocloud/tacocloud-config/">http://localhost:10080/tacocloud/tacocloud-config</a> </div>
<div style="position:absolute;left:140.55px;top:393.35px" class="cls_060"><span class="cls_060">encrypt:</span></div>
<div style="position:absolute;left:150.15px;top:403.34px" class="cls_061"><span class="cls_061">enabled: false</span></div>
<div style="position:absolute;left:102.18px;top:424.67px" class="cls_039"><span class="cls_039">This results in Config Server serving all property values, including encrypted property</span></div>
<div style="position:absolute;left:102.18px;top:437.66px" class="cls_039"><span class="cls_039">values, exactly as they’re set in the Git repository. Pretending once more to be a client,</span></div>
<div style="position:absolute;left:102.18px;top:450.68px" class="cls_039"><span class="cls_039">the curl command reveals the effect of disabling decryption:</span></div>
<div style="position:absolute;left:102.18px;top:470.36px" class="cls_060"><span class="cls_060">$ curl localhost:8888/application/default | jq</span></div>
<div style="position:absolute;left:102.18px;top:480.35px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:111.78px;top:500.36px" class="cls_060"><span class="cls_060">"propertySources": [</span></div>
<div style="position:absolute;left:121.38px;top:510.35px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:130.95px;top:520.34px" class="cls_060"><span class="cls_060">"name": "</span><a href="http://localhost:10080/tacocloud/tacocloud-/">http://localhost:10080/tacocloud/tacocloud-</a> </div>
<div style="position:absolute;left:126.18px;top:530.36px" class="cls_060"><span class="cls_060">config/application.yml",</span></div>
<div style="position:absolute;left:130.95px;top:540.35px" class="cls_060"><span class="cls_060">"source": {</span></div>
<div style="position:absolute;left:140.55px;top:550.34px" class="cls_060"><span class="cls_060">"spring.data.mongodb.password": "{cipher}AQA4JeVhf2cRXW..."</span></div>
<div style="position:absolute;left:130.95px;top:560.36px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:121.38px;top:570.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:580.34px" class="cls_060"><span class="cls_060">]</span></div>
<div style="position:absolute;left:102.18px;top:590.36px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:252820px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background382.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">360</span></div>
<div style="position:absolute;left:193.29px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 14</span></div>
<div style="position:absolute;left:242.25px;top:24.35px" class="cls_055"><span class="cls_055">Managing configuration</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">Of course, if the client is receiving encrypted property values, the client is now respon-</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">sible for decrypting them on its own.</span></div>
<div style="position:absolute;left:109.48px;top:76.67px" class="cls_039"><span class="cls_039">Although it’s possible to store encrypted secrets in Git to be served by Config</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">Server, we’ve seen that encryption is not native to Git. It requires effort on your part to</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">encrypt any data written to the backing Git repository. Moreover, unless you push the</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">burden of decryption to the Config Server client applications, the secret information</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">is served decrypted through the Config Server API for anyone who may ask. Let’s take</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">a look at another Config Server backend option that only serves secrets to those who</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_039"><span class="cls_039">are authorized to see them.</span></div>
<div style="position:absolute;left:57.18px;top:176.48px" class="cls_063"><span class="cls_063">14.5.2</span></div>
<div style="position:absolute;left:93.18px;top:176.48px" class="cls_063"><span class="cls_063">Storing secrets in Vault</span></div>
<div style="position:absolute;left:93.18px;top:193.67px" class="cls_039"><span class="cls_039">HashiCorp Vault is a secret-management tool. This means that in contrast to Git,</span></div>
<div style="position:absolute;left:93.18px;top:206.66px" class="cls_039"><span class="cls_039">Vault’s core feature is handling secret information natively. For sensitive configuration</span></div>
<div style="position:absolute;left:93.18px;top:219.65px" class="cls_039"><span class="cls_039">data, this makes Vault a much more attractive option as a backend to Config Server.</span></div>
<div style="position:absolute;left:107.45px;top:232.67px" class="cls_039"><span class="cls_039">To get started with Vault, download and install the </span><span class="cls_059">vault</span><span class="cls_039"> command-line tool by fol-</span></div>
<div style="position:absolute;left:93.18px;top:245.66px" class="cls_039"><span class="cls_039">lowing the installation instructions on the Vault website: </span><a href="https://www.vaultproject.io/intro/getting-started/install.html">https://www.vaultproject.io/</a> </div>
<div style="position:absolute;left:93.18px;top:258.65px" class="cls_045"><span class="cls_045"> </span><a href="https://www.vaultproject.io/intro/getting-started/install.html">intro/getting-started/install.html</a> <span class="cls_039">. In this section, you’ll use the </span><span class="cls_059">vault</span><span class="cls_039"> command both</span></div>
<div style="position:absolute;left:93.18px;top:271.67px" class="cls_039"><span class="cls_039">for managing secrets as well as starting a Vault server.</span></div>
<div style="position:absolute;left:93.18px;top:289.85px" class="cls_064"><span class="cls_064">S</span><span class="cls_065">TARTING</span><span class="cls_064"> </span><span class="cls_065">A</span><span class="cls_064"> V</span><span class="cls_065">AULT</span><span class="cls_064"> </span><span class="cls_065">SERVER</span></div>
<div style="position:absolute;left:93.18px;top:302.18px" class="cls_039"><span class="cls_039">Before you can write secrets and serve them with Config Server, you’ll need to start a</span></div>
<div style="position:absolute;left:93.18px;top:315.17px" class="cls_039"><span class="cls_039">Vault server. For your purposes, the easiest way to do so is to start the server in devel-</span></div>
<div style="position:absolute;left:93.18px;top:328.16px" class="cls_039"><span class="cls_039">opment mode with the following commands:</span></div>
<div style="position:absolute;left:93.18px;top:347.84px" class="cls_060"><span class="cls_060">$ vault server -dev -dev-root-token-id=roottoken</span></div>
<div style="position:absolute;left:93.18px;top:357.83px" class="cls_060"><span class="cls_060">$ export VAULT_ADDR='</span><a href="http://127.0.0.1:8200&#39;/">http://127.0.0.1:8200'</a> </div>
<div style="position:absolute;left:93.18px;top:367.85px" class="cls_061"><span class="cls_061">$ vault status</span></div>
<div style="position:absolute;left:93.18px;top:389.18px" class="cls_039"><span class="cls_039">The first command starts a Vault server in development mode with a root token whose</span></div>
<div style="position:absolute;left:93.18px;top:402.17px" class="cls_039"><span class="cls_039">ID is </span><span class="cls_059">roottoken</span><span class="cls_039">. Development mode, as its name suggests, is a simpler, yet not entirely</span></div>
<div style="position:absolute;left:93.18px;top:415.16px" class="cls_039"><span class="cls_039">secure, runtime of Vault. It shouldn’t be used in a production setting, but it’s quite</span></div>
<div style="position:absolute;left:93.18px;top:428.18px" class="cls_039"><span class="cls_039">convenient when working with Vault during your development workflow.</span></div>
<div style="position:absolute;left:105.18px;top:447.17px" class="cls_083"><span class="cls_083">NOTE</span><span class="cls_039">   The Vault server is a feature-filled and robust secret-management</span></div>
<div style="position:absolute;left:105.18px;top:459.17px" class="cls_039"><span class="cls_039">server. There’s nowhere near enough space in this chapter to talk about run-</span></div>
<div style="position:absolute;left:105.18px;top:471.17px" class="cls_039"><span class="cls_039">ning the Vault server beyond its simple use in development mode. I strongly</span></div>
<div style="position:absolute;left:105.18px;top:483.17px" class="cls_039"><span class="cls_039">recommend you get to know Vault in greater detail by reading the Vault doc-</span></div>
<div style="position:absolute;left:105.18px;top:495.17px" class="cls_039"><span class="cls_039">umentation at </span><a href="https://www.vaultproject.io/docs/index.html">https://www.vaultproject.io/docs/index.html</a> <span class="cls_039"> before attempt-</span></div>
<div style="position:absolute;left:105.18px;top:507.17px" class="cls_039"><span class="cls_039">ing to use Vault in a production setting.</span></div>
<div style="position:absolute;left:93.18px;top:527.18px" class="cls_039"><span class="cls_039">All access to a Vault server requires that a token be presented to the server. The root</span></div>
<div style="position:absolute;left:93.18px;top:540.17px" class="cls_039"><span class="cls_039">token is an administrative token that, among other things, allows you to create more</span></div>
<div style="position:absolute;left:93.18px;top:553.19px" class="cls_039"><span class="cls_039">tokens. It can also be used to read and write secrets. If you don’t specify a root token</span></div>
<div style="position:absolute;left:93.18px;top:566.18px" class="cls_039"><span class="cls_039">when starting the server in development mode, one will be generated for you and</span></div>
<div style="position:absolute;left:93.18px;top:579.17px" class="cls_039"><span class="cls_039">written to the logs at startup time. For ease of use, I recommend setting the root token</span></div>
<div style="position:absolute;left:93.18px;top:592.19px" class="cls_039"><span class="cls_039">to an easy-to-remember value, such as </span><span class="cls_059">roottoken</span><span class="cls_039">.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:253496px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background383.jpg" width="531" height="666"></div>
<div style="position:absolute;left:200.70px;top:24.35px" class="cls_055"><span class="cls_055">Keeping configuration properties secret</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">361</span></div>
<div style="position:absolute;left:117.18px;top:50.66px" class="cls_039"><span class="cls_039">Once the development-mode server is started, it will be listening on port 8200 on</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">the local machine. So that the </span><span class="cls_059">vault</span><span class="cls_039"> command line knows where the Vault server is at,</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">it’s important to set the </span><span class="cls_059">VAULT_ADDR</span><span class="cls_039"> environment variable, as in the second command</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">in the previous code snippet.</span></div>
<div style="position:absolute;left:118.56px;top:102.65px" class="cls_039"><span class="cls_039">Finally, the </span><span class="cls_059">vault  status</span><span class="cls_039"> command verifies that the previous two commands</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">worked as expected. You should receive a list of about a half-dozen properties describ-</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">ing the configuration of the Vault server, including whether the Vault is sealed or not.</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">(It shouldn’t be sealed in development mode.)</span></div>
<div style="position:absolute;left:116.82px;top:154.67px" class="cls_039"><span class="cls_039">If you’re working with Vault 0.10.0 or later, there are a couple of other commands</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">you’ll need to perform to get Vault ready for working with Config Server. Some</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">changes to how Vault works result in one of the standard secret backends being</span></div>
<div style="position:absolute;left:102.18px;top:193.67px" class="cls_039"><span class="cls_039">incompatible with Config Server. The following two commands recreate the backend</span></div>
<div style="position:absolute;left:102.18px;top:206.66px" class="cls_039"><span class="cls_039">whose name is </span><span class="cls_059">secret</span><span class="cls_039"> to be compatible with Config Server:</span></div>
<div style="position:absolute;left:102.18px;top:226.34px" class="cls_060"><span class="cls_060">$ vault secrets disable secret</span></div>
<div style="position:absolute;left:102.18px;top:236.33px" class="cls_061"><span class="cls_061">$ vault secrets enable -path=secret kv</span></div>
<div style="position:absolute;left:102.18px;top:257.66px" class="cls_039"><span class="cls_039">These steps aren’t required if you’re working with an older version of Vault.</span></div>
<div style="position:absolute;left:102.18px;top:275.84px" class="cls_064"><span class="cls_064">W</span><span class="cls_065">RITING</span><span class="cls_064"> </span><span class="cls_065">SECRETS</span><span class="cls_064"> </span><span class="cls_065">TO</span><span class="cls_064"> V</span><span class="cls_065">AULT</span></div>
<div style="position:absolute;left:102.18px;top:288.17px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">vault</span><span class="cls_039"> command makes it easy to write secrets into Vault. For example, suppose</span></div>
<div style="position:absolute;left:102.18px;top:301.16px" class="cls_039"><span class="cls_039">you want to store the password to MongoDB—the </span><span class="cls_059">spring.data.mongodb.password</span></div>
<div style="position:absolute;left:102.18px;top:314.18px" class="cls_039"><span class="cls_039">property—in Vault instead of in Git. Using the </span><span class="cls_059">vault</span><span class="cls_039"> command, you can do this:</span></div>
<div style="position:absolute;left:102.18px;top:336.83px" class="cls_061"><span class="cls_061">$ vault write secret/application spring.data.mongodb.password=s3cr3t</span></div>
<div style="position:absolute;left:102.18px;top:361.16px" class="cls_039"><span class="cls_039">Figure 14.6 breaks down the </span><span class="cls_059">vault write</span><span class="cls_039"> command, explaining what role each part</span></div>
<div style="position:absolute;left:102.18px;top:374.18px" class="cls_039"><span class="cls_039">of it plays in writing the secret to Vault.</span></div>
<div style="position:absolute;left:145.81px;top:399.87px" class="cls_088"><span class="cls_088">The “secret”</span></div>
<div style="position:absolute;left:151.44px;top:408.27px" class="cls_088"><span class="cls_088">backend</span></div>
<div style="position:absolute;left:272.52px;top:408.27px" class="cls_088"><span class="cls_088">Secret key</span></div>
<div style="position:absolute;left:102.22px;top:435.43px" class="cls_082"><span class="cls_082">$ vault write secret/application spring.data.mongodb.password=s3cr3t</span></div>
<div style="position:absolute;left:111.32px;top:462.81px" class="cls_088"><span class="cls_088">Perform a write</span></div>
<div style="position:absolute;left:189.87px;top:462.81px" class="cls_088"><span class="cls_088">Secret path</span></div>
<div style="position:absolute;left:347.24px;top:462.81px" class="cls_088"><span class="cls_088">Secret value</span></div>
<div style="position:absolute;left:102.18px;top:480.47px" class="cls_053"><span class="cls_053">Figure 14.6</span></div>
<div style="position:absolute;left:151.61px;top:480.17px" class="cls_053"><span class="cls_053">Writing a secret to Vault with the </span><span class="cls_087">vault</span><span class="cls_053"> command</span></div>
<div style="position:absolute;left:102.18px;top:511.88px" class="cls_039"><span class="cls_039">The most significant pieces to pay attention to for now are the secret path, key, and</span></div>
<div style="position:absolute;left:102.18px;top:524.90px" class="cls_039"><span class="cls_039">value. The secret path, much like a filesystem path, allows you to group related secrets</span></div>
<div style="position:absolute;left:102.18px;top:537.89px" class="cls_039"><span class="cls_039">in a given path and other secrets in different paths. The </span><span class="cls_059">secret/</span><span class="cls_039"> prefix to the path</span></div>
<div style="position:absolute;left:102.18px;top:550.88px" class="cls_039"><span class="cls_039">identifies the Vault backend—in this case a key-value backend named “secret.”</span></div>
<div style="position:absolute;left:117.18px;top:563.90px" class="cls_039"><span class="cls_039">The secret key and value are the actual secrets that you’re writing to Vault. When</span></div>
<div style="position:absolute;left:102.18px;top:576.89px" class="cls_039"><span class="cls_039">writing secrets that will be served by Config Server, it’s important to use secret keys</span></div>
<div style="position:absolute;left:102.18px;top:589.88px" class="cls_039"><span class="cls_039">that are equal to the configuration properties they’ll be used for.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:254172px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background384.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">362</span></div>
<div style="position:absolute;left:193.29px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 14</span></div>
<div style="position:absolute;left:242.25px;top:24.35px" class="cls_055"><span class="cls_055">Managing configuration</span></div>
<div style="position:absolute;left:107.78px;top:50.66px" class="cls_039"><span class="cls_039">You can verify that the secret was written with the </span><span class="cls_059">vault read</span><span class="cls_039"> command:</span></div>
<div style="position:absolute;left:93.18px;top:70.34px" class="cls_060"><span class="cls_060">$ vault read secret/application</span></div>
<div style="position:absolute;left:93.18px;top:80.33px" class="cls_060"><span class="cls_060">Key</span></div>
<div style="position:absolute;left:246.70px;top:80.33px" class="cls_060"><span class="cls_060">Value</span></div>
<div style="position:absolute;left:93.18px;top:90.32px" class="cls_060"><span class="cls_060">---</span></div>
<div style="position:absolute;left:246.70px;top:90.32px" class="cls_060"><span class="cls_060">-----</span></div>
<div style="position:absolute;left:93.18px;top:100.34px" class="cls_060"><span class="cls_060">refresh_interval</span></div>
<div style="position:absolute;left:246.67px;top:100.34px" class="cls_060"><span class="cls_060">768h</span></div>
<div style="position:absolute;left:93.18px;top:110.33px" class="cls_061"><span class="cls_061">spring.data.mongodb.password</span></div>
<div style="position:absolute;left:246.68px;top:110.33px" class="cls_061"><span class="cls_061">s3cr3t</span></div>
<div style="position:absolute;left:93.18px;top:131.66px" class="cls_039"><span class="cls_039">When writing secrets to a given path, be aware that every write to a given path will</span></div>
<div style="position:absolute;left:93.18px;top:144.65px" class="cls_039"><span class="cls_039">overwrite any secrets previously written to that path. For example, suppose you also</span></div>
<div style="position:absolute;left:93.18px;top:157.67px" class="cls_039"><span class="cls_039">wanted to write the MongoDB username to Vault at the same path as in the previous</span></div>
<div style="position:absolute;left:93.18px;top:170.66px" class="cls_039"><span class="cls_039">example. You couldn’t simply write the </span><span class="cls_059">spring.data.mongodb.username</span><span class="cls_039"> secret by</span></div>
<div style="position:absolute;left:93.18px;top:183.65px" class="cls_039"><span class="cls_039">itself—doing so would result in the </span><span class="cls_059">spring.data.mongodb.password</span><span class="cls_039"> secret being lost.</span></div>
<div style="position:absolute;left:93.18px;top:196.67px" class="cls_039"><span class="cls_039">Instead, you must write them both at the same time:</span></div>
<div style="position:absolute;left:93.18px;top:216.35px" class="cls_060"><span class="cls_060">% vault write secret/application \</span></div>
<div style="position:absolute;left:160.35px;top:226.34px" class="cls_060"><span class="cls_060">spring.data.mongodb.password=s3cr3t \</span></div>
<div style="position:absolute;left:160.35px;top:236.33px" class="cls_061"><span class="cls_061">spring.data.mongodb.username=tacocloud</span></div>
<div style="position:absolute;left:93.18px;top:259.67px" class="cls_039"><span class="cls_039">Now that you’ve written a few secrets to Vault, let’s see how you can enable Vault as a</span></div>
<div style="position:absolute;left:93.18px;top:272.66px" class="cls_039"><span class="cls_039">backend source of properties for Config Server.</span></div>
<div style="position:absolute;left:93.18px;top:290.84px" class="cls_064"><span class="cls_064">E</span><span class="cls_065">NABLING</span><span class="cls_064"> </span><span class="cls_065">A</span><span class="cls_064"> V</span><span class="cls_065">AULT</span><span class="cls_064"> </span><span class="cls_065">BACKEND</span><span class="cls_064"> </span><span class="cls_065">IN</span><span class="cls_064"> C</span><span class="cls_065">ONFIG</span><span class="cls_064"> S</span><span class="cls_065">ERVER</span></div>
<div style="position:absolute;left:93.18px;top:303.17px" class="cls_039"><span class="cls_039">To add Vault as a backend for the Config Server, the least you’ll need to do is add</span></div>
<div style="position:absolute;left:93.18px;top:316.16px" class="cls_059"><span class="cls_059">vault</span><span class="cls_039"> as an active profile. In the Config Server’s application.yml file, that will look</span></div>
<div style="position:absolute;left:93.18px;top:329.18px" class="cls_039"><span class="cls_039">like this:</span></div>
<div style="position:absolute;left:93.18px;top:348.83px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:102.78px;top:358.85px" class="cls_060"><span class="cls_060">profiles:</span></div>
<div style="position:absolute;left:112.38px;top:368.84px" class="cls_060"><span class="cls_060">active:</span></div>
<div style="position:absolute;left:112.38px;top:378.83px" class="cls_060"><span class="cls_060">- vault</span></div>
<div style="position:absolute;left:112.38px;top:388.85px" class="cls_061"><span class="cls_061">- git</span></div>
<div style="position:absolute;left:93.18px;top:412.16px" class="cls_039"><span class="cls_039">As shown here, both the </span><span class="cls_059">vault</span><span class="cls_039"> and </span><span class="cls_059">git</span><span class="cls_039"> profiles are active, allowing Config Server to</span></div>
<div style="position:absolute;left:93.18px;top:425.18px" class="cls_039"><span class="cls_039">serve configuration from both Vault and Git. Generally, you’d only write sensitive con-</span></div>
<div style="position:absolute;left:93.18px;top:438.17px" class="cls_039"><span class="cls_039">figuration properties to Vault and continue to use a Git backend for those properties</span></div>
<div style="position:absolute;left:93.18px;top:451.16px" class="cls_039"><span class="cls_039">that don’t require secrecy. But if you wish to write all configuration to Vault or have</span></div>
<div style="position:absolute;left:93.18px;top:464.18px" class="cls_039"><span class="cls_039">no need for a Git backend, you can set </span><span class="cls_059">spring.profiles.active</span><span class="cls_039"> to </span><span class="cls_059">vault</span><span class="cls_039"> and have no</span></div>
<div style="position:absolute;left:93.18px;top:477.17px" class="cls_039"><span class="cls_039">Git backend at all.</span></div>
<div style="position:absolute;left:108.27px;top:490.16px" class="cls_039"><span class="cls_039">By default, Config Server will assume that Vault is running on localhost, listening</span></div>
<div style="position:absolute;left:93.18px;top:503.18px" class="cls_039"><span class="cls_039">on port 8200. But you can change that in the Config Server’s configuration like this:</span></div>
<div style="position:absolute;left:93.18px;top:522.86px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:102.78px;top:532.85px" class="cls_060"><span class="cls_060">cloud:</span></div>
<div style="position:absolute;left:112.38px;top:542.84px" class="cls_060"><span class="cls_060">config:</span></div>
<div style="position:absolute;left:121.95px;top:552.86px" class="cls_060"><span class="cls_060">server:</span></div>
<div style="position:absolute;left:131.55px;top:562.85px" class="cls_060"><span class="cls_060">git:</span></div>
<div style="position:absolute;left:141.15px;top:572.84px" class="cls_060"><span class="cls_060">uri: </span><a href="http://localhost:10080/tacocloud/tacocloud-config/">http://localhost:10080/tacocloud/tacocloud-config</a> </div>
<div style="position:absolute;left:141.12px;top:582.86px" class="cls_060"><span class="cls_060">order: 2</span></div>
<div style="position:absolute;left:131.55px;top:592.85px" class="cls_060"><span class="cls_060">vault:</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:254848px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background385.jpg" width="531" height="666"></div>
<div style="position:absolute;left:200.70px;top:24.35px" class="cls_055"><span class="cls_055">Keeping configuration properties secret</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">363</span></div>
<div style="position:absolute;left:150.15px;top:51.32px" class="cls_060"><span class="cls_060">host: vault.tacocloud.com</span></div>
<div style="position:absolute;left:150.15px;top:61.34px" class="cls_060"><span class="cls_060">port: 8200</span></div>
<div style="position:absolute;left:150.13px;top:71.33px" class="cls_060"><span class="cls_060">scheme: https</span></div>
<div style="position:absolute;left:150.15px;top:81.32px" class="cls_061"><span class="cls_061">order: 1</span></div>
<div style="position:absolute;left:102.18px;top:104.66px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">spring.cloud.config.server.vault.*</span><span class="cls_039"> properties let you override the default</span></div>
<div style="position:absolute;left:102.18px;top:117.65px" class="cls_039"><span class="cls_039">assumptions about Vault made by Config Server. Here you’re telling Config Server</span></div>
<div style="position:absolute;left:102.18px;top:130.67px" class="cls_039"><span class="cls_039">that Vault’s API can be accessed at </span><a href="https://vault.tacocloud.com:8200/">https://vault.tacocloud.com:8200</a> <span class="cls_039">.</span></div>
<div style="position:absolute;left:116.68px;top:143.66px" class="cls_039"><span class="cls_039">Notice that you left the Git configuration in place, assuming that Vault and Git will</span></div>
<div style="position:absolute;left:102.18px;top:156.65px" class="cls_039"><span class="cls_039">split responsibility for providing configuration. The </span><span class="cls_059">order</span><span class="cls_039"> property specifies that</span></div>
<div style="position:absolute;left:102.18px;top:169.67px" class="cls_039"><span class="cls_039">secrets provided by Vault will take precedence over any properties provided by Git.</span></div>
<div style="position:absolute;left:117.43px;top:182.66px" class="cls_039"><span class="cls_039">Once Config Server is configured to use the Vault backend, you can try it out by</span></div>
<div style="position:absolute;left:102.18px;top:195.65px" class="cls_039"><span class="cls_039">using curl to pretend to be a client:</span></div>
<div style="position:absolute;left:102.18px;top:218.33px" class="cls_060"><span class="cls_060">[habuma:habuma]% curl localhost:8888/application/default | jq</span></div>
<div style="position:absolute;left:102.18px;top:228.35px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:111.78px;top:238.34px" class="cls_060"><span class="cls_060">"timestamp": "2018-04-29T23:33:22.275+0000",</span></div>
<div style="position:absolute;left:111.78px;top:248.33px" class="cls_060"><span class="cls_060">"status": 400,</span></div>
<div style="position:absolute;left:111.78px;top:258.35px" class="cls_060"><span class="cls_060">"error": "Bad Request",</span></div>
<div style="position:absolute;left:111.78px;top:268.34px" class="cls_060"><span class="cls_060">"message": "Missing required header: X-Config-Token",</span></div>
<div style="position:absolute;left:111.78px;top:278.33px" class="cls_060"><span class="cls_060">"path": "/application/default"</span></div>
<div style="position:absolute;left:102.18px;top:288.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:311.66px" class="cls_039"><span class="cls_039">Oh no! It looks like something went wrong! In fact, this error is an indication that</span></div>
<div style="position:absolute;left:102.18px;top:324.68px" class="cls_039"><span class="cls_039">Config Server is serving secrets from Vault, but that the request hasn’t included the</span></div>
<div style="position:absolute;left:102.18px;top:337.67px" class="cls_039"><span class="cls_039">Vault token.</span></div>
<div style="position:absolute;left:117.55px;top:350.66px" class="cls_039"><span class="cls_039">It’s important that all requests to Vault include an </span><span class="cls_059">X-Vault-Token</span><span class="cls_039"> header in the</span></div>
<div style="position:absolute;left:102.18px;top:363.68px" class="cls_039"><span class="cls_039">request. Rather than configure that token in the Config Server itself, each Config</span></div>
<div style="position:absolute;left:102.18px;top:376.67px" class="cls_039"><span class="cls_039">Server client will need to include the token in an </span><span class="cls_059">X-Config-Token</span><span class="cls_039"> header in all</span></div>
<div style="position:absolute;left:102.18px;top:389.66px" class="cls_039"><span class="cls_039">requests to the Config Server. Config Server will transfer the token it receives in the</span></div>
<div style="position:absolute;left:102.18px;top:402.68px" class="cls_059"><span class="cls_059">X-Config-Token</span><span class="cls_039"> header to the </span><span class="cls_059">X-Vault-Token</span><span class="cls_039"> header in requests it sends to Vault.</span></div>
<div style="position:absolute;left:117.87px;top:415.67px" class="cls_039"><span class="cls_039">As you can see, for lack of a token in the request, Config Server will refuse to</span></div>
<div style="position:absolute;left:102.18px;top:428.66px" class="cls_039"><span class="cls_039">serve any properties, even those from Git, because Vault demands a token before</span></div>
<div style="position:absolute;left:102.18px;top:441.68px" class="cls_039"><span class="cls_039">divulging any of its secrets. This is an interesting side effect of using Vault alongside</span></div>
<div style="position:absolute;left:102.18px;top:454.67px" class="cls_039"><span class="cls_039">Git—even Git properties are indirectly hidden by the Config Server unless a valid</span></div>
<div style="position:absolute;left:102.18px;top:467.66px" class="cls_039"><span class="cls_039">token is provided.</span></div>
<div style="position:absolute;left:116.78px;top:480.68px" class="cls_039"><span class="cls_039">Try it again, this time adding an </span><span class="cls_059">X-Config-Token</span><span class="cls_039"> header to the request:</span></div>
<div style="position:absolute;left:102.18px;top:503.36px" class="cls_060"><span class="cls_060">$ curl localhost:8888/application/default</span></div>
<div style="position:absolute;left:140.56px;top:513.35px" class="cls_061"><span class="cls_061">-H"X-Config-Token: roottoken" | jq</span></div>
<div style="position:absolute;left:102.18px;top:536.66px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">X-Config-Token</span><span class="cls_039"> header in the request should yield better results, including the</span></div>
<div style="position:absolute;left:102.18px;top:549.68px" class="cls_039"><span class="cls_039">secrets you’ve written to Vault. The token given here is the root token you specified</span></div>
<div style="position:absolute;left:102.18px;top:562.67px" class="cls_039"><span class="cls_039">when starting the Vault server in development mode, although it could be any token</span></div>
<div style="position:absolute;left:102.18px;top:575.69px" class="cls_039"><span class="cls_039">created within the Vault server that’s valid, non-expired, and that has been granted</span></div>
<div style="position:absolute;left:102.18px;top:588.68px" class="cls_039"><span class="cls_039">access to the Vault secret backend.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:255524px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background386.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">364</span></div>
<div style="position:absolute;left:193.29px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 14</span></div>
<div style="position:absolute;left:242.25px;top:24.35px" class="cls_055"><span class="cls_055">Managing configuration</span></div>
<div style="position:absolute;left:93.18px;top:50.84px" class="cls_064"><span class="cls_064">S</span><span class="cls_065">ETTING</span><span class="cls_064"> </span><span class="cls_065">THE</span><span class="cls_064"> V</span><span class="cls_065">AULT</span><span class="cls_064"> </span><span class="cls_065">TOKEN</span><span class="cls_064"> </span><span class="cls_065">IN</span><span class="cls_064"> C</span><span class="cls_065">ONFIG</span><span class="cls_064"> S</span><span class="cls_065">ERVER</span><span class="cls_064"> </span><span class="cls_065">CLIENTS</span></div>
<div style="position:absolute;left:93.18px;top:63.17px" class="cls_039"><span class="cls_039">Obviously, you won’t be able to use curl in each of your microservices to specify the</span></div>
<div style="position:absolute;left:93.18px;top:76.16px" class="cls_039"><span class="cls_039">token when consuming properties from the Config Server. Instead, you’ll need to add</span></div>
<div style="position:absolute;left:93.18px;top:89.15px" class="cls_039"><span class="cls_039">a little bit of configuration to each of your service application’s local configuration:</span></div>
<div style="position:absolute;left:93.18px;top:108.83px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:102.78px;top:118.82px" class="cls_060"><span class="cls_060">cloud:</span></div>
<div style="position:absolute;left:112.38px;top:128.84px" class="cls_060"><span class="cls_060">config:</span></div>
<div style="position:absolute;left:121.95px;top:138.83px" class="cls_061"><span class="cls_061">token: roottoken</span></div>
<div style="position:absolute;left:93.18px;top:160.16px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">spring.cloud.config.token</span><span class="cls_039"> property tells the Config Server client to include</span></div>
<div style="position:absolute;left:93.18px;top:173.15px" class="cls_039"><span class="cls_039">the given token value in all requests it makes to the Config Server. This property</span></div>
<div style="position:absolute;left:93.18px;top:186.17px" class="cls_039"><span class="cls_039">must be set in the application’s local configuration (not stored in Config Server’s</span></div>
<div style="position:absolute;left:93.18px;top:199.16px" class="cls_039"><span class="cls_039">Git or Vault backend) so that Config Server can pass it along to Vault and be able to</span></div>
<div style="position:absolute;left:93.18px;top:212.15px" class="cls_039"><span class="cls_039">serve properties.</span></div>
<div style="position:absolute;left:93.18px;top:230.33px" class="cls_064"><span class="cls_064">W</span><span class="cls_065">RITING</span><span class="cls_064"> </span><span class="cls_065">APPLICATION</span><span class="cls_064">- </span><span class="cls_065">AND</span><span class="cls_064"> </span><span class="cls_065">PROFILE</span><span class="cls_064">-</span><span class="cls_065">SPECIFIC</span><span class="cls_064"> </span><span class="cls_065">SECRETS</span></div>
<div style="position:absolute;left:93.18px;top:242.66px" class="cls_039"><span class="cls_039">When served by Config Server, secrets written to the </span><span class="cls_059">application</span><span class="cls_039"> path will be served</span></div>
<div style="position:absolute;left:93.18px;top:255.65px" class="cls_039"><span class="cls_039">to all applications, regardless of their name. If you need to write secrets that are spe-</span></div>
<div style="position:absolute;left:93.18px;top:268.67px" class="cls_039"><span class="cls_039">cific to a given application, replace the </span><span class="cls_059">application</span><span class="cls_039"> portion of the path with the</span></div>
<div style="position:absolute;left:93.18px;top:281.66px" class="cls_039"><span class="cls_039">application name. For example, the following </span><span class="cls_059">vault write</span><span class="cls_039"> command will write a</span></div>
<div style="position:absolute;left:93.18px;top:294.68px" class="cls_039"><span class="cls_039">secret specific to an application whose name (as identified by its </span><span class="cls_059">spring.application</span></div>
<div style="position:absolute;left:93.18px;top:307.67px" class="cls_059"><span class="cls_059">.name</span><span class="cls_039"> property) is </span><span class="cls_059">ingredient-service</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:327.35px" class="cls_060"><span class="cls_060">$ vault write secret/ingredient-service \</span></div>
<div style="position:absolute;left:160.35px;top:337.34px" class="cls_061"><span class="cls_061">spring.data.mongodb.password=s3cr3t</span></div>
<div style="position:absolute;left:93.18px;top:358.67px" class="cls_039"><span class="cls_039">Similarly, if you don’t specify a profile, secrets written to Vault will be served as part of</span></div>
<div style="position:absolute;left:93.18px;top:371.66px" class="cls_039"><span class="cls_039">the default profile. That is, clients will receive those secrets regardless of what their</span></div>
<div style="position:absolute;left:93.18px;top:384.68px" class="cls_039"><span class="cls_039">active profile may be. You may, however, write secrets to a specific profile like this:</span></div>
<div style="position:absolute;left:93.18px;top:404.36px" class="cls_060"><span class="cls_060">% vault write secret/application,production \</span></div>
<div style="position:absolute;left:160.35px;top:414.35px" class="cls_060"><span class="cls_060">spring.data.mongodb.password=s3cr3t \</span></div>
<div style="position:absolute;left:160.35px;top:424.34px" class="cls_061"><span class="cls_061">spring.data.mongodb.username=tacocloud</span></div>
<div style="position:absolute;left:93.18px;top:445.67px" class="cls_039"><span class="cls_039">This writes the secrets such that they will only be served to applications whose active</span></div>
<div style="position:absolute;left:93.18px;top:458.66px" class="cls_039"><span class="cls_039">profile is </span><span class="cls_059">production</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:57.18px;top:482.83px" class="cls_040"><span class="cls_040">14.6</span></div>
<div style="position:absolute;left:93.18px;top:482.83px" class="cls_040"><span class="cls_040">Refreshing configuration properties on the fly</span></div>
<div style="position:absolute;left:93.18px;top:500.66px" class="cls_039"><span class="cls_039">As I’m writing this chapter, I’m on a plane that was pulled back to the gate for a main-</span></div>
<div style="position:absolute;left:93.18px;top:513.68px" class="cls_039"><span class="cls_039">tenance issue. It was nothing serious, and if you’re reading this, you know that the</span></div>
<div style="position:absolute;left:93.18px;top:526.67px" class="cls_039"><span class="cls_039">mechanics did their job satisfactorily. Even so, the interesting thing about mainte-</span></div>
<div style="position:absolute;left:93.18px;top:539.66px" class="cls_039"><span class="cls_039">nance on an airplane is that it requires the plane to be on the ground. There’s not</span></div>
<div style="position:absolute;left:93.18px;top:552.68px" class="cls_039"><span class="cls_039">much that can be done while in flight.</span></div>
<div style="position:absolute;left:107.82px;top:565.67px" class="cls_039"><span class="cls_039">In contrast, in the </span><span class="cls_036">Star Wars</span><span class="cls_039"> movies, if Luke Skywalker’s or Poe Dameron’s X-Wing</span></div>
<div style="position:absolute;left:93.18px;top:578.69px" class="cls_039"><span class="cls_039">Fighter needed maintenance, the onboard mech droid could be deployed to address</span></div>
<div style="position:absolute;left:93.18px;top:591.68px" class="cls_039"><span class="cls_039">the issue, even while the X-Wing was in battle.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:256200px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background387.jpg" width="531" height="666"></div>
<div style="position:absolute;left:190.02px;top:24.35px" class="cls_055"><span class="cls_055">Refreshing configuration properties on the fly</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">365</span></div>
<div style="position:absolute;left:118.65px;top:50.66px" class="cls_039"><span class="cls_039">Traditionally, application maintenance, including configuration changes, has</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">required that an application be redeployed or at least restarted. The application</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">would need to be brought back to the gate, so to speak, for lack of a mech droid to</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">adjust even the smallest configuration property. But that’s unacceptable for cloud-</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">native applications. We’d like to be able to change configuration properties on the fly,</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">without even bringing the application down.</span></div>
<div style="position:absolute;left:117.18px;top:128.66px" class="cls_039"><span class="cls_039">Fortunately, Spring Cloud Config Server supports the ability to refresh configura-</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">tion properties of running applications with zero downtime. Once the changes have</span></div>
<div style="position:absolute;left:102.18px;top:154.67px" class="cls_039"><span class="cls_039">been pushed to the backing Git repository or Vault secret store, each microservice in</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">the application can immediately be refreshed with the new configuration in one of</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">two ways:</span></div>
<div style="position:absolute;left:117.78px;top:197.66px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Manual</span><span class="cls_039">—The Config Server client enables a special Actuator endpoint at</span></div>
<div style="position:absolute;left:129.78px;top:210.65px" class="cls_039"><span class="cls_039">/actuator/refresh. An HTTP </span><span class="cls_059">POST</span><span class="cls_039"> request to that endpoint on each service will</span></div>
<div style="position:absolute;left:129.78px;top:223.67px" class="cls_039"><span class="cls_039">force the config client to retrieve the latest configuration from its backends.</span></div>
<div style="position:absolute;left:117.78px;top:237.65px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Automatic</span><span class="cls_039">—A commit hook in the Git repository can trigger a refresh on all ser-</span></div>
<div style="position:absolute;left:129.78px;top:250.67px" class="cls_039"><span class="cls_039">vices that are clients of the Config Server. This involves another Spring Cloud</span></div>
<div style="position:absolute;left:129.78px;top:263.66px" class="cls_039"><span class="cls_039">project called Spring Cloud Bus for communicating between the Config Server</span></div>
<div style="position:absolute;left:129.78px;top:276.65px" class="cls_039"><span class="cls_039">and its clients.</span></div>
<div style="position:absolute;left:102.18px;top:294.68px" class="cls_039"><span class="cls_039">Each option has its pros and cons. Manual refresh gives more precise control over</span></div>
<div style="position:absolute;left:102.18px;top:307.67px" class="cls_039"><span class="cls_039">when services are updated with fresh configuration, but it requires an individual</span></div>
<div style="position:absolute;left:102.18px;top:320.66px" class="cls_039"><span class="cls_039">HTTP request to be issued to each instance of each microservice. Automatic refresh</span></div>
<div style="position:absolute;left:102.18px;top:333.68px" class="cls_039"><span class="cls_039">applies updated configuration instantly to all microservices in an application, but it’s</span></div>
<div style="position:absolute;left:102.18px;top:346.67px" class="cls_039"><span class="cls_039">ultimately triggered from a commit to the configuration repository, which may be a</span></div>
<div style="position:absolute;left:102.18px;top:359.66px" class="cls_039"><span class="cls_039">bit too scary for some projects.</span></div>
<div style="position:absolute;left:117.90px;top:372.68px" class="cls_039"><span class="cls_039">Let’s take a look at each option. Then I’ll let you decide which you’d prefer to</span></div>
<div style="position:absolute;left:102.18px;top:385.67px" class="cls_039"><span class="cls_039">apply in your projects.</span></div>
<div style="position:absolute;left:66.18px;top:407.48px" class="cls_063"><span class="cls_063">14.6.1</span></div>
<div style="position:absolute;left:102.18px;top:407.48px" class="cls_063"><span class="cls_063">Manually refreshing configuration properties</span></div>
<div style="position:absolute;left:102.18px;top:424.67px" class="cls_039"><span class="cls_039">In chapter 16, we’re going to look at the Spring Boot Actuator, one of the founda-</span></div>
<div style="position:absolute;left:102.18px;top:437.66px" class="cls_039"><span class="cls_039">tional elements of Spring Boot that enables runtime insight and some limited manip-</span></div>
<div style="position:absolute;left:102.18px;top:450.68px" class="cls_039"><span class="cls_039">ulation of runtime state, such as logging levels. But for now, we’ll look at a specific</span></div>
<div style="position:absolute;left:102.18px;top:463.67px" class="cls_039"><span class="cls_039">Actuator feature that’s only enabled in applications that are configured as Spring</span></div>
<div style="position:absolute;left:102.18px;top:476.66px" class="cls_039"><span class="cls_039">Cloud Config Server clients.</span></div>
<div style="position:absolute;left:117.12px;top:489.68px" class="cls_039"><span class="cls_039">Whenever you enable an application to be a client of the Config Server, the auto-</span></div>
<div style="position:absolute;left:102.18px;top:502.67px" class="cls_039"><span class="cls_039">configuration in play also configures a special Actuator endpoint for refreshing con-</span></div>
<div style="position:absolute;left:102.18px;top:515.66px" class="cls_039"><span class="cls_039">figuration properties. To make use of this endpoint, you’ll need to include the</span></div>
<div style="position:absolute;left:102.18px;top:528.68px" class="cls_039"><span class="cls_039">Actuator starter dependency along with the Config Client dependency in your proj-</span></div>
<div style="position:absolute;left:102.18px;top:541.67px" class="cls_039"><span class="cls_039">ect’s build:</span></div>
<div style="position:absolute;left:102.18px;top:561.35px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:111.78px;top:571.34px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:111.78px;top:581.36px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:102.18px;top:591.35px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:256876px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background388.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">366</span></div>
<div style="position:absolute;left:193.29px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 14</span></div>
<div style="position:absolute;left:242.25px;top:24.35px" class="cls_055"><span class="cls_055">Managing configuration</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">As you may have guessed, this dependency is also available from the Spring Initializr</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">by checking the Actuator check box.</span></div>
<div style="position:absolute;left:107.81px;top:76.67px" class="cls_039"><span class="cls_039">With the Actuator in play in the running config client application, you can refresh</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">the configuration properties from the backend repositories any time you wish by sub-</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">mitting an HTTP </span><span class="cls_059">POST</span><span class="cls_039"> request to /actuator/refresh.</span></div>
<div style="position:absolute;left:108.56px;top:115.67px" class="cls_039"><span class="cls_039">To see this in action, let’s suppose you have a </span><span class="cls_059">@ConfigurationProperties</span><span class="cls_039">-anno-</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">tated class named </span><span class="cls_059">GreetingProps</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:148.34px" class="cls_060"><span class="cls_060">@ConfigurationProperties(prefix="greeting")</span></div>
<div style="position:absolute;left:93.18px;top:158.33px" class="cls_060"><span class="cls_060">@Component</span></div>
<div style="position:absolute;left:93.18px;top:168.35px" class="cls_060"><span class="cls_060">public class GreetingProps {</span></div>
<div style="position:absolute;left:102.77px;top:178.34px" class="cls_060"><span class="cls_060">private String message;</span></div>
<div style="position:absolute;left:102.78px;top:198.35px" class="cls_060"><span class="cls_060">public String getMessage() {</span></div>
<div style="position:absolute;left:112.38px;top:208.34px" class="cls_060"><span class="cls_060">return message;</span></div>
<div style="position:absolute;left:102.78px;top:218.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.78px;top:238.34px" class="cls_060"><span class="cls_060">public void setMessage(String message) {</span></div>
<div style="position:absolute;left:112.36px;top:248.33px" class="cls_060"><span class="cls_060">this.message = message;</span></div>
<div style="position:absolute;left:102.78px;top:258.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:268.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:290.66px" class="cls_039"><span class="cls_039">Additionally, you also have a controller class that’s injected with </span><span class="cls_059">GreetingProps</span><span class="cls_039"> and</span></div>
<div style="position:absolute;left:93.18px;top:303.68px" class="cls_039"><span class="cls_039">that echoes the value of the </span><span class="cls_059">message</span><span class="cls_039"> property when handling a </span><span class="cls_059">GET</span><span class="cls_039"> request:</span></div>
<div style="position:absolute;left:93.18px;top:323.33px" class="cls_060"><span class="cls_060">@RestController</span></div>
<div style="position:absolute;left:93.18px;top:333.35px" class="cls_060"><span class="cls_060">public class GreetingController {</span></div>
<div style="position:absolute;left:102.77px;top:353.33px" class="cls_060"><span class="cls_060">private final GreetingProps props;</span></div>
<div style="position:absolute;left:102.77px;top:373.34px" class="cls_060"><span class="cls_060">public GreetingController(GreetingProps props) {</span></div>
<div style="position:absolute;left:112.36px;top:383.33px" class="cls_060"><span class="cls_060">this.props = props;</span></div>
<div style="position:absolute;left:102.78px;top:393.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.78px;top:413.36px" class="cls_060"><span class="cls_060">@GetMapping("/hello")</span></div>
<div style="position:absolute;left:102.78px;top:423.35px" class="cls_060"><span class="cls_060">public String message() {</span></div>
<div style="position:absolute;left:112.38px;top:433.34px" class="cls_060"><span class="cls_060">return props.getMessage();</span></div>
<div style="position:absolute;left:102.78px;top:443.36px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:463.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:485.66px" class="cls_039"><span class="cls_039">Meanwhile, in your configuration Git repository, you have an application.yml file that</span></div>
<div style="position:absolute;left:93.18px;top:498.68px" class="cls_039"><span class="cls_039">has the following property set:</span></div>
<div style="position:absolute;left:93.18px;top:518.36px" class="cls_060"><span class="cls_060">greeting:</span></div>
<div style="position:absolute;left:102.77px;top:528.35px" class="cls_061"><span class="cls_061">message: Hello World!</span></div>
<div style="position:absolute;left:93.18px;top:550.67px" class="cls_039"><span class="cls_039">With both the Config Server and this simple hello-world config client running, an</span></div>
<div style="position:absolute;left:93.18px;top:563.69px" class="cls_039"><span class="cls_039">HTTP </span><span class="cls_059">GET</span><span class="cls_039"> request to /hello will yield the following response:</span></div>
<div style="position:absolute;left:93.18px;top:583.34px" class="cls_060"><span class="cls_060">$ curl localhost:8080/hello</span></div>
<div style="position:absolute;left:93.18px;top:593.36px" class="cls_061"><span class="cls_061">Hello World!</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:257552px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background389.jpg" width="531" height="666"></div>
<div style="position:absolute;left:190.02px;top:24.35px" class="cls_055"><span class="cls_055">Refreshing configuration properties on the fly</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">367</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">Now, without restarting either the Config Server or the hello-world application, change</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">the application.yml file and push it into the backend Git repository such that the</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_059"><span class="cls_059">greeting.message</span><span class="cls_039"> property looks like this:</span></div>
<div style="position:absolute;left:102.18px;top:96.32px" class="cls_060"><span class="cls_060">greeting:</span></div>
<div style="position:absolute;left:111.78px;top:106.34px" class="cls_061"><span class="cls_061">message: Hiya folks!</span></div>
<div style="position:absolute;left:102.18px;top:125.66px" class="cls_039"><span class="cls_039">If you make the same </span><span class="cls_059">GET</span><span class="cls_039"> request to the hello-world application, you’ll still get the</span></div>
<div style="position:absolute;left:102.18px;top:138.65px" class="cls_039"><span class="cls_039">same "Hello World!" response, even though the configuration has changed in Git. But</span></div>
<div style="position:absolute;left:102.18px;top:151.67px" class="cls_039"><span class="cls_039">you can force a refresh by </span><span class="cls_059">POST</span><span class="cls_039">ing to the refresh endpoint:</span></div>
<div style="position:absolute;left:102.18px;top:171.35px" class="cls_060"><span class="cls_060">$ curl localhost:53419/actuator/refresh -X POST</span></div>
<div style="position:absolute;left:102.18px;top:181.34px" class="cls_061"><span class="cls_061">["config.client.version","greeting.message"]</span></div>
<div style="position:absolute;left:102.18px;top:200.66px" class="cls_039"><span class="cls_039">Notice that the response includes a JSON array of property names that have changed.</span></div>
<div style="position:absolute;left:102.18px;top:213.65px" class="cls_039"><span class="cls_039">Included in that array is your </span><span class="cls_059">greeting.message</span><span class="cls_039"> property. It also includes a change to</span></div>
<div style="position:absolute;left:102.18px;top:226.67px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">config.client.version</span><span class="cls_039"> property, which contains the hash value of the Git com-</span></div>
<div style="position:absolute;left:102.18px;top:239.66px" class="cls_039"><span class="cls_039">mit that the current configuration comes from. Because the configuration is now</span></div>
<div style="position:absolute;left:102.18px;top:252.65px" class="cls_039"><span class="cls_039">based on a new Git commit, this property will change every time there’s any change in</span></div>
<div style="position:absolute;left:102.18px;top:265.67px" class="cls_039"><span class="cls_039">the backend configuration repository.</span></div>
<div style="position:absolute;left:116.52px;top:278.66px" class="cls_039"><span class="cls_039">The response from the </span><span class="cls_059">POST</span><span class="cls_039"> request tells you that </span><span class="cls_059">greeting.message</span><span class="cls_039"> changed. But</span></div>
<div style="position:absolute;left:102.18px;top:291.68px" class="cls_039"><span class="cls_039">the real proof is when you issue a </span><span class="cls_059">GET</span><span class="cls_039"> request to the /hello path again:</span></div>
<div style="position:absolute;left:102.18px;top:311.33px" class="cls_060"><span class="cls_060">$ curl localhost:8080/hello</span></div>
<div style="position:absolute;left:102.18px;top:321.35px" class="cls_061"><span class="cls_061">Hiya folks!</span></div>
<div style="position:absolute;left:102.18px;top:340.67px" class="cls_039"><span class="cls_039">Without restarting the application or even restarting the Config Server, the applica-</span></div>
<div style="position:absolute;left:102.18px;top:353.66px" class="cls_039"><span class="cls_039">tion is now serving a brand new value for the </span><span class="cls_059">greeting.message</span><span class="cls_039"> property!</span></div>
<div style="position:absolute;left:117.00px;top:366.68px" class="cls_039"><span class="cls_039">The /actuator/refresh endpoint is great when you want full control over when an</span></div>
<div style="position:absolute;left:102.18px;top:379.67px" class="cls_039"><span class="cls_039">update to configuration properties takes place. But if your application is made up of</span></div>
<div style="position:absolute;left:102.18px;top:392.66px" class="cls_039"><span class="cls_039">several microservices (and perhaps several instances of each of those services), it can</span></div>
<div style="position:absolute;left:102.18px;top:405.68px" class="cls_039"><span class="cls_039">be tedious to propagate configuration to all of them. Let’s take a look at how you can</span></div>
<div style="position:absolute;left:102.18px;top:418.67px" class="cls_039"><span class="cls_039">have configuration changes applied automatically, all at once.</span></div>
<div style="position:absolute;left:66.18px;top:440.48px" class="cls_063"><span class="cls_063">14.6.2</span></div>
<div style="position:absolute;left:102.18px;top:440.48px" class="cls_063"><span class="cls_063">Automatically refreshing configuration properties</span></div>
<div style="position:absolute;left:102.18px;top:457.67px" class="cls_039"><span class="cls_039">As an alternative to manually refreshing properties on all Config Server clients in an</span></div>
<div style="position:absolute;left:102.18px;top:470.66px" class="cls_039"><span class="cls_039">application, Config Server can automatically notify all clients of changes to configura-</span></div>
<div style="position:absolute;left:102.18px;top:483.68px" class="cls_039"><span class="cls_039">tion by way of another Spring Cloud project called Spring Cloud Bus. Figure 14.7 illus-</span></div>
<div style="position:absolute;left:102.18px;top:496.67px" class="cls_039"><span class="cls_039">trates how it works.</span></div>
<div style="position:absolute;left:116.78px;top:509.66px" class="cls_039"><span class="cls_039">The property refresh process shown in figure 14.7 can be summarized like this:</span></div>
<div style="position:absolute;left:117.78px;top:526.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  A webhook is created on the configuration Git repository to notify Config</span></div>
<div style="position:absolute;left:129.78px;top:539.66px" class="cls_039"><span class="cls_039">Server of any changes (such as any pushes) to the Git repository. Webhooks are</span></div>
<div style="position:absolute;left:129.78px;top:552.68px" class="cls_039"><span class="cls_039">supported by many Git implementations, including GitHub, GitLab, Bitbucket,</span></div>
<div style="position:absolute;left:129.78px;top:565.67px" class="cls_039"><span class="cls_039">and Gogs.</span></div>
<div style="position:absolute;left:117.78px;top:579.68px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Config Server reacts to webhook </span><span class="cls_059">POST</span><span class="cls_039"> requests by broadcasting a message</span></div>
<div style="position:absolute;left:129.78px;top:592.67px" class="cls_039"><span class="cls_039">regarding the change by way of a message broker, such as RabbitMQ or Kafka.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:258228px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background390.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">368</span></div>
<div style="position:absolute;left:193.29px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 14</span></div>
<div style="position:absolute;left:242.25px;top:24.35px" class="cls_055"><span class="cls_055">Managing configuration</span></div>
<div style="position:absolute;left:418.66px;top:66.94px" class="cls_057"><span class="cls_057">Service A</span></div>
<div style="position:absolute;left:340.94px;top:72.05px" class="cls_101"><span class="cls_101">Message</span></div>
<div style="position:absolute;left:344.71px;top:79.25px" class="cls_101"><span class="cls_101">broker</span></div>
<div style="position:absolute;left:386.27px;top:86.89px" class="cls_102"><span class="cls_102">Update</span></div>
<div style="position:absolute;left:381.97px;top:92.89px" class="cls_102"><span class="cls_102">notification</span></div>
<div style="position:absolute;left:95.92px;top:106.94px" class="cls_103"><span class="cls_103">$ git push …</span></div>
<div style="position:absolute;left:202.06px;top:107.40px" class="cls_102"><span class="cls_102">Webhook</span></div>
<div style="position:absolute;left:382.58px;top:109.84px" class="cls_102"><span class="cls_102">Update</span></div>
<div style="position:absolute;left:304.35px;top:110.58px" class="cls_102"><span class="cls_102">Update</span></div>
<div style="position:absolute;left:341.80px;top:112.74px" class="cls_102"><span class="cls_102">RabbitMQ</span></div>
<div style="position:absolute;left:205.49px;top:113.40px" class="cls_102"><span class="cls_102">“push”</span></div>
<div style="position:absolute;left:300.05px;top:116.58px" class="cls_102"><span class="cls_102">notification</span></div>
<div style="position:absolute;left:378.28px;top:115.84px" class="cls_102"><span class="cls_102">notification</span></div>
<div style="position:absolute;left:418.68px;top:112.16px" class="cls_057"><span class="cls_057">Service B</span></div>
<div style="position:absolute;left:200.62px;top:119.40px" class="cls_102"><span class="cls_102">notification</span></div>
<div style="position:absolute;left:351.33px;top:119.28px" class="cls_102"><span class="cls_102">or</span></div>
<div style="position:absolute;left:249.56px;top:121.27px" class="cls_101"><span class="cls_101">Spring Cloud</span></div>
<div style="position:absolute;left:248.56px;top:128.47px" class="cls_101"><span class="cls_101">Config Server</span></div>
<div style="position:absolute;left:386.27px;top:132.80px" class="cls_102"><span class="cls_102">Update</span></div>
<div style="position:absolute;left:381.97px;top:138.80px" class="cls_102"><span class="cls_102">notification</span></div>
<div style="position:absolute;left:346.91px;top:150.97px" class="cls_102"><span class="cls_102">Kafka</span></div>
<div style="position:absolute;left:418.48px;top:157.20px" class="cls_057"><span class="cls_057">Service C</span></div>
<div style="position:absolute;left:93.18px;top:186.98px" class="cls_053"><span class="cls_053">Figure 14.7</span></div>
<div style="position:absolute;left:142.26px;top:186.98px" class="cls_053"><span class="cls_053">Config Server, along with Spring Cloud Bus, can broadcast changes to applications so</span></div>
<div style="position:absolute;left:93.18px;top:196.97px" class="cls_053"><span class="cls_053">that their properties can be refreshed automatically when there are changes.</span></div>
<div style="position:absolute;left:108.78px;top:226.73px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Individual Config Server client applications subscribed to the notifications</span></div>
<div style="position:absolute;left:120.78px;top:239.72px" class="cls_039"><span class="cls_039">react to the notification messages by refreshing their environments with new</span></div>
<div style="position:absolute;left:120.78px;top:252.74px" class="cls_039"><span class="cls_039">property values from the Config Server.</span></div>
<div style="position:absolute;left:93.18px;top:270.74px" class="cls_039"><span class="cls_039">The effect is that all participating Config Server client applications will always have the</span></div>
<div style="position:absolute;left:93.18px;top:283.73px" class="cls_039"><span class="cls_039">latest configuration property values from Config Server almost immediately following</span></div>
<div style="position:absolute;left:93.18px;top:296.75px" class="cls_039"><span class="cls_039">those changes being pushed to the backend Git repository.</span></div>
<div style="position:absolute;left:107.74px;top:309.74px" class="cls_039"><span class="cls_039">There are several moving parts in play when using automatic property refresh with</span></div>
<div style="position:absolute;left:93.18px;top:322.73px" class="cls_039"><span class="cls_039">Config Server. Let’s review the changes that you’re about to make to get a high-level</span></div>
<div style="position:absolute;left:93.18px;top:335.75px" class="cls_039"><span class="cls_039">understanding of what needs to be done:</span></div>
<div style="position:absolute;left:108.78px;top:352.73px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  You’ll need a message broker available to handle the messaging between Config</span></div>
<div style="position:absolute;left:120.78px;top:365.75px" class="cls_039"><span class="cls_039">Server and its clients. You may choose either RabbitMQ or Kafka.</span></div>
<div style="position:absolute;left:108.78px;top:379.73px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  A webhook will need to be created in the backend Git repository to notify Con-</span></div>
<div style="position:absolute;left:120.78px;top:392.75px" class="cls_039"><span class="cls_039">fig Server of any changes.</span></div>
<div style="position:absolute;left:108.78px;top:406.73px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Config Server will need to be enabled with the Config Server monitor depen-</span></div>
<div style="position:absolute;left:120.78px;top:419.75px" class="cls_039"><span class="cls_039">dency (which provides the endpoint that will handle webhook requests from</span></div>
<div style="position:absolute;left:120.78px;top:432.74px" class="cls_039"><span class="cls_039">the Git repository) and either the RabbitMQ or Kafka Spring Cloud Stream</span></div>
<div style="position:absolute;left:120.78px;top:445.73px" class="cls_039"><span class="cls_039">dependency (for publishing property change messages to the broker).</span></div>
<div style="position:absolute;left:108.78px;top:459.74px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Unless the message broker is running locally with the default settings, you’ll</span></div>
<div style="position:absolute;left:120.78px;top:472.73px" class="cls_039"><span class="cls_039">need to configure the details for connecting to the broker in both the Config</span></div>
<div style="position:absolute;left:120.78px;top:485.75px" class="cls_039"><span class="cls_039">Server and in all of its clients.</span></div>
<div style="position:absolute;left:108.78px;top:499.76px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Each Config Server client application will need the Spring Cloud Bus dependency.</span></div>
<div style="position:absolute;left:93.18px;top:517.76px" class="cls_039"><span class="cls_039">I’m going to assume that the prerequisite message broker (RabbitMQ or Kafka … your</span></div>
<div style="position:absolute;left:93.18px;top:530.75px" class="cls_039"><span class="cls_039">choice) is already running and ready to channel property change messages. You’ll start</span></div>
<div style="position:absolute;left:93.18px;top:543.74px" class="cls_039"><span class="cls_039">by applying changes to the Config Server to handle webhook update requests.</span></div>
<div style="position:absolute;left:93.18px;top:561.92px" class="cls_064"><span class="cls_064">C</span><span class="cls_065">REATING</span><span class="cls_064"> </span><span class="cls_065">A</span><span class="cls_064"> </span><span class="cls_065">WEBHOOK</span></div>
<div style="position:absolute;left:93.18px;top:574.25px" class="cls_039"><span class="cls_039">Many Git server implementations support the creation of webhooks to notify applica-</span></div>
<div style="position:absolute;left:93.18px;top:587.24px" class="cls_039"><span class="cls_039">tions of changes, including pushes, to a Git repository. The specifics of setting up</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:258904px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background391.jpg" width="531" height="666"></div>
<div style="position:absolute;left:190.02px;top:24.35px" class="cls_055"><span class="cls_055">Refreshing configuration properties on the fly</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">369</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">webhooks will vary from implementation to implementation, making it difficult to</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">describe them all here. I will, however, show you how to set up a webhook for a</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">Gogs repository.</span></div>
<div style="position:absolute;left:117.70px;top:89.66px" class="cls_039"><span class="cls_039">I choose Gogs because it’s easy to run locally and to have a webhook to </span><span class="cls_059">POST</span><span class="cls_039"> to</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">your locally running application</span></div>
<div style="position:absolute;left:257.30px;top:102.65px" class="cls_039"><span class="cls_039">(something that’s difficult with GitHub). Also,</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">because the process for setting up a webhook with Gogs is almost identical to that for</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">GitHub, describing the Gogs process will indirectly give you the steps needed to set up</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">a webhook for GitHub.</span></div>
<div style="position:absolute;left:117.24px;top:154.67px" class="cls_039"><span class="cls_039">First, visit your configuration repository in the web browser and click the Settings</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">link, as shown in figure 14.8. (The location of the Settings link is slightly different in</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">GitHub, but it has a similar appearance.)</span></div>
<div style="position:absolute;left:333.98px;top:279.78px" class="cls_081"><span class="cls_081">Click Settings</span></div>
<div style="position:absolute;left:102.18px;top:306.26px" class="cls_053"><span class="cls_053">Figure 14.8</span></div>
<div style="position:absolute;left:151.62px;top:306.26px" class="cls_053"><span class="cls_053">Click the Settings button in Gogs or GitHub to get started creating a webhook.</span></div>
<div style="position:absolute;left:102.18px;top:336.05px" class="cls_039"><span class="cls_039">This will take you to the repository’s settings page, which includes a menu of settings</span></div>
<div style="position:absolute;left:102.18px;top:349.07px" class="cls_039"><span class="cls_039">categories on the left. Choose the Webhooks item from the menu. This will display a</span></div>
<div style="position:absolute;left:102.18px;top:362.06px" class="cls_039"><span class="cls_039">page similar to what’s shown in figure 14.9.</span></div>
<div style="position:absolute;left:297.30px;top:507.94px" class="cls_081"><span class="cls_081">...click add webhook</span></div>
<div style="position:absolute;left:310.81px;top:516.94px" class="cls_081"><span class="cls_081">and choose Gogs</span></div>
<div style="position:absolute;left:203.16px;top:528.57px" class="cls_081"><span class="cls_081">Choose webhooks</span></div>
<div style="position:absolute;left:203.16px;top:537.57px" class="cls_081"><span class="cls_081">and then...</span></div>
<div style="position:absolute;left:102.18px;top:583.79px" class="cls_053"><span class="cls_053">Figure 14.9</span></div>
<div style="position:absolute;left:151.61px;top:583.79px" class="cls_053"><span class="cls_053">The Add Webhook button under the Webhooks menu opens the form for creating a</span></div>
<div style="position:absolute;left:102.18px;top:593.78px" class="cls_053"><span class="cls_053">webhook.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:259580px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background392.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">370</span></div>
<div style="position:absolute;left:193.29px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 14</span></div>
<div style="position:absolute;left:242.25px;top:24.35px" class="cls_055"><span class="cls_055">Managing configuration</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">From the webhooks settings page, click the Add Webhook button. In Gogs, this will</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">produce a dropdown list of options for different types of webhooks. Select the Gogs</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">option, as shown in figure 14.9. You’ll then be presented with a form to create a new</span></div>
<div style="position:absolute;left:93.18px;top:89.48px" class="cls_039"><span class="cls_039">webhook, as shown in figure 14.10.</span><span class="cls_069"><sup>1</sup></span></div>
<div style="position:absolute;left:57.18px;top:480.02px" class="cls_053"><span class="cls_053">Figure 14.10</span></div>
<div style="position:absolute;left:111.40px;top:480.02px" class="cls_053"><span class="cls_053">To create a webhook, specify the Config Server’s /monitor URL and JSON payload.</span></div>
<div style="position:absolute;left:93.18px;top:512.39px" class="cls_039"><span class="cls_039">The Add Webhook form has several fields, but the two most significant are Payload</span></div>
<div style="position:absolute;left:93.18px;top:525.38px" class="cls_039"><span class="cls_039">URL and Content Type. Soon you’ll be outfitting Config Server to handle webhook</span></div>
<div style="position:absolute;left:93.18px;top:538.40px" class="cls_059"><span class="cls_059">POST</span><span class="cls_039"> requests. When you do, Config Server will be able to handle webhook requests at</span></div>
<div style="position:absolute;left:93.18px;top:551.39px" class="cls_039"><span class="cls_039">a path of /monitor. Therefore, the Payload URL field should be set with a URL that</span></div>
<div style="position:absolute;left:57.18px;top:583.01px" class="cls_070"><span class="cls_070">1</span></div>
<div style="position:absolute;left:66.18px;top:583.19px" class="cls_071"><span class="cls_071">GitHub doesn’t have a dropdown list of webhook options. Instead, you’ll be taken directly to the webhook</span></div>
<div style="position:absolute;left:66.18px;top:592.67px" class="cls_071"><span class="cls_071">creation form after clicking Add Webhook.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:260256px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background393.jpg" width="531" height="666"></div>
<div style="position:absolute;left:190.02px;top:24.35px" class="cls_055"><span class="cls_055">Refreshing configuration properties on the fly</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">371</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">references the /monitor endpoint on your Config Server. Because I’m running</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">Gogs in a Docker container, the URL I’ve given in figure 14.10 is </span><a href="http://host.docker.internal:8888/monitor">http://host.docker</a> </div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_045"><span class="cls_045"> </span><a href="http://host.docker.internal:8888/monitor">.internal:8888/monitor</a> <span class="cls_039">, which has a hostname of host.docker.internal. This hostname</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">enables the Gog server to see past the boundaries of its container to the Config Server</span></div>
<div style="position:absolute;left:102.18px;top:102.47px" class="cls_039"><span class="cls_039">running on the host machine.</span><span class="cls_069"><sup>2</sup></span></div>
<div style="position:absolute;left:116.91px;top:115.67px" class="cls_039"><span class="cls_039">I’ve also set the Content Type field to </span><span class="cls_059">application/json</span><span class="cls_039">. This is important because</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">the Config Server’s /monitor endpoint doesn’t support application/x-www-form-</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">urlencoded, the other option for content type.</span></div>
<div style="position:absolute;left:116.97px;top:154.67px" class="cls_039"><span class="cls_039">If set, the Secret field will include a header in the webhook </span><span class="cls_059">POST</span><span class="cls_039"> request named</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_059"><span class="cls_059">X-Gogs-Signature</span><span class="cls_039"> (or </span><span class="cls_059">X-Hub-Signature</span><span class="cls_039"> in the case of GitHub) that contains an</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">HMAC-SHA256 digest (or HMAC-SHA1 for GitHub) with the given secret. At this</span></div>
<div style="position:absolute;left:102.18px;top:193.67px" class="cls_039"><span class="cls_039">time, Config Server’s /monitor endpoint doesn’t recognize the signature header, so</span></div>
<div style="position:absolute;left:102.18px;top:206.66px" class="cls_039"><span class="cls_039">you can leave this field blank.</span></div>
<div style="position:absolute;left:116.71px;top:219.65px" class="cls_039"><span class="cls_039">Finally, you only care about push requests to the configuration repository, and you</span></div>
<div style="position:absolute;left:102.18px;top:232.67px" class="cls_039"><span class="cls_039">certainly wish for the webhook to be active, so you make sure that the Just the Push</span></div>
<div style="position:absolute;left:102.18px;top:245.66px" class="cls_039"><span class="cls_039">Event radio button and the Active check box are selected. Click the Add Webhook</span></div>
<div style="position:absolute;left:102.18px;top:258.65px" class="cls_039"><span class="cls_039">button at the end of the form, and the webhook will be created and will start sending</span></div>
<div style="position:absolute;left:102.18px;top:271.67px" class="cls_059"><span class="cls_059">POST</span><span class="cls_039"> requests to the Config Server for every push made to the repository.</span></div>
<div style="position:absolute;left:118.04px;top:284.66px" class="cls_039"><span class="cls_039">Now you must enable the /monitor endpoint in Config Server to handle those</span></div>
<div style="position:absolute;left:102.18px;top:297.68px" class="cls_039"><span class="cls_039">requests.</span></div>
<div style="position:absolute;left:102.18px;top:315.83px" class="cls_064"><span class="cls_064">H</span><span class="cls_065">ANDLING</span><span class="cls_064"> </span><span class="cls_065">WEBHOOK</span><span class="cls_064"> </span><span class="cls_065">UPDATES</span><span class="cls_064"> </span><span class="cls_065">IN</span><span class="cls_064"> C</span><span class="cls_065">ONFIG</span><span class="cls_064"> S</span><span class="cls_065">ERVER</span></div>
<div style="position:absolute;left:102.18px;top:328.16px" class="cls_039"><span class="cls_039">Enabling the /monitor endpoint in Config Server is a simple matter of adding the</span></div>
<div style="position:absolute;left:102.18px;top:341.18px" class="cls_039"><span class="cls_039">spring-cloud-config-monitor dependency to the Config Server’s build. In a Maven</span></div>
<div style="position:absolute;left:102.18px;top:354.17px" class="cls_039"><span class="cls_039">pom.xml file, the following dependency will do the trick:</span></div>
<div style="position:absolute;left:102.18px;top:373.85px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:111.78px;top:383.84px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:111.78px;top:393.86px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-cloud-config-monitor&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:102.18px;top:403.85px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:102.18px;top:427.16px" class="cls_039"><span class="cls_039">With that dependency in place, autoconfiguration will kick in to enable the /monitor</span></div>
<div style="position:absolute;left:102.18px;top:440.18px" class="cls_039"><span class="cls_039">endpoint. But it’s no good unless Config Server also has a means of broadcasting the</span></div>
<div style="position:absolute;left:102.18px;top:453.17px" class="cls_039"><span class="cls_039">change notifications. For that, you’ll need to add another dependency for Spring</span></div>
<div style="position:absolute;left:102.18px;top:466.16px" class="cls_039"><span class="cls_039">Cloud Stream.</span></div>
<div style="position:absolute;left:117.54px;top:479.18px" class="cls_039"><span class="cls_039">Spring Cloud Stream is another one of the Spring Cloud projects; it enables the</span></div>
<div style="position:absolute;left:102.18px;top:492.17px" class="cls_039"><span class="cls_039">creation of services that communicate by way of some underlying binding mechanism,</span></div>
<div style="position:absolute;left:102.18px;top:505.16px" class="cls_039"><span class="cls_039">either RabbitMQ or Kafka. The services are written in such a way that they don’t know</span></div>
<div style="position:absolute;left:102.18px;top:518.18px" class="cls_039"><span class="cls_039">much about how they’re being used, and they accept data from the stream for pro-</span></div>
<div style="position:absolute;left:102.18px;top:531.17px" class="cls_039"><span class="cls_039">cessing, return data to the stream for handling by downstream services, or both.</span></div>
<div style="position:absolute;left:117.18px;top:544.16px" class="cls_039"><span class="cls_039">The /monitor endpoint uses Spring Cloud Stream to publish notification messages</span></div>
<div style="position:absolute;left:102.18px;top:557.18px" class="cls_039"><span class="cls_039">to participating Config Server clients. To avoid being hardcoded to any particular</span></div>
<div style="position:absolute;left:66.18px;top:592.49px" class="cls_070"><span class="cls_070">2</span></div>
<div style="position:absolute;left:75.18px;top:592.67px" class="cls_071"><span class="cls_071">In a Docker container, "localhost" means the container itself, not the Docker host.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:260932px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background394.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">372</span></div>
<div style="position:absolute;left:193.29px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 14</span></div>
<div style="position:absolute;left:242.25px;top:24.35px" class="cls_055"><span class="cls_055">Managing configuration</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">messaging implementation, the monitor acts as a Spring Cloud Stream source, pub-</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">lishing messages into the stream and letting the underlying binding mechanism deal</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">with the specifics of sending the messages.</span></div>
<div style="position:absolute;left:108.76px;top:89.66px" class="cls_039"><span class="cls_039">If you’re using RabbitMQ, you’ll need to include the Spring Cloud Stream Rab-</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">bitMQ binding dependency in the Config Server’s build:</span></div>
<div style="position:absolute;left:93.18px;top:122.33px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:132.35px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:142.34px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-cloud-starter-stream-rabbit&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:93.18px;top:152.33px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:93.18px;top:175.67px" class="cls_039"><span class="cls_039">On the other hand, if Kafka’s more your style, you’ll need the following Spring Cloud</span></div>
<div style="position:absolute;left:93.18px;top:188.66px" class="cls_039"><span class="cls_039">Stream Kafka dependency instead:</span></div>
<div style="position:absolute;left:93.18px;top:208.34px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:218.33px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:228.35px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-cloud-starter-stream-kafka&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:93.18px;top:238.34px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:93.18px;top:261.65px" class="cls_039"><span class="cls_039">With the dependencies in place, the Config Server is almost ready to participate in</span></div>
<div style="position:absolute;left:93.18px;top:274.67px" class="cls_039"><span class="cls_039">automatic property refresh. In fact, if your RabbitMQ or Kafka brokers are running</span></div>
<div style="position:absolute;left:93.18px;top:287.66px" class="cls_039"><span class="cls_039">locally and with default settings, the Config Server is good to go. But if your message</span></div>
<div style="position:absolute;left:93.18px;top:300.68px" class="cls_039"><span class="cls_039">brokers are running somewhere other than </span><span class="cls_059">localhost</span><span class="cls_039">, on some nondefault port, or if</span></div>
<div style="position:absolute;left:93.18px;top:313.67px" class="cls_039"><span class="cls_039">you’ve changed the credentials to access the broker, you’ll need to set a few properties</span></div>
<div style="position:absolute;left:93.18px;top:326.66px" class="cls_039"><span class="cls_039">in the Config Server’s own configuration.</span></div>
<div style="position:absolute;left:108.49px;top:339.68px" class="cls_039"><span class="cls_039">For a RabbitMQ binding, the following entries in application.yml can be used to</span></div>
<div style="position:absolute;left:93.18px;top:352.67px" class="cls_039"><span class="cls_039">override the default values:</span></div>
<div style="position:absolute;left:93.18px;top:372.35px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:102.78px;top:382.34px" class="cls_060"><span class="cls_060">rabbitmq:</span></div>
<div style="position:absolute;left:112.38px;top:392.36px" class="cls_060"><span class="cls_060">host: rabbit.tacocloud.com</span></div>
<div style="position:absolute;left:112.38px;top:402.35px" class="cls_060"><span class="cls_060">port: 5672</span></div>
<div style="position:absolute;left:112.38px;top:412.34px" class="cls_060"><span class="cls_060">username: tacocloud</span></div>
<div style="position:absolute;left:112.38px;top:422.36px" class="cls_061"><span class="cls_061">password: s3cr3t</span></div>
<div style="position:absolute;left:93.18px;top:445.67px" class="cls_039"><span class="cls_039">You only need to set the properties that are different for your RabbitMQ broker, even</span></div>
<div style="position:absolute;left:93.18px;top:458.66px" class="cls_039"><span class="cls_039">though you’ve set them all here.</span></div>
<div style="position:absolute;left:107.78px;top:471.68px" class="cls_039"><span class="cls_039">If you’re using Kafka, a similar set of properties is available:</span></div>
<div style="position:absolute;left:93.18px;top:491.36px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:102.78px;top:501.35px" class="cls_060"><span class="cls_060">kafka:</span></div>
<div style="position:absolute;left:112.38px;top:511.34px" class="cls_060"><span class="cls_060">bootstrap-servers:</span></div>
<div style="position:absolute;left:112.38px;top:521.36px" class="cls_060"><span class="cls_060">- kafka.tacocloud.com:9092</span></div>
<div style="position:absolute;left:112.38px;top:531.35px" class="cls_060"><span class="cls_060">- kafka.tacocloud.com:9093</span></div>
<div style="position:absolute;left:112.38px;top:541.34px" class="cls_061"><span class="cls_061">- kafka.tacocloud.com:9094</span></div>
<div style="position:absolute;left:93.18px;top:564.68px" class="cls_039"><span class="cls_039">You may recognize these properties from chapter 8, where we looked at messaging</span></div>
<div style="position:absolute;left:93.18px;top:577.67px" class="cls_039"><span class="cls_039">with Kafka. In fact, configuring RabbitMQ and Kafka backends for automatic refresh</span></div>
<div style="position:absolute;left:93.18px;top:590.69px" class="cls_039"><span class="cls_039">are much the same as for any other use of those brokers in Spring.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:261608px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background395.jpg" width="531" height="666"></div>
<div style="position:absolute;left:190.02px;top:24.35px" class="cls_055"><span class="cls_055">Refreshing configuration properties on the fly</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">373</span></div>
<div style="position:absolute;left:102.18px;top:50.84px" class="cls_064"><span class="cls_064">C</span><span class="cls_065">REATING</span><span class="cls_064"> </span><span class="cls_065">A</span><span class="cls_064"> G</span><span class="cls_065">OGS</span><span class="cls_064"> </span><span class="cls_065">NOTIFICATION</span><span class="cls_064"> </span><span class="cls_065">EXTRACTOR</span></div>
<div style="position:absolute;left:102.18px;top:63.17px" class="cls_039"><span class="cls_039">Each Git implementation has its own take on what the webhook </span><span class="cls_059">POST</span><span class="cls_039"> request should</span></div>
<div style="position:absolute;left:102.18px;top:76.16px" class="cls_039"><span class="cls_039">look like. This makes it important for the /monitor endpoint to be able to understand</span></div>
<div style="position:absolute;left:102.18px;top:89.15px" class="cls_039"><span class="cls_039">different data formats when handling webhook </span><span class="cls_059">POST</span><span class="cls_039"> requests. Under the covers of the</span></div>
<div style="position:absolute;left:102.18px;top:102.17px" class="cls_039"><span class="cls_039">/monitor endpoint is a set of components that examine the </span><span class="cls_059">POST</span><span class="cls_039"> request, try to deter-</span></div>
<div style="position:absolute;left:102.18px;top:115.16px" class="cls_039"><span class="cls_039">mine what kind of Git server the request came from, and map the request data to a</span></div>
<div style="position:absolute;left:102.18px;top:128.15px" class="cls_039"><span class="cls_039">common notification type that’s sent to each client.</span></div>
<div style="position:absolute;left:117.53px;top:141.17px" class="cls_039"><span class="cls_039">Out of the box, Config Server comes with support for several popular Git imple-</span></div>
<div style="position:absolute;left:102.18px;top:154.16px" class="cls_039"><span class="cls_039">mentations, such as GitHub, GitLab, and Bitbucket. If you’re using one of those Git</span></div>
<div style="position:absolute;left:102.18px;top:167.15px" class="cls_039"><span class="cls_039">implementations, nothing special is required. But as I write this, Gogs is not yet offi-</span></div>
<div style="position:absolute;left:102.18px;top:179.96px" class="cls_039"><span class="cls_039">cially supported.</span><span class="cls_069"><sup>3</sup></span><span class="cls_039"> Therefore, you’ll need to include a Gogs-specific notification extractor</span></div>
<div style="position:absolute;left:102.18px;top:193.16px" class="cls_039"><span class="cls_039">in your project if you’re using Gogs as your Git implementation.</span></div>
<div style="position:absolute;left:118.11px;top:206.15px" class="cls_039"><span class="cls_039">The next listing shows the notification extractor implementation that I used in</span></div>
<div style="position:absolute;left:102.18px;top:219.17px" class="cls_039"><span class="cls_039">Taco Cloud for Gogs integration.</span></div>
<div style="position:absolute;left:114.18px;top:242.90px" class="cls_066"><span class="cls_066">Listing 14.1</span></div>
<div style="position:absolute;left:171.67px;top:242.90px" class="cls_066"><span class="cls_066">A Gogs notification extractor implementation</span></div>
<div style="position:absolute;left:102.18px;top:262.73px" class="cls_060"><span class="cls_060">package tacos.gogs;</span></div>
<div style="position:absolute;left:102.18px;top:272.75px" class="cls_060"><span class="cls_060">import java.util.Collection;</span></div>
<div style="position:absolute;left:102.18px;top:282.74px" class="cls_060"><span class="cls_060">import java.util.HashSet;</span></div>
<div style="position:absolute;left:102.18px;top:292.73px" class="cls_060"><span class="cls_060">import java.util.Map;</span></div>
<div style="position:absolute;left:102.18px;top:302.75px" class="cls_060"><span class="cls_060">import java.util.Set;</span></div>
<div style="position:absolute;left:102.18px;top:312.74px" class="cls_060"><span class="cls_060">import org.springframework.cloud.config.monitor.PropertyPathNotification;</span></div>
<div style="position:absolute;left:102.18px;top:322.73px" class="cls_060"><span class="cls_060">import</span></div>
<div style="position:absolute;left:126.18px;top:332.75px" class="cls_060"><span class="cls_060">org.springframework.cloud.config.monitor.PropertyPathNotificationExtractor;</span></div>
<div style="position:absolute;left:102.18px;top:342.74px" class="cls_060"><span class="cls_060">import org.springframework.core.Ordered;</span></div>
<div style="position:absolute;left:102.18px;top:352.73px" class="cls_060"><span class="cls_060">import org.springframework.core.annotation.Order;</span></div>
<div style="position:absolute;left:102.18px;top:362.75px" class="cls_060"><span class="cls_060">import org.springframework.stereotype.Component;</span></div>
<div style="position:absolute;left:102.18px;top:372.74px" class="cls_060"><span class="cls_060">import org.springframework.util.MultiValueMap;</span></div>
<div style="position:absolute;left:102.18px;top:392.75px" class="cls_060"><span class="cls_060">@Component</span></div>
<div style="position:absolute;left:102.18px;top:402.74px" class="cls_060"><span class="cls_060">@Order(Ordered.LOWEST_PRECEDENCE - 300)</span></div>
<div style="position:absolute;left:102.18px;top:412.76px" class="cls_060"><span class="cls_060">public class GogsPropertyPathNotificationExtractor</span></div>
<div style="position:absolute;left:120.73px;top:422.75px" class="cls_060"><span class="cls_060">implements PropertyPathNotificationExtractor {</span></div>
<div style="position:absolute;left:111.45px;top:442.76px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:111.44px;top:452.75px" class="cls_060"><span class="cls_060">public PropertyPathNotification extract(</span></div>
<div style="position:absolute;left:129.99px;top:462.74px" class="cls_060"><span class="cls_060">MultiValueMap&lt;String, String&gt; headers,</span></div>
<div style="position:absolute;left:129.99px;top:472.76px" class="cls_060"><span class="cls_060">Map&lt;String, Object&gt; request) {</span></div>
<div style="position:absolute;left:120.73px;top:482.75px" class="cls_060"><span class="cls_060">if ("push".equals(headers.getFirst("X-Gogs-Event"))) {</span></div>
<div style="position:absolute;left:129.98px;top:492.74px" class="cls_060"><span class="cls_060">if (request.get("commits") instanceof Collection) {</span></div>
<div style="position:absolute;left:139.29px;top:502.76px" class="cls_060"><span class="cls_060">Set&lt;String&gt; paths = new HashSet&lt;&gt;();</span></div>
<div style="position:absolute;left:139.29px;top:512.75px" class="cls_060"><span class="cls_060">@SuppressWarnings("unchecked")</span></div>
<div style="position:absolute;left:139.29px;top:522.74px" class="cls_060"><span class="cls_060">Collection&lt;Map&lt;String, Object&gt;&gt; commits =</span></div>
<div style="position:absolute;left:157.84px;top:532.76px" class="cls_060"><span class="cls_060">(Collection&lt;Map&lt;String, Object&gt;&gt;) request</span></div>
<div style="position:absolute;left:157.83px;top:542.75px" class="cls_060"><span class="cls_060">.get("commits");</span></div>
<div style="position:absolute;left:66.18px;top:573.50px" class="cls_070"><span class="cls_070">3</span></div>
<div style="position:absolute;left:75.18px;top:573.68px" class="cls_071"><span class="cls_071">I submitted a pull request to the Config Server project to add Gogs support. Once it’s merged, this section of</span></div>
<div style="position:absolute;left:75.18px;top:583.19px" class="cls_071"><span class="cls_071">the book will no longer be relevant. See </span><a href="https://github.com/spring-cloud/spring-cloud-config/pull/1003">https://github.com/spring-cloud/spring-cloud-config/pull/1003</a> <span class="cls_071"> for</span></div>
<div style="position:absolute;left:75.18px;top:592.67px" class="cls_071"><span class="cls_071">the status of this pull request.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:262284px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background396.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">374</span></div>
<div style="position:absolute;left:193.29px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 14</span></div>
<div style="position:absolute;left:242.25px;top:24.35px" class="cls_055"><span class="cls_055">Managing configuration</span></div>
<div style="position:absolute;left:130.30px;top:51.32px" class="cls_060"><span class="cls_060">for (Map&lt;String, Object&gt; commit : commits) {</span></div>
<div style="position:absolute;left:139.56px;top:61.34px" class="cls_060"><span class="cls_060">addAllPaths(paths, commit, "added");</span></div>
<div style="position:absolute;left:139.55px;top:71.33px" class="cls_060"><span class="cls_060">addAllPaths(paths, commit, "removed");</span></div>
<div style="position:absolute;left:139.57px;top:81.32px" class="cls_060"><span class="cls_060">addAllPaths(paths, commit, "modified");</span></div>
<div style="position:absolute;left:130.29px;top:91.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:130.29px;top:101.33px" class="cls_060"><span class="cls_060">if (!paths.isEmpty()) {</span></div>
<div style="position:absolute;left:139.56px;top:111.32px" class="cls_060"><span class="cls_060">return new PropertyPathNotification(</span></div>
<div style="position:absolute;left:158.10px;top:121.34px" class="cls_060"><span class="cls_060">paths.toArray(new String[0]));</span></div>
<div style="position:absolute;left:130.29px;top:131.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:120.99px;top:141.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.72px;top:151.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.71px;top:161.33px" class="cls_060"><span class="cls_060">return null;</span></div>
<div style="position:absolute;left:102.45px;top:171.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.47px;top:193.34px" class="cls_060"><span class="cls_060">private void addAllPaths(Set&lt;String&gt; paths,</span></div>
<div style="position:absolute;left:218.40px;top:203.33px" class="cls_060"><span class="cls_060">Map&lt;String, Object&gt; commit,</span></div>
<div style="position:absolute;left:218.40px;top:213.35px" class="cls_060"><span class="cls_060">String name) {</span></div>
<div style="position:absolute;left:111.72px;top:223.34px" class="cls_060"><span class="cls_060">@SuppressWarnings("unchecked")</span></div>
<div style="position:absolute;left:111.72px;top:233.33px" class="cls_060"><span class="cls_060">Collection&lt;String&gt; files =</span></div>
<div style="position:absolute;left:148.84px;top:243.35px" class="cls_060"><span class="cls_060">(Collection&lt;String&gt;) commit.get(name);</span></div>
<div style="position:absolute;left:111.73px;top:253.34px" class="cls_060"><span class="cls_060">if (files != null) {</span></div>
<div style="position:absolute;left:120.99px;top:263.33px" class="cls_060"><span class="cls_060">paths.addAll(files);</span></div>
<div style="position:absolute;left:111.72px;top:273.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.45px;top:283.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:293.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:316.67px" class="cls_039"><span class="cls_039">The details of how </span><span class="cls_059">GogsPropertyPathNotificationExtractor</span><span class="cls_039"> works is mostly irrele-</span></div>
<div style="position:absolute;left:93.18px;top:329.66px" class="cls_039"><span class="cls_039">vant to our discussion and will become even less relevant once Spring Cloud Config</span></div>
<div style="position:absolute;left:93.18px;top:342.68px" class="cls_039"><span class="cls_039">Server includes Gogs support out of the box. Therefore, I won’t dwell on it much and</span></div>
<div style="position:absolute;left:93.18px;top:355.67px" class="cls_039"><span class="cls_039">only include it here as an artifact of interest if you’re using Gogs.</span></div>
<div style="position:absolute;left:93.18px;top:373.85px" class="cls_064"><span class="cls_064">E</span><span class="cls_065">NABLING</span><span class="cls_064"> </span><span class="cls_065">AUTO</span><span class="cls_064">-</span><span class="cls_065">REFRESH</span><span class="cls_064"> </span><span class="cls_065">IN</span><span class="cls_064"> C</span><span class="cls_065">ONFIG</span><span class="cls_064"> S</span><span class="cls_065">ERVER</span><span class="cls_064"> </span><span class="cls_065">CLIENTS</span></div>
<div style="position:absolute;left:93.18px;top:386.18px" class="cls_039"><span class="cls_039">Enabling automatic property refresh in Config Server clients is even easier than in</span></div>
<div style="position:absolute;left:93.18px;top:399.17px" class="cls_039"><span class="cls_039">Config Server itself. Only a single dependency is required:</span></div>
<div style="position:absolute;left:93.18px;top:420.86px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:430.85px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:440.84px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-cloud-starter-bus-amqp&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:93.18px;top:450.86px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:93.18px;top:474.17px" class="cls_039"><span class="cls_039">This adds the AMQP (for example, RabbitMQ) Spring Cloud Bus starter to the build.</span></div>
<div style="position:absolute;left:93.18px;top:487.16px" class="cls_039"><span class="cls_039">If you’re using Kafka, you should use the following dependency instead:</span></div>
<div style="position:absolute;left:93.18px;top:508.85px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:518.84px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:528.86px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-cloud-starter-bus-kafka&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:93.18px;top:538.85px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:93.18px;top:562.19px" class="cls_039"><span class="cls_039">With the appropriate Spring Cloud Bus starter in place, autoconfiguration will kick in</span></div>
<div style="position:absolute;left:93.18px;top:575.18px" class="cls_039"><span class="cls_039">as the application starts up and will automatically bind itself to a RabbitMQ broker or</span></div>
<div style="position:absolute;left:93.18px;top:588.17px" class="cls_039"><span class="cls_039">Kafka cluster running locally. If your RabbitMQ or Kafka is running elsewhere, you’ll</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:262960px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background397.jpg" width="531" height="666"></div>
<div style="position:absolute;left:253.20px;top:24.35px" class="cls_055"><span class="cls_055">Summary</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">375</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">need to configure its details in each client application just as you did for the Config</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">Server itself.</span></div>
<div style="position:absolute;left:118.76px;top:76.67px" class="cls_039"><span class="cls_039">Now that both the Config Server and its clients are configured for automatic</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">refresh, fire everything up and give it a spin by making a change (any change you</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">want) to application.yml. When you push to the Git repository, you’ll immediately see</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">the change take effect in the client applications.</span></div>
<div style="position:absolute;left:102.18px;top:136.84px" class="cls_040"><span class="cls_040">Summary</span></div>
<div style="position:absolute;left:117.78px;top:155.15px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Spring Cloud Config Server offers a centralized source of configuration data to</span></div>
<div style="position:absolute;left:129.78px;top:168.17px" class="cls_039"><span class="cls_039">all microservices that make up a larger microservice-architected application.</span></div>
<div style="position:absolute;left:117.78px;top:182.15px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  The properties served by Config Server are maintained in a backend Git or</span></div>
<div style="position:absolute;left:129.78px;top:195.17px" class="cls_039"><span class="cls_039">Vault repository.</span></div>
<div style="position:absolute;left:117.78px;top:209.15px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  In addition to global properties, which are exposed to all Config Server clients,</span></div>
<div style="position:absolute;left:129.78px;top:222.17px" class="cls_039"><span class="cls_039">Config Server can also serve profile-specific and application-specific properties.</span></div>
<div style="position:absolute;left:117.78px;top:236.15px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Sensitive properties can be kept secret by encrypting them in a backend Git</span></div>
<div style="position:absolute;left:129.78px;top:249.17px" class="cls_039"><span class="cls_039">repository or by storing them as secrets in a Vault backend.</span></div>
<div style="position:absolute;left:117.78px;top:263.15px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Config Server clients can be refreshed with new properties either manually via an</span></div>
<div style="position:absolute;left:129.78px;top:276.17px" class="cls_039"><span class="cls_039">Actuator endpoint or automatically with Spring Cloud Bus and Git webhooks.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:263636px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background398.jpg" width="531" height="666"></div>
<div style="position:absolute;left:261.18px;top:111.83px" class="cls_014"><span class="cls_014">Handling failure</span></div>
<div style="position:absolute;left:327.18px;top:143.84px" class="cls_014"><span class="cls_014">and latency</span></div>
<div style="position:absolute;left:84.18px;top:264.85px" class="cls_049"><span class="cls_049">This chapter covers</span></div>
<div style="position:absolute;left:84.18px;top:283.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Introducing the circuit breaker pattern</span></div>
<div style="position:absolute;left:84.18px;top:298.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Handling failure and latency with Hystrix</span></div>
<div style="position:absolute;left:84.18px;top:313.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Monitoring circuit breakers</span></div>
<div style="position:absolute;left:84.18px;top:328.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Aggregating circuit breaker metrics</span></div>
<div style="position:absolute;left:66.18px;top:397.72px" class="cls_040"><span class="cls_040">15.1</span></div>
<div style="position:absolute;left:102.18px;top:397.72px" class="cls_040"><span class="cls_040">Understanding circuit breakers</span></div>
<div style="position:absolute;left:102.18px;top:415.55px" class="cls_039"><span class="cls_039">The circuit breaker pattern, as made popular in </span><span class="cls_036">Release It!</span><span class="cls_039">, </span><span class="cls_036">2nd edition</span><span class="cls_039">, by Michael</span></div>
<div style="position:absolute;left:102.18px;top:428.54px" class="cls_039"><span class="cls_039">Nygard (Pragmatic Bookshelf, 2018) addresses the reality that the code we write</span></div>
<div style="position:absolute;left:102.18px;top:441.53px" class="cls_039"><span class="cls_039">will fail. What’s important is that when it fails, it fails gracefully. This powerful pat-</span></div>
<div style="position:absolute;left:102.18px;top:454.55px" class="cls_039"><span class="cls_039">tern is even more significant in the context of microservices, where it’s important</span></div>
<div style="position:absolute;left:102.18px;top:467.54px" class="cls_039"><span class="cls_039">to avoid letting failures cascade across a distributed call stack.</span></div>
<div style="position:absolute;left:117.06px;top:480.53px" class="cls_039"><span class="cls_039">The idea of the circuit breaker pattern is relatively simple and is quite similar</span></div>
<div style="position:absolute;left:102.18px;top:493.55px" class="cls_039"><span class="cls_039">to a real-world electrical circuit breaker from which it gets its name. With an elec-</span></div>
<div style="position:absolute;left:102.18px;top:506.54px" class="cls_039"><span class="cls_039">trical circuit breaker, when the switch is in a closed position, the electricity flows</span></div>
<div style="position:absolute;left:102.18px;top:519.56px" class="cls_039"><span class="cls_039">through the circuits in a house, powering lights, televisions, computers, and</span></div>
<div style="position:absolute;left:102.18px;top:532.55px" class="cls_039"><span class="cls_039">appliances. But if there’s any fault in the line, such as a power surge, the circuit</span></div>
<div style="position:absolute;left:102.18px;top:545.54px" class="cls_039"><span class="cls_039">breaker opens, stopping the flow of electricity before it damages electronics or</span></div>
<div style="position:absolute;left:102.18px;top:558.56px" class="cls_039"><span class="cls_039">results in a house fire.</span></div>
<div style="position:absolute;left:257.16px;top:596.99px" class="cls_024"><span class="cls_024">376</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:264312px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background399.jpg" width="531" height="666"></div>
<div style="position:absolute;left:214.83px;top:24.35px" class="cls_055"><span class="cls_055">Understanding circuit breakers</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">377</span></div>
<div style="position:absolute;left:116.58px;top:50.66px" class="cls_039"><span class="cls_039">Likewise, a software circuit breaker starts in a closed state, allowing invocations of a</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">method. If, for any reason, that method fails (perhaps exceeding a defined thresh-</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">old), the circuit opens and invocations are no longer performed against the failing</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">method. Where a software circuit breaker differs, however, is that it provides fallback</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">behavior and is self-correcting.</span></div>
<div style="position:absolute;left:117.73px;top:115.67px" class="cls_039"><span class="cls_039">If the protected method fails within a given threshold of failure, then a fallback</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">method can be called in its place. Once the circuit opens, that fallback method will be</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">called almost exclusively. Every so often, though, a circuit that’s open will enter a half-</span></div>
<div style="position:absolute;left:102.18px;top:154.67px" class="cls_039"><span class="cls_039">open state and attempt to invoke the failing method. If it still fails, the circuit resumes</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">in an open state. If it succeeds, then it’s assumed that the problem has been resolved</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">and the circuit returns to a closed state. Figure 15.1 illustrates the flow of a software</span></div>
<div style="position:absolute;left:102.18px;top:193.67px" class="cls_039"><span class="cls_039">circuit breaker.</span></div>
<div style="position:absolute;left:116.25px;top:220.03px" class="cls_057"><span class="cls_057">Success</span></div>
<div style="position:absolute;left:254.64px;top:220.03px" class="cls_057"><span class="cls_057">Call/fallback</span></div>
<div style="position:absolute;left:182.09px;top:246.03px" class="cls_057"><span class="cls_057">Fail/fallback</span></div>
<div style="position:absolute;left:170.09px;top:255.03px" class="cls_057"><span class="cls_057">(threshold reached)</span></div>
<div style="position:absolute;left:118.37px;top:267.31px" class="cls_057"><span class="cls_057">Closed</span></div>
<div style="position:absolute;left:263.81px;top:267.31px" class="cls_057"><span class="cls_057">Open</span></div>
<div style="position:absolute;left:111.10px;top:315.66px" class="cls_057"><span class="cls_057">Fail/fallback</span></div>
<div style="position:absolute;left:102.83px;top:324.66px" class="cls_057"><span class="cls_057">(under threshold)</span></div>
<div style="position:absolute;left:257.20px;top:385.98px" class="cls_057"><span class="cls_057">Half-open</span></div>
<div style="position:absolute;left:310.89px;top:394.73px" class="cls_053"><span class="cls_053">Figure 15.1</span></div>
<div style="position:absolute;left:360.29px;top:394.73px" class="cls_053"><span class="cls_053">The circuit breaker pattern</span></div>
<div style="position:absolute;left:310.89px;top:404.75px" class="cls_053"><span class="cls_053">enables graceful failure handling.</span></div>
<div style="position:absolute;left:102.18px;top:436.91px" class="cls_039"><span class="cls_039">It can be helpful to think of circuit breakers as a more powerful form of </span><span class="cls_059">try</span><span class="cls_039">/</span><span class="cls_059">catch</span><span class="cls_039">. A</span></div>
<div style="position:absolute;left:102.18px;top:449.93px" class="cls_039"><span class="cls_039">closed circuit is analogous to the </span><span class="cls_059">try</span><span class="cls_039"> block, whereas the fallback method is akin to the</span></div>
<div style="position:absolute;left:102.18px;top:462.92px" class="cls_059"><span class="cls_059">catch</span><span class="cls_039"> block. Unlike </span><span class="cls_059">try</span><span class="cls_039">/</span><span class="cls_059">catch</span><span class="cls_039">, however, circuit breakers are intelligent enough to</span></div>
<div style="position:absolute;left:102.18px;top:475.91px" class="cls_039"><span class="cls_039">route calls to bypass the intended method, always calling the fallback method when</span></div>
<div style="position:absolute;left:102.18px;top:488.93px" class="cls_039"><span class="cls_039">the intended method is failing too frequently.</span></div>
<div style="position:absolute;left:116.62px;top:501.92px" class="cls_039"><span class="cls_039">As I’ve implied, circuit breakers are applied on methods. There could easily be sev-</span></div>
<div style="position:absolute;left:102.18px;top:514.91px" class="cls_039"><span class="cls_039">eral dozen (or more) circuit breakers within a given microservice. Deciding where to</span></div>
<div style="position:absolute;left:102.18px;top:527.93px" class="cls_039"><span class="cls_039">declare circuit breakers in your code is a matter of identifying methods that are sub-</span></div>
<div style="position:absolute;left:102.18px;top:540.92px" class="cls_039"><span class="cls_039">ject to failure. The following categories of methods are certainly candidates for circuit</span></div>
<div style="position:absolute;left:102.18px;top:553.94px" class="cls_039"><span class="cls_039">breakers:</span></div>
<div style="position:absolute;left:117.78px;top:570.92px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Methods that make REST calls—</span><span class="cls_039">These could fail due to the remote service being</span></div>
<div style="position:absolute;left:129.78px;top:583.94px" class="cls_039"><span class="cls_039">unavailable or returning HTTP 500 responses.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:264988px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background400.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">378</span></div>
<div style="position:absolute;left:185.04px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 15</span></div>
<div style="position:absolute;left:233.97px;top:24.35px" class="cls_055"><span class="cls_055">Handling failure and latency</span></div>
<div style="position:absolute;left:108.78px;top:50.66px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Methods that perform database queries—</span><span class="cls_039">These could fail if, for some reason, the</span></div>
<div style="position:absolute;left:120.78px;top:63.65px" class="cls_039"><span class="cls_039">database becomes unresponsive, or if the schema changes in ways that break</span></div>
<div style="position:absolute;left:120.78px;top:76.67px" class="cls_039"><span class="cls_039">the application.</span></div>
<div style="position:absolute;left:108.78px;top:90.65px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Methods that are potentially slow—</span><span class="cls_039">These won’t necessarily fail, but may be consid-</span></div>
<div style="position:absolute;left:120.78px;top:103.67px" class="cls_039"><span class="cls_039">ered unhealthy if they're taking too long to do their job.</span></div>
<div style="position:absolute;left:93.18px;top:121.67px" class="cls_039"><span class="cls_039">That last item highlights another benefit of circuit breakers beyond handling failure.</span></div>
<div style="position:absolute;left:93.18px;top:134.66px" class="cls_039"><span class="cls_039">Latency is also an important concern in microservices, and it’s crucial that an exces-</span></div>
<div style="position:absolute;left:93.18px;top:147.65px" class="cls_039"><span class="cls_039">sively slow method not drag down the performance of the microservice, resulting in</span></div>
<div style="position:absolute;left:93.18px;top:160.67px" class="cls_039"><span class="cls_039">cascading latency to upstream services.</span></div>
<div style="position:absolute;left:109.39px;top:173.66px" class="cls_039"><span class="cls_039">As you can see, the circuit breaker pattern is an incredibly powerful means of</span></div>
<div style="position:absolute;left:93.18px;top:186.65px" class="cls_039"><span class="cls_039">gracefully handling failure and latency in code. How can we apply circuit breakers in</span></div>
<div style="position:absolute;left:93.18px;top:199.67px" class="cls_039"><span class="cls_039">our code? Fortunately, Netflix open source projects provide an answer with the Hys-</span></div>
<div style="position:absolute;left:93.18px;top:212.66px" class="cls_039"><span class="cls_039">trix library.</span></div>
<div style="position:absolute;left:108.45px;top:225.65px" class="cls_039"><span class="cls_039">Netflix Hystrix is a Java implementation of the circuit breaker pattern. Put sim-</span></div>
<div style="position:absolute;left:93.18px;top:238.67px" class="cls_039"><span class="cls_039">ply, a Hystrix circuit breaker is implemented as an aspect applied to a method that</span></div>
<div style="position:absolute;left:93.18px;top:251.66px" class="cls_039"><span class="cls_039">triggers a fallback method should the target method fail. And, to properly imple-</span></div>
<div style="position:absolute;left:93.18px;top:264.65px" class="cls_039"><span class="cls_039">ment the circuit breaker pattern, the aspect also tracks how frequently the target</span></div>
<div style="position:absolute;left:93.18px;top:277.67px" class="cls_039"><span class="cls_039">method fails and then forwards all requests to the fallback if the failure rate exceeds</span></div>
<div style="position:absolute;left:93.18px;top:290.66px" class="cls_039"><span class="cls_039">some threshold.</span></div>
<div style="position:absolute;left:93.18px;top:308.84px" class="cls_064"><span class="cls_064">A </span><span class="cls_065">POINT</span><span class="cls_064"> </span><span class="cls_065">TO</span><span class="cls_064"> </span><span class="cls_065">MAKE</span><span class="cls_064"> </span><span class="cls_065">ABOUT</span><span class="cls_064"> H</span><span class="cls_065">YSTRIX</span><span class="cls_064">'</span><span class="cls_065">S</span><span class="cls_064"> </span><span class="cls_065">NAME</span></div>
<div style="position:absolute;left:93.18px;top:321.17px" class="cls_039"><span class="cls_039">When coming up with the name for their circuit breaker implementation, the devel-</span></div>
<div style="position:absolute;left:93.18px;top:334.16px" class="cls_039"><span class="cls_039">opers at Netflix wanted a name that captured the resilience, defense, and fault toler-</span></div>
<div style="position:absolute;left:93.18px;top:347.18px" class="cls_039"><span class="cls_039">ance that would be provided. They settled on </span><span class="cls_036">Hystrix</span><span class="cls_039">, which happens to be the genus</span></div>
<div style="position:absolute;left:93.18px;top:360.17px" class="cls_039"><span class="cls_039">of what is known as the Old-World porcupine, an animal characterized by its ability to</span></div>
<div style="position:absolute;left:93.18px;top:373.16px" class="cls_039"><span class="cls_039">defend itself with long quills. Also, as explained in the Hystrix FAQ, it’s a cool-sounding</span></div>
<div style="position:absolute;left:93.18px;top:386.18px" class="cls_039"><span class="cls_039">name. When we look at the Hystrix dashboard in section 15.3.1, you’ll get to see how a</span></div>
<div style="position:absolute;left:93.18px;top:399.17px" class="cls_039"><span class="cls_039">porcupine found a position as the project logo.</span></div>
<div style="position:absolute;left:108.97px;top:412.16px" class="cls_039"><span class="cls_039">Spring Cloud Netflix includes support for Hystrix, providing a simple program-</span></div>
<div style="position:absolute;left:93.18px;top:425.18px" class="cls_039"><span class="cls_039">ming model that should be familiar to Spring and Spring Boot developers. Declar-</span></div>
<div style="position:absolute;left:93.18px;top:438.17px" class="cls_039"><span class="cls_039">ing a circuit breaker on a method is a simple matter of annotating the method with</span></div>
<div style="position:absolute;left:93.18px;top:451.16px" class="cls_059"><span class="cls_059">@HystrixCommand</span><span class="cls_039"> and providing a fallback method. Let’s see how to handle failure</span></div>
<div style="position:absolute;left:93.18px;top:464.18px" class="cls_039"><span class="cls_039">gracefully with Hystrix by declaring circuit breakers in your Taco Cloud code.</span></div>
<div style="position:absolute;left:57.18px;top:489.34px" class="cls_040"><span class="cls_040">15.2</span></div>
<div style="position:absolute;left:93.18px;top:489.34px" class="cls_040"><span class="cls_040">Declaring circuit breakers</span></div>
<div style="position:absolute;left:93.18px;top:508.67px" class="cls_039"><span class="cls_039">Before you can declare circuit breakers, you’ll need to add the Spring Cloud Netflix</span></div>
<div style="position:absolute;left:93.18px;top:521.66px" class="cls_039"><span class="cls_039">Hystrix starter to the build specification of each of the services. In a Maven pom.xml</span></div>
<div style="position:absolute;left:93.18px;top:534.68px" class="cls_039"><span class="cls_039">file, the dependency looks like this:</span></div>
<div style="position:absolute;left:93.18px;top:557.36px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:567.35px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:577.34px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:93.18px;top:587.36px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:265664px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background401.jpg" width="531" height="666"></div>
<div style="position:absolute;left:223.89px;top:24.35px" class="cls_055"><span class="cls_055">Declaring circuit breakers</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">379</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">As part of the Spring Cloud portfolio, you’ll also need to declare dependency manage-</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">ment for the Spring Cloud release train in your build. As I write this, the latest release</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">train version is Finchley.SR1. Therefore, the Spring Cloud version should be set as a</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">property, and the following entry should appear in the pom.xml file </span><span class="cls_059">&lt;dependency-</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_059"><span class="cls_059">Management&gt;</span><span class="cls_039"> block:</span></div>
<div style="position:absolute;left:102.18px;top:124.34px" class="cls_060"><span class="cls_060">&lt;properties&gt;</span></div>
<div style="position:absolute;left:111.78px;top:144.35px" class="cls_060"><span class="cls_060">&lt;spring-cloud.version&gt;Finchley.SR1&lt;/spring-cloud.version&gt;</span></div>
<div style="position:absolute;left:102.18px;top:154.34px" class="cls_060"><span class="cls_060">&lt;/properties&gt;</span></div>
<div style="position:absolute;left:102.18px;top:194.33px" class="cls_060"><span class="cls_060">&lt;dependencyManagement&gt;</span></div>
<div style="position:absolute;left:111.78px;top:204.35px" class="cls_060"><span class="cls_060">&lt;dependencies&gt;</span></div>
<div style="position:absolute;left:121.38px;top:214.34px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:130.95px;top:224.33px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:130.95px;top:234.35px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:130.95px;top:244.34px" class="cls_060"><span class="cls_060">&lt;version&gt;${spring-cloud.version}&lt;/version&gt;</span></div>
<div style="position:absolute;left:130.95px;top:254.33px" class="cls_060"><span class="cls_060">&lt;type&gt;pom&lt;/type&gt;</span></div>
<div style="position:absolute;left:130.95px;top:264.35px" class="cls_060"><span class="cls_060">&lt;scope&gt;import&lt;/scope&gt;</span></div>
<div style="position:absolute;left:121.38px;top:274.34px" class="cls_060"><span class="cls_060">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:111.78px;top:284.33px" class="cls_060"><span class="cls_060">&lt;/dependencies&gt;</span></div>
<div style="position:absolute;left:102.18px;top:294.35px" class="cls_061"><span class="cls_061">&lt;/dependencyManagement&gt;</span></div>
<div style="position:absolute;left:114.18px;top:318.68px" class="cls_083"><span class="cls_083">NOTE</span><span class="cls_039">   This starter dependency is also available as a check box with the label</span></div>
<div style="position:absolute;left:114.18px;top:330.68px" class="cls_039"><span class="cls_039">Hystrix in the Initializr when creating a project. If you use the Initializr to add</span></div>
<div style="position:absolute;left:114.18px;top:342.68px" class="cls_039"><span class="cls_039">Hystrix to your project build, then the dependency management block is</span></div>
<div style="position:absolute;left:114.18px;top:354.68px" class="cls_039"><span class="cls_039">automatically created for you.</span></div>
<div style="position:absolute;left:102.18px;top:374.66px" class="cls_039"><span class="cls_039">With the Hystrix starter dependency in place, the next thing you’ll need to do is to</span></div>
<div style="position:absolute;left:102.18px;top:387.68px" class="cls_039"><span class="cls_039">enable Hystrix. The way to do that is to annotate each application’s main configura-</span></div>
<div style="position:absolute;left:102.18px;top:400.67px" class="cls_039"><span class="cls_039">tion class with </span><span class="cls_059">@EnableHystrix</span><span class="cls_039">. For example, to enable Hystrix in the ingredient ser-</span></div>
<div style="position:absolute;left:102.18px;top:413.66px" class="cls_039"><span class="cls_039">vice, you’d annotate </span><span class="cls_059">IngredientServiceApplication</span><span class="cls_039"> like this:</span></div>
<div style="position:absolute;left:102.18px;top:435.35px" class="cls_060"><span class="cls_060">@SpringBootApplication</span></div>
<div style="position:absolute;left:102.18px;top:445.34px" class="cls_060"><span class="cls_060">@EnableHystrix</span></div>
<div style="position:absolute;left:102.18px;top:455.36px" class="cls_060"><span class="cls_060">public class IngredientServiceApplication {</span></div>
<div style="position:absolute;left:102.18px;top:475.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:498.68px" class="cls_039"><span class="cls_039">At this point, Hystrix is enabled in your application. But that only means that all the</span></div>
<div style="position:absolute;left:102.18px;top:511.67px" class="cls_039"><span class="cls_039">pieces are in place for you to declare circuit breakers. You still haven’t declared any</span></div>
<div style="position:absolute;left:102.18px;top:524.66px" class="cls_039"><span class="cls_039">circuit breakers on any of the methods. That’s where the </span><span class="cls_059">@HystrixCommand</span><span class="cls_039"> annota-</span></div>
<div style="position:absolute;left:102.18px;top:537.68px" class="cls_039"><span class="cls_039">tion comes into play.</span></div>
<div style="position:absolute;left:117.61px;top:550.67px" class="cls_039"><span class="cls_039">Any method that's annotated with </span><span class="cls_059">@HystrixCommand</span><span class="cls_039"> will be declared as having a</span></div>
<div style="position:absolute;left:102.18px;top:563.69px" class="cls_039"><span class="cls_039">circuit breaker aspect applied to it. For example, consider the following method that</span></div>
<div style="position:absolute;left:102.18px;top:576.68px" class="cls_039"><span class="cls_039">uses a load-balanced </span><span class="cls_059">RestTemplate</span><span class="cls_039"> to fetch a collection of </span><span class="cls_059">Ingredient</span><span class="cls_039"> objects from</span></div>
<div style="position:absolute;left:102.18px;top:589.67px" class="cls_039"><span class="cls_039">the ingredient service:</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:266340px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background402.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">380</span></div>
<div style="position:absolute;left:185.04px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 15</span></div>
<div style="position:absolute;left:233.97px;top:24.35px" class="cls_055"><span class="cls_055">Handling failure and latency</span></div>
<div style="position:absolute;left:93.18px;top:51.32px" class="cls_060"><span class="cls_060">public Iterable&lt;Ingredient&gt; getAllIngredients() {</span></div>
<div style="position:absolute;left:102.78px;top:61.34px" class="cls_060"><span class="cls_060">ParameterizedTypeReference&lt;List&lt;Ingredient&gt;&gt; stringList =</span></div>
<div style="position:absolute;left:121.96px;top:71.33px" class="cls_060"><span class="cls_060">new ParameterizedTypeReference&lt;List&lt;Ingredient&gt;&gt;() {};</span></div>
<div style="position:absolute;left:102.78px;top:81.32px" class="cls_060"><span class="cls_060">return rest.exchange(</span></div>
<div style="position:absolute;left:121.95px;top:91.34px" class="cls_060"><span class="cls_060">"</span><a href="http://ingredient-service/ingredients" "="">http://ingredient-service/ingredients"</a>, HttpMethod.GET,</div>
<div style="position:absolute;left:121.95px;top:101.33px" class="cls_060"><span class="cls_060">HttpEntity.EMPTY, stringList).getBody();</span></div>
<div style="position:absolute;left:93.18px;top:111.32px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:130.67px" class="cls_039"><span class="cls_039">The call to </span><span class="cls_059">exchange()</span><span class="cls_039"> is a potential cause for trouble. If there’s no service registered in</span></div>
<div style="position:absolute;left:93.18px;top:143.66px" class="cls_039"><span class="cls_039">Eureka as </span><span class="cls_059">ingredient-service</span><span class="cls_039">, or if the request fails for any reason, then a </span><span class="cls_059">RestClient-</span></div>
<div style="position:absolute;left:93.33px;top:156.65px" class="cls_059"><span class="cls_059">Exception</span><span class="cls_039"> (an unchecked exception) will be thrown. Because the exception isn’t being</span></div>
<div style="position:absolute;left:93.18px;top:169.67px" class="cls_039"><span class="cls_039">handled with a </span><span class="cls_059">try</span><span class="cls_039">/</span><span class="cls_059">catch</span><span class="cls_039"> block, the caller must handle the exception. If the caller</span></div>
<div style="position:absolute;left:93.18px;top:182.66px" class="cls_039"><span class="cls_039">doesn’t handle it, then it’ll continue to be thrown upstream in the call stack. If it isn’t</span></div>
<div style="position:absolute;left:93.18px;top:195.65px" class="cls_039"><span class="cls_039">handled at all, then the error cascades to any upstream microservices or clients.</span></div>
<div style="position:absolute;left:107.62px;top:208.67px" class="cls_039"><span class="cls_039">Uncaught exceptions are a challenge in any application, but especially so in micro-</span></div>
<div style="position:absolute;left:93.18px;top:221.66px" class="cls_039"><span class="cls_039">services. When it comes to failures, microservices should apply the Vegas Rule—what</span></div>
<div style="position:absolute;left:93.18px;top:234.65px" class="cls_039"><span class="cls_039">happens in a microservice, stays in a microservice. Declaring a circuit breaker on the</span></div>
<div style="position:absolute;left:93.18px;top:247.67px" class="cls_059"><span class="cls_059">getAllIngredients()</span><span class="cls_039"> method satisfies that rule.</span></div>
<div style="position:absolute;left:107.78px;top:260.66px" class="cls_039"><span class="cls_039">At a minimum, you only need to annotate the method with </span><span class="cls_059">@HystrixCommand</span><span class="cls_039">, and</span></div>
<div style="position:absolute;left:93.18px;top:273.65px" class="cls_039"><span class="cls_039">then provide a fallback method. First, let’s add </span><span class="cls_059">@HystrixCommand</span><span class="cls_039"> to the </span><span class="cls_059">getAllIngre-</span></div>
<div style="position:absolute;left:93.18px;top:286.67px" class="cls_059"><span class="cls_059">dients()</span><span class="cls_039"> method:</span></div>
<div style="position:absolute;left:93.18px;top:306.35px" class="cls_060"><span class="cls_060">@HystrixCommand(fallbackMethod="getDefaultIngredients")</span></div>
<div style="position:absolute;left:93.18px;top:316.34px" class="cls_060"><span class="cls_060">public Iterable&lt;Ingredient&gt; getAllIngredients() {</span></div>
<div style="position:absolute;left:93.18px;top:336.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:355.67px" class="cls_039"><span class="cls_039">With a circuit breaker protecting it from failure, </span><span class="cls_059">getAllIngredients()</span><span class="cls_039"> is fail safe. If,</span></div>
<div style="position:absolute;left:93.18px;top:368.66px" class="cls_039"><span class="cls_039">for any reason, any uncaught exceptions escape from </span><span class="cls_059">getAllIngredients()</span><span class="cls_039">, the cir-</span></div>
<div style="position:absolute;left:93.18px;top:381.68px" class="cls_039"><span class="cls_039">cuit breaker will catch them and redirect the method call to a method named </span><span class="cls_059">get-</span></div>
<div style="position:absolute;left:93.18px;top:394.67px" class="cls_059"><span class="cls_059">DefaultIngredients()</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:108.30px;top:407.66px" class="cls_039"><span class="cls_039">Fallback methods can do anything you want them to do, but the intention is that</span></div>
<div style="position:absolute;left:93.18px;top:420.68px" class="cls_039"><span class="cls_039">they offer backup behavior in the event that the originally intended method is unable</span></div>
<div style="position:absolute;left:93.18px;top:433.67px" class="cls_039"><span class="cls_039">to perform its duties. The only rule for the fallback method is that it has the same sig-</span></div>
<div style="position:absolute;left:93.18px;top:446.66px" class="cls_039"><span class="cls_039">nature (aside from the method name) as the method it’s serving as a backup for.</span></div>
<div style="position:absolute;left:109.82px;top:459.68px" class="cls_039"><span class="cls_039">To meet this requirement, the </span><span class="cls_059">getAllIngredients()</span><span class="cls_039"> method must accept no</span></div>
<div style="position:absolute;left:93.18px;top:472.67px" class="cls_039"><span class="cls_039">parameters and return </span><span class="cls_059">List&lt;Ingredient&gt;</span><span class="cls_039">. The following implementation of </span><span class="cls_059">getAll-</span></div>
<div style="position:absolute;left:93.18px;top:485.66px" class="cls_059"><span class="cls_059">Ingredients()</span><span class="cls_039"> satisfies that rule and returns a default list of ingredients:</span></div>
<div style="position:absolute;left:93.18px;top:505.34px" class="cls_060"><span class="cls_060">private Iterable&lt;Ingredient&gt; getDefaultIngredients() {</span></div>
<div style="position:absolute;left:102.78px;top:515.36px" class="cls_060"><span class="cls_060">List&lt;Ingredient&gt; ingredients = new ArrayList&lt;&gt;();</span></div>
<div style="position:absolute;left:102.78px;top:525.35px" class="cls_060"><span class="cls_060">ingredients.add(new Ingredient(</span></div>
<div style="position:absolute;left:131.56px;top:535.34px" class="cls_060"><span class="cls_060">"FLTO", "Flour Tortilla", Ingredient.Type.WRAP));</span></div>
<div style="position:absolute;left:102.78px;top:545.36px" class="cls_060"><span class="cls_060">ingredients.add(new Ingredient(</span></div>
<div style="position:absolute;left:131.56px;top:555.35px" class="cls_060"><span class="cls_060">"GRBF", "Ground Beef", Ingredient.Type.PROTEIN));</span></div>
<div style="position:absolute;left:102.78px;top:565.34px" class="cls_060"><span class="cls_060">ingredients.add(new Ingredient(</span></div>
<div style="position:absolute;left:131.56px;top:575.36px" class="cls_060"><span class="cls_060">"CHED", "Shredded Cheddar", Ingredient.Type.CHEESE));</span></div>
<div style="position:absolute;left:102.78px;top:585.35px" class="cls_060"><span class="cls_060">return ingredients;</span></div>
<div style="position:absolute;left:93.18px;top:595.34px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:267016px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background403.jpg" width="531" height="666"></div>
<div style="position:absolute;left:223.89px;top:24.35px" class="cls_055"><span class="cls_055">Declaring circuit breakers</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">381</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">Now, if for any reason </span><span class="cls_059">getAllIngredients()</span><span class="cls_039"> fails, the circuit breaker falls back with a</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">call to </span><span class="cls_059">getDefaultIngredients()</span><span class="cls_039">, and the caller will receive a default (albeit limited)</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">list of ingredients.</span></div>
<div style="position:absolute;left:117.63px;top:89.66px" class="cls_039"><span class="cls_039">You might be wondering if a fallback method can itself have a circuit breaker.</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">Although there’s little that could go wrong with </span><span class="cls_059">getDefaultIngredients()</span><span class="cls_039"> as you’ve</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">written it, it’s possible that a more interesting implementation of </span><span class="cls_059">getDefault-</span></div>
<div style="position:absolute;left:102.27px;top:128.66px" class="cls_059"><span class="cls_059">Ingredients()</span><span class="cls_039"> could be a potential point of failure. In that case, you can annotate</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_059"><span class="cls_059">getDefaultIngredients()</span><span class="cls_039"> with </span><span class="cls_059">@HystrixCommand</span><span class="cls_039"> and provide yet another fallback</span></div>
<div style="position:absolute;left:102.18px;top:154.67px" class="cls_039"><span class="cls_039">method. In fact, you can stack up as many fallback methods as make sense, if neces-</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">sary. The only restriction is that there must be one method at the bottom of the fall-</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">back stack that doesn’t fail and doesn’t require a circuit breaker.</span></div>
<div style="position:absolute;left:66.18px;top:202.49px" class="cls_063"><span class="cls_063">15.2.1</span></div>
<div style="position:absolute;left:102.18px;top:202.49px" class="cls_063"><span class="cls_063">Mitigating latency</span></div>
<div style="position:absolute;left:102.18px;top:219.65px" class="cls_039"><span class="cls_039">Circuit breakers can also mitigate latency by timing out if a method is taking too</span></div>
<div style="position:absolute;left:102.18px;top:232.67px" class="cls_039"><span class="cls_039">long to return. By default, all methods annotated with </span><span class="cls_059">@HystrixCommand</span><span class="cls_039"> time out</span></div>
<div style="position:absolute;left:102.18px;top:245.66px" class="cls_039"><span class="cls_039">after 1 second, falling back to their declared fallback method. That means that if,</span></div>
<div style="position:absolute;left:102.18px;top:258.65px" class="cls_039"><span class="cls_039">for some reason, the ingredient service is sluggish in responding, then the call to</span></div>
<div style="position:absolute;left:102.18px;top:271.67px" class="cls_059"><span class="cls_059">getAllIngredients()</span><span class="cls_039"> times out after 1 second, and </span><span class="cls_059">getDefaultIngredients()</span><span class="cls_039"> will</span></div>
<div style="position:absolute;left:102.18px;top:284.66px" class="cls_039"><span class="cls_039">be called instead.</span></div>
<div style="position:absolute;left:117.81px;top:297.68px" class="cls_039"><span class="cls_039">The one-second timeout is a reasonable default and suitable for most use cases.</span></div>
<div style="position:absolute;left:102.18px;top:310.67px" class="cls_039"><span class="cls_039">But you can change it to be more or less restrictive by specifying a Hystrix command</span></div>
<div style="position:absolute;left:102.18px;top:323.66px" class="cls_039"><span class="cls_039">property. Setting Hystrix command properties can be done through the </span><span class="cls_059">command-</span></div>
<div style="position:absolute;left:102.18px;top:336.68px" class="cls_059"><span class="cls_059">Properties</span><span class="cls_039"> attribute of the </span><span class="cls_059">@HystrixCommand</span><span class="cls_039"> annotation. The </span><span class="cls_059">commandProperties</span></div>
<div style="position:absolute;left:102.18px;top:349.67px" class="cls_039"><span class="cls_039">attribute is an array of one or more </span><span class="cls_059">@HystrixProperty</span><span class="cls_039"> annotations that specify a</span></div>
<div style="position:absolute;left:102.18px;top:362.48px" class="cls_039"><span class="cls_039">name and a value of the property to be set.</span><span class="cls_069"><sup>1</sup></span></div>
<div style="position:absolute;left:116.66px;top:375.68px" class="cls_039"><span class="cls_039">In order to tweak the timeout of a circuit breaker, you need to set the Hystrix com-</span></div>
<div style="position:absolute;left:102.18px;top:388.67px" class="cls_039"><span class="cls_039">mand property </span><span class="cls_059">execution.isolation.thread.timeoutInMilliseconds</span><span class="cls_039">. For exam-</span></div>
<div style="position:absolute;left:102.18px;top:401.66px" class="cls_039"><span class="cls_039">ple, to tighten the timeout period on the </span><span class="cls_059">getAllIngredients()</span><span class="cls_039"> method to a half</span></div>
<div style="position:absolute;left:102.18px;top:414.68px" class="cls_039"><span class="cls_039">second, you can set the timeout to </span><span class="cls_059">500</span><span class="cls_039"> as follows:</span></div>
<div style="position:absolute;left:102.18px;top:434.36px" class="cls_060"><span class="cls_060">@HystrixCommand(</span></div>
<div style="position:absolute;left:121.38px;top:444.35px" class="cls_060"><span class="cls_060">fallbackMethod="getDefaultIngredients",</span></div>
<div style="position:absolute;left:121.38px;top:454.34px" class="cls_060"><span class="cls_060">commandProperties={</span></div>
<div style="position:absolute;left:140.55px;top:464.36px" class="cls_060"><span class="cls_060">@HystrixProperty(</span></div>
<div style="position:absolute;left:159.75px;top:474.35px" class="cls_060"><span class="cls_060">name="execution.isolation.thread.timeoutInMilliseconds",</span></div>
<div style="position:absolute;left:159.75px;top:484.34px" class="cls_060"><span class="cls_060">value="500")</span></div>
<div style="position:absolute;left:121.38px;top:494.36px" class="cls_060"><span class="cls_060">})</span></div>
<div style="position:absolute;left:102.18px;top:504.35px" class="cls_060"><span class="cls_060">public Iterable&lt;Ingredient&gt; getAllIngredients() {</span></div>
<div style="position:absolute;left:102.18px;top:524.36px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:545.66px" class="cls_039"><span class="cls_039">The value given is in milliseconds. If you want to loosen up the restriction, you can</span></div>
<div style="position:absolute;left:102.18px;top:558.68px" class="cls_039"><span class="cls_039">set it to some higher value. Or, if you don’t think that there should be a timeout</span></div>
<div style="position:absolute;left:66.18px;top:583.01px" class="cls_070"><span class="cls_070">1</span></div>
<div style="position:absolute;left:75.18px;top:583.19px" class="cls_071"><span class="cls_071">If you’re like me, you’ll agree that using annotations to set attributes of an annotation is weird. Weird or not,</span></div>
<div style="position:absolute;left:75.18px;top:592.67px" class="cls_071"><span class="cls_071">that’s still how it’s done.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:267692px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background404.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">382</span></div>
<div style="position:absolute;left:185.04px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 15</span></div>
<div style="position:absolute;left:233.97px;top:24.35px" class="cls_055"><span class="cls_055">Handling failure and latency</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">imposed, then you can remove the timeout altogether by setting the command prop-</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">erty </span><span class="cls_059">execution.timeout.enabled</span><span class="cls_039"> to </span><span class="cls_059">false</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:86.33px" class="cls_060"><span class="cls_060">@HystrixCommand(</span></div>
<div style="position:absolute;left:112.38px;top:96.32px" class="cls_060"><span class="cls_060">fallbackMethod="getDefaultIngredients",</span></div>
<div style="position:absolute;left:112.38px;top:106.34px" class="cls_060"><span class="cls_060">commandProperties={</span></div>
<div style="position:absolute;left:131.55px;top:116.33px" class="cls_060"><span class="cls_060">@HystrixProperty(</span></div>
<div style="position:absolute;left:150.75px;top:126.35px" class="cls_060"><span class="cls_060">name="execution.timeout.enabled",</span></div>
<div style="position:absolute;left:150.75px;top:136.34px" class="cls_060"><span class="cls_060">value="false")</span></div>
<div style="position:absolute;left:112.38px;top:146.33px" class="cls_060"><span class="cls_060">})</span></div>
<div style="position:absolute;left:93.18px;top:156.35px" class="cls_060"><span class="cls_060">public Iterable&lt;Ingredient&gt; getAllIngredients() {</span></div>
<div style="position:absolute;left:93.18px;top:176.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:200.66px" class="cls_039"><span class="cls_039">When the </span><span class="cls_059">execution.timeout.enabled</span><span class="cls_039"> property is set to </span><span class="cls_059">false</span><span class="cls_039">, there’s no latency</span></div>
<div style="position:absolute;left:93.18px;top:213.65px" class="cls_039"><span class="cls_039">protection. In this case, whether the </span><span class="cls_059">getAllIngredients()</span><span class="cls_039"> method takes 1 second, 10</span></div>
<div style="position:absolute;left:93.18px;top:226.67px" class="cls_039"><span class="cls_039">seconds, or 30 minutes, it won’t time out. This could cause a cascading latency effect,</span></div>
<div style="position:absolute;left:93.18px;top:239.66px" class="cls_039"><span class="cls_039">so care should be taken when disabling execution timeouts.</span></div>
<div style="position:absolute;left:57.18px;top:265.49px" class="cls_063"><span class="cls_063">15.2.2</span></div>
<div style="position:absolute;left:93.18px;top:265.49px" class="cls_063"><span class="cls_063">Managing circuit breaker thresholds</span></div>
<div style="position:absolute;left:93.18px;top:283.16px" class="cls_039"><span class="cls_039">By default, if a circuit breaker protected method is invoked over 20 times, and more</span></div>
<div style="position:absolute;left:93.18px;top:296.18px" class="cls_039"><span class="cls_039">than 50% of those invocations fail over a period of 10 seconds, the circuit will be thrown</span></div>
<div style="position:absolute;left:93.18px;top:309.17px" class="cls_039"><span class="cls_039">into an open state. All subsequent calls will be handled by the fallback method. After</span></div>
<div style="position:absolute;left:93.18px;top:322.16px" class="cls_039"><span class="cls_039">5 seconds, the circuit will enter a half-open state, and the original method will be</span></div>
<div style="position:absolute;left:93.18px;top:335.18px" class="cls_039"><span class="cls_039">attempted again.</span></div>
<div style="position:absolute;left:109.04px;top:348.17px" class="cls_039"><span class="cls_039">You can tweak the failure and retry thresholds by setting the Hystrix command</span></div>
<div style="position:absolute;left:93.18px;top:361.16px" class="cls_039"><span class="cls_039">properties. The following command properties influence the conditions that result in</span></div>
<div style="position:absolute;left:93.18px;top:374.18px" class="cls_039"><span class="cls_039">a circuit breaker being thrown:</span></div>
<div style="position:absolute;left:108.78px;top:393.17px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> circuitBreaker.requestVolumeThreshold</span><span class="cls_039">—The number of times a method</span></div>
<div style="position:absolute;left:120.78px;top:406.16px" class="cls_039"><span class="cls_039">should be called within a given time period</span></div>
<div style="position:absolute;left:108.78px;top:420.17px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> circuitBreaker.errorThresholdPercentage</span><span class="cls_039">—A percentage of failed method</span></div>
<div style="position:absolute;left:120.78px;top:433.16px" class="cls_039"><span class="cls_039">invocations within a given time period</span></div>
<div style="position:absolute;left:108.78px;top:447.17px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> metrics.rollingStats.timeInMilliseconds</span><span class="cls_039">—A rolling time period for which</span></div>
<div style="position:absolute;left:120.78px;top:460.16px" class="cls_039"><span class="cls_039">the request volume and error percentage are considered</span></div>
<div style="position:absolute;left:108.78px;top:474.17px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> circuitBreaker.sleepWindowInMilliseconds</span><span class="cls_039">—How long an open circuit</span></div>
<div style="position:absolute;left:120.78px;top:487.16px" class="cls_039"><span class="cls_039">remains open before entering a half-open state and the original failing method</span></div>
<div style="position:absolute;left:120.78px;top:500.18px" class="cls_039"><span class="cls_039">is attempted again</span></div>
<div style="position:absolute;left:93.18px;top:520.16px" class="cls_039"><span class="cls_039">If  both </span><span class="cls_059"> circuitBreaker.requestVolumeThreshold</span><span class="cls_039">  and </span><span class="cls_059"> circuitBreaker.error-</span></div>
<div style="position:absolute;left:93.18px;top:533.18px" class="cls_059"><span class="cls_059">ThresholdPercentage</span><span class="cls_039"> are exceeded within the time specified in </span><span class="cls_059">metrics.rolling-</span></div>
<div style="position:absolute;left:93.18px;top:546.17px" class="cls_059"><span class="cls_059">State.timeInMilliseconds</span><span class="cls_039">, then the circuit breaker enters an open state. It remains</span></div>
<div style="position:absolute;left:93.18px;top:559.19px" class="cls_039"><span class="cls_039">open for as long as specified by </span><span class="cls_059">circuitBreaker.sleepWindowInMilliseconds</span><span class="cls_039">, at</span></div>
<div style="position:absolute;left:93.18px;top:572.18px" class="cls_039"><span class="cls_039">which point it becomes half open, and the original failing method will be attempted</span></div>
<div style="position:absolute;left:93.18px;top:585.17px" class="cls_039"><span class="cls_039">again.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:268368px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background405.jpg" width="531" height="666"></div>
<div style="position:absolute;left:235.41px;top:24.35px" class="cls_055"><span class="cls_055">Monitoring failures</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">383</span></div>
<div style="position:absolute;left:118.64px;top:50.66px" class="cls_039"><span class="cls_039">For example, suppose that you want to adjust the failure settings such that the</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">method must be invoked more than 30 times and fail more than 25% of the time within</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">20 seconds. For that, you’ll need to set the following Hystrix command properties:</span></div>
<div style="position:absolute;left:102.18px;top:96.32px" class="cls_060"><span class="cls_060">@HystrixCommand(</span></div>
<div style="position:absolute;left:121.38px;top:106.34px" class="cls_060"><span class="cls_060">fallbackMethod="getDefaultIngredients",</span></div>
<div style="position:absolute;left:121.38px;top:116.33px" class="cls_060"><span class="cls_060">commandProperties={</span></div>
<div style="position:absolute;left:140.55px;top:126.35px" class="cls_060"><span class="cls_060">@HystrixProperty(</span></div>
<div style="position:absolute;left:159.75px;top:136.34px" class="cls_060"><span class="cls_060">name="circuitBreaker.requestVolumeThreshold",</span></div>
<div style="position:absolute;left:159.75px;top:146.33px" class="cls_060"><span class="cls_060">value="30"),</span></div>
<div style="position:absolute;left:140.55px;top:156.35px" class="cls_060"><span class="cls_060">@HystrixProperty(</span></div>
<div style="position:absolute;left:159.75px;top:166.34px" class="cls_060"><span class="cls_060">name="circuitBreaker.errorThresholdPercentage",</span></div>
<div style="position:absolute;left:159.75px;top:176.33px" class="cls_060"><span class="cls_060">value="25"),</span></div>
<div style="position:absolute;left:140.55px;top:186.35px" class="cls_060"><span class="cls_060">@HystrixProperty(</span></div>
<div style="position:absolute;left:159.75px;top:196.34px" class="cls_060"><span class="cls_060">name="metrics.rollingStats.timeInMilliseconds",</span></div>
<div style="position:absolute;left:159.75px;top:206.33px" class="cls_060"><span class="cls_060">value="20000")</span></div>
<div style="position:absolute;left:121.38px;top:216.35px" class="cls_060"><span class="cls_060">})</span></div>
<div style="position:absolute;left:102.18px;top:226.34px" class="cls_060"><span class="cls_060">public List&lt;Ingredient&gt; getAllIngredients() {</span></div>
<div style="position:absolute;left:111.76px;top:236.33px" class="cls_060"><span class="cls_060">// ...</span></div>
<div style="position:absolute;left:102.18px;top:246.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:269.66px" class="cls_039"><span class="cls_039">Additionally, should you decide that, once thrown, the circuit breaker must remain</span></div>
<div style="position:absolute;left:102.18px;top:282.65px" class="cls_039"><span class="cls_039">open for up to 1 full minute before becoming half open, then you can also set the</span></div>
<div style="position:absolute;left:102.18px;top:295.67px" class="cls_059"><span class="cls_059">circuitBreaker.sleepWindowInMilliseconds</span><span class="cls_039"> command property:</span></div>
<div style="position:absolute;left:102.18px;top:315.35px" class="cls_060"><span class="cls_060">@HystrixCommand(</span></div>
<div style="position:absolute;left:121.38px;top:325.34px" class="cls_060"><span class="cls_060">fallbackMethod="getDefaultIngredients",</span></div>
<div style="position:absolute;left:121.38px;top:335.33px" class="cls_060"><span class="cls_060">commandProperties={</span></div>
<div style="position:absolute;left:140.55px;top:355.34px" class="cls_060"><span class="cls_060">@HystrixProperty(</span></div>
<div style="position:absolute;left:159.75px;top:365.33px" class="cls_060"><span class="cls_060">name="circuitBreaker.sleepWindowInMilliseconds",</span></div>
<div style="position:absolute;left:159.75px;top:375.35px" class="cls_060"><span class="cls_060">value="60000")</span></div>
<div style="position:absolute;left:121.38px;top:385.34px" class="cls_061"><span class="cls_061">})</span></div>
<div style="position:absolute;left:102.18px;top:408.68px" class="cls_039"><span class="cls_039">Aside from gracefully handling method failures and latency, Hystrix also publishes a</span></div>
<div style="position:absolute;left:102.18px;top:421.67px" class="cls_039"><span class="cls_039">stream of metrics for each circuit breaker in an application. Next up, let’s take a</span></div>
<div style="position:absolute;left:102.18px;top:434.66px" class="cls_039"><span class="cls_039">look at how to monitor the health of a Hystrix-enabled application by way of the</span></div>
<div style="position:absolute;left:102.18px;top:447.68px" class="cls_039"><span class="cls_039">Hystrix stream.</span></div>
<div style="position:absolute;left:66.18px;top:471.85px" class="cls_040"><span class="cls_040">15.3</span></div>
<div style="position:absolute;left:102.18px;top:471.85px" class="cls_040"><span class="cls_040">Monitoring failures</span></div>
<div style="position:absolute;left:102.18px;top:491.18px" class="cls_039"><span class="cls_039">Every time a circuit breaker protected method is invoked, several pieces of data are</span></div>
<div style="position:absolute;left:102.18px;top:504.17px" class="cls_039"><span class="cls_039">collected about the invocation and published in an HTTP stream that can be used to</span></div>
<div style="position:absolute;left:102.18px;top:517.16px" class="cls_039"><span class="cls_039">monitor the health of the running application in real time. Among the data collected</span></div>
<div style="position:absolute;left:102.18px;top:530.18px" class="cls_039"><span class="cls_039">for each circuit breaker, the Hystrix stream includes the following:</span></div>
<div style="position:absolute;left:117.78px;top:547.16px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  How many times the method is called</span></div>
<div style="position:absolute;left:117.78px;top:561.17px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  How many times it’s called successfully</span></div>
<div style="position:absolute;left:117.78px;top:575.18px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  How many times the fallback method is called</span></div>
<div style="position:absolute;left:117.78px;top:589.19px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  How many times the method times out</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:269044px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background406.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">384</span></div>
<div style="position:absolute;left:185.04px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 15</span></div>
<div style="position:absolute;left:233.97px;top:24.35px" class="cls_055"><span class="cls_055">Handling failure and latency</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">The Hystrix stream is provided by an Actuator endpoint. We’ll talk more about Actua-</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">tor in chapter 16. But, for now, the Actuator dependency needs to be added to the</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">build for all the services to enable the Hystrix stream. In a Maven pom.xml file, the fol-</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">lowing starter dependency adds Actuator to a project:</span></div>
<div style="position:absolute;left:93.18px;top:111.32px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:121.34px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:131.33px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:93.18px;top:141.35px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:93.18px;top:164.66px" class="cls_039"><span class="cls_039">The Hystrix stream endpoint is exposed at the path /actuator/hystrix.stream. By</span></div>
<div style="position:absolute;left:93.18px;top:177.65px" class="cls_039"><span class="cls_039">default, most of the Actuator endpoints are disabled. But you can enable the Hystrix</span></div>
<div style="position:absolute;left:93.18px;top:190.67px" class="cls_039"><span class="cls_039">stream endpoint with the following configuration in each application application.yml</span></div>
<div style="position:absolute;left:93.18px;top:203.66px" class="cls_039"><span class="cls_039">file like this:</span></div>
<div style="position:absolute;left:93.18px;top:225.35px" class="cls_060"><span class="cls_060">management:</span></div>
<div style="position:absolute;left:102.78px;top:235.34px" class="cls_060"><span class="cls_060">endpoints:</span></div>
<div style="position:absolute;left:112.38px;top:245.33px" class="cls_060"><span class="cls_060">web:</span></div>
<div style="position:absolute;left:121.95px;top:255.35px" class="cls_060"><span class="cls_060">exposure:</span></div>
<div style="position:absolute;left:131.53px;top:265.34px" class="cls_061"><span class="cls_061">include: hystrix.stream</span></div>
<div style="position:absolute;left:93.18px;top:288.65px" class="cls_039"><span class="cls_039">Optionally, the </span><span class="cls_059">management:endpoints:web:exposure:include</span><span class="cls_039"> property can be made</span></div>
<div style="position:absolute;left:93.18px;top:301.67px" class="cls_039"><span class="cls_039">global for all of your services by placing it in the application.yml configuration proper-</span></div>
<div style="position:absolute;left:93.18px;top:314.66px" class="cls_039"><span class="cls_039">ties that are served by the Config Server.</span></div>
<div style="position:absolute;left:109.81px;top:327.68px" class="cls_039"><span class="cls_039">Application startup exposes the Hystrix stream, which can then be consumed</span></div>
<div style="position:absolute;left:93.18px;top:340.67px" class="cls_039"><span class="cls_039">using any REST client you want. But, before you set out to write a custom Hystrix</span></div>
<div style="position:absolute;left:93.18px;top:353.66px" class="cls_039"><span class="cls_039">stream client, be aware that each entry in the HTTP stream is rich with all kinds of</span></div>
<div style="position:absolute;left:93.18px;top:366.68px" class="cls_039"><span class="cls_039">JSON data, and it’ll require a lot of client-side work to interpret that data. Although</span></div>
<div style="position:absolute;left:93.18px;top:379.67px" class="cls_039"><span class="cls_039">writing your own Hystrix stream presentation client isn’t an impossible task, perhaps</span></div>
<div style="position:absolute;left:93.18px;top:392.66px" class="cls_039"><span class="cls_039">you should consider using the Hystrix dashboard before expending much effort on</span></div>
<div style="position:absolute;left:93.18px;top:405.68px" class="cls_039"><span class="cls_039">your own dashboard.</span></div>
<div style="position:absolute;left:57.18px;top:431.48px" class="cls_063"><span class="cls_063">15.3.1</span></div>
<div style="position:absolute;left:93.18px;top:431.48px" class="cls_063"><span class="cls_063">Introducing the Hystrix dashboard</span></div>
<div style="position:absolute;left:93.18px;top:449.18px" class="cls_039"><span class="cls_039">To use the Hystrix dashboard, you first need to create a new Spring Boot application</span></div>
<div style="position:absolute;left:93.18px;top:462.17px" class="cls_039"><span class="cls_039">with a dependency on the Hystrix dashboard starter. If you’re using the Spring</span></div>
<div style="position:absolute;left:93.18px;top:475.16px" class="cls_039"><span class="cls_039">Boot Initializr to create the project, you’ll select the Hystrix Dashboard check box.</span></div>
<div style="position:absolute;left:93.18px;top:488.18px" class="cls_039"><span class="cls_039">Otherwise, you’ll need to add the following </span><span class="cls_059">&lt;dependency&gt;</span><span class="cls_039"> to your project’s Maven</span></div>
<div style="position:absolute;left:93.18px;top:501.17px" class="cls_039"><span class="cls_039">pom.xml file:</span></div>
<div style="position:absolute;left:93.18px;top:522.86px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:532.85px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:542.84px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-cloud-starter-netflix-hystrix-dashboard&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:93.18px;top:552.86px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:93.18px;top:577.19px" class="cls_039"><span class="cls_039">Once the project has been initialized, you’ll also need to enable the Hystrix dash-</span></div>
<div style="position:absolute;left:93.18px;top:590.18px" class="cls_039"><span class="cls_039">board by annotating the main configuration class with </span><span class="cls_059">@EnableHystrixDashboard</span><span class="cls_039">:</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:269720px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background407.jpg" width="531" height="666"></div>
<div style="position:absolute;left:235.41px;top:24.35px" class="cls_055"><span class="cls_055">Monitoring failures</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">385</span></div>
<div style="position:absolute;left:102.18px;top:51.32px" class="cls_060"><span class="cls_060">@SpringBootApplication</span></div>
<div style="position:absolute;left:102.18px;top:61.34px" class="cls_060"><span class="cls_060">@EnableHystrixDashboard</span></div>
<div style="position:absolute;left:102.18px;top:71.33px" class="cls_060"><span class="cls_060">public class HystrixDashboardApplication {</span></div>
<div style="position:absolute;left:111.78px;top:81.32px" class="cls_060"><span class="cls_060">public static void main(String[] args) {</span></div>
<div style="position:absolute;left:121.38px;top:91.34px" class="cls_060"><span class="cls_060">SpringApplication.run(HystrixDashboardApplication.class, args);</span></div>
<div style="position:absolute;left:111.78px;top:101.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:111.32px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:132.65px" class="cls_039"><span class="cls_039">At development time, you’ll be running the Hystrix dashboard alongside all of your</span></div>
<div style="position:absolute;left:102.18px;top:145.67px" class="cls_039"><span class="cls_039">other services, as well as Eureka and Config Server on your local machine. Therefore,</span></div>
<div style="position:absolute;left:102.18px;top:158.66px" class="cls_039"><span class="cls_039">to avoid port conflicts, you’ll need to pick a unique port for the Hystrix dashboard. In</span></div>
<div style="position:absolute;left:102.18px;top:171.65px" class="cls_039"><span class="cls_039">the dashboard application’s application.yml file, set the </span><span class="cls_059">server.port</span><span class="cls_039"> property to any</span></div>
<div style="position:absolute;left:102.18px;top:184.67px" class="cls_039"><span class="cls_039">unique value you want. I usually set it to </span><span class="cls_059">7979</span><span class="cls_039">, like this:</span></div>
<div style="position:absolute;left:102.18px;top:204.35px" class="cls_060"><span class="cls_060">server:</span></div>
<div style="position:absolute;left:111.78px;top:214.34px" class="cls_061"><span class="cls_061">port: 7979</span></div>
<div style="position:absolute;left:102.18px;top:234.65px" class="cls_039"><span class="cls_039">Now you’re ready to fire up the Hystrix dashboard and kick the tires on it. Once it’s</span></div>
<div style="position:absolute;left:102.18px;top:247.67px" class="cls_039"><span class="cls_039">running, open your web browser to </span><a href="http://localhost:7979/hystrix">http://localhost:7979/hystrix</a> <span class="cls_039">. You should see the</span></div>
<div style="position:absolute;left:102.18px;top:260.66px" class="cls_039"><span class="cls_039">Hystrix dashboard homepage, as shown in figure 15.2.</span></div>
<div style="position:absolute;left:117.75px;top:273.65px" class="cls_039"><span class="cls_039">The first thing you’ll notice about the Hystrix dashboard homepage is the logo,</span></div>
<div style="position:absolute;left:102.18px;top:286.67px" class="cls_039"><span class="cls_039">which is the cartoonish porcupine mascot of the Hystrix project. To start viewing a</span></div>
<div style="position:absolute;left:102.18px;top:299.66px" class="cls_039"><span class="cls_039">Hystrix stream, enter the URL for one of the service application Hystrix streams into</span></div>
<div style="position:absolute;left:66.18px;top:590.42px" class="cls_053"><span class="cls_053">Figure 15.2</span></div>
<div style="position:absolute;left:115.61px;top:590.42px" class="cls_053"><span class="cls_053">The Hystrix dashboard homepage</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:270396px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background408.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">386</span></div>
<div style="position:absolute;left:185.04px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 15</span></div>
<div style="position:absolute;left:233.97px;top:24.35px" class="cls_055"><span class="cls_055">Handling failure and latency</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">the text box. For example, if the ingredient service is running on localhost and listen-</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">ing on port 59896 (thanks to setting </span><span class="cls_059">server.port</span><span class="cls_039"> to </span><span class="cls_059">0</span><span class="cls_039">), then you’d enter </span><a href="http:">http://</a> </div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_059"><span class="cls_059">localhost:59896/actuator/hystrix.stream</span><span class="cls_039"> into the text box.</span></div>
<div style="position:absolute;left:108.30px;top:89.66px" class="cls_039"><span class="cls_039">You can also set a delay and a title to display on the Hystrix stream monitor. The</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">delay, which defaults at 2 seconds, is the time between polling cycles, which effectively</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">slows down the stream. The title is merely displayed as a title on the monitor page. But</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">for your needs, the defaults are perfectly fine.</span></div>
<div style="position:absolute;left:108.43px;top:141.65px" class="cls_039"><span class="cls_039">Click the Monitor Stream button to be taken to the Hystrix stream monitor. You</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_039"><span class="cls_039">should see a page that looks something like figure 15.3.</span></div>
<div style="position:absolute;left:57.18px;top:360.56px" class="cls_053"><span class="cls_053">Figure 15.3</span></div>
<div style="position:absolute;left:106.53px;top:360.56px" class="cls_053"><span class="cls_053">The Hystrix stream monitor page shows the metrics from each of an application’s circuit breakers.</span></div>
<div style="position:absolute;left:93.18px;top:393.62px" class="cls_039"><span class="cls_039">Each circuit breaker can be viewed as a graph along with some other useful metrics</span></div>
<div style="position:absolute;left:93.18px;top:406.64px" class="cls_039"><span class="cls_039">data. Figure 15.3 shows a single circuit breaker for </span><span class="cls_059">getAllIngredients()</span><span class="cls_039">, because</span></div>
<div style="position:absolute;left:93.18px;top:419.63px" class="cls_039"><span class="cls_039">that’s the only circuit breaker you’ve declared so far.</span></div>
<div style="position:absolute;left:107.80px;top:432.65px" class="cls_039"><span class="cls_039">If you don’t see any graphs representing each circuit breaker and all you see is the</span></div>
<div style="position:absolute;left:93.18px;top:445.64px" class="cls_039"><span class="cls_039">word </span><span class="cls_036">Loading</span><span class="cls_039">, that’s probably because none of the circuit breaker methods has been</span></div>
<div style="position:absolute;left:93.18px;top:458.63px" class="cls_039"><span class="cls_039">called yet. You must make a request to the service that would trigger a circuit breaker</span></div>
<div style="position:absolute;left:93.18px;top:471.65px" class="cls_039"><span class="cls_039">protected method for that method’s circuit breaker metrics to appear in the dash-</span></div>
<div style="position:absolute;left:93.18px;top:484.64px" class="cls_039"><span class="cls_039">board. Figure 15.4 takes a closer look at an individual circuit breaker monitor, provid-</span></div>
<div style="position:absolute;left:93.18px;top:497.63px" class="cls_039"><span class="cls_039">ing a breakdown of the information presented.</span></div>
<div style="position:absolute;left:108.49px;top:510.65px" class="cls_039"><span class="cls_039">The most noticeable part of the monitor is the graph in the top-left corner. The</span></div>
<div style="position:absolute;left:93.18px;top:523.64px" class="cls_039"><span class="cls_039">line graph represents the traffic for the given method over the past 2 minutes, giving a</span></div>
<div style="position:absolute;left:93.18px;top:536.63px" class="cls_039"><span class="cls_039">brief history of how busy the method has been.</span></div>
<div style="position:absolute;left:107.73px;top:549.65px" class="cls_039"><span class="cls_039">The background of the graph has a circle whose size and color fluctuate. The size of</span></div>
<div style="position:absolute;left:93.18px;top:562.64px" class="cls_039"><span class="cls_039">the circle indicates the current traffic volume; the bigger the circle grows, the higher</span></div>
<div style="position:absolute;left:93.18px;top:575.63px" class="cls_039"><span class="cls_039">the traffic flow. The circle color indicates its health. Green indicates healthy, yellow indi-</span></div>
<div style="position:absolute;left:93.18px;top:588.65px" class="cls_039"><span class="cls_039">cates an occasionally failing circuit breaker, and red indicates a failing circuit breaker.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:271072px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background409.jpg" width="531" height="666"></div>
<div style="position:absolute;left:235.41px;top:24.35px" class="cls_055"><span class="cls_055">Monitoring failures</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">387</span></div>
<div style="position:absolute;left:221.81px;top:52.18px" class="cls_081"><span class="cls_081">Invocation counters</span></div>
<div style="position:absolute;left:120.99px;top:57.84px" class="cls_081"><span class="cls_081">Circle size represents</span></div>
<div style="position:absolute;left:118.84px;top:67.34px" class="cls_081"><span class="cls_081">current traffic volume;</span></div>
<div style="position:absolute;left:117.42px;top:76.84px" class="cls_081"><span class="cls_081">color represents health</span></div>
<div style="position:absolute;left:398.28px;top:84.59px" class="cls_081"><span class="cls_081">Error percentage</span></div>
<div style="position:absolute;left:398.28px;top:94.09px" class="cls_081"><span class="cls_081">in last 10 seconds</span></div>
<div style="position:absolute;left:105.51px;top:115.78px" class="cls_081"><span class="cls_081">Request rate</span></div>
<div style="position:absolute;left:105.56px;top:125.28px" class="cls_081"><span class="cls_081">charted over</span></div>
<div style="position:absolute;left:101.92px;top:134.78px" class="cls_081"><span class="cls_081">past 2 minutes</span></div>
<div style="position:absolute;left:398.96px;top:141.25px" class="cls_081"><span class="cls_081">Requests per</span></div>
<div style="position:absolute;left:398.96px;top:150.75px" class="cls_081"><span class="cls_081">second</span></div>
<div style="position:absolute;left:398.96px;top:173.24px" class="cls_081"><span class="cls_081">Circuit breaker</span></div>
<div style="position:absolute;left:398.96px;top:182.74px" class="cls_081"><span class="cls_081">status</span></div>
<div style="position:absolute;left:132.69px;top:190.92px" class="cls_081"><span class="cls_081">Host in cluster</span></div>
<div style="position:absolute;left:385.67px;top:214.59px" class="cls_081"><span class="cls_081">Latency percentiles</span></div>
<div style="position:absolute;left:385.67px;top:224.09px" class="cls_081"><span class="cls_081">for past minute</span></div>
<div style="position:absolute;left:102.18px;top:246.44px" class="cls_053"><span class="cls_053">Figure 15.4</span></div>
<div style="position:absolute;left:151.24px;top:246.44px" class="cls_053"><span class="cls_053">Each circuit breaker monitor provides useful information regarding the current state of</span></div>
<div style="position:absolute;left:102.18px;top:256.46px" class="cls_053"><span class="cls_053">the circuit breaker.</span></div>
<div style="position:absolute;left:102.18px;top:289.49px" class="cls_039"><span class="cls_039">The top right of the monitor shows various counters presented in three columns.</span></div>
<div style="position:absolute;left:102.18px;top:302.48px" class="cls_039"><span class="cls_039">Going top-down in the leftmost column, the first number (in green—see the elec-</span></div>
<div style="position:absolute;left:102.18px;top:315.50px" class="cls_039"><span class="cls_039">tronic versions of this book for color) shows how many invocations are currently suc-</span></div>
<div style="position:absolute;left:102.18px;top:328.49px" class="cls_039"><span class="cls_039">cessful, the second number (blue) is the number of short-circuited requests, and the</span></div>
<div style="position:absolute;left:102.18px;top:341.48px" class="cls_039"><span class="cls_039">last number (cyan) is the count of bad requests. The middle column shows the num-</span></div>
<div style="position:absolute;left:102.18px;top:354.50px" class="cls_039"><span class="cls_039">ber of requests that have timed out (yellow), the number that the threadpool rejects</span></div>
<div style="position:absolute;left:102.18px;top:367.49px" class="cls_039"><span class="cls_039">(purple), and the number of failing requests (red). The third column shows a per-</span></div>
<div style="position:absolute;left:102.18px;top:380.48px" class="cls_039"><span class="cls_039">centage of errors in the past 10 seconds.</span></div>
<div style="position:absolute;left:116.84px;top:393.50px" class="cls_039"><span class="cls_039">Below the counters are two numbers representing the number of requests per sec-</span></div>
<div style="position:absolute;left:102.18px;top:406.49px" class="cls_039"><span class="cls_039">ond for the host and for the cluster. Below those two request rates is the status of the</span></div>
<div style="position:absolute;left:102.18px;top:419.48px" class="cls_039"><span class="cls_039">circuit. The bottom of the monitor shows median and mean latency, as well as the</span></div>
<div style="position:absolute;left:102.18px;top:432.50px" class="cls_039"><span class="cls_039">latency for the 90th, 99th, and 99.5th percentiles.</span></div>
<div style="position:absolute;left:66.18px;top:457.31px" class="cls_063"><span class="cls_063">15.3.2</span></div>
<div style="position:absolute;left:102.18px;top:457.31px" class="cls_063"><span class="cls_063">Understanding Hystrix thread pools</span></div>
<div style="position:absolute;left:102.18px;top:474.50px" class="cls_039"><span class="cls_039">Imagine that a method is taking an excessive amount of time to do its job. Perhaps that</span></div>
<div style="position:absolute;left:102.18px;top:487.49px" class="cls_039"><span class="cls_039">method is making an HTTP request to another service, and the service is sluggish in</span></div>
<div style="position:absolute;left:102.18px;top:500.51px" class="cls_039"><span class="cls_039">responding. Until the service responds, Hystrix blocks the thread, waiting for a response.</span></div>
<div style="position:absolute;left:117.51px;top:513.50px" class="cls_039"><span class="cls_039">If the method is executing in the context of the same thread as the caller of the</span></div>
<div style="position:absolute;left:102.18px;top:526.49px" class="cls_039"><span class="cls_039">method, then the caller doesn’t have an opportunity to walk away from the long-running</span></div>
<div style="position:absolute;left:102.18px;top:539.51px" class="cls_039"><span class="cls_039">method. Moreover, if the blocked thread is one of a limited set of threads, such as a</span></div>
<div style="position:absolute;left:102.18px;top:552.50px" class="cls_039"><span class="cls_039">request-handling thread from Tomcat, and if the problem persists, then scalability can</span></div>
<div style="position:absolute;left:102.18px;top:565.49px" class="cls_039"><span class="cls_039">take a hit when all the threads are saturated and waiting for responses.</span></div>
<div style="position:absolute;left:118.10px;top:578.51px" class="cls_039"><span class="cls_039">To avoid this situation, Hystrix assigns a thread pool for each dependency (for</span></div>
<div style="position:absolute;left:102.18px;top:591.50px" class="cls_039"><span class="cls_039">example, for each Spring bean with one or more Hystrix command methods). When</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:271748px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background410.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">388</span></div>
<div style="position:absolute;left:185.04px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 15</span></div>
<div style="position:absolute;left:233.97px;top:24.35px" class="cls_055"><span class="cls_055">Handling failure and latency</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">one of the Hystrix command methods is called, it’ll be executed in a thread from the</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">Hystrix-managed thread pool, isolating it from the calling thread. This allows the call-</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">ing thread to give up and walk away from the call if it’s taking too long, and isolates</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">any potential thread saturation to the Hystrix-managed thread pool.</span></div>
<div style="position:absolute;left:107.65px;top:102.65px" class="cls_039"><span class="cls_039">You may have noticed that in addition to the circuit breaker monitor, figure 15.3 also</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">showed another monitor near the bottom of the page, under a header titled Thread</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">Pools. This section includes a monitor for each Hystrix-managed thread pool. Figure 15.5</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">shows an individual thread pool monitor, annotated to describe the data it presents.</span></div>
<div style="position:absolute;left:100.61px;top:166.76px" class="cls_068"><span class="cls_068">Circle size represents</span></div>
<div style="position:absolute;left:96.31px;top:176.26px" class="cls_068"><span class="cls_068">current traffic volume;</span></div>
<div style="position:absolute;left:93.47px;top:185.76px" class="cls_068"><span class="cls_068">color represents health</span></div>
<div style="position:absolute;left:388.57px;top:190.00px" class="cls_068"><span class="cls_068">Requests per</span></div>
<div style="position:absolute;left:388.57px;top:199.50px" class="cls_068"><span class="cls_068">second</span></div>
<div style="position:absolute;left:136.41px;top:214.22px" class="cls_068"><span class="cls_068">Active</span></div>
<div style="position:absolute;left:388.57px;top:218.99px" class="cls_068"><span class="cls_068">Maximum active</span></div>
<div style="position:absolute;left:130.36px;top:223.72px" class="cls_068"><span class="cls_068">threads</span></div>
<div style="position:absolute;left:388.57px;top:228.50px" class="cls_068"><span class="cls_068">threads</span></div>
<div style="position:absolute;left:130.59px;top:240.48px" class="cls_068"><span class="cls_068">Queued</span></div>
<div style="position:absolute;left:388.57px;top:240.48px" class="cls_068"><span class="cls_068">Execution count</span></div>
<div style="position:absolute;left:130.36px;top:249.98px" class="cls_068"><span class="cls_068">threads</span></div>
<div style="position:absolute;left:388.57px;top:253.36px" class="cls_068"><span class="cls_068">Thread queue size</span></div>
<div style="position:absolute;left:120.91px;top:261.91px" class="cls_068"><span class="cls_068">Size of the</span></div>
<div style="position:absolute;left:116.19px;top:271.41px" class="cls_068"><span class="cls_068">thread pool</span></div>
<div style="position:absolute;left:93.18px;top:290.78px" class="cls_053"><span class="cls_053">Figure 15.5</span></div>
<div style="position:absolute;left:142.10px;top:290.78px" class="cls_053"><span class="cls_053">Thread pool monitors show vital statistics about each of the Hystrix-managed thread pools.</span></div>
<div style="position:absolute;left:93.18px;top:326.00px" class="cls_039"><span class="cls_039">Much like the circuit breaker monitor, each thread pool monitor includes a circle in</span></div>
<div style="position:absolute;left:93.18px;top:338.99px" class="cls_039"><span class="cls_039">its upper-left corner. The size and color of this circle indicate how active the thread</span></div>
<div style="position:absolute;left:93.18px;top:351.98px" class="cls_039"><span class="cls_039">pool is currently, as well as its health. Unlike the circuit breaker monitor, however,</span></div>
<div style="position:absolute;left:93.18px;top:365.00px" class="cls_039"><span class="cls_039">thread pool monitors don’t display a line graph showing thread pool activity over the</span></div>
<div style="position:absolute;left:93.18px;top:377.99px" class="cls_039"><span class="cls_039">past few minutes.</span></div>
<div style="position:absolute;left:107.98px;top:390.98px" class="cls_039"><span class="cls_039">The thread pool’s name is displayed in the upper-right corner, above the statistics</span></div>
<div style="position:absolute;left:93.18px;top:404.00px" class="cls_039"><span class="cls_039">showing the number of requests per second being handled by the threads in the</span></div>
<div style="position:absolute;left:93.18px;top:416.99px" class="cls_039"><span class="cls_039">thread pool. The lower-left corner of the thread pool monitor displays the following</span></div>
<div style="position:absolute;left:93.18px;top:429.98px" class="cls_039"><span class="cls_039">information:</span></div>
<div style="position:absolute;left:108.78px;top:446.99px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Active thread count</span><span class="cls_039">—The current number of active threads.</span></div>
<div style="position:absolute;left:108.78px;top:461.00px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Queued thread count</span><span class="cls_039">—How many threads are currently queued. By default, queu-</span></div>
<div style="position:absolute;left:120.78px;top:473.99px" class="cls_039"><span class="cls_039">ing is disabled, so this value is always </span><span class="cls_059">0</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:108.78px;top:488.00px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Pool size</span><span class="cls_039">—How many threads are in the thread pool.</span></div>
<div style="position:absolute;left:93.18px;top:506.00px" class="cls_039"><span class="cls_039">Meanwhile, the lower-right corner displays this information about the thread pool:</span></div>
<div style="position:absolute;left:108.78px;top:523.01px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Maximum active thread count</span><span class="cls_039">—The maximum number of active threads over the</span></div>
<div style="position:absolute;left:120.78px;top:536.00px" class="cls_039"><span class="cls_039">current sampling period.</span></div>
<div style="position:absolute;left:108.78px;top:550.01px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Execution count</span><span class="cls_039">—The number of times that threads in the thread pool have</span></div>
<div style="position:absolute;left:120.78px;top:563.00px" class="cls_039"><span class="cls_039">been called on to handle executions of Hystrix commands.</span></div>
<div style="position:absolute;left:108.78px;top:577.01px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Queue size</span><span class="cls_039">—The size of the thread pool queue. Thread queueing is disabled by</span></div>
<div style="position:absolute;left:120.78px;top:590.00px" class="cls_039"><span class="cls_039">default, so this value has little meaning.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:272424px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background411.jpg" width="531" height="666"></div>
<div style="position:absolute;left:204.21px;top:24.35px" class="cls_055"><span class="cls_055">Aggregating multiple Hystrix streams</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">389</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">It’s worth noting that as an alternative to Hystrix thread pooling, you can choose to</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">use </span><span class="cls_036">semaphore isolation</span><span class="cls_039">. Semaphore isolation, however, is a more advanced usage of</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">Hystrix and thus outside of the scope of this chapter. Refer to the Hystrix documenta-</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">tion for more information.</span></div>
<div style="position:absolute;left:117.46px;top:102.65px" class="cls_039"><span class="cls_039">Now that you’ve seen the Hystrix dashboard in action, let’s consider how to deal</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">with multiple streams of circuit breaker data and how to aggregate them into a single</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">stream to be viewed in the Hystrix dashboard.</span></div>
<div style="position:absolute;left:66.18px;top:149.83px" class="cls_040"><span class="cls_040">15.4</span></div>
<div style="position:absolute;left:102.18px;top:149.83px" class="cls_040"><span class="cls_040">Aggregating multiple Hystrix streams</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">The Hystrix dashboard is only capable of monitoring a single stream at a time. Because</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">each instance of each microservice publishes its own Hystrix stream, it’s almost impos-</span></div>
<div style="position:absolute;left:102.18px;top:193.67px" class="cls_039"><span class="cls_039">sible to get a holistic view of an application’s health.</span></div>
<div style="position:absolute;left:116.86px;top:206.66px" class="cls_039"><span class="cls_039">Fortunately, another Netflix project, Turbine, offers a way to aggregate all of the</span></div>
<div style="position:absolute;left:102.18px;top:219.65px" class="cls_039"><span class="cls_039">Hystrix streams from all the microservices into a single stream that the Hystrix dash-</span></div>
<div style="position:absolute;left:102.18px;top:232.67px" class="cls_039"><span class="cls_039">board can monitor. Spring Cloud Netflix supports creating a Turbine service using</span></div>
<div style="position:absolute;left:102.18px;top:245.66px" class="cls_039"><span class="cls_039">an approach similar to creating other Spring Cloud services. To create a Turbine ser-</span></div>
<div style="position:absolute;left:102.18px;top:258.65px" class="cls_039"><span class="cls_039">vice, create a new Spring Boot project and include the Turbine starter dependency</span></div>
<div style="position:absolute;left:102.18px;top:271.67px" class="cls_039"><span class="cls_039">in the build:</span></div>
<div style="position:absolute;left:102.18px;top:291.35px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:111.78px;top:301.34px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:111.78px;top:311.33px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-cloud-starter-netflix-turbine&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:102.18px;top:321.35px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:114.18px;top:342.68px" class="cls_083"><span class="cls_083">NOTE</span><span class="cls_039">   As a new project, it’s easiest to simply check the Turbine check box in</span></div>
<div style="position:absolute;left:114.18px;top:354.68px" class="cls_039"><span class="cls_039">the Initializr when creating the new Spring Boot project.</span></div>
<div style="position:absolute;left:102.18px;top:374.66px" class="cls_039"><span class="cls_039">Once you create the project, you’ll need to enable Turbine. To do that, add the</span></div>
<div style="position:absolute;left:102.18px;top:387.68px" class="cls_059"><span class="cls_059">@EnableTurbine</span><span class="cls_039"> annotation to the application’s main configuration class:</span></div>
<div style="position:absolute;left:102.18px;top:407.36px" class="cls_060"><span class="cls_060">@SpringBootApplication</span></div>
<div style="position:absolute;left:102.18px;top:417.35px" class="cls_060"><span class="cls_060">@EnableTurbine</span></div>
<div style="position:absolute;left:102.18px;top:427.34px" class="cls_060"><span class="cls_060">public class TurbineServerApplication {</span></div>
<div style="position:absolute;left:111.78px;top:437.36px" class="cls_060"><span class="cls_060">public static void main(String[] args) {</span></div>
<div style="position:absolute;left:121.38px;top:447.35px" class="cls_060"><span class="cls_060">SpringApplication.run(TurbineServerApplication.class, args);</span></div>
<div style="position:absolute;left:111.78px;top:457.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:467.36px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:488.66px" class="cls_039"><span class="cls_039">For development purposes, you’ll run Turbine locally, alongside the other services in</span></div>
<div style="position:absolute;left:102.18px;top:501.68px" class="cls_039"><span class="cls_039">the Taco Cloud application. To avoid port conflicts, you’ll need to select a unique port</span></div>
<div style="position:absolute;left:102.18px;top:514.67px" class="cls_039"><span class="cls_039">for Turbine so that it doesn’t conflict with any of the other services. You can pick any</span></div>
<div style="position:absolute;left:102.18px;top:527.66px" class="cls_039"><span class="cls_039">port you like, but I tend to choose port 8989:</span></div>
<div style="position:absolute;left:102.18px;top:547.34px" class="cls_060"><span class="cls_060">server:</span></div>
<div style="position:absolute;left:111.78px;top:557.36px" class="cls_061"><span class="cls_061">port: 8989</span></div>
<div style="position:absolute;left:102.18px;top:578.69px" class="cls_039"><span class="cls_039">Turbine works by consuming the streams from multiple microservices and merging</span></div>
<div style="position:absolute;left:102.18px;top:591.68px" class="cls_039"><span class="cls_039">the circuit breaker metrics into a single stream. It acts as a client of Eureka, discovering</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:273100px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background412.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">390</span></div>
<div style="position:absolute;left:185.04px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 15</span></div>
<div style="position:absolute;left:233.97px;top:24.35px" class="cls_055"><span class="cls_055">Handling failure and latency</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">the services whose streams it’ll aggregate into its own stream. But Turbine doesn’t</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">assume that it should aggregate the streams of all services registered in Eureka; you</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">must configure Turbine to tell it which services it should work with.</span></div>
<div style="position:absolute;left:108.03px;top:89.66px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">turbine.app-config</span><span class="cls_039"> property accepts a comma-delimited list of service names</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">to look up in Eureka and for which it should aggregate Hystrix streams. For Taco Cloud,</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">you’ll need Turbine to aggregate the streams for the four services registered in Eureka</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">as </span><span class="cls_059">ingredient-service</span><span class="cls_039">, </span><span class="cls_059">taco-service</span><span class="cls_039">, </span><span class="cls_059">order-service</span><span class="cls_039">, and </span><span class="cls_059">user-service</span><span class="cls_039">. The follow-</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">ing entry in application.yml shows how to set </span><span class="cls_059">turbine.app-config</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:161.33px" class="cls_060"><span class="cls_060">turbine:</span></div>
<div style="position:absolute;left:102.78px;top:171.35px" class="cls_060"><span class="cls_060">app-config: ingredient-service,taco-service,order-service,user-service</span></div>
<div style="position:absolute;left:102.78px;top:181.34px" class="cls_061"><span class="cls_061">cluster-name-expression: "'default'"</span></div>
<div style="position:absolute;left:93.18px;top:202.67px" class="cls_039"><span class="cls_039">Notice that in addition to </span><span class="cls_059">turbine.app-config</span><span class="cls_039">, you also set </span><span class="cls_059">turbine.cluster-name-</span></div>
<div style="position:absolute;left:93.18px;top:215.66px" class="cls_059"><span class="cls_059">expression</span><span class="cls_039"> to </span><span class="cls_059">'default'</span><span class="cls_039">. This indicates that Turbine should collect all of the aggre-</span></div>
<div style="position:absolute;left:93.18px;top:228.65px" class="cls_039"><span class="cls_039">gated streams under a cluster whose name is </span><span class="cls_059">default</span><span class="cls_039">. It’s important to set this cluster</span></div>
<div style="position:absolute;left:93.18px;top:241.67px" class="cls_039"><span class="cls_039">name or else the Turbine stream won’t contain any stream data aggregated from the</span></div>
<div style="position:absolute;left:93.18px;top:254.66px" class="cls_039"><span class="cls_039">specified applications.</span></div>
<div style="position:absolute;left:108.37px;top:267.65px" class="cls_039"><span class="cls_039">Now you can fire up the Turbine server application and point your Hystrix dash-</span></div>
<div style="position:absolute;left:93.18px;top:280.67px" class="cls_039"><span class="cls_039">board at the stream at </span><a href="http://localhost:8989/turbine.stream">http://localhost:8989/turbine.stream</a> <span class="cls_039">. All the circuit breakers</span></div>
<div style="position:absolute;left:93.18px;top:293.66px" class="cls_039"><span class="cls_039">from all of the specified applications will be displayed in the circuit breaker dash-</span></div>
<div style="position:absolute;left:93.18px;top:306.68px" class="cls_039"><span class="cls_039">board. Figure 15.6 shows how this might look.</span></div>
<div style="position:absolute;left:57.18px;top:497.54px" class="cls_053"><span class="cls_053">Figure 15.6</span></div>
<div style="position:absolute;left:106.61px;top:497.54px" class="cls_053"><span class="cls_053">The Hystrix dashboard shows all circuit breakers from all services when pointed at an aggregated</span></div>
<div style="position:absolute;left:57.18px;top:507.53px" class="cls_053"><span class="cls_053">Turbine stream.</span></div>
<div style="position:absolute;left:93.18px;top:546.71px" class="cls_039"><span class="cls_039">Now that the Hystrix dashboard is displaying health information for all the circuit</span></div>
<div style="position:absolute;left:93.18px;top:559.70px" class="cls_039"><span class="cls_039">breakers in all of your microservices—thanks to Turbine—you get a one-stop shop for</span></div>
<div style="position:absolute;left:93.18px;top:572.72px" class="cls_039"><span class="cls_039">monitoring the health of the circuit breakers in the Taco Cloud application.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:273776px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background413.jpg" width="531" height="666"></div>
<div style="position:absolute;left:253.20px;top:24.35px" class="cls_055"><span class="cls_055">Summary</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">391</span></div>
<div style="position:absolute;left:102.18px;top:49.81px" class="cls_040"><span class="cls_040">Summary</span></div>
<div style="position:absolute;left:117.78px;top:68.15px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  The circuit breaker pattern enables graceful failure handling.</span></div>
<div style="position:absolute;left:117.78px;top:82.16px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Hystrix implements the circuit breaker pattern, enabling fallback behavior</span></div>
<div style="position:absolute;left:129.78px;top:95.15px" class="cls_039"><span class="cls_039">when a method fails or is too slow.</span></div>
<div style="position:absolute;left:117.78px;top:109.16px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Each circuit breaker provided by Hystrix publishes metrics in a stream of data</span></div>
<div style="position:absolute;left:129.78px;top:122.15px" class="cls_039"><span class="cls_039">for purposes of monitoring the health of an application.</span></div>
<div style="position:absolute;left:117.78px;top:136.16px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  The Hystrix stream can be consumed by the Hystrix dashboard, a web applica-</span></div>
<div style="position:absolute;left:129.78px;top:149.15px" class="cls_039"><span class="cls_039">tion that visualizes circuit breaker metrics.</span></div>
<div style="position:absolute;left:117.78px;top:163.16px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Turbine aggregates multiple Hystrix streams from multiple applications into a</span></div>
<div style="position:absolute;left:129.78px;top:176.15px" class="cls_039"><span class="cls_039">single stream that can be visualized together in the Hystrix dashboard.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:274452px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background414.jpg" width="531" height="666"></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:274452px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background415.jpg" width="531" height="666"></div>
<div style="position:absolute;left:388.38px;top:82.94px" class="cls_014"><span class="cls_014">Part 5</span></div>
<div style="position:absolute;left:287.58px;top:142.94px" class="cls_014"><span class="cls_014">Deployed Spring</span></div>
<div style="position:absolute;left:126.18px;top:215.61px" class="cls_047"><span class="cls_047">I</span></div>
<div style="position:absolute;left:143.46px;top:253.67px" class="cls_039"><span class="cls_039">n part 5, you’ll ready an application for production and see how to deploy it.</span></div>
<div style="position:absolute;left:126.18px;top:266.66px" class="cls_039"><span class="cls_039">Chapter 16 introduces the Spring Boot Actuator, an extension to Spring Boot</span></div>
<div style="position:absolute;left:126.18px;top:279.65px" class="cls_039"><span class="cls_039">that exposes the internals of a running Spring application as REST endpoints</span></div>
<div style="position:absolute;left:126.18px;top:292.67px" class="cls_039"><span class="cls_039">and JMX MBeans. In chapter 17 you’ll see how to use the Spring Boot Admin to</span></div>
<div style="position:absolute;left:126.18px;top:305.66px" class="cls_039"><span class="cls_039">put a user-friendly browser-based administrative application on top of the Actua-</span></div>
<div style="position:absolute;left:126.18px;top:318.68px" class="cls_039"><span class="cls_039">tor. You’ll see how to register client applications with and secure the Admin</span></div>
<div style="position:absolute;left:126.18px;top:331.67px" class="cls_039"><span class="cls_039">Server. Chapter 18 discusses how to expose and consume Spring beans as JMX</span></div>
<div style="position:absolute;left:126.18px;top:344.66px" class="cls_039"><span class="cls_039">MBeans. Finally, in chapter 19 you’ll see how to deploy your Spring application</span></div>
<div style="position:absolute;left:126.18px;top:357.68px" class="cls_039"><span class="cls_039">in a variety of production environments. Anyone who has deployed a Java-based</span></div>
<div style="position:absolute;left:126.18px;top:370.67px" class="cls_039"><span class="cls_039">application may think this is obvious, but there are some features of Spring Boot</span></div>
<div style="position:absolute;left:126.18px;top:383.66px" class="cls_039"><span class="cls_039">and related Spring projects that make deploying Spring boot applications unique.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:275128px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background416.jpg" width="531" height="666"></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:275128px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background417.jpg" width="531" height="666"></div>
<div style="position:absolute;left:315.78px;top:111.83px" class="cls_014"><span class="cls_014">Working with</span></div>
<div style="position:absolute;left:228.18px;top:143.84px" class="cls_014"><span class="cls_014">Spring Boot Actuator</span></div>
<div style="position:absolute;left:96.18px;top:264.85px" class="cls_049"><span class="cls_049">This chapter covers</span></div>
<div style="position:absolute;left:96.18px;top:283.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Enabling Actuator in Spring Boot projects</span></div>
<div style="position:absolute;left:96.18px;top:298.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Exploring Actuator endpoints</span></div>
<div style="position:absolute;left:96.18px;top:313.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Customizing Actuator</span></div>
<div style="position:absolute;left:96.18px;top:328.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Securing Actuator</span></div>
<div style="position:absolute;left:114.18px;top:398.54px" class="cls_039"><span class="cls_039">Have you ever tried to guess what’s inside a wrapped gift? You shake it, weigh it, and</span></div>
<div style="position:absolute;left:114.18px;top:411.53px" class="cls_039"><span class="cls_039">measure it. And you might even have a solid idea as to what’s inside. But until you</span></div>
<div style="position:absolute;left:114.18px;top:424.55px" class="cls_039"><span class="cls_039">open it up, there’s no way of knowing for sure.</span></div>
<div style="position:absolute;left:130.08px;top:437.54px" class="cls_039"><span class="cls_039">A running application is kind of like a wrapped gift. You can poke at it and</span></div>
<div style="position:absolute;left:114.18px;top:450.53px" class="cls_039"><span class="cls_039">make reasonable guesses as to what’s going on under the covers. But how can you</span></div>
<div style="position:absolute;left:114.18px;top:463.55px" class="cls_039"><span class="cls_039">know for sure? If only there were some way that you could peek inside a running</span></div>
<div style="position:absolute;left:114.18px;top:476.54px" class="cls_039"><span class="cls_039">application, see how it’s behaving, check on its health, and maybe even trigger</span></div>
<div style="position:absolute;left:114.18px;top:489.56px" class="cls_039"><span class="cls_039">operations that influence how it runs!</span></div>
<div style="position:absolute;left:129.30px;top:502.55px" class="cls_039"><span class="cls_039">In this chapter, we’re going to explore Spring Boot’s Actuator. Actuator offers</span></div>
<div style="position:absolute;left:114.18px;top:515.54px" class="cls_039"><span class="cls_039">production-ready features such as monitoring and metrics to Spring Boot applica-</span></div>
<div style="position:absolute;left:114.18px;top:528.56px" class="cls_039"><span class="cls_039">tions. Actuator’s features are provided by way of several endpoints, which are made</span></div>
<div style="position:absolute;left:114.18px;top:541.55px" class="cls_039"><span class="cls_039">available over HTTP as well as through JMX MBeans. This chapter focuses primar-</span></div>
<div style="position:absolute;left:114.18px;top:554.54px" class="cls_039"><span class="cls_039">ily on HTTP endpoints, saving JMX endpoints for chapter 19.</span></div>
<div style="position:absolute;left:269.16px;top:596.99px" class="cls_048"><span class="cls_048">395</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:275804px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background418.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">396</span></div>
<div style="position:absolute;left:173.61px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 16</span></div>
<div style="position:absolute;left:222.54px;top:24.35px" class="cls_055"><span class="cls_055">Working with Spring Boot Actuator</span></div>
<div style="position:absolute;left:57.18px;top:49.81px" class="cls_040"><span class="cls_040">16.1</span></div>
<div style="position:absolute;left:93.18px;top:49.81px" class="cls_040"><span class="cls_040">Introducing Actuator</span></div>
<div style="position:absolute;left:93.18px;top:67.67px" class="cls_039"><span class="cls_039">In a machine, an actuator is a component that’s responsible for controlling and mov-</span></div>
<div style="position:absolute;left:93.18px;top:80.66px" class="cls_039"><span class="cls_039">ing a mechanism. In a Spring Boot application, the Spring Boot Actuator plays that</span></div>
<div style="position:absolute;left:93.18px;top:93.65px" class="cls_039"><span class="cls_039">same role, enabling us to see inside of a running application and, to some degree,</span></div>
<div style="position:absolute;left:93.18px;top:106.67px" class="cls_039"><span class="cls_039">control how the application behaves.</span></div>
<div style="position:absolute;left:107.70px;top:119.66px" class="cls_039"><span class="cls_039">Using endpoints exposed by Actuator, we can ask things about the internal state of</span></div>
<div style="position:absolute;left:93.18px;top:132.65px" class="cls_039"><span class="cls_039">a running Spring Boot application:</span></div>
<div style="position:absolute;left:108.78px;top:148.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  What configuration properties are available in the application environment?</span></div>
<div style="position:absolute;left:108.78px;top:162.65px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  What are the logging levels of various packages in the application?</span></div>
<div style="position:absolute;left:108.78px;top:176.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  How much memory is being consumed by the application?</span></div>
<div style="position:absolute;left:108.78px;top:190.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  How many times has a given HTTP endpoint been requested?</span></div>
<div style="position:absolute;left:108.78px;top:204.65px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  What is the health of the application and any external services it coordinates with?</span></div>
<div style="position:absolute;left:93.18px;top:222.65px" class="cls_039"><span class="cls_039">To enable Actuator in a Spring Boot application, you simply need to add Actuator’s</span></div>
<div style="position:absolute;left:93.18px;top:235.67px" class="cls_039"><span class="cls_039">starter dependency to your build. In any Spring Boot application Maven pom.xml file,</span></div>
<div style="position:absolute;left:93.18px;top:248.66px" class="cls_039"><span class="cls_039">the following </span><span class="cls_059">&lt;dependency&gt;</span><span class="cls_039"> entry does the trick:</span></div>
<div style="position:absolute;left:93.18px;top:268.34px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:278.33px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:288.35px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:93.18px;top:298.34px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:93.18px;top:317.66px" class="cls_039"><span class="cls_039">Once the Actuator starter is part of the project build, the application will be equipped</span></div>
<div style="position:absolute;left:93.18px;top:330.68px" class="cls_039"><span class="cls_039">with several out-of-the-box Actuator endpoints, including those described in table 16.1.</span></div>
<div style="position:absolute;left:93.18px;top:351.35px" class="cls_053"><span class="cls_053">Table 16.1</span></div>
<div style="position:absolute;left:139.91px;top:351.35px" class="cls_053"><span class="cls_053">Actuator endpoints for peeking inside and manipulating the state of a running Spring Boot</span></div>
<div style="position:absolute;left:93.18px;top:361.34px" class="cls_053"><span class="cls_053">application</span></div>
<div style="position:absolute;left:110.73px;top:382.16px" class="cls_073"><span class="cls_073">HTTP</span></div>
<div style="position:absolute;left:417.69px;top:382.16px" class="cls_073"><span class="cls_073">Enabled by</span></div>
<div style="position:absolute;left:177.18px;top:387.14px" class="cls_073"><span class="cls_073">Path</span></div>
<div style="position:absolute;left:295.92px;top:387.14px" class="cls_073"><span class="cls_073">Description</span></div>
<div style="position:absolute;left:106.74px;top:392.15px" class="cls_073"><span class="cls_073">method</span></div>
<div style="position:absolute;left:422.55px;top:392.15px" class="cls_073"><span class="cls_073">default?</span></div>
<div style="position:absolute;left:99.18px;top:410.75px" class="cls_074"><span class="cls_074">GET</span></div>
<div style="position:absolute;left:156.18px;top:410.75px" class="cls_074"><span class="cls_074">/auditevents</span></div>
<div style="position:absolute;left:229.81px;top:410.75px" class="cls_074"><span class="cls_074">Produces a report of any audit events that have</span></div>
<div style="position:absolute;left:417.78px;top:410.75px" class="cls_074"><span class="cls_074">No</span></div>
<div style="position:absolute;left:229.83px;top:420.74px" class="cls_074"><span class="cls_074">been fired.</span></div>
<div style="position:absolute;left:99.18px;top:437.36px" class="cls_074"><span class="cls_074">GET</span></div>
<div style="position:absolute;left:156.18px;top:437.36px" class="cls_074"><span class="cls_074">/beans</span></div>
<div style="position:absolute;left:229.83px;top:437.36px" class="cls_074"><span class="cls_074">Describes all the beans in the Spring application</span></div>
<div style="position:absolute;left:417.78px;top:437.36px" class="cls_074"><span class="cls_074">No</span></div>
<div style="position:absolute;left:229.83px;top:447.35px" class="cls_074"><span class="cls_074">context.</span></div>
<div style="position:absolute;left:99.18px;top:463.94px" class="cls_074"><span class="cls_074">GET</span></div>
<div style="position:absolute;left:156.18px;top:463.94px" class="cls_074"><span class="cls_074">/conditions</span></div>
<div style="position:absolute;left:229.82px;top:463.94px" class="cls_074"><span class="cls_074">Produces a report of autoconfiguration conditions</span></div>
<div style="position:absolute;left:417.78px;top:463.94px" class="cls_074"><span class="cls_074">No</span></div>
<div style="position:absolute;left:229.83px;top:473.96px" class="cls_074"><span class="cls_074">that either passed or failed, leading to the beans</span></div>
<div style="position:absolute;left:229.83px;top:483.95px" class="cls_074"><span class="cls_074">created in the application context.</span></div>
<div style="position:absolute;left:99.18px;top:500.54px" class="cls_074"><span class="cls_074">GET</span></div>
<div style="position:absolute;left:156.18px;top:500.54px" class="cls_074"><span class="cls_074">/configprops</span></div>
<div style="position:absolute;left:229.83px;top:500.54px" class="cls_074"><span class="cls_074">Describes all configuration properties along with</span></div>
<div style="position:absolute;left:417.78px;top:500.54px" class="cls_074"><span class="cls_074">No</span></div>
<div style="position:absolute;left:229.83px;top:510.56px" class="cls_074"><span class="cls_074">the current values.</span></div>
<div style="position:absolute;left:99.18px;top:527.15px" class="cls_074"><span class="cls_074">GET, POST,</span></div>
<div style="position:absolute;left:156.18px;top:527.15px" class="cls_074"><span class="cls_074">/env</span></div>
<div style="position:absolute;left:229.84px;top:527.15px" class="cls_074"><span class="cls_074">Produces a report of all property sources and their</span></div>
<div style="position:absolute;left:417.78px;top:527.15px" class="cls_074"><span class="cls_074">No</span></div>
<div style="position:absolute;left:99.18px;top:537.14px" class="cls_074"><span class="cls_074">DELETE</span></div>
<div style="position:absolute;left:229.83px;top:537.14px" class="cls_074"><span class="cls_074">properties available to the Spring application.</span></div>
<div style="position:absolute;left:99.18px;top:553.76px" class="cls_074"><span class="cls_074">GET</span></div>
<div style="position:absolute;left:156.18px;top:553.76px" class="cls_074"><span class="cls_074">/env/{toMatch}</span></div>
<div style="position:absolute;left:229.83px;top:553.76px" class="cls_074"><span class="cls_074">Describes the value of a single environment property.</span></div>
<div style="position:absolute;left:417.78px;top:553.76px" class="cls_074"><span class="cls_074">No</span></div>
<div style="position:absolute;left:99.18px;top:570.35px" class="cls_074"><span class="cls_074">GET</span></div>
<div style="position:absolute;left:156.18px;top:570.35px" class="cls_074"><span class="cls_074">/health</span></div>
<div style="position:absolute;left:229.82px;top:570.35px" class="cls_074"><span class="cls_074">Returns the aggregate health of the application</span></div>
<div style="position:absolute;left:417.78px;top:570.35px" class="cls_074"><span class="cls_074">Yes</span></div>
<div style="position:absolute;left:229.83px;top:580.34px" class="cls_074"><span class="cls_074">and (possibly) the health of external dependent</span></div>
<div style="position:absolute;left:229.83px;top:590.36px" class="cls_074"><span class="cls_074">applications.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:276480px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background419.jpg" width="531" height="666"></div>
<div style="position:absolute;left:232.89px;top:24.35px" class="cls_055"><span class="cls_055">Introducing Actuator</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">397</span></div>
<div style="position:absolute;left:102.18px;top:51.32px" class="cls_053"><span class="cls_053">Table 16.1</span></div>
<div style="position:absolute;left:148.91px;top:51.32px" class="cls_053"><span class="cls_053">Actuator endpoints for peeking inside and manipulating the state of a running Spring Boot</span></div>
<div style="position:absolute;left:102.18px;top:61.34px" class="cls_053"><span class="cls_053">application</span><span class="cls_084"> (continued)</span></div>
<div style="position:absolute;left:119.73px;top:82.13px" class="cls_073"><span class="cls_073">HTTP</span></div>
<div style="position:absolute;left:426.69px;top:82.13px" class="cls_073"><span class="cls_073">Enabled by</span></div>
<div style="position:absolute;left:186.18px;top:87.14px" class="cls_073"><span class="cls_073">Path</span></div>
<div style="position:absolute;left:304.92px;top:87.14px" class="cls_073"><span class="cls_073">Description</span></div>
<div style="position:absolute;left:115.74px;top:92.12px" class="cls_073"><span class="cls_073">method</span></div>
<div style="position:absolute;left:431.55px;top:92.12px" class="cls_073"><span class="cls_073">default?</span></div>
<div style="position:absolute;left:108.18px;top:110.72px" class="cls_074"><span class="cls_074">GET</span></div>
<div style="position:absolute;left:165.19px;top:110.72px" class="cls_074"><span class="cls_074">/heapdump</span></div>
<div style="position:absolute;left:238.84px;top:110.72px" class="cls_074"><span class="cls_074">Downloads a heap dump.</span></div>
<div style="position:absolute;left:426.80px;top:110.72px" class="cls_074"><span class="cls_074">No</span></div>
<div style="position:absolute;left:108.18px;top:127.34px" class="cls_074"><span class="cls_074">GET</span></div>
<div style="position:absolute;left:165.19px;top:127.34px" class="cls_074"><span class="cls_074">/httptrace</span></div>
<div style="position:absolute;left:238.83px;top:127.34px" class="cls_074"><span class="cls_074">Produces a trace of the most recent 100 requests.</span></div>
<div style="position:absolute;left:426.80px;top:127.34px" class="cls_074"><span class="cls_074">No</span></div>
<div style="position:absolute;left:108.18px;top:143.93px" class="cls_074"><span class="cls_074">GET</span></div>
<div style="position:absolute;left:165.19px;top:143.93px" class="cls_074"><span class="cls_074">/info</span></div>
<div style="position:absolute;left:238.83px;top:143.93px" class="cls_074"><span class="cls_074">Returns any developer-defined information about</span></div>
<div style="position:absolute;left:426.78px;top:143.93px" class="cls_074"><span class="cls_074">Yes</span></div>
<div style="position:absolute;left:238.83px;top:153.95px" class="cls_074"><span class="cls_074">the application.</span></div>
<div style="position:absolute;left:108.18px;top:170.54px" class="cls_074"><span class="cls_074">GET</span></div>
<div style="position:absolute;left:165.19px;top:170.54px" class="cls_074"><span class="cls_074">/loggers</span></div>
<div style="position:absolute;left:238.84px;top:170.54px" class="cls_074"><span class="cls_074">Produces a list of packages in the application along</span></div>
<div style="position:absolute;left:426.78px;top:170.54px" class="cls_074"><span class="cls_074">No</span></div>
<div style="position:absolute;left:238.83px;top:180.53px" class="cls_074"><span class="cls_074">with their configured and effective logging levels.</span></div>
<div style="position:absolute;left:108.18px;top:197.15px" class="cls_074"><span class="cls_074">GET, POST</span></div>
<div style="position:absolute;left:165.17px;top:197.15px" class="cls_074"><span class="cls_074">/loggers/{name}</span></div>
<div style="position:absolute;left:238.83px;top:197.15px" class="cls_074"><span class="cls_074">Returns the configured and effective logging level</span></div>
<div style="position:absolute;left:426.78px;top:197.15px" class="cls_074"><span class="cls_074">No</span></div>
<div style="position:absolute;left:238.83px;top:207.14px" class="cls_074"><span class="cls_074">of a given logger. The effective logging level can be</span></div>
<div style="position:absolute;left:238.83px;top:217.13px" class="cls_074"><span class="cls_074">set with a </span><span class="cls_060">POST</span><span class="cls_074"> request.</span></div>
<div style="position:absolute;left:108.18px;top:233.75px" class="cls_074"><span class="cls_074">GET</span></div>
<div style="position:absolute;left:165.19px;top:233.75px" class="cls_074"><span class="cls_074">/mappings</span></div>
<div style="position:absolute;left:238.82px;top:233.75px" class="cls_074"><span class="cls_074">Produces a report of all HTTP mappings and their</span></div>
<div style="position:absolute;left:426.78px;top:233.75px" class="cls_074"><span class="cls_074">No</span></div>
<div style="position:absolute;left:238.83px;top:243.74px" class="cls_074"><span class="cls_074">corresponding handler methods.</span></div>
<div style="position:absolute;left:108.18px;top:260.33px" class="cls_074"><span class="cls_074">GET</span></div>
<div style="position:absolute;left:165.18px;top:260.33px" class="cls_074"><span class="cls_074">/metrics</span></div>
<div style="position:absolute;left:238.83px;top:260.33px" class="cls_074"><span class="cls_074">Returns a list of all metrics categories.</span></div>
<div style="position:absolute;left:426.76px;top:260.33px" class="cls_074"><span class="cls_074">No</span></div>
<div style="position:absolute;left:108.18px;top:276.95px" class="cls_074"><span class="cls_074">GET</span></div>
<div style="position:absolute;left:165.18px;top:276.95px" class="cls_074"><span class="cls_074">/metrics/{name}</span></div>
<div style="position:absolute;left:238.81px;top:276.95px" class="cls_074"><span class="cls_074">Returns a multidimensional set of values for a</span></div>
<div style="position:absolute;left:426.78px;top:276.95px" class="cls_074"><span class="cls_074">No</span></div>
<div style="position:absolute;left:238.83px;top:286.94px" class="cls_074"><span class="cls_074">given metric.</span></div>
<div style="position:absolute;left:108.18px;top:303.53px" class="cls_074"><span class="cls_074">GET</span></div>
<div style="position:absolute;left:165.18px;top:303.53px" class="cls_074"><span class="cls_074">/scheduledtasks</span></div>
<div style="position:absolute;left:238.83px;top:303.53px" class="cls_074"><span class="cls_074">Lists all scheduled tasks.</span></div>
<div style="position:absolute;left:426.76px;top:303.53px" class="cls_074"><span class="cls_074">No</span></div>
<div style="position:absolute;left:108.18px;top:320.15px" class="cls_074"><span class="cls_074">GET</span></div>
<div style="position:absolute;left:165.19px;top:320.15px" class="cls_074"><span class="cls_074">/threaddump</span></div>
<div style="position:absolute;left:238.84px;top:320.15px" class="cls_074"><span class="cls_074">Returns a report of all application threads.</span></div>
<div style="position:absolute;left:426.82px;top:320.15px" class="cls_074"><span class="cls_074">No</span></div>
<div style="position:absolute;left:102.18px;top:346.28px" class="cls_039"><span class="cls_039">In addition to HTTP-based endpoints, all of the Actuator endpoints in table 16.1, with</span></div>
<div style="position:absolute;left:102.18px;top:359.27px" class="cls_039"><span class="cls_039">the lone exception of /heapdump, are also exposed as JMX MBeans. We’ll look at the</span></div>
<div style="position:absolute;left:102.18px;top:372.26px" class="cls_039"><span class="cls_039">JMX side of Actuator in chapter 19.</span></div>
<div style="position:absolute;left:66.18px;top:398.09px" class="cls_063"><span class="cls_063">16.1.1</span></div>
<div style="position:absolute;left:102.18px;top:398.09px" class="cls_063"><span class="cls_063">Configuring Actuator’s base path</span></div>
<div style="position:absolute;left:102.18px;top:415.76px" class="cls_039"><span class="cls_039">By default, the paths for all the endpoints shown in table 16.1 are prefixed with /actu-</span></div>
<div style="position:absolute;left:102.18px;top:428.78px" class="cls_039"><span class="cls_039">ator. This mean that, for example, if you wish to retrieve health information about</span></div>
<div style="position:absolute;left:102.18px;top:441.77px" class="cls_039"><span class="cls_039">your application from Actuator, then issuing a GET request for /actuator/health will</span></div>
<div style="position:absolute;left:102.18px;top:454.76px" class="cls_039"><span class="cls_039">return the information you need.</span></div>
<div style="position:absolute;left:118.30px;top:467.78px" class="cls_039"><span class="cls_039">The Actuator prefix path can be changed by setting the </span><span class="cls_059">management.endpoint</span></div>
<div style="position:absolute;left:102.18px;top:480.77px" class="cls_059"><span class="cls_059">.web.base-path</span><span class="cls_039"> property. For example, if you’d rather the prefix be /management,</span></div>
<div style="position:absolute;left:102.18px;top:493.76px" class="cls_039"><span class="cls_039">you would set the </span><span class="cls_059">management.endpoints.web.base-path</span><span class="cls_039"> property like this:</span></div>
<div style="position:absolute;left:102.18px;top:516.44px" class="cls_060"><span class="cls_060">management:</span></div>
<div style="position:absolute;left:111.78px;top:526.46px" class="cls_060"><span class="cls_060">endpoints:</span></div>
<div style="position:absolute;left:121.38px;top:536.45px" class="cls_060"><span class="cls_060">web:</span></div>
<div style="position:absolute;left:130.95px;top:546.44px" class="cls_061"><span class="cls_061">base-path: /management</span></div>
<div style="position:absolute;left:102.18px;top:570.77px" class="cls_039"><span class="cls_039">With this property set as shown, you’d need to make a GET request for /manage-</span></div>
<div style="position:absolute;left:102.18px;top:583.79px" class="cls_039"><span class="cls_039">ment/health to obtain the application’s health information.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:277156px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background420.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">398</span></div>
<div style="position:absolute;left:173.61px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 16</span></div>
<div style="position:absolute;left:222.54px;top:24.35px" class="cls_055"><span class="cls_055">Working with Spring Boot Actuator</span></div>
<div style="position:absolute;left:57.18px;top:50.48px" class="cls_063"><span class="cls_063">16.1.2</span></div>
<div style="position:absolute;left:93.18px;top:50.48px" class="cls_063"><span class="cls_063">Enabling and disabling Actuator endpoints</span></div>
<div style="position:absolute;left:93.18px;top:68.15px" class="cls_039"><span class="cls_039">You may have noticed that only the /health and /info endpoints are enabled by default.</span></div>
<div style="position:absolute;left:93.18px;top:81.17px" class="cls_039"><span class="cls_039">Most Actuator endpoints carry sensitive information and should be secured. You can</span></div>
<div style="position:absolute;left:93.18px;top:94.16px" class="cls_039"><span class="cls_039">use Spring Security to lock down Actuator, but because Actuator isn’t secured on its</span></div>
<div style="position:absolute;left:93.18px;top:107.15px" class="cls_039"><span class="cls_039">own, most of the endpoints are disabled by default, requiring you to opt in for the</span></div>
<div style="position:absolute;left:93.18px;top:120.17px" class="cls_039"><span class="cls_039">endpoints you wish to expose.</span></div>
<div style="position:absolute;left:108.27px;top:133.16px" class="cls_039"><span class="cls_039">Two configuration properties, </span><span class="cls_059">management.endpoints.web.exposure.include</span><span class="cls_039"> and</span></div>
<div style="position:absolute;left:93.18px;top:146.15px" class="cls_059"><span class="cls_059">management.endpoints.web.exposure.exclude</span><span class="cls_039">, can be used to control which end-</span></div>
<div style="position:absolute;left:93.18px;top:159.17px" class="cls_039"><span class="cls_039">points are exposed. Using </span><span class="cls_059">management.endpoints.web.exposure.include</span><span class="cls_039">, you can</span></div>
<div style="position:absolute;left:93.18px;top:172.16px" class="cls_039"><span class="cls_039">specify which endpoints you want to expose. For example, if you wish to expose only</span></div>
<div style="position:absolute;left:93.18px;top:185.15px" class="cls_039"><span class="cls_039">the /health, /info, /beans, and /conditions endpoints, you can specify that with the</span></div>
<div style="position:absolute;left:93.18px;top:198.17px" class="cls_039"><span class="cls_039">following configuration:</span></div>
<div style="position:absolute;left:93.18px;top:219.83px" class="cls_060"><span class="cls_060">management:</span></div>
<div style="position:absolute;left:102.78px;top:229.85px" class="cls_060"><span class="cls_060">endpoints:</span></div>
<div style="position:absolute;left:112.38px;top:239.84px" class="cls_060"><span class="cls_060">web:</span></div>
<div style="position:absolute;left:121.95px;top:249.83px" class="cls_060"><span class="cls_060">exposure:</span></div>
<div style="position:absolute;left:131.53px;top:259.85px" class="cls_061"><span class="cls_061">include: health,info,beans,conditions</span></div>
<div style="position:absolute;left:93.18px;top:284.15px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">management.endpoints.web.exposure.include</span><span class="cls_039"> property also accepts an asterisk</span></div>
<div style="position:absolute;left:93.18px;top:297.17px" class="cls_039"><span class="cls_039">(</span><span class="cls_059">*</span><span class="cls_039">) as a wildcard to indicate that all Actuator endpoints should be exposed:</span></div>
<div style="position:absolute;left:93.18px;top:318.83px" class="cls_060"><span class="cls_060">management:</span></div>
<div style="position:absolute;left:102.78px;top:328.85px" class="cls_060"><span class="cls_060">endpoints:</span></div>
<div style="position:absolute;left:112.38px;top:338.84px" class="cls_060"><span class="cls_060">web:</span></div>
<div style="position:absolute;left:121.95px;top:348.83px" class="cls_060"><span class="cls_060">exposure:</span></div>
<div style="position:absolute;left:131.53px;top:358.85px" class="cls_061"><span class="cls_061">include: '*'</span></div>
<div style="position:absolute;left:93.18px;top:383.18px" class="cls_039"><span class="cls_039">If you want to expose all but a few endpoints, it’s typically easier to include them all</span></div>
<div style="position:absolute;left:93.18px;top:396.17px" class="cls_039"><span class="cls_039">with a wildcard and then explicitly exclude a few. For example, to expose all Actua-</span></div>
<div style="position:absolute;left:93.18px;top:409.16px" class="cls_039"><span class="cls_039">tor endpoints except for /threaddump and /heapdump, you could set both the</span></div>
<div style="position:absolute;left:93.18px;top:422.18px" class="cls_059"><span class="cls_059">management.endpoints.web.exposure.include</span><span class="cls_039">  and </span><span class="cls_059"> management.endpoints.web</span></div>
<div style="position:absolute;left:93.18px;top:435.17px" class="cls_059"><span class="cls_059">.exposure.exclude</span><span class="cls_039"> properties like this:</span></div>
<div style="position:absolute;left:93.18px;top:456.86px" class="cls_060"><span class="cls_060">management:</span></div>
<div style="position:absolute;left:102.78px;top:466.85px" class="cls_060"><span class="cls_060">endpoints:</span></div>
<div style="position:absolute;left:112.38px;top:476.84px" class="cls_060"><span class="cls_060">web:</span></div>
<div style="position:absolute;left:121.95px;top:486.86px" class="cls_060"><span class="cls_060">exposure:</span></div>
<div style="position:absolute;left:131.53px;top:496.85px" class="cls_060"><span class="cls_060">include: '*'</span></div>
<div style="position:absolute;left:131.53px;top:506.84px" class="cls_061"><span class="cls_061">exclude: threaddump,heapdump</span></div>
<div style="position:absolute;left:93.18px;top:531.17px" class="cls_039"><span class="cls_039">Should you decide to expose more than /health and /info, it’s probably a good idea</span></div>
<div style="position:absolute;left:93.18px;top:544.16px" class="cls_039"><span class="cls_039">to configure Spring Security to restrict access to the other endpoints. We’ll look at</span></div>
<div style="position:absolute;left:93.18px;top:557.18px" class="cls_039"><span class="cls_039">how to secure Actuator endpoints in section 16.4. For now, though, let’s look at how</span></div>
<div style="position:absolute;left:93.18px;top:570.17px" class="cls_039"><span class="cls_039">you can consume the HTTP endpoints exposed by Actuator.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:277832px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background421.jpg" width="531" height="666"></div>
<div style="position:absolute;left:215.43px;top:24.35px" class="cls_055"><span class="cls_055">Consuming Actuator endpoints</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">399</span></div>
<div style="position:absolute;left:66.18px;top:49.81px" class="cls_040"><span class="cls_040">16.2</span></div>
<div style="position:absolute;left:102.18px;top:49.81px" class="cls_040"><span class="cls_040">Consuming Actuator endpoints</span></div>
<div style="position:absolute;left:102.18px;top:69.17px" class="cls_039"><span class="cls_039">Actuator can bestow a veritable treasure trove of interesting and useful information</span></div>
<div style="position:absolute;left:102.18px;top:82.16px" class="cls_039"><span class="cls_039">about a running application by way of the HTTP endpoints listed in table 16.1. As</span></div>
<div style="position:absolute;left:102.18px;top:95.15px" class="cls_039"><span class="cls_039">HTTP endpoints, these can be consumed like any REST API, using whatever HTTP</span></div>
<div style="position:absolute;left:102.18px;top:108.17px" class="cls_039"><span class="cls_039">client you wish, including Spring’s </span><span class="cls_059">RestTemplate</span><span class="cls_039"> and </span><span class="cls_059">WebClient</span><span class="cls_039">, from a browser-</span></div>
<div style="position:absolute;left:102.18px;top:121.16px" class="cls_039"><span class="cls_039">based JavaScript application, or simply with the curl command-line client.</span></div>
<div style="position:absolute;left:117.28px;top:134.15px" class="cls_039"><span class="cls_039">For the sake of exploring Actuator endpoints, you’ll use the curl command-line</span></div>
<div style="position:absolute;left:102.18px;top:147.17px" class="cls_039"><span class="cls_039">client in this chapter. In chapter 17, I’ll introduce you to Spring Boot Admin, which</span></div>
<div style="position:absolute;left:102.18px;top:160.16px" class="cls_039"><span class="cls_039">layers a user-friendly web application on top of an application’s Actuator endpoints.</span></div>
<div style="position:absolute;left:116.83px;top:173.15px" class="cls_039"><span class="cls_039">To get some idea of what endpoints Actuator has to offer, a GET request to Actua-</span></div>
<div style="position:absolute;left:102.18px;top:186.17px" class="cls_039"><span class="cls_039">tor’s base path will provide HATEOAS links for each of the endpoints. Using curl to</span></div>
<div style="position:absolute;left:102.18px;top:199.16px" class="cls_039"><span class="cls_039">make a request to /actuator, you might get a response something like this (abridged</span></div>
<div style="position:absolute;left:102.18px;top:212.15px" class="cls_039"><span class="cls_039">to save space):</span></div>
<div style="position:absolute;left:102.18px;top:234.83px" class="cls_060"><span class="cls_060">$ curl localhost:8081/actuator</span></div>
<div style="position:absolute;left:102.18px;top:244.85px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:111.78px;top:254.84px" class="cls_060"><span class="cls_060">"_links": {</span></div>
<div style="position:absolute;left:121.38px;top:264.83px" class="cls_060"><span class="cls_060">"self": {</span></div>
<div style="position:absolute;left:130.95px;top:274.85px" class="cls_060"><span class="cls_060">"href": "</span><a href="http://localhost:8081/actuator" "="">http://localhost:8081/actuator"</a>,</div>
<div style="position:absolute;left:130.95px;top:284.84px" class="cls_060"><span class="cls_060">"templated": false</span></div>
<div style="position:absolute;left:121.38px;top:294.83px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:121.38px;top:304.85px" class="cls_060"><span class="cls_060">"auditevents": {</span></div>
<div style="position:absolute;left:130.95px;top:314.84px" class="cls_060"><span class="cls_060">"href": "</span><a href="http://localhost:8081/actuator/auditevents" "="">http://localhost:8081/actuator/auditevents"</a>,</div>
<div style="position:absolute;left:130.95px;top:324.83px" class="cls_060"><span class="cls_060">"templated": false</span></div>
<div style="position:absolute;left:121.38px;top:334.85px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:121.38px;top:344.84px" class="cls_060"><span class="cls_060">"beans": {</span></div>
<div style="position:absolute;left:130.95px;top:354.83px" class="cls_060"><span class="cls_060">"href": "</span><a href="http://localhost:8081/actuator/beans" "="">http://localhost:8081/actuator/beans"</a>,</div>
<div style="position:absolute;left:130.95px;top:364.85px" class="cls_060"><span class="cls_060">"templated": false</span></div>
<div style="position:absolute;left:121.38px;top:374.84px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:121.38px;top:384.86px" class="cls_060"><span class="cls_060">"health": {</span></div>
<div style="position:absolute;left:130.95px;top:394.85px" class="cls_060"><span class="cls_060">"href": "</span><a href="http://localhost:8081/actuator/health" "="">http://localhost:8081/actuator/health"</a>,</div>
<div style="position:absolute;left:130.95px;top:404.84px" class="cls_060"><span class="cls_060">"templated": false</span></div>
<div style="position:absolute;left:121.38px;top:414.86px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:111.78px;top:434.84px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:444.86px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:469.16px" class="cls_039"><span class="cls_039">Because different libraries may contribute additional Actuator endpoints of their own,</span></div>
<div style="position:absolute;left:102.18px;top:482.18px" class="cls_039"><span class="cls_039">and because some endpoints may be not be exported, the actual results may vary from</span></div>
<div style="position:absolute;left:102.18px;top:495.17px" class="cls_039"><span class="cls_039">application to application.</span></div>
<div style="position:absolute;left:117.00px;top:508.16px" class="cls_039"><span class="cls_039">In any event, the set of links returned from Actuator’s base path serve as a map to</span></div>
<div style="position:absolute;left:102.18px;top:521.18px" class="cls_039"><span class="cls_039">all that Actuator has to offer. Let’s begin our exploration of the Actuator landscape</span></div>
<div style="position:absolute;left:102.18px;top:534.17px" class="cls_039"><span class="cls_039">with the two endpoints that provide essential information about an application: the</span></div>
<div style="position:absolute;left:102.18px;top:547.16px" class="cls_039"><span class="cls_039">/health and /info endpoints.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:278508px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background422.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">400</span></div>
<div style="position:absolute;left:173.61px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 16</span></div>
<div style="position:absolute;left:222.54px;top:24.35px" class="cls_055"><span class="cls_055">Working with Spring Boot Actuator</span></div>
<div style="position:absolute;left:57.18px;top:50.48px" class="cls_063"><span class="cls_063">16.2.1</span></div>
<div style="position:absolute;left:93.18px;top:50.48px" class="cls_063"><span class="cls_063">Fetching essential application information</span></div>
<div style="position:absolute;left:93.18px;top:68.15px" class="cls_039"><span class="cls_039">At the beginning of a typical visit to the doctor, we’re usually asked two very basic ques-</span></div>
<div style="position:absolute;left:93.18px;top:81.17px" class="cls_039"><span class="cls_039">tions: who are you and how do you feel? Although the words chosen by the doctor or</span></div>
<div style="position:absolute;left:93.18px;top:94.16px" class="cls_039"><span class="cls_039">nurse may be different, they ultimately want to know a little bit about the person</span></div>
<div style="position:absolute;left:93.18px;top:107.15px" class="cls_039"><span class="cls_039">they’re treating and why you’re seeing them.</span></div>
<div style="position:absolute;left:108.58px;top:120.17px" class="cls_039"><span class="cls_039">Those same essential questions are what Actuator’s /info and /health endpoints</span></div>
<div style="position:absolute;left:93.18px;top:133.16px" class="cls_039"><span class="cls_039">answer for a Spring Boot application. The /info endpoint tells you a little about the</span></div>
<div style="position:absolute;left:93.18px;top:146.15px" class="cls_039"><span class="cls_039">application, and the /health endpoint tells you how healthy the application is.</span></div>
<div style="position:absolute;left:93.18px;top:166.34px" class="cls_064"><span class="cls_064">A</span><span class="cls_065">SKING</span><span class="cls_064"> </span><span class="cls_065">FOR</span><span class="cls_064"> </span><span class="cls_065">INFORMATION</span><span class="cls_064"> </span><span class="cls_065">ABOUT</span><span class="cls_064"> </span><span class="cls_065">AN</span><span class="cls_064"> </span><span class="cls_065">APPLICATION</span></div>
<div style="position:absolute;left:93.18px;top:179.66px" class="cls_039"><span class="cls_039">To learn a little bit of information about a running Spring Boot application, you can</span></div>
<div style="position:absolute;left:93.18px;top:192.65px" class="cls_039"><span class="cls_039">ask the /info endpoint. By default, however, the /info endpoint isn’t very informative.</span></div>
<div style="position:absolute;left:93.18px;top:205.67px" class="cls_039"><span class="cls_039">Here’s what you might see when you make a request for it using curl:</span></div>
<div style="position:absolute;left:93.18px;top:227.33px" class="cls_060"><span class="cls_060">$ curl localhost:8081/actuator/info</span></div>
<div style="position:absolute;left:93.18px;top:237.35px" class="cls_061"><span class="cls_061">{}</span></div>
<div style="position:absolute;left:93.18px;top:261.65px" class="cls_039"><span class="cls_039">While it may seem that the /info endpoint isn’t very useful, it’s best to think of it as a</span></div>
<div style="position:absolute;left:93.18px;top:274.67px" class="cls_039"><span class="cls_039">clean canvas on which you may paint any information you’d like to present.</span></div>
<div style="position:absolute;left:107.85px;top:287.66px" class="cls_039"><span class="cls_039">There are several ways to supply information for the /info endpoint to return, but</span></div>
<div style="position:absolute;left:93.18px;top:300.68px" class="cls_039"><span class="cls_039">the most straightforward way is to create one or more configuration properties where</span></div>
<div style="position:absolute;left:93.18px;top:313.67px" class="cls_039"><span class="cls_039">the property name is prefixed with </span><span class="cls_104">info.</span><span class="cls_039">. For example, suppose that you want the</span></div>
<div style="position:absolute;left:93.18px;top:326.66px" class="cls_039"><span class="cls_039">response from the /info endpoint to include support contact information, including</span></div>
<div style="position:absolute;left:93.18px;top:339.68px" class="cls_039"><span class="cls_039">an email address and phone number. To do that, you can configure the following</span></div>
<div style="position:absolute;left:93.18px;top:352.67px" class="cls_039"><span class="cls_039">properties in the application.yml file:</span></div>
<div style="position:absolute;left:93.18px;top:374.33px" class="cls_060"><span class="cls_060">info:</span></div>
<div style="position:absolute;left:102.78px;top:384.35px" class="cls_060"><span class="cls_060">contact:</span></div>
<div style="position:absolute;left:112.38px;top:394.34px" class="cls_060"><span class="cls_060">email: support@tacocloud.com</span></div>
<div style="position:absolute;left:112.38px;top:404.36px" class="cls_061"><span class="cls_061">phone: 822-625-6831</span></div>
<div style="position:absolute;left:93.18px;top:428.66px" class="cls_039"><span class="cls_039">Neither the </span><span class="cls_059">info.contact.email</span><span class="cls_039"> property nor the </span><span class="cls_059">info.contact.phone</span><span class="cls_039"> property</span></div>
<div style="position:absolute;left:93.18px;top:441.68px" class="cls_039"><span class="cls_039">have any special meaning to Spring Boot or any bean that may be in the application</span></div>
<div style="position:absolute;left:93.18px;top:454.67px" class="cls_039"><span class="cls_039">context. However, by virtue of the fact that it’s prefixed with </span><span class="cls_104">info.</span><span class="cls_039">, the /info endpoint</span></div>
<div style="position:absolute;left:93.18px;top:467.66px" class="cls_039"><span class="cls_039">will now echo the value of the property in its response:</span></div>
<div style="position:absolute;left:93.18px;top:489.35px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:102.78px;top:499.34px" class="cls_060"><span class="cls_060">"contact": {</span></div>
<div style="position:absolute;left:112.38px;top:509.36px" class="cls_060"><span class="cls_060">"email": "support@tacocloud.com",</span></div>
<div style="position:absolute;left:112.38px;top:519.35px" class="cls_060"><span class="cls_060">"phone": "822-625-6831"</span></div>
<div style="position:absolute;left:102.78px;top:529.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:539.36px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:563.69px" class="cls_039"><span class="cls_039">In section 16.3.1, we’ll look at a few other ways to populate the /info endpoint with</span></div>
<div style="position:absolute;left:93.18px;top:576.68px" class="cls_039"><span class="cls_039">useful information about an application.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:279184px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background423.jpg" width="531" height="666"></div>
<div style="position:absolute;left:215.43px;top:24.35px" class="cls_055"><span class="cls_055">Consuming Actuator endpoints</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">401</span></div>
<div style="position:absolute;left:102.18px;top:50.84px" class="cls_064"><span class="cls_064">I</span><span class="cls_065">NSPECTING</span><span class="cls_064"> </span><span class="cls_065">APPLICATION</span><span class="cls_064"> </span><span class="cls_065">HEALTH</span></div>
<div style="position:absolute;left:102.18px;top:64.16px" class="cls_039"><span class="cls_039">Issuing an HTTP GET request for the /health endpoint results in a simple JSON</span></div>
<div style="position:absolute;left:102.18px;top:77.15px" class="cls_039"><span class="cls_039">response with the health status of your application. For example, here’s what you</span></div>
<div style="position:absolute;left:102.18px;top:90.17px" class="cls_039"><span class="cls_039">might see when using curl to fetch the /health endpoint:</span></div>
<div style="position:absolute;left:102.18px;top:112.82px" class="cls_060"><span class="cls_060">$ curl localhost:8080/actuator/health</span></div>
<div style="position:absolute;left:102.18px;top:122.84px" class="cls_061"><span class="cls_061">{"status":"UP"}</span></div>
<div style="position:absolute;left:102.18px;top:147.17px" class="cls_039"><span class="cls_039">You may be wondering how useful it is to have an endpoint that reports that the appli-</span></div>
<div style="position:absolute;left:102.18px;top:160.16px" class="cls_039"><span class="cls_039">cation is </span><span class="cls_059">UP</span><span class="cls_039">. What would it report if the application were down?</span></div>
<div style="position:absolute;left:117.02px;top:173.15px" class="cls_039"><span class="cls_039">As it turns out, the status shown here is an aggregate status of one or more health</span></div>
<div style="position:absolute;left:102.18px;top:186.17px" class="cls_039"><span class="cls_039">indicators. Health indicators report the health of external systems that the application</span></div>
<div style="position:absolute;left:102.18px;top:199.16px" class="cls_039"><span class="cls_039">interacts with, such as databases, message brokers, and even Spring Cloud compo-</span></div>
<div style="position:absolute;left:102.18px;top:212.15px" class="cls_039"><span class="cls_039">nents such as Eureka and the Config Server. The health status of each indicator could</span></div>
<div style="position:absolute;left:102.18px;top:225.17px" class="cls_039"><span class="cls_039">be one of the following:</span></div>
<div style="position:absolute;left:117.78px;top:244.16px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> UP</span><span class="cls_039">—The external system is up and is reachable.</span></div>
<div style="position:absolute;left:117.78px;top:258.17px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> DOWN</span><span class="cls_039">—The external system is down or unreachable.</span></div>
<div style="position:absolute;left:117.78px;top:272.15px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> UNKNOWN</span><span class="cls_039">—The status of the external system is unclear.</span></div>
<div style="position:absolute;left:117.78px;top:286.16px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> OUT_OF_SERVICE</span><span class="cls_039">—The external system is reachable but is currently unavailable.</span></div>
<div style="position:absolute;left:102.18px;top:306.17px" class="cls_039"><span class="cls_039">The health statuses of all health indicators are then aggregated into the application’s</span></div>
<div style="position:absolute;left:102.18px;top:319.16px" class="cls_039"><span class="cls_039">overall health status, applying the following rules:</span></div>
<div style="position:absolute;left:117.78px;top:338.18px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  If all health indicators are </span><span class="cls_059">UP</span><span class="cls_039">, then the application health status is </span><span class="cls_059">UP</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.78px;top:352.16px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  If one or more health indicators are </span><span class="cls_059">DOWN</span><span class="cls_039">, then the application health status</span></div>
<div style="position:absolute;left:129.78px;top:365.18px" class="cls_039"><span class="cls_039">is </span><span class="cls_059">DOWN</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.78px;top:379.16px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  If one or more health indicators are </span><span class="cls_059">OUT_OF_SERVICE</span><span class="cls_039">, then the application health</span></div>
<div style="position:absolute;left:129.78px;top:392.18px" class="cls_039"><span class="cls_039">status is </span><span class="cls_059">OUT_OF_SERVICE</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.78px;top:406.16px" class="cls_062"><span class="cls_062"></span><span class="cls_059"> UNKNOWN</span><span class="cls_039"> health statuses are ignored and aren’t rolled into the application’s</span></div>
<div style="position:absolute;left:129.78px;top:419.18px" class="cls_039"><span class="cls_039">aggregate health.</span></div>
<div style="position:absolute;left:102.18px;top:439.16px" class="cls_039"><span class="cls_039">By default, only the aggregate status is returned in response to a request for /health.</span></div>
<div style="position:absolute;left:102.18px;top:452.18px" class="cls_039"><span class="cls_039">You can configure the </span><span class="cls_059">management.endpoint.health.show-details</span><span class="cls_039"> property, how-</span></div>
<div style="position:absolute;left:102.18px;top:465.17px" class="cls_039"><span class="cls_039">ever, to show the full details of all health indicators:</span></div>
<div style="position:absolute;left:102.18px;top:487.85px" class="cls_060"><span class="cls_060">management:</span></div>
<div style="position:absolute;left:111.78px;top:497.84px" class="cls_060"><span class="cls_060">endpoint:</span></div>
<div style="position:absolute;left:121.38px;top:507.86px" class="cls_060"><span class="cls_060">health:</span></div>
<div style="position:absolute;left:130.95px;top:517.85px" class="cls_061"><span class="cls_061">show-details: always</span></div>
<div style="position:absolute;left:102.18px;top:542.18px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">management.endpoint.health.show-details</span><span class="cls_039"> property defaults to </span><span class="cls_059">never</span><span class="cls_039">, but it</span></div>
<div style="position:absolute;left:102.18px;top:555.17px" class="cls_039"><span class="cls_039">can also be set to </span><span class="cls_059">always</span><span class="cls_039"> to always show the full details of all health indicators, or to</span></div>
<div style="position:absolute;left:102.18px;top:568.19px" class="cls_059"><span class="cls_059">when-authorized</span><span class="cls_039"> to only show the full details when the requesting client is fully</span></div>
<div style="position:absolute;left:102.18px;top:581.18px" class="cls_039"><span class="cls_039">authorized.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:279860px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background424.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">402</span></div>
<div style="position:absolute;left:173.61px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 16</span></div>
<div style="position:absolute;left:222.54px;top:24.35px" class="cls_055"><span class="cls_055">Working with Spring Boot Actuator</span></div>
<div style="position:absolute;left:108.70px;top:50.66px" class="cls_039"><span class="cls_039">Now when you issue a GET request to the /health endpoint, you get full health</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">indicator details. Here’s a sample of what that might look like for a service that inte-</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">grates with the Mongo document database:</span></div>
<div style="position:absolute;left:93.18px;top:98.33px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:102.78px;top:108.32px" class="cls_060"><span class="cls_060">"status": "UP",</span></div>
<div style="position:absolute;left:102.78px;top:118.34px" class="cls_060"><span class="cls_060">"details": {</span></div>
<div style="position:absolute;left:112.38px;top:128.33px" class="cls_060"><span class="cls_060">"mongo": {</span></div>
<div style="position:absolute;left:121.95px;top:138.35px" class="cls_060"><span class="cls_060">"status": "UP",</span></div>
<div style="position:absolute;left:121.93px;top:148.34px" class="cls_060"><span class="cls_060">"details": {</span></div>
<div style="position:absolute;left:131.56px;top:158.33px" class="cls_060"><span class="cls_060">"version": "3.2.2"</span></div>
<div style="position:absolute;left:121.95px;top:168.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:112.38px;top:178.34px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:112.36px;top:188.33px" class="cls_060"><span class="cls_060">"diskSpace": {</span></div>
<div style="position:absolute;left:121.95px;top:198.35px" class="cls_060"><span class="cls_060">"status": "UP",</span></div>
<div style="position:absolute;left:121.93px;top:208.34px" class="cls_060"><span class="cls_060">"details": {</span></div>
<div style="position:absolute;left:131.53px;top:218.33px" class="cls_060"><span class="cls_060">"total": 499963170816,</span></div>
<div style="position:absolute;left:131.55px;top:228.35px" class="cls_060"><span class="cls_060">"free": 177284784128,</span></div>
<div style="position:absolute;left:131.55px;top:238.34px" class="cls_060"><span class="cls_060">"threshold": 10485760</span></div>
<div style="position:absolute;left:121.95px;top:248.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:112.38px;top:258.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.78px;top:268.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:278.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:302.66px" class="cls_039"><span class="cls_039">All applications, regardless of any other external dependencies, will have a health</span></div>
<div style="position:absolute;left:93.18px;top:315.68px" class="cls_039"><span class="cls_039">indicator for the filesystem named </span><span class="cls_059">diskSpace</span><span class="cls_039">. The </span><span class="cls_059">diskSpace</span><span class="cls_039"> health indicator indi-</span></div>
<div style="position:absolute;left:93.18px;top:328.67px" class="cls_039"><span class="cls_039">cates the health of the filesystem (hopefully, </span><span class="cls_059">UP</span><span class="cls_039">), which is determined by how much</span></div>
<div style="position:absolute;left:93.18px;top:341.66px" class="cls_039"><span class="cls_039">free space is remaining. If the available disk space drops below the threshold, it will</span></div>
<div style="position:absolute;left:93.18px;top:354.68px" class="cls_039"><span class="cls_039">report a status of </span><span class="cls_059">DOWN</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:107.81px;top:367.67px" class="cls_039"><span class="cls_039">In the preceding example, there’s also a </span><span class="cls_059">mongo</span><span class="cls_039"> health indicator, which reports the</span></div>
<div style="position:absolute;left:93.18px;top:380.66px" class="cls_039"><span class="cls_039">status of the Mongo database. Details shown include the Mongo database version.</span></div>
<div style="position:absolute;left:109.54px;top:393.68px" class="cls_039"><span class="cls_039">Autoconfiguration ensures that only health indicators that are pertinent to an</span></div>
<div style="position:absolute;left:93.18px;top:406.67px" class="cls_039"><span class="cls_039">application will appear in the response from the /health endpoint. In addition to the</span></div>
<div style="position:absolute;left:93.18px;top:419.66px" class="cls_059"><span class="cls_059">mongo</span><span class="cls_039"> and </span><span class="cls_059">diskSpace</span><span class="cls_039"> health indicators, Spring Boot also provides health indicators</span></div>
<div style="position:absolute;left:93.18px;top:432.68px" class="cls_039"><span class="cls_039">for several other external databases and systems, including these:</span></div>
<div style="position:absolute;left:108.78px;top:449.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Cassandra</span></div>
<div style="position:absolute;left:108.78px;top:463.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Config Server</span></div>
<div style="position:absolute;left:108.78px;top:477.68px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Couchbase</span></div>
<div style="position:absolute;left:108.78px;top:491.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Eureka</span></div>
<div style="position:absolute;left:108.78px;top:505.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Hystrix</span></div>
<div style="position:absolute;left:108.78px;top:519.68px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  JDBC data sources</span></div>
<div style="position:absolute;left:108.78px;top:533.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Elasticsearch</span></div>
<div style="position:absolute;left:108.78px;top:547.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  InfluxDB</span></div>
<div style="position:absolute;left:108.78px;top:561.68px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  JMS message brokers</span></div>
<div style="position:absolute;left:108.78px;top:575.69px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  LDAP</span></div>
<div style="position:absolute;left:108.78px;top:589.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Email servers</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:280536px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background425.jpg" width="531" height="666"></div>
<div style="position:absolute;left:215.43px;top:24.35px" class="cls_055"><span class="cls_055">Consuming Actuator endpoints</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">403</span></div>
<div style="position:absolute;left:117.78px;top:50.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Neo4j</span></div>
<div style="position:absolute;left:117.78px;top:64.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Rabbit message brokers</span></div>
<div style="position:absolute;left:117.78px;top:78.65px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Redis</span></div>
<div style="position:absolute;left:117.78px;top:92.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Solr</span></div>
<div style="position:absolute;left:102.18px;top:112.67px" class="cls_039"><span class="cls_039">Additionally, third-party libraries may contribute their own health indicators. We’ll</span></div>
<div style="position:absolute;left:102.18px;top:125.66px" class="cls_039"><span class="cls_039">look at how to write a custom health indicator in section 16.3.2.</span></div>
<div style="position:absolute;left:118.70px;top:138.65px" class="cls_039"><span class="cls_039">As you’ve seen, the /health and /info endpoints provide general information</span></div>
<div style="position:absolute;left:102.18px;top:151.67px" class="cls_039"><span class="cls_039">about the running application. Meanwhile, there are other Actuator endpoints that</span></div>
<div style="position:absolute;left:102.18px;top:164.66px" class="cls_039"><span class="cls_039">provide insight into the application configuration. Let’s look at how Actuator can</span></div>
<div style="position:absolute;left:102.18px;top:177.65px" class="cls_039"><span class="cls_039">show how an application is configured.</span></div>
<div style="position:absolute;left:66.18px;top:203.48px" class="cls_063"><span class="cls_063">16.2.2</span></div>
<div style="position:absolute;left:102.18px;top:203.48px" class="cls_063"><span class="cls_063">Viewing configuration details</span></div>
<div style="position:absolute;left:102.18px;top:221.15px" class="cls_039"><span class="cls_039">Beyond receiving general information about an application, it can be enlightening to</span></div>
<div style="position:absolute;left:102.18px;top:234.17px" class="cls_039"><span class="cls_039">understand how an application is configured. What beans are in the application con-</span></div>
<div style="position:absolute;left:102.18px;top:247.16px" class="cls_039"><span class="cls_039">text? What autoconfiguration conditions passed or failed? What environment proper-</span></div>
<div style="position:absolute;left:102.18px;top:260.15px" class="cls_039"><span class="cls_039">ties are available to the application? How are HTTP requests mapped to controllers?</span></div>
<div style="position:absolute;left:102.18px;top:273.17px" class="cls_039"><span class="cls_039">What logging level are one or more packages or classes set to?</span></div>
<div style="position:absolute;left:117.90px;top:286.16px" class="cls_039"><span class="cls_039">These questions are answered by Actuator’s /beans, /conditions, /env, /config-</span></div>
<div style="position:absolute;left:102.18px;top:299.18px" class="cls_039"><span class="cls_039">props, /mappings, and /loggers endpoints. And in some cases, such as /env and /log-</span></div>
<div style="position:absolute;left:102.18px;top:312.17px" class="cls_039"><span class="cls_039">gers, you can even adjust the configuration of a running application on the fly. We’ll</span></div>
<div style="position:absolute;left:102.18px;top:325.16px" class="cls_039"><span class="cls_039">look at how each of these endpoints gives insight into the configuration of a running</span></div>
<div style="position:absolute;left:102.18px;top:338.18px" class="cls_039"><span class="cls_039">application, starting with the /beans endpoint.</span></div>
<div style="position:absolute;left:102.18px;top:358.34px" class="cls_064"><span class="cls_064">G</span><span class="cls_065">ETTING</span><span class="cls_064"> </span><span class="cls_065">A</span><span class="cls_064"> </span><span class="cls_065">BEAN</span><span class="cls_064"> </span><span class="cls_065">WIRING</span><span class="cls_064"> </span><span class="cls_065">REPORT</span></div>
<div style="position:absolute;left:102.18px;top:371.66px" class="cls_039"><span class="cls_039">The most essential endpoint for exploring the Spring application context is the /beans</span></div>
<div style="position:absolute;left:102.18px;top:384.68px" class="cls_039"><span class="cls_039">endpoint. This endpoint returns a JSON document describing every single bean in the</span></div>
<div style="position:absolute;left:102.18px;top:397.67px" class="cls_039"><span class="cls_039">application context, its Java type, and any of the other beans it’s injected with.</span></div>
<div style="position:absolute;left:118.12px;top:410.66px" class="cls_039"><span class="cls_039">A complete response from a GET request to /beans could easily fill this entire</span></div>
<div style="position:absolute;left:102.18px;top:423.68px" class="cls_039"><span class="cls_039">chapter. Instead of examining the complete response from /beans, let’s consider the</span></div>
<div style="position:absolute;left:102.18px;top:436.67px" class="cls_039"><span class="cls_039">following snippet, which focuses on a single bean entry:</span></div>
<div style="position:absolute;left:102.18px;top:458.36px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:111.78px;top:468.35px" class="cls_060"><span class="cls_060">"contexts": {</span></div>
<div style="position:absolute;left:121.38px;top:478.34px" class="cls_060"><span class="cls_060">"application-1": {</span></div>
<div style="position:absolute;left:130.95px;top:488.36px" class="cls_060"><span class="cls_060">"beans": {</span></div>
<div style="position:absolute;left:140.55px;top:508.34px" class="cls_060"><span class="cls_060">"ingredientsController": {</span></div>
<div style="position:absolute;left:150.15px;top:518.36px" class="cls_060"><span class="cls_060">"aliases": [],</span></div>
<div style="position:absolute;left:150.15px;top:528.35px" class="cls_060"><span class="cls_060">"scope": "singleton",</span></div>
<div style="position:absolute;left:150.13px;top:538.34px" class="cls_060"><span class="cls_060">"type": "tacos.ingredients.IngredientsController",</span></div>
<div style="position:absolute;left:150.16px;top:548.36px" class="cls_060"><span class="cls_060">"resource": "file [/Users/habuma/Documents/Workspaces/</span></div>
<div style="position:absolute;left:159.76px;top:558.35px" class="cls_060"><span class="cls_060">TacoCloud/ingredient-service/target/classes/tacos/</span></div>
<div style="position:absolute;left:159.76px;top:568.34px" class="cls_060"><span class="cls_060">ingredients/IngredientsController.class]",</span></div>
<div style="position:absolute;left:150.16px;top:578.36px" class="cls_060"><span class="cls_060">"dependencies": [</span></div>
<div style="position:absolute;left:159.76px;top:588.35px" class="cls_060"><span class="cls_060">"ingredientRepository"</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:281212px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background426.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">404</span></div>
<div style="position:absolute;left:173.61px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 16</span></div>
<div style="position:absolute;left:222.54px;top:24.35px" class="cls_055"><span class="cls_055">Working with Spring Boot Actuator</span></div>
<div style="position:absolute;left:141.15px;top:51.32px" class="cls_060"><span class="cls_060">]</span></div>
<div style="position:absolute;left:131.55px;top:61.34px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:121.95px;top:81.32px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:121.95px;top:91.34px" class="cls_060"><span class="cls_060">"parentId": null</span></div>
<div style="position:absolute;left:112.38px;top:101.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.78px;top:111.32px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:121.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:145.67px" class="cls_039"><span class="cls_039">At the root of the response is the </span><span class="cls_059">contexts</span><span class="cls_039"> element, which includes one sub-element</span></div>
<div style="position:absolute;left:93.18px;top:158.66px" class="cls_039"><span class="cls_039">for each Spring application context in the application. Within each application con-</span></div>
<div style="position:absolute;left:93.18px;top:171.65px" class="cls_039"><span class="cls_039">text is a </span><span class="cls_059">beans</span><span class="cls_039"> element that holds details for all the beans in the application context.</span></div>
<div style="position:absolute;left:107.55px;top:184.67px" class="cls_039"><span class="cls_039">In the preceding example, the bean shown is the one whose name is </span><span class="cls_059">ingredients-</span></div>
<div style="position:absolute;left:93.18px;top:197.66px" class="cls_059"><span class="cls_059">Controller</span><span class="cls_039">. You can see that it has no aliases, is scoped as a singleton, and is of type</span></div>
<div style="position:absolute;left:93.18px;top:210.65px" class="cls_059"><span class="cls_059">tacos.ingredients.IngredientsController</span><span class="cls_039">. Moreover, the </span><span class="cls_059">resource</span><span class="cls_039"> property gives</span></div>
<div style="position:absolute;left:93.18px;top:223.67px" class="cls_039"><span class="cls_039">the path to the class file that defines the bean. And the </span><span class="cls_059">dependencies</span><span class="cls_039"> property lists all</span></div>
<div style="position:absolute;left:93.18px;top:236.66px" class="cls_039"><span class="cls_039">other beans that are injected into the given bean. In this case, the </span><span class="cls_059">ingredients-</span></div>
<div style="position:absolute;left:93.27px;top:249.65px" class="cls_059"><span class="cls_059">Controller</span><span class="cls_039"> bean is injected with a bean whose name is </span><span class="cls_059">ingredientRepository</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:93.18px;top:269.84px" class="cls_064"><span class="cls_064">E</span><span class="cls_065">XPLAINING</span><span class="cls_064"> </span><span class="cls_065">AUTOCONFIGURATION</span></div>
<div style="position:absolute;left:93.18px;top:283.16px" class="cls_039"><span class="cls_039">As you’ve seen, autoconfiguration is one of the most powerful things that Spring</span></div>
<div style="position:absolute;left:93.18px;top:296.18px" class="cls_039"><span class="cls_039">Boot offers. Sometimes, however, you may wonder why something has been auto-</span></div>
<div style="position:absolute;left:93.18px;top:309.17px" class="cls_039"><span class="cls_039">configured. Or you may expect something to have been autoconfigured and are left</span></div>
<div style="position:absolute;left:93.18px;top:322.16px" class="cls_039"><span class="cls_039">wondering why it hasn’t been. In that case, you can make a GET request to /condi-</span></div>
<div style="position:absolute;left:93.18px;top:335.18px" class="cls_039"><span class="cls_039">tions to get an explanation of what took place in autoconfiguration.</span></div>
<div style="position:absolute;left:109.63px;top:348.17px" class="cls_039"><span class="cls_039">The autoconfiguration report returned from /conditions is divided into three</span></div>
<div style="position:absolute;left:93.18px;top:361.16px" class="cls_039"><span class="cls_039">parts: positive matches (conditional configuration that passed), negative matches</span></div>
<div style="position:absolute;left:93.18px;top:374.18px" class="cls_039"><span class="cls_039">(conditional configuration that failed), and unconditional classes. The following snip-</span></div>
<div style="position:absolute;left:93.18px;top:387.17px" class="cls_039"><span class="cls_039">pet from the response to a request to /conditions shows an example of each section:</span></div>
<div style="position:absolute;left:93.18px;top:408.86px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:102.78px;top:418.85px" class="cls_060"><span class="cls_060">"contexts": {</span></div>
<div style="position:absolute;left:112.38px;top:428.84px" class="cls_060"><span class="cls_060">"application-1": {</span></div>
<div style="position:absolute;left:121.95px;top:438.86px" class="cls_060"><span class="cls_060">"positiveMatches": {</span></div>
<div style="position:absolute;left:131.55px;top:458.84px" class="cls_060"><span class="cls_060">"MongoDataAutoConfiguration#mongoTemplate": [</span></div>
<div style="position:absolute;left:141.15px;top:468.86px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:150.76px;top:478.85px" class="cls_060"><span class="cls_060">"condition": "OnBeanCondition",</span></div>
<div style="position:absolute;left:150.76px;top:488.84px" class="cls_060"><span class="cls_060">"message": "@ConditionalOnMissingBean (types:</span></div>
<div style="position:absolute;left:169.95px;top:498.86px" class="cls_060"><span class="cls_060">org.springframework.data.mongodb.core.MongoTemplate;</span></div>
<div style="position:absolute;left:169.93px;top:508.85px" class="cls_060"><span class="cls_060">SearchStrategy: all) did not find any beans"</span></div>
<div style="position:absolute;left:141.15px;top:518.84px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:131.55px;top:528.86px" class="cls_060"><span class="cls_060">],</span></div>
<div style="position:absolute;left:121.95px;top:548.84px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:121.95px;top:558.86px" class="cls_060"><span class="cls_060">"negativeMatches": {</span></div>
<div style="position:absolute;left:131.55px;top:578.84px" class="cls_060"><span class="cls_060">"DispatcherServletAutoConfiguration": {</span></div>
<div style="position:absolute;left:141.15px;top:588.86px" class="cls_060"><span class="cls_060">"notMatched": [</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:281888px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background427.jpg" width="531" height="666"></div>
<div style="position:absolute;left:215.43px;top:24.35px" class="cls_055"><span class="cls_055">Consuming Actuator endpoints</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">405</span></div>
<div style="position:absolute;left:159.75px;top:51.32px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:169.35px;top:61.34px" class="cls_060"><span class="cls_060">"condition": "OnClassCondition",</span></div>
<div style="position:absolute;left:169.33px;top:71.33px" class="cls_060"><span class="cls_060">"message": "@ConditionalOnClass did not find required</span></div>
<div style="position:absolute;left:188.53px;top:81.32px" class="cls_060"><span class="cls_060">class 'org.springframework.web.servlet.</span></div>
<div style="position:absolute;left:337.26px;top:91.34px" class="cls_060"><span class="cls_060">DispatcherServlet'"</span></div>
<div style="position:absolute;left:159.75px;top:101.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:150.15px;top:111.32px" class="cls_060"><span class="cls_060">],</span></div>
<div style="position:absolute;left:150.15px;top:121.34px" class="cls_060"><span class="cls_060">"matched": []</span></div>
<div style="position:absolute;left:140.55px;top:131.33px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:130.95px;top:151.34px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:130.93px;top:161.33px" class="cls_060"><span class="cls_060">"unconditionalClasses": [</span></div>
<div style="position:absolute;left:140.55px;top:181.34px" class="cls_060"><span class="cls_060">"org.springframework.boot.autoconfigure.context.</span></div>
<div style="position:absolute;left:226.92px;top:191.33px" class="cls_060"><span class="cls_060">ConfigurationPropertiesAutoConfiguration",</span></div>
<div style="position:absolute;left:130.95px;top:211.34px" class="cls_060"><span class="cls_060">]</span></div>
<div style="position:absolute;left:121.38px;top:221.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:231.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:241.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:265.67px" class="cls_039"><span class="cls_039">Under the </span><span class="cls_059">positiveMatches</span><span class="cls_039"> section, you see that a </span><span class="cls_059">MongoTemplate</span><span class="cls_039"> bean was config-</span></div>
<div style="position:absolute;left:102.18px;top:278.66px" class="cls_039"><span class="cls_039">ured by autoconfiguration because one didn’t already exist. The autoconfiguration</span></div>
<div style="position:absolute;left:102.18px;top:291.65px" class="cls_039"><span class="cls_039">that caused this includes a </span><span class="cls_059">@ConditionalOnMissingBean</span><span class="cls_039"> annotation, which passes off</span></div>
<div style="position:absolute;left:102.18px;top:304.67px" class="cls_039"><span class="cls_039">the bean to be configured if it hasn’t already been explicitly configured. But in this</span></div>
<div style="position:absolute;left:102.18px;top:317.66px" class="cls_039"><span class="cls_039">case, no beans of type </span><span class="cls_059">MongoTemplate</span><span class="cls_039"> were found, so autoconfiguration stepped in</span></div>
<div style="position:absolute;left:102.18px;top:330.68px" class="cls_039"><span class="cls_039">and configured one.</span></div>
<div style="position:absolute;left:116.58px;top:343.67px" class="cls_039"><span class="cls_039">Under </span><span class="cls_059">negativeMatches</span><span class="cls_039">, Spring Boot autoconfiguration considered configuring a</span></div>
<div style="position:absolute;left:102.18px;top:356.66px" class="cls_059"><span class="cls_059">DispatcherServlet</span><span class="cls_039">. But the </span><span class="cls_059">@ConditionalOnClass</span><span class="cls_039"> conditional annotation failed</span></div>
<div style="position:absolute;left:102.18px;top:369.68px" class="cls_039"><span class="cls_039">because </span><span class="cls_059">DispatcherServlet</span><span class="cls_039"> couldn’t be found.</span></div>
<div style="position:absolute;left:118.80px;top:382.67px" class="cls_039"><span class="cls_039">Finally, a </span><span class="cls_059">ConfigurationPropertiesAutoConfiguration</span><span class="cls_039"> bean was configured</span></div>
<div style="position:absolute;left:102.18px;top:395.66px" class="cls_039"><span class="cls_039">unconditionally, as seen under the </span><span class="cls_059">unconditionalClasses</span><span class="cls_039"> section. Configuration prop-</span></div>
<div style="position:absolute;left:102.18px;top:408.68px" class="cls_039"><span class="cls_039">erties are foundational to how Spring Boot operates, so any configuration pertaining</span></div>
<div style="position:absolute;left:102.18px;top:421.67px" class="cls_039"><span class="cls_039">to configuration properties should be autoconfigured without any conditions.</span></div>
<div style="position:absolute;left:102.18px;top:441.86px" class="cls_064"><span class="cls_064">I</span><span class="cls_065">NSPECTING</span><span class="cls_064"> </span><span class="cls_065">THE</span><span class="cls_064"> </span><span class="cls_065">ENVIRONMENT</span><span class="cls_064"> </span><span class="cls_065">AND</span><span class="cls_064"> </span><span class="cls_065">CONFIGURATION</span><span class="cls_064"> </span><span class="cls_065">PROPERTIES</span></div>
<div style="position:absolute;left:102.18px;top:455.18px" class="cls_039"><span class="cls_039">In addition to knowing how your application beans are wired together, you might also</span></div>
<div style="position:absolute;left:102.18px;top:468.17px" class="cls_039"><span class="cls_039">be interested in learning what environment properties are available and what configu-</span></div>
<div style="position:absolute;left:102.18px;top:481.16px" class="cls_039"><span class="cls_039">ration properties were injected on the beans.</span></div>
<div style="position:absolute;left:118.98px;top:494.18px" class="cls_039"><span class="cls_039">When you issue a GET request to the /env endpoint, you’ll receive a rather</span></div>
<div style="position:absolute;left:102.18px;top:507.17px" class="cls_039"><span class="cls_039">lengthy response that includes properties from all property sources in play in the</span></div>
<div style="position:absolute;left:102.18px;top:520.16px" class="cls_039"><span class="cls_039">Spring application. This includes properties from environment variables, JVM system</span></div>
<div style="position:absolute;left:102.18px;top:533.18px" class="cls_039"><span class="cls_039">properties, application.properties and application.yml files, and even the Spring</span></div>
<div style="position:absolute;left:102.18px;top:546.17px" class="cls_039"><span class="cls_039">Cloud Config Server (if the application is a client of the Config Server).</span></div>
<div style="position:absolute;left:117.42px;top:559.19px" class="cls_039"><span class="cls_039">The following listing shows a greatly abridged example of the kind of response</span></div>
<div style="position:absolute;left:102.18px;top:572.18px" class="cls_039"><span class="cls_039">you might get from the /env endpoint, to give you some idea of the kind of informa-</span></div>
<div style="position:absolute;left:102.18px;top:585.17px" class="cls_039"><span class="cls_039">tion it provides.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:282564px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background428.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">406</span></div>
<div style="position:absolute;left:173.61px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 16</span></div>
<div style="position:absolute;left:222.54px;top:24.35px" class="cls_055"><span class="cls_055">Working with Spring Boot Actuator</span></div>
<div style="position:absolute;left:105.18px;top:54.38px" class="cls_066"><span class="cls_066">Listing 16.1</span></div>
<div style="position:absolute;left:162.67px;top:54.38px" class="cls_066"><span class="cls_066">The results from the /env endpoint</span></div>
<div style="position:absolute;left:93.18px;top:74.24px" class="cls_060"><span class="cls_060">$ curl localhost:8081/actuator/env</span></div>
<div style="position:absolute;left:93.18px;top:84.23px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:102.78px;top:94.22px" class="cls_060"><span class="cls_060">"activeProfiles": [</span></div>
<div style="position:absolute;left:112.38px;top:104.24px" class="cls_060"><span class="cls_060">"development"</span></div>
<div style="position:absolute;left:102.78px;top:114.23px" class="cls_060"><span class="cls_060">],</span></div>
<div style="position:absolute;left:102.78px;top:124.22px" class="cls_060"><span class="cls_060">"propertySources": [</span></div>
<div style="position:absolute;left:112.38px;top:144.23px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:121.95px;top:154.25px" class="cls_060"><span class="cls_060">"name": "systemEnvironment",</span></div>
<div style="position:absolute;left:121.95px;top:164.24px" class="cls_060"><span class="cls_060">"properties": {</span></div>
<div style="position:absolute;left:131.55px;top:174.23px" class="cls_060"><span class="cls_060">"PATH": {</span></div>
<div style="position:absolute;left:141.16px;top:184.25px" class="cls_060"><span class="cls_060">"value": "/usr/bin:/bin:/usr/sbin:/sbin",</span></div>
<div style="position:absolute;left:141.17px;top:194.24px" class="cls_060"><span class="cls_060">"origin": "System Environment Property \"PATH\""</span></div>
<div style="position:absolute;left:131.55px;top:204.23px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:131.55px;top:224.24px" class="cls_060"><span class="cls_060">"HOME": {</span></div>
<div style="position:absolute;left:141.16px;top:234.23px" class="cls_060"><span class="cls_060">"value": "/Users/habuma",</span></div>
<div style="position:absolute;left:141.17px;top:244.25px" class="cls_060"><span class="cls_060">"origin": "System Environment Property \"HOME\""</span></div>
<div style="position:absolute;left:131.55px;top:254.24px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:121.95px;top:264.23px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:112.38px;top:274.25px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:112.38px;top:284.24px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:121.96px;top:294.23px" class="cls_060"><span class="cls_060">"name": "applicationConfig: [classpath:/application.yml]",</span></div>
<div style="position:absolute;left:121.95px;top:304.25px" class="cls_060"><span class="cls_060">"properties": {</span></div>
<div style="position:absolute;left:131.55px;top:314.24px" class="cls_060"><span class="cls_060">"spring.application.name": {</span></div>
<div style="position:absolute;left:141.15px;top:324.23px" class="cls_060"><span class="cls_060">"value": "ingredient-service",</span></div>
<div style="position:absolute;left:141.16px;top:334.25px" class="cls_060"><span class="cls_060">"origin": "class path resource [application.yml]:3:11"</span></div>
<div style="position:absolute;left:131.55px;top:344.24px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:131.55px;top:354.23px" class="cls_060"><span class="cls_060">"server.port": {</span></div>
<div style="position:absolute;left:141.15px;top:364.25px" class="cls_060"><span class="cls_060">"value": 8081,</span></div>
<div style="position:absolute;left:141.16px;top:374.24px" class="cls_060"><span class="cls_060">"origin": "class path resource [application.yml]:9:9"</span></div>
<div style="position:absolute;left:131.55px;top:384.23px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:121.95px;top:404.24px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:112.38px;top:414.26px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:102.78px;top:434.24px" class="cls_060"><span class="cls_060">]</span></div>
<div style="position:absolute;left:93.18px;top:444.26px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:468.56px" class="cls_039"><span class="cls_039">Although the full response from /env provides even more information, what’s</span></div>
<div style="position:absolute;left:93.18px;top:481.58px" class="cls_039"><span class="cls_039">shown in listing 16.1 contains a few noteworthy elements. First, notice that near the</span></div>
<div style="position:absolute;left:93.18px;top:494.57px" class="cls_039"><span class="cls_039">top of the response is a field named </span><span class="cls_059">activeProfiles</span><span class="cls_039">. In this case, it indicates that</span></div>
<div style="position:absolute;left:93.18px;top:507.56px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">development</span><span class="cls_039"> profile is active. If any other profiles were active, those would be</span></div>
<div style="position:absolute;left:93.18px;top:520.58px" class="cls_039"><span class="cls_039">listed as well.</span></div>
<div style="position:absolute;left:108.24px;top:533.57px" class="cls_039"><span class="cls_039">Next, the </span><span class="cls_059">propertySources</span><span class="cls_039"> field is an array containing an entry for every prop-</span></div>
<div style="position:absolute;left:93.18px;top:546.56px" class="cls_039"><span class="cls_039">erty source in the Spring application environment. In listing 16.1, only the </span><span class="cls_059">system-</span></div>
<div style="position:absolute;left:93.27px;top:559.58px" class="cls_059"><span class="cls_059">Environment</span><span class="cls_039"> and an </span><span class="cls_059">applicationConfig</span><span class="cls_039"> property source referencing the application</span></div>
<div style="position:absolute;left:93.18px;top:572.57px" class="cls_039"><span class="cls_039">.yml file are shown.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:283240px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background429.jpg" width="531" height="666"></div>
<div style="position:absolute;left:215.43px;top:24.35px" class="cls_055"><span class="cls_055">Consuming Actuator endpoints</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">407</span></div>
<div style="position:absolute;left:117.39px;top:50.66px" class="cls_039"><span class="cls_039">Within each property source is a listing of all properties provided by that source,</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">paired with their values. In the case of the application.yml property source, the </span><span class="cls_059">origin</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">field for each property tells exactly where the property is set, including the line and</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">column within application.yml.</span></div>
<div style="position:absolute;left:117.42px;top:102.65px" class="cls_039"><span class="cls_039">The /env endpoint can also be used to fetch a specific property when that prop-</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">erty’s name is given as the second element of the path. For example, to examine the</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_059"><span class="cls_059">server.port</span><span class="cls_039"> property, submit a GET request for /env/server.port, as shown here:</span></div>
<div style="position:absolute;left:102.18px;top:150.35px" class="cls_060"><span class="cls_060">$ curl localhost:8081/actuator/env/server.port</span></div>
<div style="position:absolute;left:102.18px;top:160.34px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:111.78px;top:170.33px" class="cls_060"><span class="cls_060">"property": {</span></div>
<div style="position:absolute;left:121.38px;top:180.35px" class="cls_060"><span class="cls_060">"source": "systemEnvironment", "value": "8081"</span></div>
<div style="position:absolute;left:111.78px;top:190.34px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:111.78px;top:200.33px" class="cls_060"><span class="cls_060">"activeProfiles": [ "development" ],</span></div>
<div style="position:absolute;left:111.78px;top:210.35px" class="cls_060"><span class="cls_060">"propertySources": [</span></div>
<div style="position:absolute;left:121.38px;top:220.34px" class="cls_060"><span class="cls_060">{ "name": "server.ports" },</span></div>
<div style="position:absolute;left:121.38px;top:230.33px" class="cls_060"><span class="cls_060">{ "name": "mongo.ports" },</span></div>
<div style="position:absolute;left:121.38px;top:240.35px" class="cls_060"><span class="cls_060">{ "name": "systemProperties" },</span></div>
<div style="position:absolute;left:121.38px;top:250.34px" class="cls_060"><span class="cls_060">{ "name": "systemEnvironment",</span></div>
<div style="position:absolute;left:130.93px;top:260.33px" class="cls_060"><span class="cls_060">"property": {</span></div>
<div style="position:absolute;left:140.56px;top:270.35px" class="cls_060"><span class="cls_060">"value": "8081",</span></div>
<div style="position:absolute;left:140.54px;top:280.34px" class="cls_060"><span class="cls_060">"origin": "System Environment Property \"SERVER_PORT\""</span></div>
<div style="position:absolute;left:130.95px;top:290.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:121.38px;top:300.35px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:121.38px;top:310.34px" class="cls_060"><span class="cls_060">{ "name": "random" },</span></div>
<div style="position:absolute;left:121.38px;top:320.33px" class="cls_060"><span class="cls_060">{ "name": "applicationConfig: [classpath:/application.yml]",</span></div>
<div style="position:absolute;left:130.93px;top:330.35px" class="cls_060"><span class="cls_060">"property": {</span></div>
<div style="position:absolute;left:140.55px;top:340.34px" class="cls_060"><span class="cls_060">"value": 0,</span></div>
<div style="position:absolute;left:140.52px;top:350.33px" class="cls_060"><span class="cls_060">"origin": "class path resource [application.yml]:9:9"</span></div>
<div style="position:absolute;left:130.95px;top:360.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:121.38px;top:370.34px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:121.36px;top:380.33px" class="cls_060"><span class="cls_060">{ "name": "springCloudClientHostInfo" },</span></div>
<div style="position:absolute;left:121.38px;top:390.35px" class="cls_060"><span class="cls_060">{ "name": "refresh" },</span></div>
<div style="position:absolute;left:121.38px;top:400.34px" class="cls_060"><span class="cls_060">{ "name": "defaultProperties" },</span></div>
<div style="position:absolute;left:121.38px;top:410.36px" class="cls_060"><span class="cls_060">{ "name": "Management Server" }</span></div>
<div style="position:absolute;left:111.78px;top:420.35px" class="cls_060"><span class="cls_060">]</span></div>
<div style="position:absolute;left:102.18px;top:430.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:451.67px" class="cls_039"><span class="cls_039">As you can see, all property sources are still represented, but only those that set the spec-</span></div>
<div style="position:absolute;left:102.18px;top:464.66px" class="cls_039"><span class="cls_039">ified property will contain any additional information. In this case, both the </span><span class="cls_059">system-</span></div>
<div style="position:absolute;left:102.27px;top:477.68px" class="cls_059"><span class="cls_059">Environment</span><span class="cls_039"> property source and the application.yml property source had values for</span></div>
<div style="position:absolute;left:102.18px;top:490.67px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">server.port</span><span class="cls_039"> property. Because the </span><span class="cls_059">systemEnvironment</span><span class="cls_039"> property source takes</span></div>
<div style="position:absolute;left:102.18px;top:503.66px" class="cls_039"><span class="cls_039">precedence over any of the property sources listed below it, its value of </span><span class="cls_059">8081</span><span class="cls_039"> wins. The</span></div>
<div style="position:absolute;left:102.18px;top:516.68px" class="cls_039"><span class="cls_039">winning value is reflected near the top under the </span><span class="cls_059">property</span><span class="cls_039"> field.</span></div>
<div style="position:absolute;left:116.58px;top:529.67px" class="cls_039"><span class="cls_039">The /env endpoint can be used for more than just reading property values. By sub-</span></div>
<div style="position:absolute;left:102.18px;top:542.66px" class="cls_039"><span class="cls_039">mitting a POST request to the /env endpoint, along with a JSON document with a</span></div>
<div style="position:absolute;left:102.18px;top:555.68px" class="cls_059"><span class="cls_059">name</span><span class="cls_039"> and </span><span class="cls_059">value</span><span class="cls_039"> field, you can also set properties in the running application. For</span></div>
<div style="position:absolute;left:102.18px;top:568.67px" class="cls_039"><span class="cls_039">example, to set a property named </span><span class="cls_059">tacocloud.discount.code</span><span class="cls_039"> to </span><span class="cls_059">TACOS1234</span><span class="cls_039">, you can</span></div>
<div style="position:absolute;left:102.18px;top:581.69px" class="cls_039"><span class="cls_039">use curl to submit the POST request at the command line like this:</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:283916px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background430.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">408</span></div>
<div style="position:absolute;left:173.61px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 16</span></div>
<div style="position:absolute;left:222.54px;top:24.35px" class="cls_055"><span class="cls_055">Working with Spring Boot Actuator</span></div>
<div style="position:absolute;left:93.18px;top:51.32px" class="cls_060"><span class="cls_060">$ curl localhost:8081/actuator/env \</span></div>
<div style="position:absolute;left:126.76px;top:61.34px" class="cls_060"><span class="cls_060">-d'{"name":"tacocloud.discount.code","value":"TACOS1234"}' \</span></div>
<div style="position:absolute;left:126.76px;top:71.33px" class="cls_060"><span class="cls_060">-H "Content-type: application/json"</span></div>
<div style="position:absolute;left:93.18px;top:81.32px" class="cls_061"><span class="cls_061">{"tacocloud.discount.code":"TACOS1234"}</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">After submitting the property, the newly set property and its value are returned in</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">the response. Later, should you decide you no longer need that property, you can</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">submit a DELETE request to the /env endpoint to delete all properties created</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">through that endpoint:</span></div>
<div style="position:absolute;left:93.18px;top:163.34px" class="cls_060"><span class="cls_060">$ curl localhost:8081/actuator/env -X DELETE</span></div>
<div style="position:absolute;left:93.18px;top:173.33px" class="cls_061"><span class="cls_061">{"tacocloud.discount.code":"TACOS1234"}</span></div>
<div style="position:absolute;left:93.18px;top:196.67px" class="cls_039"><span class="cls_039">As useful as setting properties through Actuator’s API can be, it’s important to be</span></div>
<div style="position:absolute;left:93.18px;top:209.66px" class="cls_039"><span class="cls_039">aware that any properties set with a POST request to the /env endpoint only apply</span></div>
<div style="position:absolute;left:93.18px;top:222.65px" class="cls_039"><span class="cls_039">to the application instance receiving the request, are temporary, and will be lost</span></div>
<div style="position:absolute;left:93.18px;top:235.67px" class="cls_039"><span class="cls_039">when the application restarts.</span></div>
<div style="position:absolute;left:93.18px;top:253.85px" class="cls_064"><span class="cls_064">N</span><span class="cls_065">AVIGATING</span><span class="cls_064"> HTTP </span><span class="cls_065">REQUEST</span><span class="cls_064"> </span><span class="cls_065">MAPPINGS</span></div>
<div style="position:absolute;left:93.18px;top:266.15px" class="cls_039"><span class="cls_039">Although Spring MVC’s (and Spring WebFlux’s) programming model makes it easy to</span></div>
<div style="position:absolute;left:93.18px;top:279.17px" class="cls_039"><span class="cls_039">handle HTTP requests by simply annotating methods with request-mapping annota-</span></div>
<div style="position:absolute;left:93.18px;top:292.16px" class="cls_039"><span class="cls_039">tions, it can sometimes be challenging to get a big-picture understanding of all the</span></div>
<div style="position:absolute;left:93.18px;top:305.18px" class="cls_039"><span class="cls_039">kinds of HTTP requests that an application can handle, and what kinds of compo-</span></div>
<div style="position:absolute;left:93.18px;top:318.17px" class="cls_039"><span class="cls_039">nents handle those requests.</span></div>
<div style="position:absolute;left:109.28px;top:331.16px" class="cls_039"><span class="cls_039">Actuator’s /mappings endpoint offers a one-stop view of every HTTP request</span></div>
<div style="position:absolute;left:93.18px;top:344.18px" class="cls_039"><span class="cls_039">handler in an application, whether it be from a Spring MVC controller or one of</span></div>
<div style="position:absolute;left:93.18px;top:357.17px" class="cls_039"><span class="cls_039">Actuator’s own endpoints. To get a complete list of all the endpoints in a Spring</span></div>
<div style="position:absolute;left:93.18px;top:370.16px" class="cls_039"><span class="cls_039">Boot application, make a GET request to the /mappings endpoint, and you might</span></div>
<div style="position:absolute;left:93.18px;top:383.18px" class="cls_039"><span class="cls_039">receive something that’s a little bit like the abridged response shown next.</span></div>
<div style="position:absolute;left:105.18px;top:409.88px" class="cls_066"><span class="cls_066">Listing 16.2</span></div>
<div style="position:absolute;left:162.65px;top:409.88px" class="cls_066"><span class="cls_066">HTTP mappings as shown by the /mappings endpoint</span></div>
<div style="position:absolute;left:93.18px;top:429.74px" class="cls_060"><span class="cls_060">$ curl localhost:8081/actuator/mappings | jq</span></div>
<div style="position:absolute;left:93.18px;top:439.76px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:102.78px;top:449.75px" class="cls_060"><span class="cls_060">"contexts": {</span></div>
<div style="position:absolute;left:112.38px;top:459.74px" class="cls_060"><span class="cls_060">"application-1": {</span></div>
<div style="position:absolute;left:121.95px;top:469.76px" class="cls_060"><span class="cls_060">"mappings": {</span></div>
<div style="position:absolute;left:131.53px;top:479.75px" class="cls_060"><span class="cls_060">"dispatcherHandlers": {</span></div>
<div style="position:absolute;left:141.16px;top:489.74px" class="cls_060"><span class="cls_060">"webHandler": [</span></div>
<div style="position:absolute;left:150.75px;top:509.75px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:160.35px;top:519.74px" class="cls_060"><span class="cls_060">"predicate": "{[/ingredients],methods=[GET]}",</span></div>
<div style="position:absolute;left:160.35px;top:529.76px" class="cls_060"><span class="cls_060">"handler": "public</span></div>
<div style="position:absolute;left:117.18px;top:539.75px" class="cls_060"><span class="cls_060">reactor.core.publisher.Flux&lt;tacos.ingredients.Ingredient&gt;</span></div>
<div style="position:absolute;left:117.18px;top:549.74px" class="cls_060"><span class="cls_060">tacos.ingredients.IngredientsController.allIngredients()",</span></div>
<div style="position:absolute;left:160.35px;top:559.76px" class="cls_060"><span class="cls_060">"details": {</span></div>
<div style="position:absolute;left:169.95px;top:569.75px" class="cls_060"><span class="cls_060">"handlerMethod": {</span></div>
<div style="position:absolute;left:179.53px;top:579.74px" class="cls_060"><span class="cls_060">"className": "tacos.ingredients.IngredientsController",</span></div>
<div style="position:absolute;left:179.53px;top:589.76px" class="cls_060"><span class="cls_060">"name": "allIngredients",</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:284592px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background431.jpg" width="531" height="666"></div>
<div style="position:absolute;left:215.43px;top:24.35px" class="cls_055"><span class="cls_055">Consuming Actuator endpoints</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">409</span></div>
<div style="position:absolute;left:188.53px;top:51.32px" class="cls_060"><span class="cls_060">"descriptor": "()Lreactor/core/publisher/Flux;"</span></div>
<div style="position:absolute;left:178.94px;top:61.34px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:178.95px;top:71.33px" class="cls_060"><span class="cls_060">"handlerFunction": null,</span></div>
<div style="position:absolute;left:178.95px;top:81.32px" class="cls_060"><span class="cls_060">"requestMappingConditions": {</span></div>
<div style="position:absolute;left:188.49px;top:91.34px" class="cls_060"><span class="cls_060">"consumes": [],</span></div>
<div style="position:absolute;left:188.53px;top:101.33px" class="cls_060"><span class="cls_060">"headers": [],</span></div>
<div style="position:absolute;left:188.53px;top:111.32px" class="cls_060"><span class="cls_060">"methods": [</span></div>
<div style="position:absolute;left:198.13px;top:121.34px" class="cls_060"><span class="cls_060">"GET"</span></div>
<div style="position:absolute;left:188.52px;top:131.33px" class="cls_060"><span class="cls_060">],</span></div>
<div style="position:absolute;left:188.53px;top:141.35px" class="cls_060"><span class="cls_060">"params": [],</span></div>
<div style="position:absolute;left:188.50px;top:151.34px" class="cls_060"><span class="cls_060">"patterns": [</span></div>
<div style="position:absolute;left:198.14px;top:161.33px" class="cls_060"><span class="cls_060">"/ingredients"</span></div>
<div style="position:absolute;left:188.52px;top:171.35px" class="cls_060"><span class="cls_060">],</span></div>
<div style="position:absolute;left:188.50px;top:181.34px" class="cls_060"><span class="cls_060">"produces": []</span></div>
<div style="position:absolute;left:178.95px;top:191.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:169.37px;top:201.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:159.76px;top:211.34px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:150.15px;top:231.35px" class="cls_060"><span class="cls_060">]</span></div>
<div style="position:absolute;left:140.55px;top:241.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:130.95px;top:251.33px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:130.93px;top:261.35px" class="cls_060"><span class="cls_060">"parentId": "application-1"</span></div>
<div style="position:absolute;left:121.38px;top:271.34px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:121.38px;top:281.33px" class="cls_060"><span class="cls_060">"bootstrap": {</span></div>
<div style="position:absolute;left:130.93px;top:291.35px" class="cls_060"><span class="cls_060">"mappings": {</span></div>
<div style="position:absolute;left:140.53px;top:301.34px" class="cls_060"><span class="cls_060">"dispatcherHandlers": {}</span></div>
<div style="position:absolute;left:130.95px;top:311.33px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:130.93px;top:321.35px" class="cls_060"><span class="cls_060">"parentId": null</span></div>
<div style="position:absolute;left:121.38px;top:331.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:341.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:351.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:371.66px" class="cls_039"><span class="cls_039">For the sake of brevity, this response has been abridged to only show a single request</span></div>
<div style="position:absolute;left:102.18px;top:384.68px" class="cls_039"><span class="cls_039">handler. Specifically, it shows that GET requests for /ingredients will be handled by</span></div>
<div style="position:absolute;left:102.18px;top:397.67px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">allIngredients()</span><span class="cls_039"> method of </span><span class="cls_059">IngredientsController</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:102.18px;top:415.85px" class="cls_064"><span class="cls_064">M</span><span class="cls_065">ANAGING</span><span class="cls_064"> </span><span class="cls_065">LOGGING</span><span class="cls_064"> </span><span class="cls_065">LEVELS</span></div>
<div style="position:absolute;left:102.18px;top:428.18px" class="cls_039"><span class="cls_039">Logging is an important feature of any application. Logging can provide a means of</span></div>
<div style="position:absolute;left:102.18px;top:441.17px" class="cls_039"><span class="cls_039">auditing as well as a crude means of debugging.</span></div>
<div style="position:absolute;left:116.64px;top:454.16px" class="cls_039"><span class="cls_039">Setting logging levels can be quite a balancing act. If you set the logging level to be</span></div>
<div style="position:absolute;left:102.18px;top:467.18px" class="cls_039"><span class="cls_039">too verbose, there may be too much noise in the logs, and finding useful information</span></div>
<div style="position:absolute;left:102.18px;top:480.17px" class="cls_039"><span class="cls_039">may be difficult. On the other hand, if you set logging levels to be too slack, the logs</span></div>
<div style="position:absolute;left:102.18px;top:493.16px" class="cls_039"><span class="cls_039">may not be of much value in understanding what an application is doing.</span></div>
<div style="position:absolute;left:117.62px;top:506.18px" class="cls_039"><span class="cls_039">Logging levels are typically applied on a package-by-package basis. If you’re ever</span></div>
<div style="position:absolute;left:102.18px;top:519.17px" class="cls_039"><span class="cls_039">wondering what logging levels are set in your running Spring Boot application, you</span></div>
<div style="position:absolute;left:102.18px;top:532.16px" class="cls_039"><span class="cls_039">can issue a GET request to the /loggers endpoint. The following JSON shows an</span></div>
<div style="position:absolute;left:102.18px;top:545.18px" class="cls_039"><span class="cls_039">excerpt from a response to /loggers:</span></div>
<div style="position:absolute;left:102.18px;top:564.86px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:111.77px;top:574.85px" class="cls_060"><span class="cls_060">"levels": [ "OFF", "ERROR", "WARN", "INFO", "DEBUG", "TRACE" ],</span></div>
<div style="position:absolute;left:111.78px;top:584.84px" class="cls_060"><span class="cls_060">"loggers": {</span></div>
<div style="position:absolute;left:121.38px;top:594.86px" class="cls_060"><span class="cls_060">"ROOT": {</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:285268px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background432.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">410</span></div>
<div style="position:absolute;left:173.61px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 16</span></div>
<div style="position:absolute;left:222.54px;top:24.35px" class="cls_055"><span class="cls_055">Working with Spring Boot Actuator</span></div>
<div style="position:absolute;left:121.96px;top:51.32px" class="cls_060"><span class="cls_060">"configuredLevel": "INFO", "effectiveLevel": "INFO"</span></div>
<div style="position:absolute;left:112.38px;top:61.34px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:112.38px;top:81.32px" class="cls_060"><span class="cls_060">"org.springframework.web": {</span></div>
<div style="position:absolute;left:121.96px;top:91.34px" class="cls_060"><span class="cls_060">"configuredLevel": null, "effectiveLevel": "INFO"</span></div>
<div style="position:absolute;left:112.38px;top:101.33px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:112.38px;top:121.34px" class="cls_060"><span class="cls_060">"tacos": {</span></div>
<div style="position:absolute;left:121.96px;top:131.33px" class="cls_060"><span class="cls_060">"configuredLevel": null, "effectiveLevel": "INFO"</span></div>
<div style="position:absolute;left:112.38px;top:141.35px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:112.38px;top:151.34px" class="cls_060"><span class="cls_060">"tacos.ingredients": {</span></div>
<div style="position:absolute;left:121.96px;top:161.33px" class="cls_060"><span class="cls_060">"configuredLevel": null, "effectiveLevel": "INFO"</span></div>
<div style="position:absolute;left:112.38px;top:171.35px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:112.36px;top:181.34px" class="cls_060"><span class="cls_060">"tacos.ingredients.IngredientServiceApplication": {</span></div>
<div style="position:absolute;left:121.96px;top:191.33px" class="cls_060"><span class="cls_060">"configuredLevel": null, "effectiveLevel": "INFO"</span></div>
<div style="position:absolute;left:112.38px;top:201.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.78px;top:211.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:221.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:244.67px" class="cls_039"><span class="cls_039">The response starts off with a list of all valid logging levels. After that, the </span><span class="cls_059">loggers</span></div>
<div style="position:absolute;left:93.18px;top:257.66px" class="cls_039"><span class="cls_039">element lists logging-level details for each package in the application. The </span><span class="cls_059">configured-</span></div>
<div style="position:absolute;left:93.27px;top:270.65px" class="cls_059"><span class="cls_059">Level</span><span class="cls_039"> property shows the logging level that has been explicitly configured (or </span><span class="cls_059">null</span></div>
<div style="position:absolute;left:93.18px;top:283.67px" class="cls_039"><span class="cls_039">if it hasn’t been explicitly configured). The </span><span class="cls_059">effectiveLevel</span><span class="cls_039"> property gives the effec-</span></div>
<div style="position:absolute;left:93.18px;top:296.66px" class="cls_039"><span class="cls_039">tive logging level, which may have been inherited from a parent package or from the</span></div>
<div style="position:absolute;left:93.18px;top:309.68px" class="cls_039"><span class="cls_039">root logger.</span></div>
<div style="position:absolute;left:108.00px;top:322.67px" class="cls_039"><span class="cls_039">Although this excerpt only shows logging levels for the root logger and four pack-</span></div>
<div style="position:absolute;left:93.18px;top:335.66px" class="cls_039"><span class="cls_039">ages, the complete response will include logging-level entries for every single package</span></div>
<div style="position:absolute;left:93.18px;top:348.68px" class="cls_039"><span class="cls_039">in the application, including those for libraries that are in use. If you’d rather focus</span></div>
<div style="position:absolute;left:93.18px;top:361.67px" class="cls_039"><span class="cls_039">your request on a specific package, you can specify the package name as an extra path</span></div>
<div style="position:absolute;left:93.18px;top:374.66px" class="cls_039"><span class="cls_039">component in the request.</span></div>
<div style="position:absolute;left:109.74px;top:387.68px" class="cls_039"><span class="cls_039">For example, if you just want to know what logging levels are set for the </span><span class="cls_059">taco-</span></div>
<div style="position:absolute;left:93.18px;top:400.67px" class="cls_059"><span class="cls_059">cloud.ingredients</span><span class="cls_039"> package, you can make a request to /loggers/tacos.ingredients:</span></div>
<div style="position:absolute;left:93.18px;top:420.35px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:102.78px;top:430.34px" class="cls_060"><span class="cls_060">"configuredLevel": null,</span></div>
<div style="position:absolute;left:102.78px;top:440.36px" class="cls_060"><span class="cls_060">"effectiveLevel": "INFO"</span></div>
<div style="position:absolute;left:93.18px;top:450.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:473.66px" class="cls_039"><span class="cls_039">Aside from returning the logging levels for the application packages, the /loggers</span></div>
<div style="position:absolute;left:93.18px;top:486.68px" class="cls_039"><span class="cls_039">endpoint also allows you to change the configured logging level by issuing a POST</span></div>
<div style="position:absolute;left:93.18px;top:499.67px" class="cls_039"><span class="cls_039">request. For example, suppose you want to set the logging level of the </span><span class="cls_059">taco-</span></div>
<div style="position:absolute;left:93.18px;top:512.66px" class="cls_059"><span class="cls_059">cloud.ingredients</span><span class="cls_039"> package to </span><span class="cls_059">DEBUG</span><span class="cls_039">. The following curl command will achieve that:</span></div>
<div style="position:absolute;left:93.18px;top:532.34px" class="cls_060"><span class="cls_060">$ curl localhost:8081/actuator/loggers/tacos/ingredients \</span></div>
<div style="position:absolute;left:126.76px;top:542.36px" class="cls_060"><span class="cls_060">-d'{"configuredLevel":"DEBUG"}' \</span></div>
<div style="position:absolute;left:126.76px;top:552.35px" class="cls_061"><span class="cls_061">-H"Content-type: application/json"</span></div>
<div style="position:absolute;left:93.18px;top:575.69px" class="cls_039"><span class="cls_039">Now that the logging level has been changed, you can issue a GET request to /loggers/</span></div>
<div style="position:absolute;left:93.18px;top:588.68px" class="cls_039"><span class="cls_039">tacos/ingredients to see that it has been changed:</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:285944px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background433.jpg" width="531" height="666"></div>
<div style="position:absolute;left:215.43px;top:24.35px" class="cls_055"><span class="cls_055">Consuming Actuator endpoints</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">411</span></div>
<div style="position:absolute;left:102.18px;top:51.32px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:111.78px;top:61.34px" class="cls_060"><span class="cls_060">"configuredLevel": "DEBUG",</span></div>
<div style="position:absolute;left:111.78px;top:71.33px" class="cls_060"><span class="cls_060">"effectiveLevel": "DEBUG"</span></div>
<div style="position:absolute;left:102.18px;top:81.32px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">Notice that where the </span><span class="cls_059">configuredLevel</span><span class="cls_039"> was previously </span><span class="cls_059">null</span><span class="cls_039">, it’s now </span><span class="cls_059">DEBUG</span><span class="cls_039">. That</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">change carries over to the </span><span class="cls_059">effectiveLevel</span><span class="cls_039"> as well. But what’s most important is that if</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">any code in that package logs anything at debug level, the log files will include that</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">debug-level information.</span></div>
<div style="position:absolute;left:66.18px;top:163.49px" class="cls_063"><span class="cls_063">16.2.3</span></div>
<div style="position:absolute;left:102.18px;top:163.49px" class="cls_063"><span class="cls_063">Viewing application activity</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">It can be useful to keep an eye on activity in a running application, including the kinds</span></div>
<div style="position:absolute;left:102.18px;top:193.67px" class="cls_039"><span class="cls_039">of HTTP requests that the application is handling and the activity of all of the</span></div>
<div style="position:absolute;left:102.18px;top:206.66px" class="cls_039"><span class="cls_039">threads in the application. For this, Actuator provides the /httptrace, /threaddump,</span></div>
<div style="position:absolute;left:102.18px;top:219.65px" class="cls_039"><span class="cls_039">and /heapdump endpoints.</span></div>
<div style="position:absolute;left:118.84px;top:232.67px" class="cls_039"><span class="cls_039">The /heapdump endpoint is perhaps the most difficult Actuator endpoint to</span></div>
<div style="position:absolute;left:102.18px;top:245.66px" class="cls_039"><span class="cls_039">describe in any detail. Put succinctly, it downloads a gzip-compressed HPROF heap</span></div>
<div style="position:absolute;left:102.18px;top:258.65px" class="cls_039"><span class="cls_039">dump file that can be used to track down memory or thread issues. For the sake of</span></div>
<div style="position:absolute;left:102.18px;top:271.67px" class="cls_039"><span class="cls_039">space and because use of the heap dump is a rather advanced feature, I’m going to</span></div>
<div style="position:absolute;left:102.18px;top:284.66px" class="cls_039"><span class="cls_039">limit coverage of the /heapdump endpoint to this paragraph.</span></div>
<div style="position:absolute;left:102.18px;top:302.84px" class="cls_064"><span class="cls_064">T</span><span class="cls_065">RACING</span><span class="cls_064"> HTTP </span><span class="cls_065">ACTIVITY</span></div>
<div style="position:absolute;left:102.18px;top:315.17px" class="cls_039"><span class="cls_039">The /httptrace endpoint reports details on the most recent 100 requests handled by</span></div>
<div style="position:absolute;left:102.18px;top:328.16px" class="cls_039"><span class="cls_039">an application. Details included are the request method and path, a timestamp indi-</span></div>
<div style="position:absolute;left:102.18px;top:341.18px" class="cls_039"><span class="cls_039">cating when the request was handled, headers from both the request and the</span></div>
<div style="position:absolute;left:102.18px;top:354.17px" class="cls_039"><span class="cls_039">response, and the time taken handling the request.</span></div>
<div style="position:absolute;left:118.60px;top:367.16px" class="cls_039"><span class="cls_039">The following snippet of JSON shows a single entry from the response of the</span></div>
<div style="position:absolute;left:102.18px;top:380.18px" class="cls_039"><span class="cls_039">/httptrace endpoint:</span></div>
<div style="position:absolute;left:102.18px;top:399.86px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:111.78px;top:409.85px" class="cls_060"><span class="cls_060">"traces": [</span></div>
<div style="position:absolute;left:121.38px;top:419.84px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:130.95px;top:429.86px" class="cls_060"><span class="cls_060">"timestamp": "2018-06-03T23:41:24.494Z",</span></div>
<div style="position:absolute;left:130.95px;top:439.85px" class="cls_060"><span class="cls_060">"principal": null,</span></div>
<div style="position:absolute;left:130.95px;top:449.84px" class="cls_060"><span class="cls_060">"session": null,</span></div>
<div style="position:absolute;left:130.95px;top:459.86px" class="cls_060"><span class="cls_060">"request": {</span></div>
<div style="position:absolute;left:140.52px;top:469.85px" class="cls_060"><span class="cls_060">"method": "GET",</span></div>
<div style="position:absolute;left:140.55px;top:479.84px" class="cls_060"><span class="cls_060">"uri": "</span><a href="http://localhost:8081/ingredients" "="">http://localhost:8081/ingredients"</a>,</div>
<div style="position:absolute;left:140.55px;top:489.86px" class="cls_060"><span class="cls_060">"headers": {</span></div>
<div style="position:absolute;left:150.13px;top:499.85px" class="cls_060"><span class="cls_060">"Host": ["localhost:8081"],</span></div>
<div style="position:absolute;left:150.16px;top:509.84px" class="cls_060"><span class="cls_060">"User-Agent": ["curl/7.54.0"],</span></div>
<div style="position:absolute;left:150.16px;top:519.86px" class="cls_060"><span class="cls_060">"Accept": ["*/*"]</span></div>
<div style="position:absolute;left:140.55px;top:529.85px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:140.55px;top:539.84px" class="cls_060"><span class="cls_060">"remoteAddress": null</span></div>
<div style="position:absolute;left:130.95px;top:549.86px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:130.93px;top:559.85px" class="cls_060"><span class="cls_060">"response": {</span></div>
<div style="position:absolute;left:140.53px;top:569.84px" class="cls_060"><span class="cls_060">"status": 200,</span></div>
<div style="position:absolute;left:140.55px;top:579.86px" class="cls_060"><span class="cls_060">"headers": {</span></div>
<div style="position:absolute;left:150.15px;top:589.85px" class="cls_060"><span class="cls_060">"Content-Type": ["application/json;charset=UTF-8"]</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:286620px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background434.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">412</span></div>
<div style="position:absolute;left:173.61px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 16</span></div>
<div style="position:absolute;left:222.54px;top:24.35px" class="cls_055"><span class="cls_055">Working with Spring Boot Actuator</span></div>
<div style="position:absolute;left:131.55px;top:51.32px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:121.95px;top:61.34px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:121.95px;top:71.33px" class="cls_060"><span class="cls_060">"timeTaken": 4</span></div>
<div style="position:absolute;left:112.38px;top:81.32px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:102.78px;top:101.33px" class="cls_060"><span class="cls_060">]</span></div>
<div style="position:absolute;left:93.18px;top:111.32px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:135.65px" class="cls_039"><span class="cls_039">Although this information may be useful for debugging purposes, it’s even more inter-</span></div>
<div style="position:absolute;left:93.18px;top:148.67px" class="cls_039"><span class="cls_039">esting when the trace data is tracked over time, providing insight into how busy the</span></div>
<div style="position:absolute;left:93.18px;top:161.66px" class="cls_039"><span class="cls_039">application was at any given time as well as how many requests were successful com-</span></div>
<div style="position:absolute;left:93.18px;top:174.65px" class="cls_039"><span class="cls_039">pared to how many failed, based on the value of the response status. In chapter 17,</span></div>
<div style="position:absolute;left:93.18px;top:187.67px" class="cls_039"><span class="cls_039">you’ll see how Spring Boot Admin captures this information into a running graph that</span></div>
<div style="position:absolute;left:93.18px;top:200.66px" class="cls_039"><span class="cls_039">visualizes the HTTP trace information over a period of time.</span></div>
<div style="position:absolute;left:93.18px;top:220.85px" class="cls_064"><span class="cls_064">M</span><span class="cls_065">ONITORING</span><span class="cls_064"> </span><span class="cls_065">THREADS</span></div>
<div style="position:absolute;left:93.18px;top:234.17px" class="cls_039"><span class="cls_039">In addition to HTTP request tracing, thread activity can also be useful in determining</span></div>
<div style="position:absolute;left:93.18px;top:247.16px" class="cls_039"><span class="cls_039">what’s going on in a running application. The /threaddump endpoint produces a</span></div>
<div style="position:absolute;left:93.18px;top:260.15px" class="cls_039"><span class="cls_039">snapshot of current thread activity. The following snippet from a /threaddump response</span></div>
<div style="position:absolute;left:93.18px;top:273.17px" class="cls_039"><span class="cls_039">gives a taste of what this endpoint provides:</span></div>
<div style="position:absolute;left:93.18px;top:296.84px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:102.78px;top:306.83px" class="cls_060"><span class="cls_060">"threadName": "reactor-http-nio-8",</span></div>
<div style="position:absolute;left:102.78px;top:316.85px" class="cls_060"><span class="cls_060">"threadId": 338,</span></div>
<div style="position:absolute;left:102.76px;top:326.84px" class="cls_060"><span class="cls_060">"blockedTime": -1,</span></div>
<div style="position:absolute;left:102.78px;top:336.83px" class="cls_060"><span class="cls_060">"blockedCount": 0,</span></div>
<div style="position:absolute;left:102.78px;top:346.85px" class="cls_060"><span class="cls_060">"waitedTime": -1,</span></div>
<div style="position:absolute;left:102.76px;top:356.84px" class="cls_060"><span class="cls_060">"waitedCount": 0,</span></div>
<div style="position:absolute;left:102.78px;top:366.83px" class="cls_060"><span class="cls_060">"lockName": null,</span></div>
<div style="position:absolute;left:102.76px;top:376.85px" class="cls_060"><span class="cls_060">"lockOwnerId": -1,</span></div>
<div style="position:absolute;left:102.78px;top:386.84px" class="cls_060"><span class="cls_060">"lockOwnerName": null,</span></div>
<div style="position:absolute;left:102.78px;top:396.86px" class="cls_060"><span class="cls_060">"inNative": true,</span></div>
<div style="position:absolute;left:102.78px;top:406.85px" class="cls_060"><span class="cls_060">"suspended": false,</span></div>
<div style="position:absolute;left:102.76px;top:416.84px" class="cls_060"><span class="cls_060">"threadState": "RUNNABLE",</span></div>
<div style="position:absolute;left:102.78px;top:426.86px" class="cls_060"><span class="cls_060">"stackTrace": [</span></div>
<div style="position:absolute;left:112.38px;top:436.85px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:121.95px;top:446.84px" class="cls_060"><span class="cls_060">"methodName": "kevent0",</span></div>
<div style="position:absolute;left:121.96px;top:456.86px" class="cls_060"><span class="cls_060">"fileName": "KQueueArrayWrapper.java",</span></div>
<div style="position:absolute;left:121.96px;top:466.85px" class="cls_060"><span class="cls_060">"lineNumber": -2,</span></div>
<div style="position:absolute;left:121.96px;top:476.84px" class="cls_060"><span class="cls_060">"className": "sun.nio.ch.KQueueArrayWrapper",</span></div>
<div style="position:absolute;left:121.96px;top:486.86px" class="cls_060"><span class="cls_060">"nativeMethod": true</span></div>
<div style="position:absolute;left:112.38px;top:496.85px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:112.38px;top:506.84px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:121.95px;top:516.86px" class="cls_060"><span class="cls_060">"methodName": "poll",</span></div>
<div style="position:absolute;left:121.95px;top:526.85px" class="cls_060"><span class="cls_060">"fileName": "KQueueArrayWrapper.java",</span></div>
<div style="position:absolute;left:121.95px;top:536.84px" class="cls_060"><span class="cls_060">"lineNumber": 198,</span></div>
<div style="position:absolute;left:121.95px;top:546.86px" class="cls_060"><span class="cls_060">"className": "sun.nio.ch.KQueueArrayWrapper",</span></div>
<div style="position:absolute;left:121.95px;top:556.85px" class="cls_060"><span class="cls_060">"nativeMethod": false</span></div>
<div style="position:absolute;left:112.38px;top:566.84px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:102.78px;top:586.85px" class="cls_060"><span class="cls_060">],</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:287296px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background435.jpg" width="531" height="666"></div>
<div style="position:absolute;left:215.43px;top:24.35px" class="cls_055"><span class="cls_055">Consuming Actuator endpoints</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">413</span></div>
<div style="position:absolute;left:111.78px;top:51.32px" class="cls_060"><span class="cls_060">"lockedMonitors": [</span></div>
<div style="position:absolute;left:121.38px;top:61.34px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:130.95px;top:71.33px" class="cls_060"><span class="cls_060">"className": "io.netty.channel.nio.SelectedSelectionKeySet",</span></div>
<div style="position:absolute;left:130.95px;top:81.32px" class="cls_060"><span class="cls_060">"identityHashCode": 1039768944,</span></div>
<div style="position:absolute;left:130.95px;top:91.34px" class="cls_060"><span class="cls_060">"lockedStackDepth": 3,</span></div>
<div style="position:absolute;left:130.95px;top:101.33px" class="cls_060"><span class="cls_060">"lockedStackFrame": {</span></div>
<div style="position:absolute;left:140.55px;top:111.32px" class="cls_060"><span class="cls_060">"methodName": "lockAndDoSelect",</span></div>
<div style="position:absolute;left:140.55px;top:121.34px" class="cls_060"><span class="cls_060">"fileName": "SelectorImpl.java",</span></div>
<div style="position:absolute;left:140.55px;top:131.33px" class="cls_060"><span class="cls_060">"lineNumber": 86,</span></div>
<div style="position:absolute;left:140.55px;top:141.35px" class="cls_060"><span class="cls_060">"className": "sun.nio.ch.SelectorImpl",</span></div>
<div style="position:absolute;left:140.55px;top:151.34px" class="cls_060"><span class="cls_060">"nativeMethod": false</span></div>
<div style="position:absolute;left:130.95px;top:161.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:121.38px;top:171.35px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:111.78px;top:191.33px" class="cls_060"><span class="cls_060">],</span></div>
<div style="position:absolute;left:111.78px;top:201.35px" class="cls_060"><span class="cls_060">"lockedSynchronizers": [],</span></div>
<div style="position:absolute;left:111.78px;top:211.34px" class="cls_060"><span class="cls_060">"lockInfo": null</span></div>
<div style="position:absolute;left:102.18px;top:221.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:240.65px" class="cls_039"><span class="cls_039">The complete thread dump report includes every thread in the running application.</span></div>
<div style="position:absolute;left:102.18px;top:253.67px" class="cls_039"><span class="cls_039">To save space, the thread dump here shows an abridged entry for a single thread. As</span></div>
<div style="position:absolute;left:102.18px;top:266.66px" class="cls_039"><span class="cls_039">you can see, it includes details regarding the blocking and locking status of the</span></div>
<div style="position:absolute;left:102.18px;top:279.65px" class="cls_039"><span class="cls_039">thread, among other thread specifics. There’s also a stack trace that gives some insight</span></div>
<div style="position:absolute;left:102.18px;top:292.67px" class="cls_039"><span class="cls_039">into which area of the code the thread is spending time on.</span></div>
<div style="position:absolute;left:116.74px;top:305.66px" class="cls_039"><span class="cls_039">Since the /threaddump endpoint only provides a snapshot of thread activity at the</span></div>
<div style="position:absolute;left:102.18px;top:318.68px" class="cls_039"><span class="cls_039">time it was requested, it can be difficult to get a full picture of how threads are behav-</span></div>
<div style="position:absolute;left:102.18px;top:331.67px" class="cls_039"><span class="cls_039">ing over time. In chapter 17, you’ll see how Spring Boot Admin can monitor the</span></div>
<div style="position:absolute;left:102.18px;top:344.66px" class="cls_039"><span class="cls_039">/threaddump endpoint in a live view.</span></div>
<div style="position:absolute;left:66.18px;top:366.50px" class="cls_063"><span class="cls_063">16.2.4</span></div>
<div style="position:absolute;left:102.18px;top:366.50px" class="cls_063"><span class="cls_063">Tapping runtime metrics</span></div>
<div style="position:absolute;left:102.18px;top:383.66px" class="cls_039"><span class="cls_039">The /metrics endpoint is capable of reporting all manner of metrics produced by a</span></div>
<div style="position:absolute;left:102.18px;top:396.68px" class="cls_039"><span class="cls_039">running application, including metrics concerning memory, processor, garbage col-</span></div>
<div style="position:absolute;left:102.18px;top:409.67px" class="cls_039"><span class="cls_039">lection, and HTTP requests. There are over two dozen categories of metrics provided</span></div>
<div style="position:absolute;left:102.18px;top:422.66px" class="cls_039"><span class="cls_039">out of the box by Actuator, as evidenced by the list of metrics categories returned</span></div>
<div style="position:absolute;left:102.18px;top:435.68px" class="cls_039"><span class="cls_039">when issuing a GET request to /metrics:</span></div>
<div style="position:absolute;left:102.18px;top:455.36px" class="cls_060"><span class="cls_060">$ curl localhost:8081/actuator/metrics | jq</span></div>
<div style="position:absolute;left:102.18px;top:465.35px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:111.78px;top:475.34px" class="cls_060"><span class="cls_060">"names": [</span></div>
<div style="position:absolute;left:121.38px;top:485.36px" class="cls_060"><span class="cls_060">"jvm.memory.max",</span></div>
<div style="position:absolute;left:121.38px;top:495.35px" class="cls_060"><span class="cls_060">"process.files.max",</span></div>
<div style="position:absolute;left:121.38px;top:505.34px" class="cls_060"><span class="cls_060">"jvm.gc.memory.promoted",</span></div>
<div style="position:absolute;left:121.38px;top:515.36px" class="cls_060"><span class="cls_060">"http.server.requests",</span></div>
<div style="position:absolute;left:121.38px;top:525.35px" class="cls_060"><span class="cls_060">"system.load.average.1m",</span></div>
<div style="position:absolute;left:121.38px;top:535.34px" class="cls_060"><span class="cls_060">"jvm.memory.used",</span></div>
<div style="position:absolute;left:121.38px;top:545.36px" class="cls_060"><span class="cls_060">"jvm.gc.max.data.size",</span></div>
<div style="position:absolute;left:121.38px;top:555.35px" class="cls_060"><span class="cls_060">"jvm.memory.committed",</span></div>
<div style="position:absolute;left:121.38px;top:565.34px" class="cls_060"><span class="cls_060">"system.cpu.count",</span></div>
<div style="position:absolute;left:121.38px;top:575.36px" class="cls_060"><span class="cls_060">"logback.events",</span></div>
<div style="position:absolute;left:121.38px;top:585.35px" class="cls_060"><span class="cls_060">"jvm.buffer.memory.used",</span></div>
<div style="position:absolute;left:121.38px;top:595.34px" class="cls_060"><span class="cls_060">"jvm.threads.daemon",</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:287972px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background436.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">414</span></div>
<div style="position:absolute;left:173.61px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 16</span></div>
<div style="position:absolute;left:222.54px;top:24.35px" class="cls_055"><span class="cls_055">Working with Spring Boot Actuator</span></div>
<div style="position:absolute;left:112.38px;top:51.32px" class="cls_060"><span class="cls_060">"system.cpu.usage",</span></div>
<div style="position:absolute;left:112.38px;top:61.34px" class="cls_060"><span class="cls_060">"jvm.gc.memory.allocated",</span></div>
<div style="position:absolute;left:112.38px;top:71.33px" class="cls_060"><span class="cls_060">"jvm.threads.live",</span></div>
<div style="position:absolute;left:112.38px;top:81.32px" class="cls_060"><span class="cls_060">"jvm.threads.peak",</span></div>
<div style="position:absolute;left:112.38px;top:91.34px" class="cls_060"><span class="cls_060">"process.uptime",</span></div>
<div style="position:absolute;left:112.38px;top:101.33px" class="cls_060"><span class="cls_060">"process.cpu.usage",</span></div>
<div style="position:absolute;left:112.38px;top:111.32px" class="cls_060"><span class="cls_060">"jvm.classes.loaded",</span></div>
<div style="position:absolute;left:112.38px;top:121.34px" class="cls_060"><span class="cls_060">"jvm.gc.pause",</span></div>
<div style="position:absolute;left:112.38px;top:131.33px" class="cls_060"><span class="cls_060">"jvm.classes.unloaded",</span></div>
<div style="position:absolute;left:112.38px;top:141.35px" class="cls_060"><span class="cls_060">"jvm.gc.live.data.size",</span></div>
<div style="position:absolute;left:112.38px;top:151.34px" class="cls_060"><span class="cls_060">"process.files.open",</span></div>
<div style="position:absolute;left:112.38px;top:161.33px" class="cls_060"><span class="cls_060">"jvm.buffer.count",</span></div>
<div style="position:absolute;left:112.38px;top:171.35px" class="cls_060"><span class="cls_060">"jvm.buffer.total.capacity",</span></div>
<div style="position:absolute;left:112.38px;top:181.34px" class="cls_060"><span class="cls_060">"process.start.time"</span></div>
<div style="position:absolute;left:102.78px;top:191.33px" class="cls_060"><span class="cls_060">]</span></div>
<div style="position:absolute;left:93.18px;top:201.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:225.65px" class="cls_039"><span class="cls_039">There are so many metrics covered that it would be impossible to discuss them all in</span></div>
<div style="position:absolute;left:93.18px;top:238.67px" class="cls_039"><span class="cls_039">any meaningful way in this chapter. Instead, let’s focus on one category of metrics,</span></div>
<div style="position:absolute;left:93.18px;top:251.66px" class="cls_059"><span class="cls_059">http.server.requests</span><span class="cls_039">, as an example of how to consume the /metrics endpoint.</span></div>
<div style="position:absolute;left:109.11px;top:264.65px" class="cls_039"><span class="cls_039">If instead of simply requesting /metrics, you were to issue a GET request for</span></div>
<div style="position:absolute;left:93.18px;top:277.67px" class="cls_039"><span class="cls_039">/metrics/{METRICS CATEGORY}, you’d receive more detail about the metrics for that</span></div>
<div style="position:absolute;left:93.18px;top:290.66px" class="cls_039"><span class="cls_039">category. In the case of </span><span class="cls_059">http.server.requests</span><span class="cls_039">, a GET request for /metrics/ http.server</span></div>
<div style="position:absolute;left:93.18px;top:303.68px" class="cls_039"><span class="cls_039">.requests returns data that looks like the following:</span></div>
<div style="position:absolute;left:93.18px;top:325.34px" class="cls_060"><span class="cls_060">$ curl localhost:8081/actuator/metrics/http.server.requests</span></div>
<div style="position:absolute;left:93.18px;top:335.33px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:102.78px;top:345.35px" class="cls_060"><span class="cls_060">"name": "http.server.requests",</span></div>
<div style="position:absolute;left:102.78px;top:355.34px" class="cls_060"><span class="cls_060">"measurements": [</span></div>
<div style="position:absolute;left:112.37px;top:365.33px" class="cls_060"><span class="cls_060">{ "statistic": "COUNT", "value": 2103 },</span></div>
<div style="position:absolute;left:112.37px;top:375.35px" class="cls_060"><span class="cls_060">{ "statistic": "TOTAL_TIME", "value": 18.086334315 },</span></div>
<div style="position:absolute;left:112.38px;top:385.34px" class="cls_060"><span class="cls_060">{ "statistic": "MAX", "value": 0.028926313 }</span></div>
<div style="position:absolute;left:102.78px;top:395.36px" class="cls_060"><span class="cls_060">],</span></div>
<div style="position:absolute;left:102.78px;top:405.35px" class="cls_060"><span class="cls_060">"availableTags": [</span></div>
<div style="position:absolute;left:112.38px;top:415.34px" class="cls_060"><span class="cls_060">{ "tag": "exception",</span></div>
<div style="position:absolute;left:121.96px;top:425.36px" class="cls_060"><span class="cls_060">"values": [ "ResponseStatusException",</span></div>
<div style="position:absolute;left:179.53px;top:435.35px" class="cls_060"><span class="cls_060">"IllegalArgumentException", "none" ] },</span></div>
<div style="position:absolute;left:112.38px;top:445.34px" class="cls_060"><span class="cls_060">{ "tag": "method", "values": [ "GET" ] },</span></div>
<div style="position:absolute;left:112.38px;top:455.36px" class="cls_060"><span class="cls_060">{ "tag": "uri",</span></div>
<div style="position:absolute;left:121.95px;top:465.35px" class="cls_060"><span class="cls_060">"values": [</span></div>
<div style="position:absolute;left:131.56px;top:475.34px" class="cls_060"><span class="cls_060">"/actuator/metrics/{requiredMetricName}",</span></div>
<div style="position:absolute;left:131.57px;top:485.36px" class="cls_060"><span class="cls_060">"/actuator/health", "/actuator/info", "/ingredients",</span></div>
<div style="position:absolute;left:131.57px;top:495.35px" class="cls_060"><span class="cls_060">"/actuator/metrics", "/**" ] },</span></div>
<div style="position:absolute;left:112.38px;top:505.34px" class="cls_060"><span class="cls_060">{ "tag": "status", "values": [ "404", "500", "200" ] }</span></div>
<div style="position:absolute;left:102.78px;top:515.36px" class="cls_060"><span class="cls_060">]</span></div>
<div style="position:absolute;left:93.18px;top:525.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:549.68px" class="cls_039"><span class="cls_039">The most significant portion of this response is the </span><span class="cls_059">measurements</span><span class="cls_039"> section, which</span></div>
<div style="position:absolute;left:93.18px;top:562.67px" class="cls_039"><span class="cls_039">includes all the metrics for the requested category. In this case, it reports that there have</span></div>
<div style="position:absolute;left:93.18px;top:575.69px" class="cls_039"><span class="cls_039">been 2,103 HTTP requests. The total time spent handling those requests is 18.086334315</span></div>
<div style="position:absolute;left:93.18px;top:588.68px" class="cls_039"><span class="cls_039">seconds, and the maximum time spent processing any request is 0.028926313 seconds.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:288648px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background437.jpg" width="531" height="666"></div>
<div style="position:absolute;left:215.43px;top:24.35px" class="cls_055"><span class="cls_055">Consuming Actuator endpoints</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">415</span></div>
<div style="position:absolute;left:116.65px;top:50.66px" class="cls_039"><span class="cls_039">Those generic metrics are interesting, but you can narrow down the results further</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">by using the tags listed under </span><span class="cls_059">availableTags</span><span class="cls_039">. For example, you know that there have</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">been 2,103 requests, but what’s unknown is how many of them resulted in an HTTP</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">200 versus an HTTP 404 or HTTP 500 response status. Using the </span><span class="cls_059">status</span><span class="cls_039"> tag, you can</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">get metrics for all requests resulting in an HTTP 404 status like this:</span></div>
<div style="position:absolute;left:102.18px;top:125.33px" class="cls_060"><span class="cls_060">$ curl localhost:8081/actuator/metrics/http.server.requests? \</span></div>
<div style="position:absolute;left:289.31px;top:135.35px" class="cls_060"><span class="cls_060">tag=status:404</span></div>
<div style="position:absolute;left:102.18px;top:145.34px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:111.78px;top:155.33px" class="cls_060"><span class="cls_060">"name": "http.server.requests",</span></div>
<div style="position:absolute;left:111.76px;top:165.35px" class="cls_060"><span class="cls_060">"measurements": [</span></div>
<div style="position:absolute;left:121.38px;top:175.34px" class="cls_060"><span class="cls_060">{ "statistic": "COUNT", "value": 31 },</span></div>
<div style="position:absolute;left:121.35px;top:185.33px" class="cls_060"><span class="cls_060">{ "statistic": "TOTAL_TIME", "value": 0.522061212 },</span></div>
<div style="position:absolute;left:121.38px;top:195.35px" class="cls_060"><span class="cls_060">{ "statistic": "MAX", "value": 0 }</span></div>
<div style="position:absolute;left:111.78px;top:205.34px" class="cls_060"><span class="cls_060">],</span></div>
<div style="position:absolute;left:111.78px;top:215.33px" class="cls_060"><span class="cls_060">"availableTags": [</span></div>
<div style="position:absolute;left:121.38px;top:225.35px" class="cls_060"><span class="cls_060">{ "tag": "exception",</span></div>
<div style="position:absolute;left:130.93px;top:235.34px" class="cls_060"><span class="cls_060">"values": [ "ResponseStatusException", "none" ] },</span></div>
<div style="position:absolute;left:121.38px;top:245.33px" class="cls_060"><span class="cls_060">{ "tag": "method", "values": [ "GET" ] },</span></div>
<div style="position:absolute;left:121.38px;top:255.35px" class="cls_060"><span class="cls_060">{ "tag": "uri",</span></div>
<div style="position:absolute;left:130.95px;top:265.34px" class="cls_060"><span class="cls_060">"values": [</span></div>
<div style="position:absolute;left:140.57px;top:275.33px" class="cls_060"><span class="cls_060">"/actuator/metrics/{requiredMetricName}", "/**" ] }</span></div>
<div style="position:absolute;left:111.78px;top:285.35px" class="cls_060"><span class="cls_060">]</span></div>
<div style="position:absolute;left:102.18px;top:295.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:319.67px" class="cls_039"><span class="cls_039">By specifying the tag name and value with the </span><span class="cls_059">tag</span><span class="cls_039"> request attribute, you now see met-</span></div>
<div style="position:absolute;left:102.18px;top:332.66px" class="cls_039"><span class="cls_039">rics specifically for requests that resulted in an HTTP 404 response. This shows that</span></div>
<div style="position:absolute;left:102.18px;top:345.68px" class="cls_039"><span class="cls_039">there were 31 requests resulting in a 404, and it took 0.522061212 seconds to serve</span></div>
<div style="position:absolute;left:102.18px;top:358.67px" class="cls_039"><span class="cls_039">them all. Moreover, it’s clear that some of the failing requests were GET requests for</span></div>
<div style="position:absolute;left:102.18px;top:371.66px" class="cls_039"><span class="cls_039">/actuator/metrics/{requiredMetricsName} (although it’s unclear what the {required-</span></div>
<div style="position:absolute;left:102.18px;top:384.68px" class="cls_039"><span class="cls_039">MetricsName} path variable resolved to). And some were for some other path, cap-</span></div>
<div style="position:absolute;left:102.18px;top:397.67px" class="cls_039"><span class="cls_039">tured by the </span><span class="cls_059">/**</span><span class="cls_039"> wildcard path.</span></div>
<div style="position:absolute;left:116.82px;top:410.66px" class="cls_039"><span class="cls_039">Hmmm ... What if you want to know how many of those HTTP 404 responses were</span></div>
<div style="position:absolute;left:102.18px;top:423.68px" class="cls_039"><span class="cls_039">for the /** path? All you need to do to filter this further is to specify the </span><span class="cls_059">uri</span><span class="cls_039"> tag in the</span></div>
<div style="position:absolute;left:102.18px;top:436.67px" class="cls_039"><span class="cls_039">request, like this:</span></div>
<div style="position:absolute;left:102.18px;top:458.36px" class="cls_060"><span class="cls_060">% curl "localhost:8081/actuator/metrics/http.server.requests? \</span></div>
<div style="position:absolute;left:274.89px;top:468.35px" class="cls_060"><span class="cls_060">tag=status:404&amp;tag=uri:/**"</span></div>
<div style="position:absolute;left:102.18px;top:478.34px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:111.78px;top:488.36px" class="cls_060"><span class="cls_060">"name": "http.server.requests",</span></div>
<div style="position:absolute;left:111.76px;top:498.35px" class="cls_060"><span class="cls_060">"measurements": [</span></div>
<div style="position:absolute;left:121.38px;top:508.34px" class="cls_060"><span class="cls_060">{ "statistic": "COUNT", "value": 30 },</span></div>
<div style="position:absolute;left:121.35px;top:518.36px" class="cls_060"><span class="cls_060">{ "statistic": "TOTAL_TIME", "value": 0.519791548 },</span></div>
<div style="position:absolute;left:121.38px;top:528.35px" class="cls_060"><span class="cls_060">{ "statistic": "MAX", "value": 0 }</span></div>
<div style="position:absolute;left:111.78px;top:538.34px" class="cls_060"><span class="cls_060">],</span></div>
<div style="position:absolute;left:111.78px;top:548.36px" class="cls_060"><span class="cls_060">"availableTags": [</span></div>
<div style="position:absolute;left:121.38px;top:558.35px" class="cls_060"><span class="cls_060">{ "tag": "exception", "values": [ "ResponseStatusException" ] },</span></div>
<div style="position:absolute;left:121.38px;top:568.34px" class="cls_060"><span class="cls_060">{ "tag": "method", "values": [ "GET" ] }</span></div>
<div style="position:absolute;left:111.78px;top:578.36px" class="cls_060"><span class="cls_060">]</span></div>
<div style="position:absolute;left:102.18px;top:588.35px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:289324px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background438.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">416</span></div>
<div style="position:absolute;left:173.61px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 16</span></div>
<div style="position:absolute;left:222.54px;top:24.35px" class="cls_055"><span class="cls_055">Working with Spring Boot Actuator</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">Now you can see that there were 30 requests for some path that matched /** that</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">resulted in an HTTP 404 response, and it took a total of 0.519791548 seconds to han-</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">dle those requests.</span></div>
<div style="position:absolute;left:107.55px;top:89.66px" class="cls_039"><span class="cls_039">You’ll also notice that as you refine the request, the available tags are more limited.</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">The tags offered are only those that match the requests captured by the displayed met-</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">rics. In this case, the </span><span class="cls_059">exception</span><span class="cls_039"> and </span><span class="cls_059">method</span><span class="cls_039"> tags each only have a single value; it’s</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">obvious that all 30 of the requests were GET requests that resulted in a 404 because of</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_039"><span class="cls_039">a </span><span class="cls_059">ResponseStatusException</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:107.55px;top:154.67px" class="cls_039"><span class="cls_039">Navigating the /metrics endpoint can be a tricky business, but with a little practice,</span></div>
<div style="position:absolute;left:93.18px;top:167.66px" class="cls_039"><span class="cls_039">it’s not impossible to get the data you’re looking for. In chapter 17, you’ll see how</span></div>
<div style="position:absolute;left:93.18px;top:180.65px" class="cls_039"><span class="cls_039">Spring Boot Admin makes consuming data from the /metrics endpoint much easier.</span></div>
<div style="position:absolute;left:108.87px;top:193.67px" class="cls_039"><span class="cls_039">Although the information presented by Actuator endpoints offers useful insight</span></div>
<div style="position:absolute;left:93.18px;top:206.66px" class="cls_039"><span class="cls_039">into the inner workings of a running Spring Boot application, they’re not well suited</span></div>
<div style="position:absolute;left:93.18px;top:219.65px" class="cls_039"><span class="cls_039">for human consumption. As REST endpoints, they’re intended for consumption by</span></div>
<div style="position:absolute;left:93.18px;top:232.67px" class="cls_039"><span class="cls_039">some other application, perhaps a UI. With that in mind, let’s see how you can present</span></div>
<div style="position:absolute;left:93.18px;top:245.66px" class="cls_039"><span class="cls_039">Actuator information in a user-friendly web application.</span></div>
<div style="position:absolute;left:57.18px;top:270.82px" class="cls_040"><span class="cls_040">16.3</span></div>
<div style="position:absolute;left:93.18px;top:270.82px" class="cls_040"><span class="cls_040">Customizing Actuator</span></div>
<div style="position:absolute;left:93.18px;top:290.18px" class="cls_039"><span class="cls_039">One of the greatest features of Actuator is that it can be customized to meet the spe-</span></div>
<div style="position:absolute;left:93.18px;top:303.17px" class="cls_039"><span class="cls_039">cific needs of an application. A few of the endpoints themselves allow for customiza-</span></div>
<div style="position:absolute;left:93.18px;top:316.16px" class="cls_039"><span class="cls_039">tion. Meanwhile, Actuator itself allows you to create custom endpoints.</span></div>
<div style="position:absolute;left:108.01px;top:329.18px" class="cls_039"><span class="cls_039">Let’s look at a few ways that Actuator can be customized, starting with ways to add</span></div>
<div style="position:absolute;left:93.18px;top:342.17px" class="cls_039"><span class="cls_039">information to the /info endpoint.</span></div>
<div style="position:absolute;left:57.18px;top:368.00px" class="cls_063"><span class="cls_063">16.3.1</span></div>
<div style="position:absolute;left:93.18px;top:368.00px" class="cls_063"><span class="cls_063">Contributing information to the /info endpoint</span></div>
<div style="position:absolute;left:93.18px;top:385.67px" class="cls_039"><span class="cls_039">As you saw in section 16.2.1, the /info endpoint starts off empty and uninformative.</span></div>
<div style="position:absolute;left:93.18px;top:398.66px" class="cls_039"><span class="cls_039">But you can easily add data to it by creating properties that are prefixed with </span><span class="cls_059">info.</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:107.69px;top:411.68px" class="cls_039"><span class="cls_039">While prefixing properties with </span><span class="cls_059">info.</span><span class="cls_039"> is a very easy way to get custom data into the</span></div>
<div style="position:absolute;left:93.18px;top:424.67px" class="cls_039"><span class="cls_039">/info endpoint, it’s not the only way. Spring Boot offers an interface named </span><span class="cls_059">Info-</span></div>
<div style="position:absolute;left:93.18px;top:437.66px" class="cls_059"><span class="cls_059">Contributor</span><span class="cls_039"> that allows you to programmatically add any information you want to the</span></div>
<div style="position:absolute;left:93.18px;top:450.68px" class="cls_039"><span class="cls_039">/info endpoint response. Spring Boot even comes ready with a couple of useful imple-</span></div>
<div style="position:absolute;left:93.18px;top:463.67px" class="cls_039"><span class="cls_039">mentations of </span><span class="cls_059">InfoContributor</span><span class="cls_039"> that you’ll no doubt find useful.</span></div>
<div style="position:absolute;left:107.51px;top:476.66px" class="cls_039"><span class="cls_039">Let’s see how you can write your own </span><span class="cls_059">InfoContributor</span><span class="cls_039"> to add some custom info to</span></div>
<div style="position:absolute;left:93.18px;top:489.68px" class="cls_039"><span class="cls_039">the /info endpoint.</span></div>
<div style="position:absolute;left:93.18px;top:509.84px" class="cls_064"><span class="cls_064">C</span><span class="cls_065">REATING</span><span class="cls_064"> </span><span class="cls_065">A</span><span class="cls_064"> </span><span class="cls_065">CUSTOM</span><span class="cls_064"> </span><span class="cls_065">INFO</span><span class="cls_064"> </span><span class="cls_065">CONTRIBUTOR</span></div>
<div style="position:absolute;left:93.18px;top:523.16px" class="cls_039"><span class="cls_039">Suppose you want to add some simple statistics regarding Taco Cloud to the /info</span></div>
<div style="position:absolute;left:93.18px;top:536.18px" class="cls_039"><span class="cls_039">endpoint. For example, let’s say you want to include information about how many</span></div>
<div style="position:absolute;left:93.18px;top:549.17px" class="cls_039"><span class="cls_039">tacos have been created. To do that, you can write a class that implements </span><span class="cls_059">Info-</span></div>
<div style="position:absolute;left:93.18px;top:562.19px" class="cls_059"><span class="cls_059">Contributor</span><span class="cls_039">, inject it with </span><span class="cls_059">TacoRepository</span><span class="cls_039">, and then publish whatever count that</span></div>
<div style="position:absolute;left:93.18px;top:575.18px" class="cls_059"><span class="cls_059">TacoRepository</span><span class="cls_039"> gives you as information to the /info endpoint. The next listing</span></div>
<div style="position:absolute;left:93.18px;top:588.17px" class="cls_039"><span class="cls_039">shows how you might implement such a contributor.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:290000px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background439.jpg" width="531" height="666"></div>
<div style="position:absolute;left:231.81px;top:24.35px" class="cls_055"><span class="cls_055">Customizing Actuator</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">417</span></div>
<div style="position:absolute;left:114.18px;top:54.65px" class="cls_066"><span class="cls_066">Listing 16.3</span></div>
<div style="position:absolute;left:171.68px;top:54.26px" class="cls_066"><span class="cls_066">A custom implementation of </span><span class="cls_077">InfoContributor</span></div>
<div style="position:absolute;left:102.18px;top:71.63px" class="cls_060"><span class="cls_060">package tacos.tacos;</span></div>
<div style="position:absolute;left:102.18px;top:81.62px" class="cls_060"><span class="cls_060">import org.springframework.boot.actuate.info.InfoContributor;</span></div>
<div style="position:absolute;left:102.18px;top:91.64px" class="cls_060"><span class="cls_060">import org.springframework.stereotype.Component;</span></div>
<div style="position:absolute;left:102.18px;top:101.63px" class="cls_060"><span class="cls_060">import java.util.HashMap;</span></div>
<div style="position:absolute;left:102.18px;top:111.62px" class="cls_060"><span class="cls_060">import java.util.Map;</span></div>
<div style="position:absolute;left:102.18px;top:121.64px" class="cls_060"><span class="cls_060">import org.springframework.boot.actuate.info.Info.Builder;</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_060"><span class="cls_060">@Component</span></div>
<div style="position:absolute;left:102.18px;top:151.64px" class="cls_060"><span class="cls_060">public class TacoCountInfoContributor implements InfoContributor {</span></div>
<div style="position:absolute;left:111.78px;top:161.63px" class="cls_060"><span class="cls_060">private TacoRepository tacoRepo;</span></div>
<div style="position:absolute;left:111.78px;top:181.64px" class="cls_060"><span class="cls_060">public TacoCountInfoContributor(TacoRepository tacoRepo) {</span></div>
<div style="position:absolute;left:121.36px;top:191.63px" class="cls_060"><span class="cls_060">this.tacoRepo = tacoRepo;</span></div>
<div style="position:absolute;left:111.78px;top:201.65px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:221.63px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:111.77px;top:231.65px" class="cls_060"><span class="cls_060">public void contribute(Builder builder) {</span></div>
<div style="position:absolute;left:121.38px;top:241.64px" class="cls_060"><span class="cls_060">long tacoCount = tacoRepo.count();</span></div>
<div style="position:absolute;left:121.37px;top:251.63px" class="cls_060"><span class="cls_060">Map&lt;String, Object&gt; tacoMap = new HashMap&lt;String, Object&gt;();</span></div>
<div style="position:absolute;left:121.38px;top:261.65px" class="cls_060"><span class="cls_060">tacoMap.put("count", tacoCount);</span></div>
<div style="position:absolute;left:121.38px;top:271.64px" class="cls_060"><span class="cls_060">builder.withDetail("taco-stats", tacoMap);</span></div>
<div style="position:absolute;left:111.78px;top:281.63px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:291.65px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:315.98px" class="cls_039"><span class="cls_039">By implementing </span><span class="cls_059">InfoContributor</span><span class="cls_039">, </span><span class="cls_059">TacoCountInfoContributor</span><span class="cls_039"> is required to imple-</span></div>
<div style="position:absolute;left:102.18px;top:328.97px" class="cls_039"><span class="cls_039">ment the </span><span class="cls_059">contribute()</span><span class="cls_039"> method. This method is given a </span><span class="cls_059">Builder</span><span class="cls_039"> object on which the</span></div>
<div style="position:absolute;left:102.18px;top:341.96px" class="cls_059"><span class="cls_059">contribute()</span><span class="cls_039"> method makes a call to </span><span class="cls_059">withDetail()</span><span class="cls_039"> to add info details. In your</span></div>
<div style="position:absolute;left:102.18px;top:354.98px" class="cls_039"><span class="cls_039">implementation, you consult </span><span class="cls_059">TacoRepository</span><span class="cls_039"> by calling its </span><span class="cls_059">count()</span><span class="cls_039"> method to find</span></div>
<div style="position:absolute;left:102.18px;top:367.97px" class="cls_039"><span class="cls_039">out how many tacos have been created. Then you put that count into a </span><span class="cls_059">Map</span><span class="cls_039">, which you</span></div>
<div style="position:absolute;left:102.18px;top:380.96px" class="cls_039"><span class="cls_039">then give to the builder with the label </span><span class="cls_059">taco-stats</span><span class="cls_039">. The results of the /info endpoint</span></div>
<div style="position:absolute;left:102.18px;top:393.98px" class="cls_039"><span class="cls_039">will include that count, as shown here:</span></div>
<div style="position:absolute;left:102.18px;top:415.64px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:111.78px;top:425.66px" class="cls_060"><span class="cls_060">"taco-stats": {</span></div>
<div style="position:absolute;left:121.38px;top:435.65px" class="cls_060"><span class="cls_060">"count": 44</span></div>
<div style="position:absolute;left:111.78px;top:445.64px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:455.66px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:479.96px" class="cls_039"><span class="cls_039">As you can see, an implementation of </span><span class="cls_059">InfoContributor</span><span class="cls_039"> is able to use whatever means</span></div>
<div style="position:absolute;left:102.18px;top:492.98px" class="cls_039"><span class="cls_039">necessary to contribute information. This is in contrast to simply prefixing a property</span></div>
<div style="position:absolute;left:102.18px;top:505.97px" class="cls_039"><span class="cls_039">with </span><span class="cls_059">info.</span><span class="cls_039">, which, while simple, is limited to static values.</span></div>
<div style="position:absolute;left:102.18px;top:526.16px" class="cls_064"><span class="cls_064">I</span><span class="cls_065">NJECTING</span><span class="cls_064"> </span><span class="cls_065">BUILD</span><span class="cls_064"> </span><span class="cls_065">INFORMATION</span><span class="cls_064"> </span><span class="cls_065">INTO</span><span class="cls_064"> </span><span class="cls_065">THE</span><span class="cls_064"> /</span><span class="cls_065">INFO</span><span class="cls_064"> </span><span class="cls_065">ENDPOINT</span></div>
<div style="position:absolute;left:102.18px;top:539.48px" class="cls_039"><span class="cls_039">Spring Boot comes with a few built-in implementations of </span><span class="cls_059">InfoContributor</span><span class="cls_039"> that auto-</span></div>
<div style="position:absolute;left:102.18px;top:552.47px" class="cls_039"><span class="cls_039">matically add information to the results of the /info endpoint. Among them is </span><span class="cls_059">Build-</span></div>
<div style="position:absolute;left:102.18px;top:565.49px" class="cls_059"><span class="cls_059">InfoContributor</span><span class="cls_039">, which adds information from the project build file into the /info</span></div>
<div style="position:absolute;left:102.18px;top:578.48px" class="cls_039"><span class="cls_039">endpoint results. This includes basic information such as the project version, the time-</span></div>
<div style="position:absolute;left:102.18px;top:591.47px" class="cls_039"><span class="cls_039">stamp of the build, and the host and user who performed the build.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:290676px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background440.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">418</span></div>
<div style="position:absolute;left:173.61px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 16</span></div>
<div style="position:absolute;left:222.54px;top:24.35px" class="cls_055"><span class="cls_055">Working with Spring Boot Actuator</span></div>
<div style="position:absolute;left:108.41px;top:50.66px" class="cls_039"><span class="cls_039">To enable build information to be included in the results of the /info endpoint,</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">add the </span><span class="cls_059">build-info</span><span class="cls_039"> goal to the Spring Boot Maven Plugin executions, as follows:</span></div>
<div style="position:absolute;left:93.18px;top:86.33px" class="cls_060"><span class="cls_060">&lt;build&gt;</span></div>
<div style="position:absolute;left:102.78px;top:96.32px" class="cls_060"><span class="cls_060">&lt;plugins&gt;</span></div>
<div style="position:absolute;left:112.38px;top:106.34px" class="cls_060"><span class="cls_060">&lt;plugin&gt;</span></div>
<div style="position:absolute;left:121.95px;top:116.33px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:121.95px;top:126.35px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:121.95px;top:136.34px" class="cls_060"><span class="cls_060">&lt;executions&gt;</span></div>
<div style="position:absolute;left:131.55px;top:146.33px" class="cls_060"><span class="cls_060">&lt;execution&gt;</span></div>
<div style="position:absolute;left:141.15px;top:156.35px" class="cls_060"><span class="cls_060">&lt;goals&gt;</span></div>
<div style="position:absolute;left:150.76px;top:166.34px" class="cls_060"><span class="cls_060">&lt;goal&gt;build-info&lt;/goal&gt;</span></div>
<div style="position:absolute;left:141.15px;top:176.33px" class="cls_060"><span class="cls_060">&lt;/goals&gt;</span></div>
<div style="position:absolute;left:131.55px;top:186.35px" class="cls_060"><span class="cls_060">&lt;/execution&gt;</span></div>
<div style="position:absolute;left:121.95px;top:196.34px" class="cls_060"><span class="cls_060">&lt;/executions&gt;</span></div>
<div style="position:absolute;left:112.38px;top:206.33px" class="cls_060"><span class="cls_060">&lt;/plugin&gt;</span></div>
<div style="position:absolute;left:102.78px;top:216.35px" class="cls_060"><span class="cls_060">&lt;/plugins&gt;</span></div>
<div style="position:absolute;left:93.18px;top:226.34px" class="cls_061"><span class="cls_061">&lt;/build&gt;</span></div>
<div style="position:absolute;left:93.18px;top:250.67px" class="cls_039"><span class="cls_039">If you’re using Gradle to build your project, you can simply add the following lines to</span></div>
<div style="position:absolute;left:93.18px;top:263.66px" class="cls_039"><span class="cls_039">your build.gradle file:</span></div>
<div style="position:absolute;left:93.18px;top:286.34px" class="cls_060"><span class="cls_060">springBoot {</span></div>
<div style="position:absolute;left:102.78px;top:296.33px" class="cls_060"><span class="cls_060">buildInfo()</span></div>
<div style="position:absolute;left:93.18px;top:306.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:330.68px" class="cls_039"><span class="cls_039">In either event, the build will produce a file named build-info.properties in the dis-</span></div>
<div style="position:absolute;left:93.18px;top:343.67px" class="cls_039"><span class="cls_039">tributable JAR or WAR file that </span><span class="cls_059">BuildInfoContributor</span><span class="cls_039"> will consume and contribute</span></div>
<div style="position:absolute;left:93.18px;top:356.66px" class="cls_039"><span class="cls_039">to the /info endpoint. The following snippet from the /info endpoint response shows</span></div>
<div style="position:absolute;left:93.18px;top:369.68px" class="cls_039"><span class="cls_039">the build information that’s contributed:</span></div>
<div style="position:absolute;left:93.18px;top:392.36px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:102.78px;top:402.35px" class="cls_060"><span class="cls_060">"build": {</span></div>
<div style="position:absolute;left:112.38px;top:412.34px" class="cls_060"><span class="cls_060">"version": "0.0.16-SNAPSHOT",</span></div>
<div style="position:absolute;left:112.38px;top:422.36px" class="cls_060"><span class="cls_060">"artifact": "ingredient-service",</span></div>
<div style="position:absolute;left:112.38px;top:432.35px" class="cls_060"><span class="cls_060">"name": "ingredient-service",</span></div>
<div style="position:absolute;left:112.38px;top:442.34px" class="cls_060"><span class="cls_060">"group": "sia5",</span></div>
<div style="position:absolute;left:112.38px;top:452.36px" class="cls_060"><span class="cls_060">"time": "2018-06-04T00:24:04.373Z"</span></div>
<div style="position:absolute;left:102.78px;top:462.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:472.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:496.67px" class="cls_039"><span class="cls_039">This information is useful for understanding exactly which version of an application is</span></div>
<div style="position:absolute;left:93.18px;top:509.66px" class="cls_039"><span class="cls_039">running and when it was built. By performing a GET request to the /info endpoint,</span></div>
<div style="position:absolute;left:93.18px;top:522.68px" class="cls_039"><span class="cls_039">you’ll know whether or not you’re running the latest and greatest build of the project.</span></div>
<div style="position:absolute;left:93.18px;top:542.84px" class="cls_064"><span class="cls_064">E</span><span class="cls_065">XPOSING</span><span class="cls_064"> G</span><span class="cls_065">IT</span><span class="cls_064"> </span><span class="cls_065">COMMIT</span><span class="cls_064"> </span><span class="cls_065">INFORMATION</span></div>
<div style="position:absolute;left:93.18px;top:556.19px" class="cls_039"><span class="cls_039">Assuming that your project is kept in Git for source code control, you may want to</span></div>
<div style="position:absolute;left:93.18px;top:569.18px" class="cls_039"><span class="cls_039">include Git commit information in the /info endpoint. To do that, you’ll need to add</span></div>
<div style="position:absolute;left:93.18px;top:582.17px" class="cls_039"><span class="cls_039">the following plugin in the Maven project pom.xml:</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:291352px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background441.jpg" width="531" height="666"></div>
<div style="position:absolute;left:231.81px;top:24.35px" class="cls_055"><span class="cls_055">Customizing Actuator</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">419</span></div>
<div style="position:absolute;left:102.18px;top:51.32px" class="cls_060"><span class="cls_060">&lt;build&gt;</span></div>
<div style="position:absolute;left:111.78px;top:61.34px" class="cls_060"><span class="cls_060">&lt;plugins&gt;</span></div>
<div style="position:absolute;left:121.38px;top:81.32px" class="cls_060"><span class="cls_060">&lt;plugin&gt;</span></div>
<div style="position:absolute;left:130.95px;top:91.34px" class="cls_060"><span class="cls_060">&lt;groupId&gt;pl.project13.maven&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:130.95px;top:101.33px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;git-commit-id-plugin&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:121.38px;top:111.32px" class="cls_060"><span class="cls_060">&lt;/plugin&gt;</span></div>
<div style="position:absolute;left:111.78px;top:121.34px" class="cls_060"><span class="cls_060">&lt;/plugins&gt;</span></div>
<div style="position:absolute;left:102.18px;top:131.33px" class="cls_061"><span class="cls_061">&lt;/build&gt;</span></div>
<div style="position:absolute;left:102.18px;top:152.66px" class="cls_039"><span class="cls_039">If you’re a Gradle user, don’t worry. There’s an equivalent plugin for you to add to</span></div>
<div style="position:absolute;left:102.18px;top:165.65px" class="cls_039"><span class="cls_039">your build.gradle file:</span></div>
<div style="position:absolute;left:102.18px;top:185.33px" class="cls_060"><span class="cls_060">plugins {</span></div>
<div style="position:absolute;left:111.77px;top:195.35px" class="cls_060"><span class="cls_060">id "com.gorylenko.gradle-git-properties" version "1.4.17"</span></div>
<div style="position:absolute;left:102.18px;top:205.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:226.67px" class="cls_039"><span class="cls_039">Both of these plugins do essentially the same thing: they generate a build-time artifact</span></div>
<div style="position:absolute;left:102.18px;top:239.66px" class="cls_039"><span class="cls_039">named git.properties that contains all of the Git metadata for the project. A special</span></div>
<div style="position:absolute;left:102.18px;top:252.65px" class="cls_059"><span class="cls_059">InfoContributor</span><span class="cls_039"> implementation discovers that file at runtime and exposes its con-</span></div>
<div style="position:absolute;left:102.18px;top:265.67px" class="cls_039"><span class="cls_039">tents as part of the /info endpoint.</span></div>
<div style="position:absolute;left:116.88px;top:278.66px" class="cls_039"><span class="cls_039">In its simplest form, the Git information presented in the /info endpoint includes</span></div>
<div style="position:absolute;left:102.18px;top:291.65px" class="cls_039"><span class="cls_039">the Git branch, commit hash, and timestamp that the application was built against:</span></div>
<div style="position:absolute;left:102.18px;top:310.34px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:111.78px;top:320.33px" class="cls_060"><span class="cls_060">"git": {</span></div>
<div style="position:absolute;left:121.38px;top:330.35px" class="cls_060"><span class="cls_060">"commit": {</span></div>
<div style="position:absolute;left:130.95px;top:340.34px" class="cls_060"><span class="cls_060">"time": "2018-06-02T18:10:58Z",</span></div>
<div style="position:absolute;left:130.95px;top:350.33px" class="cls_060"><span class="cls_060">"id": "b5c104d"</span></div>
<div style="position:absolute;left:121.38px;top:360.35px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:121.38px;top:370.34px" class="cls_060"><span class="cls_060">"branch": "master"</span></div>
<div style="position:absolute;left:111.78px;top:380.33px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:102.18px;top:400.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:420.68px" class="cls_039"><span class="cls_039">This information is quite definitive in describing the state of the code when the proj-</span></div>
<div style="position:absolute;left:102.18px;top:433.67px" class="cls_039"><span class="cls_039">ect was built. But by setting the </span><span class="cls_059">management.info.git.mode</span><span class="cls_039"> property to </span><span class="cls_059">full</span></div>
<div style="position:absolute;left:102.18px;top:453.35px" class="cls_060"><span class="cls_060">management:</span></div>
<div style="position:absolute;left:111.78px;top:463.34px" class="cls_060"><span class="cls_060">info:</span></div>
<div style="position:absolute;left:121.38px;top:473.36px" class="cls_060"><span class="cls_060">git:</span></div>
<div style="position:absolute;left:130.95px;top:483.35px" class="cls_061"><span class="cls_061">mode: full</span></div>
<div style="position:absolute;left:102.18px;top:504.68px" class="cls_039"><span class="cls_039">you can get extremely detailed information about the Git commit that was in play</span></div>
<div style="position:absolute;left:102.18px;top:517.67px" class="cls_039"><span class="cls_039">when the project was built. The following listing shows a sample of what the full Git</span></div>
<div style="position:absolute;left:102.18px;top:530.66px" class="cls_039"><span class="cls_039">info might look like.</span></div>
<div style="position:absolute;left:114.18px;top:554.39px" class="cls_066"><span class="cls_066">Listing 16.4</span></div>
<div style="position:absolute;left:171.68px;top:554.39px" class="cls_066"><span class="cls_066">Full Git commit info exposed through the /info endpoint</span></div>
<div style="position:absolute;left:102.18px;top:574.25px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:111.78px;top:584.24px" class="cls_060"><span class="cls_060">"git": {</span></div>
<div style="position:absolute;left:121.38px;top:594.26px" class="cls_060"><span class="cls_060">"build": {</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:292028px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background442.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">420</span></div>
<div style="position:absolute;left:173.61px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 16</span></div>
<div style="position:absolute;left:222.54px;top:24.35px" class="cls_055"><span class="cls_055">Working with Spring Boot Actuator</span></div>
<div style="position:absolute;left:121.95px;top:51.32px" class="cls_060"><span class="cls_060">"host": "DarkSide.local",</span></div>
<div style="position:absolute;left:121.93px;top:61.34px" class="cls_060"><span class="cls_060">"version": "0.0.16-SNAPSHOT",</span></div>
<div style="position:absolute;left:121.96px;top:71.33px" class="cls_060"><span class="cls_060">"time": "2018-06-02T18:11:23Z",</span></div>
<div style="position:absolute;left:121.96px;top:81.32px" class="cls_060"><span class="cls_060">"user": {</span></div>
<div style="position:absolute;left:131.56px;top:91.34px" class="cls_060"><span class="cls_060">"name": "Craig Walls",</span></div>
<div style="position:absolute;left:131.53px;top:101.33px" class="cls_060"><span class="cls_060">"email": "craig@habuma.com"</span></div>
<div style="position:absolute;left:121.95px;top:111.32px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:112.38px;top:121.34px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:112.38px;top:131.33px" class="cls_060"><span class="cls_060">"branch": "master",</span></div>
<div style="position:absolute;left:112.38px;top:141.35px" class="cls_060"><span class="cls_060">"commit": {</span></div>
<div style="position:absolute;left:121.93px;top:151.34px" class="cls_060"><span class="cls_060">"message": {</span></div>
<div style="position:absolute;left:131.54px;top:161.33px" class="cls_060"><span class="cls_060">"short": "Add Spring Boot Admin and Actuator",</span></div>
<div style="position:absolute;left:131.57px;top:171.35px" class="cls_060"><span class="cls_060">"full": "Add Spring Boot Admin and Actuator"</span></div>
<div style="position:absolute;left:121.95px;top:181.34px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:121.95px;top:191.33px" class="cls_060"><span class="cls_060">"id": {</span></div>
<div style="position:absolute;left:131.55px;top:201.35px" class="cls_060"><span class="cls_060">"describe": "b5c104d-dirty",</span></div>
<div style="position:absolute;left:131.55px;top:211.34px" class="cls_060"><span class="cls_060">"abbrev": "b5c104d",</span></div>
<div style="position:absolute;left:131.55px;top:221.33px" class="cls_060"><span class="cls_060">"describe-short": "b5c104d-dirty",</span></div>
<div style="position:absolute;left:131.55px;top:231.35px" class="cls_060"><span class="cls_060">"full": "b5c104d1fcbe6c2b84965ea08a330595100fd44e"</span></div>
<div style="position:absolute;left:121.95px;top:241.34px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:121.95px;top:251.33px" class="cls_060"><span class="cls_060">"time": "2018-06-02T18:10:58Z",</span></div>
<div style="position:absolute;left:121.95px;top:261.35px" class="cls_060"><span class="cls_060">"user": {</span></div>
<div style="position:absolute;left:131.52px;top:271.34px" class="cls_060"><span class="cls_060">"email": "craig@habuma.com",</span></div>
<div style="position:absolute;left:131.56px;top:281.33px" class="cls_060"><span class="cls_060">"name": "Craig Walls"</span></div>
<div style="position:absolute;left:121.95px;top:291.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:112.38px;top:301.34px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:112.38px;top:311.33px" class="cls_060"><span class="cls_060">"closest": {</span></div>
<div style="position:absolute;left:121.96px;top:321.35px" class="cls_060"><span class="cls_060">"tag": {</span></div>
<div style="position:absolute;left:131.55px;top:331.34px" class="cls_060"><span class="cls_060">"name": "",</span></div>
<div style="position:absolute;left:131.55px;top:341.33px" class="cls_060"><span class="cls_060">"commit": {</span></div>
<div style="position:absolute;left:141.15px;top:351.35px" class="cls_060"><span class="cls_060">"count": ""</span></div>
<div style="position:absolute;left:131.55px;top:361.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:121.95px;top:371.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:112.38px;top:381.35px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:112.38px;top:391.34px" class="cls_060"><span class="cls_060">"dirty": "true",</span></div>
<div style="position:absolute;left:112.38px;top:401.36px" class="cls_060"><span class="cls_060">"remote": {</span></div>
<div style="position:absolute;left:121.95px;top:411.35px" class="cls_060"><span class="cls_060">"origin": {</span></div>
<div style="position:absolute;left:131.55px;top:421.34px" class="cls_060"><span class="cls_060">"url": "Unknown"</span></div>
<div style="position:absolute;left:121.95px;top:431.36px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:112.38px;top:441.35px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:112.38px;top:451.34px" class="cls_060"><span class="cls_060">"tags": ""</span></div>
<div style="position:absolute;left:102.78px;top:461.36px" class="cls_060"><span class="cls_060">},</span></div>
<div style="position:absolute;left:93.18px;top:481.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:505.67px" class="cls_039"><span class="cls_039">In addition to the timestamp and abbreviated Git commit hash, the full version</span></div>
<div style="position:absolute;left:93.18px;top:518.66px" class="cls_039"><span class="cls_039">includes the name and email of the user who committed the code as well as the com-</span></div>
<div style="position:absolute;left:93.18px;top:531.68px" class="cls_039"><span class="cls_039">mit message and other information, allowing you to pinpoint exactly what code was</span></div>
<div style="position:absolute;left:93.18px;top:544.67px" class="cls_039"><span class="cls_039">used to build the project. In fact, notice that the </span><span class="cls_059">dirty</span><span class="cls_039"> field in listing 16.4 is </span><span class="cls_059">true</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:93.18px;top:557.66px" class="cls_039"><span class="cls_039">indicating that there were some uncommitted changes in the build directory when</span></div>
<div style="position:absolute;left:93.18px;top:570.68px" class="cls_039"><span class="cls_039">the project was built. It doesn’t get much more damning definitive than that!</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:292704px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background443.jpg" width="531" height="666"></div>
<div style="position:absolute;left:231.81px;top:24.35px" class="cls_055"><span class="cls_055">Customizing Actuator</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">421</span></div>
<div style="position:absolute;left:66.18px;top:50.48px" class="cls_063"><span class="cls_063">16.3.2</span></div>
<div style="position:absolute;left:102.18px;top:50.48px" class="cls_063"><span class="cls_063">Defining custom health indicators</span></div>
<div style="position:absolute;left:102.18px;top:67.67px" class="cls_039"><span class="cls_039">Spring Boot comes with several out-of-the-box health indicators that provide health</span></div>
<div style="position:absolute;left:102.18px;top:80.66px" class="cls_039"><span class="cls_039">information for many common external systems that a Spring application may inte-</span></div>
<div style="position:absolute;left:102.18px;top:93.65px" class="cls_039"><span class="cls_039">grate with. But at some point, you may find that you’re interacting with some external</span></div>
<div style="position:absolute;left:102.18px;top:106.67px" class="cls_039"><span class="cls_039">system that Spring Boot never anticipated, nor provided a health indicator for.</span></div>
<div style="position:absolute;left:117.09px;top:119.66px" class="cls_039"><span class="cls_039">For instance, your application may integrate with a legacy mainframe application,</span></div>
<div style="position:absolute;left:102.18px;top:132.65px" class="cls_039"><span class="cls_039">and the health of your application may be affected by the health of the legacy system.</span></div>
<div style="position:absolute;left:102.18px;top:145.67px" class="cls_039"><span class="cls_039">To create a custom health indicator, all you need to do is create a bean that imple-</span></div>
<div style="position:absolute;left:102.18px;top:158.66px" class="cls_039"><span class="cls_039">ments the </span><span class="cls_059">HealthIndicator</span><span class="cls_039"> interface.</span></div>
<div style="position:absolute;left:116.45px;top:171.65px" class="cls_039"><span class="cls_039">As it turns out, the Taco Cloud services have no need for a custom health indicator,</span></div>
<div style="position:absolute;left:102.18px;top:184.67px" class="cls_039"><span class="cls_039">as the ones provided by Spring Boot are more than sufficient. But to demonstrate how</span></div>
<div style="position:absolute;left:102.18px;top:197.66px" class="cls_039"><span class="cls_039">you can develop a custom health indicator, consider the next listing, which shows a</span></div>
<div style="position:absolute;left:102.18px;top:210.65px" class="cls_039"><span class="cls_039">simple implementation of </span><span class="cls_059">HealthIndicator</span><span class="cls_039"> in which health is determined somewhat</span></div>
<div style="position:absolute;left:102.18px;top:223.67px" class="cls_039"><span class="cls_039">randomly by the time of day.</span></div>
<div style="position:absolute;left:114.18px;top:245.66px" class="cls_066"><span class="cls_066">Listing 16.5</span></div>
<div style="position:absolute;left:171.67px;top:245.27px" class="cls_066"><span class="cls_066">An unusual implementation of </span><span class="cls_077">HealthIndicator</span></div>
<div style="position:absolute;left:102.18px;top:265.64px" class="cls_060"><span class="cls_060">package tacos.tacos;</span></div>
<div style="position:absolute;left:102.18px;top:275.63px" class="cls_060"><span class="cls_060">import java.util.Calendar;</span></div>
<div style="position:absolute;left:102.18px;top:285.65px" class="cls_060"><span class="cls_060">import org.springframework.boot.actuate.health.Health;</span></div>
<div style="position:absolute;left:102.18px;top:295.64px" class="cls_060"><span class="cls_060">import org.springframework.boot.actuate.health.HealthIndicator;</span></div>
<div style="position:absolute;left:102.18px;top:305.63px" class="cls_060"><span class="cls_060">import org.springframework.stereotype.Component;</span></div>
<div style="position:absolute;left:102.18px;top:323.63px" class="cls_060"><span class="cls_060">@Component</span></div>
<div style="position:absolute;left:102.18px;top:333.65px" class="cls_060"><span class="cls_060">public class WackoHealthIndicator</span></div>
<div style="position:absolute;left:135.73px;top:343.64px" class="cls_060"><span class="cls_060">implements HealthIndicator {</span></div>
<div style="position:absolute;left:111.78px;top:353.63px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:111.78px;top:363.65px" class="cls_060"><span class="cls_060">public Health health() {</span></div>
<div style="position:absolute;left:121.38px;top:373.64px" class="cls_060"><span class="cls_060">int hour = Calendar.getInstance().get(Calendar.HOUR_OF_DAY);</span></div>
<div style="position:absolute;left:121.38px;top:383.66px" class="cls_060"><span class="cls_060">if (hour &gt; 12) {</span></div>
<div style="position:absolute;left:130.95px;top:393.65px" class="cls_060"><span class="cls_060">return Health</span></div>
<div style="position:absolute;left:150.15px;top:403.64px" class="cls_060"><span class="cls_060">.outOfService()</span></div>
<div style="position:absolute;left:150.15px;top:413.66px" class="cls_060"><span class="cls_060">.withDetail("reason",</span></div>
<div style="position:absolute;left:183.76px;top:423.65px" class="cls_060"><span class="cls_060">"I'm out of service after lunchtime")</span></div>
<div style="position:absolute;left:150.12px;top:433.64px" class="cls_060"><span class="cls_060">.withDetail("hour", hour)</span></div>
<div style="position:absolute;left:150.15px;top:443.66px" class="cls_060"><span class="cls_060">.build();</span></div>
<div style="position:absolute;left:121.38px;top:453.65px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:121.38px;top:473.66px" class="cls_060"><span class="cls_060">if (Math.random() &lt; 0.1) {</span></div>
<div style="position:absolute;left:130.95px;top:483.65px" class="cls_060"><span class="cls_060">return Health</span></div>
<div style="position:absolute;left:150.15px;top:493.64px" class="cls_060"><span class="cls_060">.down()</span></div>
<div style="position:absolute;left:150.17px;top:503.66px" class="cls_060"><span class="cls_060">.withDetail("reason", "I break 10% of the time")</span></div>
<div style="position:absolute;left:150.15px;top:513.65px" class="cls_060"><span class="cls_060">.build();</span></div>
<div style="position:absolute;left:121.38px;top:523.64px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:121.38px;top:542.66px" class="cls_060"><span class="cls_060">return Health</span></div>
<div style="position:absolute;left:140.56px;top:552.65px" class="cls_060"><span class="cls_060">.up()</span></div>
<div style="position:absolute;left:140.54px;top:562.64px" class="cls_060"><span class="cls_060">.withDetail("reason", "All is good!")</span></div>
<div style="position:absolute;left:140.55px;top:572.66px" class="cls_060"><span class="cls_060">.build();</span></div>
<div style="position:absolute;left:111.78px;top:582.65px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:592.64px" class="cls_061"><span class="cls_061">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:293380px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background444.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">422</span></div>
<div style="position:absolute;left:173.61px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 16</span></div>
<div style="position:absolute;left:222.54px;top:24.35px" class="cls_055"><span class="cls_055">Working with Spring Boot Actuator</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">This crazy health indicator first checks what the current time is, and if it’s after noon,</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">returns a health status of </span><span class="cls_059">OUT_OF_SERVICE</span><span class="cls_039">, with a few details explaining the reason for</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">that status.</span></div>
<div style="position:absolute;left:107.70px;top:89.66px" class="cls_039"><span class="cls_039">Even if it’s before lunch, there’s a 10% chance that the health indicator will report</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">a </span><span class="cls_059">DOWN</span><span class="cls_039"> status, because it uses a random number to decide if it’s up or not. If the ran-</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">dom number is less than 0.1, the status will be reported as </span><span class="cls_059">DOWN</span><span class="cls_039">. Otherwise, the status</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">will be </span><span class="cls_059">UP</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:108.48px;top:141.65px" class="cls_039"><span class="cls_039">Obviously, the health indicator in listing 16.5 isn’t going to be very useful in any</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_039"><span class="cls_039">real-world applications. But imagine that instead of consulting the current time or a</span></div>
<div style="position:absolute;left:93.18px;top:167.66px" class="cls_039"><span class="cls_039">random number, it were to make a remote call to some external system and determine</span></div>
<div style="position:absolute;left:93.18px;top:180.65px" class="cls_039"><span class="cls_039">the status based on the response it receives. In that case, it would be a very useful</span></div>
<div style="position:absolute;left:93.18px;top:193.67px" class="cls_039"><span class="cls_039">health indicator.</span></div>
<div style="position:absolute;left:57.18px;top:215.48px" class="cls_063"><span class="cls_063">16.3.3</span></div>
<div style="position:absolute;left:93.18px;top:215.48px" class="cls_063"><span class="cls_063">Registering custom metrics</span></div>
<div style="position:absolute;left:93.18px;top:232.67px" class="cls_039"><span class="cls_039">In section 16.2.4, we looked at how you could navigate the /metrics endpoint to con-</span></div>
<div style="position:absolute;left:93.18px;top:245.66px" class="cls_039"><span class="cls_039">sume various metrics published by Actuator, with a focus on metrics pertaining to</span></div>
<div style="position:absolute;left:93.18px;top:258.65px" class="cls_039"><span class="cls_039">HTTP requests. The metrics provided by Actuator are very useful, but the /metrics</span></div>
<div style="position:absolute;left:93.18px;top:271.67px" class="cls_039"><span class="cls_039">endpoint isn’t limited to only those built-in metrics.</span></div>
<div style="position:absolute;left:108.51px;top:284.66px" class="cls_039"><span class="cls_039">Ultimately, Actuator metrics are implemented by Micrometer (</span><a href="https://micrometer.io/">https://micrometer</a> </div>
<div style="position:absolute;left:93.18px;top:297.68px" class="cls_045"><span class="cls_045"> </span><a href="https://micrometer.io/">.io/</a> <span class="cls_039">), a vendor-neutral metrics facade that makes it possible for applications to publish</span></div>
<div style="position:absolute;left:93.18px;top:310.67px" class="cls_039"><span class="cls_039">any metrics they want and to display them in the third-party monitoring system of their</span></div>
<div style="position:absolute;left:93.18px;top:323.66px" class="cls_039"><span class="cls_039">choice, including support for Prometheus, Datadog, and New Relic, among others.</span></div>
<div style="position:absolute;left:107.88px;top:336.68px" class="cls_039"><span class="cls_039">The most basic means of publishing metrics with Micrometer is through Microm-</span></div>
<div style="position:absolute;left:93.18px;top:349.67px" class="cls_039"><span class="cls_039">eter’s </span><span class="cls_059">MeterRegistry</span><span class="cls_039">. In a Spring Boot application, all you need to do to publish</span></div>
<div style="position:absolute;left:93.18px;top:362.66px" class="cls_039"><span class="cls_039">metrics is to inject a </span><span class="cls_059">MeterRegistry</span><span class="cls_039"> wherever you may need to publish counters, tim-</span></div>
<div style="position:absolute;left:93.18px;top:375.68px" class="cls_039"><span class="cls_039">ers, or gauges that capture the metrics for your application.</span></div>
<div style="position:absolute;left:108.42px;top:388.67px" class="cls_039"><span class="cls_039">As an example of publishing custom metrics, suppose you want to keep counters</span></div>
<div style="position:absolute;left:93.18px;top:401.66px" class="cls_039"><span class="cls_039">for the numbers of tacos that have been created with different ingredients. That is,</span></div>
<div style="position:absolute;left:93.18px;top:414.68px" class="cls_039"><span class="cls_039">you want to track how many tacos have been made with lettuce, or ground beef, or</span></div>
<div style="position:absolute;left:93.18px;top:427.67px" class="cls_039"><span class="cls_039">flour tortillas, or any of the available ingredients. The </span><span class="cls_059">TacoMetrics</span><span class="cls_039"> bean in the next</span></div>
<div style="position:absolute;left:93.18px;top:440.66px" class="cls_039"><span class="cls_039">listing shows how you might use </span><span class="cls_059">MeterRegistry</span><span class="cls_039"> to gather that information.</span></div>
<div style="position:absolute;left:105.18px;top:464.66px" class="cls_066"><span class="cls_066">Listing 16.6</span></div>
<div style="position:absolute;left:162.69px;top:464.27px" class="cls_077"><span class="cls_077">TacoMetrics</span><span class="cls_066"> registers metrics around taco ingredients</span></div>
<div style="position:absolute;left:93.18px;top:484.64px" class="cls_060"><span class="cls_060">package tacos.tacos;</span></div>
<div style="position:absolute;left:93.18px;top:494.66px" class="cls_060"><span class="cls_060">import java.util.List;</span></div>
<div style="position:absolute;left:93.18px;top:504.65px" class="cls_060"><span class="cls_060">import</span></div>
<div style="position:absolute;left:117.18px;top:514.64px" class="cls_060"><span class="cls_060">org.springframework.data.rest.core.event.AbstractRepositoryEventListener</span></div>
<div style="position:absolute;left:117.18px;top:524.66px" class="cls_060"><span class="cls_060">;</span></div>
<div style="position:absolute;left:93.18px;top:534.65px" class="cls_060"><span class="cls_060">import org.springframework.stereotype.Component;</span></div>
<div style="position:absolute;left:93.18px;top:544.64px" class="cls_060"><span class="cls_060">import io.micrometer.core.instrument.MeterRegistry;</span></div>
<div style="position:absolute;left:93.18px;top:564.65px" class="cls_060"><span class="cls_060">@Component</span></div>
<div style="position:absolute;left:93.18px;top:574.64px" class="cls_060"><span class="cls_060">public class TacoMetrics extends AbstractRepositoryEventListener&lt;Taco&gt; {</span></div>
<div style="position:absolute;left:102.78px;top:584.66px" class="cls_060"><span class="cls_060">private MeterRegistry meterRegistry;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:294056px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background445.jpg" width="531" height="666"></div>
<div style="position:absolute;left:231.81px;top:24.35px" class="cls_055"><span class="cls_055">Customizing Actuator</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">423</span></div>
<div style="position:absolute;left:111.78px;top:51.32px" class="cls_060"><span class="cls_060">public TacoMetrics(MeterRegistry meterRegistry) {</span></div>
<div style="position:absolute;left:121.38px;top:61.34px" class="cls_060"><span class="cls_060">this.meterRegistry = meterRegistry;</span></div>
<div style="position:absolute;left:111.78px;top:71.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:91.34px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:111.77px;top:101.33px" class="cls_060"><span class="cls_060">protected void onAfterCreate(Taco taco) {</span></div>
<div style="position:absolute;left:121.38px;top:111.32px" class="cls_060"><span class="cls_060">List&lt;Ingredient&gt; ingredients = taco.getIngredients();</span></div>
<div style="position:absolute;left:121.38px;top:121.34px" class="cls_060"><span class="cls_060">for (Ingredient ingredient : ingredients) {</span></div>
<div style="position:absolute;left:130.95px;top:131.33px" class="cls_060"><span class="cls_060">meterRegistry.counter("tacocloud",</span></div>
<div style="position:absolute;left:150.15px;top:141.35px" class="cls_060"><span class="cls_060">"ingredient", ingredient.getId()).increment();</span></div>
<div style="position:absolute;left:121.38px;top:151.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:161.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:171.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:195.65px" class="cls_039"><span class="cls_039">As you can see, </span><span class="cls_059">TacoMetrics</span><span class="cls_039"> is injected through its constructor with a </span><span class="cls_059">MeterRegistry</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:102.18px;top:208.67px" class="cls_039"><span class="cls_039">It also extends </span><span class="cls_059">AbstractRepositoryEventListener</span><span class="cls_039">, a Spring Data class that enables</span></div>
<div style="position:absolute;left:102.18px;top:221.66px" class="cls_039"><span class="cls_039">the interception of repository events and overrides the </span><span class="cls_059">onAfterCreate()</span><span class="cls_039"> method so</span></div>
<div style="position:absolute;left:102.18px;top:234.65px" class="cls_039"><span class="cls_039">that it can be notified any time a new </span><span class="cls_059">Taco</span><span class="cls_039"> object is saved.</span></div>
<div style="position:absolute;left:117.09px;top:247.67px" class="cls_039"><span class="cls_039">Within </span><span class="cls_059">onAfterCreate()</span><span class="cls_039">, a counter is declared for each ingredient where the tag</span></div>
<div style="position:absolute;left:102.18px;top:260.66px" class="cls_039"><span class="cls_039">name is </span><span class="cls_059">ingredient</span><span class="cls_039"> and the tag value is equal to the ingredient ID. If a counter with</span></div>
<div style="position:absolute;left:102.18px;top:273.65px" class="cls_039"><span class="cls_039">that tag already exists, it will be reused. The counter is incremented, indicating that</span></div>
<div style="position:absolute;left:102.18px;top:286.67px" class="cls_039"><span class="cls_039">another taco has been created for the ingredient.</span></div>
<div style="position:absolute;left:117.03px;top:299.66px" class="cls_039"><span class="cls_039">After a few tacos have been created, you can start querying the /metrics endpoint</span></div>
<div style="position:absolute;left:102.18px;top:312.68px" class="cls_039"><span class="cls_039">for ingredient counts. A GET request to /metrics/tacocloud yields some unfiltered</span></div>
<div style="position:absolute;left:102.18px;top:325.67px" class="cls_039"><span class="cls_039">metric counts:</span></div>
<div style="position:absolute;left:102.18px;top:347.33px" class="cls_060"><span class="cls_060">$ curl localhost:8087/actuator/metrics/tacocloud</span></div>
<div style="position:absolute;left:102.18px;top:357.35px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:111.78px;top:367.34px" class="cls_060"><span class="cls_060">"name": "tacocloud",</span></div>
<div style="position:absolute;left:111.77px;top:377.33px" class="cls_060"><span class="cls_060">"measurements": [ { "statistic": "COUNT", "value": 84 }</span></div>
<div style="position:absolute;left:111.78px;top:387.35px" class="cls_060"><span class="cls_060">],</span></div>
<div style="position:absolute;left:111.78px;top:397.34px" class="cls_060"><span class="cls_060">"availableTags": [</span></div>
<div style="position:absolute;left:121.38px;top:407.36px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:130.95px;top:417.35px" class="cls_060"><span class="cls_060">"tag": "ingredient",</span></div>
<div style="position:absolute;left:130.93px;top:427.34px" class="cls_060"><span class="cls_060">"values": [ "FLTO", "CHED", "LETC", "GRBF",</span></div>
<div style="position:absolute;left:188.49px;top:437.36px" class="cls_060"><span class="cls_060">"COTO", "JACK", "TMTO", "SLSA"]</span></div>
<div style="position:absolute;left:121.38px;top:447.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:457.34px" class="cls_060"><span class="cls_060">]</span></div>
<div style="position:absolute;left:102.18px;top:467.36px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:491.66px" class="cls_039"><span class="cls_039">The count value under </span><span class="cls_059">measurements</span><span class="cls_039"> doesn’t mean much here, as it’s a sum of all the</span></div>
<div style="position:absolute;left:102.18px;top:504.68px" class="cls_039"><span class="cls_039">counts for all ingredients. But let’s suppose you want to know how many tacos have</span></div>
<div style="position:absolute;left:102.18px;top:517.67px" class="cls_039"><span class="cls_039">been created with flour tortillas (</span><span class="cls_059">FLTO</span><span class="cls_039">). All you need to do is specify the </span><span class="cls_059">ingredient</span></div>
<div style="position:absolute;left:102.18px;top:530.66px" class="cls_039"><span class="cls_039">tag with a value of </span><span class="cls_059">FLTO</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:102.18px;top:552.35px" class="cls_060"><span class="cls_060">$ curl localhost:8087/actuator/metrics/tacocloud?tag=ingredient:FLTO</span></div>
<div style="position:absolute;left:102.18px;top:572.36px" class="cls_060"><span class="cls_060">{</span></div>
<div style="position:absolute;left:111.78px;top:582.35px" class="cls_060"><span class="cls_060">"name": "tacocloud",</span></div>
<div style="position:absolute;left:111.76px;top:592.34px" class="cls_060"><span class="cls_060">"measurements": [</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:294732px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background446.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">424</span></div>
<div style="position:absolute;left:173.61px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 16</span></div>
<div style="position:absolute;left:222.54px;top:24.35px" class="cls_055"><span class="cls_055">Working with Spring Boot Actuator</span></div>
<div style="position:absolute;left:112.38px;top:51.32px" class="cls_060"><span class="cls_060">{ "statistic": "COUNT", "value": 39 }</span></div>
<div style="position:absolute;left:102.78px;top:61.34px" class="cls_060"><span class="cls_060">],</span></div>
<div style="position:absolute;left:102.78px;top:71.33px" class="cls_060"><span class="cls_060">"availableTags": []</span></div>
<div style="position:absolute;left:93.18px;top:81.32px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:105.65px" class="cls_039"><span class="cls_039">Now it’s clear that 39 tacos have had flour tortillas as one of their ingredients.</span></div>
<div style="position:absolute;left:57.18px;top:131.48px" class="cls_063"><span class="cls_063">16.3.4</span></div>
<div style="position:absolute;left:93.18px;top:131.48px" class="cls_063"><span class="cls_063">Creating custom endpoints</span></div>
<div style="position:absolute;left:93.18px;top:149.15px" class="cls_039"><span class="cls_039">At first glance, you might think that Actuator’s endpoints are implemented as nothing</span></div>
<div style="position:absolute;left:93.18px;top:162.17px" class="cls_039"><span class="cls_039">more than Spring MVC controllers. But as you’ll see in chapter 18, the endpoints are</span></div>
<div style="position:absolute;left:93.18px;top:175.16px" class="cls_039"><span class="cls_039">also exposed as JMX MBeans as well as through HTTP requests. Therefore, there</span></div>
<div style="position:absolute;left:93.18px;top:188.15px" class="cls_039"><span class="cls_039">must be something more to these endpoints than just a controller class.</span></div>
<div style="position:absolute;left:108.12px;top:201.17px" class="cls_039"><span class="cls_039">In fact, Actuator endpoints are defined quite differently from controllers. Instead</span></div>
<div style="position:absolute;left:93.18px;top:214.16px" class="cls_039"><span class="cls_039">of a class that’s annotated with </span><span class="cls_059">@Controller</span><span class="cls_039"> or </span><span class="cls_059">@RestController</span><span class="cls_039">, Actuator endpoints</span></div>
<div style="position:absolute;left:93.18px;top:227.15px" class="cls_039"><span class="cls_039">are defined with classes that are annotated with </span><span class="cls_059">@Endpoint</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:109.44px;top:240.17px" class="cls_039"><span class="cls_039">What’s more, instead of using HTTP-named annotations such as </span><span class="cls_059">@GetMapping</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:93.18px;top:253.16px" class="cls_059"><span class="cls_059">@PostMapping</span><span class="cls_039">, or </span><span class="cls_059">@DeleteMapping</span><span class="cls_039">, Actuator endpoint operations are defined by</span></div>
<div style="position:absolute;left:93.18px;top:266.15px" class="cls_039"><span class="cls_039">methods annotated with </span><span class="cls_059">@ReadOperation</span><span class="cls_039">, </span><span class="cls_059">@WriteOperation</span><span class="cls_039">, and </span><span class="cls_059">@DeleteOperation</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:93.18px;top:279.17px" class="cls_039"><span class="cls_039">These annotations don’t imply any specific communication mechanism and, in fact,</span></div>
<div style="position:absolute;left:93.18px;top:292.16px" class="cls_039"><span class="cls_039">allow Actuator to communicate by any variety of communication mechanisms, HTTP,</span></div>
<div style="position:absolute;left:93.18px;top:305.18px" class="cls_039"><span class="cls_039">and JMX out of the box.</span></div>
<div style="position:absolute;left:107.68px;top:318.17px" class="cls_039"><span class="cls_039">To demonstrate how to write a custom Actuator endpoint, consider </span><span class="cls_059">NotesEndpoint</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:105.18px;top:344.90px" class="cls_066"><span class="cls_066">Listing 16.7</span></div>
<div style="position:absolute;left:162.67px;top:344.90px" class="cls_066"><span class="cls_066">A custom endpoint for taking notes</span></div>
<div style="position:absolute;left:93.18px;top:365.75px" class="cls_060"><span class="cls_060">package tacos.ingredients;</span></div>
<div style="position:absolute;left:93.18px;top:375.74px" class="cls_060"><span class="cls_060">import java.util.ArrayList;</span></div>
<div style="position:absolute;left:93.18px;top:385.76px" class="cls_060"><span class="cls_060">import java.util.Date;</span></div>
<div style="position:absolute;left:93.18px;top:395.75px" class="cls_060"><span class="cls_060">import java.util.List;</span></div>
<div style="position:absolute;left:93.18px;top:405.74px" class="cls_060"><span class="cls_060">import org.springframework.boot.actuate.endpoint.annotation.DeleteOperation;</span></div>
<div style="position:absolute;left:93.18px;top:415.76px" class="cls_060"><span class="cls_060">import org.springframework.boot.actuate.endpoint.annotation.Endpoint;</span></div>
<div style="position:absolute;left:93.18px;top:425.75px" class="cls_060"><span class="cls_060">import org.springframework.boot.actuate.endpoint.annotation.ReadOperation;</span></div>
<div style="position:absolute;left:93.18px;top:435.74px" class="cls_060"><span class="cls_060">import org.springframework.boot.actuate.endpoint.annotation.WriteOperation;</span></div>
<div style="position:absolute;left:93.18px;top:445.76px" class="cls_060"><span class="cls_060">import org.springframework.stereotype.Component;</span></div>
<div style="position:absolute;left:93.18px;top:455.75px" class="cls_060"><span class="cls_060">import lombok.Getter;</span></div>
<div style="position:absolute;left:93.18px;top:465.74px" class="cls_060"><span class="cls_060">import lombok.RequiredArgsConstructor;</span></div>
<div style="position:absolute;left:93.18px;top:488.75px" class="cls_060"><span class="cls_060">@Component</span></div>
<div style="position:absolute;left:93.18px;top:498.74px" class="cls_060"><span class="cls_060">@Endpoint(id="notes", enableByDefault=true)</span></div>
<div style="position:absolute;left:93.18px;top:508.76px" class="cls_060"><span class="cls_060">public class NotesEndpoint {</span></div>
<div style="position:absolute;left:102.78px;top:531.74px" class="cls_060"><span class="cls_060">private List&lt;Note&gt; notes = new ArrayList&lt;&gt;();</span></div>
<div style="position:absolute;left:102.78px;top:553.76px" class="cls_060"><span class="cls_060">@ReadOperation</span></div>
<div style="position:absolute;left:102.78px;top:563.75px" class="cls_060"><span class="cls_060">public List&lt;Note&gt; notes() {</span></div>
<div style="position:absolute;left:112.38px;top:573.74px" class="cls_060"><span class="cls_060">return notes;</span></div>
<div style="position:absolute;left:102.78px;top:583.76px" class="cls_060"><span class="cls_060">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:295408px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background447.jpg" width="531" height="666"></div>
<div style="position:absolute;left:231.81px;top:24.35px" class="cls_055"><span class="cls_055">Customizing Actuator</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">425</span></div>
<div style="position:absolute;left:111.78px;top:51.32px" class="cls_060"><span class="cls_060">@WriteOperation</span></div>
<div style="position:absolute;left:111.78px;top:61.34px" class="cls_060"><span class="cls_060">public List&lt;Note&gt; addNote(String text) {</span></div>
<div style="position:absolute;left:121.36px;top:71.33px" class="cls_060"><span class="cls_060">notes.add(new Note(text));</span></div>
<div style="position:absolute;left:121.38px;top:81.32px" class="cls_060"><span class="cls_060">return notes;</span></div>
<div style="position:absolute;left:111.78px;top:91.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:111.32px" class="cls_060"><span class="cls_060">@DeleteOperation</span></div>
<div style="position:absolute;left:111.77px;top:121.34px" class="cls_060"><span class="cls_060">public List&lt;Note&gt; deleteNote(int index) {</span></div>
<div style="position:absolute;left:121.37px;top:131.33px" class="cls_060"><span class="cls_060">if (index &lt; notes.size()) {</span></div>
<div style="position:absolute;left:130.95px;top:141.35px" class="cls_060"><span class="cls_060">notes.remove(index);</span></div>
<div style="position:absolute;left:121.38px;top:151.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:121.38px;top:161.33px" class="cls_060"><span class="cls_060">return notes;</span></div>
<div style="position:absolute;left:111.78px;top:171.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:191.33px" class="cls_060"><span class="cls_060">@RequiredArgsConstructor</span></div>
<div style="position:absolute;left:111.78px;top:201.35px" class="cls_060"><span class="cls_060">private class Note {</span></div>
<div style="position:absolute;left:121.38px;top:211.34px" class="cls_060"><span class="cls_060">@Getter</span></div>
<div style="position:absolute;left:121.38px;top:221.33px" class="cls_060"><span class="cls_060">private Date time = new Date();</span></div>
<div style="position:absolute;left:121.38px;top:241.34px" class="cls_060"><span class="cls_060">@Getter</span></div>
<div style="position:absolute;left:121.36px;top:251.33px" class="cls_060"><span class="cls_060">private final String text;</span></div>
<div style="position:absolute;left:111.78px;top:261.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:271.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:292.67px" class="cls_039"><span class="cls_039">This endpoint is a simple note-taking endpoint, wherein one can submit a note with</span></div>
<div style="position:absolute;left:102.18px;top:305.66px" class="cls_039"><span class="cls_039">a write operation, read the list of notes with a read operation, and remove a note</span></div>
<div style="position:absolute;left:102.18px;top:318.68px" class="cls_039"><span class="cls_039">with the delete operation. Admittedly, this endpoint isn’t very useful as far as Actua-</span></div>
<div style="position:absolute;left:102.18px;top:331.67px" class="cls_039"><span class="cls_039">tor endpoints go. But when you consider that the out-of-the-box Actuator endpoints</span></div>
<div style="position:absolute;left:102.18px;top:344.66px" class="cls_039"><span class="cls_039">cover so much ground, it’s difficult to come up with a practical example of a custom</span></div>
<div style="position:absolute;left:102.18px;top:357.68px" class="cls_039"><span class="cls_039">Actuator endpoint.</span></div>
<div style="position:absolute;left:116.68px;top:370.67px" class="cls_039"><span class="cls_039">At any rate, the </span><span class="cls_059">NotesEndpoint</span><span class="cls_039"> class is annotated with </span><span class="cls_059">@Component</span><span class="cls_039"> so that it will be</span></div>
<div style="position:absolute;left:102.18px;top:383.66px" class="cls_039"><span class="cls_039">picked up by Spring’s component scanning and instantiated as a bean in the Spring</span></div>
<div style="position:absolute;left:102.18px;top:396.68px" class="cls_039"><span class="cls_039">application context. But more relevant to this discussion, it’s also annotated with</span></div>
<div style="position:absolute;left:102.18px;top:409.67px" class="cls_059"><span class="cls_059">@Endpoint</span><span class="cls_039">, making it an Actuator endpoint with an ID of </span><span class="cls_059">notes</span><span class="cls_039">. And it’s enabled by</span></div>
<div style="position:absolute;left:102.18px;top:422.66px" class="cls_039"><span class="cls_039">default so that you won’t need to explicitly enable it by including it in the </span><span class="cls_059">management</span></div>
<div style="position:absolute;left:102.18px;top:435.68px" class="cls_059"><span class="cls_059">.web.endpoints.web.exposure.include</span><span class="cls_039"> configuration property.</span></div>
<div style="position:absolute;left:116.78px;top:448.67px" class="cls_039"><span class="cls_039">As you can see, </span><span class="cls_059">NotesEndpoint</span><span class="cls_039"> offers one of each kind of operation:</span></div>
<div style="position:absolute;left:117.78px;top:465.68px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  The </span><span class="cls_059">notes()</span><span class="cls_039"> method is annotated with </span><span class="cls_059">@ReadOperation</span><span class="cls_039">. When invoked, it will</span></div>
<div style="position:absolute;left:129.78px;top:478.67px" class="cls_039"><span class="cls_039">return a list of available notes. In HTTP terms, this means it will handle an</span></div>
<div style="position:absolute;left:129.78px;top:491.66px" class="cls_039"><span class="cls_039">HTTP GET request for /actuator/notes and respond with a JSON list of notes.</span></div>
<div style="position:absolute;left:117.78px;top:505.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  The </span><span class="cls_059">addNote()</span><span class="cls_039"> method is annotated with </span><span class="cls_059">@WriteOperation</span><span class="cls_039">. When invoked, it</span></div>
<div style="position:absolute;left:129.78px;top:518.66px" class="cls_039"><span class="cls_039">will create a new note from the given text and add it to the list. In HTTP terms,</span></div>
<div style="position:absolute;left:129.78px;top:531.68px" class="cls_039"><span class="cls_039">it handles a POST request where the body of the request is a JSON object with a</span></div>
<div style="position:absolute;left:129.78px;top:544.67px" class="cls_059"><span class="cls_059">text</span><span class="cls_039"> property. It finishes by responding with the current state of the notes list.</span></div>
<div style="position:absolute;left:117.78px;top:558.68px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  The </span><span class="cls_059">deleteNote()</span><span class="cls_039"> method is annotated with </span><span class="cls_059">@DeleteOperation</span><span class="cls_039">. When invoked,</span></div>
<div style="position:absolute;left:129.78px;top:571.67px" class="cls_039"><span class="cls_039">it will delete the note at the given index. In HTTP terms, this endpoint handles</span></div>
<div style="position:absolute;left:129.78px;top:584.69px" class="cls_039"><span class="cls_039">DELETE requests where the index is given as a request parameter.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:296084px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background448.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">426</span></div>
<div style="position:absolute;left:173.61px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 16</span></div>
<div style="position:absolute;left:222.54px;top:24.35px" class="cls_055"><span class="cls_055">Working with Spring Boot Actuator</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">To see this in action, you can use curl to poke about with this new endpoint. First, add</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">a couple of notes, using two separate POST requests:</span></div>
<div style="position:absolute;left:93.18px;top:86.33px" class="cls_060"><span class="cls_060">$ curl localhost:8080/actuator/notes \</span></div>
<div style="position:absolute;left:165.15px;top:96.32px" class="cls_060"><span class="cls_060">-d'{"text":"Bring home milk"}' \</span></div>
<div style="position:absolute;left:165.15px;top:106.34px" class="cls_060"><span class="cls_060">-H"Content-type: application/json"</span></div>
<div style="position:absolute;left:93.18px;top:116.33px" class="cls_060"><span class="cls_060">[{"time":"2018-06-08T13:50:45.085+0000","text":"Bring home milk"}]</span></div>
<div style="position:absolute;left:93.18px;top:136.34px" class="cls_060"><span class="cls_060">$ curl localhost:8080/actuator/notes \</span></div>
<div style="position:absolute;left:165.15px;top:146.33px" class="cls_060"><span class="cls_060">-d'{"text":"Take dry cleaning"}' \</span></div>
<div style="position:absolute;left:165.15px;top:156.35px" class="cls_060"><span class="cls_060">-H"Content-type: application/json"</span></div>
<div style="position:absolute;left:93.18px;top:166.34px" class="cls_060"><span class="cls_060">[{"time":"2018-06-08T13:50:45.085+0000","text":"Bring home milk"},</span></div>
<div style="position:absolute;left:97.98px;top:176.33px" class="cls_061"><span class="cls_061">{"time":"2018-06-08T13:50:48.021+0000","text":"Take dry cleaning"}]</span></div>
<div style="position:absolute;left:93.18px;top:200.66px" class="cls_039"><span class="cls_039">As you can see, each time a new note is posted, the endpoint responds with the newly</span></div>
<div style="position:absolute;left:93.18px;top:213.65px" class="cls_039"><span class="cls_039">appended list of notes. But if later you want to view the list of notes, you can do a sim-</span></div>
<div style="position:absolute;left:93.18px;top:226.67px" class="cls_039"><span class="cls_039">ple GET request:</span></div>
<div style="position:absolute;left:93.18px;top:248.33px" class="cls_060"><span class="cls_060">$ curl localhost:8080/actuator/notes</span></div>
<div style="position:absolute;left:93.18px;top:258.35px" class="cls_060"><span class="cls_060">[{"time":"2018-06-08T13:50:45.085+0000","text":"Bring home milk"},</span></div>
<div style="position:absolute;left:97.98px;top:268.34px" class="cls_061"><span class="cls_061">{"time":"2018-06-08T13:50:48.021+0000","text":"Take dry cleaning"}]</span></div>
<div style="position:absolute;left:93.18px;top:292.67px" class="cls_039"><span class="cls_039">If you decide to remove one of the notes, a DELETE request with an </span><span class="cls_059">index</span><span class="cls_039"> request</span></div>
<div style="position:absolute;left:93.18px;top:305.66px" class="cls_039"><span class="cls_039">parameter should do the trick:</span></div>
<div style="position:absolute;left:93.18px;top:327.35px" class="cls_060"><span class="cls_060">$ curl localhost:8080/actuator/notes?index=1 -X DELETE</span></div>
<div style="position:absolute;left:93.18px;top:337.34px" class="cls_061"><span class="cls_061">[{"time":"2018-06-08T13:50:45.085+0000","text":"Bring home milk"}]</span></div>
<div style="position:absolute;left:93.18px;top:361.67px" class="cls_039"><span class="cls_039">It’s important to note that although I’ve only shown how to interact with the endpoint</span></div>
<div style="position:absolute;left:93.18px;top:374.66px" class="cls_039"><span class="cls_039">using HTTP, it will also be exposed as an MBean that can be accessed using whatever</span></div>
<div style="position:absolute;left:93.18px;top:387.68px" class="cls_039"><span class="cls_039">JMX client you choose. But if you want to limit it to only exposing an HTTP endpoint,</span></div>
<div style="position:absolute;left:93.18px;top:400.67px" class="cls_039"><span class="cls_039">you can annotate the endpoint class with </span><span class="cls_059">@WebEndpoint</span><span class="cls_039"> instead of </span><span class="cls_059">@Endpoint</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:422.36px" class="cls_060"><span class="cls_060">@Component</span></div>
<div style="position:absolute;left:93.18px;top:432.35px" class="cls_060"><span class="cls_060">@WebEndpoint(id="notes", enableByDefault=true)</span></div>
<div style="position:absolute;left:93.18px;top:442.34px" class="cls_060"><span class="cls_060">public class NotesEndpoint {</span></div>
<div style="position:absolute;left:93.18px;top:462.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:486.68px" class="cls_039"><span class="cls_039">Likewise, if you prefer an MBean-only endpoint, annotate the class with </span><span class="cls_059">@JmxEndpoint</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:57.18px;top:511.84px" class="cls_040"><span class="cls_040">16.4</span></div>
<div style="position:absolute;left:93.18px;top:511.84px" class="cls_040"><span class="cls_040">Securing Actuator</span></div>
<div style="position:absolute;left:93.18px;top:531.17px" class="cls_039"><span class="cls_039">The information presented by Actuator is probably not something that you would</span></div>
<div style="position:absolute;left:93.18px;top:544.16px" class="cls_039"><span class="cls_039">want prying eyes to see. Moreover, because Actuator provides a few operations that let</span></div>
<div style="position:absolute;left:93.18px;top:557.18px" class="cls_039"><span class="cls_039">you change environment properties and logging levels, it’s probably a good idea to</span></div>
<div style="position:absolute;left:93.18px;top:570.17px" class="cls_039"><span class="cls_039">secure Actuator so that only clients with proper access will be allowed to consume its</span></div>
<div style="position:absolute;left:93.18px;top:583.19px" class="cls_039"><span class="cls_039">endpoints.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:296760px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background449.jpg" width="531" height="666"></div>
<div style="position:absolute;left:238.35px;top:24.35px" class="cls_055"><span class="cls_055">Securing Actuator</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">427</span></div>
<div style="position:absolute;left:117.66px;top:50.66px" class="cls_039"><span class="cls_039">Even though it’s important to secure Actuator, security is outside of Actuator’s</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">responsibilities. Instead, you’ll need to use Spring Security to secure Actuator. And</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">because Actuator endpoints are just paths in the application like any other path in</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">the application, there’s nothing unique about securing Actuator versus any other</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">application path. Everything we discussed in chapter 4 applies when securing Actua-</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">tor endpoints.</span></div>
<div style="position:absolute;left:116.91px;top:128.66px" class="cls_039"><span class="cls_039">Because all Actuator endpoints are gathered under a common base path of /actu-</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">ator (or possibly some other base path if the </span><span class="cls_059">management.endpoints.web.base-path</span></div>
<div style="position:absolute;left:102.18px;top:154.67px" class="cls_039"><span class="cls_039">property is set), it’s easy to apply authorization rules to all Actuator endpoints across</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">the board. For example, to require that a user have </span><span class="cls_059">ROLE_ADMIN</span><span class="cls_039"> authority to invoke</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">Actuator endpoints, you might override the </span><span class="cls_059">configure()</span><span class="cls_039"> method of </span><span class="cls_059">WebSecurity-</span></div>
<div style="position:absolute;left:102.18px;top:193.67px" class="cls_059"><span class="cls_059">ConfigurerAdapter</span><span class="cls_039"> like this:</span></div>
<div style="position:absolute;left:102.18px;top:215.33px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:102.18px;top:225.35px" class="cls_060"><span class="cls_060">protected void configure(HttpSecurity http) throws Exception {</span></div>
<div style="position:absolute;left:111.78px;top:235.34px" class="cls_060"><span class="cls_060">http</span></div>
<div style="position:absolute;left:121.38px;top:245.33px" class="cls_060"><span class="cls_060">.authorizeRequests()</span></div>
<div style="position:absolute;left:130.95px;top:255.35px" class="cls_060"><span class="cls_060">.antMatchers("/actuator/**").hasRole("ADMIN")</span></div>
<div style="position:absolute;left:121.38px;top:275.33px" class="cls_060"><span class="cls_060">.and()</span></div>
<div style="position:absolute;left:121.38px;top:295.34px" class="cls_060"><span class="cls_060">.httpBasic();</span></div>
<div style="position:absolute;left:102.18px;top:305.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:326.66px" class="cls_039"><span class="cls_039">This requires that all requests be from an authenticated user with </span><span class="cls_059">ROLE_ADMIN</span><span class="cls_039"> author-</span></div>
<div style="position:absolute;left:102.18px;top:339.68px" class="cls_039"><span class="cls_039">ity. It also configures HTTP basic authentication so that client applications can submit</span></div>
<div style="position:absolute;left:102.18px;top:352.67px" class="cls_039"><span class="cls_039">encoded authentication information in their request </span><span class="cls_059">Authorization</span><span class="cls_039"> headers.</span></div>
<div style="position:absolute;left:117.06px;top:365.66px" class="cls_039"><span class="cls_039">The only real problem with securing Actuator this way is that the path to the end-</span></div>
<div style="position:absolute;left:102.18px;top:378.68px" class="cls_039"><span class="cls_039">points is hardcoded as /actuator/**. If this were to change because of a change to the</span></div>
<div style="position:absolute;left:102.18px;top:391.67px" class="cls_059"><span class="cls_059">management.endpoints.web.base-path</span><span class="cls_039"> property, it would no longer work. To help with</span></div>
<div style="position:absolute;left:102.18px;top:404.66px" class="cls_039"><span class="cls_039">this, Spring Boot also provides </span><span class="cls_059">EndpointRequest</span><span class="cls_039">—a request matcher class that makes</span></div>
<div style="position:absolute;left:102.18px;top:417.68px" class="cls_039"><span class="cls_039">this even easier and less dependent on a given </span><span class="cls_059">String</span><span class="cls_039"> path. Using </span><span class="cls_059">EndpointRequest</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:102.18px;top:430.67px" class="cls_039"><span class="cls_039">you can apply the same security requirements for Actuator endpoints without hard-</span></div>
<div style="position:absolute;left:102.18px;top:443.66px" class="cls_039"><span class="cls_039">coding the /actuator/** path:</span></div>
<div style="position:absolute;left:102.18px;top:465.35px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:102.18px;top:475.34px" class="cls_060"><span class="cls_060">protected void configure(HttpSecurity http) throws Exception {</span></div>
<div style="position:absolute;left:111.78px;top:485.36px" class="cls_060"><span class="cls_060">http</span></div>
<div style="position:absolute;left:121.38px;top:495.35px" class="cls_060"><span class="cls_060">.requestMatcher(EndpointRequest.toAnyEndpoint())</span></div>
<div style="position:absolute;left:130.95px;top:505.34px" class="cls_060"><span class="cls_060">.authorizeRequests()</span></div>
<div style="position:absolute;left:140.55px;top:515.36px" class="cls_060"><span class="cls_060">.anyRequest().hasRole("ADMIN")</span></div>
<div style="position:absolute;left:121.38px;top:525.35px" class="cls_060"><span class="cls_060">.and()</span></div>
<div style="position:absolute;left:121.38px;top:535.34px" class="cls_060"><span class="cls_060">.httpBasic();</span></div>
<div style="position:absolute;left:102.18px;top:545.36px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:566.69px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">EndpointRequest.toAnyEndpoint()</span><span class="cls_039"> method returns a request matcher that</span></div>
<div style="position:absolute;left:102.18px;top:579.68px" class="cls_039"><span class="cls_039">matches any Actuator endpoint. If you’d like to exclude some of the endpoints from</span></div>
<div style="position:absolute;left:102.18px;top:592.67px" class="cls_039"><span class="cls_039">the request matcher, you can call </span><span class="cls_059">excluding()</span><span class="cls_039">, specifying them by name:</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:297436px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background450.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">428</span></div>
<div style="position:absolute;left:173.61px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 16</span></div>
<div style="position:absolute;left:222.54px;top:24.35px" class="cls_055"><span class="cls_055">Working with Spring Boot Actuator</span></div>
<div style="position:absolute;left:93.18px;top:51.32px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:93.18px;top:61.34px" class="cls_060"><span class="cls_060">protected void configure(HttpSecurity http) throws Exception {</span></div>
<div style="position:absolute;left:102.78px;top:71.33px" class="cls_060"><span class="cls_060">http</span></div>
<div style="position:absolute;left:112.38px;top:81.32px" class="cls_060"><span class="cls_060">.requestMatcher(</span></div>
<div style="position:absolute;left:131.55px;top:91.34px" class="cls_060"><span class="cls_060">EndpointRequest.toAnyEndpoint()</span></div>
<div style="position:absolute;left:203.52px;top:101.33px" class="cls_060"><span class="cls_060">.excluding("health", "info"))</span></div>
<div style="position:absolute;left:112.38px;top:111.32px" class="cls_060"><span class="cls_060">.authorizeRequests()</span></div>
<div style="position:absolute;left:121.95px;top:121.34px" class="cls_060"><span class="cls_060">.anyRequest().hasRole("ADMIN")</span></div>
<div style="position:absolute;left:102.78px;top:131.33px" class="cls_060"><span class="cls_060">.and()</span></div>
<div style="position:absolute;left:112.38px;top:141.35px" class="cls_060"><span class="cls_060">.httpBasic();</span></div>
<div style="position:absolute;left:93.18px;top:151.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:172.67px" class="cls_039"><span class="cls_039">On the other hand, should you wish to apply security to only a handful of Actuator</span></div>
<div style="position:absolute;left:93.18px;top:185.66px" class="cls_039"><span class="cls_039">endpoints, you can specify those endpoints by name by calling </span><span class="cls_059">to()</span><span class="cls_039"> instead of</span></div>
<div style="position:absolute;left:93.18px;top:198.65px" class="cls_059"><span class="cls_059">toAnyEndpoint()</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:218.33px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:93.18px;top:228.35px" class="cls_060"><span class="cls_060">protected void configure(HttpSecurity http) throws Exception {</span></div>
<div style="position:absolute;left:102.78px;top:238.34px" class="cls_060"><span class="cls_060">http</span></div>
<div style="position:absolute;left:112.38px;top:248.33px" class="cls_060"><span class="cls_060">.requestMatcher(EndpointRequest.to(</span></div>
<div style="position:absolute;left:150.76px;top:258.35px" class="cls_060"><span class="cls_060">"beans", "threaddump", "loggers"))</span></div>
<div style="position:absolute;left:112.38px;top:268.34px" class="cls_060"><span class="cls_060">.authorizeRequests()</span></div>
<div style="position:absolute;left:121.95px;top:278.33px" class="cls_060"><span class="cls_060">.anyRequest().hasRole("ADMIN")</span></div>
<div style="position:absolute;left:102.78px;top:288.35px" class="cls_060"><span class="cls_060">.and()</span></div>
<div style="position:absolute;left:112.38px;top:298.34px" class="cls_060"><span class="cls_060">.httpBasic();</span></div>
<div style="position:absolute;left:93.18px;top:308.33px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:329.66px" class="cls_039"><span class="cls_039">This limits Actuator security to only the /beans, /threaddump, and /loggers endpoints.</span></div>
<div style="position:absolute;left:93.18px;top:342.68px" class="cls_039"><span class="cls_039">All other Actuator endpoints are left wide open.</span></div>
<div style="position:absolute;left:93.18px;top:363.82px" class="cls_040"><span class="cls_040">Summary</span></div>
<div style="position:absolute;left:108.78px;top:382.16px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Spring Boot Actuator provides several endpoints, both as HTTP and as JMX</span></div>
<div style="position:absolute;left:120.78px;top:395.18px" class="cls_039"><span class="cls_039">MBeans, that let you peek into the inner workings of a Spring Boot application.</span></div>
<div style="position:absolute;left:108.78px;top:409.16px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Most Actuator endpoints are disabled by default, but can be selectively exposed</span></div>
<div style="position:absolute;left:120.78px;top:422.18px" class="cls_039"><span class="cls_039">by setting </span><span class="cls_059">management.endpoints.web.exposure.include</span><span class="cls_039"> and </span><span class="cls_059">management</span></div>
<div style="position:absolute;left:120.78px;top:435.17px" class="cls_059"><span class="cls_059">.endpoints.web.exposure.exclude</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:108.78px;top:449.18px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Some endpoints, such as the /loggers and /env endpoints, allow for write oper-</span></div>
<div style="position:absolute;left:120.78px;top:462.17px" class="cls_039"><span class="cls_039">ations to change a running application’s configuration on the fly.</span></div>
<div style="position:absolute;left:108.78px;top:476.18px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Details regarding an application’s build and Git commit can be exposed in the</span></div>
<div style="position:absolute;left:120.78px;top:489.17px" class="cls_039"><span class="cls_039">/info endpoint.</span></div>
<div style="position:absolute;left:108.78px;top:503.18px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  An application’s health can be influenced by a custom health indicator, track-</span></div>
<div style="position:absolute;left:120.78px;top:516.17px" class="cls_039"><span class="cls_039">ing the health of an externally integrated application.</span></div>
<div style="position:absolute;left:108.78px;top:530.18px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Custom application metrics can be registered through Micrometer, which</span></div>
<div style="position:absolute;left:120.78px;top:543.17px" class="cls_039"><span class="cls_039">affords Spring Boot applications instant integration with several popular met-</span></div>
<div style="position:absolute;left:120.78px;top:556.19px" class="cls_039"><span class="cls_039">rics engines such as Datadog, New Relic, and Prometheus.</span></div>
<div style="position:absolute;left:108.78px;top:570.17px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Actuator web endpoints can be secured using Spring Security, much like any</span></div>
<div style="position:absolute;left:120.78px;top:583.19px" class="cls_039"><span class="cls_039">other endpoint in a Spring web application.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:298112px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background451.jpg" width="531" height="666"></div>
<div style="position:absolute;left:222.18px;top:111.83px" class="cls_014"><span class="cls_014">Administering Spring</span></div>
<div style="position:absolute;left:96.18px;top:264.85px" class="cls_049"><span class="cls_049">This chapter covers</span></div>
<div style="position:absolute;left:96.18px;top:283.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Setting up the Spring Boot Admin</span></div>
<div style="position:absolute;left:96.18px;top:298.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Registering client applications</span></div>
<div style="position:absolute;left:96.18px;top:313.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Working with Actuator endpoints</span></div>
<div style="position:absolute;left:96.18px;top:328.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Securing the Admin server</span></div>
<div style="position:absolute;left:114.18px;top:398.54px" class="cls_039"><span class="cls_039">A picture is worth a thousand words (or so they say), and for many application</span></div>
<div style="position:absolute;left:114.18px;top:411.53px" class="cls_039"><span class="cls_039">users, a user-friendly web application is worth a thousand API calls. Don’t get me</span></div>
<div style="position:absolute;left:114.18px;top:424.55px" class="cls_039"><span class="cls_039">wrong, I’m a command-line junkie and a big fan of using curl and HTTPie to con-</span></div>
<div style="position:absolute;left:114.18px;top:437.54px" class="cls_039"><span class="cls_039">sume REST APIs. But, sometimes, manually typing the command line to invoke a</span></div>
<div style="position:absolute;left:114.18px;top:450.53px" class="cls_039"><span class="cls_039">REST endpoint and then visually inspecting the results can be less efficient than</span></div>
<div style="position:absolute;left:114.18px;top:463.55px" class="cls_039"><span class="cls_039">simply clicking a link and reading the results in a web browser.</span></div>
<div style="position:absolute;left:128.80px;top:476.54px" class="cls_039"><span class="cls_039">In the previous chapter, we explored all of the HTTP endpoints exposed by the</span></div>
<div style="position:absolute;left:114.18px;top:489.56px" class="cls_039"><span class="cls_039">Spring Boot Actuator. As HTTP endpoints that return JSON responses, there’s no</span></div>
<div style="position:absolute;left:114.18px;top:502.55px" class="cls_039"><span class="cls_039">limit to how those can be used. In this chapter, we’ll see how to put a front-end user</span></div>
<div style="position:absolute;left:114.18px;top:515.54px" class="cls_039"><span class="cls_039">interface (UI) on top of the Actuator to make it easier to use, as well as capture live</span></div>
<div style="position:absolute;left:114.18px;top:528.56px" class="cls_039"><span class="cls_039">data that would be difficult to consume from Actuator directly.</span></div>
<div style="position:absolute;left:269.16px;top:596.99px" class="cls_048"><span class="cls_048">429</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:298788px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background452.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">430</span></div>
<div style="position:absolute;left:198.60px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 17</span></div>
<div style="position:absolute;left:247.53px;top:24.35px" class="cls_055"><span class="cls_055">Administering Spring</span></div>
<div style="position:absolute;left:57.18px;top:49.81px" class="cls_040"><span class="cls_040">17.1</span></div>
<div style="position:absolute;left:93.18px;top:49.81px" class="cls_040"><span class="cls_040">Using the Spring Boot Admin</span></div>
<div style="position:absolute;left:93.18px;top:69.17px" class="cls_039"><span class="cls_039">I’ve been asked several times if it’d make sense and, if so, how hard it’d be to develop</span></div>
<div style="position:absolute;left:93.18px;top:82.16px" class="cls_039"><span class="cls_039">a web application that consumes Actuator endpoints and serves them up in an easy-to-</span></div>
<div style="position:absolute;left:93.18px;top:95.15px" class="cls_039"><span class="cls_039">view UI. I respond that it’s just a REST API and, therefore, anything is possible. But</span></div>
<div style="position:absolute;left:93.18px;top:108.17px" class="cls_039"><span class="cls_039">why bother creating your own UI for the Actuator when the good folks at codecentric</span></div>
<div style="position:absolute;left:93.18px;top:121.16px" class="cls_039"><span class="cls_039">AG (</span><a href="https://www.codecentric.de/">https://www.codecentric.de/</a> <span class="cls_039">), a software and consulting company based in Ger-</span></div>
<div style="position:absolute;left:93.18px;top:134.15px" class="cls_039"><span class="cls_039">many, have already done the work for you?</span></div>
<div style="position:absolute;left:108.10px;top:147.17px" class="cls_039"><span class="cls_039">The Spring Boot Admin is an administrative frontend web application that makes</span></div>
<div style="position:absolute;left:93.18px;top:160.16px" class="cls_039"><span class="cls_039">Actuator endpoints more consumable by humans. It’s split into two primary compo-</span></div>
<div style="position:absolute;left:93.18px;top:173.15px" class="cls_039"><span class="cls_039">nents: the Spring Boot Admin server and its clients. The Admin server collects and</span></div>
<div style="position:absolute;left:93.18px;top:186.17px" class="cls_039"><span class="cls_039">displays Actuator data that’s fed to it from one or more Spring Boot applications,</span></div>
<div style="position:absolute;left:93.18px;top:199.16px" class="cls_039"><span class="cls_039">which are identified as Spring Boot Admin clients, as illustrated in figure 17.1.</span></div>
<div style="position:absolute;left:408.80px;top:230.75px" class="cls_105"><span class="cls_105">Spring boot</span></div>
<div style="position:absolute;left:409.88px;top:238.55px" class="cls_105"><span class="cls_105">application</span></div>
<div style="position:absolute;left:405.59px;top:246.35px" class="cls_105"><span class="cls_105">(admin client)</span></div>
<div style="position:absolute;left:408.80px;top:272.40px" class="cls_105"><span class="cls_105">Spring boot</span></div>
<div style="position:absolute;left:211.85px;top:278.98px" class="cls_106"><span class="cls_106">Present as a web UI</span></div>
<div style="position:absolute;left:275.08px;top:279.15px" class="cls_105"><span class="cls_105">Spring boot</span><span class="cls_106">  </span><span class="cls_135"> Consumes Actuator endpoints</span></div>
<div style="position:absolute;left:409.88px;top:280.20px" class="cls_105"><span class="cls_105">application</span></div>
<div style="position:absolute;left:272.81px;top:286.95px" class="cls_105"><span class="cls_105">admin server</span></div>
<div style="position:absolute;left:405.59px;top:288.00px" class="cls_105"><span class="cls_105">(admin client)</span></div>
<div style="position:absolute;left:408.80px;top:314.20px" class="cls_105"><span class="cls_105">Spring boot</span></div>
<div style="position:absolute;left:409.88px;top:322.00px" class="cls_105"><span class="cls_105">application</span></div>
<div style="position:absolute;left:405.59px;top:329.80px" class="cls_105"><span class="cls_105">(admin client)</span></div>
<div style="position:absolute;left:93.18px;top:357.50px" class="cls_053"><span class="cls_053">Figure 17.1</span></div>
<div style="position:absolute;left:142.61px;top:357.50px" class="cls_053"><span class="cls_053">The Spring Boot Admin server consumes Actuator endpoints from one or more Spring</span></div>
<div style="position:absolute;left:93.18px;top:367.49px" class="cls_053"><span class="cls_053">Boot applications and presents the data in a web-based UI.</span></div>
<div style="position:absolute;left:93.18px;top:401.57px" class="cls_039"><span class="cls_039">You’ll need to register each of the applications (the microservices) that make up Taco</span></div>
<div style="position:absolute;left:93.18px;top:414.56px" class="cls_039"><span class="cls_039">Cloud as Spring Boot Admin clients. But first, you’ll set up the Spring Boot Admin</span></div>
<div style="position:absolute;left:93.18px;top:427.58px" class="cls_039"><span class="cls_039">server to receive each client’s Actuator information.</span></div>
<div style="position:absolute;left:57.18px;top:453.38px" class="cls_063"><span class="cls_063">17.1.1</span></div>
<div style="position:absolute;left:93.18px;top:453.38px" class="cls_063"><span class="cls_063">Creating an Admin server</span></div>
<div style="position:absolute;left:93.18px;top:471.08px" class="cls_039"><span class="cls_039">To enable the Admin server, you’ll first need to create a new Spring Boot application</span></div>
<div style="position:absolute;left:93.18px;top:484.07px" class="cls_039"><span class="cls_039">and add the Admin server dependency to the project’s build. The Admin server is gen-</span></div>
<div style="position:absolute;left:93.18px;top:497.06px" class="cls_039"><span class="cls_039">erally used as a standalone application, separate from any other application. Therefore,</span></div>
<div style="position:absolute;left:93.18px;top:510.08px" class="cls_039"><span class="cls_039">the easiest way to get started is to use the Spring Boot Initializr to create a new Spring</span></div>
<div style="position:absolute;left:93.18px;top:523.07px" class="cls_039"><span class="cls_039">Boot project and select the checkbox labeled Spring Boot Admin (Server). This results</span></div>
<div style="position:absolute;left:93.18px;top:536.06px" class="cls_039"><span class="cls_039">in the following dependency being included in the </span><span class="cls_059">&lt;dependencies&gt;</span><span class="cls_039"> block:</span></div>
<div style="position:absolute;left:93.18px;top:558.74px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:568.76px" class="cls_060"><span class="cls_060">&lt;groupId&gt;de.codecentric&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:578.75px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-boot-admin-starter-server&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:93.18px;top:588.74px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:299464px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background453.jpg" width="531" height="666"></div>
<div style="position:absolute;left:218.04px;top:24.35px" class="cls_055"><span class="cls_055">Using the Spring Boot Admin</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">431</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">Next, you’ll need to enable the Admin server by annotating the main configuration</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">class with </span><span class="cls_059">@EnableAdminServer</span><span class="cls_039"> as shown here:</span></div>
<div style="position:absolute;left:102.18px;top:83.33px" class="cls_060"><span class="cls_060">package tacos.bootadmin;</span></div>
<div style="position:absolute;left:102.18px;top:93.32px" class="cls_060"><span class="cls_060">import org.springframework.boot.SpringApplication;</span></div>
<div style="position:absolute;left:102.18px;top:103.34px" class="cls_060"><span class="cls_060">import org.springframework.boot.autoconfigure.SpringBootApplication;</span></div>
<div style="position:absolute;left:102.18px;top:113.33px" class="cls_060"><span class="cls_060">import de.codecentric.boot.admin.server.config.EnableAdminServer;</span></div>
<div style="position:absolute;left:102.18px;top:133.34px" class="cls_060"><span class="cls_060">@SpringBootApplication</span></div>
<div style="position:absolute;left:102.18px;top:143.33px" class="cls_060"><span class="cls_060">@EnableAdminServer</span></div>
<div style="position:absolute;left:102.18px;top:153.35px" class="cls_060"><span class="cls_060">public class BootAdminServerApplication {</span></div>
<div style="position:absolute;left:111.78px;top:163.34px" class="cls_060"><span class="cls_060">public static void main(String[] args) {</span></div>
<div style="position:absolute;left:121.38px;top:173.33px" class="cls_060"><span class="cls_060">SpringApplication.run(BootAdminServerApplication.class, args);</span></div>
<div style="position:absolute;left:111.78px;top:183.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:193.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:214.67px" class="cls_039"><span class="cls_039">Finally, because the Admin server won’t be the only application running locally as it’s</span></div>
<div style="position:absolute;left:102.18px;top:227.66px" class="cls_039"><span class="cls_039">developed, you should set it to listen in on a unique port, but one you can easily access</span></div>
<div style="position:absolute;left:102.18px;top:240.65px" class="cls_039"><span class="cls_039">(not port 0, for example). Here, I’ve chosen port 9090 as the port for the Spring Boot</span></div>
<div style="position:absolute;left:102.18px;top:253.67px" class="cls_039"><span class="cls_039">Admin server:</span></div>
<div style="position:absolute;left:102.18px;top:273.35px" class="cls_060"><span class="cls_060">server:</span></div>
<div style="position:absolute;left:111.78px;top:283.34px" class="cls_061"><span class="cls_061">port: 9090</span></div>
<div style="position:absolute;left:114.18px;top:304.67px" class="cls_083"><span class="cls_083">NOTE:</span><span class="cls_039">  As with any other service application in a microservice-architected</span></div>
<div style="position:absolute;left:114.18px;top:316.67px" class="cls_039"><span class="cls_039">Spring Boot application, the </span><span class="cls_042">server.port</span><span class="cls_039"> property can be set differently in</span></div>
<div style="position:absolute;left:114.18px;top:328.67px" class="cls_039"><span class="cls_039">a production profile, where the port may be determined by the underlying</span></div>
<div style="position:absolute;left:114.18px;top:340.67px" class="cls_039"><span class="cls_039">platform.</span></div>
<div style="position:absolute;left:102.18px;top:360.68px" class="cls_039"><span class="cls_039">Now your Admin server is ready. If you were to fire it up at this point and navigate to</span></div>
<div style="position:absolute;left:102.18px;top:373.67px" class="cls_045"><span class="cls_045"> </span><a href="http://localhost:9090/">http://localhost:9090</a> <span class="cls_039"> in your web browser, you’d see something a little like what’s</span></div>
<div style="position:absolute;left:102.18px;top:386.66px" class="cls_039"><span class="cls_039">shown in figure 17.2.</span></div>
<div style="position:absolute;left:117.30px;top:399.68px" class="cls_039"><span class="cls_039">As you can see, the Spring Boot Admin shows that zero instances of zero applica-</span></div>
<div style="position:absolute;left:102.18px;top:412.67px" class="cls_039"><span class="cls_039">tions are all up. But that’s meaningless information when you consider the message</span></div>
<div style="position:absolute;left:102.18px;top:425.66px" class="cls_039"><span class="cls_039">below those counts that states No Applications Registered. For the Admin server to be</span></div>
<div style="position:absolute;left:102.18px;top:438.68px" class="cls_039"><span class="cls_039">useful, you’ll need to register some applications with it.</span></div>
<div style="position:absolute;left:66.18px;top:460.49px" class="cls_063"><span class="cls_063">17.1.2</span></div>
<div style="position:absolute;left:102.18px;top:460.49px" class="cls_063"><span class="cls_063">Registering Admin clients</span></div>
<div style="position:absolute;left:102.18px;top:477.68px" class="cls_039"><span class="cls_039">Because the Admin server is an application separate from other Spring Boot applica-</span></div>
<div style="position:absolute;left:102.18px;top:490.67px" class="cls_039"><span class="cls_039">tion(s) for which it presents Actuator data, you must somehow make the Admin server</span></div>
<div style="position:absolute;left:102.18px;top:503.66px" class="cls_039"><span class="cls_039">aware of the applications it should display. Two ways to register Spring Boot Admin cli-</span></div>
<div style="position:absolute;left:102.18px;top:516.68px" class="cls_039"><span class="cls_039">ents with the Admin server follow:</span></div>
<div style="position:absolute;left:117.78px;top:533.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Each application explicitly registers itself with the Admin server.</span></div>
<div style="position:absolute;left:117.78px;top:547.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  The Admin server discovers services through the Eureka service registry.</span></div>
<div style="position:absolute;left:102.18px;top:565.67px" class="cls_039"><span class="cls_039">Let’s look at each option, starting with how to configure individual Boot applica-</span></div>
<div style="position:absolute;left:102.18px;top:578.69px" class="cls_039"><span class="cls_039">tions as Spring Boot Admin clients so that they can register themselves with the</span></div>
<div style="position:absolute;left:102.18px;top:591.68px" class="cls_039"><span class="cls_039">Admin server.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:300140px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background454.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">432</span></div>
<div style="position:absolute;left:198.60px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 17</span></div>
<div style="position:absolute;left:247.53px;top:24.35px" class="cls_055"><span class="cls_055">Administering Spring</span></div>
<div style="position:absolute;left:57.18px;top:277.64px" class="cls_053"><span class="cls_053">Figure 17.2</span></div>
<div style="position:absolute;left:106.61px;top:277.64px" class="cls_053"><span class="cls_053">A newly created server displayed in the Spring Boot Admin UI. No applications are registered yet.</span></div>
<div style="position:absolute;left:93.18px;top:307.10px" class="cls_064"><span class="cls_064">E</span><span class="cls_065">XPLICITLY</span><span class="cls_064"> </span><span class="cls_065">CONFIGURING</span><span class="cls_064"> A</span><span class="cls_065">DMIN</span><span class="cls_064"> </span><span class="cls_065">CLIENT</span><span class="cls_064"> </span><span class="cls_065">APPLICATIONS</span></div>
<div style="position:absolute;left:93.18px;top:319.43px" class="cls_039"><span class="cls_039">In order for a Spring Boot application to register itself as a client of the Admin server,</span></div>
<div style="position:absolute;left:93.18px;top:332.42px" class="cls_039"><span class="cls_039">you must include the Spring Boot Admin client starter in its build. You can easily add</span></div>
<div style="position:absolute;left:93.18px;top:345.41px" class="cls_039"><span class="cls_039">this dependency to your build by selecting the checkbox labeled Spring Boot Admin</span></div>
<div style="position:absolute;left:93.18px;top:358.43px" class="cls_039"><span class="cls_039">(Client) in the Initializr, or you can set the following </span><span class="cls_059">&lt;dependency&gt;</span><span class="cls_039"> for a Maven-built</span></div>
<div style="position:absolute;left:93.18px;top:371.42px" class="cls_039"><span class="cls_039">Spring Boot application:</span></div>
<div style="position:absolute;left:93.18px;top:391.10px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:102.78px;top:401.09px" class="cls_060"><span class="cls_060">&lt;groupId&gt;de.codecentric&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:102.78px;top:411.11px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-boot-admin-starter-client&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:93.18px;top:421.10px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
<div style="position:absolute;left:93.18px;top:444.41px" class="cls_039"><span class="cls_039">With the client-side library in place, you’ll also need to configure the location of the</span></div>
<div style="position:absolute;left:93.18px;top:457.43px" class="cls_039"><span class="cls_039">Admin server so that the client can register itself. To do that, you’ll set the </span><span class="cls_059">spring</span></div>
<div style="position:absolute;left:93.18px;top:470.42px" class="cls_059"><span class="cls_059">.boot.admin.client.url</span><span class="cls_039"> property to the root URL of the Admin server:</span></div>
<div style="position:absolute;left:93.18px;top:490.10px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:102.78px;top:500.09px" class="cls_060"><span class="cls_060">application:</span></div>
<div style="position:absolute;left:112.38px;top:510.11px" class="cls_060"><span class="cls_060">name: ingredient-service</span></div>
<div style="position:absolute;left:102.78px;top:520.10px" class="cls_060"><span class="cls_060">boot:</span></div>
<div style="position:absolute;left:112.38px;top:530.09px" class="cls_060"><span class="cls_060">admin:</span></div>
<div style="position:absolute;left:121.95px;top:540.11px" class="cls_060"><span class="cls_060">client:</span></div>
<div style="position:absolute;left:131.55px;top:550.10px" class="cls_061"><span class="cls_061">url: </span><a href="http://localhost:9090/">http://localhost:9090</a> </div>
<div style="position:absolute;left:93.18px;top:573.44px" class="cls_039"><span class="cls_039">Notice that the </span><span class="cls_059">spring.application.name</span><span class="cls_039"> property is also set (in this case, for the</span></div>
<div style="position:absolute;left:93.18px;top:586.43px" class="cls_039"><span class="cls_039">ingredient service). You’ve already used this property to identify microservices with</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:300816px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background455.jpg" width="531" height="666"></div>
<div style="position:absolute;left:218.04px;top:24.35px" class="cls_055"><span class="cls_055">Using the Spring Boot Admin</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">433</span></div>
<div style="position:absolute;left:66.18px;top:273.98px" class="cls_053"><span class="cls_053">Figure 17.3</span></div>
<div style="position:absolute;left:115.60px;top:273.98px" class="cls_053"><span class="cls_053">The Spring Boot Admin UI displays a single registered application.</span></div>
<div style="position:absolute;left:102.18px;top:307.55px" class="cls_039"><span class="cls_039">the Spring Cloud Config Server and with Eureka. Here it serves a similar purpose: to</span></div>
<div style="position:absolute;left:102.18px;top:320.57px" class="cls_039"><span class="cls_039">identify the application to the Admin server. Once you restart the application, you</span></div>
<div style="position:absolute;left:102.18px;top:333.56px" class="cls_039"><span class="cls_039">should see it appear in the Admin server as shown in figure 17.3.</span></div>
<div style="position:absolute;left:117.57px;top:346.55px" class="cls_039"><span class="cls_039">Although there isn’t much information about the ingredient service shown in</span></div>
<div style="position:absolute;left:102.18px;top:359.57px" class="cls_039"><span class="cls_039">figure 17.3, it does show the application’s uptime and if the Spring Boot Maven</span></div>
<div style="position:absolute;left:102.18px;top:372.56px" class="cls_039"><span class="cls_039">plugin has the build-info goal configured (as we discussed in section 16.3.1), the build</span></div>
<div style="position:absolute;left:102.18px;top:385.55px" class="cls_039"><span class="cls_039">version. Rest assured that there are plenty of other runtime details to see after you</span></div>
<div style="position:absolute;left:102.18px;top:398.57px" class="cls_039"><span class="cls_039">click the application in the Admin server. We’ll look deeper at what the Admin server</span></div>
<div style="position:absolute;left:102.18px;top:411.56px" class="cls_039"><span class="cls_039">has to offer in section 17.2.</span></div>
<div style="position:absolute;left:118.15px;top:424.55px" class="cls_039"><span class="cls_039">The same configuration used to register the ingredient service with the Admin</span></div>
<div style="position:absolute;left:102.18px;top:437.57px" class="cls_039"><span class="cls_039">server will need to be replicated across all applications. You may find it easier to only</span></div>
<div style="position:absolute;left:102.18px;top:450.56px" class="cls_039"><span class="cls_039">configure the </span><span class="cls_059">spring.application.name</span><span class="cls_039"> property and let the Spring Cloud Config</span></div>
<div style="position:absolute;left:102.18px;top:463.58px" class="cls_039"><span class="cls_039">Server serve the </span><span class="cls_059">spring.boot.admin.client.url</span><span class="cls_039"> to all of its clients. Or, better yet, if</span></div>
<div style="position:absolute;left:102.18px;top:476.57px" class="cls_039"><span class="cls_039">you’re already using Eureka as a service registry, then let the Admin server discover</span></div>
<div style="position:absolute;left:102.18px;top:489.56px" class="cls_039"><span class="cls_039">services on its own. Let’s see how to configure the Admin server as a Eureka client.</span></div>
<div style="position:absolute;left:102.18px;top:507.74px" class="cls_064"><span class="cls_064">D</span><span class="cls_065">ISCOVERING</span><span class="cls_064"> A</span><span class="cls_065">DMIN</span><span class="cls_064"> </span><span class="cls_065">CLIENTS</span></div>
<div style="position:absolute;left:102.18px;top:520.07px" class="cls_039"><span class="cls_039">The only thing you must do to enable the Admin server for discovery of services is to</span></div>
<div style="position:absolute;left:102.18px;top:533.06px" class="cls_039"><span class="cls_039">add the Spring Cloud Netflix Eureka Client starter to the Admin server’s build. Here’s</span></div>
<div style="position:absolute;left:102.18px;top:546.08px" class="cls_039"><span class="cls_039">the Maven </span><span class="cls_059">&lt;dependency&gt;</span><span class="cls_039"> you’ll need:</span></div>
<div style="position:absolute;left:102.18px;top:564.74px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:111.78px;top:574.76px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:111.78px;top:584.75px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:102.18px;top:594.74px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:301492px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background456.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">434</span></div>
<div style="position:absolute;left:198.60px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 17</span></div>
<div style="position:absolute;left:247.53px;top:24.35px" class="cls_055"><span class="cls_055">Administering Spring</span></div>
<div style="position:absolute;left:105.18px;top:50.66px" class="cls_083"><span class="cls_083">NOTE:</span><span class="cls_039">  You can also get this dependency by checking the Eureka Discovery</span></div>
<div style="position:absolute;left:105.18px;top:62.66px" class="cls_039"><span class="cls_039">checkbox in the Spring Initializr.</span></div>
<div style="position:absolute;left:93.18px;top:82.67px" class="cls_039"><span class="cls_039">If the Admin server is enabled as a Eureka client, then nothing else is required. You</span></div>
<div style="position:absolute;left:93.18px;top:95.66px" class="cls_039"><span class="cls_039">can skip all of the client configurations described in the previous section because the</span></div>
<div style="position:absolute;left:93.18px;top:108.65px" class="cls_039"><span class="cls_039">Admin server automatically discovers all applications registered in Eureka and makes</span></div>
<div style="position:absolute;left:93.18px;top:121.67px" class="cls_039"><span class="cls_039">their Actuator data available for display. For example, if there are several of the Taco</span></div>
<div style="position:absolute;left:93.18px;top:134.66px" class="cls_039"><span class="cls_039">Cloud services registered in Eureka, then they’ll also be shown in the Admin server</span></div>
<div style="position:absolute;left:93.18px;top:147.65px" class="cls_039"><span class="cls_039">(figure 17.4).</span></div>
<div style="position:absolute;left:57.18px;top:434.75px" class="cls_053"><span class="cls_053">Figure 17.4</span></div>
<div style="position:absolute;left:106.60px;top:434.75px" class="cls_053"><span class="cls_053">The Spring Boot Admin UI can show all the services it discovers in Eureka.</span></div>
<div style="position:absolute;left:93.18px;top:463.64px" class="cls_039"><span class="cls_039">As you can see in figure 17.4, there are four distinct applications listed, as well as a</span></div>
<div style="position:absolute;left:93.18px;top:476.63px" class="cls_039"><span class="cls_039">total of six services: two instances of the order service, two instances of the taco ser-</span></div>
<div style="position:absolute;left:93.18px;top:489.65px" class="cls_039"><span class="cls_039">vice, and one instance of each of the other applications. All applications shown are in</span></div>
<div style="position:absolute;left:93.18px;top:502.64px" class="cls_039"><span class="cls_039">the Up status. But if any service goes offline (the user service, for instance), then it</span></div>
<div style="position:absolute;left:93.18px;top:515.63px" class="cls_039"><span class="cls_039">may appear separately in the Admin server (figure 17.5).</span></div>
<div style="position:absolute;left:108.46px;top:528.65px" class="cls_039"><span class="cls_039">As a Eureka client, the Admin server also registers itself as a service with Eureka.</span></div>
<div style="position:absolute;left:93.18px;top:541.64px" class="cls_039"><span class="cls_039">To keep this from happening, you can set the </span><span class="cls_059">eureka.client.register-with-eureka</span></div>
<div style="position:absolute;left:93.18px;top:554.63px" class="cls_039"><span class="cls_039">property to </span><span class="cls_059">false</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:93.18px;top:574.31px" class="cls_060"><span class="cls_060">eureka:</span></div>
<div style="position:absolute;left:102.78px;top:584.33px" class="cls_060"><span class="cls_060">client:</span></div>
<div style="position:absolute;left:112.38px;top:594.32px" class="cls_061"><span class="cls_061">register-with-eureka: false</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:302168px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background457.jpg" width="531" height="666"></div>
<div style="position:absolute;left:221.28px;top:24.35px" class="cls_055"><span class="cls_055">Exploring the Admin server</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">435</span></div>
<div style="position:absolute;left:66.18px;top:326.48px" class="cls_053"><span class="cls_053">Figure 17.5</span></div>
<div style="position:absolute;left:115.61px;top:326.48px" class="cls_053"><span class="cls_053">The Spring Boot Admin UI shows offline services separately from those that are online.</span></div>
<div style="position:absolute;left:102.18px;top:356.30px" class="cls_039"><span class="cls_039">Like other Eureka clients, you can also configure the location of the Eureka server if</span></div>
<div style="position:absolute;left:102.18px;top:369.32px" class="cls_039"><span class="cls_039">it’s not listening at the default host and port. The following YAML configures the</span></div>
<div style="position:absolute;left:102.18px;top:382.31px" class="cls_039"><span class="cls_039">Eureka location with a host at eureka1.tacocloud.com:</span></div>
<div style="position:absolute;left:102.18px;top:404.00px" class="cls_060"><span class="cls_060">eureka:</span></div>
<div style="position:absolute;left:106.98px;top:413.99px" class="cls_060"><span class="cls_060">client:</span></div>
<div style="position:absolute;left:116.58px;top:423.98px" class="cls_060"><span class="cls_060">service-url:</span></div>
<div style="position:absolute;left:126.13px;top:434.00px" class="cls_061"><span class="cls_061">defaultZone: </span><a href="http://eureka1.tacocloud.com:8761/eureka/">http://eureka1.tacocloud.com:8761/eureka/</a> </div>
<div style="position:absolute;left:102.18px;top:458.30px" class="cls_039"><span class="cls_039">Now that you have a handful of the Taco Cloud services registered with the Admin</span></div>
<div style="position:absolute;left:102.18px;top:471.32px" class="cls_039"><span class="cls_039">server, let’s see what the Admin server has to offer.</span></div>
<div style="position:absolute;left:66.18px;top:496.48px" class="cls_040"><span class="cls_040">17.2</span></div>
<div style="position:absolute;left:102.18px;top:496.48px" class="cls_040"><span class="cls_040">Exploring the Admin server</span></div>
<div style="position:absolute;left:102.18px;top:515.81px" class="cls_039"><span class="cls_039">Once you’ve registered all of the Spring Boot applications as Admin server clients,</span></div>
<div style="position:absolute;left:102.18px;top:528.80px" class="cls_039"><span class="cls_039">there’s a wealth of information that the Admin server makes available for seeing</span></div>
<div style="position:absolute;left:102.18px;top:541.82px" class="cls_039"><span class="cls_039">what’s going on inside each application. This includes</span></div>
<div style="position:absolute;left:117.78px;top:561.83px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  General health and information</span></div>
<div style="position:absolute;left:117.78px;top:575.81px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Any metrics published through Micrometer and the /metrics endpoint</span></div>
<div style="position:absolute;left:117.78px;top:589.82px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Environment properties</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:302844px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background458.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">436</span></div>
<div style="position:absolute;left:198.60px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 17</span></div>
<div style="position:absolute;left:247.53px;top:24.35px" class="cls_055"><span class="cls_055">Administering Spring</span></div>
<div style="position:absolute;left:108.78px;top:50.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Logging levels for packages and classes</span></div>
<div style="position:absolute;left:108.78px;top:64.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Thread tracing details</span></div>
<div style="position:absolute;left:108.78px;top:78.65px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  HTTP traces for requests</span></div>
<div style="position:absolute;left:108.78px;top:92.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Audit logs</span></div>
<div style="position:absolute;left:93.18px;top:113.66px" class="cls_039"><span class="cls_039">In fact, almost anything that the Actuator exposes can be viewed in the Admin</span></div>
<div style="position:absolute;left:93.18px;top:126.65px" class="cls_039"><span class="cls_039">server, albeit in a much more human-friendly format. This includes graphs and fil-</span></div>
<div style="position:absolute;left:93.18px;top:139.67px" class="cls_039"><span class="cls_039">ters to help distill the information. The amount of information presented in the</span></div>
<div style="position:absolute;left:93.18px;top:152.66px" class="cls_039"><span class="cls_039">Admin server is far richer than the space we’ll have in this chapter to cover it in</span></div>
<div style="position:absolute;left:93.18px;top:165.65px" class="cls_039"><span class="cls_039">detail. But let me use the rest of this section to share a few of the highlights of the</span></div>
<div style="position:absolute;left:93.18px;top:178.67px" class="cls_039"><span class="cls_039">Admin server.</span></div>
<div style="position:absolute;left:57.18px;top:200.48px" class="cls_063"><span class="cls_063">17.2.1</span></div>
<div style="position:absolute;left:93.18px;top:200.48px" class="cls_063"><span class="cls_063">Viewing general application health and information</span></div>
<div style="position:absolute;left:93.18px;top:217.67px" class="cls_039"><span class="cls_039">As discussed in section 16.2.1, some of the most basic information provided by the</span></div>
<div style="position:absolute;left:93.18px;top:230.66px" class="cls_039"><span class="cls_039">Actuator is health and general application information via the /health and /info end-</span></div>
<div style="position:absolute;left:93.18px;top:243.65px" class="cls_039"><span class="cls_039">points. The Admin server displays that information under the Details tab as shown in</span></div>
<div style="position:absolute;left:93.18px;top:256.67px" class="cls_039"><span class="cls_039">figure 17.6.</span></div>
<div style="position:absolute;left:57.18px;top:584.39px" class="cls_053"><span class="cls_053">Figure 17.6</span></div>
<div style="position:absolute;left:106.59px;top:584.39px" class="cls_053"><span class="cls_053">The Details tab of the Spring Boot Admin UI displays general health and information about an</span></div>
<div style="position:absolute;left:57.18px;top:594.38px" class="cls_053"><span class="cls_053">application.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:303520px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background459.jpg" width="531" height="666"></div>
<div style="position:absolute;left:221.28px;top:24.35px" class="cls_055"><span class="cls_055">Exploring the Admin server</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">437</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">If you scroll past the Health and Info sections in the Details tab, you’ll find useful sta-</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">tistics from the application’s JVM, including graphs displaying memory, thread, and</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">processor usage (figure 17.7).</span></div>
<div style="position:absolute;left:66.18px;top:368.60px" class="cls_053"><span class="cls_053">Figure 17.7</span></div>
<div style="position:absolute;left:115.62px;top:368.60px" class="cls_053"><span class="cls_053">As you scroll down on the Details tab, you can view additional JVM internal information, including</span></div>
<div style="position:absolute;left:66.18px;top:378.59px" class="cls_053"><span class="cls_053">processor, thread, and memory statistics.</span></div>
<div style="position:absolute;left:102.18px;top:408.92px" class="cls_039"><span class="cls_039">The information displayed in the graphs, as well as the metrics under Processes and</span></div>
<div style="position:absolute;left:102.18px;top:421.91px" class="cls_039"><span class="cls_039">Garbage Collection Pauses, can provide useful insights into how your application uti-</span></div>
<div style="position:absolute;left:102.18px;top:434.93px" class="cls_039"><span class="cls_039">lizes JVM resources.</span></div>
<div style="position:absolute;left:66.18px;top:456.74px" class="cls_063"><span class="cls_063">17.2.2</span></div>
<div style="position:absolute;left:102.18px;top:456.74px" class="cls_063"><span class="cls_063">Watching key metrics</span></div>
<div style="position:absolute;left:102.18px;top:473.93px" class="cls_039"><span class="cls_039">The information presented by the /metrics endpoint is perhaps the least human-read-</span></div>
<div style="position:absolute;left:102.18px;top:486.92px" class="cls_039"><span class="cls_039">able of all of the Actuator’s endpoints. But the Admin server makes it easy for us mere</span></div>
<div style="position:absolute;left:102.18px;top:499.91px" class="cls_039"><span class="cls_039">mortals to consume the metrics produced in an application with its UI under the Met-</span></div>
<div style="position:absolute;left:102.18px;top:512.93px" class="cls_039"><span class="cls_039">rics tab.</span></div>
<div style="position:absolute;left:116.50px;top:525.92px" class="cls_039"><span class="cls_039">Initially, the Metrics tab doesn’t display any metrics whatsoever. But the form at the</span></div>
<div style="position:absolute;left:102.18px;top:538.94px" class="cls_039"><span class="cls_039">top lets you set up one or more watches on any metrics you want to keep an eye on.</span></div>
<div style="position:absolute;left:117.77px;top:551.93px" class="cls_039"><span class="cls_039">In figure 17.8, I’ve set up two watches on metrics under the http.server.requests</span></div>
<div style="position:absolute;left:102.18px;top:564.92px" class="cls_039"><span class="cls_039">category. The first reports metrics anytime an HTTP GET request is received for the</span></div>
<div style="position:absolute;left:102.18px;top:577.94px" class="cls_039"><span class="cls_039">/ingredients endpoint; the return status is 200 (OK). The second reports metrics for</span></div>
<div style="position:absolute;left:102.18px;top:590.93px" class="cls_039"><span class="cls_039">any request that results in an HTTP 400 (NOT FOUND) response.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:304196px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background460.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">438</span></div>
<div style="position:absolute;left:198.60px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 17</span></div>
<div style="position:absolute;left:247.53px;top:24.35px" class="cls_055"><span class="cls_055">Administering Spring</span></div>
<div style="position:absolute;left:57.18px;top:342.92px" class="cls_053"><span class="cls_053">Figure 17.8</span></div>
<div style="position:absolute;left:106.61px;top:342.92px" class="cls_053"><span class="cls_053">On the Metrics tab, you can set up watches on any metrics published through the application’s</span></div>
<div style="position:absolute;left:57.18px;top:352.91px" class="cls_053"><span class="cls_053">/metrics endpoint.</span></div>
<div style="position:absolute;left:93.18px;top:390.02px" class="cls_039"><span class="cls_039">What’s nice about these metrics (and, in fact, almost anything displayed in the Admin</span></div>
<div style="position:absolute;left:93.18px;top:403.04px" class="cls_039"><span class="cls_039">server) is that they show live data—they’ll automatically update without the need to</span></div>
<div style="position:absolute;left:93.18px;top:416.03px" class="cls_039"><span class="cls_039">refresh the page.</span></div>
<div style="position:absolute;left:57.18px;top:440.84px" class="cls_063"><span class="cls_063">17.2.3</span></div>
<div style="position:absolute;left:93.18px;top:440.84px" class="cls_063"><span class="cls_063">Examining environment properties</span></div>
<div style="position:absolute;left:93.18px;top:458.54px" class="cls_039"><span class="cls_039">The Actuator’s /env endpoint returns all environment properties available to a Spring</span></div>
<div style="position:absolute;left:93.18px;top:471.53px" class="cls_039"><span class="cls_039">Boot application from all of its property sources. And although the JSON response</span></div>
<div style="position:absolute;left:93.18px;top:484.52px" class="cls_039"><span class="cls_039">from the endpoint isn’t all that difficult to read, the Admin server presents it in a</span></div>
<div style="position:absolute;left:93.18px;top:497.54px" class="cls_039"><span class="cls_039">much more aesthetically pleasing form under the Environment tab (figure 17.9).</span></div>
<div style="position:absolute;left:108.93px;top:510.53px" class="cls_039"><span class="cls_039">Because there can be hundreds of properties, you can filter the list of available</span></div>
<div style="position:absolute;left:93.18px;top:523.52px" class="cls_039"><span class="cls_039">properties by either property name or value. Figure 17.9 shows properties filtered by</span></div>
<div style="position:absolute;left:93.18px;top:536.54px" class="cls_039"><span class="cls_039">those whose name and/or values contain the text “</span><span class="cls_036">spring.</span><span class="cls_039">”. The Admin server also</span></div>
<div style="position:absolute;left:93.18px;top:549.53px" class="cls_039"><span class="cls_039">allows you to set or override environment properties using the form under the Envi-</span></div>
<div style="position:absolute;left:93.18px;top:562.52px" class="cls_039"><span class="cls_039">ronment Manager header.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:304872px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background461.jpg" width="531" height="666"></div>
<div style="position:absolute;left:221.28px;top:24.35px" class="cls_055"><span class="cls_055">Exploring the Admin server</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">439</span></div>
<div style="position:absolute;left:66.18px;top:428.00px" class="cls_053"><span class="cls_053">Figure 17.9</span></div>
<div style="position:absolute;left:115.61px;top:428.00px" class="cls_053"><span class="cls_053">The Environment tab displays environment properties and includes options to override and filter</span></div>
<div style="position:absolute;left:66.18px;top:437.99px" class="cls_053"><span class="cls_053">those values.</span></div>
<div style="position:absolute;left:66.18px;top:472.61px" class="cls_063"><span class="cls_063">17.2.4</span></div>
<div style="position:absolute;left:102.18px;top:472.61px" class="cls_063"><span class="cls_063">Viewing and setting logging levels</span></div>
<div style="position:absolute;left:102.18px;top:490.28px" class="cls_039"><span class="cls_039">The Actuator’s /loggers endpoint is helpful in understanding and overriding logging</span></div>
<div style="position:absolute;left:102.18px;top:503.27px" class="cls_039"><span class="cls_039">levels in a running application. The Admin server’s Loggers tab adds an easy-to-use UI</span></div>
<div style="position:absolute;left:102.18px;top:516.29px" class="cls_039"><span class="cls_039">on top of the /loggers endpoint to make simple work of managing logging in an</span></div>
<div style="position:absolute;left:102.18px;top:529.28px" class="cls_039"><span class="cls_039">application. Figure 17.10 shows the list of loggers filtered by the name org.spring-</span></div>
<div style="position:absolute;left:102.18px;top:542.27px" class="cls_039"><span class="cls_039">framework.boot.</span></div>
<div style="position:absolute;left:117.84px;top:555.29px" class="cls_039"><span class="cls_039">By default, the Admin server displays logging levels for all packages and classes.</span></div>
<div style="position:absolute;left:102.18px;top:568.28px" class="cls_039"><span class="cls_039">Those can be filtered by name (for classes only) and/or logging levels that are explic-</span></div>
<div style="position:absolute;left:102.18px;top:581.27px" class="cls_039"><span class="cls_039">itly configured versus inherited from the root logger.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:305548px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background462.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">440</span></div>
<div style="position:absolute;left:198.60px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 17</span></div>
<div style="position:absolute;left:247.53px;top:24.35px" class="cls_055"><span class="cls_055">Administering Spring</span></div>
<div style="position:absolute;left:57.18px;top:309.92px" class="cls_053"><span class="cls_053">Figure 17.10</span></div>
<div style="position:absolute;left:111.40px;top:309.92px" class="cls_053"><span class="cls_053">The Loggers tab displays logging levels for packages and classes in the application and lets you</span></div>
<div style="position:absolute;left:57.18px;top:319.91px" class="cls_053"><span class="cls_053">override those levels.</span></div>
<div style="position:absolute;left:57.18px;top:361.52px" class="cls_063"><span class="cls_063">17.2.5</span></div>
<div style="position:absolute;left:93.18px;top:361.52px" class="cls_063"><span class="cls_063">Monitoring threads</span></div>
<div style="position:absolute;left:93.18px;top:379.19px" class="cls_039"><span class="cls_039">Many threads can run concurrently in any application. Although the /threaddump</span></div>
<div style="position:absolute;left:93.18px;top:392.21px" class="cls_039"><span class="cls_039">endpoint (described in section 16.2.3) provides a snapshot of the status of an applica-</span></div>
<div style="position:absolute;left:93.18px;top:405.20px" class="cls_039"><span class="cls_039">tion’s running threads, the Threads tab in the Spring Boot Admin UI keeps a live</span></div>
<div style="position:absolute;left:93.18px;top:418.19px" class="cls_039"><span class="cls_039">watch on all of the threads in an application (figure 17.11).</span></div>
<div style="position:absolute;left:110.05px;top:431.21px" class="cls_039"><span class="cls_039">Unlike the /threaddump endpoint that captures a snapshot in time, the bar</span></div>
<div style="position:absolute;left:93.18px;top:444.20px" class="cls_039"><span class="cls_039">graphs shown in the Threads tab are constantly updated, showing each thread’s status:</span></div>
<div style="position:absolute;left:93.18px;top:457.19px" class="cls_039"><span class="cls_039">green if the thread is runnable, yellow if it’s waiting, or red if the thread is blocked.</span></div>
<div style="position:absolute;left:107.80px;top:470.21px" class="cls_039"><span class="cls_039">To see more details about an individual thread, click the thread’s row in the list. It</span></div>
<div style="position:absolute;left:93.18px;top:483.20px" class="cls_039"><span class="cls_039">expands to display historical data about the thread, along with the thread’s current</span></div>
<div style="position:absolute;left:93.18px;top:496.22px" class="cls_039"><span class="cls_039">stack trace.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:306224px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background463.jpg" width="531" height="666"></div>
<div style="position:absolute;left:221.28px;top:24.35px" class="cls_055"><span class="cls_055">Exploring the Admin server</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">441</span></div>
<div style="position:absolute;left:66.18px;top:409.49px" class="cls_053"><span class="cls_053">Figure 17.11</span></div>
<div style="position:absolute;left:120.41px;top:409.49px" class="cls_053"><span class="cls_053">You can use the Threads tab in the Admin UI to keep a live watch on an application’s threads.</span></div>
<div style="position:absolute;left:66.18px;top:444.98px" class="cls_063"><span class="cls_063">17.2.6</span></div>
<div style="position:absolute;left:102.18px;top:444.98px" class="cls_063"><span class="cls_063">Tracing HTTP requests</span></div>
<div style="position:absolute;left:102.18px;top:462.17px" class="cls_039"><span class="cls_039">The Spring Boot Admin UI’s HTTP Trace tab (figure 17.12) presents data from the</span></div>
<div style="position:absolute;left:102.18px;top:475.16px" class="cls_039"><span class="cls_039">Actuator’s /httptrace endpoint. But unlike the /httptrace endpoint that returns the 100</span></div>
<div style="position:absolute;left:102.18px;top:488.18px" class="cls_039"><span class="cls_039">most recent HTTP traces at the time of the request, the HTTP Trace tab lists a complete</span></div>
<div style="position:absolute;left:102.18px;top:501.17px" class="cls_039"><span class="cls_039">history of HTTP requests. And it’s updated as long as you remain on the tab. If you leave</span></div>
<div style="position:absolute;left:102.18px;top:514.16px" class="cls_039"><span class="cls_039">the tab and come back, then it initially only shows the 100 most recent requests, but con-</span></div>
<div style="position:absolute;left:102.18px;top:527.18px" class="cls_039"><span class="cls_039">tinues tracing from that point on.</span></div>
<div style="position:absolute;left:116.77px;top:540.17px" class="cls_039"><span class="cls_039">As you can see, the HTTP Trace tab includes a stacked graph at the top that tracks</span></div>
<div style="position:absolute;left:102.18px;top:553.16px" class="cls_039"><span class="cls_039">HTTP traffic over time. The graph uses color to indicate successful versus unsuccessful</span></div>
<div style="position:absolute;left:102.18px;top:566.18px" class="cls_039"><span class="cls_039">requests. Green indicates success, yellow indicates client errors (for example, 400-level</span></div>
<div style="position:absolute;left:102.18px;top:579.17px" class="cls_039"><span class="cls_039">HTTP responses), and red indicates server errors (for example, 500-level HTTP</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:306900px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background464.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">442</span></div>
<div style="position:absolute;left:198.60px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 17</span></div>
<div style="position:absolute;left:247.53px;top:24.35px" class="cls_055"><span class="cls_055">Administering Spring</span></div>
<div style="position:absolute;left:57.18px;top:349.91px" class="cls_053"><span class="cls_053">Figure 17.12</span></div>
<div style="position:absolute;left:111.41px;top:349.91px" class="cls_053"><span class="cls_053">The HTTP Trace tab tracks recent HTTP traffic to an application, including information regarding</span></div>
<div style="position:absolute;left:57.18px;top:359.93px" class="cls_053"><span class="cls_053">requests that resulted in errors.</span></div>
<div style="position:absolute;left:93.18px;top:392.03px" class="cls_039"><span class="cls_039">responses). If you mouse over the graph, a hover-over box (like the one on the far</span></div>
<div style="position:absolute;left:93.18px;top:405.02px" class="cls_039"><span class="cls_039">right of figure 17.12) breaks down the request counts for a given point in time.</span></div>
<div style="position:absolute;left:108.22px;top:418.01px" class="cls_039"><span class="cls_039">Below the graph is the trace history, including a row for each request received by</span></div>
<div style="position:absolute;left:93.18px;top:431.03px" class="cls_039"><span class="cls_039">the application. If you click any row, the row expands to show additional information</span></div>
<div style="position:absolute;left:93.18px;top:444.02px" class="cls_039"><span class="cls_039">about the request, including any request and response headers (figure 17.13).</span></div>
<div style="position:absolute;left:57.18px;top:469.18px" class="cls_040"><span class="cls_040">17.3</span></div>
<div style="position:absolute;left:93.18px;top:469.18px" class="cls_040"><span class="cls_040">Securing the Admin server</span></div>
<div style="position:absolute;left:93.18px;top:488.54px" class="cls_039"><span class="cls_039">As we discussed in the previous chapter, the information exposed by the Actuator’s</span></div>
<div style="position:absolute;left:93.18px;top:501.53px" class="cls_039"><span class="cls_039">endpoints isn’t intended for general consumption. They contain information that</span></div>
<div style="position:absolute;left:93.18px;top:514.52px" class="cls_039"><span class="cls_039">exposes details about an application that only an application administrator should</span></div>
<div style="position:absolute;left:93.18px;top:527.54px" class="cls_039"><span class="cls_039">see. Moreover, some of the endpoints allow changes that certainly shouldn’t be</span></div>
<div style="position:absolute;left:93.18px;top:540.53px" class="cls_039"><span class="cls_039">exposed to just anyone.</span></div>
<div style="position:absolute;left:107.46px;top:553.52px" class="cls_039"><span class="cls_039">Just as security is important to the Actuator, it’s also important to the Admin server.</span></div>
<div style="position:absolute;left:93.18px;top:566.54px" class="cls_039"><span class="cls_039">What’s more, if the Actuator endpoints require authentication, then the Admin server</span></div>
<div style="position:absolute;left:93.18px;top:579.53px" class="cls_039"><span class="cls_039">needs to know the credentials to be able to access those endpoints. Let’s see how to</span></div>
<div style="position:absolute;left:93.18px;top:592.52px" class="cls_039"><span class="cls_039">add a little security to the Admin server. We’ll start by requiring authentication.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:307576px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background465.jpg" width="531" height="666"></div>
<div style="position:absolute;left:223.44px;top:24.35px" class="cls_055"><span class="cls_055">Securing the Admin server</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">443</span></div>
<div style="position:absolute;left:66.18px;top:390.35px" class="cls_053"><span class="cls_053">Figure 17.13</span></div>
<div style="position:absolute;left:120.40px;top:390.35px" class="cls_053"><span class="cls_053">Clicking a request entry on the HTTP Trace tab displays additional details about the request.</span></div>
<div style="position:absolute;left:66.18px;top:428.12px" class="cls_063"><span class="cls_063">17.3.1</span></div>
<div style="position:absolute;left:102.18px;top:428.12px" class="cls_063"><span class="cls_063">Enabling login in the Admin server</span></div>
<div style="position:absolute;left:102.18px;top:445.31px" class="cls_039"><span class="cls_039">It’s probably a good idea to add security to the Admin server as it’s not secured by</span></div>
<div style="position:absolute;left:102.18px;top:458.30px" class="cls_039"><span class="cls_039">default. Because the Admin server is a Spring Boot application, you can secure it</span></div>
<div style="position:absolute;left:102.18px;top:471.32px" class="cls_039"><span class="cls_039">using Spring Security just like you would any other Spring Boot application. And just</span></div>
<div style="position:absolute;left:102.18px;top:484.31px" class="cls_039"><span class="cls_039">as you would with any application secured by Spring Security, you’re free to decide</span></div>
<div style="position:absolute;left:102.18px;top:497.30px" class="cls_039"><span class="cls_039">which security scheme fits your needs best.</span></div>
<div style="position:absolute;left:116.98px;top:510.32px" class="cls_039"><span class="cls_039">At a minimum, you can add the Spring Boot security starter to the Admin server’s</span></div>
<div style="position:absolute;left:102.18px;top:523.31px" class="cls_039"><span class="cls_039">build by checking the Security checkbox in the Initializr or by adding the following</span></div>
<div style="position:absolute;left:102.18px;top:536.30px" class="cls_059"><span class="cls_059">&lt;dependency&gt;</span><span class="cls_039"> to the project’s pom.xml file:</span></div>
<div style="position:absolute;left:102.18px;top:555.98px" class="cls_060"><span class="cls_060">&lt;dependency&gt;</span></div>
<div style="position:absolute;left:111.78px;top:566.00px" class="cls_060"><span class="cls_060">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:111.78px;top:575.99px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:102.18px;top:585.98px" class="cls_061"><span class="cls_061">&lt;/dependency&gt;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:308252px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background466.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">444</span></div>
<div style="position:absolute;left:198.60px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 17</span></div>
<div style="position:absolute;left:247.53px;top:24.35px" class="cls_055"><span class="cls_055">Administering Spring</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">Then, so that you don’t have to keep looking at the Admin server’s logs for the ran-</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">domly generated password, you can configure a simple administrative username and</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">password in application.yml:</span></div>
<div style="position:absolute;left:93.18px;top:98.33px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:102.78px;top:108.32px" class="cls_060"><span class="cls_060">security:</span></div>
<div style="position:absolute;left:112.38px;top:118.34px" class="cls_060"><span class="cls_060">user:</span></div>
<div style="position:absolute;left:121.95px;top:128.33px" class="cls_060"><span class="cls_060">name: admin</span></div>
<div style="position:absolute;left:121.96px;top:138.35px" class="cls_061"><span class="cls_061">password: 53cr3t</span></div>
<div style="position:absolute;left:93.18px;top:162.65px" class="cls_039"><span class="cls_039">Now when the Admin server is loaded in the browser, you’ll be prompted for a user-</span></div>
<div style="position:absolute;left:93.18px;top:175.67px" class="cls_039"><span class="cls_039">name and password with Spring Security’s default login form. As in the code snippet,</span></div>
<div style="position:absolute;left:93.18px;top:188.66px" class="cls_039"><span class="cls_039">entering </span><span class="cls_059">admin</span><span class="cls_039"> and </span><span class="cls_059">53cr3t</span><span class="cls_039"> will get you in. Of course, this is an extremely basic secu-</span></div>
<div style="position:absolute;left:93.18px;top:201.65px" class="cls_039"><span class="cls_039">rity configuration. I recommend that you consult chapter 4 for ways of configuring</span></div>
<div style="position:absolute;left:93.18px;top:214.67px" class="cls_039"><span class="cls_039">Spring Security for a richer security scheme around the Admin server.</span></div>
<div style="position:absolute;left:57.18px;top:236.48px" class="cls_063"><span class="cls_063">17.3.2</span></div>
<div style="position:absolute;left:93.18px;top:236.48px" class="cls_063"><span class="cls_063">Authenticating with the Actuator</span></div>
<div style="position:absolute;left:93.18px;top:253.67px" class="cls_039"><span class="cls_039">In section 16.4, we discussed how to secure Actuator endpoints with HTTP Basic</span></div>
<div style="position:absolute;left:93.18px;top:266.66px" class="cls_039"><span class="cls_039">authentication. By doing so, you’ll be able to keep out everyone who doesn’t know</span></div>
<div style="position:absolute;left:93.18px;top:279.65px" class="cls_039"><span class="cls_039">the username and password you assigned to the Actuator endpoints. Unfortunately,</span></div>
<div style="position:absolute;left:93.18px;top:292.67px" class="cls_039"><span class="cls_039">that also means that the Admin server won’t be able to consume Actuator endpoints</span></div>
<div style="position:absolute;left:93.18px;top:305.66px" class="cls_039"><span class="cls_039">unless it provides the username and password. But how will the Admin server get</span></div>
<div style="position:absolute;left:93.18px;top:318.68px" class="cls_039"><span class="cls_039">those credentials?</span></div>
<div style="position:absolute;left:107.80px;top:331.67px" class="cls_039"><span class="cls_039">An Admin server client application can provide its credentials to the Admin server</span></div>
<div style="position:absolute;left:93.18px;top:344.66px" class="cls_039"><span class="cls_039">by either registering itself directly with the Admin server or by being discovered</span></div>
<div style="position:absolute;left:93.18px;top:357.68px" class="cls_039"><span class="cls_039">through Eureka. If the application registers directly with the Admin server, then it can</span></div>
<div style="position:absolute;left:93.18px;top:370.67px" class="cls_039"><span class="cls_039">send its credentials to the server at registration time. You’ll need to configure a few</span></div>
<div style="position:absolute;left:93.18px;top:383.66px" class="cls_039"><span class="cls_039">properties to enable that.</span></div>
<div style="position:absolute;left:107.85px;top:396.68px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">spring.boot.admin.client.instance.metadata.user.name</span><span class="cls_039"> and </span><span class="cls_059">spring.boot</span></div>
<div style="position:absolute;left:93.18px;top:409.67px" class="cls_059"><span class="cls_059">.admin.client.instance.metadata.user.password</span><span class="cls_039"> properties specify the credentials</span></div>
<div style="position:absolute;left:93.18px;top:422.66px" class="cls_039"><span class="cls_039">that the Admin server can use to access an application’s Actuator endpoints. The</span></div>
<div style="position:absolute;left:93.18px;top:435.68px" class="cls_039"><span class="cls_039">following snippet from application.yml shows how you might set those properties:</span></div>
<div style="position:absolute;left:93.18px;top:457.34px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:102.78px;top:467.36px" class="cls_060"><span class="cls_060">boot:</span></div>
<div style="position:absolute;left:112.38px;top:477.35px" class="cls_060"><span class="cls_060">admin:</span></div>
<div style="position:absolute;left:121.95px;top:487.34px" class="cls_060"><span class="cls_060">client:</span></div>
<div style="position:absolute;left:131.55px;top:497.36px" class="cls_060"><span class="cls_060">url: </span><a href="http://localhost:9090/">http://localhost:9090</a> </div>
<div style="position:absolute;left:131.55px;top:507.35px" class="cls_060"><span class="cls_060">instance:</span></div>
<div style="position:absolute;left:141.15px;top:517.34px" class="cls_060"><span class="cls_060">metadata:</span></div>
<div style="position:absolute;left:150.76px;top:527.36px" class="cls_060"><span class="cls_060">user.name: ${spring.security.user.name}</span></div>
<div style="position:absolute;left:150.76px;top:537.35px" class="cls_061"><span class="cls_061">user.password: ${spring.security.user.password}</span></div>
<div style="position:absolute;left:93.18px;top:561.68px" class="cls_039"><span class="cls_039">The username and password properties must be set in each application that regis-</span></div>
<div style="position:absolute;left:93.18px;top:574.67px" class="cls_039"><span class="cls_039">ters itself with the Admin server. The values given must match the username and</span></div>
<div style="position:absolute;left:93.18px;top:587.69px" class="cls_039"><span class="cls_039">password that’s required in an HTTP Basic authentication header to the Actuator</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:308928px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background467.jpg" width="531" height="666"></div>
<div style="position:absolute;left:253.20px;top:24.35px" class="cls_055"><span class="cls_055">Summary</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">445</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">endpoints. In this example, they’re set to </span><span class="cls_059">admin</span><span class="cls_039"> and </span><span class="cls_059">password</span><span class="cls_039">, which are the cre-</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">dentials configured to access the Actuator endpoints.</span></div>
<div style="position:absolute;left:118.75px;top:76.67px" class="cls_039"><span class="cls_039">On the other hand, if your application is discovered by the Admin server via</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">Eureka, then you’ll need to set </span><span class="cls_059">eureka.instance.metadata-map.user.name</span><span class="cls_039"> and</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_059"><span class="cls_059">eureka.instance.metadata-map.user.password</span><span class="cls_039"> instead:</span></div>
<div style="position:absolute;left:102.18px;top:122.33px" class="cls_060"><span class="cls_060">eureka:</span></div>
<div style="position:absolute;left:111.78px;top:132.35px" class="cls_060"><span class="cls_060">instance:</span></div>
<div style="position:absolute;left:121.38px;top:142.34px" class="cls_060"><span class="cls_060">metadata-map:</span></div>
<div style="position:absolute;left:130.95px;top:152.33px" class="cls_060"><span class="cls_060">user.name: admin</span></div>
<div style="position:absolute;left:130.95px;top:162.35px" class="cls_061"><span class="cls_061">user.password: password</span></div>
<div style="position:absolute;left:102.18px;top:183.65px" class="cls_039"><span class="cls_039">When the application registers with Eureka, the credentials will be included in the</span></div>
<div style="position:absolute;left:102.18px;top:196.67px" class="cls_039"><span class="cls_039">Eureka registration record’s metadata. When the Admin server discovers the application,</span></div>
<div style="position:absolute;left:102.18px;top:209.66px" class="cls_039"><span class="cls_039">it fetches the credentials from Eureka, along with other details about the application.</span></div>
<div style="position:absolute;left:102.18px;top:230.83px" class="cls_040"><span class="cls_040">Summary</span></div>
<div style="position:absolute;left:117.78px;top:249.17px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  The Spring Boot Admin server consumes the Actuator endpoints from one</span></div>
<div style="position:absolute;left:129.78px;top:262.16px" class="cls_039"><span class="cls_039">or more Spring Boot applications and presents the data in a user-friendly</span></div>
<div style="position:absolute;left:129.78px;top:275.15px" class="cls_039"><span class="cls_039">web application.</span></div>
<div style="position:absolute;left:117.78px;top:289.16px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Spring Boot applications can either register themselves as clients to the Admin</span></div>
<div style="position:absolute;left:129.78px;top:302.18px" class="cls_039"><span class="cls_039">server or the Admin server can discover them through Eureka.</span></div>
<div style="position:absolute;left:117.78px;top:316.16px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Unlike the Actuator endpoints that capture a snapshot of an application’s</span></div>
<div style="position:absolute;left:129.78px;top:329.18px" class="cls_039"><span class="cls_039">state, the Admin server is able to display a live view into the inner workings of</span></div>
<div style="position:absolute;left:129.78px;top:342.17px" class="cls_039"><span class="cls_039">an application.</span></div>
<div style="position:absolute;left:117.78px;top:356.18px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  The Admin server makes it easy to filter Actuator results and, in some cases, dis-</span></div>
<div style="position:absolute;left:129.78px;top:369.17px" class="cls_039"><span class="cls_039">play data visually in a graph.</span></div>
<div style="position:absolute;left:117.78px;top:383.18px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Because it’s a Spring Boot application, the Admin server can be secured by any</span></div>
<div style="position:absolute;left:129.78px;top:396.17px" class="cls_039"><span class="cls_039">means available through Spring Security.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:309604px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background468.jpg" width="531" height="666"></div>
<div style="position:absolute;left:243.18px;top:111.83px" class="cls_014"><span class="cls_014">Monitoring Spring</span></div>
<div style="position:absolute;left:348.78px;top:143.84px" class="cls_014"><span class="cls_014">with JMX</span></div>
<div style="position:absolute;left:84.18px;top:264.85px" class="cls_049"><span class="cls_049">This chapter covers</span></div>
<div style="position:absolute;left:84.18px;top:283.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Working with Actuator endpoint MBeans</span></div>
<div style="position:absolute;left:84.18px;top:298.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Exposing Spring beans as MBeans</span></div>
<div style="position:absolute;left:84.18px;top:313.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Publishing notifications</span></div>
<div style="position:absolute;left:102.18px;top:383.54px" class="cls_039"><span class="cls_039">For over a decade and a half, Java Management Extensions (JMX) has been the</span></div>
<div style="position:absolute;left:102.18px;top:396.53px" class="cls_039"><span class="cls_039">standard means of monitoring and managing Java applications. By exposing man-</span></div>
<div style="position:absolute;left:102.18px;top:409.55px" class="cls_039"><span class="cls_039">aged components known as MBeans (managed beans), an external JMX client can</span></div>
<div style="position:absolute;left:102.18px;top:422.54px" class="cls_039"><span class="cls_039">manage an application by invoking operations, inspecting properties, and monitor-</span></div>
<div style="position:absolute;left:102.18px;top:435.53px" class="cls_039"><span class="cls_039">ing events from MBeans.</span></div>
<div style="position:absolute;left:118.23px;top:448.55px" class="cls_039"><span class="cls_039">JMX is automatically enabled by default in a Spring Boot application. As a</span></div>
<div style="position:absolute;left:102.18px;top:461.54px" class="cls_039"><span class="cls_039">result, all of the Actuator endpoints are exposed as MBeans. And it sets us up</span></div>
<div style="position:absolute;left:102.18px;top:474.53px" class="cls_039"><span class="cls_039">nicely to expose any other bean in the Spring application context as an MBean.</span></div>
<div style="position:absolute;left:102.18px;top:487.55px" class="cls_039"><span class="cls_039">We’ll start exploring Spring and JMX by looking at how Actuator endpoints are</span></div>
<div style="position:absolute;left:102.18px;top:500.54px" class="cls_039"><span class="cls_039">exposed as MBeans.</span></div>
<div style="position:absolute;left:66.18px;top:525.70px" class="cls_040"><span class="cls_040">18.1</span></div>
<div style="position:absolute;left:102.18px;top:525.70px" class="cls_040"><span class="cls_040">Working with Actuator MBeans</span></div>
<div style="position:absolute;left:102.18px;top:545.06px" class="cls_039"><span class="cls_039">Take a look back at table 16.1. All of the Actuator endpoints listed there, except for</span></div>
<div style="position:absolute;left:102.18px;top:558.05px" class="cls_039"><span class="cls_039">/heapdump, are exposed as MBeans. You can use any JMX client you wish to connect</span></div>
<div style="position:absolute;left:257.16px;top:596.99px" class="cls_024"><span class="cls_024">446</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:310280px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background469.jpg" width="531" height="666"></div>
<div style="position:absolute;left:213.57px;top:24.35px" class="cls_055"><span class="cls_055">Working with Actuator MBeans</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">447</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">with Actuator endpoint MBeans. Using JConsole, which comes with the Java Develop-</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">ment Kit, you’ll find Actuator MBeans listed under the </span><span class="cls_059">org.springframework.boot</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">domain, as shown in figure 18.1.</span></div>
<div style="position:absolute;left:254.39px;top:239.12px" class="cls_081"><span class="cls_081">Actuator endpoint</span></div>
<div style="position:absolute;left:272.84px;top:248.63px" class="cls_081"><span class="cls_081">MBeans</span></div>
<div style="position:absolute;left:102.18px;top:394.34px" class="cls_053"><span class="cls_053">Figure 18.1</span></div>
<div style="position:absolute;left:151.61px;top:394.34px" class="cls_053"><span class="cls_053">Actuator endpoints are automatically exposed as JMX MBeans.</span></div>
<div style="position:absolute;left:102.18px;top:428.66px" class="cls_039"><span class="cls_039">One thing that’s nice about Actuator MBean endpoints is that they’re all exposed by</span></div>
<div style="position:absolute;left:102.18px;top:441.68px" class="cls_039"><span class="cls_039">default. There’s no need to explicitly include any of them, as you had to do with HTTP.</span></div>
<div style="position:absolute;left:102.18px;top:454.67px" class="cls_039"><span class="cls_039">You can, however, choose to narrow down the choices by setting </span><span class="cls_059">management.endpoints</span></div>
<div style="position:absolute;left:102.18px;top:467.66px" class="cls_059"><span class="cls_059">.jmx.exposure.include</span><span class="cls_039"> and </span><span class="cls_059">management.endpoints.jmx.exposure.exclude</span><span class="cls_039">. For</span></div>
<div style="position:absolute;left:102.18px;top:480.68px" class="cls_039"><span class="cls_039">example, to limit Actuator endpoint MBeans to only the /health, /info, /bean, and</span></div>
<div style="position:absolute;left:102.18px;top:493.67px" class="cls_039"><span class="cls_039">/conditions endpoints, set </span><span class="cls_059">management.endpoints.jmx.exposure.include</span><span class="cls_039"> like this:</span></div>
<div style="position:absolute;left:102.18px;top:515.36px" class="cls_060"><span class="cls_060">management:</span></div>
<div style="position:absolute;left:111.78px;top:525.35px" class="cls_060"><span class="cls_060">endpoints:</span></div>
<div style="position:absolute;left:121.38px;top:535.34px" class="cls_060"><span class="cls_060">jmx:</span></div>
<div style="position:absolute;left:130.95px;top:545.36px" class="cls_060"><span class="cls_060">exposure:</span></div>
<div style="position:absolute;left:140.56px;top:555.35px" class="cls_061"><span class="cls_061">include: health,info,bean,conditions</span></div>
<div style="position:absolute;left:102.18px;top:579.68px" class="cls_039"><span class="cls_039">Or, if there are only a few you want to exclude, you can set </span><span class="cls_059">management.endpoints</span></div>
<div style="position:absolute;left:102.18px;top:592.67px" class="cls_059"><span class="cls_059">.jmx.exposure.exclude</span><span class="cls_039"> like this:</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:310956px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background470.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">448</span></div>
<div style="position:absolute;left:185.04px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 18</span></div>
<div style="position:absolute;left:233.97px;top:24.35px" class="cls_055"><span class="cls_055">Monitoring Spring with JMX</span></div>
<div style="position:absolute;left:93.18px;top:51.32px" class="cls_060"><span class="cls_060">management:</span></div>
<div style="position:absolute;left:102.78px;top:61.34px" class="cls_060"><span class="cls_060">endpoints:</span></div>
<div style="position:absolute;left:112.38px;top:71.33px" class="cls_060"><span class="cls_060">jmx:</span></div>
<div style="position:absolute;left:121.95px;top:81.32px" class="cls_060"><span class="cls_060">exposure:</span></div>
<div style="position:absolute;left:131.53px;top:91.34px" class="cls_061"><span class="cls_061">exclude: env,metrics</span></div>
<div style="position:absolute;left:93.18px;top:114.65px" class="cls_039"><span class="cls_039">Here, you use </span><span class="cls_059">management.endpoints.jmx.exposure.exclude</span><span class="cls_039"> to exclude the /env</span></div>
<div style="position:absolute;left:93.18px;top:127.67px" class="cls_039"><span class="cls_039">and /metrics endpoints. All other Actuator endpoints will still be exposed as MBeans.</span></div>
<div style="position:absolute;left:108.61px;top:140.66px" class="cls_039"><span class="cls_039">To invoke the managed operations on one of the Actuator MBeans in JConsole,</span></div>
<div style="position:absolute;left:93.18px;top:153.65px" class="cls_039"><span class="cls_039">expand the endpoint MBean in the left-hand tree, and then select the desired opera-</span></div>
<div style="position:absolute;left:93.18px;top:166.67px" class="cls_039"><span class="cls_039">tion under Operations.</span></div>
<div style="position:absolute;left:108.51px;top:179.66px" class="cls_039"><span class="cls_039">For example, if you’d like to inspect the logging levels for the </span><span class="cls_059">tacos.ingredients</span></div>
<div style="position:absolute;left:93.18px;top:192.65px" class="cls_039"><span class="cls_039">package, expand the Loggers MBean and click on the operation named loggerLevels,</span></div>
<div style="position:absolute;left:93.18px;top:205.67px" class="cls_039"><span class="cls_039">as shown in figure 18.2. In the form at the top right, fill in the Name field with the</span></div>
<div style="position:absolute;left:93.18px;top:218.66px" class="cls_039"><span class="cls_039">package name (</span><span class="cls_059">tacos.ingredients</span><span class="cls_039">), and then click the loggerLevels button.</span></div>
<div style="position:absolute;left:353.66px;top:328.27px" class="cls_081"><span class="cls_081">Then, enter the</span></div>
<div style="position:absolute;left:355.67px;top:337.77px" class="cls_081"><span class="cls_081">package name</span></div>
<div style="position:absolute;left:360.81px;top:347.27px" class="cls_081"><span class="cls_081">and submit</span></div>
<div style="position:absolute;left:223.70px;top:451.78px" class="cls_081"><span class="cls_081">First, select</span></div>
<div style="position:absolute;left:220.08px;top:461.28px" class="cls_081"><span class="cls_081">the operation</span></div>
<div style="position:absolute;left:93.18px;top:508.13px" class="cls_053"><span class="cls_053">Figure 18.2</span></div>
<div style="position:absolute;left:142.61px;top:508.13px" class="cls_053"><span class="cls_053">Using JConsole to display logging levels from a Spring Boot application</span></div>
<div style="position:absolute;left:93.18px;top:545.09px" class="cls_039"><span class="cls_039">After you click the loggerLevels button, a dialog box will pop up showing you the</span></div>
<div style="position:absolute;left:93.18px;top:558.11px" class="cls_039"><span class="cls_039">response from the /loggers endpoint MBean. It might look a little like figure 18.3.</span></div>
<div style="position:absolute;left:107.85px;top:571.10px" class="cls_039"><span class="cls_039">Although the JConsole UI is a bit clumsy to work with, you should be able to get</span></div>
<div style="position:absolute;left:93.18px;top:584.12px" class="cls_039"><span class="cls_039">the hang of it and use it to explore any Actuator endpoint in much the same way.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:311632px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background471.jpg" width="531" height="666"></div>
<div style="position:absolute;left:221.37px;top:24.35px" class="cls_055"><span class="cls_055">Creating your own MBeans</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">449</span></div>
<div style="position:absolute;left:256.17px;top:112.52px" class="cls_053"><span class="cls_053">Figure 18.3</span></div>
<div style="position:absolute;left:305.58px;top:112.52px" class="cls_053"><span class="cls_053">Logging levels from the /loggers</span></div>
<div style="position:absolute;left:256.17px;top:122.54px" class="cls_053"><span class="cls_053">endpoint MBean displayed in JConsole</span></div>
<div style="position:absolute;left:102.18px;top:153.77px" class="cls_039"><span class="cls_039">If you don’t like JConsole, that’s fine—there are plenty of other JMX clients to</span></div>
<div style="position:absolute;left:102.18px;top:166.76px" class="cls_039"><span class="cls_039">choose from.</span></div>
<div style="position:absolute;left:66.18px;top:187.93px" class="cls_040"><span class="cls_040">18.2</span></div>
<div style="position:absolute;left:102.18px;top:187.93px" class="cls_040"><span class="cls_040">Creating your own MBeans</span></div>
<div style="position:absolute;left:102.18px;top:205.76px" class="cls_039"><span class="cls_039">Spring makes it easy to expose any bean you want as a JMX MBean. All you must do</span></div>
<div style="position:absolute;left:102.18px;top:218.78px" class="cls_039"><span class="cls_039">is annotate the bean class with </span><span class="cls_059">@ManagedResource</span><span class="cls_039"> and then annotate any methods</span></div>
<div style="position:absolute;left:102.18px;top:231.77px" class="cls_039"><span class="cls_039">or properties with </span><span class="cls_059">@ManagedOperation</span><span class="cls_039"> or </span><span class="cls_059">@ManagedAttribute</span><span class="cls_039">. Spring will take care</span></div>
<div style="position:absolute;left:102.18px;top:244.76px" class="cls_039"><span class="cls_039">of the rest.</span></div>
<div style="position:absolute;left:117.35px;top:257.78px" class="cls_039"><span class="cls_039">For example, suppose you want to provide an MBean that tracks how many tacos</span></div>
<div style="position:absolute;left:102.18px;top:270.77px" class="cls_039"><span class="cls_039">have been ordered through Taco Cloud. You can define a service bean that keeps a</span></div>
<div style="position:absolute;left:102.18px;top:283.76px" class="cls_039"><span class="cls_039">running count of how many tacos have been created. The following listing shows what</span></div>
<div style="position:absolute;left:102.18px;top:296.78px" class="cls_039"><span class="cls_039">such a service might look like.</span></div>
<div style="position:absolute;left:114.18px;top:323.48px" class="cls_066"><span class="cls_066">Listing 18.1</span></div>
<div style="position:absolute;left:171.66px;top:323.48px" class="cls_066"><span class="cls_066">An MBean that counts how many tacos have been created</span></div>
<div style="position:absolute;left:102.18px;top:345.35px" class="cls_060"><span class="cls_060">package tacos.tacos;</span></div>
<div style="position:absolute;left:102.18px;top:355.34px" class="cls_060"><span class="cls_060">import java.util.concurrent.atomic.AtomicLong;</span></div>
<div style="position:absolute;left:102.18px;top:365.36px" class="cls_060"><span class="cls_060">import</span></div>
<div style="position:absolute;left:126.18px;top:375.35px" class="cls_060"><span class="cls_060">org.springframework.data.rest.core.event.AbstractRepositoryEventListener;</span></div>
<div style="position:absolute;left:102.18px;top:385.34px" class="cls_060"><span class="cls_060">import org.springframework.jmx.export.annotation.ManagedAttribute;</span></div>
<div style="position:absolute;left:102.18px;top:395.36px" class="cls_060"><span class="cls_060">import org.springframework.jmx.export.annotation.ManagedOperation;</span></div>
<div style="position:absolute;left:102.18px;top:405.35px" class="cls_060"><span class="cls_060">import org.springframework.jmx.export.annotation.ManagedResource;</span></div>
<div style="position:absolute;left:102.18px;top:415.34px" class="cls_060"><span class="cls_060">import org.springframework.stereotype.Service;</span></div>
<div style="position:absolute;left:102.18px;top:435.35px" class="cls_060"><span class="cls_060">@Service</span></div>
<div style="position:absolute;left:102.18px;top:445.34px" class="cls_060"><span class="cls_060">@ManagedResource</span></div>
<div style="position:absolute;left:102.18px;top:455.36px" class="cls_060"><span class="cls_060">public class TacoCounter</span></div>
<div style="position:absolute;left:135.76px;top:465.35px" class="cls_060"><span class="cls_060">extends AbstractRepositoryEventListener&lt;Taco&gt; {</span></div>
<div style="position:absolute;left:111.78px;top:485.36px" class="cls_060"><span class="cls_060">private AtomicLong counter;</span></div>
<div style="position:absolute;left:111.78px;top:505.34px" class="cls_060"><span class="cls_060">public TacoCounter(TacoRepository tacoRepo) {</span></div>
<div style="position:absolute;left:121.38px;top:515.36px" class="cls_060"><span class="cls_060">long initialCount = tacoRepo.count();</span></div>
<div style="position:absolute;left:121.38px;top:525.35px" class="cls_060"><span class="cls_060">this.counter = new AtomicLong(initialCount);</span></div>
<div style="position:absolute;left:111.78px;top:535.34px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:557.36px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:111.78px;top:567.35px" class="cls_060"><span class="cls_060">protected void onAfterCreate(Taco entity) {</span></div>
<div style="position:absolute;left:121.38px;top:577.37px" class="cls_060"><span class="cls_060">counter.incrementAndGet();</span></div>
<div style="position:absolute;left:111.78px;top:587.36px" class="cls_060"><span class="cls_060">}</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:312308px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background472.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">450</span></div>
<div style="position:absolute;left:185.04px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 18</span></div>
<div style="position:absolute;left:233.97px;top:24.35px" class="cls_055"><span class="cls_055">Monitoring Spring with JMX</span></div>
<div style="position:absolute;left:102.78px;top:51.32px" class="cls_060"><span class="cls_060">@ManagedAttribute</span></div>
<div style="position:absolute;left:102.78px;top:61.34px" class="cls_060"><span class="cls_060">public long getTacoCount() {</span></div>
<div style="position:absolute;left:112.38px;top:71.33px" class="cls_060"><span class="cls_060">return counter.get();</span></div>
<div style="position:absolute;left:102.78px;top:81.32px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.78px;top:101.33px" class="cls_060"><span class="cls_060">@ManagedOperation</span></div>
<div style="position:absolute;left:102.78px;top:111.32px" class="cls_060"><span class="cls_060">public long increment(long delta) {</span></div>
<div style="position:absolute;left:112.38px;top:121.34px" class="cls_060"><span class="cls_060">return counter.addAndGet(delta);</span></div>
<div style="position:absolute;left:102.78px;top:131.33px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:141.35px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:165.65px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">TacoCounter</span><span class="cls_039"> class is annotated with </span><span class="cls_059">@Service</span><span class="cls_039"> so that it will be picked up by</span></div>
<div style="position:absolute;left:93.18px;top:178.67px" class="cls_039"><span class="cls_039">component scanning, and an instance will be registered as a bean in the Spring</span></div>
<div style="position:absolute;left:93.18px;top:191.66px" class="cls_039"><span class="cls_039">application context. But it’s also annotated with </span><span class="cls_059">@ManagedResource</span><span class="cls_039"> to indicate that</span></div>
<div style="position:absolute;left:93.18px;top:204.65px" class="cls_039"><span class="cls_039">this bean should also be an MBean. As an MBean, it will expose one attribute and</span></div>
<div style="position:absolute;left:93.18px;top:217.67px" class="cls_039"><span class="cls_039">one operation. The </span><span class="cls_059">getTacoCount()</span><span class="cls_039"> method is annotated with </span><span class="cls_059">@ManagedAttribute</span></div>
<div style="position:absolute;left:93.18px;top:230.66px" class="cls_039"><span class="cls_039">so that it will be exposed as an MBean attribute, while the </span><span class="cls_059">increment()</span><span class="cls_039"> method is</span></div>
<div style="position:absolute;left:93.18px;top:243.65px" class="cls_039"><span class="cls_039">annotated with </span><span class="cls_059">@ManagedOperation</span><span class="cls_039">, exposing it as an MBean operation.</span></div>
<div style="position:absolute;left:107.78px;top:256.67px" class="cls_039"><span class="cls_039">Figure 18.4 shows how the </span><span class="cls_059">TacoCounter</span><span class="cls_039"> MBean appears in JConsole.</span></div>
<div style="position:absolute;left:57.18px;top:544.34px" class="cls_053"><span class="cls_053">Figure 18.4</span></div>
<div style="position:absolute;left:106.59px;top:544.04px" class="cls_087"><span class="cls_087">TacoCounter</span><span class="cls_053">’s operations and attributes as seen in JConsole</span></div>
<div style="position:absolute;left:93.18px;top:575.15px" class="cls_059"><span class="cls_059">TacoCounter</span><span class="cls_039"> has another trick up its sleeve, although it has nothing to do with JMX.</span></div>
<div style="position:absolute;left:93.18px;top:588.14px" class="cls_039"><span class="cls_039">Because it extends </span><span class="cls_059">AbstractRepositoryEventListener</span><span class="cls_039">, it will be notified of any</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:312984px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background473.jpg" width="531" height="666"></div>
<div style="position:absolute;left:232.98px;top:24.35px" class="cls_055"><span class="cls_055">Sending notifications</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">451</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">persistence events when a </span><span class="cls_059">Taco</span><span class="cls_039"> is saved through </span><span class="cls_059">TacoRepository</span><span class="cls_039">. In this particular</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">case, the </span><span class="cls_059">onAfterCreate()</span><span class="cls_039"> method will be invoked anytime a new </span><span class="cls_059">Taco</span><span class="cls_039"> object is cre-</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">ated and saved, and it will increment the counter by one. But </span><span class="cls_059">AbstractRepository-</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_059"><span class="cls_059">EventListener</span><span class="cls_039"> also offers several methods for handling events both before and after</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">objects are created, saved, or deleted.</span></div>
<div style="position:absolute;left:117.00px;top:115.67px" class="cls_039"><span class="cls_039">Working with MBean operations and attributes is largely a pull operation. That is,</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">even if the value of an MBean attribute changes, you won’t know until you view the</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">attribute through a JMX client. Let’s turn the tables and see how you can push notifi-</span></div>
<div style="position:absolute;left:102.18px;top:154.67px" class="cls_039"><span class="cls_039">cations from an MBean to a JMX client.</span></div>
<div style="position:absolute;left:66.18px;top:178.84px" class="cls_040"><span class="cls_040">18.3</span></div>
<div style="position:absolute;left:102.18px;top:178.84px" class="cls_040"><span class="cls_040">Sending notifications</span></div>
<div style="position:absolute;left:102.18px;top:198.17px" class="cls_039"><span class="cls_039">MBeans can push notifications to interested JMX clients with Spring’s </span><span class="cls_059">Notification-</span></div>
<div style="position:absolute;left:102.18px;top:211.16px" class="cls_059"><span class="cls_059">Publisher</span><span class="cls_039">. </span><span class="cls_059">NotificationPublisher</span><span class="cls_039"> has a single </span><span class="cls_059">sendNotification()</span><span class="cls_039"> method that,</span></div>
<div style="position:absolute;left:102.18px;top:224.15px" class="cls_039"><span class="cls_039">when given a </span><span class="cls_059">Notification</span><span class="cls_039"> object, publishes the notification to any JMX clients that</span></div>
<div style="position:absolute;left:102.18px;top:237.17px" class="cls_039"><span class="cls_039">have subscribed to the MBean.</span></div>
<div style="position:absolute;left:119.58px;top:250.16px" class="cls_039"><span class="cls_039">For an MBean to be able to publish notifications, it must implement the</span></div>
<div style="position:absolute;left:102.18px;top:263.15px" class="cls_059"><span class="cls_059">NotificationPublisherAware</span><span class="cls_039"> interface, which requires that a </span><span class="cls_059">setNotification-</span></div>
<div style="position:absolute;left:102.27px;top:276.17px" class="cls_059"><span class="cls_059">Publisher()</span><span class="cls_039"> method be implemented. For example, suppose you want to publish a</span></div>
<div style="position:absolute;left:102.18px;top:289.16px" class="cls_039"><span class="cls_039">notification every for every 100 tacos that are created. You can change the </span><span class="cls_059">TacoCounter</span></div>
<div style="position:absolute;left:102.18px;top:302.18px" class="cls_039"><span class="cls_039">class so that it implements </span><span class="cls_059">NotificationPublisherAware</span><span class="cls_039"> and uses the injected</span></div>
<div style="position:absolute;left:102.18px;top:315.17px" class="cls_059"><span class="cls_059">NotificationPublisher</span><span class="cls_039"> to send notifications for every 100 tacos that are created. The</span></div>
<div style="position:absolute;left:102.18px;top:328.16px" class="cls_039"><span class="cls_039">following listing shows the changes that must be made to </span><span class="cls_059">TacoCounter</span><span class="cls_039"> to enable such</span></div>
<div style="position:absolute;left:102.18px;top:341.18px" class="cls_039"><span class="cls_039">notifications.</span></div>
<div style="position:absolute;left:114.18px;top:364.88px" class="cls_066"><span class="cls_066">Listing 18.2</span></div>
<div style="position:absolute;left:171.68px;top:364.88px" class="cls_066"><span class="cls_066">Sending notifications for every 100 tacos</span></div>
<div style="position:absolute;left:102.18px;top:384.74px" class="cls_060"><span class="cls_060">@Service</span></div>
<div style="position:absolute;left:102.18px;top:394.76px" class="cls_060"><span class="cls_060">@ManagedResource</span></div>
<div style="position:absolute;left:102.18px;top:404.75px" class="cls_060"><span class="cls_060">public class TacoCounter</span></div>
<div style="position:absolute;left:135.76px;top:414.74px" class="cls_060"><span class="cls_060">extends AbstractRepositoryEventListener&lt;Taco&gt;</span></div>
<div style="position:absolute;left:135.73px;top:424.76px" class="cls_060"><span class="cls_060">implements NotificationPublisherAware {</span></div>
<div style="position:absolute;left:111.78px;top:446.75px" class="cls_060"><span class="cls_060">private AtomicLong counter;</span></div>
<div style="position:absolute;left:111.78px;top:456.74px" class="cls_060"><span class="cls_060">private NotificationPublisher np;</span></div>
<div style="position:absolute;left:111.78px;top:498.74px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:111.78px;top:508.76px" class="cls_060"><span class="cls_060">public void setNotificationPublisher(NotificationPublisher np) {</span></div>
<div style="position:absolute;left:121.38px;top:518.75px" class="cls_060"><span class="cls_060">this.np = np;</span></div>
<div style="position:absolute;left:111.78px;top:528.74px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:111.78px;top:570.74px" class="cls_060"><span class="cls_060">@ManagedOperation</span></div>
<div style="position:absolute;left:111.78px;top:580.76px" class="cls_060"><span class="cls_060">public long increment(long delta) {</span></div>
<div style="position:absolute;left:121.36px;top:590.75px" class="cls_060"><span class="cls_060">long before = counter.get();</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:313660px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background474.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">452</span></div>
<div style="position:absolute;left:185.04px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 18</span></div>
<div style="position:absolute;left:233.97px;top:24.35px" class="cls_055"><span class="cls_055">Monitoring Spring with JMX</span></div>
<div style="position:absolute;left:112.36px;top:51.32px" class="cls_060"><span class="cls_060">long after = counter.addAndGet(delta);</span></div>
<div style="position:absolute;left:112.37px;top:61.34px" class="cls_060"><span class="cls_060">if ((after / 100) &gt; (before / 100)) {</span></div>
<div style="position:absolute;left:121.97px;top:71.33px" class="cls_060"><span class="cls_060">Notification notification = new Notification(</span></div>
<div style="position:absolute;left:141.16px;top:81.32px" class="cls_060"><span class="cls_060">"taco.count", this,</span></div>
<div style="position:absolute;left:141.15px;top:91.34px" class="cls_060"><span class="cls_060">before, after + "th taco created!");</span></div>
<div style="position:absolute;left:121.95px;top:101.33px" class="cls_060"><span class="cls_060">np.sendNotification(notification);</span></div>
<div style="position:absolute;left:112.38px;top:111.32px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:112.38px;top:131.33px" class="cls_060"><span class="cls_060">return after;</span></div>
<div style="position:absolute;left:102.78px;top:141.35px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:93.18px;top:151.34px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:93.18px;top:172.67px" class="cls_039"><span class="cls_039">In the JMX client, you’ll need to subscribe to the </span><span class="cls_059">TacoCounter</span><span class="cls_039"> MBean to receive noti-</span></div>
<div style="position:absolute;left:93.18px;top:185.66px" class="cls_039"><span class="cls_039">fications. Then, as tacos are created, the client will receive notifications for each cen-</span></div>
<div style="position:absolute;left:93.18px;top:198.65px" class="cls_039"><span class="cls_039">tury count. Figure 18.5 shows how the notifications may appear in JConsole.</span></div>
<div style="position:absolute;left:57.18px;top:446.99px" class="cls_053"><span class="cls_053">Figure 18.5</span></div>
<div style="position:absolute;left:106.34px;top:446.69px" class="cls_053"><span class="cls_053">JConsole, subscribed to the </span><span class="cls_087">TacoCounter</span><span class="cls_053"> MBean, receives a notification for every 100 tacos that</span></div>
<div style="position:absolute;left:57.18px;top:456.98px" class="cls_053"><span class="cls_053">are created.</span></div>
<div style="position:absolute;left:93.18px;top:492.02px" class="cls_039"><span class="cls_039">Notifications are a great way for an application to actively send data and alerts to a</span></div>
<div style="position:absolute;left:93.18px;top:505.04px" class="cls_039"><span class="cls_039">monitoring client without requiring the client to poll managed attributes or invoke</span></div>
<div style="position:absolute;left:93.18px;top:518.03px" class="cls_039"><span class="cls_039">managed operations.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:314336px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background475.jpg" width="531" height="666"></div>
<div style="position:absolute;left:253.20px;top:24.35px" class="cls_055"><span class="cls_055">Summary</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">453</span></div>
<div style="position:absolute;left:102.18px;top:49.81px" class="cls_040"><span class="cls_040">Summary</span></div>
<div style="position:absolute;left:117.78px;top:68.15px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Most Actuator endpoints are available as MBeans that can be consumed using</span></div>
<div style="position:absolute;left:129.78px;top:81.17px" class="cls_039"><span class="cls_039">any JMX client.</span></div>
<div style="position:absolute;left:117.78px;top:95.15px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Spring automatically enables JMX for monitoring beans in the Spring applica-</span></div>
<div style="position:absolute;left:129.78px;top:108.17px" class="cls_039"><span class="cls_039">tion context.</span></div>
<div style="position:absolute;left:117.78px;top:122.15px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Spring beans can be exposed as MBeans by annotating them with </span><span class="cls_059">@Managed-</span></div>
<div style="position:absolute;left:129.78px;top:135.17px" class="cls_059"><span class="cls_059">Resource</span><span class="cls_039">. Their methods and properties can be exposed as managed opera-</span></div>
<div style="position:absolute;left:129.78px;top:148.16px" class="cls_039"><span class="cls_039">tions and attributes by annotating the bean class with </span><span class="cls_059">@ManagedOperation</span><span class="cls_039"> and</span></div>
<div style="position:absolute;left:129.78px;top:161.15px" class="cls_059"><span class="cls_059">@ManagedAttribute</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:117.78px;top:175.16px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Spring beans can publish notifications to JMX clients using </span><span class="cls_059">Notification-</span></div>
<div style="position:absolute;left:129.78px;top:188.15px" class="cls_059"><span class="cls_059">Publisher</span><span class="cls_039">.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:315012px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background476.jpg" width="531" height="666"></div>
<div style="position:absolute;left:262.38px;top:111.83px" class="cls_014"><span class="cls_014">Deploying Spring</span></div>
<div style="position:absolute;left:84.18px;top:264.85px" class="cls_049"><span class="cls_049">This chapter covers</span></div>
<div style="position:absolute;left:84.18px;top:283.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Building Spring applications as either WAR or</span></div>
<div style="position:absolute;left:96.18px;top:295.55px" class="cls_051"><span class="cls_051">JAR files</span></div>
<div style="position:absolute;left:84.18px;top:310.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Pushing Spring applications to Cloud Foundry</span></div>
<div style="position:absolute;left:84.18px;top:325.55px" class="cls_050"><span class="cls_050"></span><span class="cls_051">  Containerizing Spring applications with Docker</span></div>
<div style="position:absolute;left:102.18px;top:395.54px" class="cls_039"><span class="cls_039">Think of your favorite action movie. Now imagine going to see that movie in the</span></div>
<div style="position:absolute;left:102.18px;top:408.53px" class="cls_039"><span class="cls_039">theater and being taken on a thrilling audiovisual ride with high-speed chases,</span></div>
<div style="position:absolute;left:102.18px;top:421.55px" class="cls_039"><span class="cls_039">explosions, and battles, only to have it come to a sudden halt before the good guys</span></div>
<div style="position:absolute;left:102.18px;top:434.54px" class="cls_039"><span class="cls_039">take down the bad guys. Instead of seeing the movie’s conflict resolved, when the</span></div>
<div style="position:absolute;left:102.18px;top:447.53px" class="cls_039"><span class="cls_039">theater lights come on, everyone is ushered out the door. Although the lead-up was</span></div>
<div style="position:absolute;left:102.18px;top:460.55px" class="cls_039"><span class="cls_039">exciting, it’s the climax of the movie that’s important. Without it, it’s action for</span></div>
<div style="position:absolute;left:102.18px;top:473.54px" class="cls_039"><span class="cls_039">action’s sake.</span></div>
<div style="position:absolute;left:117.45px;top:486.56px" class="cls_039"><span class="cls_039">Now imagine developing applications and putting a lot of effort and creativity</span></div>
<div style="position:absolute;left:102.18px;top:499.55px" class="cls_039"><span class="cls_039">into solving the business problem, but then never deploying the application for</span></div>
<div style="position:absolute;left:102.18px;top:512.54px" class="cls_039"><span class="cls_039">others to use and enjoy. Sure, most applications we write don’t involve car chases or</span></div>
<div style="position:absolute;left:102.18px;top:525.56px" class="cls_039"><span class="cls_039">explosions (at least I hope not), but there’s a certain rush you get along the way.</span></div>
<div style="position:absolute;left:102.18px;top:538.55px" class="cls_039"><span class="cls_039">Not every line of code you write is destined for production, but it’d be a big let-</span></div>
<div style="position:absolute;left:102.18px;top:551.54px" class="cls_039"><span class="cls_039">down if none of it ever was deployed.</span></div>
<div style="position:absolute;left:257.16px;top:596.99px" class="cls_024"><span class="cls_024">454</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:315688px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background477.jpg" width="531" height="666"></div>
<div style="position:absolute;left:218.04px;top:24.35px" class="cls_055"><span class="cls_055">Weighing deployment options</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">455</span></div>
<div style="position:absolute;left:117.33px;top:50.66px" class="cls_039"><span class="cls_039">Up to this point, we’ve focused on using the features of Spring Boot that help us</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">develop an application. There have been some exciting steps along the way. But it’s all</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">for nothing if you don’t cross the finish line and deploy the application.</span></div>
<div style="position:absolute;left:117.84px;top:89.66px" class="cls_039"><span class="cls_039">In this chapter, we’re going to step beyond developing applications with Spring</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">Boot and look at how to deploy those applications. Although this may seem obvious</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">for anyone who has ever deployed a Java-based application, there are some unique</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">features of Spring Boot and related Spring projects you can draw on that make</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">deploying Spring Boot applications unique.</span></div>
<div style="position:absolute;left:116.70px;top:154.67px" class="cls_039"><span class="cls_039">In fact, unlike most Java web applications, which are typically deployed to an appli-</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">cation server as WAR files, Spring Boot offers several deployment options. Before we</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">look at how to deploy a Spring Boot application, let’s consider all the options and</span></div>
<div style="position:absolute;left:102.18px;top:193.67px" class="cls_039"><span class="cls_039">choose a few that suit your needs best.</span></div>
<div style="position:absolute;left:66.18px;top:218.83px" class="cls_040"><span class="cls_040">19.1</span></div>
<div style="position:absolute;left:102.18px;top:218.83px" class="cls_040"><span class="cls_040">Weighing deployment options</span></div>
<div style="position:absolute;left:102.18px;top:238.16px" class="cls_039"><span class="cls_039">You can build and run Spring Boot applications in several ways. The appendix covers</span></div>
<div style="position:absolute;left:102.18px;top:251.15px" class="cls_039"><span class="cls_039">many of them, including these:</span></div>
<div style="position:absolute;left:117.78px;top:270.17px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Running the application in the IDE with either Spring Tool Suite or IntelliJ IDEA</span></div>
<div style="position:absolute;left:117.78px;top:284.15px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Running the application from the command line using the Maven </span><span class="cls_059">spring-</span></div>
<div style="position:absolute;left:129.78px;top:297.17px" class="cls_059"><span class="cls_059">boot:run</span><span class="cls_039"> goal or Gradle </span><span class="cls_059">bootRun</span><span class="cls_039"> task</span></div>
<div style="position:absolute;left:117.78px;top:311.18px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Using Maven or Gradle to produce an executable JAR file that can be run at the</span></div>
<div style="position:absolute;left:129.78px;top:324.17px" class="cls_039"><span class="cls_039">command line or deployed in the cloud</span></div>
<div style="position:absolute;left:117.78px;top:338.18px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Using Maven or Gradle to produce a WAR file that can be deployed to a tradi-</span></div>
<div style="position:absolute;left:129.78px;top:351.17px" class="cls_039"><span class="cls_039">tional Java application server</span></div>
<div style="position:absolute;left:102.18px;top:369.17px" class="cls_039"><span class="cls_039">Any of these choices is suitable for running the application while you’re still develop-</span></div>
<div style="position:absolute;left:102.18px;top:382.16px" class="cls_039"><span class="cls_039">ing it. But what about when you’re ready to deploy the application into a production</span></div>
<div style="position:absolute;left:102.18px;top:395.18px" class="cls_039"><span class="cls_039">or other non-development environment?</span></div>
<div style="position:absolute;left:116.78px;top:408.17px" class="cls_039"><span class="cls_039">Although running an application from the IDE or via Maven or Gradle aren’t con-</span></div>
<div style="position:absolute;left:102.18px;top:421.16px" class="cls_039"><span class="cls_039">sidered production-ready options, executable JAR files and traditional Java WAR files</span></div>
<div style="position:absolute;left:102.18px;top:434.18px" class="cls_039"><span class="cls_039">are certainly valid options for deploying applications to a production environment.</span></div>
<div style="position:absolute;left:102.18px;top:447.17px" class="cls_039"><span class="cls_039">Given the options of deploying a WAR file or a JAR file, how do you choose? In gen-</span></div>
<div style="position:absolute;left:102.18px;top:460.16px" class="cls_039"><span class="cls_039">eral, the choice comes down to whether you plan to deploy your application to a</span></div>
<div style="position:absolute;left:102.18px;top:473.18px" class="cls_039"><span class="cls_039">traditional Java application server or to a cloud platform:</span></div>
<div style="position:absolute;left:117.78px;top:487.16px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Deploying to Java application servers</span><span class="cls_039">—If you must deploy your application to Tom-</span></div>
<div style="position:absolute;left:129.78px;top:500.18px" class="cls_039"><span class="cls_039">cat, WebSphere, WebLogic, or any other traditional Java application server, you</span></div>
<div style="position:absolute;left:129.78px;top:513.17px" class="cls_039"><span class="cls_039">really have no choice but to build your application as a WAR file.</span></div>
<div style="position:absolute;left:117.78px;top:527.18px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Deploying to the cloud</span><span class="cls_039">—If you’re planning to deploy your application to the</span></div>
<div style="position:absolute;left:129.78px;top:540.17px" class="cls_039"><span class="cls_039">cloud, whether it be Cloud Foundry, Amazon Web Services (AWS), Azure, Goo-</span></div>
<div style="position:absolute;left:129.78px;top:553.19px" class="cls_039"><span class="cls_039">gle Cloud Platform, or most any other cloud platform, then an executable JAR</span></div>
<div style="position:absolute;left:129.78px;top:566.18px" class="cls_039"><span class="cls_039">file is the best choice. Even if the cloud platform supports WAR deployment,</span></div>
<div style="position:absolute;left:129.78px;top:579.17px" class="cls_039"><span class="cls_039">the JAR file format is much simpler than the WAR format, which is designed for</span></div>
<div style="position:absolute;left:129.78px;top:592.19px" class="cls_039"><span class="cls_039">application server deployment.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:316364px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background478.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">456</span></div>
<div style="position:absolute;left:205.89px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 19</span></div>
<div style="position:absolute;left:254.82px;top:24.35px" class="cls_055"><span class="cls_055">Deploying Spring</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">In this chapter, we’ll focus on three deployment scenarios:</span></div>
<div style="position:absolute;left:108.78px;top:67.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Deploying a Spring Boot application as a WAR file to a Java application server</span></div>
<div style="position:absolute;left:120.78px;top:80.66px" class="cls_039"><span class="cls_039">such as Tomcat</span></div>
<div style="position:absolute;left:108.78px;top:94.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Pushing a Spring Boot application as an executable JAR file to Cloud Foundry</span></div>
<div style="position:absolute;left:108.78px;top:108.65px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Packaging a Spring Boot application into a Docker container for deployment to</span></div>
<div style="position:absolute;left:120.78px;top:121.67px" class="cls_039"><span class="cls_039">any platform that supports Docker deployments</span></div>
<div style="position:absolute;left:93.18px;top:139.67px" class="cls_039"><span class="cls_039">To get started, let’s take a look at how you can build the ingredient service application</span></div>
<div style="position:absolute;left:93.18px;top:152.66px" class="cls_039"><span class="cls_039">into a WAR file that can be deployed to a Java application server such as Tomcat.</span></div>
<div style="position:absolute;left:57.18px;top:177.82px" class="cls_040"><span class="cls_040">19.2</span></div>
<div style="position:absolute;left:93.18px;top:177.82px" class="cls_040"><span class="cls_040">Building and deploying WAR files</span></div>
<div style="position:absolute;left:93.18px;top:197.15px" class="cls_039"><span class="cls_039">Throughout the course of this book, as you’ve developed the applications that make</span></div>
<div style="position:absolute;left:93.18px;top:210.17px" class="cls_039"><span class="cls_039">up the Taco Cloud application, you’ve run them either in the IDE or from the com-</span></div>
<div style="position:absolute;left:93.18px;top:223.16px" class="cls_039"><span class="cls_039">mand line as an executable JAR file. In either case, an embedded Tomcat server (or</span></div>
<div style="position:absolute;left:93.18px;top:236.15px" class="cls_039"><span class="cls_039">Netty, in the case of Spring WebFlux applications) has always been there to serve</span></div>
<div style="position:absolute;left:93.18px;top:249.17px" class="cls_039"><span class="cls_039">requests to the application.</span></div>
<div style="position:absolute;left:109.86px;top:262.16px" class="cls_039"><span class="cls_039">Thanks in large part to Spring Boot autoconfiguration, you’ve been spared</span></div>
<div style="position:absolute;left:93.18px;top:275.15px" class="cls_039"><span class="cls_039">from having to create a web.xml file or servlet initializer class to declare Spring’s</span></div>
<div style="position:absolute;left:93.18px;top:288.17px" class="cls_059"><span class="cls_059">DispatcherServlet</span><span class="cls_039"> for Spring MVC. But if you’re going to deploy the application</span></div>
<div style="position:absolute;left:93.18px;top:301.16px" class="cls_039"><span class="cls_039">to a Java application server, you’re going to need to build a WAR file. And, so that</span></div>
<div style="position:absolute;left:93.18px;top:314.18px" class="cls_039"><span class="cls_039">the application server will know how to run the application, you’ll also need to</span></div>
<div style="position:absolute;left:93.18px;top:327.17px" class="cls_039"><span class="cls_039">include a servlet initializer in that WAR file to play the part of a web.xml file and</span></div>
<div style="position:absolute;left:93.18px;top:340.16px" class="cls_039"><span class="cls_039">declare </span><span class="cls_059">DispatcherServlet</span><span class="cls_039">.</span></div>
<div style="position:absolute;left:107.82px;top:353.18px" class="cls_039"><span class="cls_039">As it turns out, building a Spring Boot application into a WAR file isn’t all that dif-</span></div>
<div style="position:absolute;left:93.18px;top:366.17px" class="cls_039"><span class="cls_039">ficult. In fact, if you chose the WAR option when creating the application through the</span></div>
<div style="position:absolute;left:93.18px;top:379.16px" class="cls_039"><span class="cls_039">Initializr, then there’s nothing more you need to do.</span></div>
<div style="position:absolute;left:108.91px;top:392.18px" class="cls_039"><span class="cls_039">The Initializr ensures that the generated project will contain a servlet initializer</span></div>
<div style="position:absolute;left:93.18px;top:405.17px" class="cls_039"><span class="cls_039">class and the build file will be geared to produce a WAR file. If, however, you chose to</span></div>
<div style="position:absolute;left:93.18px;top:418.16px" class="cls_039"><span class="cls_039">build a JAR file from the Initializr (or if you’re curious as to what the pertinent differ-</span></div>
<div style="position:absolute;left:93.18px;top:431.18px" class="cls_039"><span class="cls_039">ences are), then read on.</span></div>
<div style="position:absolute;left:109.71px;top:444.17px" class="cls_039"><span class="cls_039">First, you’ll need a way to configure Spring’s </span><span class="cls_059">DispatcherServlet</span><span class="cls_039">. Whereas this</span></div>
<div style="position:absolute;left:93.18px;top:457.16px" class="cls_039"><span class="cls_039">could be done with a web.xml file, Spring Boot makes this even easier with </span><span class="cls_059">Spring-</span></div>
<div style="position:absolute;left:93.27px;top:470.18px" class="cls_059"><span class="cls_059">BootServletInitializr</span><span class="cls_039">. </span><span class="cls_059">SpringBootServletInitializer</span><span class="cls_039"> is a special Spring Boot-</span></div>
<div style="position:absolute;left:93.18px;top:483.17px" class="cls_039"><span class="cls_039">aware implementation of Spring’s </span><span class="cls_059">WebApplicationInitializer</span><span class="cls_039">. Aside from config-</span></div>
<div style="position:absolute;left:93.18px;top:496.16px" class="cls_039"><span class="cls_039">uring Spring’s </span><span class="cls_059">DispatcherServlet</span><span class="cls_039">, </span><span class="cls_059">SpringBootServletInitializer</span><span class="cls_039"> also looks for</span></div>
<div style="position:absolute;left:93.18px;top:509.18px" class="cls_039"><span class="cls_039">any beans in the Spring application context that are of type </span><span class="cls_059">Filter</span><span class="cls_039">, </span><span class="cls_059">Servlet</span><span class="cls_039">, or</span></div>
<div style="position:absolute;left:93.18px;top:522.17px" class="cls_059"><span class="cls_059">ServletContextInitializer</span><span class="cls_039"> and binds them to the servlet container.</span></div>
<div style="position:absolute;left:109.98px;top:535.16px" class="cls_039"><span class="cls_039">To use </span><span class="cls_059">SpringBootServletInitializer</span><span class="cls_039">, create a subclass and override the</span></div>
<div style="position:absolute;left:93.18px;top:548.18px" class="cls_059"><span class="cls_059">configure()</span><span class="cls_039"> method to specify the Spring configuration class. Listing 19.1 shows</span></div>
<div style="position:absolute;left:93.18px;top:561.17px" class="cls_059"><span class="cls_059">IngredientServiceServletInitializer</span><span class="cls_039">, a subclass of </span><span class="cls_059">SpringBootServletInitializer</span></div>
<div style="position:absolute;left:93.18px;top:574.19px" class="cls_039"><span class="cls_039">that you’ll use for the ingredient service application.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:317040px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background479.jpg" width="531" height="666"></div>
<div style="position:absolute;left:209.70px;top:24.35px" class="cls_055"><span class="cls_055">Building and deploying WAR files</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">457</span></div>
<div style="position:absolute;left:114.18px;top:54.38px" class="cls_066"><span class="cls_066">Listing 19.1</span></div>
<div style="position:absolute;left:171.67px;top:54.38px" class="cls_066"><span class="cls_066">Enabling Spring web applications via Java</span></div>
<div style="position:absolute;left:102.18px;top:71.24px" class="cls_060"><span class="cls_060">package tacos.ingredients;</span></div>
<div style="position:absolute;left:102.18px;top:91.22px" class="cls_060"><span class="cls_060">import org.springframework.boot.builder.SpringApplicationBuilder;</span></div>
<div style="position:absolute;left:102.18px;top:101.24px" class="cls_060"><span class="cls_060">import org.springframework.boot.context.web.SpringBootServletInitializer;</span></div>
<div style="position:absolute;left:102.18px;top:121.22px" class="cls_060"><span class="cls_060">public class IngredientServiceServletInitializer</span></div>
<div style="position:absolute;left:135.76px;top:131.24px" class="cls_060"><span class="cls_060">extends SpringBootServletInitializer {</span></div>
<div style="position:absolute;left:111.78px;top:141.23px" class="cls_060"><span class="cls_060">@Override</span></div>
<div style="position:absolute;left:111.78px;top:151.25px" class="cls_060"><span class="cls_060">protected SpringApplicationBuilder configure(</span></div>
<div style="position:absolute;left:265.29px;top:161.24px" class="cls_060"><span class="cls_060">SpringApplicationBuilder builder) {</span></div>
<div style="position:absolute;left:121.38px;top:171.23px" class="cls_060"><span class="cls_060">return builder.sources(IngredientServiceApplication.class);</span></div>
<div style="position:absolute;left:111.78px;top:181.25px" class="cls_060"><span class="cls_060">}</span></div>
<div style="position:absolute;left:102.18px;top:191.24px" class="cls_061"><span class="cls_061">}</span></div>
<div style="position:absolute;left:102.18px;top:215.57px" class="cls_039"><span class="cls_039">As you can see, the </span><span class="cls_059">configure()</span><span class="cls_039"> method is given a </span><span class="cls_059">SpringApplicationBuilder</span><span class="cls_039"> as a</span></div>
<div style="position:absolute;left:102.18px;top:228.56px" class="cls_039"><span class="cls_039">parameter and returns it as a result. In between, it calls the </span><span class="cls_059">sources()</span><span class="cls_039"> method that</span></div>
<div style="position:absolute;left:102.18px;top:241.55px" class="cls_039"><span class="cls_039">registers Spring configuration classes. In this case, it only registers the </span><span class="cls_059">Ingredient-</span></div>
<div style="position:absolute;left:102.18px;top:254.57px" class="cls_059"><span class="cls_059">ServiceApplication</span><span class="cls_039"> class, which serves the dual purpose of a bootstrap class (for exe-</span></div>
<div style="position:absolute;left:102.18px;top:267.56px" class="cls_039"><span class="cls_039">cutable JARs) and a Spring configuration class.</span></div>
<div style="position:absolute;left:117.57px;top:280.55px" class="cls_039"><span class="cls_039">Even though the ingredient service application has other Spring configuration</span></div>
<div style="position:absolute;left:102.18px;top:293.57px" class="cls_039"><span class="cls_039">classes, it’s not necessary to register them all with the </span><span class="cls_059">sources()</span><span class="cls_039"> method. The</span></div>
<div style="position:absolute;left:102.18px;top:306.56px" class="cls_059"><span class="cls_059">IngredientServiceApplication</span><span class="cls_039"> class, annotated with </span><span class="cls_059">@SpringBootApplication</span><span class="cls_039">,</span></div>
<div style="position:absolute;left:102.18px;top:319.58px" class="cls_039"><span class="cls_039">implicitly enables component scanning. Component scanning discovers and pulls in</span></div>
<div style="position:absolute;left:102.18px;top:332.57px" class="cls_039"><span class="cls_039">any other configuration classes that it finds.</span></div>
<div style="position:absolute;left:116.93px;top:345.56px" class="cls_039"><span class="cls_039">For the most part, </span><span class="cls_059">SpringBootServletInitializer</span><span class="cls_039">’s subclass is boilerplate. It ref-</span></div>
<div style="position:absolute;left:102.18px;top:358.58px" class="cls_039"><span class="cls_039">erences the application main configuration class. But aside from that, it’ll be the same</span></div>
<div style="position:absolute;left:102.18px;top:371.57px" class="cls_039"><span class="cls_039">for every application where you’ll be building a WAR file. And you’ll almost never</span></div>
<div style="position:absolute;left:102.18px;top:384.56px" class="cls_039"><span class="cls_039">need to make any changes to it.</span></div>
<div style="position:absolute;left:118.95px;top:397.58px" class="cls_039"><span class="cls_039">Now that you’ve written a servlet initializer class, you must make a few small</span></div>
<div style="position:absolute;left:102.18px;top:410.57px" class="cls_039"><span class="cls_039">changes to the project build. If you’re building with Maven, the change required is as</span></div>
<div style="position:absolute;left:102.18px;top:423.56px" class="cls_039"><span class="cls_039">simple as ensuring that the </span><span class="cls_059">&lt;packaging&gt;</span><span class="cls_039"> element in pom.xml is set to </span><span class="cls_059">war</span><span class="cls_039">:</span></div>
<div style="position:absolute;left:102.18px;top:448.25px" class="cls_061"><span class="cls_061">&lt;packaging&gt;war&lt;/packaging&gt;</span></div>
<div style="position:absolute;left:102.18px;top:472.58px" class="cls_039"><span class="cls_039">The changes required for a Gradle build are similarly straightforward. You must apply</span></div>
<div style="position:absolute;left:102.18px;top:485.57px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">war</span><span class="cls_039"> plugin in the build.gradle file:</span></div>
<div style="position:absolute;left:102.18px;top:510.26px" class="cls_061"><span class="cls_061">apply plugin: 'war'</span></div>
<div style="position:absolute;left:102.18px;top:534.56px" class="cls_039"><span class="cls_039">Now you’re ready to build the application. With Maven, you’ll use the Maven wrapper</span></div>
<div style="position:absolute;left:102.18px;top:547.58px" class="cls_039"><span class="cls_039">script that the Initializr used to execute the package goal:</span></div>
<div style="position:absolute;left:102.18px;top:572.24px" class="cls_061"><span class="cls_061">$ mvnw package</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:317716px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background480.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">458</span></div>
<div style="position:absolute;left:205.89px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 19</span></div>
<div style="position:absolute;left:254.82px;top:24.35px" class="cls_055"><span class="cls_055">Deploying Spring</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">If the build is successful, then the WAR file can be found in the target directory. On</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">the other hand, if you were using Gradle to build the project, you’d use the Gradle</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">wrapper to execute the build task:</span></div>
<div style="position:absolute;left:93.18px;top:101.33px" class="cls_061"><span class="cls_061">$ gradlew build</span></div>
<div style="position:absolute;left:93.18px;top:125.66px" class="cls_039"><span class="cls_039">Once the build completes, the WAR file will be in the build/libs directory. All that’s</span></div>
<div style="position:absolute;left:93.18px;top:138.65px" class="cls_039"><span class="cls_039">left is to deploy the application. The deployment procedure varies across application</span></div>
<div style="position:absolute;left:93.18px;top:151.67px" class="cls_039"><span class="cls_039">servers, so consult the documentation for your application server’s specific deploy-</span></div>
<div style="position:absolute;left:93.18px;top:164.66px" class="cls_039"><span class="cls_039">ment procedure.</span></div>
<div style="position:absolute;left:109.05px;top:177.65px" class="cls_039"><span class="cls_039">It may be interesting to note that although you’ve built a WAR file suitable for</span></div>
<div style="position:absolute;left:93.18px;top:190.67px" class="cls_039"><span class="cls_039">deployment to any Servlet 3.0 (or higher) servlet container, the WAR file can still be</span></div>
<div style="position:absolute;left:93.18px;top:203.66px" class="cls_039"><span class="cls_039">executed at the command line as if it were an executable JAR file:</span></div>
<div style="position:absolute;left:93.18px;top:228.35px" class="cls_061"><span class="cls_061">$ java -jar target/ingredient-service-0.0.19-SNAPSHOT.war</span></div>
<div style="position:absolute;left:93.18px;top:252.65px" class="cls_039"><span class="cls_039">In effect, you get two deployment options out of a single deployment artifact!</span></div>
<div style="position:absolute;left:93.18px;top:270.83px" class="cls_064"><span class="cls_064">M</span><span class="cls_065">ICROSERVICES</span><span class="cls_064"> </span><span class="cls_065">IN</span><span class="cls_064"> </span><span class="cls_065">APPLICATION</span><span class="cls_064"> </span><span class="cls_065">SERVERS</span><span class="cls_064">?</span></div>
<div style="position:absolute;left:93.18px;top:283.16px" class="cls_039"><span class="cls_039">The ingredient service application is intended to be one of several applications that</span></div>
<div style="position:absolute;left:93.18px;top:296.18px" class="cls_039"><span class="cls_039">are microservice constituents of the larger Taco Cloud application. But here, we’re</span></div>
<div style="position:absolute;left:93.18px;top:309.17px" class="cls_039"><span class="cls_039">talking about deploying the ingredient service as a standalone application to an appli-</span></div>
<div style="position:absolute;left:93.18px;top:322.16px" class="cls_039"><span class="cls_039">cation server. Does that even make sense?</span></div>
<div style="position:absolute;left:107.56px;top:335.18px" class="cls_039"><span class="cls_039">Microservices are generally like any other application and should be deployable on</span></div>
<div style="position:absolute;left:93.18px;top:348.17px" class="cls_039"><span class="cls_039">their own. Although the ingredient service may not be useful outside the context of</span></div>
<div style="position:absolute;left:93.18px;top:361.16px" class="cls_039"><span class="cls_039">the rest of the Taco Cloud application, there’s no reason you can’t deploy it to Tomcat</span></div>
<div style="position:absolute;left:93.18px;top:374.18px" class="cls_039"><span class="cls_039">or another application server. But don’t expect the same ability to scale the applica-</span></div>
<div style="position:absolute;left:93.18px;top:387.17px" class="cls_039"><span class="cls_039">tion individually as you would get if deploying it to the cloud.</span></div>
<div style="position:absolute;left:109.38px;top:400.16px" class="cls_039"><span class="cls_039">Although WAR files have been the workhorses of Java deployment for over 20</span></div>
<div style="position:absolute;left:93.18px;top:413.18px" class="cls_039"><span class="cls_039">years, they were truly designed for deploying applications to a traditional Java applica-</span></div>
<div style="position:absolute;left:93.18px;top:426.17px" class="cls_039"><span class="cls_039">tion server. Depending on the platform you choose, modern cloud deployment</span></div>
<div style="position:absolute;left:93.18px;top:439.16px" class="cls_039"><span class="cls_039">doesn’t require WAR files and some may not even support them. As we move into a</span></div>
<div style="position:absolute;left:93.18px;top:452.18px" class="cls_039"><span class="cls_039">new era of cloud deployment, perhaps JAR files are a better choice.</span></div>
<div style="position:absolute;left:57.18px;top:476.35px" class="cls_040"><span class="cls_040">19.3</span></div>
<div style="position:absolute;left:93.18px;top:476.35px" class="cls_040"><span class="cls_040">Pushing JAR files to Cloud Foundry</span></div>
<div style="position:absolute;left:93.18px;top:495.68px" class="cls_039"><span class="cls_039">Server hardware can be expensive to purchase and maintain. Properly scaling servers</span></div>
<div style="position:absolute;left:93.18px;top:508.67px" class="cls_039"><span class="cls_039">to handle heavy loads can be tricky and even prohibitive for some organizations.</span></div>
<div style="position:absolute;left:93.18px;top:521.66px" class="cls_039"><span class="cls_039">These days, deploying applications to the cloud is a compelling and cost-effective</span></div>
<div style="position:absolute;left:93.18px;top:534.68px" class="cls_039"><span class="cls_039">alternative to running your own data center.</span></div>
<div style="position:absolute;left:109.25px;top:547.67px" class="cls_039"><span class="cls_039">Several cloud choices are available, but those that offer a platform as a service</span></div>
<div style="position:absolute;left:93.18px;top:560.69px" class="cls_039"><span class="cls_039">(PaaS) are among the most compelling. PaaS offers a ready-made application deploy-</span></div>
<div style="position:absolute;left:93.18px;top:573.68px" class="cls_039"><span class="cls_039">ment platform with several add-on services (such as databases and message brokers)</span></div>
<div style="position:absolute;left:93.18px;top:586.67px" class="cls_039"><span class="cls_039">to bind to your applications. In addition, as your application requires additional</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:318392px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background481.jpg" width="531" height="666"></div>
<div style="position:absolute;left:206.91px;top:24.35px" class="cls_055"><span class="cls_055">Pushing JAR files to Cloud Foundry</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">459</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">horsepower, cloud platforms make it easy to scale up (or down) your application on</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">the fly by adding and removing instances.</span></div>
<div style="position:absolute;left:118.28px;top:76.67px" class="cls_039"><span class="cls_039">Cloud Foundry is an open source PaaS platform that originated at Pivotal, the</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">same company that sponsors the Spring Framework and the other libraries in the</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">Spring platform. One of the most compelling things about Cloud Foundry is that it</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">offers both open source and commercial-based distributions, giving you the choice of</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">how and where you use Cloud Foundry. It can even be run inside the firewall in a cor-</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">porate data center, offering a private cloud.</span></div>
<div style="position:absolute;left:116.99px;top:154.67px" class="cls_039"><span class="cls_039">Whereas Cloud Foundry will be happy to accept WAR files, the WAR file format is</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">overkill for Cloud Foundry’s needs. A simpler executable JAR file is a more suitable</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">choice for deploying to Cloud Foundry.</span></div>
<div style="position:absolute;left:116.65px;top:193.67px" class="cls_039"><span class="cls_039">To demonstrate how to build and deploy an executable JAR file to Cloud Foundry,</span></div>
<div style="position:absolute;left:102.18px;top:206.66px" class="cls_039"><span class="cls_039">you’re going to build the ingredient service application and deploy it to Pivotal Web</span></div>
<div style="position:absolute;left:102.18px;top:219.65px" class="cls_039"><span class="cls_039">Services (PWS), a public Cloud Foundry hosted by Pivotal at </span><a href="http://run.pivotal.io/">http://run.pivotal.io</a> <span class="cls_039">. If</span></div>
<div style="position:absolute;left:102.18px;top:232.67px" class="cls_039"><span class="cls_039">you want to work with PWS, you’ll need to sign up for an account. PWS offers $87 of</span></div>
<div style="position:absolute;left:102.18px;top:245.66px" class="cls_039"><span class="cls_039">free trial credit and doesn’t even require you to give any credit card information</span></div>
<div style="position:absolute;left:102.18px;top:258.65px" class="cls_039"><span class="cls_039">during the trial.</span></div>
<div style="position:absolute;left:118.50px;top:271.67px" class="cls_039"><span class="cls_039">Once you’ve signed up for PWS, you’ll need to download and install the </span><span class="cls_059">cf</span></div>
<div style="position:absolute;left:102.18px;top:284.66px" class="cls_039"><span class="cls_039">command-line tool from </span><a href="https://console.run.pivotal.io/tools">https://console.run.pivotal.io/tools</a> <span class="cls_039">. You’ll use the </span><span class="cls_059">cf</span><span class="cls_039"> tool to</span></div>
<div style="position:absolute;left:102.18px;top:297.68px" class="cls_039"><span class="cls_039">push applications to Cloud Foundry. But the first thing you’ll use it for is to log into</span></div>
<div style="position:absolute;left:102.18px;top:310.67px" class="cls_039"><span class="cls_039">your PWS account:</span></div>
<div style="position:absolute;left:102.18px;top:330.35px" class="cls_060"><span class="cls_060">$ cf login -a </span><a href="https://api.run.pivotal.io/">https://api.run.pivotal.io</a> </div>
<div style="position:absolute;left:102.18px;top:340.34px" class="cls_060"><span class="cls_060">API endpoint: </span><a href="https://api.run.pivotal.io/">https://api.run.pivotal.io</a> </div>
<div style="position:absolute;left:102.18px;top:360.35px" class="cls_060"><span class="cls_060">Email&gt; {your email}</span></div>
<div style="position:absolute;left:102.18px;top:380.36px" class="cls_060"><span class="cls_060">Password&gt; {your password}</span></div>
<div style="position:absolute;left:102.18px;top:400.34px" class="cls_060"><span class="cls_060">Authenticating...</span></div>
<div style="position:absolute;left:102.18px;top:410.36px" class="cls_061"><span class="cls_061">OK</span></div>
<div style="position:absolute;left:102.18px;top:429.68px" class="cls_039"><span class="cls_039">Great! Now you’re ready to take the ingredient service to the cloud! As it turns out,</span></div>
<div style="position:absolute;left:102.18px;top:442.67px" class="cls_039"><span class="cls_039">the project is ready to be deployed to Cloud Foundry. All you need to do is build it</span></div>
<div style="position:absolute;left:102.18px;top:455.66px" class="cls_039"><span class="cls_039">and then push it to the cloud.</span></div>
<div style="position:absolute;left:117.48px;top:468.68px" class="cls_039"><span class="cls_039">To build the project with Maven, you can use the Maven wrapper to execute the</span></div>
<div style="position:absolute;left:102.18px;top:481.67px" class="cls_039"><span class="cls_039">package goal (you’ll find the resulting JAR file in the target directory):</span></div>
<div style="position:absolute;left:102.18px;top:502.34px" class="cls_061"><span class="cls_061">$ mvnw package</span></div>
<div style="position:absolute;left:102.18px;top:521.66px" class="cls_039"><span class="cls_039">With Gradle, you can use the Gradle wrapper to execute the build task (you’ll find the</span></div>
<div style="position:absolute;left:102.18px;top:534.68px" class="cls_039"><span class="cls_039">resulting JAR file in the build/libs directory):</span></div>
<div style="position:absolute;left:102.18px;top:555.35px" class="cls_061"><span class="cls_061">$ gradlew build</span></div>
<div style="position:absolute;left:102.18px;top:574.67px" class="cls_039"><span class="cls_039">Now all that’s left is to push the JAR file to Cloud Foundry using the </span><span class="cls_059">cf</span><span class="cls_039"> command:</span></div>
<div style="position:absolute;left:102.18px;top:595.34px" class="cls_061"><span class="cls_061">$ cf push ingredient-service -p target/ingredient-service-0.0.19-SNAPSHOT.jar</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:319068px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background482.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">460</span></div>
<div style="position:absolute;left:205.89px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 19</span></div>
<div style="position:absolute;left:254.82px;top:24.35px" class="cls_055"><span class="cls_055">Deploying Spring</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">The first argument to </span><span class="cls_059">cf</span><span class="cls_039"> </span><span class="cls_059">push</span><span class="cls_039"> is the name given to the application in Cloud Foundry.</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">In this case, the full URL for the application will be </span><a href="http://ingredient-service.cfapps.io/">http://ingredient-service.cfapps.io</a> <span class="cls_039">.</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">Among other things, this name will be used as the subdomain where the application is</span></div>
<div style="position:absolute;left:93.18px;top:89.66px" class="cls_039"><span class="cls_039">hosted. Therefore, it’s important that the name you give the application be unique so</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">that it doesn’t collide with any other applications deployed in Cloud Foundry (includ-</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">ing those deployed by other Cloud Foundry users).</span></div>
<div style="position:absolute;left:107.85px;top:128.66px" class="cls_039"><span class="cls_039">Because dreaming up a unique name can be tricky, the </span><span class="cls_059">cf</span><span class="cls_039"> </span><span class="cls_059">push</span><span class="cls_039"> command offers a</span></div>
<div style="position:absolute;left:93.18px;top:141.65px" class="cls_059"><span class="cls_059">--random-route</span><span class="cls_039"> option that randomly produces a subdomain for you. Here’s how to</span></div>
<div style="position:absolute;left:93.18px;top:154.67px" class="cls_039"><span class="cls_039">push the ingredient service application to generate a random route:</span></div>
<div style="position:absolute;left:93.18px;top:175.34px" class="cls_060"><span class="cls_060">$ cf push ingredient-service \</span></div>
<div style="position:absolute;left:117.14px;top:185.33px" class="cls_060"><span class="cls_060">-p target/ingredient-service-0.0.19-SNAPSHOT.jar \</span></div>
<div style="position:absolute;left:117.15px;top:195.35px" class="cls_061"><span class="cls_061">--random-route</span></div>
<div style="position:absolute;left:93.18px;top:218.66px" class="cls_039"><span class="cls_039">When using </span><span class="cls_059">--random-route</span><span class="cls_039">, the application name is still required, but two randomly</span></div>
<div style="position:absolute;left:93.18px;top:231.65px" class="cls_039"><span class="cls_039">chosen words will be appended to it to produce the subdomain.</span></div>
<div style="position:absolute;left:108.57px;top:244.67px" class="cls_039"><span class="cls_039">Assuming everything goes well, the application should be deployed and ready to</span></div>
<div style="position:absolute;left:93.18px;top:257.66px" class="cls_039"><span class="cls_039">handle requests. Supposing that the subdomain is ingredient-service, you can point</span></div>
<div style="position:absolute;left:93.18px;top:270.65px" class="cls_039"><span class="cls_039">your browser to </span><a href="http://ingredient-service.cfapps.io/ingredients">http://ingredient-service.cfapps.io/ingredients</a> <span class="cls_039"> to see it in action.</span></div>
<div style="position:absolute;left:93.18px;top:283.67px" class="cls_039"><span class="cls_039">You should receive, as a response, a list of available ingredients.</span></div>
<div style="position:absolute;left:109.10px;top:296.66px" class="cls_039"><span class="cls_039">As written, the application will continue to use the embedded Mongo database</span></div>
<div style="position:absolute;left:93.18px;top:309.68px" class="cls_039"><span class="cls_039">(which is only intended for testing purposes) to hold ingredient data. You’ll likely</span></div>
<div style="position:absolute;left:93.18px;top:322.67px" class="cls_039"><span class="cls_039">want to use a real database in production. At the time I’m writing this, there’s a fully</span></div>
<div style="position:absolute;left:93.18px;top:335.66px" class="cls_039"><span class="cls_039">managed MongoDB service available in PWS under the name mlab. You can find this</span></div>
<div style="position:absolute;left:93.18px;top:348.68px" class="cls_039"><span class="cls_039">service (and any other available services) by using the </span><span class="cls_059">cf</span><span class="cls_039"> </span><span class="cls_059">marketplace</span><span class="cls_039"> command. To</span></div>
<div style="position:absolute;left:93.18px;top:361.67px" class="cls_039"><span class="cls_039">create an instance of the mlab service, use the </span><span class="cls_059">cf</span><span class="cls_039"> </span><span class="cls_059">create-service</span><span class="cls_039"> command:</span></div>
<div style="position:absolute;left:93.18px;top:384.35px" class="cls_061"><span class="cls_061">$ cf create-service mlab sandbox ingredientdb</span></div>
<div style="position:absolute;left:93.18px;top:407.66px" class="cls_039"><span class="cls_039">This creates an mlab service with the sandbox service plan named ingredientdb. Once</span></div>
<div style="position:absolute;left:93.18px;top:420.68px" class="cls_039"><span class="cls_039">the service is created, you can bind it to your application with the </span><span class="cls_059">cf</span><span class="cls_039"> </span><span class="cls_059">bind-service</span></div>
<div style="position:absolute;left:93.18px;top:433.67px" class="cls_039"><span class="cls_039">command. For example, to bind the ingredientdb service to the ingredient service</span></div>
<div style="position:absolute;left:93.18px;top:446.66px" class="cls_039"><span class="cls_039">application, use this:</span></div>
<div style="position:absolute;left:93.18px;top:469.34px" class="cls_061"><span class="cls_061">$ cf bind-service ingredient-service ingredientdb</span></div>
<div style="position:absolute;left:93.18px;top:492.68px" class="cls_039"><span class="cls_039">Binding a service to an application merely provides the application with details on</span></div>
<div style="position:absolute;left:93.18px;top:505.67px" class="cls_039"><span class="cls_039">how to connect to the service with an environment variable named </span><span class="cls_059">VCAP_SERVICES</span><span class="cls_039">. It</span></div>
<div style="position:absolute;left:93.18px;top:518.66px" class="cls_039"><span class="cls_039">doesn’t change the application in any way to use that service. Once the service is</span></div>
<div style="position:absolute;left:93.18px;top:531.68px" class="cls_039"><span class="cls_039">bound, you’ll need to re-stage the application to have the binding take effect:</span></div>
<div style="position:absolute;left:93.18px;top:554.36px" class="cls_061"><span class="cls_061">$ cf restage ingredient-service</span></div>
<div style="position:absolute;left:93.18px;top:577.67px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">cf</span><span class="cls_039"> </span><span class="cls_059">restage</span><span class="cls_039"> command forces Cloud Foundry to redeploy the application and</span></div>
<div style="position:absolute;left:93.18px;top:590.69px" class="cls_039"><span class="cls_039">reevaluate the </span><span class="cls_059">VCAP_SERVICES</span><span class="cls_039"> value. When it does, it’ll see that there’s a MongoDB</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:319744px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background483.jpg" width="531" height="666"></div>
<div style="position:absolute;left:192.90px;top:24.35px" class="cls_055"><span class="cls_055">Running Spring Boot in a Docker container</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">461</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">service bound to the application. It uses that service as the backing database for the</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">application.</span></div>
<div style="position:absolute;left:117.37px;top:76.67px" class="cls_039"><span class="cls_039">There are dozens of available services in PWS that you can bind your application</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">to, including MySQL databases, PostgreSQL databases, and even ready-to-use Eureka</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">and Config Server services. I encourage you to read more about what PWS has to offer</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">at </span><a href="https://console.run.pivotal.io/marketplace">https://console.run.pivotal.io/marketplace</a> <span class="cls_039"> and acquaint yourself with how to use</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">PWS by reading the documentation at </span><a href="https://docs.run.pivotal.io/">https://docs.run.pivotal.io/</a> <span class="cls_039">.</span></div>
<div style="position:absolute;left:117.09px;top:141.65px" class="cls_039"><span class="cls_039">Cloud Foundry is a great PaaS for Spring Boot application deployment. Its asso-</span></div>
<div style="position:absolute;left:102.18px;top:154.67px" class="cls_039"><span class="cls_039">ciation with the Spring projects affords some synergy between the two. But another</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">common way to deploy applications in the cloud, especially when pushing to an</span></div>
<div style="position:absolute;left:102.18px;top:180.65px" class="cls_039"><span class="cls_039">Infrastructure-as-a-Service (IAAS) platform like AWS, is to package the application</span></div>
<div style="position:absolute;left:102.18px;top:193.67px" class="cls_039"><span class="cls_039">within a Docker container that’s published to the cloud. Let’s see how to create a</span></div>
<div style="position:absolute;left:102.18px;top:206.66px" class="cls_039"><span class="cls_039">Docker container that carries your Spring Boot application.</span></div>
<div style="position:absolute;left:66.18px;top:230.83px" class="cls_040"><span class="cls_040">19.4</span></div>
<div style="position:absolute;left:102.18px;top:230.83px" class="cls_040"><span class="cls_040">Running Spring Boot in a Docker container</span></div>
<div style="position:absolute;left:102.18px;top:250.16px" class="cls_039"><span class="cls_039">Docker (</span><a href="https://www.docker.com/">https://www.docker.com/</a> <span class="cls_039">) has become the de facto standard for distributing</span></div>
<div style="position:absolute;left:102.18px;top:263.15px" class="cls_039"><span class="cls_039">applications of all kinds for deployment in the cloud. Many different cloud environ-</span></div>
<div style="position:absolute;left:102.18px;top:276.17px" class="cls_039"><span class="cls_039">ments, including AWS, Microsoft Azure, Google Cloud Platform, and Pivotal Web Ser-</span></div>
<div style="position:absolute;left:102.18px;top:289.16px" class="cls_039"><span class="cls_039">vices (to name a few) accept Docker containers for deploying applications.</span></div>
<div style="position:absolute;left:116.83px;top:302.18px" class="cls_039"><span class="cls_039">The idea of containerized applications, such as those created with Docker, draws</span></div>
<div style="position:absolute;left:102.18px;top:315.17px" class="cls_039"><span class="cls_039">analogies from real-world intermodal containers. With regard to shipping items,</span></div>
<div style="position:absolute;left:102.18px;top:328.16px" class="cls_039"><span class="cls_039">intermodal containers all have a standard size and format, regardless of their con-</span></div>
<div style="position:absolute;left:102.18px;top:341.18px" class="cls_039"><span class="cls_039">tents. Because of that, intermodal containers are easily stacked on ships, carried on</span></div>
<div style="position:absolute;left:102.18px;top:354.17px" class="cls_039"><span class="cls_039">trains, or pulled by trucks. In a similar way, containerized applications share a com-</span></div>
<div style="position:absolute;left:102.18px;top:367.16px" class="cls_039"><span class="cls_039">mon container format that can be deployed and run anywhere, regardless of the</span></div>
<div style="position:absolute;left:102.18px;top:380.18px" class="cls_039"><span class="cls_039">application inside.</span></div>
<div style="position:absolute;left:118.99px;top:393.17px" class="cls_039"><span class="cls_039">Although creating Docker images isn’t terribly difficult, Spotify has created a</span></div>
<div style="position:absolute;left:102.18px;top:406.16px" class="cls_039"><span class="cls_039">Maven plugin that makes creating a Docker container from the result of a Spring Boot</span></div>
<div style="position:absolute;left:102.18px;top:419.18px" class="cls_039"><span class="cls_039">build as easy as whistling your favorite tune. To use the Docker plugin, add it to your</span></div>
<div style="position:absolute;left:102.18px;top:432.17px" class="cls_039"><span class="cls_039">Spring Boot project pom.xml file under the </span><span class="cls_059">&lt;build&gt;</span><span class="cls_039">/</span><span class="cls_059">&lt;plugins&gt;</span><span class="cls_039"> block as follows:</span></div>
<div style="position:absolute;left:102.18px;top:455.84px" class="cls_060"><span class="cls_060">&lt;build&gt;</span></div>
<div style="position:absolute;left:111.78px;top:465.86px" class="cls_060"><span class="cls_060">&lt;plugins&gt;</span></div>
<div style="position:absolute;left:121.38px;top:485.84px" class="cls_060"><span class="cls_060">&lt;plugin&gt;</span></div>
<div style="position:absolute;left:130.95px;top:495.86px" class="cls_060"><span class="cls_060">&lt;groupId&gt;com.spotify&lt;/groupId&gt;</span></div>
<div style="position:absolute;left:130.95px;top:505.85px" class="cls_060"><span class="cls_060">&lt;artifactId&gt;dockerfile-maven-plugin&lt;/artifactId&gt;</span></div>
<div style="position:absolute;left:130.95px;top:515.84px" class="cls_060"><span class="cls_060">&lt;version&gt;1.4.3&lt;/version&gt;</span></div>
<div style="position:absolute;left:130.95px;top:525.86px" class="cls_060"><span class="cls_060">&lt;configuration&gt;</span></div>
<div style="position:absolute;left:140.55px;top:535.85px" class="cls_060"><span class="cls_060">&lt;repository&gt;</span></div>
<div style="position:absolute;left:150.15px;top:545.84px" class="cls_060"><span class="cls_060">${docker.image.prefix}/${project.artifactId}</span></div>
<div style="position:absolute;left:140.55px;top:555.86px" class="cls_060"><span class="cls_060">&lt;/repository&gt;</span></div>
<div style="position:absolute;left:140.55px;top:565.85px" class="cls_060"><span class="cls_060">&lt;buildArgs&gt;</span></div>
<div style="position:absolute;left:150.15px;top:575.84px" class="cls_060"><span class="cls_060">&lt;JAR_FILE&gt;target/${project.build.finalName}.jar&lt;/JAR_FILE&gt;</span></div>
<div style="position:absolute;left:140.55px;top:585.86px" class="cls_060"><span class="cls_060">&lt;/buildArgs&gt;</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:320420px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background484.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">462</span></div>
<div style="position:absolute;left:205.89px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 19</span></div>
<div style="position:absolute;left:254.82px;top:24.35px" class="cls_055"><span class="cls_055">Deploying Spring</span></div>
<div style="position:absolute;left:121.95px;top:51.32px" class="cls_060"><span class="cls_060">&lt;/configuration&gt;</span></div>
<div style="position:absolute;left:112.38px;top:61.34px" class="cls_060"><span class="cls_060">&lt;/plugin&gt;</span></div>
<div style="position:absolute;left:102.78px;top:71.33px" class="cls_060"><span class="cls_060">&lt;/plugins&gt;</span></div>
<div style="position:absolute;left:93.18px;top:81.32px" class="cls_061"><span class="cls_061">&lt;/build&gt;</span></div>
<div style="position:absolute;left:93.18px;top:104.66px" class="cls_039"><span class="cls_039">Under the </span><span class="cls_059">&lt;configuration&gt;</span><span class="cls_039"> block, you’ll set a few properties to guide the creation of</span></div>
<div style="position:absolute;left:93.18px;top:117.65px" class="cls_039"><span class="cls_039">the Docker image. The </span><span class="cls_059">&lt;repository&gt;</span><span class="cls_039"> element describes the name of the Docker</span></div>
<div style="position:absolute;left:93.18px;top:130.67px" class="cls_039"><span class="cls_039">image as it’ll appear in a Docker repository. As specified here, the name is based on</span></div>
<div style="position:absolute;left:93.18px;top:143.66px" class="cls_039"><span class="cls_039">the Maven project artifact ID, prefixed with a value resolved from the Maven property</span></div>
<div style="position:absolute;left:93.18px;top:156.65px" class="cls_039"><span class="cls_039">named </span><span class="cls_059">docker.image.prefix</span><span class="cls_039">. Although the project artifact ID is something Maven</span></div>
<div style="position:absolute;left:93.18px;top:169.67px" class="cls_039"><span class="cls_039">already knows, you’ll need to specify the prefix property:</span></div>
<div style="position:absolute;left:93.18px;top:192.35px" class="cls_060"><span class="cls_060">&lt;properties&gt;</span></div>
<div style="position:absolute;left:102.78px;top:212.33px" class="cls_060"><span class="cls_060">&lt;docker.image.prefix&gt;tacocloud&lt;/docker.image.prefix&gt;</span></div>
<div style="position:absolute;left:93.18px;top:222.35px" class="cls_061"><span class="cls_061">&lt;/properties&gt;</span></div>
<div style="position:absolute;left:93.18px;top:245.66px" class="cls_039"><span class="cls_039">If this were the Taco Cloud ingredient service, the resulting Docker image would</span></div>
<div style="position:absolute;left:93.18px;top:258.65px" class="cls_039"><span class="cls_039">reside in the Docker repository as tacocloud/ingredient-service.</span></div>
<div style="position:absolute;left:107.42px;top:271.67px" class="cls_039"><span class="cls_039">Under the </span><span class="cls_059">&lt;buildArgs&gt;</span><span class="cls_039"> element, you can guide the image to include the JAR file that</span></div>
<div style="position:absolute;left:93.18px;top:284.66px" class="cls_039"><span class="cls_039">the Maven build produces. As shown, it uses the Maven property </span><span class="cls_059">project.build.final-</span></div>
<div style="position:absolute;left:93.18px;top:297.68px" class="cls_059"><span class="cls_059">Name</span><span class="cls_039"> to determine the name of the JAR file that’s in the </span><span class="cls_059">target</span><span class="cls_039"> directory.</span></div>
<div style="position:absolute;left:109.44px;top:310.67px" class="cls_039"><span class="cls_039">Aside from the information you provided in the Maven build specification, all</span></div>
<div style="position:absolute;left:93.18px;top:323.66px" class="cls_039"><span class="cls_039">Docker images are defined from a file named Dockerfile. This file identifies an image</span></div>
<div style="position:absolute;left:93.18px;top:336.68px" class="cls_039"><span class="cls_039">to base the new image on, environment variables that should be set, any volumes that</span></div>
<div style="position:absolute;left:93.18px;top:349.67px" class="cls_039"><span class="cls_039">should be mounted, and (most importantly) the </span><span class="cls_036">entry point</span><span class="cls_039">—a command to execute</span></div>
<div style="position:absolute;left:93.18px;top:362.66px" class="cls_039"><span class="cls_039">when a container based on the image starts. For the purposes of most any Spring Boot</span></div>
<div style="position:absolute;left:93.18px;top:375.68px" class="cls_039"><span class="cls_039">application, the following Dockerfile is a great way to begin:</span></div>
<div style="position:absolute;left:93.18px;top:398.36px" class="cls_060"><span class="cls_060">FROM openjdk:8-jdk-alpine</span></div>
<div style="position:absolute;left:93.18px;top:408.35px" class="cls_060"><span class="cls_060">ENV SPRING_PROFILES_ACTIVE docker</span></div>
<div style="position:absolute;left:93.18px;top:418.34px" class="cls_060"><span class="cls_060">VOLUME /tmp</span></div>
<div style="position:absolute;left:93.18px;top:428.36px" class="cls_060"><span class="cls_060">ARG JAR_FILE</span></div>
<div style="position:absolute;left:93.18px;top:438.35px" class="cls_060"><span class="cls_060">COPY ${JAR_FILE} app.jar</span></div>
<div style="position:absolute;left:93.18px;top:448.34px" class="cls_060"><span class="cls_060">ENTRYPOINT ["java",\</span></div>
<div style="position:absolute;left:150.75px;top:458.36px" class="cls_060"><span class="cls_060">"-Djava.security.egd=file:/dev/./urandom",\</span></div>
<div style="position:absolute;left:150.75px;top:468.35px" class="cls_060"><span class="cls_060">"-jar",\</span></div>
<div style="position:absolute;left:150.75px;top:478.34px" class="cls_061"><span class="cls_061">"/app.jar"]</span></div>
<div style="position:absolute;left:93.18px;top:501.68px" class="cls_039"><span class="cls_039">Breaking this Docker file down line by line, you see the following:</span></div>
<div style="position:absolute;left:108.78px;top:520.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  The </span><span class="cls_059">FROM</span><span class="cls_039"> instruction identifies an image to base the new image on. The new</span></div>
<div style="position:absolute;left:120.78px;top:533.66px" class="cls_039"><span class="cls_039">image extends the base image. In this case, the base image is openjdk:8-jdk-</span></div>
<div style="position:absolute;left:120.78px;top:546.68px" class="cls_039"><span class="cls_039">alpine, a container image based on version 8 of OpenJDK.</span></div>
<div style="position:absolute;left:108.78px;top:560.69px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  The </span><span class="cls_059">ENV</span><span class="cls_039"> instruction sets an environment variable. You’re going to override a few of</span></div>
<div style="position:absolute;left:120.78px;top:573.68px" class="cls_039"><span class="cls_039">the Spring Boot application configuration properties based on the active profile,</span></div>
<div style="position:absolute;left:120.78px;top:586.67px" class="cls_039"><span class="cls_039">so in this image, you’ll set the environment variable </span><span class="cls_059">SPRING_PROFILES_ACTIVE</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:321096px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background485.jpg" width="531" height="666"></div>
<div style="position:absolute;left:192.90px;top:24.35px" class="cls_055"><span class="cls_055">Running Spring Boot in a Docker container</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">463</span></div>
<div style="position:absolute;left:129.78px;top:50.66px" class="cls_039"><span class="cls_039">to </span><span class="cls_059">docker</span><span class="cls_039"> to ensure that the Spring Boot application starts with </span><span class="cls_059">docker</span><span class="cls_039"> as the</span></div>
<div style="position:absolute;left:129.78px;top:63.65px" class="cls_039"><span class="cls_039">active profile.</span></div>
<div style="position:absolute;left:117.78px;top:77.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  The </span><span class="cls_059">VOLUME</span><span class="cls_039"> instruction creates a mount point in the container. In this case, it</span></div>
<div style="position:absolute;left:129.78px;top:90.65px" class="cls_039"><span class="cls_039">creates a mount point at /tmp so that the container can write data, if necessary,</span></div>
<div style="position:absolute;left:129.78px;top:103.67px" class="cls_039"><span class="cls_039">to the /tmp directory.</span></div>
<div style="position:absolute;left:117.78px;top:117.65px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  The </span><span class="cls_059">ARG</span><span class="cls_039"> instruction declares an argument that can be passed in at build time.</span></div>
<div style="position:absolute;left:129.78px;top:130.67px" class="cls_039"><span class="cls_039">In this case, it declares an argument named </span><span class="cls_059">JAR_FILE</span><span class="cls_039">, which is the same as the</span></div>
<div style="position:absolute;left:129.78px;top:143.66px" class="cls_039"><span class="cls_039">argument given in the Maven plugin’s </span><span class="cls_059">&lt;buildArgs&gt;</span><span class="cls_039"> block.</span></div>
<div style="position:absolute;left:117.78px;top:157.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  The </span><span class="cls_059">COPY</span><span class="cls_039"> instruction copies a file from a given path to another path. In this</span></div>
<div style="position:absolute;left:129.78px;top:170.66px" class="cls_039"><span class="cls_039">case, it copies the JAR file specified in the Maven plugin to a file named app.jar</span></div>
<div style="position:absolute;left:129.78px;top:183.65px" class="cls_039"><span class="cls_039">within the image.</span></div>
<div style="position:absolute;left:117.78px;top:197.66px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  The </span><span class="cls_059">ENTRYPOINT</span><span class="cls_039"> instruction describes what should happen when the container</span></div>
<div style="position:absolute;left:129.78px;top:210.65px" class="cls_039"><span class="cls_039">starts. Given as an array, it specifies the command line to execute. In this case, it</span></div>
<div style="position:absolute;left:129.78px;top:223.67px" class="cls_039"><span class="cls_039">uses the </span><span class="cls_059">java</span><span class="cls_039"> command line to run the executable app.jar.</span></div>
<div style="position:absolute;left:102.18px;top:243.65px" class="cls_039"><span class="cls_039">Draw special attention to the </span><span class="cls_059">ENV</span><span class="cls_039"> instruction. It’s generally a good idea to set the</span></div>
<div style="position:absolute;left:102.18px;top:256.67px" class="cls_059"><span class="cls_059">SPRING_PROFILES_ACTIVE</span><span class="cls_039"> environment variable in any container image that contains</span></div>
<div style="position:absolute;left:102.18px;top:269.66px" class="cls_039"><span class="cls_039">a Spring Boot application. This makes it possible to configure beans and configura-</span></div>
<div style="position:absolute;left:102.18px;top:282.65px" class="cls_039"><span class="cls_039">tion properties that are unique to applications running in Docker.</span></div>
<div style="position:absolute;left:116.58px;top:295.67px" class="cls_039"><span class="cls_039">In the case of the ingredient service, you’re going to need a way to link the applica-</span></div>
<div style="position:absolute;left:102.18px;top:308.66px" class="cls_039"><span class="cls_039">tion to a Mongo database running in a separate container. By default, Spring Data</span></div>
<div style="position:absolute;left:102.18px;top:321.68px" class="cls_039"><span class="cls_039">attempts to connect to a Mongo database listening at port 27017 on localhost. But that</span></div>
<div style="position:absolute;left:102.18px;top:334.67px" class="cls_039"><span class="cls_039">was only the case when running everything locally and not in any containers. You’ll</span></div>
<div style="position:absolute;left:102.18px;top:347.66px" class="cls_039"><span class="cls_039">need to configure the </span><span class="cls_059">spring.data.mongodb.host</span><span class="cls_039"> property to tell Spring Data the</span></div>
<div style="position:absolute;left:102.18px;top:360.68px" class="cls_039"><span class="cls_039">hostname where Mongo will be available.</span></div>
<div style="position:absolute;left:117.51px;top:373.67px" class="cls_039"><span class="cls_039">Although you may not yet know where the Mongo database will be running, you</span></div>
<div style="position:absolute;left:102.18px;top:386.66px" class="cls_039"><span class="cls_039">can configure Spring Data to connect to Mongo on a host named </span><span class="cls_059">mongo</span><span class="cls_039"> when the</span></div>
<div style="position:absolute;left:102.18px;top:399.68px" class="cls_059"><span class="cls_059">docker</span><span class="cls_039"> profile is active by adding the following Docker-specific configuration to the</span></div>
<div style="position:absolute;left:102.18px;top:412.67px" class="cls_039"><span class="cls_039">application.yml file:</span></div>
<div style="position:absolute;left:102.18px;top:435.35px" class="cls_060"><span class="cls_060">---</span></div>
<div style="position:absolute;left:102.18px;top:445.34px" class="cls_060"><span class="cls_060">spring:</span></div>
<div style="position:absolute;left:111.78px;top:455.36px" class="cls_060"><span class="cls_060">profiles: docker</span></div>
<div style="position:absolute;left:111.78px;top:475.34px" class="cls_060"><span class="cls_060">data:</span></div>
<div style="position:absolute;left:121.38px;top:485.36px" class="cls_060"><span class="cls_060">mongodb:</span></div>
<div style="position:absolute;left:130.95px;top:495.35px" class="cls_061"><span class="cls_061">host: mongo</span></div>
<div style="position:absolute;left:102.18px;top:519.68px" class="cls_039"><span class="cls_039">In a moment, when you fire up the Docker container, you’ll map the </span><span class="cls_059">mongo</span><span class="cls_039"> host to a</span></div>
<div style="position:absolute;left:102.18px;top:532.67px" class="cls_039"><span class="cls_039">Mongo database running in a different container. But now you’re ready to build the</span></div>
<div style="position:absolute;left:102.18px;top:545.66px" class="cls_039"><span class="cls_039">Docker image. Using the Maven wrapper, execute the </span><span class="cls_059">package</span><span class="cls_039"> and </span><span class="cls_059">dockerfile:build</span></div>
<div style="position:absolute;left:102.18px;top:558.68px" class="cls_039"><span class="cls_039">goals to build the JAR file, and then build the Docker image:</span></div>
<div style="position:absolute;left:102.18px;top:583.34px" class="cls_061"><span class="cls_061">$ mvnw package dockerfile:build</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:321772px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background486.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_052"><span class="cls_052">464</span></div>
<div style="position:absolute;left:205.89px;top:25.37px" class="cls_053"><span class="cls_053">C</span><span class="cls_054">HAPTER</span><span class="cls_053"> 19</span></div>
<div style="position:absolute;left:254.82px;top:24.35px" class="cls_055"><span class="cls_055">Deploying Spring</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">At this point, you can verify that the image is in your local image repository by using</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">the </span><span class="cls_059">docker</span><span class="cls_039"> </span><span class="cls_059">images</span><span class="cls_039"> command (the CREATED and SIZE columns were omitted for eas-</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">ier readability and to fit within the margins of this page):</span></div>
<div style="position:absolute;left:93.18px;top:96.32px" class="cls_060"><span class="cls_060">$ docker images</span></div>
<div style="position:absolute;left:93.18px;top:106.34px" class="cls_060"><span class="cls_060">REPOSITORY</span></div>
<div style="position:absolute;left:241.94px;top:106.34px" class="cls_060"><span class="cls_060">TAG</span></div>
<div style="position:absolute;left:337.92px;top:106.34px" class="cls_060"><span class="cls_060">IMAGE ID</span></div>
<div style="position:absolute;left:93.18px;top:116.33px" class="cls_061"><span class="cls_061">tacocloud/ingredient-service</span></div>
<div style="position:absolute;left:241.92px;top:116.33px" class="cls_061"><span class="cls_061">latest</span></div>
<div style="position:absolute;left:337.87px;top:116.33px" class="cls_061"><span class="cls_061">7e8ed20e768e</span></div>
<div style="position:absolute;left:93.18px;top:137.66px" class="cls_039"><span class="cls_039">Before you can start the container, you’ll need to start a container for the Mongo data-</span></div>
<div style="position:absolute;left:93.18px;top:150.65px" class="cls_039"><span class="cls_039">base. The following command line runs a new Docker container named </span><span class="cls_059">tacocloud-</span></div>
<div style="position:absolute;left:93.18px;top:163.67px" class="cls_059"><span class="cls_059">mongo</span><span class="cls_039"> with a Mongo 3.7.9 database:</span></div>
<div style="position:absolute;left:93.18px;top:186.35px" class="cls_061"><span class="cls_061">$ docker run --name tacocloud-mongo -d mongo:3.7.9-xenial</span></div>
<div style="position:absolute;left:93.18px;top:206.66px" class="cls_039"><span class="cls_039">Now, you can finally run the ingredient service container, linking it to the Mongo con-</span></div>
<div style="position:absolute;left:93.18px;top:219.65px" class="cls_039"><span class="cls_039">tainer you just started:</span></div>
<div style="position:absolute;left:93.18px;top:239.33px" class="cls_060"><span class="cls_060">$ docker run -p 8080:8081 \</span></div>
<div style="position:absolute;left:155.54px;top:249.35px" class="cls_060"><span class="cls_060">--link tacocloud-mongo:mongo \</span></div>
<div style="position:absolute;left:155.56px;top:259.34px" class="cls_061"><span class="cls_061">tacocloud/ingredient-service</span></div>
<div style="position:absolute;left:93.18px;top:280.67px" class="cls_039"><span class="cls_039">The </span><span class="cls_059">docker</span><span class="cls_039"> </span><span class="cls_059">run</span><span class="cls_039"> command shown here has several important components worth noting:</span></div>
<div style="position:absolute;left:108.78px;top:297.68px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Because you’ve configured the Spring Boot application in the container to run</span></div>
<div style="position:absolute;left:120.78px;top:310.67px" class="cls_039"><span class="cls_039">on port 8081, the </span><span class="cls_059">-p</span><span class="cls_039"> parameter maps the internal port to the host’s port 8080.</span></div>
<div style="position:absolute;left:108.78px;top:324.68px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  The </span><span class="cls_059">--link</span><span class="cls_039"> parameter links your container to the container named </span><span class="cls_059">tacocloud-</span></div>
<div style="position:absolute;left:120.78px;top:337.67px" class="cls_059"><span class="cls_059">mongo</span><span class="cls_039"> and assigns it a hostname of </span><span class="cls_059">mongo</span><span class="cls_039"> so that Spring Data can connect to it with</span></div>
<div style="position:absolute;left:120.78px;top:350.66px" class="cls_039"><span class="cls_039">that hostname.</span></div>
<div style="position:absolute;left:108.78px;top:364.67px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Finally, you specify the name of the image (in this case, </span><span class="cls_059">tacocloud/ingredient-</span></div>
<div style="position:absolute;left:120.78px;top:377.66px" class="cls_059"><span class="cls_059">service</span><span class="cls_039">) to run in a new container.</span></div>
<div style="position:absolute;left:93.18px;top:395.66px" class="cls_039"><span class="cls_039">Now that you have a Docker image built and have proven it to run as a local container,</span></div>
<div style="position:absolute;left:93.18px;top:408.68px" class="cls_039"><span class="cls_039">you can take it to the next level by pushing the image to Dockerhub or some other</span></div>
<div style="position:absolute;left:93.18px;top:421.67px" class="cls_039"><span class="cls_039">Docker image repository. If you have an account on Dockerhub and are logged in,</span></div>
<div style="position:absolute;left:93.18px;top:434.66px" class="cls_039"><span class="cls_039">then you can push the image using Maven like this:</span></div>
<div style="position:absolute;left:93.18px;top:457.34px" class="cls_061"><span class="cls_061">$ mvnw dockerfile:push</span></div>
<div style="position:absolute;left:93.18px;top:477.68px" class="cls_039"><span class="cls_039">From that point, you can deploy the image to almost any environment that supports</span></div>
<div style="position:absolute;left:93.18px;top:490.67px" class="cls_039"><span class="cls_039">Docker containers, including AWS, Microsoft Azure, and Google Cloud Platform. Pick</span></div>
<div style="position:absolute;left:93.18px;top:503.66px" class="cls_039"><span class="cls_039">your environment and follow the platform-specific instructions for deploying Docker</span></div>
<div style="position:absolute;left:93.18px;top:516.68px" class="cls_039"><span class="cls_039">containers. Here are links to instructions for a few popular cloud platforms:</span></div>
<div style="position:absolute;left:108.78px;top:533.66px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  AWS</span><span class="cls_039">—</span><a href="https://aws.amazon.com/getting-started/tutorials/deploy-docker-containers/">https://aws.amazon.com/getting-started/tutorials/deploy-docker-</a> </div>
<div style="position:absolute;left:120.78px;top:546.68px" class="cls_045"><span class="cls_045"> </span><a href="https://aws.amazon.com/getting-started/tutorials/deploy-docker-containers/">containers/</a> </div>
<div style="position:absolute;left:108.78px;top:560.69px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Microsoft Azure</span><span class="cls_039">—</span><a href="https://docs.docker.com/docker-for-azure/deploy/">https://docs.docker.com/docker-for-azure/deploy/</a> </div>
<div style="position:absolute;left:108.78px;top:574.67px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Google Cloud Platform</span><span class="cls_039">—</span><a href="https://cloud.google.com/kubernetes-engine/docs/tutorials/hello-app">https://cloud.google.com/kubernetes-engine/docs/</a> </div>
<div style="position:absolute;left:120.78px;top:587.69px" class="cls_045"><span class="cls_045"> </span><a href="https://cloud.google.com/kubernetes-engine/docs/tutorials/hello-app">tutorials/hello-app</a> </div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:322448px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background487.jpg" width="531" height="666"></div>
<div style="position:absolute;left:253.20px;top:24.35px" class="cls_055"><span class="cls_055">Summary</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_052"><span class="cls_052">465</span></div>
<div style="position:absolute;left:117.78px;top:50.66px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Pivotal Web Services (PWS)</span><span class="cls_039">—</span><a href="https://docs.run.pivotal.io/devguide/deploy-apps/push-docker.html">https://docs.run.pivotal.io/devguide/deploy-apps/</a> </div>
<div style="position:absolute;left:129.78px;top:63.65px" class="cls_045"><span class="cls_045"> </span><a href="https://docs.run.pivotal.io/devguide/deploy-apps/push-docker.html">push-docker.html</a> </div>
<div style="position:absolute;left:117.78px;top:81.65px" class="cls_062"><span class="cls_062"></span><span class="cls_036">  Pivotal Container Service (PKS)</span><span class="cls_039">—</span><a href="https://pivotal.io/platform/pivotal-container-service">https://pivotal.io/platform/pivotal-container-service</a> </div>
<div style="position:absolute;left:66.18px;top:102.82px" class="cls_040"><span class="cls_040">19.5</span></div>
<div style="position:absolute;left:102.18px;top:102.82px" class="cls_040"><span class="cls_040">The end is where we begin</span></div>
<div style="position:absolute;left:102.18px;top:120.65px" class="cls_039"><span class="cls_039">Over the past few hundred pages, we’ve gone from a simple start—or start.spring.io,</span></div>
<div style="position:absolute;left:102.18px;top:133.67px" class="cls_039"><span class="cls_039">more specifically—to deploying an application in the cloud. I hope that you’ve had as</span></div>
<div style="position:absolute;left:102.18px;top:146.66px" class="cls_039"><span class="cls_039">much fun working through these pages as I’ve had writing them.</span></div>
<div style="position:absolute;left:116.78px;top:159.65px" class="cls_039"><span class="cls_039">But while this book must come to an end, your Spring adventure is just beginning.</span></div>
<div style="position:absolute;left:102.18px;top:172.67px" class="cls_039"><span class="cls_039">Using what you’ve learned in these pages, go build something amazing with Spring. I</span></div>
<div style="position:absolute;left:102.18px;top:185.66px" class="cls_039"><span class="cls_039">can’t wait to see what you come up with!</span></div>
<div style="position:absolute;left:102.18px;top:206.83px" class="cls_040"><span class="cls_040">Summary</span></div>
<div style="position:absolute;left:117.78px;top:225.17px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Spring applications can be deployed in a number of different environments,</span></div>
<div style="position:absolute;left:129.78px;top:238.16px" class="cls_039"><span class="cls_039">including traditional application servers, platform-as-a-service (PaaS) environ-</span></div>
<div style="position:absolute;left:129.78px;top:251.15px" class="cls_039"><span class="cls_039">ments like Cloud Foundry, or as Docker containers.</span></div>
<div style="position:absolute;left:117.78px;top:265.16px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  When building a WAR file, you should include a class that subclasses </span><span class="cls_059">Spring-</span></div>
<div style="position:absolute;left:129.78px;top:278.15px" class="cls_059"><span class="cls_059">BootServletInitializr</span><span class="cls_039"> to ensure that Spring’s </span><span class="cls_059">DispatcherServlet</span><span class="cls_039"> is prop-</span></div>
<div style="position:absolute;left:129.78px;top:291.17px" class="cls_039"><span class="cls_039">erly configured.</span></div>
<div style="position:absolute;left:117.78px;top:305.18px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Building as an executable JAR file allows a Spring Boot application to be</span></div>
<div style="position:absolute;left:129.78px;top:318.17px" class="cls_039"><span class="cls_039">deployed to several cloud platforms without the overhead of a WAR file.</span></div>
<div style="position:absolute;left:117.78px;top:332.18px" class="cls_062"><span class="cls_062"></span><span class="cls_039">  Containerizing Spring applications is as simple as using Spotify’s Dockerfile</span></div>
<div style="position:absolute;left:129.78px;top:345.17px" class="cls_039"><span class="cls_039">plugin for Maven. It wraps an executable JAR file in a Docker container that</span></div>
<div style="position:absolute;left:129.78px;top:358.16px" class="cls_039"><span class="cls_039">can be deployed anywhere Docker containers can be deployed, including</span></div>
<div style="position:absolute;left:129.78px;top:371.18px" class="cls_039"><span class="cls_039">cloud providers such as Amazon Web Services, Microsoft Azure, Google Cloud</span></div>
<div style="position:absolute;left:129.78px;top:384.17px" class="cls_039"><span class="cls_039">Platform, Pivotal Web Services (PWS), and Pivotal Container Service (PKS).</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:323124px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background488.jpg" width="531" height="666"></div>
<div style="position:absolute;left:354.18px;top:111.83px" class="cls_014"><span class="cls_014">appendix</span></div>
<div style="position:absolute;left:299.58px;top:141.83px" class="cls_014"><span class="cls_014">Bootstrapping</span></div>
<div style="position:absolute;left:234.78px;top:173.84px" class="cls_014"><span class="cls_014">Spring applications</span></div>
<div style="position:absolute;left:102.18px;top:251.54px" class="cls_039"><span class="cls_039">There are a lot of ways to kick-start your Spring projects, and which you choose is</span></div>
<div style="position:absolute;left:102.18px;top:264.53px" class="cls_039"><span class="cls_039">largely a matter of personal taste. Many of the choices will be decided by which is</span></div>
<div style="position:absolute;left:102.18px;top:277.55px" class="cls_039"><span class="cls_039">your favorite IDE.</span></div>
<div style="position:absolute;left:117.06px;top:290.54px" class="cls_039"><span class="cls_039">All but one of these options are based on the Spring Initializr, which is a REST</span></div>
<div style="position:absolute;left:102.18px;top:303.53px" class="cls_039"><span class="cls_039">API that generates Spring Boot projects for you. The various IDE choices are noth-</span></div>
<div style="position:absolute;left:102.18px;top:316.55px" class="cls_039"><span class="cls_039">ing more than clients for that REST API. Additionally, there are a few ways to use</span></div>
<div style="position:absolute;left:102.18px;top:329.54px" class="cls_039"><span class="cls_039">the Spring Initializr API outside of your IDE.</span></div>
<div style="position:absolute;left:116.77px;top:342.53px" class="cls_039"><span class="cls_039">This appendix takes a quick look at all of these options.</span></div>
<div style="position:absolute;left:66.18px;top:363.70px" class="cls_040"><span class="cls_040">A.1</span></div>
<div style="position:absolute;left:102.18px;top:363.70px" class="cls_040"><span class="cls_040">Initializing a project with Spring Tool Suite</span></div>
<div style="position:absolute;left:102.18px;top:381.53px" class="cls_039"><span class="cls_039">To initialize a new Spring project with Spring Tool Suite, choose the Spring Starter</span></div>
<div style="position:absolute;left:102.18px;top:394.55px" class="cls_039"><span class="cls_039">Project menu option from the File &gt; New menu, as shown in figure A.1.</span></div>
<div style="position:absolute;left:102.18px;top:459.98px" class="cls_053"><span class="cls_053">Figure A.1</span></div>
<div style="position:absolute;left:147.12px;top:459.98px" class="cls_053"><span class="cls_053">Starting a new project in Spring Tool Suite</span></div>
<div style="position:absolute;left:114.18px;top:491.51px" class="cls_083"><span class="cls_083">NOTE</span><span class="cls_107">  This is an abbreviated description of using Spring Tool Suite to ini-</span></div>
<div style="position:absolute;left:114.18px;top:503.51px" class="cls_107"><span class="cls_107">tialize a Spring project. For a more detailed explanation, see section 1.2.1.</span></div>
<div style="position:absolute;left:102.18px;top:523.52px" class="cls_039"><span class="cls_039">You’ll be shown the first page of the project creation dialog box (figure A.2). On</span></div>
<div style="position:absolute;left:102.18px;top:536.51px" class="cls_039"><span class="cls_039">this page, you’ll define basic project information, such as the project’s name, coor-</span></div>
<div style="position:absolute;left:102.18px;top:549.53px" class="cls_039"><span class="cls_039">dinates (group ID and artifact ID), version, and base package name. You can also</span></div>
<div style="position:absolute;left:102.18px;top:562.52px" class="cls_039"><span class="cls_039">specify whether the project will be built with Maven or Gradle, whether the build</span></div>
<div style="position:absolute;left:257.16px;top:596.99px" class="cls_024"><span class="cls_024">466</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:323800px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background489.jpg" width="531" height="666"></div>
<div style="position:absolute;left:192.27px;top:24.35px" class="cls_108"><span class="cls_108">Initializing a project with Spring Tool Suite</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_024"><span class="cls_024">467</span></div>
<div style="position:absolute;left:102.18px;top:473.09px" class="cls_053"><span class="cls_053">Figure A.2</span></div>
<div style="position:absolute;left:147.13px;top:473.09px" class="cls_053"><span class="cls_053">Defining basic project information</span></div>
<div style="position:absolute;left:102.18px;top:500.36px" class="cls_039"><span class="cls_039">will produce a JAR file or a WAR file, which version of Java to build with, and even an</span></div>
<div style="position:absolute;left:102.18px;top:513.35px" class="cls_039"><span class="cls_039">alternate JVM language to use, such as Groovy or Kotlin.</span></div>
<div style="position:absolute;left:117.22px;top:526.37px" class="cls_039"><span class="cls_039">The first field on this page asks you to specify the location of the Spring Initializr</span></div>
<div style="position:absolute;left:102.18px;top:539.36px" class="cls_039"><span class="cls_039">service. If you’re running or using a custom instance of the Initializr, you’ll want to</span></div>
<div style="position:absolute;left:102.18px;top:552.35px" class="cls_039"><span class="cls_039">specify the base URL of the Initializr service here. Otherwise, you’ll be fine leaving it</span></div>
<div style="position:absolute;left:102.18px;top:565.37px" class="cls_039"><span class="cls_039">with the default that points to </span><a href="http://start.spring.io/">http://start.spring.io</a> <span class="cls_039">.</span></div>
<div style="position:absolute;left:117.78px;top:578.36px" class="cls_039"><span class="cls_039">After you’ve defined the basic project information, click Next to see the project</span></div>
<div style="position:absolute;left:102.18px;top:591.35px" class="cls_039"><span class="cls_039">dependencies page (figure A.3).</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:324476px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background490.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_024"><span class="cls_024">468</span></div>
<div style="position:absolute;left:180.78px;top:24.35px" class="cls_109"><span class="cls_109">APPENDIX</span><span class="cls_108">   Bootstrapping Spring applications</span></div>
<div style="position:absolute;left:93.18px;top:472.04px" class="cls_053"><span class="cls_053">Figure A.3</span></div>
<div style="position:absolute;left:138.12px;top:472.04px" class="cls_053"><span class="cls_053">Specifying project dependencies</span></div>
<div style="position:absolute;left:93.18px;top:497.36px" class="cls_039"><span class="cls_039">On the project dependencies page, you can specify all of the dependencies your proj-</span></div>
<div style="position:absolute;left:93.18px;top:510.35px" class="cls_039"><span class="cls_039">ect will need. Many of these dependencies are Spring Boot Starter dependencies,</span></div>
<div style="position:absolute;left:93.18px;top:523.34px" class="cls_039"><span class="cls_039">although some other dependencies are commonly used in Spring projects.</span></div>
<div style="position:absolute;left:107.53px;top:536.36px" class="cls_039"><span class="cls_039">The available dependencies are listed on the left side, organized in groups that can</span></div>
<div style="position:absolute;left:93.18px;top:549.35px" class="cls_039"><span class="cls_039">be expanded or collapsed. If you’re having trouble finding a dependency, you can also</span></div>
<div style="position:absolute;left:93.18px;top:562.37px" class="cls_039"><span class="cls_039">search for dependencies to narrow your choices down.</span></div>
<div style="position:absolute;left:107.70px;top:575.36px" class="cls_039"><span class="cls_039">To add a dependency to the generated project, check the check box next to the</span></div>
<div style="position:absolute;left:93.18px;top:588.35px" class="cls_039"><span class="cls_039">dependency name. Your selections will appear in the list on the right side under</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:325152px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background491.jpg" width="531" height="666"></div>
<div style="position:absolute;left:192.27px;top:24.35px" class="cls_108"><span class="cls_108">Initializing a project with Spring Tool Suite</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_024"><span class="cls_024">469</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">the Selected header. You can remove a dependency by clicking the X next to the</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">selected dependency. Or click Clear Selection to remove all selected dependencies.</span></div>
<div style="position:absolute;left:116.71px;top:76.67px" class="cls_039"><span class="cls_039">As an added convenience, if you find that you have a certain core set of dependen-</span></div>
<div style="position:absolute;left:102.18px;top:89.66px" class="cls_039"><span class="cls_039">cies that you always (or often) use for your projects, you can click the Make Default</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">button after selecting those dependencies, and they’ll already be checked the next</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">time you create a project.</span></div>
<div style="position:absolute;left:116.52px;top:128.66px" class="cls_039"><span class="cls_039">After making your selections, click Finish to generate the project and add it to your</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">workspace.</span></div>
<div style="position:absolute;left:116.88px;top:154.67px" class="cls_039"><span class="cls_039">If, however, you want to use an Initializr other than the one at </span><a href="http://start.spring.io/">http://start.spring.io</a> <span class="cls_039">,</span></div>
<div style="position:absolute;left:102.18px;top:167.66px" class="cls_039"><span class="cls_039">click Next to set the Initializr base URL, as shown in figure A.4.</span></div>
<div style="position:absolute;left:102.18px;top:593.93px" class="cls_053"><span class="cls_053">Figure A.4</span></div>
<div style="position:absolute;left:147.14px;top:593.93px" class="cls_053"><span class="cls_053">Optionally specifying the Initializr base URL</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:325828px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background492.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_024"><span class="cls_024">470</span></div>
<div style="position:absolute;left:180.78px;top:24.35px" class="cls_109"><span class="cls_109">APPENDIX</span><span class="cls_108">   Bootstrapping Spring applications</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">The Base Url field specifies the URL where the Initializr API is listening. This is the</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">only field you can change on this page. The Full Url field shows the complete URL</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">that will be used to request a new project from the Initializr.</span></div>
<div style="position:absolute;left:57.18px;top:97.81px" class="cls_040"><span class="cls_040">A.2</span></div>
<div style="position:absolute;left:93.18px;top:97.81px" class="cls_040"><span class="cls_040">Initializing a project with IntelliJ IDEA</span></div>
<div style="position:absolute;left:93.18px;top:115.67px" class="cls_039"><span class="cls_039">To get started on a new Spring project in IntelliJ IDEA, choose the Project menu item</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">from the File &gt; New menu, as shown in figure A.5.</span></div>
<div style="position:absolute;left:93.18px;top:190.70px" class="cls_053"><span class="cls_053">Figure A.5</span></div>
<div style="position:absolute;left:138.13px;top:190.70px" class="cls_053"><span class="cls_053">Starting a new Spring project in IntelliJ IDEA</span></div>
<div style="position:absolute;left:93.18px;top:213.35px" class="cls_039"><span class="cls_039">This opens up the first page of a new Spring Initializr project wizard (see figure A.6).</span></div>
<div style="position:absolute;left:93.18px;top:226.34px" class="cls_039"><span class="cls_039">On this page, you can usually just click Next to go to the next page of the wizard. But</span></div>
<div style="position:absolute;left:57.18px;top:593.93px" class="cls_053"><span class="cls_053">Figure A.6</span></div>
<div style="position:absolute;left:102.13px;top:593.93px" class="cls_053"><span class="cls_053">Selecting the location of the Spring Initializr</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:326504px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background493.jpg" width="531" height="666"></div>
<div style="position:absolute;left:200.07px;top:24.35px" class="cls_108"><span class="cls_108">Initializing a project with IntelliJ IDEA</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_024"><span class="cls_024">471</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">if you want to use a Spring Initializr different from the one at </span><a href="https://start.spring.io/">https://start.spring.io</a> <span class="cls_039">,</span></div>
<div style="position:absolute;left:102.18px;top:63.65px" class="cls_039"><span class="cls_039">you’ll need to select the Custom radio button and enter the base URL of the Spring</span></div>
<div style="position:absolute;left:102.18px;top:76.67px" class="cls_039"><span class="cls_039">Initializr you want to use.</span></div>
<div style="position:absolute;left:117.29px;top:89.66px" class="cls_039"><span class="cls_039">After clicking Next, you’ll be presented with a page that asks for essential project</span></div>
<div style="position:absolute;left:102.18px;top:102.65px" class="cls_039"><span class="cls_039">information, as shown in figure A.7. You may recognize some of the fields on this page</span></div>
<div style="position:absolute;left:102.18px;top:115.67px" class="cls_039"><span class="cls_039">as information that might appear in a Maven pom.xml file—in fact, if you select</span></div>
<div style="position:absolute;left:102.18px;top:128.66px" class="cls_039"><span class="cls_039">Maven Project from the Type field, that’s exactly how it will be used. You’re welcome</span></div>
<div style="position:absolute;left:102.18px;top:141.65px" class="cls_039"><span class="cls_039">to choose Gradle Project instead if Gradle is your preference.</span></div>
<div style="position:absolute;left:66.18px;top:520.13px" class="cls_053"><span class="cls_053">Figure A.7</span></div>
<div style="position:absolute;left:111.13px;top:520.13px" class="cls_053"><span class="cls_053">Specifying essential project information in IntelliJ IDEA</span></div>
<div style="position:absolute;left:102.18px;top:559.76px" class="cls_039"><span class="cls_039">Once you’ve filled in the essential project information, click Next to be shown the</span></div>
<div style="position:absolute;left:102.18px;top:572.75px" class="cls_039"><span class="cls_039">project dependencies page (figure A.8).</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:327180px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background494.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_024"><span class="cls_024">472</span></div>
<div style="position:absolute;left:180.78px;top:24.35px" class="cls_109"><span class="cls_109">APPENDIX</span><span class="cls_108">   Bootstrapping Spring applications</span></div>
<div style="position:absolute;left:57.18px;top:401.09px" class="cls_053"><span class="cls_053">Figure A.8</span></div>
<div style="position:absolute;left:102.13px;top:401.09px" class="cls_053"><span class="cls_053">Selecting project dependencies</span></div>
<div style="position:absolute;left:93.18px;top:434.15px" class="cls_039"><span class="cls_039">The dependencies are organized by category in the far-left list. Selecting a category</span></div>
<div style="position:absolute;left:93.18px;top:447.14px" class="cls_039"><span class="cls_039">will result in that category’s options being presented in the middle list. Your selected</span></div>
<div style="position:absolute;left:93.18px;top:460.13px" class="cls_039"><span class="cls_039">dependencies will be listed (according to category) in the right list.</span></div>
<div style="position:absolute;left:108.03px;top:473.15px" class="cls_039"><span class="cls_039">After all of your dependencies have been selected, click Next. You’ll be presented</span></div>
<div style="position:absolute;left:93.18px;top:486.14px" class="cls_039"><span class="cls_039">with the final page of the project wizard, as shown in figure A.9, which asks you to</span></div>
<div style="position:absolute;left:93.18px;top:499.13px" class="cls_039"><span class="cls_039">name the project and specify where the project should reside on your disk.</span></div>
<div style="position:absolute;left:109.11px;top:512.15px" class="cls_039"><span class="cls_039">Click Finish and your project will be created and loaded into the IntelliJ IDEA</span></div>
<div style="position:absolute;left:93.18px;top:525.14px" class="cls_039"><span class="cls_039">workspace.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:327856px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background495.jpg" width="531" height="666"></div>
<div style="position:absolute;left:206.55px;top:24.35px" class="cls_108"><span class="cls_108">Initializing a project with NetBeans</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_024"><span class="cls_024">473</span></div>
<div style="position:absolute;left:66.18px;top:400.55px" class="cls_053"><span class="cls_053">Figure A.9</span></div>
<div style="position:absolute;left:111.13px;top:400.55px" class="cls_053"><span class="cls_053">Setting the project name and location</span></div>
<div style="position:absolute;left:66.18px;top:430.51px" class="cls_040"><span class="cls_040">A.3</span></div>
<div style="position:absolute;left:102.18px;top:430.51px" class="cls_040"><span class="cls_040">Initializing a project with NetBeans</span></div>
<div style="position:absolute;left:102.18px;top:448.34px" class="cls_039"><span class="cls_039">To create a new Spring project in NetBeans, start by selecting the New Project menu</span></div>
<div style="position:absolute;left:102.18px;top:461.36px" class="cls_039"><span class="cls_039">item under the File menu, as shown in figure A.10.</span></div>
<div style="position:absolute;left:117.20px;top:474.35px" class="cls_039"><span class="cls_039">You’ll be shown the first page of the new project wizard. As shown in figure A.11,</span></div>
<div style="position:absolute;left:102.18px;top:487.34px" class="cls_039"><span class="cls_039">this page will let you choose what kind of project you want to create.</span></div>
<div style="position:absolute;left:116.69px;top:500.36px" class="cls_039"><span class="cls_039">For a Spring Boot project, select Maven from the category list on the left, and then</span></div>
<div style="position:absolute;left:102.18px;top:513.35px" class="cls_039"><span class="cls_039">select Spring Boot Initializr Project from the project list on the right. Then click Next</span></div>
<div style="position:absolute;left:102.18px;top:526.34px" class="cls_039"><span class="cls_039">to move to the next page.</span></div>
<div style="position:absolute;left:116.74px;top:539.36px" class="cls_039"><span class="cls_039">The second page in the new project wizard (figure A.12) lets you set essential proj-</span></div>
<div style="position:absolute;left:102.18px;top:552.35px" class="cls_039"><span class="cls_039">ect information, such as the project name, version, and other information that will</span></div>
<div style="position:absolute;left:102.18px;top:565.37px" class="cls_039"><span class="cls_039">ultimately be used to define the project in a Maven pom.xml file.</span></div>
<div style="position:absolute;left:117.36px;top:578.36px" class="cls_039"><span class="cls_039">After you’ve specified the basic project information, click Next to navigate to the</span></div>
<div style="position:absolute;left:102.18px;top:591.35px" class="cls_039"><span class="cls_039">dependencies page in the new project wizard, shown in figure A.13.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:328532px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background496.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_024"><span class="cls_024">474</span></div>
<div style="position:absolute;left:180.78px;top:24.35px" class="cls_109"><span class="cls_109">APPENDIX</span><span class="cls_108">   Bootstrapping Spring applications</span></div>
<div style="position:absolute;left:277.68px;top:235.55px" class="cls_053"><span class="cls_053">Figure A.10</span></div>
<div style="position:absolute;left:327.41px;top:235.55px" class="cls_053"><span class="cls_053">Starting a new</span></div>
<div style="position:absolute;left:277.68px;top:245.57px" class="cls_053"><span class="cls_053">Spring project in NetBeans</span></div>
<div style="position:absolute;left:93.18px;top:567.71px" class="cls_053"><span class="cls_053">Figure A.11</span></div>
<div style="position:absolute;left:142.94px;top:567.71px" class="cls_053"><span class="cls_053">Creating a new Spring Boot Initializr project</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:329208px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background497.jpg" width="531" height="666"></div>
<div style="position:absolute;left:206.55px;top:24.35px" class="cls_108"><span class="cls_108">Initializing a project with NetBeans</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_024"><span class="cls_024">475</span></div>
<div style="position:absolute;left:102.18px;top:305.09px" class="cls_053"><span class="cls_053">Figure A.12</span></div>
<div style="position:absolute;left:151.93px;top:305.09px" class="cls_053"><span class="cls_053">Specifying essential project information</span></div>
<div style="position:absolute;left:102.18px;top:594.80px" class="cls_053"><span class="cls_053">Figure A.13</span></div>
<div style="position:absolute;left:151.93px;top:594.80px" class="cls_053"><span class="cls_053">Selecting project dependencies</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:329884px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background498.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_024"><span class="cls_024">476</span></div>
<div style="position:absolute;left:180.78px;top:24.35px" class="cls_109"><span class="cls_109">APPENDIX</span><span class="cls_108">   Bootstrapping Spring applications</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">Dependencies are all listed as check boxes in the same list, organized by category. If</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">you have trouble finding the specific dependency you need, you can use the Filter text</span></div>
<div style="position:absolute;left:93.18px;top:76.67px" class="cls_039"><span class="cls_039">box at the top to limit the list of options.</span></div>
<div style="position:absolute;left:108.21px;top:89.66px" class="cls_039"><span class="cls_039">You can also specify which version of Spring Boot you wish to use on this page. It</span></div>
<div style="position:absolute;left:93.18px;top:102.65px" class="cls_039"><span class="cls_039">will be set to the current generally available version of Spring Boot by default.</span></div>
<div style="position:absolute;left:108.15px;top:115.67px" class="cls_039"><span class="cls_039">Once you’ve selected the dependencies for your project, click Next to navigate to</span></div>
<div style="position:absolute;left:93.18px;top:128.66px" class="cls_039"><span class="cls_039">the last page of the new project wizard, shown in figure A.14.</span></div>
<div style="position:absolute;left:93.18px;top:403.79px" class="cls_053"><span class="cls_053">Figure A.14</span></div>
<div style="position:absolute;left:142.93px;top:403.79px" class="cls_053"><span class="cls_053">Specifying the project’s name and location</span></div>
<div style="position:absolute;left:93.18px;top:437.81px" class="cls_039"><span class="cls_039">This page lets you specify some final details about the project, including the project</span></div>
<div style="position:absolute;left:93.18px;top:450.83px" class="cls_039"><span class="cls_039">name and location on the filesystem. (The Project Folder field is read-only and</span></div>
<div style="position:absolute;left:93.18px;top:463.82px" class="cls_039"><span class="cls_039">derived from the other two fields.) It also gives you the option to run and debug your</span></div>
<div style="position:absolute;left:93.18px;top:476.81px" class="cls_039"><span class="cls_039">project through the Maven Spring Boot plugin instead of through NetBeans. You may</span></div>
<div style="position:absolute;left:93.18px;top:489.83px" class="cls_039"><span class="cls_039">also choose to have NetBeans remove the Maven wrapper from the generated project.</span></div>
<div style="position:absolute;left:108.66px;top:502.82px" class="cls_039"><span class="cls_039">Once you’ve set the final bit of project information, click Finish to generate the</span></div>
<div style="position:absolute;left:93.18px;top:515.81px" class="cls_039"><span class="cls_039">project and have it added to your NetBeans workspace.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:330560px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background499.jpg" width="531" height="666"></div>
<div style="position:absolute;left:202.59px;top:24.35px" class="cls_108"><span class="cls_108">Initializing a project at start.spring.io</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_024"><span class="cls_024">477</span></div>
<div style="position:absolute;left:66.18px;top:49.81px" class="cls_040"><span class="cls_040">A.4</span></div>
<div style="position:absolute;left:102.18px;top:49.81px" class="cls_040"><span class="cls_040">Initializing a project at start.spring.io</span></div>
<div style="position:absolute;left:102.18px;top:67.67px" class="cls_039"><span class="cls_039">Although one of the IDE-based initialization options described thus far will likely suit</span></div>
<div style="position:absolute;left:102.18px;top:80.66px" class="cls_039"><span class="cls_039">your needs, it’s possible that you may use a completely different IDE, or you might</span></div>
<div style="position:absolute;left:102.18px;top:93.65px" class="cls_039"><span class="cls_039">favor working with a simpler text editor. In that case, you can still take advantage of</span></div>
<div style="position:absolute;left:102.18px;top:106.67px" class="cls_039"><span class="cls_039">the Spring Initializr using the Initializr web-based interface.</span></div>
<div style="position:absolute;left:118.82px;top:119.66px" class="cls_039"><span class="cls_039">To get started, direct your favorite web browser to </span><a href="https://start.spring.io/">https://start.spring.io</a> <span class="cls_039">. You</span></div>
<div style="position:absolute;left:102.18px;top:132.65px" class="cls_039"><span class="cls_039">should see the simple version of the Spring Initializr web user interface, shown in fig-</span></div>
<div style="position:absolute;left:102.18px;top:145.67px" class="cls_039"><span class="cls_039">ure A.15.</span></div>
<div style="position:absolute;left:66.18px;top:442.25px" class="cls_053"><span class="cls_053">Figure A.15</span></div>
<div style="position:absolute;left:115.93px;top:442.25px" class="cls_053"><span class="cls_053">The simple version of the Spring Initializr web interface</span></div>
<div style="position:absolute;left:102.18px;top:481.07px" class="cls_039"><span class="cls_039">In the simple version of the Initializr web application, you’re only asked for some very</span></div>
<div style="position:absolute;left:102.18px;top:494.06px" class="cls_039"><span class="cls_039">basic information, including whether you want to build with Maven or Gradle, which</span></div>
<div style="position:absolute;left:102.18px;top:507.08px" class="cls_039"><span class="cls_039">language you want to develop the project with, which version of Spring Boot to build</span></div>
<div style="position:absolute;left:102.18px;top:520.07px" class="cls_039"><span class="cls_039">against, and the group and artifact IDs of the project.</span></div>
<div style="position:absolute;left:117.07px;top:533.06px" class="cls_039"><span class="cls_039">You’ll also have the option of specifying dependencies by typing search criteria in</span></div>
<div style="position:absolute;left:102.18px;top:546.08px" class="cls_039"><span class="cls_039">the Search for Dependencies box. For example, as shown in figure A.16, you can type</span></div>
<div style="position:absolute;left:102.18px;top:559.07px" class="cls_039"><span class="cls_039">“web” to search for any dependencies where “web” is a keyword.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:331236px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background500.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_024"><span class="cls_024">478</span></div>
<div style="position:absolute;left:180.78px;top:24.35px" class="cls_109"><span class="cls_109">APPENDIX</span><span class="cls_108">   Bootstrapping Spring applications</span></div>
<div style="position:absolute;left:57.18px;top:340.73px" class="cls_053"><span class="cls_053">Figure A.16</span></div>
<div style="position:absolute;left:106.93px;top:340.73px" class="cls_053"><span class="cls_053">Searching for dependencies</span></div>
<div style="position:absolute;left:93.18px;top:378.41px" class="cls_039"><span class="cls_039">When you see the dependency you want, press Return on your keyboard to select it,</span></div>
<div style="position:absolute;left:93.18px;top:391.43px" class="cls_039"><span class="cls_039">and it will be added to the list of selected dependencies. The boxes beneath Selected</span></div>
<div style="position:absolute;left:93.18px;top:404.42px" class="cls_039"><span class="cls_039">Dependencies in figure A.17 show that the Web, Thymeleaf, DevTools, and Lombok</span></div>
<div style="position:absolute;left:93.18px;top:417.41px" class="cls_039"><span class="cls_039">dependencies have been selected.</span></div>
<div style="position:absolute;left:108.71px;top:430.43px" class="cls_039"><span class="cls_039">If you decide you don’t need a selected dependency, you can click the X to the</span></div>
<div style="position:absolute;left:93.18px;top:443.42px" class="cls_039"><span class="cls_039">right of the dependency entry to remove it.</span></div>
<div style="position:absolute;left:108.29px;top:456.41px" class="cls_039"><span class="cls_039">When you’re finished, you can click the Generate Project button (or use the key-</span></div>
<div style="position:absolute;left:93.18px;top:469.43px" class="cls_039"><span class="cls_039">board shortcut displayed on the button, which will vary by operating system) to have</span></div>
<div style="position:absolute;left:93.18px;top:482.42px" class="cls_039"><span class="cls_039">the Initializr generate the project and download it as a zip file. Then you can unzip</span></div>
<div style="position:absolute;left:93.18px;top:495.41px" class="cls_039"><span class="cls_039">the project and load it in whatever IDE or editor you choose.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:331912px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background501.jpg" width="531" height="666"></div>
<div style="position:absolute;left:202.59px;top:24.35px" class="cls_108"><span class="cls_108">Initializing a project at start.spring.io</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_024"><span class="cls_024">479</span></div>
<div style="position:absolute;left:66.18px;top:342.71px" class="cls_053"><span class="cls_053">Figure A.17</span></div>
<div style="position:absolute;left:115.93px;top:342.71px" class="cls_053"><span class="cls_053">Selecting dependencies</span></div>
<div style="position:absolute;left:102.18px;top:379.49px" class="cls_039"><span class="cls_039">If you prefer a little more control, you can click the Switch to the Full Version link</span></div>
<div style="position:absolute;left:102.18px;top:392.48px" class="cls_039"><span class="cls_039">under Generate Project to expand the user interface with more fields and a complete</span></div>
<div style="position:absolute;left:102.18px;top:405.50px" class="cls_039"><span class="cls_039">listing of check boxes for all available dependencies. Figure A.18 shows a little bit of</span></div>
<div style="position:absolute;left:102.18px;top:418.49px" class="cls_039"><span class="cls_039">what the full version of the web interface looks like.</span></div>
<div style="position:absolute;left:116.75px;top:431.48px" class="cls_039"><span class="cls_039">Most of the fields in the full version are derived from the Group and Artifact fields</span></div>
<div style="position:absolute;left:102.18px;top:444.50px" class="cls_039"><span class="cls_039">or have default values when you’re using the simple version. The full version gives you</span></div>
<div style="position:absolute;left:102.18px;top:457.49px" class="cls_039"><span class="cls_039">the opportunity to override those derived/default values if you wish.</span></div>
<div style="position:absolute;left:117.26px;top:470.51px" class="cls_039"><span class="cls_039">Figure A.18 only shows a small sample of the set of dependency check boxes that</span></div>
<div style="position:absolute;left:102.18px;top:483.50px" class="cls_039"><span class="cls_039">are available in the full version, so you might scroll a lot to find what you’re looking</span></div>
<div style="position:absolute;left:102.18px;top:496.49px" class="cls_039"><span class="cls_039">for. Fortunately, the search box still works in the full version of the user interface.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:332588px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background502.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_024"><span class="cls_024">480</span></div>
<div style="position:absolute;left:180.78px;top:24.35px" class="cls_109"><span class="cls_109">APPENDIX</span><span class="cls_108">   Bootstrapping Spring applications</span></div>
<div style="position:absolute;left:57.18px;top:476.63px" class="cls_053"><span class="cls_053">Figure A.18</span></div>
<div style="position:absolute;left:106.93px;top:476.63px" class="cls_053"><span class="cls_053">The full version of the Initializr user interface</span></div>
<div style="position:absolute;left:57.18px;top:513.01px" class="cls_040"><span class="cls_040">A.5</span></div>
<div style="position:absolute;left:93.18px;top:513.01px" class="cls_040"><span class="cls_040">Initializing a project from the command line</span></div>
<div style="position:absolute;left:93.18px;top:530.87px" class="cls_039"><span class="cls_039">The IDE and browser-based user interfaces for the Spring Initializr are probably the</span></div>
<div style="position:absolute;left:93.18px;top:543.86px" class="cls_039"><span class="cls_039">most common way that you’ll bootstrap your projects. They’re all just clients of a</span></div>
<div style="position:absolute;left:93.18px;top:556.85px" class="cls_039"><span class="cls_039">REST service offered by the Initializr application. In some special cases (for example,</span></div>
<div style="position:absolute;left:93.18px;top:569.87px" class="cls_039"><span class="cls_039">in a scripted scenario), you might find it useful to consume the Initializr service</span></div>
<div style="position:absolute;left:93.18px;top:582.86px" class="cls_039"><span class="cls_039">directly from the command line.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:333264px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background503.jpg" width="531" height="666"></div>
<div style="position:absolute;left:191.46px;top:24.35px" class="cls_108"><span class="cls_108">Initializing a project from the command line</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_024"><span class="cls_024">481</span></div>
<div style="position:absolute;left:116.78px;top:50.66px" class="cls_039"><span class="cls_039">There are two ways to consume the API:</span></div>
<div style="position:absolute;left:117.78px;top:67.67px" class="cls_041"><span class="cls_041">■</span><span class="cls_107">   Using the curl command (or some similar command-line REST client command)</span></div>
<div style="position:absolute;left:117.78px;top:81.65px" class="cls_041"><span class="cls_041">■</span><span class="cls_107">   Using the Spring Boot Command Line Interface (aka, Spring Boot CLI)</span></div>
<div style="position:absolute;left:102.18px;top:99.65px" class="cls_039"><span class="cls_039">Let’s look at these options, starting with the curl command.</span></div>
<div style="position:absolute;left:66.18px;top:122.99px" class="cls_063"><span class="cls_063">A.5.1</span></div>
<div style="position:absolute;left:102.18px;top:122.99px" class="cls_063"><span class="cls_063">curl and the Initializr API</span></div>
<div style="position:absolute;left:102.18px;top:138.65px" class="cls_039"><span class="cls_039">The simplest way to bootstrap a Spring project with curl is to consume the API like this:</span></div>
<div style="position:absolute;left:102.18px;top:161.33px" class="cls_060"><span class="cls_060">% curl </span><a href="https://start.spring.io/starter.zip/">https://start.spring.io/starter.zip</a> -o demo.zip</div>
<div style="position:absolute;left:102.18px;top:182.66px" class="cls_039"><span class="cls_039">In this case, you’re requesting the /starter.zip endpoint from the Initializr, which</span></div>
<div style="position:absolute;left:102.18px;top:195.65px" class="cls_039"><span class="cls_039">will generate a Spring project and download it as a zip file. The generated project</span></div>
<div style="position:absolute;left:102.18px;top:208.67px" class="cls_039"><span class="cls_039">will be Maven-built and will have no dependencies other than the base Spring Boot</span></div>
<div style="position:absolute;left:102.18px;top:221.66px" class="cls_039"><span class="cls_039">starter dependency. All project information in the project’s pom.xml file will be set</span></div>
<div style="position:absolute;left:102.18px;top:234.65px" class="cls_039"><span class="cls_039">to default values.</span></div>
<div style="position:absolute;left:117.58px;top:247.67px" class="cls_039"><span class="cls_039">If you don’t specify otherwise, the name of the file will be starter.zip. But in this</span></div>
<div style="position:absolute;left:102.18px;top:260.66px" class="cls_039"><span class="cls_039">case, the </span><span class="cls_042">-o</span><span class="cls_039"> option specifies that the downloaded file should be named demo.zip.</span></div>
<div style="position:absolute;left:118.00px;top:273.65px" class="cls_039"><span class="cls_039">The publicly available Spring Initializr server is hosted at </span><a href="https://start.spring.io/">https://start.spring.io</a> <span class="cls_039">,</span></div>
<div style="position:absolute;left:102.18px;top:286.67px" class="cls_039"><span class="cls_039">but if you’re using a custom Initializr, you’ll need to adapt the given URL accordingly.</span></div>
<div style="position:absolute;left:117.58px;top:299.66px" class="cls_039"><span class="cls_039">You’ll probably want to specify a few more details and dependencies beyond the</span></div>
<div style="position:absolute;left:102.18px;top:312.68px" class="cls_039"><span class="cls_039">given defaults. Table A.1 lists all of the parameters (and their defaults) when consum-</span></div>
<div style="position:absolute;left:102.18px;top:325.67px" class="cls_039"><span class="cls_039">ing the Spring Initializr REST service.</span></div>
<div style="position:absolute;left:102.18px;top:348.35px" class="cls_053"><span class="cls_053">Table A.1</span></div>
<div style="position:absolute;left:144.25px;top:348.35px" class="cls_053"><span class="cls_053">Request parameters supported by the Initializr API</span></div>
<div style="position:absolute;left:125.91px;top:369.35px" class="cls_073"><span class="cls_073">Parameter</span></div>
<div style="position:absolute;left:261.21px;top:369.35px" class="cls_073"><span class="cls_073">Description</span></div>
<div style="position:absolute;left:400.47px;top:369.35px" class="cls_073"><span class="cls_073">Default value</span></div>
<div style="position:absolute;left:108.18px;top:388.34px" class="cls_061"><span class="cls_061">groupId</span></div>
<div style="position:absolute;left:195.93px;top:388.34px" class="cls_110"><span class="cls_110">The project’s group ID, for the sake of organization</span></div>
<div style="position:absolute;left:382.26px;top:388.34px" class="cls_061"><span class="cls_061">com.example</span></div>
<div style="position:absolute;left:195.93px;top:398.36px" class="cls_110"><span class="cls_110">in a Maven repository.</span></div>
<div style="position:absolute;left:108.18px;top:415.34px" class="cls_061"><span class="cls_061">artifactId</span></div>
<div style="position:absolute;left:195.93px;top:415.34px" class="cls_110"><span class="cls_110">The project’s artifact ID, as it would appear in a</span></div>
<div style="position:absolute;left:382.26px;top:415.34px" class="cls_061"><span class="cls_061">demo</span></div>
<div style="position:absolute;left:195.93px;top:425.36px" class="cls_110"><span class="cls_110">Maven repository.</span></div>
<div style="position:absolute;left:108.18px;top:442.34px" class="cls_061"><span class="cls_061">version</span></div>
<div style="position:absolute;left:195.93px;top:442.34px" class="cls_110"><span class="cls_110">The project version.</span></div>
<div style="position:absolute;left:382.26px;top:442.34px" class="cls_061"><span class="cls_061">0.0.1-SNAPSHOT</span></div>
<div style="position:absolute;left:108.18px;top:459.35px" class="cls_061"><span class="cls_061">name</span></div>
<div style="position:absolute;left:195.93px;top:459.35px" class="cls_110"><span class="cls_110">The project name. Also used to determine the</span></div>
<div style="position:absolute;left:382.26px;top:459.35px" class="cls_061"><span class="cls_061">demo</span></div>
<div style="position:absolute;left:195.93px;top:469.34px" class="cls_110"><span class="cls_110">name of the application’s main class (with an</span></div>
<div style="position:absolute;left:195.93px;top:479.36px" class="cls_061"><span class="cls_061">Application</span><span class="cls_110"> suffix).</span></div>
<div style="position:absolute;left:108.18px;top:496.34px" class="cls_061"><span class="cls_061">description</span></div>
<div style="position:absolute;left:195.93px;top:496.34px" class="cls_110"><span class="cls_110">The project description.</span></div>
<div style="position:absolute;left:382.26px;top:496.34px" class="cls_061"><span class="cls_061">Demo project for</span></div>
<div style="position:absolute;left:382.26px;top:506.36px" class="cls_061"><span class="cls_061">Spring Boot</span></div>
<div style="position:absolute;left:108.18px;top:523.34px" class="cls_061"><span class="cls_061">packageName</span></div>
<div style="position:absolute;left:195.93px;top:523.34px" class="cls_110"><span class="cls_110">The project’s base package name.</span></div>
<div style="position:absolute;left:382.26px;top:523.34px" class="cls_061"><span class="cls_061">com.example.demo</span></div>
<div style="position:absolute;left:108.18px;top:540.35px" class="cls_061"><span class="cls_061">dependencies</span></div>
<div style="position:absolute;left:195.93px;top:540.35px" class="cls_110"><span class="cls_110">Dependencies to include in the project’s build</span></div>
<div style="position:absolute;left:382.26px;top:540.35px" class="cls_110"><span class="cls_110">The base Spring Boot</span></div>
<div style="position:absolute;left:195.93px;top:550.34px" class="cls_110"><span class="cls_110">specification.</span></div>
<div style="position:absolute;left:382.26px;top:550.34px" class="cls_110"><span class="cls_110">starter</span></div>
<div style="position:absolute;left:108.18px;top:567.35px" class="cls_061"><span class="cls_061">type</span></div>
<div style="position:absolute;left:195.93px;top:567.35px" class="cls_110"><span class="cls_110">The kind of project to generate. Either </span><span class="cls_061">maven-</span></div>
<div style="position:absolute;left:382.26px;top:567.35px" class="cls_061"><span class="cls_061">maven-project</span></div>
<div style="position:absolute;left:195.93px;top:577.34px" class="cls_061"><span class="cls_061">project</span><span class="cls_110"> or </span><span class="cls_061">gradle-project</span><span class="cls_110">.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:333940px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background504.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_024"><span class="cls_024">482</span></div>
<div style="position:absolute;left:180.78px;top:24.35px" class="cls_109"><span class="cls_109">APPENDIX</span><span class="cls_108">   Bootstrapping Spring applications</span></div>
<div style="position:absolute;left:93.18px;top:51.32px" class="cls_053"><span class="cls_053">Table A.1</span></div>
<div style="position:absolute;left:135.25px;top:51.32px" class="cls_053"><span class="cls_053">Request parameters supported by the Initializr API</span><span class="cls_111"> (continued)</span></div>
<div style="position:absolute;left:116.91px;top:72.32px" class="cls_073"><span class="cls_073">Parameter</span></div>
<div style="position:absolute;left:252.21px;top:72.32px" class="cls_073"><span class="cls_073">Description</span></div>
<div style="position:absolute;left:391.47px;top:72.32px" class="cls_073"><span class="cls_073">Default value</span></div>
<div style="position:absolute;left:99.18px;top:91.34px" class="cls_061"><span class="cls_061">javaVersion</span></div>
<div style="position:absolute;left:186.93px;top:91.34px" class="cls_110"><span class="cls_110">The version of Java to build with.</span></div>
<div style="position:absolute;left:373.26px;top:91.34px" class="cls_061"><span class="cls_061">1.8</span></div>
<div style="position:absolute;left:99.18px;top:108.32px" class="cls_061"><span class="cls_061">bootVersion</span></div>
<div style="position:absolute;left:186.93px;top:108.32px" class="cls_110"><span class="cls_110">The version of Boot to build against.</span></div>
<div style="position:absolute;left:373.23px;top:108.32px" class="cls_110"><span class="cls_110">The current GA version of</span></div>
<div style="position:absolute;left:373.26px;top:118.34px" class="cls_110"><span class="cls_110">Spring Boot</span></div>
<div style="position:absolute;left:99.18px;top:135.35px" class="cls_061"><span class="cls_061">language</span></div>
<div style="position:absolute;left:186.93px;top:135.35px" class="cls_110"><span class="cls_110">The programming language to use. Either </span><span class="cls_061">java</span><span class="cls_110">,</span></div>
<div style="position:absolute;left:373.26px;top:135.35px" class="cls_061"><span class="cls_061">java</span></div>
<div style="position:absolute;left:186.93px;top:145.34px" class="cls_061"><span class="cls_061">groovy</span><span class="cls_110">, or </span><span class="cls_061">kotlin</span><span class="cls_110">.</span></div>
<div style="position:absolute;left:99.18px;top:162.35px" class="cls_061"><span class="cls_061">packaging</span></div>
<div style="position:absolute;left:186.93px;top:162.35px" class="cls_110"><span class="cls_110">How the project should be packaged. Either </span><span class="cls_061">jar</span></div>
<div style="position:absolute;left:373.26px;top:162.35px" class="cls_061"><span class="cls_061">jar</span></div>
<div style="position:absolute;left:186.93px;top:172.34px" class="cls_110"><span class="cls_110">or </span><span class="cls_061">war</span><span class="cls_110">.</span></div>
<div style="position:absolute;left:99.18px;top:189.35px" class="cls_061"><span class="cls_061">applicationName</span></div>
<div style="position:absolute;left:186.93px;top:189.35px" class="cls_110"><span class="cls_110">The name of the application.</span></div>
<div style="position:absolute;left:373.27px;top:189.35px" class="cls_110"><span class="cls_110">The value of the </span><span class="cls_061">name</span></div>
<div style="position:absolute;left:373.26px;top:199.34px" class="cls_110"><span class="cls_110">parameter</span></div>
<div style="position:absolute;left:99.18px;top:216.35px" class="cls_061"><span class="cls_061">baseDir</span></div>
<div style="position:absolute;left:186.93px;top:216.35px" class="cls_110"><span class="cls_110">The name of the base directory in the generated</span></div>
<div style="position:absolute;left:373.26px;top:216.35px" class="cls_110"><span class="cls_110">The root directory</span></div>
<div style="position:absolute;left:186.93px;top:226.34px" class="cls_110"><span class="cls_110">archive.</span></div>
<div style="position:absolute;left:93.18px;top:251.66px" class="cls_039"><span class="cls_039">You can also get this list of parameters, as well as a list of available dependencies, by</span></div>
<div style="position:absolute;left:93.18px;top:264.65px" class="cls_039"><span class="cls_039">making a simple request to the base Initializr URL:</span></div>
<div style="position:absolute;left:93.18px;top:287.33px" class="cls_060"><span class="cls_060">% curl </span><a href="https://start.spring.io/">https://start.spring.io</a> </div>
<div style="position:absolute;left:93.18px;top:308.66px" class="cls_039"><span class="cls_039">The </span><span class="cls_042">dependencies</span><span class="cls_039"> parameter is the one you’ll probably find the most useful. For</span></div>
<div style="position:absolute;left:93.18px;top:321.68px" class="cls_039"><span class="cls_039">example, suppose that you want to create a simple web project with Spring. The fol-</span></div>
<div style="position:absolute;left:93.18px;top:334.67px" class="cls_039"><span class="cls_039">lowing command-line use of curl will produce a project zip with the web starter as a</span></div>
<div style="position:absolute;left:93.18px;top:347.66px" class="cls_039"><span class="cls_039">dependency:</span></div>
<div style="position:absolute;left:93.18px;top:367.34px" class="cls_060"><span class="cls_060">% curl </span><a href="https://start.spring.io/starter.zip/">https://start.spring.io/starter.zip</a> \</div>
<div style="position:absolute;left:121.96px;top:377.33px" class="cls_060"><span class="cls_060">-d dependencies=web \</span></div>
<div style="position:absolute;left:121.95px;top:387.35px" class="cls_060"><span class="cls_060">-o demo.zip</span></div>
<div style="position:absolute;left:93.18px;top:408.68px" class="cls_039"><span class="cls_039">As a more complex example, suppose you wanted to develop a web application that</span></div>
<div style="position:absolute;left:93.18px;top:421.67px" class="cls_039"><span class="cls_039">uses Spring Data JPA for data persistence. You also want to build it with Gradle and</span></div>
<div style="position:absolute;left:93.18px;top:434.66px" class="cls_039"><span class="cls_039">the project should be under a directory named my-dir within the zip file. And let’s</span></div>
<div style="position:absolute;left:93.18px;top:447.68px" class="cls_039"><span class="cls_039">suppose that rather than just download a zip file, you want the project unpacked</span></div>
<div style="position:absolute;left:93.18px;top:460.67px" class="cls_039"><span class="cls_039">into your filesystem upon download. In that case, the following command should do</span></div>
<div style="position:absolute;left:93.18px;top:473.66px" class="cls_039"><span class="cls_039">the trick:</span></div>
<div style="position:absolute;left:93.18px;top:493.34px" class="cls_060"><span class="cls_060">% curl </span><a href="https://start.spring.io/starter.tgz/">https://start.spring.io/starter.tgz</a> \</div>
<div style="position:absolute;left:126.76px;top:503.36px" class="cls_060"><span class="cls_060">-d dependencies=web,data-jpa \</span></div>
<div style="position:absolute;left:126.76px;top:513.35px" class="cls_060"><span class="cls_060">-d type=gradle-project</span></div>
<div style="position:absolute;left:126.76px;top:523.34px" class="cls_060"><span class="cls_060">-d baseDir=my-dir | tar -xzvf -</span></div>
<div style="position:absolute;left:93.18px;top:544.67px" class="cls_039"><span class="cls_039">Here, the downloaded zip file is piped to the </span><span class="cls_042">tar</span><span class="cls_039"> command for unpacking.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:334616px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background505.jpg" width="531" height="666"></div>
<div style="position:absolute;left:191.46px;top:24.35px" class="cls_108"><span class="cls_108">Initializing a project from the command line</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_024"><span class="cls_024">483</span></div>
<div style="position:absolute;left:66.18px;top:50.48px" class="cls_063"><span class="cls_063">A.5.2</span></div>
<div style="position:absolute;left:102.18px;top:50.48px" class="cls_063"><span class="cls_063">Spring Boot command-line interface</span></div>
<div style="position:absolute;left:102.18px;top:66.17px" class="cls_039"><span class="cls_039">The Spring Boot CLI is another option for initializing Spring applications. You can</span></div>
<div style="position:absolute;left:102.18px;top:79.16px" class="cls_039"><span class="cls_039">install the Spring Boot CLI in many ways, but probably the easiest way (and my favor-</span></div>
<div style="position:absolute;left:102.18px;top:92.15px" class="cls_039"><span class="cls_039">ite) is to use SDKMAN (</span><a href="http://sdkman.io/">http://sdkman.io/</a> <span class="cls_039">):</span></div>
<div style="position:absolute;left:102.18px;top:113.84px" class="cls_060"><span class="cls_060">% sdk install springboot</span></div>
<div style="position:absolute;left:102.18px;top:135.17px" class="cls_039"><span class="cls_039">Once the Spring Boot CLI is installed, you can start using it to generate projects,</span></div>
<div style="position:absolute;left:102.18px;top:148.16px" class="cls_039"><span class="cls_039">much like with curl. The command you’ll use is </span><span class="cls_042">spring</span><span class="cls_039"> </span><span class="cls_042">init</span><span class="cls_039">. In fact, the simplest way</span></div>
<div style="position:absolute;left:102.18px;top:161.15px" class="cls_039"><span class="cls_039">to use the Spring Boot CLI to generate a project is like this:</span></div>
<div style="position:absolute;left:102.18px;top:182.84px" class="cls_060"><span class="cls_060">% spring init</span></div>
<div style="position:absolute;left:102.18px;top:204.17px" class="cls_039"><span class="cls_039">This will result in a barebones Spring Boot project being downloaded in a zip file</span></div>
<div style="position:absolute;left:102.18px;top:217.16px" class="cls_039"><span class="cls_039">named demo.zip.</span></div>
<div style="position:absolute;left:116.53px;top:230.15px" class="cls_039"><span class="cls_039">However, you’ll probably want to specify more details and dependencies. Table A.2</span></div>
<div style="position:absolute;left:102.18px;top:243.17px" class="cls_039"><span class="cls_039">lists all of the parameters available to the </span><span class="cls_042">spring</span><span class="cls_039"> </span><span class="cls_042">init</span><span class="cls_039"> command.</span></div>
<div style="position:absolute;left:102.18px;top:264.05px" class="cls_053"><span class="cls_053">Table A.2</span></div>
<div style="position:absolute;left:144.25px;top:263.75px" class="cls_053"><span class="cls_053">Request parameters supported by the </span><span class="cls_087">spring</span><span class="cls_053"> </span><span class="cls_087">init</span><span class="cls_053"> command</span></div>
<div style="position:absolute;left:122.43px;top:285.14px" class="cls_073"><span class="cls_073">Parameter</span></div>
<div style="position:absolute;left:256.65px;top:285.14px" class="cls_073"><span class="cls_073">Description</span></div>
<div style="position:absolute;left:399.42px;top:285.14px" class="cls_073"><span class="cls_073">Default value</span></div>
<div style="position:absolute;left:108.18px;top:304.13px" class="cls_061"><span class="cls_061">group-id</span></div>
<div style="position:absolute;left:188.97px;top:304.13px" class="cls_110"><span class="cls_110">The project’s group ID, for the sake of organization</span></div>
<div style="position:absolute;left:380.13px;top:304.13px" class="cls_061"><span class="cls_061">com.example</span></div>
<div style="position:absolute;left:188.97px;top:314.15px" class="cls_110"><span class="cls_110">in a Maven repository.</span></div>
<div style="position:absolute;left:108.18px;top:331.13px" class="cls_061"><span class="cls_061">artifact-id</span></div>
<div style="position:absolute;left:188.97px;top:331.13px" class="cls_110"><span class="cls_110">The project’s artifact ID, as it would appear in a</span></div>
<div style="position:absolute;left:380.13px;top:331.13px" class="cls_061"><span class="cls_061">demo</span></div>
<div style="position:absolute;left:188.97px;top:341.15px" class="cls_110"><span class="cls_110">Maven repository.</span></div>
<div style="position:absolute;left:108.18px;top:358.13px" class="cls_061"><span class="cls_061">version</span></div>
<div style="position:absolute;left:188.97px;top:358.13px" class="cls_110"><span class="cls_110">The project version.</span></div>
<div style="position:absolute;left:380.13px;top:358.13px" class="cls_061"><span class="cls_061">0.0.1-SNAPSHOT</span></div>
<div style="position:absolute;left:108.18px;top:375.14px" class="cls_061"><span class="cls_061">name</span></div>
<div style="position:absolute;left:188.97px;top:375.14px" class="cls_110"><span class="cls_110">The project name. Also used to determine the name</span></div>
<div style="position:absolute;left:380.13px;top:375.14px" class="cls_061"><span class="cls_061">demo</span></div>
<div style="position:absolute;left:188.97px;top:385.16px" class="cls_110"><span class="cls_110">of the application’s main class (with an</span></div>
<div style="position:absolute;left:188.97px;top:395.15px" class="cls_061"><span class="cls_061">Application</span><span class="cls_110"> suffix).</span></div>
<div style="position:absolute;left:108.18px;top:412.16px" class="cls_061"><span class="cls_061">description</span></div>
<div style="position:absolute;left:188.97px;top:412.16px" class="cls_110"><span class="cls_110">The project description.</span></div>
<div style="position:absolute;left:380.13px;top:412.16px" class="cls_061"><span class="cls_061">Demo project for</span></div>
<div style="position:absolute;left:380.13px;top:422.15px" class="cls_061"><span class="cls_061">Spring Boot</span></div>
<div style="position:absolute;left:108.18px;top:439.16px" class="cls_061"><span class="cls_061">package-name</span></div>
<div style="position:absolute;left:188.97px;top:439.16px" class="cls_110"><span class="cls_110">The project’s base package name.</span></div>
<div style="position:absolute;left:380.13px;top:439.16px" class="cls_061"><span class="cls_061">com.example.demo</span></div>
<div style="position:absolute;left:108.18px;top:456.14px" class="cls_061"><span class="cls_061">dependencies</span></div>
<div style="position:absolute;left:188.97px;top:456.14px" class="cls_110"><span class="cls_110">Dependencies to include in the project’s build speci-</span></div>
<div style="position:absolute;left:380.13px;top:456.14px" class="cls_110"><span class="cls_110">The base Spring Boot</span></div>
<div style="position:absolute;left:188.97px;top:466.16px" class="cls_110"><span class="cls_110">fication.</span></div>
<div style="position:absolute;left:380.13px;top:466.16px" class="cls_110"><span class="cls_110">starter</span></div>
<div style="position:absolute;left:108.18px;top:483.14px" class="cls_061"><span class="cls_061">type</span></div>
<div style="position:absolute;left:188.97px;top:483.14px" class="cls_110"><span class="cls_110">The kind of project to generate. Either </span><span class="cls_061">maven-</span></div>
<div style="position:absolute;left:380.13px;top:483.14px" class="cls_061"><span class="cls_061">maven-project</span></div>
<div style="position:absolute;left:188.97px;top:493.16px" class="cls_061"><span class="cls_061">project</span><span class="cls_110"> or </span><span class="cls_061">gradle-project</span><span class="cls_110">.</span></div>
<div style="position:absolute;left:108.18px;top:510.14px" class="cls_061"><span class="cls_061">java-version</span></div>
<div style="position:absolute;left:188.97px;top:510.14px" class="cls_110"><span class="cls_110">The version of Java to build with.</span></div>
<div style="position:absolute;left:380.13px;top:510.14px" class="cls_061"><span class="cls_061">1.8</span></div>
<div style="position:absolute;left:108.18px;top:527.15px" class="cls_061"><span class="cls_061">boot-version</span></div>
<div style="position:absolute;left:188.97px;top:527.15px" class="cls_110"><span class="cls_110">The version of Boot to build against.</span></div>
<div style="position:absolute;left:380.16px;top:527.15px" class="cls_110"><span class="cls_110">The current GA version of</span></div>
<div style="position:absolute;left:380.13px;top:537.14px" class="cls_110"><span class="cls_110">Spring Boot</span></div>
<div style="position:absolute;left:108.18px;top:554.15px" class="cls_061"><span class="cls_061">language</span></div>
<div style="position:absolute;left:188.97px;top:554.15px" class="cls_110"><span class="cls_110">The programming language to use. Either </span><span class="cls_061">java</span><span class="cls_110">,</span></div>
<div style="position:absolute;left:380.13px;top:554.15px" class="cls_061"><span class="cls_061">java</span></div>
<div style="position:absolute;left:188.97px;top:564.14px" class="cls_061"><span class="cls_061">groovy</span><span class="cls_110">, or </span><span class="cls_061">kotlin</span><span class="cls_110">.</span></div>
<div style="position:absolute;left:108.18px;top:581.15px" class="cls_061"><span class="cls_061">packaging</span></div>
<div style="position:absolute;left:188.97px;top:581.15px" class="cls_110"><span class="cls_110">How the project should be packaged. Either </span><span class="cls_061">jar</span><span class="cls_110"> or</span></div>
<div style="position:absolute;left:380.13px;top:581.15px" class="cls_061"><span class="cls_061">jar</span></div>
<div style="position:absolute;left:188.97px;top:591.14px" class="cls_061"><span class="cls_061">war</span><span class="cls_110">.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:335292px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background506.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_024"><span class="cls_024">484</span></div>
<div style="position:absolute;left:180.78px;top:24.35px" class="cls_109"><span class="cls_109">APPENDIX</span><span class="cls_108">   Bootstrapping Spring applications</span></div>
<div style="position:absolute;left:93.18px;top:50.66px" class="cls_039"><span class="cls_039">You can also get this list of parameters, as well as a list of available dependencies, by</span></div>
<div style="position:absolute;left:93.18px;top:63.65px" class="cls_039"><span class="cls_039">using the </span><span class="cls_042">--list</span><span class="cls_039"> parameter:</span></div>
<div style="position:absolute;left:93.18px;top:86.33px" class="cls_060"><span class="cls_060">% spring init --list</span></div>
<div style="position:absolute;left:93.18px;top:107.66px" class="cls_039"><span class="cls_039">Suppose you wish to create a web application that builds against Java 1.7. The follow-</span></div>
<div style="position:absolute;left:93.18px;top:120.65px" class="cls_039"><span class="cls_039">ing command uses the </span><span class="cls_042">--dependencies</span><span class="cls_039"> and </span><span class="cls_042">--java</span><span class="cls_039"> parameters to make those</span></div>
<div style="position:absolute;left:93.18px;top:133.67px" class="cls_039"><span class="cls_039">choices:</span></div>
<div style="position:absolute;left:93.18px;top:156.35px" class="cls_060"><span class="cls_060">% spring init --dependencies=web --java-version=1.7</span></div>
<div style="position:absolute;left:93.18px;top:177.65px" class="cls_039"><span class="cls_039">Or suppose you want to create a web application with Spring Data JPA for persistence,</span></div>
<div style="position:absolute;left:93.18px;top:190.67px" class="cls_039"><span class="cls_039">and you’d like to use Gradle to perform the build instead of Maven. You’d use the fol-</span></div>
<div style="position:absolute;left:93.18px;top:203.66px" class="cls_039"><span class="cls_039">lowing command:</span></div>
<div style="position:absolute;left:93.18px;top:226.34px" class="cls_060"><span class="cls_060">% spring init --dependencies=web,jpa --type=gradle-project</span></div>
<div style="position:absolute;left:93.18px;top:247.67px" class="cls_039"><span class="cls_039">You may also notice that many of the </span><span class="cls_042">spring</span><span class="cls_039"> </span><span class="cls_042">init</span><span class="cls_039"> parameters are the same as or simi-</span></div>
<div style="position:absolute;left:93.18px;top:260.66px" class="cls_039"><span class="cls_039">lar to the parameters for the </span><span class="cls_042">curl</span><span class="cls_039"> option. That said, the </span><span class="cls_042">spring</span><span class="cls_039"> </span><span class="cls_042">init</span><span class="cls_039"> command doesn’t</span></div>
<div style="position:absolute;left:93.18px;top:273.65px" class="cls_039"><span class="cls_039">support all of the same parameters as the </span><span class="cls_042">curl</span><span class="cls_039"> option (</span><span class="cls_042">baseDir</span><span class="cls_039">, for example) and the</span></div>
<div style="position:absolute;left:93.18px;top:286.67px" class="cls_039"><span class="cls_039">parameters are hyphen-delimited instead of camel-cased (for example, </span><span class="cls_042">package-name</span></div>
<div style="position:absolute;left:93.18px;top:299.66px" class="cls_039"><span class="cls_039">versus </span><span class="cls_042">packageName</span><span class="cls_039">).</span></div>
<div style="position:absolute;left:57.18px;top:323.83px" class="cls_040"><span class="cls_040">A.6</span></div>
<div style="position:absolute;left:93.18px;top:323.83px" class="cls_040"><span class="cls_040">Creating Spring applications with a meta-framework</span></div>
<div style="position:absolute;left:93.18px;top:343.16px" class="cls_039"><span class="cls_039">It’s also worth noting that there are a couple of frameworks that are built on top of</span></div>
<div style="position:absolute;left:93.18px;top:356.18px" class="cls_039"><span class="cls_039">Spring and Spring Boot:</span></div>
<div style="position:absolute;left:108.78px;top:373.16px" class="cls_041"><span class="cls_041">■</span><span class="cls_107">   Grails—</span><a href="https://grails.org/">https://grails.org/</a> </div>
<div style="position:absolute;left:108.78px;top:387.17px" class="cls_041"><span class="cls_041">■</span><span class="cls_107">   JHipster—</span><a href="https://jhipster.github.io/">https://jhipster.github.io/</a> </div>
<div style="position:absolute;left:93.18px;top:405.17px" class="cls_039"><span class="cls_039">These meta-frameworks offer higher-level rapid development of Spring applications,</span></div>
<div style="position:absolute;left:93.18px;top:418.16px" class="cls_039"><span class="cls_039">while still offering everything that Spring and Spring Boot offer.</span></div>
<div style="position:absolute;left:107.94px;top:431.18px" class="cls_039"><span class="cls_039">These meta-frameworks each offer their own unique development model and are,</span></div>
<div style="position:absolute;left:93.18px;top:444.17px" class="cls_039"><span class="cls_039">in fact, frameworks in their own right, so it wouldn’t do them justice to simply present</span></div>
<div style="position:absolute;left:93.18px;top:457.16px" class="cls_039"><span class="cls_039">them as project initialization mechanisms in this appendix. Indeed, they each could</span></div>
<div style="position:absolute;left:93.18px;top:470.18px" class="cls_039"><span class="cls_039">have entire books written about them.</span></div>
<div style="position:absolute;left:108.07px;top:483.17px" class="cls_039"><span class="cls_039">I won’t delve into how to use these meta-frameworks to initialize a Spring project.</span></div>
<div style="position:absolute;left:93.18px;top:496.16px" class="cls_039"><span class="cls_039">Nevertheless, I include them here to make you aware that they are other ways to ini-</span></div>
<div style="position:absolute;left:93.18px;top:509.18px" class="cls_039"><span class="cls_039">tialize and develop Spring applications.</span></div>
<div style="position:absolute;left:57.18px;top:533.35px" class="cls_040"><span class="cls_040">A.7</span></div>
<div style="position:absolute;left:93.18px;top:533.35px" class="cls_040"><span class="cls_040">Building and running projects</span></div>
<div style="position:absolute;left:93.18px;top:552.68px" class="cls_039"><span class="cls_039">No matter how you initialize your project, you can always run the application from the</span></div>
<div style="position:absolute;left:93.18px;top:565.67px" class="cls_039"><span class="cls_039">command line with the </span><span class="cls_042">java</span><span class="cls_039"> </span><span class="cls_042">-jar</span><span class="cls_039"> command:</span></div>
<div style="position:absolute;left:93.18px;top:588.35px" class="cls_060"><span class="cls_060">% java -jar demo.jar</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:335968px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background507.jpg" width="531" height="666"></div>
<div style="position:absolute;left:216.60px;top:24.35px" class="cls_108"><span class="cls_108">Building and running projects</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_024"><span class="cls_024">485</span></div>
<div style="position:absolute;left:102.18px;top:50.66px" class="cls_039"><span class="cls_039">This will even work if you decide to create a WAR file distribution instead of a JAR file:</span></div>
<div style="position:absolute;left:102.18px;top:73.34px" class="cls_060"><span class="cls_060">% java -jar demo.war</span></div>
<div style="position:absolute;left:102.18px;top:94.67px" class="cls_039"><span class="cls_039">You can also take advantage of the Spring Boot Maven and Gradle plugins to run your</span></div>
<div style="position:absolute;left:102.18px;top:107.66px" class="cls_039"><span class="cls_039">application. For example, if your project is built with Maven, you can run it like this:</span></div>
<div style="position:absolute;left:102.18px;top:130.34px" class="cls_060"><span class="cls_060">% mvn spring-boot:run</span></div>
<div style="position:absolute;left:102.18px;top:151.67px" class="cls_039"><span class="cls_039">If, on the other hand, you’ve chosen to build your project with Gradle, you can run</span></div>
<div style="position:absolute;left:102.18px;top:164.66px" class="cls_039"><span class="cls_039">your project like this:</span></div>
<div style="position:absolute;left:102.18px;top:187.34px" class="cls_060"><span class="cls_060">% gradle bootRun</span></div>
<div style="position:absolute;left:102.18px;top:208.67px" class="cls_039"><span class="cls_039">In either case, whether using Maven or Gradle, the build tool will first build your proj-</span></div>
<div style="position:absolute;left:102.18px;top:221.66px" class="cls_039"><span class="cls_039">ect (if it hasn’t already been built) and run it.</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:336644px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background508.jpg" width="531" height="666"></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:336644px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background509.jpg" width="531" height="666"></div>
<div style="position:absolute;left:409.98px;top:133.94px" class="cls_014"><span class="cls_014">index</span></div>
<div style="position:absolute;left:66.18px;top:212.66px" class="cls_112"><span class="cls_112">Symbols</span></div>
<div style="position:absolute;left:294.18px;top:212.99px" class="cls_022"><span class="cls_022">receiving messages</span><span class="cls_113"> 188-192</span></div>
<div style="position:absolute;left:294.18px;top:222.98px" class="cls_022"><span class="cls_022">setting up JMS</span><span class="cls_113"> 179-181</span></div>
<div style="position:absolute;left:66.18px;top:233.00px" class="cls_022"><span class="cls_022">@ operator</span><span class="cls_113"> 38</span></div>
<div style="position:absolute;left:285.18px;top:232.99px" class="cls_022"><span class="cls_022">with Kafka</span><span class="cls_113"> 202-208</span></div>
<div style="position:absolute;left:66.18px;top:242.99px" class="cls_022"><span class="cls_022">@{} operator</span><span class="cls_113"> 38</span></div>
<div style="position:absolute;left:294.18px;top:242.98px" class="cls_022"><span class="cls_022">sending messages with KafkaTemplate</span></div>
<div style="position:absolute;left:309.18px;top:252.97px" class="cls_113"><span class="cls_113">204-206</span></div>
<div style="position:absolute;left:66.18px;top:262.67px" class="cls_112"><span class="cls_112">A</span></div>
<div style="position:absolute;left:294.18px;top:262.99px" class="cls_022"><span class="cls_022">setting up</span><span class="cls_113"> 203-204</span></div>
<div style="position:absolute;left:294.18px;top:272.98px" class="cls_022"><span class="cls_022">writing Kafka listeners</span><span class="cls_113"> 206-208</span></div>
<div style="position:absolute;left:66.18px;top:282.98px" class="cls_022"><span class="cls_022">AbstractMessageRouter</span><span class="cls_113"> 222</span></div>
<div style="position:absolute;left:285.18px;top:282.97px" class="cls_022"><span class="cls_022">with RabbitMQ</span><span class="cls_113"> 192-202</span></div>
<div style="position:absolute;left:66.18px;top:293.00px" class="cls_022"><span class="cls_022">AbstractRepositoryEventListener</span><span class="cls_113"> 450-451</span></div>
<div style="position:absolute;left:294.18px;top:292.99px" class="cls_022"><span class="cls_022">adding to Spring</span><span class="cls_113"> 193-194</span></div>
<div style="position:absolute;left:66.18px;top:302.99px" class="cls_022"><span class="cls_022">access( ) method</span><span class="cls_113"> 105</span></div>
<div style="position:absolute;left:294.18px;top:302.99px" class="cls_022"><span class="cls_022">receiving message from</span><span class="cls_113"> 198-202</span></div>
<div style="position:absolute;left:66.18px;top:312.98px" class="cls_022"><span class="cls_022">ActiveMQQueue</span><span class="cls_113"> 184</span></div>
<div style="position:absolute;left:294.18px;top:312.98px" class="cls_022"><span class="cls_022">sending messages with RabbitTemplate</span></div>
<div style="position:absolute;left:66.18px;top:323.00px" class="cls_022"><span class="cls_022">Actuator. </span><span class="cls_114">See</span><span class="cls_022"> Spring Boot Actuator</span></div>
<div style="position:absolute;left:309.18px;top:323.00px" class="cls_113"><span class="cls_113">194-198</span></div>
<div style="position:absolute;left:66.18px;top:332.99px" class="cls_022"><span class="cls_022">addNote( ) method</span><span class="cls_113"> 425</span></div>
<div style="position:absolute;left:276.18px;top:332.99px" class="cls_022"><span class="cls_022">AtomicInteger</span><span class="cls_113"> 229</span></div>
<div style="position:absolute;left:66.18px;top:342.98px" class="cls_022"><span class="cls_022">addScript( ) method</span><span class="cls_113"> 115</span></div>
<div style="position:absolute;left:276.18px;top:342.98px" class="cls_022"><span class="cls_022">authentication. </span><span class="cls_114">See</span><span class="cls_022"> user authentication,</span></div>
<div style="position:absolute;left:66.18px;top:353.00px" class="cls_022"><span class="cls_022">addScripts( ) method</span><span class="cls_113"> 115</span></div>
<div style="position:absolute;left:294.18px;top:353.00px" class="cls_022"><span class="cls_022">customizing</span></div>
<div style="position:absolute;left:66.18px;top:362.99px" class="cls_022"><span class="cls_022">addViewControllers( ) method</span><span class="cls_113"> 52, 107</span></div>
<div style="position:absolute;left:276.18px;top:362.99px" class="cls_022"><span class="cls_022">@AuthenticationPrincipal annotation</span><span class="cls_113"> 111</span></div>
<div style="position:absolute;left:66.18px;top:372.98px" class="cls_022"><span class="cls_022">Advanced Message Queueing Protocol</span></div>
<div style="position:absolute;left:276.18px;top:372.98px" class="cls_022"><span class="cls_022">autoconfiguration, fine-tuning</span><span class="cls_113"> 115-121</span></div>
<div style="position:absolute;left:84.18px;top:383.00px" class="cls_022"><span class="cls_022">(AMQP)</span><span class="cls_113"> 179</span></div>
<div style="position:absolute;left:285.18px;top:383.00px" class="cls_022"><span class="cls_022">configuring data source</span><span class="cls_113"> 117-118</span></div>
<div style="position:absolute;left:66.18px;top:392.99px" class="cls_022"><span class="cls_022">all( ) method</span><span class="cls_113"> 266</span></div>
<div style="position:absolute;left:285.18px;top:392.99px" class="cls_022"><span class="cls_022">configuring embedded server</span><span class="cls_113"> 119</span></div>
<div style="position:absolute;left:66.18px;top:402.98px" class="cls_022"><span class="cls_022">@AllowFiltering annotation</span><span class="cls_113"> 312</span></div>
<div style="position:absolute;left:285.18px;top:402.98px" class="cls_022"><span class="cls_022">configuring logging</span><span class="cls_113"> 120-121</span></div>
<div style="position:absolute;left:66.18px;top:413.00px" class="cls_022"><span class="cls_022">AMQP (Advanced Message Queueing</span></div>
<div style="position:absolute;left:285.18px;top:413.00px" class="cls_022"><span class="cls_022">environment abstraction</span><span class="cls_113"> 116-117</span></div>
<div style="position:absolute;left:84.18px;top:422.99px" class="cls_022"><span class="cls_022">Protocol)</span><span class="cls_113"> 179</span></div>
<div style="position:absolute;left:285.18px;top:422.99px" class="cls_022"><span class="cls_022">using special property values</span><span class="cls_113"> 121</span></div>
<div style="position:absolute;left:66.18px;top:432.98px" class="cls_022"><span class="cls_022">AmqpHeaderConverter</span><span class="cls_113"> 197</span></div>
<div style="position:absolute;left:276.18px;top:432.98px" class="cls_022"><span class="cls_022">@Autowired annotation</span><span class="cls_113"> 61</span></div>
<div style="position:absolute;left:66.18px;top:443.00px" class="cls_022"><span class="cls_022">and( ) method</span><span class="cls_113"> 107</span></div>
<div style="position:absolute;left:276.18px;top:443.00px" class="cls_022"><span class="cls_022">autowiring</span><span class="cls_113"> 6</span></div>
<div style="position:absolute;left:66.18px;top:452.99px" class="cls_022"><span class="cls_022">antMatchers( ) method</span><span class="cls_113"> 294</span></div>
<div style="position:absolute;left:276.18px;top:452.99px" class="cls_022"><span class="cls_022">availableTags</span><span class="cls_113"> 415</span></div>
<div style="position:absolute;left:66.18px;top:463.01px" class="cls_022"><span class="cls_022">any( ) method</span><span class="cls_113"> 266</span></div>
<div style="position:absolute;left:66.18px;top:473.00px" class="cls_022"><span class="cls_022">ApiProperties</span><span class="cls_113"> 236</span></div>
<div style="position:absolute;left:276.18px;top:472.67px" class="cls_112"><span class="cls_112">B</span></div>
<div style="position:absolute;left:66.18px;top:482.99px" class="cls_022"><span class="cls_022">APIs. </span><span class="cls_114">See</span><span class="cls_022"> reactive APIs</span></div>
<div style="position:absolute;left:66.18px;top:493.01px" class="cls_022"><span class="cls_022">applicationConfig property</span><span class="cls_113"> 406</span></div>
<div style="position:absolute;left:276.18px;top:493.01px" class="cls_022"><span class="cls_022">base path, Actuator</span><span class="cls_113"> 397</span></div>
<div style="position:absolute;left:66.18px;top:503.00px" class="cls_022"><span class="cls_022">applicationName parameter</span><span class="cls_113"> 482</span></div>
<div style="position:absolute;left:276.18px;top:503.00px" class="cls_022"><span class="cls_022">baseDir parameter</span><span class="cls_113"> 482</span></div>
<div style="position:absolute;left:66.18px;top:512.99px" class="cls_022"><span class="cls_022">applications. </span><span class="cls_114">See</span><span class="cls_022"> Spring applications</span></div>
<div style="position:absolute;left:276.18px;top:512.99px" class="cls_022"><span class="cls_022">@Bean annotation</span><span class="cls_113"> 5</span></div>
<div style="position:absolute;left:66.18px;top:523.01px" class="cls_022"><span class="cls_022">artifactId parameter</span><span class="cls_113"> 481</span></div>
<div style="position:absolute;left:276.18px;top:523.01px" class="cls_022"><span class="cls_022">bean wiring</span><span class="cls_113"> 115</span></div>
<div style="position:absolute;left:66.18px;top:533.00px" class="cls_022"><span class="cls_022">asLink( ) method</span><span class="cls_113"> 176</span></div>
<div style="position:absolute;left:276.18px;top:533.00px" class="cls_022"><span class="cls_022">bean wiring report</span><span class="cls_113"> 403-404</span></div>
<div style="position:absolute;left:66.18px;top:542.99px" class="cls_022"><span class="cls_022">asynchronous messaging</span><span class="cls_113"> 178-208</span></div>
<div style="position:absolute;left:276.18px;top:542.99px" class="cls_022"><span class="cls_022">beans, conditionally creating with profiles</span></div>
<div style="position:absolute;left:75.18px;top:553.01px" class="cls_022"><span class="cls_022">with JMS</span><span class="cls_113"> 179-192</span></div>
<div style="position:absolute;left:294.18px;top:553.01px" class="cls_113"><span class="cls_113">132-133</span></div>
<div style="position:absolute;left:84.18px;top:563.00px" class="cls_022"><span class="cls_022">JmsTemplate</span><span class="cls_113"> 181-188</span></div>
<div style="position:absolute;left:276.18px;top:563.00px" class="cls_022"><span class="cls_022">bill of materials (BOM)</span><span class="cls_113"> 248</span></div>
<div style="position:absolute;left:263.16px;top:596.99px" class="cls_024"><span class="cls_024">487</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:337320px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background510.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_024"><span class="cls_024">488</span></div>
<div style="position:absolute;left:252.09px;top:26.96px" class="cls_109"><span class="cls_109">INDEX</span></div>
<div style="position:absolute;left:57.18px;top:50.99px" class="cls_022"><span class="cls_022">block( ) method</span><span class="cls_113"> 299</span></div>
<div style="position:absolute;left:267.18px;top:50.99px" class="cls_022"><span class="cls_022">CommandLineRunner</span><span class="cls_113"> 133</span></div>
<div style="position:absolute;left:57.18px;top:60.98px" class="cls_022"><span class="cls_022">BOM (bill of materials)</span><span class="cls_113"> 248</span></div>
<div style="position:absolute;left:267.18px;top:60.98px" class="cls_022"><span class="cls_022">commandProperties attribute</span><span class="cls_113"> 381</span></div>
<div style="position:absolute;left:57.18px;top:70.97px" class="cls_022"><span class="cls_022">bootstrapping applications</span><span class="cls_113"> 466-485</span></div>
<div style="position:absolute;left:267.18px;top:70.97px" class="cls_022"><span class="cls_022">component scanning</span><span class="cls_113"> 6</span></div>
<div style="position:absolute;left:66.18px;top:80.99px" class="cls_022"><span class="cls_022">building and running projects</span><span class="cls_113"> 484-485</span></div>
<div style="position:absolute;left:267.18px;top:80.99px" class="cls_022"><span class="cls_022">@ComponentScan annotation</span><span class="cls_113"> 15</span></div>
<div style="position:absolute;left:66.18px;top:90.98px" class="cls_022"><span class="cls_022">creating apps with meta-framework</span><span class="cls_113"> 484</span></div>
<div style="position:absolute;left:267.18px;top:90.98px" class="cls_022"><span class="cls_022">@ConditionalOnClass annotation</span><span class="cls_113"> 405</span></div>
<div style="position:absolute;left:66.18px;top:100.97px" class="cls_022"><span class="cls_022">example</span><span class="cls_113"> 15-16</span></div>
<div style="position:absolute;left:267.18px;top:100.97px" class="cls_022"><span class="cls_022">@ConditionalOnMissingBean annotation</span><span class="cls_113"> 405</span></div>
<div style="position:absolute;left:66.18px;top:110.99px" class="cls_022"><span class="cls_022">initializing projects</span></div>
<div style="position:absolute;left:267.18px;top:110.99px" class="cls_022"><span class="cls_022">Config Server</span><span class="cls_113"> 346</span></div>
<div style="position:absolute;left:75.18px;top:120.98px" class="cls_022"><span class="cls_022">at start.spring.io</span></div>
<div style="position:absolute;left:142.95px;top:120.98px" class="cls_113"><span class="cls_113">477-479</span></div>
<div style="position:absolute;left:267.18px;top:120.98px" class="cls_022"><span class="cls_022">config.client.version property</span><span class="cls_113"> 367</span></div>
<div style="position:absolute;left:75.18px;top:130.97px" class="cls_022"><span class="cls_022">from command line</span><span class="cls_113"> 480-484</span></div>
<div style="position:absolute;left:267.18px;top:130.97px" class="cls_022"><span class="cls_022">configuration</span><span class="cls_113"> 343-375</span></div>
<div style="position:absolute;left:75.18px;top:140.99px" class="cls_022"><span class="cls_022">with IntelliJ IDEA</span><span class="cls_113"> 470-472</span></div>
<div style="position:absolute;left:276.18px;top:140.99px" class="cls_022"><span class="cls_022">consuming shared configuration</span><span class="cls_113"> 352-353</span></div>
<div style="position:absolute;left:75.18px;top:150.98px" class="cls_022"><span class="cls_022">with NetBeans</span><span class="cls_113"> 473-476</span></div>
<div style="position:absolute;left:276.18px;top:150.98px" class="cls_022"><span class="cls_022">keeping configuration properties secret</span></div>
<div style="position:absolute;left:75.18px;top:160.97px" class="cls_022"><span class="cls_022">with Spring Tool Suite</span><span class="cls_113"> 466-470</span></div>
<div style="position:absolute;left:294.18px;top:160.97px" class="cls_113"><span class="cls_113">357-364</span></div>
<div style="position:absolute;left:57.18px;top:170.99px" class="cls_022"><span class="cls_022">bootVersion parameter</span><span class="cls_113"> 482</span></div>
<div style="position:absolute;left:285.18px;top:170.99px" class="cls_022"><span class="cls_022">encrypting properties in Git</span><span class="cls_113"> 357-360</span></div>
<div style="position:absolute;left:57.18px;top:180.98px" class="cls_022"><span class="cls_022">browser refresh</span><span class="cls_113"> 24</span></div>
<div style="position:absolute;left:285.18px;top:180.98px" class="cls_022"><span class="cls_022">in Vault</span><span class="cls_113"> 360-364</span></div>
<div style="position:absolute;left:57.18px;top:190.97px" class="cls_022"><span class="cls_022">buffering data</span><span class="cls_113"> 263-266</span></div>
<div style="position:absolute;left:276.18px;top:190.97px" class="cls_022"><span class="cls_022">refreshing configuration properties on the</span></div>
<div style="position:absolute;left:57.18px;top:200.99px" class="cls_022"><span class="cls_022">build specification</span><span class="cls_113"> 12-15</span></div>
<div style="position:absolute;left:294.18px;top:200.99px" class="cls_022"><span class="cls_022">fly</span></div>
<div style="position:absolute;left:307.83px;top:200.99px" class="cls_113"><span class="cls_113">364-375</span></div>
<div style="position:absolute;left:57.18px;top:210.98px" class="cls_022"><span class="cls_022">BuildInfoContributor</span><span class="cls_113"> 418</span></div>
<div style="position:absolute;left:285.18px;top:210.98px" class="cls_022"><span class="cls_022">automatically</span><span class="cls_113"> 367-375</span></div>
<div style="position:absolute;left:285.18px;top:221.00px" class="cls_022"><span class="cls_022">manually</span><span class="cls_113"> 365-367</span></div>
<div style="position:absolute;left:57.18px;top:230.66px" class="cls_112"><span class="cls_112">C</span></div>
<div style="position:absolute;left:276.18px;top:230.99px" class="cls_022"><span class="cls_022">running configuration server</span><span class="cls_113"> 345-352</span></div>
<div style="position:absolute;left:285.18px;top:240.98px" class="cls_022"><span class="cls_022">enabling Config Server</span><span class="cls_113"> 346-349</span></div>
<div style="position:absolute;left:57.18px;top:251.00px" class="cls_022"><span class="cls_022">caching templates</span><span class="cls_113"> 54-55</span></div>
<div style="position:absolute;left:285.18px;top:251.00px" class="cls_022"><span class="cls_022">populating configuration repository</span><span class="cls_113"> 349-352</span></div>
<div style="position:absolute;left:57.18px;top:260.99px" class="cls_022"><span class="cls_022">Cassandra</span><span class="cls_113"> 300-312</span></div>
<div style="position:absolute;left:276.18px;top:260.99px" class="cls_022"><span class="cls_022">serving application-specific properties</span><span class="cls_113"> 354-355</span></div>
<div style="position:absolute;left:66.18px;top:270.98px" class="cls_022"><span class="cls_022">data modeling</span><span class="cls_113"> 303-304</span></div>
<div style="position:absolute;left:276.18px;top:270.98px" class="cls_022"><span class="cls_022">serving properties from profiles</span><span class="cls_113"> 355-357</span></div>
<div style="position:absolute;left:66.18px;top:281.00px" class="cls_022"><span class="cls_022">enabling</span><span class="cls_113"> 301-303</span></div>
<div style="position:absolute;left:276.18px;top:281.00px" class="cls_022"><span class="cls_022">sharing</span><span class="cls_113"> 344-345</span></div>
<div style="position:absolute;left:66.18px;top:290.99px" class="cls_022"><span class="cls_022">mapping domain types for persistence</span></div>
<div style="position:absolute;left:220.05px;top:290.99px" class="cls_113"><span class="cls_113">304-309</span></div>
<div style="position:absolute;left:276.18px;top:290.99px" class="cls_022"><span class="cls_022">Spring Security</span><span class="cls_113"> 86-103</span></div>
<div style="position:absolute;left:66.18px;top:300.98px" class="cls_022"><span class="cls_022">writing</span><span class="cls_113"> 309-312</span></div>
<div style="position:absolute;left:285.18px;top:300.98px" class="cls_022"><span class="cls_022">customizing user authentication</span><span class="cls_113"> 96-103</span></div>
<div style="position:absolute;left:57.18px;top:311.00px" class="cls_022"><span class="cls_022">CassandraRepository interface</span><span class="cls_113"> 310</span></div>
<div style="position:absolute;left:285.18px;top:311.00px" class="cls_022"><span class="cls_022">in-memory user store</span><span class="cls_113"> 88-89</span></div>
<div style="position:absolute;left:57.18px;top:320.99px" class="cls_022"><span class="cls_022">ccExpiration property</span><span class="cls_113"> 47</span></div>
<div style="position:absolute;left:285.18px;top:320.99px" class="cls_022"><span class="cls_022">JDBC-based user store</span><span class="cls_113"> 89-92</span></div>
<div style="position:absolute;left:57.18px;top:330.98px" class="cls_022"><span class="cls_022">ccNumber property</span><span class="cls_113"> 47</span></div>
<div style="position:absolute;left:285.18px;top:330.98px" class="cls_022"><span class="cls_022">LDAP-backed user store</span><span class="cls_113"> 92-96</span></div>
<div style="position:absolute;left:57.18px;top:341.00px" class="cls_022"><span class="cls_022">cf bind-service command</span><span class="cls_113"> 460</span></div>
<div style="position:absolute;left:267.18px;top:341.00px" class="cls_022"><span class="cls_022">@Configuration annotation</span><span class="cls_113"> 5</span></div>
<div style="position:absolute;left:57.18px;top:350.99px" class="cls_022"><span class="cls_022">channel adapters</span><span class="cls_113"> 228-230</span></div>
<div style="position:absolute;left:267.18px;top:350.99px" class="cls_022"><span class="cls_022">configuration properties</span><span class="cls_113"> 114-133</span></div>
<div style="position:absolute;left:57.18px;top:360.98px" class="cls_022"><span class="cls_022">channel( ) method</span><span class="cls_113"> 216</span></div>
<div style="position:absolute;left:276.18px;top:360.98px" class="cls_022"><span class="cls_022">autoconfiguration, fine-tuning</span><span class="cls_113"> 115-121</span></div>
<div style="position:absolute;left:57.18px;top:371.00px" class="cls_022"><span class="cls_022">circuit breakers</span><span class="cls_113"> 376-383</span></div>
<div style="position:absolute;left:285.18px;top:371.00px" class="cls_022"><span class="cls_022">configuring data source</span><span class="cls_113"> 117-118</span></div>
<div style="position:absolute;left:66.18px;top:380.99px" class="cls_022"><span class="cls_022">managing thresholds</span><span class="cls_113"> 382-383</span></div>
<div style="position:absolute;left:285.18px;top:380.99px" class="cls_022"><span class="cls_022">configuring embedded server</span><span class="cls_113"> 119</span></div>
<div style="position:absolute;left:66.18px;top:390.98px" class="cls_022"><span class="cls_022">mitigating latency</span><span class="cls_113"> 381-382</span></div>
<div style="position:absolute;left:285.18px;top:390.98px" class="cls_022"><span class="cls_022">configuring logging</span><span class="cls_113"> 120-121</span></div>
<div style="position:absolute;left:57.18px;top:401.00px" class="cls_022"><span class="cls_022">circuitBreaker.errorThresholdPercentage</span></div>
<div style="position:absolute;left:285.18px;top:401.00px" class="cls_022"><span class="cls_022">environment abstraction</span><span class="cls_113"> 116-117</span></div>
<div style="position:absolute;left:75.18px;top:410.99px" class="cls_022"><span class="cls_022">property</span><span class="cls_113"> 382</span></div>
<div style="position:absolute;left:285.18px;top:410.99px" class="cls_022"><span class="cls_022">using special property values</span><span class="cls_113"> 121</span></div>
<div style="position:absolute;left:57.18px;top:420.98px" class="cls_022"><span class="cls_022">circuitBreaker.requestVolumeThreshold</span></div>
<div style="position:absolute;left:276.18px;top:420.98px" class="cls_022"><span class="cls_022">defining holders</span><span class="cls_113"> 124-126</span></div>
<div style="position:absolute;left:75.18px;top:431.00px" class="cls_022"><span class="cls_022">property</span><span class="cls_113"> 382</span></div>
<div style="position:absolute;left:276.18px;top:431.00px" class="cls_022"><span class="cls_022">metadata, declaring</span><span class="cls_113"> 126-129</span></div>
<div style="position:absolute;left:57.18px;top:440.99px" class="cls_022"><span class="cls_022">circuitBreaker.sleepWindowInMilliseconds</span></div>
<div style="position:absolute;left:276.18px;top:440.99px" class="cls_022"><span class="cls_022">profiles</span><span class="cls_113"> 129-133</span></div>
<div style="position:absolute;left:75.18px;top:451.01px" class="cls_022"><span class="cls_022">property</span><span class="cls_113"> 383</span></div>
<div style="position:absolute;left:285.18px;top:451.01px" class="cls_022"><span class="cls_022">activating</span><span class="cls_113"> 131-132</span></div>
<div style="position:absolute;left:57.18px;top:461.00px" class="cls_022"><span class="cls_022">CLI (command-line interface)</span><span class="cls_113"> 481</span></div>
<div style="position:absolute;left:285.18px;top:461.00px" class="cls_022"><span class="cls_022">conditionally creating beans with</span><span class="cls_113"> 132-133</span></div>
<div style="position:absolute;left:57.18px;top:470.99px" class="cls_022"><span class="cls_022">clients, Admin, registering</span><span class="cls_113"> 431-435</span></div>
<div style="position:absolute;left:285.18px;top:470.99px" class="cls_022"><span class="cls_022">defining profile-specific properties</span><span class="cls_113"> 130-131</span></div>
<div style="position:absolute;left:66.18px;top:481.01px" class="cls_022"><span class="cls_022">discovering Admin client applications</span><span class="cls_113"> 433-435</span></div>
<div style="position:absolute;left:267.18px;top:481.01px" class="cls_022"><span class="cls_022">configuration( ) method</span><span class="cls_113"> 292</span></div>
<div style="position:absolute;left:66.18px;top:491.00px" class="cls_022"><span class="cls_022">explicitly configuring Admin client</span></div>
<div style="position:absolute;left:267.18px;top:491.00px" class="cls_022"><span class="cls_022">@ConfigurationProperties annotation</span><span class="cls_113"> 122-123,</span></div>
<div style="position:absolute;left:84.18px;top:500.99px" class="cls_022"><span class="cls_022">applications</span><span class="cls_113"> 432-433</span></div>
<div style="position:absolute;left:285.18px;top:500.99px" class="cls_113"><span class="cls_113">200, 232</span></div>
<div style="position:absolute;left:57.18px;top:511.01px" class="cls_022"><span class="cls_022">Cloud Foundry</span><span class="cls_113"> 132, 454-461</span></div>
<div style="position:absolute;left:267.18px;top:511.01px" class="cls_022"><span class="cls_022">configure( ) method</span><span class="cls_113"> 99, 456</span></div>
<div style="position:absolute;left:57.18px;top:521.00px" class="cls_022"><span class="cls_022">cloud. </span><span class="cls_114">See</span><span class="cls_022"> Spring Cloud</span></div>
<div style="position:absolute;left:267.18px;top:521.00px" class="cls_022"><span class="cls_022">configuredLevel property</span><span class="cls_113"> 410</span></div>
<div style="position:absolute;left:57.18px;top:530.99px" class="cls_022"><span class="cls_022">codecentric AG</span><span class="cls_113"> 430</span></div>
<div style="position:absolute;left:267.18px;top:530.99px" class="cls_022"><span class="cls_022">ContentTypeDelegatingMessageConverter</span><span class="cls_113"> 197</span></div>
<div style="position:absolute;left:57.18px;top:541.01px" class="cls_022"><span class="cls_022">collections, creating reactive types from</span><span class="cls_113"> 250-251</span></div>
<div style="position:absolute;left:267.18px;top:541.01px" class="cls_022"><span class="cls_022">contextSource( ) method</span><span class="cls_113"> 94</span></div>
<div style="position:absolute;left:57.18px;top:551.00px" class="cls_022"><span class="cls_022">collectList( ) method</span><span class="cls_113"> 265</span></div>
<div style="position:absolute;left:267.18px;top:551.00px" class="cls_022"><span class="cls_022">contribute( ) method</span><span class="cls_113"> 417</span></div>
<div style="position:absolute;left:57.18px;top:560.99px" class="cls_022"><span class="cls_022">Command Line Interface (CLI)</span><span class="cls_113"> 481</span></div>
<div style="position:absolute;left:267.18px;top:560.99px" class="cls_022"><span class="cls_022">@Controller annotation</span><span class="cls_113"> 18</span></div>
<div style="position:absolute;left:57.18px;top:571.00px" class="cls_022"><span class="cls_022">command line, initializing projects from</span><span class="cls_113"> 480-484</span></div>
<div style="position:absolute;left:267.18px;top:571.01px" class="cls_022"><span class="cls_022">controller class, creating</span><span class="cls_113"> 32-35</span></div>
<div style="position:absolute;left:66.18px;top:580.99px" class="cls_022"><span class="cls_022">curl and Initializr API</span><span class="cls_113"> 481-482</span></div>
<div style="position:absolute;left:267.18px;top:581.00px" class="cls_022"><span class="cls_022">controller, testing</span><span class="cls_113"> 20-21</span></div>
<div style="position:absolute;left:66.18px;top:590.99px" class="cls_022"><span class="cls_022">interface</span><span class="cls_113"> 483-484</span></div>
<div style="position:absolute;left:267.18px;top:590.99px" class="cls_022"><span class="cls_022">ControllerLinkBuilder</span><span class="cls_113"> 153</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:337996px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background511.jpg" width="531" height="666"></div>
<div style="position:absolute;left:261.09px;top:26.96px" class="cls_109"><span class="cls_109">INDEX</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_024"><span class="cls_024">489</span></div>
<div style="position:absolute;left:66.18px;top:50.99px" class="cls_022"><span class="cls_022">convertAndSend( ) method</span><span class="cls_113"> 182, 185, 195</span></div>
<div style="position:absolute;left:276.18px;top:50.98px" class="cls_022"><span class="cls_022">deployment</span><span class="cls_113"> 454-465</span></div>
<div style="position:absolute;left:66.18px;top:60.98px" class="cls_022"><span class="cls_022">copyToString( ) method</span><span class="cls_113"> 282</span></div>
<div style="position:absolute;left:285.18px;top:60.98px" class="cls_022"><span class="cls_022">building and deploying WAR files</span><span class="cls_113"> 456-458</span></div>
<div style="position:absolute;left:66.18px;top:70.97px" class="cls_022"><span class="cls_022">create keyspace command</span><span class="cls_113"> 302</span></div>
<div style="position:absolute;left:285.18px;top:70.97px" class="cls_022"><span class="cls_022">options, deciding between</span><span class="cls_113"> 455-456</span></div>
<div style="position:absolute;left:66.18px;top:80.99px" class="cls_022"><span class="cls_022">createdAt property</span><span class="cls_113"> 59</span></div>
<div style="position:absolute;left:285.18px;top:80.99px" class="cls_022"><span class="cls_022">pushing JAR files to Cloud Foundry</span><span class="cls_113"> 458-461</span></div>
<div style="position:absolute;left:66.18px;top:90.98px" class="cls_022"><span class="cls_022">createdDate property</span><span class="cls_113"> 165</span></div>
<div style="position:absolute;left:285.18px;top:90.98px" class="cls_022"><span class="cls_022">running Spring Boot in Docker container</span></div>
<div style="position:absolute;left:66.18px;top:100.97px" class="cls_022"><span class="cls_022">createMessage( ) method</span><span class="cls_113"> 183</span></div>
<div style="position:absolute;left:303.18px;top:100.97px" class="cls_113"><span class="cls_113">461-464</span></div>
<div style="position:absolute;left:66.18px;top:110.99px" class="cls_022"><span class="cls_022">@CrossOrigin annotation</span><span class="cls_113"> 143</span></div>
<div style="position:absolute;left:276.18px;top:110.99px" class="cls_022"><span class="cls_022">description parameter</span><span class="cls_113"> 481</span></div>
<div style="position:absolute;left:66.18px;top:120.98px" class="cls_022"><span class="cls_022">CrudRepository interface</span><span class="cls_113"> 81, 310, 318</span></div>
<div style="position:absolute;left:276.18px;top:120.98px" class="cls_022"><span class="cls_022">DI (dependency injection)</span><span class="cls_113"> 4</span></div>
<div style="position:absolute;left:66.18px;top:130.97px" class="cls_022"><span class="cls_022">CSRF (cross-site request forgery)</span><span class="cls_113"> 109-110</span></div>
<div style="position:absolute;left:276.18px;top:130.97px" class="cls_022"><span class="cls_022">diagramming reactive flows</span><span class="cls_113"> 246</span></div>
<div style="position:absolute;left:66.18px;top:140.99px" class="cls_022"><span class="cls_022">curl</span><span class="cls_113"> 7, 481-482</span></div>
<div style="position:absolute;left:276.18px;top:140.99px" class="cls_022"><span class="cls_022">@Digits annotation</span><span class="cls_113"> 48</span></div>
<div style="position:absolute;left:66.18px;top:150.98px" class="cls_022"><span class="cls_022">custom endpoints</span><span class="cls_113"> 165-167</span></div>
<div style="position:absolute;left:276.18px;top:150.98px" class="cls_022"><span class="cls_022">DirectChannel</span><span class="cls_113"> 218</span></div>
<div style="position:absolute;left:66.18px;top:160.97px" class="cls_022"><span class="cls_022">custom hyperlinks</span><span class="cls_113"> 167-168</span></div>
<div style="position:absolute;left:276.18px;top:160.97px" class="cls_022"><span class="cls_022">directory attribute</span><span class="cls_113"> 213</span></div>
<div style="position:absolute;left:66.18px;top:170.99px" class="cls_022"><span class="cls_022">custom login page</span><span class="cls_113"> 106-108</span></div>
<div style="position:absolute;left:276.18px;top:170.99px" class="cls_022"><span class="cls_022">disable( ) method</span><span class="cls_113"> 110</span></div>
<div style="position:absolute;left:66.18px;top:180.98px" class="cls_022"><span class="cls_022">customizing user authentication</span><span class="cls_113"> 96-103</span></div>
<div style="position:absolute;left:276.18px;top:180.98px" class="cls_022"><span class="cls_022">disabling endpoints, Actuator</span><span class="cls_113"> 398</span></div>
<div style="position:absolute;left:75.18px;top:190.97px" class="cls_022"><span class="cls_022">creating user-details service</span><span class="cls_113"> 98-100</span></div>
<div style="position:absolute;left:276.18px;top:190.97px" class="cls_022"><span class="cls_022">diskSpace</span><span class="cls_113"> 402</span></div>
<div style="position:absolute;left:75.18px;top:200.99px" class="cls_022"><span class="cls_022">defining user domain and persistence</span></div>
<div style="position:absolute;left:276.18px;top:200.99px" class="cls_022"><span class="cls_022">DispatcherServlet</span><span class="cls_113"> 456</span></div>
<div style="position:absolute;left:93.18px;top:210.98px" class="cls_113"><span class="cls_113">96-98</span></div>
<div style="position:absolute;left:276.18px;top:210.98px" class="cls_022"><span class="cls_022">displaying information</span><span class="cls_113"> 30-40</span></div>
<div style="position:absolute;left:75.18px;top:221.00px" class="cls_022"><span class="cls_022">registering users</span><span class="cls_113"> 100-103</span></div>
<div style="position:absolute;left:285.18px;top:221.00px" class="cls_022"><span class="cls_022">creating controller class</span><span class="cls_113"> 32-35</span></div>
<div style="position:absolute;left:285.18px;top:230.99px" class="cls_022"><span class="cls_022">designing view</span><span class="cls_113"> 35-40</span></div>
<div style="position:absolute;left:66.18px;top:240.65px" class="cls_112"><span class="cls_112">D</span></div>
<div style="position:absolute;left:285.18px;top:240.98px" class="cls_022"><span class="cls_022">establishing domain</span><span class="cls_113"> 31-32</span></div>
<div style="position:absolute;left:276.18px;top:251.00px" class="cls_022"><span class="cls_022">Docker container, running Spring Boot in</span></div>
<div style="position:absolute;left:66.18px;top:260.99px" class="cls_022"><span class="cls_022">data</span><span class="cls_113"> 56-83</span></div>
<div style="position:absolute;left:294.18px;top:260.99px" class="cls_113"><span class="cls_113">461-464</span></div>
<div style="position:absolute;left:75.18px;top:270.98px" class="cls_022"><span class="cls_022">persisting with Spring Data JPA</span><span class="cls_113"> 75-83</span></div>
<div style="position:absolute;left:276.18px;top:270.98px" class="cls_022"><span class="cls_022">@Document annotation</span><span class="cls_113"> 314</span></div>
<div style="position:absolute;left:84.18px;top:281.00px" class="cls_022"><span class="cls_022">adding Spring Data JPA to project</span><span class="cls_113"> 76</span></div>
<div style="position:absolute;left:276.18px;top:281.00px" class="cls_022"><span class="cls_022">domain, establishing</span><span class="cls_113"> 31-32</span></div>
<div style="position:absolute;left:84.18px;top:290.99px" class="cls_022"><span class="cls_022">annotating domain as entities</span><span class="cls_113"> 76-80</span></div>
<div style="position:absolute;left:276.18px;top:290.99px" class="cls_022"><span class="cls_022">doTransform( ) method</span><span class="cls_113"> 235</span></div>
<div style="position:absolute;left:84.18px;top:300.98px" class="cls_022"><span class="cls_022">customizing JPA repositories</span><span class="cls_113"> 81-83</span></div>
<div style="position:absolute;left:276.18px;top:300.98px" class="cls_022"><span class="cls_022">DSL, configuring integration flows using</span><span class="cls_113"> 215-216</span></div>
<div style="position:absolute;left:84.18px;top:311.00px" class="cls_022"><span class="cls_022">declaring JPA repositories</span><span class="cls_113"> 80-81</span></div>
<div style="position:absolute;left:75.18px;top:320.99px" class="cls_022"><span class="cls_022">reading and writing with JDBC</span><span class="cls_113"> 57-75</span></div>
<div style="position:absolute;left:276.18px;top:320.66px" class="cls_112"><span class="cls_112">E</span></div>
<div style="position:absolute;left:84.18px;top:330.98px" class="cls_022"><span class="cls_022">adapting domain for persistence</span><span class="cls_113"> 59</span></div>
<div style="position:absolute;left:84.18px;top:341.00px" class="cls_022"><span class="cls_022">defining schema and preloading data</span></div>
<div style="position:absolute;left:276.18px;top:341.00px" class="cls_022"><span class="cls_022">email integration flows</span><span class="cls_113"> 231-237</span></div>
<div style="position:absolute;left:99.18px;top:350.99px" class="cls_113"><span class="cls_113">64-66</span></div>
<div style="position:absolute;left:276.18px;top:350.99px" class="cls_022"><span class="cls_022">EmailProperties class</span><span class="cls_113"> 232</span></div>
<div style="position:absolute;left:84.18px;top:360.98px" class="cls_022"><span class="cls_022">inserting data</span><span class="cls_113"> 66-75</span></div>
<div style="position:absolute;left:276.18px;top:360.98px" class="cls_022"><span class="cls_022">embedded databases</span><span class="cls_113"> 313</span></div>
<div style="position:absolute;left:84.18px;top:371.00px" class="cls_022"><span class="cls_022">working with JdbcTemplate</span><span class="cls_113"> 60-64</span></div>
<div style="position:absolute;left:276.18px;top:371.00px" class="cls_022"><span class="cls_022">embedded LDAP server, configuring</span><span class="cls_113"> 94-96</span></div>
<div style="position:absolute;left:75.18px;top:380.99px" class="cls_022"><span class="cls_022">source of, configuring</span><span class="cls_113"> 117-118</span></div>
<div style="position:absolute;left:276.18px;top:380.99px" class="cls_022"><span class="cls_022">embedded relationships, naming</span><span class="cls_113"> 159-160</span></div>
<div style="position:absolute;left:66.18px;top:390.98px" class="cls_022"><span class="cls_022">@Data annotation</span><span class="cls_113"> 32</span></div>
<div style="position:absolute;left:276.18px;top:390.98px" class="cls_022"><span class="cls_022">embedded server, configuring</span><span class="cls_113"> 119</span></div>
<div style="position:absolute;left:66.18px;top:401.00px" class="cls_022"><span class="cls_022">data-backed services, enabling</span><span class="cls_113"> 160-168</span></div>
<div style="position:absolute;left:276.18px;top:401.00px" class="cls_022"><span class="cls_022">EmptyResultDataAccessException</span><span class="cls_113"> 149</span></div>
<div style="position:absolute;left:75.18px;top:410.99px" class="cls_022"><span class="cls_022">adding custom endpoints</span><span class="cls_113"> 165-167</span></div>
<div style="position:absolute;left:276.18px;top:410.99px" class="cls_022"><span class="cls_022">@EnableAdminServer annotation</span><span class="cls_113"> 431</span></div>
<div style="position:absolute;left:75.18px;top:420.98px" class="cls_022"><span class="cls_022">adding custom hyperlinks to Spring Data</span></div>
<div style="position:absolute;left:276.18px;top:420.98px" class="cls_022"><span class="cls_022">@EnableAutoConfiguration annotation</span><span class="cls_113"> 15</span></div>
<div style="position:absolute;left:93.18px;top:431.00px" class="cls_022"><span class="cls_022">endpoints</span><span class="cls_113"> 167-168</span></div>
<div style="position:absolute;left:276.18px;top:431.00px" class="cls_022"><span class="cls_022">@EnableConfigServer annotation</span><span class="cls_113"> 347</span></div>
<div style="position:absolute;left:75.18px;top:440.99px" class="cls_022"><span class="cls_022">adjusting resource paths and relation</span></div>
<div style="position:absolute;left:276.18px;top:440.99px" class="cls_022"><span class="cls_022">@EnableEurekaServer annotation</span><span class="cls_113"> 328</span></div>
<div style="position:absolute;left:93.18px;top:451.01px" class="cls_022"><span class="cls_022">names</span><span class="cls_113"> 162-164</span></div>
<div style="position:absolute;left:276.18px;top:451.01px" class="cls_022"><span class="cls_022">@EnableFeignClients annotation</span><span class="cls_113"> 340</span></div>
<div style="position:absolute;left:75.18px;top:461.00px" class="cls_022"><span class="cls_022">paging and sorting</span><span class="cls_113"> 164-165</span></div>
<div style="position:absolute;left:276.18px;top:461.00px" class="cls_022"><span class="cls_022">@EnableHystrix annotation</span><span class="cls_113"> 379</span></div>
<div style="position:absolute;left:66.18px;top:470.99px" class="cls_022"><span class="cls_022">databases, embedded</span><span class="cls_113"> 313</span></div>
<div style="position:absolute;left:276.18px;top:470.99px" class="cls_022"><span class="cls_022">@EnableHystrixDashboard annotation</span><span class="cls_113"> 384</span></div>
<div style="position:absolute;left:66.18px;top:481.01px" class="cls_022"><span class="cls_022">default user queries, overriding</span><span class="cls_113"> 90-91</span></div>
<div style="position:absolute;left:276.18px;top:481.01px" class="cls_022"><span class="cls_022">@EnableWebFluxSecurity annotation</span><span class="cls_113"> 293</span></div>
<div style="position:absolute;left:66.18px;top:491.00px" class="cls_022"><span class="cls_022">defaultRequestChannel attribute</span><span class="cls_113"> 211</span></div>
<div style="position:absolute;left:276.18px;top:491.00px" class="cls_022"><span class="cls_022">@EnableWebSecurity annotation</span><span class="cls_113"> 292</span></div>
<div style="position:absolute;left:66.18px;top:500.99px" class="cls_022"><span class="cls_022">defaultSuccessUrl parameter</span><span class="cls_113"> 108</span></div>
<div style="position:absolute;left:276.18px;top:500.99px" class="cls_022"><span class="cls_022">encoded passwords</span><span class="cls_113"> 91-92</span></div>
<div style="position:absolute;left:66.18px;top:511.01px" class="cls_022"><span class="cls_022">delayElements( ) method</span><span class="cls_113"> 254, 258</span></div>
<div style="position:absolute;left:276.18px;top:511.01px" class="cls_022"><span class="cls_022">encrypt.key property</span><span class="cls_113"> 357</span></div>
<div style="position:absolute;left:66.18px;top:521.00px" class="cls_022"><span class="cls_022">delaySubscription( ) method</span><span class="cls_113"> 254</span></div>
<div style="position:absolute;left:276.18px;top:521.00px" class="cls_022"><span class="cls_022">endpoint modules</span><span class="cls_113"> 230-231</span></div>
<div style="position:absolute;left:66.18px;top:530.99px" class="cls_022"><span class="cls_022">delete( ) method</span><span class="cls_113"> 174</span></div>
<div style="position:absolute;left:276.18px;top:530.99px" class="cls_022"><span class="cls_022">endpoints, Actuator</span></div>
<div style="position:absolute;left:66.18px;top:541.01px" class="cls_022"><span class="cls_022">deleteById( ) method</span><span class="cls_113"> 149</span></div>
<div style="position:absolute;left:285.18px;top:541.01px" class="cls_022"><span class="cls_022">consuming</span><span class="cls_113"> 399-416</span></div>
<div style="position:absolute;left:66.18px;top:551.00px" class="cls_022"><span class="cls_022">@DeleteMapping annotation</span><span class="cls_113"> 148</span></div>
<div style="position:absolute;left:294.18px;top:551.00px" class="cls_022"><span class="cls_022">fetching essential application</span></div>
<div style="position:absolute;left:66.18px;top:560.99px" class="cls_022"><span class="cls_022">deleteNote( ) method</span><span class="cls_113"> 425</span></div>
<div style="position:absolute;left:309.18px;top:560.99px" class="cls_022"><span class="cls_022">information</span><span class="cls_113"> 400-411</span></div>
<div style="position:absolute;left:66.18px;top:571.00px" class="cls_022"><span class="cls_022">deleteOrder( ) method</span><span class="cls_113"> 149</span></div>
<div style="position:absolute;left:294.18px;top:571.01px" class="cls_022"><span class="cls_022">tapping runtime metrics</span><span class="cls_113"> 413-416</span></div>
<div style="position:absolute;left:66.18px;top:580.99px" class="cls_022"><span class="cls_022">dependencies</span><span class="cls_113"> 476</span></div>
<div style="position:absolute;left:294.18px;top:581.00px" class="cls_022"><span class="cls_022">viewing application activity</span><span class="cls_113"> 411-413</span></div>
<div style="position:absolute;left:66.18px;top:590.98px" class="cls_022"><span class="cls_022">dependency injection (DI)</span><span class="cls_113"> 4</span></div>
<div style="position:absolute;left:285.18px;top:590.99px" class="cls_022"><span class="cls_022">enabling and disabling</span><span class="cls_113"> 398</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:338672px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background512.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_024"><span class="cls_024">490</span></div>
<div style="position:absolute;left:252.09px;top:26.96px" class="cls_109"><span class="cls_109">INDEX</span></div>
<div style="position:absolute;left:57.18px;top:50.99px" class="cls_022"><span class="cls_022">endpoints, Spring Data</span></div>
<div style="position:absolute;left:267.18px;top:50.99px" class="cls_022"><span class="cls_022">findByUser( ) method</span><span class="cls_113"> 122</span></div>
<div style="position:absolute;left:66.18px;top:60.98px" class="cls_022"><span class="cls_022">adding custom hyperlinks to</span><span class="cls_113"> 167-168</span></div>
<div style="position:absolute;left:267.18px;top:60.98px" class="cls_022"><span class="cls_022">findByUsername( ) method</span><span class="cls_113"> 98, 295, 311, 320</span></div>
<div style="position:absolute;left:66.18px;top:70.97px" class="cls_022"><span class="cls_022">custom, adding</span><span class="cls_113"> 165-167</span></div>
<div style="position:absolute;left:267.18px;top:70.97px" class="cls_022"><span class="cls_022">findByUserOrderByPlacedAtDesc( ) method</span></div>
<div style="position:absolute;left:57.18px;top:80.99px" class="cls_022"><span class="cls_022">@Entity annotation</span><span class="cls_113"> 304</span></div>
<div style="position:absolute;left:285.18px;top:80.99px" class="cls_113"><span class="cls_113">123</span></div>
<div style="position:absolute;left:57.18px;top:90.98px" class="cls_022"><span class="cls_022">entry points</span><span class="cls_113"> 462</span></div>
<div style="position:absolute;left:267.18px;top:90.98px" class="cls_022"><span class="cls_022">findOne( ) method</span><span class="cls_113"> 61-62</span></div>
<div style="position:absolute;left:57.18px;top:100.97px" class="cls_022"><span class="cls_022">environment abstraction</span><span class="cls_113"> 116-117</span></div>
<div style="position:absolute;left:267.18px;top:100.97px" class="cls_022"><span class="cls_022">first in, first out (FIFO)</span><span class="cls_113"> 218</span></div>
<div style="position:absolute;left:57.18px;top:110.99px" class="cls_022"><span class="cls_022">environment properties, Admin server</span><span class="cls_113"> 438</span></div>
<div style="position:absolute;left:267.18px;top:110.99px" class="cls_022"><span class="cls_022">flatMap( ) method</span><span class="cls_113"> 261, 291</span></div>
<div style="position:absolute;left:57.18px;top:120.98px" class="cls_022"><span class="cls_022">equals( ) method</span><span class="cls_113"> 31</span></div>
<div style="position:absolute;left:267.18px;top:120.98px" class="cls_022"><span class="cls_022">Flux data</span><span class="cls_113"> 251-252</span></div>
<div style="position:absolute;left:57.18px;top:130.97px" class="cls_022"><span class="cls_022">errors attribute</span><span class="cls_113"> 50</span></div>
<div style="position:absolute;left:267.18px;top:130.97px" class="cls_022"><span class="cls_022">FluxMessageChannel</span><span class="cls_113"> 218</span></div>
<div style="position:absolute;left:57.18px;top:140.99px" class="cls_022"><span class="cls_022">Eureka service registry</span><span class="cls_113"> 326-334</span></div>
<div style="position:absolute;left:267.18px;top:140.99px" class="cls_022"><span class="cls_022">follow( ) method</span><span class="cls_113"> 176</span></div>
<div style="position:absolute;left:66.18px;top:150.98px" class="cls_022"><span class="cls_022">client-side load balancer</span><span class="cls_113"> 327-330</span></div>
<div style="position:absolute;left:267.18px;top:150.98px" class="cls_022"><span class="cls_022">formLogin( ) method</span><span class="cls_113"> 106</span></div>
<div style="position:absolute;left:66.18px;top:160.97px" class="cls_022"><span class="cls_022">configuring</span><span class="cls_113"> 330-332</span></div>
<div style="position:absolute;left:267.18px;top:160.97px" class="cls_022"><span class="cls_022">forms</span></div>
<div style="position:absolute;left:66.18px;top:170.99px" class="cls_022"><span class="cls_022">overview</span><span class="cls_113"> 326-327</span></div>
<div style="position:absolute;left:276.18px;top:170.99px" class="cls_022"><span class="cls_022">processing submission</span><span class="cls_113"> 40-45</span></div>
<div style="position:absolute;left:66.18px;top:180.98px" class="cls_022"><span class="cls_022">scaling</span><span class="cls_113"> 333-334</span></div>
<div style="position:absolute;left:276.18px;top:180.98px" class="cls_022"><span class="cls_022">validating input</span><span class="cls_113"> 45-51</span></div>
<div style="position:absolute;left:57.18px;top:190.97px" class="cls_022"><span class="cls_022">eureka.client.fetch-registry property</span><span class="cls_113"> 331</span></div>
<div style="position:absolute;left:285.18px;top:190.97px" class="cls_022"><span class="cls_022">declaring validation rules</span><span class="cls_113"> 46-48</span></div>
<div style="position:absolute;left:57.18px;top:200.99px" class="cls_022"><span class="cls_022">eureka.client.register-with-eureka property</span></div>
<div style="position:absolute;left:228.30px;top:200.99px" class="cls_113"><span class="cls_113">331,</span></div>
<div style="position:absolute;left:285.18px;top:200.99px" class="cls_022"><span class="cls_022">displaying validation errors</span><span class="cls_113"> 49-51</span></div>
<div style="position:absolute;left:75.18px;top:210.98px" class="cls_113"><span class="cls_113">434</span></div>
<div style="position:absolute;left:285.18px;top:210.98px" class="cls_022"><span class="cls_022">performing validation at form binding</span></div>
<div style="position:absolute;left:57.18px;top:221.00px" class="cls_022"><span class="cls_022">eureka.client.service-url property</span><span class="cls_113"> 331, 336</span></div>
<div style="position:absolute;left:300.18px;top:221.00px" class="cls_113"><span class="cls_113">48-49</span></div>
<div style="position:absolute;left:57.18px;top:230.99px" class="cls_022"><span class="cls_022">eureka.instance.hostname property</span><span class="cls_113"> 331</span></div>
<div style="position:absolute;left:267.18px;top:230.99px" class="cls_022"><span class="cls_022">frameworkless framework</span><span class="cls_113"> 25</span></div>
<div style="position:absolute;left:57.18px;top:240.98px" class="cls_022"><span class="cls_022">eureka.server.enable-self-preservation</span></div>
<div style="position:absolute;left:267.18px;top:240.98px" class="cls_022"><span class="cls_022">FreeMarker</span><span class="cls_113"> 53</span></div>
<div style="position:absolute;left:75.18px;top:251.00px" class="cls_022"><span class="cls_022">property</span><span class="cls_113"> 331-332</span></div>
<div style="position:absolute;left:267.18px;top:251.00px" class="cls_022"><span class="cls_022">from( ) method</span><span class="cls_113"> 229</span></div>
<div style="position:absolute;left:57.18px;top:260.99px" class="cls_022"><span class="cls_022">evenChannel</span><span class="cls_113"> 221</span></div>
<div style="position:absolute;left:267.18px;top:260.99px" class="cls_022"><span class="cls_022">fromArray( ) method</span><span class="cls_113"> 250, 299</span></div>
<div style="position:absolute;left:57.18px;top:270.98px" class="cls_022"><span class="cls_022">event looping</span><span class="cls_113"> 270</span></div>
<div style="position:absolute;left:267.18px;top:270.98px" class="cls_022"><span class="cls_022">fromIterable( ) method</span><span class="cls_113"> 251, 299</span></div>
<div style="position:absolute;left:57.18px;top:281.00px" class="cls_022"><span class="cls_022">exchange( ) method</span><span class="cls_113"> 171, 291</span></div>
<div style="position:absolute;left:267.18px;top:281.00px" class="cls_022"><span class="cls_022">fromStream( ) method</span><span class="cls_113"> 299</span></div>
<div style="position:absolute;left:57.18px;top:290.99px" class="cls_022"><span class="cls_022">execute( ) method</span><span class="cls_113"> 73, 171</span></div>
<div style="position:absolute;left:57.18px;top:300.98px" class="cls_022"><span class="cls_022">executeAndReturnKey( ) method</span><span class="cls_113"> 73</span></div>
<div style="position:absolute;left:267.18px;top:300.68px" class="cls_112"><span class="cls_112">G</span></div>
<div style="position:absolute;left:57.18px;top:311.00px" class="cls_022"><span class="cls_022">execution.timeout.enabled property</span><span class="cls_113"> 382</span></div>
<div style="position:absolute;left:57.18px;top:320.99px" class="cls_022"><span class="cls_022">ExecutorChannel</span><span class="cls_113"> 218</span></div>
<div style="position:absolute;left:267.18px;top:320.99px" class="cls_022"><span class="cls_022">gateways</span><span class="cls_113"> 227-228</span></div>
<div style="position:absolute;left:57.18px;top:330.98px" class="cls_022"><span class="cls_022">expectStatus( ) method</span><span class="cls_113"> 281</span></div>
<div style="position:absolute;left:267.18px;top:330.98px" class="cls_022"><span class="cls_022">@GeneratedValue annotation</span><span class="cls_113"> 78</span></div>
<div style="position:absolute;left:57.18px;top:341.00px" class="cls_022"><span class="cls_022">ExpressionInterceptUrlRegistry</span><span class="cls_113"> 104</span></div>
<div style="position:absolute;left:267.18px;top:341.00px" class="cls_022"><span class="cls_022">GenericHandler</span><span class="cls_113"> 226</span></div>
<div style="position:absolute;left:267.18px;top:350.99px" class="cls_022"><span class="cls_022">GenericTransformer</span><span class="cls_113"> 214</span></div>
<div style="position:absolute;left:57.18px;top:360.68px" class="cls_112"><span class="cls_112">F</span></div>
<div style="position:absolute;left:267.18px;top:360.98px" class="cls_022"><span class="cls_022">GET requests</span></div>
<div style="position:absolute;left:276.18px;top:371.00px" class="cls_022"><span class="cls_022">handling</span><span class="cls_113"> 34-35</span></div>
<div style="position:absolute;left:57.18px;top:380.99px" class="cls_022"><span class="cls_022">failure and latency</span><span class="cls_113"> 376-391</span></div>
<div style="position:absolute;left:276.18px;top:380.99px" class="cls_022"><span class="cls_022">testing</span><span class="cls_113"> 279-282</span></div>
<div style="position:absolute;left:66.18px;top:390.98px" class="cls_022"><span class="cls_022">aggregating multiple Hystrix streams</span><span class="cls_113"> 389-391</span></div>
<div style="position:absolute;left:267.18px;top:390.98px" class="cls_022"><span class="cls_022">getAuthorities( ) method</span><span class="cls_113"> 97</span></div>
<div style="position:absolute;left:66.18px;top:401.00px" class="cls_022"><span class="cls_022">circuit breakers</span><span class="cls_113"> 376-383</span></div>
<div style="position:absolute;left:267.18px;top:401.00px" class="cls_022"><span class="cls_022">getContent( ) method</span><span class="cls_113"> 273</span></div>
<div style="position:absolute;left:75.18px;top:410.99px" class="cls_022"><span class="cls_022">managing circuit breaker thresholds</span></div>
<div style="position:absolute;left:267.18px;top:410.99px" class="cls_022"><span class="cls_022">getForEntity( ) method</span><span class="cls_113"> 172-173</span></div>
<div style="position:absolute;left:90.18px;top:420.98px" class="cls_113"><span class="cls_113">382-383</span></div>
<div style="position:absolute;left:267.18px;top:420.98px" class="cls_022"><span class="cls_022">getForObject( ) method</span><span class="cls_113"> 172-173, 285, 338</span></div>
<div style="position:absolute;left:75.18px;top:431.00px" class="cls_022"><span class="cls_022">mitigating latency</span><span class="cls_113"> 381-382</span></div>
<div style="position:absolute;left:267.18px;top:431.00px" class="cls_022"><span class="cls_022">getHref( ) method</span><span class="cls_113"> 177</span></div>
<div style="position:absolute;left:66.18px;top:440.99px" class="cls_022"><span class="cls_022">monitoring failures</span><span class="cls_113"> 383-389</span></div>
<div style="position:absolute;left:267.18px;top:440.99px" class="cls_022"><span class="cls_022">getImapUrl( ) method</span><span class="cls_113"> 234</span></div>
<div style="position:absolute;left:75.18px;top:451.01px" class="cls_022"><span class="cls_022">Hystrix dashboard</span><span class="cls_113"> 384-387</span></div>
<div style="position:absolute;left:267.18px;top:451.01px" class="cls_022"><span class="cls_022">@GetMapping annotation</span><span class="cls_113"> 18, 35, 139</span></div>
<div style="position:absolute;left:75.18px;top:461.00px" class="cls_022"><span class="cls_022">Hystrix thread pools</span><span class="cls_113"> 387-389</span></div>
<div style="position:absolute;left:267.18px;top:461.00px" class="cls_022"><span class="cls_022">getMessageConverter( ) method</span><span class="cls_113"> 195</span></div>
<div style="position:absolute;left:57.18px;top:470.99px" class="cls_022"><span class="cls_022">Feign library</span><span class="cls_113"> 340-342</span></div>
<div style="position:absolute;left:267.18px;top:470.99px" class="cls_022"><span class="cls_022">getPrincipal( ) method</span><span class="cls_113"> 112</span></div>
<div style="position:absolute;left:57.18px;top:481.01px" class="cls_022"><span class="cls_022">@FeignClient annotation</span><span class="cls_113"> 341</span></div>
<div style="position:absolute;left:267.18px;top:481.01px" class="cls_022"><span class="cls_022">Git</span></div>
<div style="position:absolute;left:57.18px;top:491.00px" class="cls_022"><span class="cls_022">@Field annotation</span><span class="cls_113"> 314</span></div>
<div style="position:absolute;left:276.18px;top:491.00px" class="cls_022"><span class="cls_022">authenticating with backend</span><span class="cls_113"> 352</span></div>
<div style="position:absolute;left:57.18px;top:500.99px" class="cls_022"><span class="cls_022">FIFO (first in, first out)</span><span class="cls_113"> 218</span></div>
<div style="position:absolute;left:276.18px;top:500.99px" class="cls_022"><span class="cls_022">encrypting properties in</span><span class="cls_113"> 357-360</span></div>
<div style="position:absolute;left:57.18px;top:511.01px" class="cls_022"><span class="cls_022">fileWriterChannel</span><span class="cls_113"> 212</span></div>
<div style="position:absolute;left:276.18px;top:511.01px" class="cls_022"><span class="cls_022">serving configuration from subpaths</span></div>
<div style="position:absolute;left:57.18px;top:521.00px" class="cls_022"><span class="cls_022">FileWriterGateway</span><span class="cls_113"> 211, 227</span></div>
<div style="position:absolute;left:294.18px;top:521.00px" class="cls_113"><span class="cls_113">350-351</span></div>
<div style="position:absolute;left:57.18px;top:530.99px" class="cls_022"><span class="cls_022">FileWritingMessageHandler</span><span class="cls_113"> 214, 230</span></div>
<div style="position:absolute;left:267.18px;top:530.99px" class="cls_022"><span class="cls_022">Gogs notification extractor</span><span class="cls_113"> 373-374</span></div>
<div style="position:absolute;left:57.18px;top:541.01px" class="cls_022"><span class="cls_022">filter( ) method</span><span class="cls_113"> 220, 259</span></div>
<div style="position:absolute;left:267.18px;top:541.01px" class="cls_022"><span class="cls_022">Grails</span><span class="cls_113"> 484</span></div>
<div style="position:absolute;left:57.18px;top:551.00px" class="cls_022"><span class="cls_022">filtering data from reactive types</span><span class="cls_113"> 257-260</span></div>
<div style="position:absolute;left:267.18px;top:551.00px" class="cls_022"><span class="cls_022">greeting.message property</span><span class="cls_113"> 367</span></div>
<div style="position:absolute;left:57.18px;top:560.99px" class="cls_022"><span class="cls_022">filters</span></div>
<div style="position:absolute;left:83.79px;top:560.99px" class="cls_113"><span class="cls_113">219-220</span></div>
<div style="position:absolute;left:267.18px;top:560.99px" class="cls_022"><span class="cls_022">Groovy Templates</span><span class="cls_113"> 53</span></div>
<div style="position:absolute;left:57.18px;top:571.01px" class="cls_022"><span class="cls_022">final property</span><span class="cls_113"> 32</span></div>
<div style="position:absolute;left:267.18px;top:571.01px" class="cls_022"><span class="cls_022">groupId parameter</span><span class="cls_113"> 481</span></div>
<div style="position:absolute;left:57.18px;top:581.00px" class="cls_022"><span class="cls_022">findAll( ) method</span><span class="cls_113"> 61-62, 143</span></div>
<div style="position:absolute;left:267.18px;top:581.00px" class="cls_022"><span class="cls_022">groupSearchBase( ) method</span><span class="cls_113"> 93</span></div>
<div style="position:absolute;left:57.18px;top:590.99px" class="cls_022"><span class="cls_022">findByOrderByCreatedAtDesc( ) method</span><span class="cls_113"> 319</span></div>
<div style="position:absolute;left:267.18px;top:590.99px" class="cls_022"><span class="cls_022">groupSearchFilter( ) method</span><span class="cls_113"> 92</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:339348px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background513.jpg" width="531" height="666"></div>
<div style="position:absolute;left:261.09px;top:26.96px" class="cls_109"><span class="cls_109">INDEX</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_024"><span class="cls_024">491</span></div>
<div style="position:absolute;left:66.18px;top:50.66px" class="cls_112"><span class="cls_112">H</span></div>
<div style="position:absolute;left:276.18px;top:50.99px" class="cls_022"><span class="cls_022">integration. </span><span class="cls_114">See</span><span class="cls_022"> Spring Integration</span></div>
<div style="position:absolute;left:276.18px;top:60.98px" class="cls_022"><span class="cls_022">IntegrationFlows class</span><span class="cls_113"> 216</span></div>
<div style="position:absolute;left:66.18px;top:70.97px" class="cls_022"><span class="cls_022">H2 console</span><span class="cls_113"> 25</span></div>
<div style="position:absolute;left:276.18px;top:70.97px" class="cls_022"><span class="cls_022">IntelliJ IDEA, initializing projects with</span><span class="cls_113"> 470-472</span></div>
<div style="position:absolute;left:66.18px;top:80.99px" class="cls_022"><span class="cls_022">handle( ) method</span><span class="cls_113"> 207, 236</span></div>
<div style="position:absolute;left:276.18px;top:80.99px" class="cls_022"><span class="cls_022">interval( ) method</span><span class="cls_113"> 252</span></div>
<div style="position:absolute;left:66.18px;top:90.98px" class="cls_022"><span class="cls_022">hasErrors( ) method</span><span class="cls_113"> 49</span></div>
<div style="position:absolute;left:276.18px;top:90.98px" class="cls_022"><span class="cls_022">InventoryService bean</span><span class="cls_113"> 5</span></div>
<div style="position:absolute;left:66.18px;top:100.97px" class="cls_022"><span class="cls_022">hashCode( ) method</span><span class="cls_113"> 31</span></div>
<div style="position:absolute;left:66.18px;top:110.99px" class="cls_022"><span class="cls_022">hasRole( ) method</span><span class="cls_113"> 104</span></div>
<div style="position:absolute;left:276.18px;top:110.66px" class="cls_112"><span class="cls_112">J</span></div>
<div style="position:absolute;left:66.18px;top:120.98px" class="cls_022"><span class="cls_022">HATEOAS (Hypermedia as the Engine of</span></div>
<div style="position:absolute;left:84.18px;top:130.97px" class="cls_022"><span class="cls_022">Application State)</span><span class="cls_113"> 149, 399</span></div>
<div style="position:absolute;left:276.18px;top:130.97px" class="cls_022"><span class="cls_022">Jackson2JsonMessageConverter</span><span class="cls_113"> 197</span></div>
<div style="position:absolute;left:66.18px;top:140.99px" class="cls_022"><span class="cls_022">helloRouterFunction( ) method</span><span class="cls_113"> 278</span></div>
<div style="position:absolute;left:276.18px;top:140.99px" class="cls_022"><span class="cls_022">JAR files, pushing to Cloud Foundry</span><span class="cls_113"> 458-461</span></div>
<div style="position:absolute;left:66.18px;top:150.98px" class="cls_022"><span class="cls_022">home( ) method</span><span class="cls_113"> 18</span></div>
<div style="position:absolute;left:276.18px;top:150.98px" class="cls_022"><span class="cls_022">Java Database Connectivity. </span><span class="cls_114">See</span><span class="cls_022"> JDBC</span></div>
<div style="position:absolute;left:66.18px;top:160.97px" class="cls_022"><span class="cls_022">href property</span><span class="cls_113"> 175</span></div>
<div style="position:absolute;left:276.18px;top:160.97px" class="cls_022"><span class="cls_022">Java Management Extensions. </span><span class="cls_114">See</span><span class="cls_022"> JMX</span></div>
<div style="position:absolute;left:66.18px;top:170.99px" class="cls_022"><span class="cls_022">HTTP 404 (Not Found) error</span><span class="cls_113"> 35, 290</span></div>
<div style="position:absolute;left:276.18px;top:170.99px" class="cls_022"><span class="cls_022">Java Message Service. </span><span class="cls_114">See</span><span class="cls_022"> JMS</span></div>
<div style="position:absolute;left:66.18px;top:180.98px" class="cls_022"><span class="cls_022">HTTP requests</span></div>
<div style="position:absolute;left:276.18px;top:180.98px" class="cls_022"><span class="cls_022">Java Persistence API. </span><span class="cls_114">See</span><span class="cls_022"> Spring Data JPA</span></div>
<div style="position:absolute;left:75.18px;top:190.97px" class="cls_022"><span class="cls_022">mappings</span><span class="cls_113"> 408-409</span></div>
<div style="position:absolute;left:276.18px;top:190.97px" class="cls_022"><span class="cls_022">Java Streams</span><span class="cls_113"> 244</span></div>
<div style="position:absolute;left:75.18px;top:200.99px" class="cls_022"><span class="cls_022">tracing</span><span class="cls_113"> 441-442</span></div>
<div style="position:absolute;left:276.18px;top:200.99px" class="cls_022"><span class="cls_022">Java virtual machine (JVM)</span><span class="cls_113"> 24</span></div>
<div style="position:absolute;left:66.18px;top:210.98px" class="cls_022"><span class="cls_022">HTTPie</span><span class="cls_113"> 144</span></div>
<div style="position:absolute;left:276.18px;top:210.98px" class="cls_022"><span class="cls_022">Java, configuring integration flows in</span><span class="cls_113"> 213-215</span></div>
<div style="position:absolute;left:66.18px;top:221.00px" class="cls_022"><span class="cls_022">Hypermedia as the Engine of Application State</span></div>
<div style="position:absolute;left:276.18px;top:221.00px" class="cls_022"><span class="cls_022">JavaServer Pages (JSP)</span><span class="cls_113"> 35</span></div>
<div style="position:absolute;left:84.18px;top:230.99px" class="cls_022"><span class="cls_022">(HATEOAS)</span><span class="cls_113"> 149, 399</span></div>
<div style="position:absolute;left:276.18px;top:230.99px" class="cls_022"><span class="cls_022">javaVersion parameter</span><span class="cls_113"> 482</span></div>
<div style="position:absolute;left:66.18px;top:240.98px" class="cls_022"><span class="cls_022">hypermedia, enabling</span><span class="cls_113"> 149-160</span></div>
<div style="position:absolute;left:276.18px;top:240.98px" class="cls_022"><span class="cls_022">JDBC (Java Database Connectivity) based user</span></div>
<div style="position:absolute;left:75.18px;top:251.00px" class="cls_022"><span class="cls_022">adding hyperlinks</span><span class="cls_113"> 152-154</span></div>
<div style="position:absolute;left:294.18px;top:251.00px" class="cls_022"><span class="cls_022">store</span><span class="cls_113"> 89-92</span></div>
<div style="position:absolute;left:75.18px;top:260.99px" class="cls_022"><span class="cls_022">creating resource assemblers</span><span class="cls_113"> 154-158</span></div>
<div style="position:absolute;left:285.18px;top:260.99px" class="cls_022"><span class="cls_022">overriding default user queries</span><span class="cls_113"> 90-91</span></div>
<div style="position:absolute;left:75.18px;top:270.98px" class="cls_022"><span class="cls_022">naming embedded relationships</span><span class="cls_113"> 159-160</span></div>
<div style="position:absolute;left:285.18px;top:270.98px" class="cls_022"><span class="cls_022">working with encoded passwords</span><span class="cls_113"> 91-92</span></div>
<div style="position:absolute;left:66.18px;top:281.00px" class="cls_022"><span class="cls_022">Hystrix</span></div>
<div style="position:absolute;left:276.18px;top:281.00px" class="cls_022"><span class="cls_022">JDBC (Java Database Connectivity), reading and</span></div>
<div style="position:absolute;left:75.18px;top:290.99px" class="cls_022"><span class="cls_022">dashboard</span><span class="cls_113"> 384-387</span></div>
<div style="position:absolute;left:294.18px;top:290.99px" class="cls_022"><span class="cls_022">writing data with</span><span class="cls_113"> 57-75</span></div>
<div style="position:absolute;left:75.18px;top:300.98px" class="cls_022"><span class="cls_022">streams, aggregating multiple</span><span class="cls_113"> 389-391</span></div>
<div style="position:absolute;left:285.18px;top:300.98px" class="cls_022"><span class="cls_022">adapting domain for persistence</span><span class="cls_113"> 59</span></div>
<div style="position:absolute;left:75.18px;top:311.00px" class="cls_022"><span class="cls_022">thread pools</span><span class="cls_113"> 387-389</span></div>
<div style="position:absolute;left:285.18px;top:311.00px" class="cls_022"><span class="cls_022">defining schema and preloading data</span><span class="cls_113"> 64-66</span></div>
<div style="position:absolute;left:66.18px;top:320.99px" class="cls_022"><span class="cls_022">@HystrixCommand annotation</span><span class="cls_113"> 378</span></div>
<div style="position:absolute;left:285.18px;top:320.99px" class="cls_022"><span class="cls_022">inserting data</span><span class="cls_113"> 66-75</span></div>
<div style="position:absolute;left:285.18px;top:330.98px" class="cls_022"><span class="cls_022">working with JdbcTemplate</span><span class="cls_113"> 60-64</span></div>
<div style="position:absolute;left:66.18px;top:340.67px" class="cls_112"><span class="cls_112">I</span></div>
<div style="position:absolute;left:276.18px;top:341.00px" class="cls_022"><span class="cls_022">jdbcAuthentication( ) method</span><span class="cls_113"> 90</span></div>
<div style="position:absolute;left:276.18px;top:350.99px" class="cls_022"><span class="cls_022">JdbcTemplate class</span><span class="cls_113"> 26, 57</span></div>
<div style="position:absolute;left:66.18px;top:360.98px" class="cls_022"><span class="cls_022">IAAS (Infrastructure-as-a-Service)</span><span class="cls_113"> 461</span></div>
<div style="position:absolute;left:276.18px;top:360.98px" class="cls_022"><span class="cls_022">JHipster</span><span class="cls_113"> 484</span></div>
<div style="position:absolute;left:66.18px;top:371.00px" class="cls_022"><span class="cls_022">@Id annotation</span><span class="cls_113"> 77, 314</span></div>
<div style="position:absolute;left:276.18px;top:371.00px" class="cls_022"><span class="cls_022">JMS (Java Message Service)</span><span class="cls_113"> 179-192</span></div>
<div style="position:absolute;left:66.18px;top:380.99px" class="cls_022"><span class="cls_022">imperative code</span><span class="cls_113"> 242</span></div>
<div style="position:absolute;left:285.18px;top:380.99px" class="cls_022"><span class="cls_022">JmsTemplate</span><span class="cls_113"> 181-188</span></div>
<div style="position:absolute;left:66.18px;top:390.98px" class="cls_022"><span class="cls_022">@ImportResource annotation</span><span class="cls_113"> 213</span></div>
<div style="position:absolute;left:294.18px;top:390.98px" class="cls_022"><span class="cls_022">configuring message converter</span><span class="cls_113"> 185-187</span></div>
<div style="position:absolute;left:66.18px;top:401.00px" class="cls_022"><span class="cls_022">inboundAdapter( ) method</span><span class="cls_113"> 229</span></div>
<div style="position:absolute;left:294.18px;top:401.00px" class="cls_022"><span class="cls_022">converting messages before sending</span><span class="cls_113"> 185</span></div>
<div style="position:absolute;left:66.18px;top:410.99px" class="cls_022"><span class="cls_022">@InboundChannelAdapter annotation</span><span class="cls_113"> 229</span></div>
<div style="position:absolute;left:294.18px;top:410.99px" class="cls_022"><span class="cls_022">post-processing messages</span><span class="cls_113"> 187-188</span></div>
<div style="position:absolute;left:66.18px;top:420.98px" class="cls_022"><span class="cls_022">incognito mode</span><span class="cls_113"> 88</span></div>
<div style="position:absolute;left:285.18px;top:420.98px" class="cls_022"><span class="cls_022">receiving messages</span><span class="cls_113"> 188-192</span></div>
<div style="position:absolute;left:66.18px;top:431.00px" class="cls_022"><span class="cls_022">/info endpoint, contributing information to</span></div>
<div style="position:absolute;left:294.18px;top:430.99px" class="cls_022"><span class="cls_022">declaring message listeners</span><span class="cls_113"> 191-192</span></div>
<div style="position:absolute;left:84.18px;top:440.99px" class="cls_113"><span class="cls_113">416-420</span></div>
<div style="position:absolute;left:294.18px;top:440.98px" class="cls_022"><span class="cls_022">with JmsTemplate</span><span class="cls_113"> 189-191</span></div>
<div style="position:absolute;left:66.18px;top:451.01px" class="cls_022"><span class="cls_022">InfoContributor interface</span><span class="cls_113"> 416</span></div>
<div style="position:absolute;left:285.18px;top:451.00px" class="cls_022"><span class="cls_022">setting up</span><span class="cls_113"> 179-181</span></div>
<div style="position:absolute;left:66.18px;top:461.00px" class="cls_022"><span class="cls_022">Infrastructure-as-a-Service (IAAS)</span><span class="cls_113"> 461</span></div>
<div style="position:absolute;left:276.18px;top:461.00px" class="cls_022"><span class="cls_022">@JmsListener annotation</span><span class="cls_113"> 191, 202</span></div>
<div style="position:absolute;left:66.18px;top:470.99px" class="cls_022"><span class="cls_022">initializing applications</span><span class="cls_113"> 6-17</span></div>
<div style="position:absolute;left:276.18px;top:470.99px" class="cls_022"><span class="cls_022">JmsOrderMessagingService</span><span class="cls_113"> 183</span></div>
<div style="position:absolute;left:66.18px;top:481.01px" class="cls_022"><span class="cls_022">initializing projects</span></div>
<div style="position:absolute;left:276.18px;top:481.01px" class="cls_022"><span class="cls_022">jms.send( ) method</span><span class="cls_113"> 183</span></div>
<div style="position:absolute;left:75.18px;top:491.00px" class="cls_022"><span class="cls_022">at start.spring.io</span></div>
<div style="position:absolute;left:142.95px;top:491.00px" class="cls_113"><span class="cls_113">477-479</span></div>
<div style="position:absolute;left:276.18px;top:491.00px" class="cls_022"><span class="cls_022">JmsTemplate</span><span class="cls_113"> 181-188</span></div>
<div style="position:absolute;left:75.18px;top:500.99px" class="cls_022"><span class="cls_022">from command line</span><span class="cls_113"> 480-484</span></div>
<div style="position:absolute;left:285.18px;top:500.99px" class="cls_022"><span class="cls_022">configuring message converter</span><span class="cls_113"> 185-187</span></div>
<div style="position:absolute;left:84.18px;top:511.01px" class="cls_022"><span class="cls_022">curl and Initializr API</span><span class="cls_113"> 481-482</span></div>
<div style="position:absolute;left:285.18px;top:511.01px" class="cls_022"><span class="cls_022">converting messages before sending</span><span class="cls_113"> 185</span></div>
<div style="position:absolute;left:84.18px;top:521.00px" class="cls_022"><span class="cls_022">interface</span><span class="cls_113"> 483-484</span></div>
<div style="position:absolute;left:285.18px;top:521.00px" class="cls_022"><span class="cls_022">post-processing messages</span><span class="cls_113"> 187-188</span></div>
<div style="position:absolute;left:75.18px;top:530.99px" class="cls_022"><span class="cls_022">with IntelliJ IDEA</span><span class="cls_113"> 470-472</span></div>
<div style="position:absolute;left:285.18px;top:530.99px" class="cls_022"><span class="cls_022">receiving messages with</span><span class="cls_113"> 189-191</span></div>
<div style="position:absolute;left:75.18px;top:541.01px" class="cls_022"><span class="cls_022">with NetBeans</span><span class="cls_113"> 473-476</span></div>
<div style="position:absolute;left:276.18px;top:541.01px" class="cls_022"><span class="cls_022">JMX (Java Management Extensions)</span><span class="cls_113"> 446-453</span></div>
<div style="position:absolute;left:75.18px;top:551.00px" class="cls_022"><span class="cls_022">with Spring Tool Suite</span><span class="cls_113"> 7-11, 466-470</span></div>
<div style="position:absolute;left:285.18px;top:551.00px" class="cls_022"><span class="cls_022">Actuator MBeans</span><span class="cls_113"> 446-449</span></div>
<div style="position:absolute;left:66.18px;top:560.99px" class="cls_022"><span class="cls_022">Initializr API</span><span class="cls_113"> 481-482</span></div>
<div style="position:absolute;left:285.18px;top:560.99px" class="cls_022"><span class="cls_022">creating MBeans</span><span class="cls_113"> 449-451</span></div>
<div style="position:absolute;left:66.18px;top:571.01px" class="cls_022"><span class="cls_022">in-memory user store</span><span class="cls_113"> 88-89</span></div>
<div style="position:absolute;left:285.18px;top:571.01px" class="cls_022"><span class="cls_022">sending notifications</span><span class="cls_113"> 451-453</span></div>
<div style="position:absolute;left:66.18px;top:581.00px" class="cls_022"><span class="cls_022">inMemoryAuthentication( ) method</span><span class="cls_113"> 89</span></div>
<div style="position:absolute;left:276.18px;top:581.00px" class="cls_022"><span class="cls_022">JPA (Java Persistence API). </span><span class="cls_114">See</span><span class="cls_022"> Spring Data JPA</span></div>
<div style="position:absolute;left:66.18px;top:590.99px" class="cls_022"><span class="cls_022">instantiateResource( ) method</span><span class="cls_113"> 156</span></div>
<div style="position:absolute;left:294.18px;top:590.99px" class="cls_022"><span class="cls_022">(Java Persistence API)</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:340024px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background514.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_024"><span class="cls_024">492</span></div>
<div style="position:absolute;left:252.09px;top:26.96px" class="cls_109"><span class="cls_109">INDEX</span></div>
<div style="position:absolute;left:57.18px;top:50.99px" class="cls_022"><span class="cls_022">jsonPath( ) method</span><span class="cls_113"> 281</span></div>
<div style="position:absolute;left:267.18px;top:50.99px" class="cls_022"><span class="cls_022">MappingJackson2MessageConverter</span><span class="cls_113"> 186</span></div>
<div style="position:absolute;left:57.18px;top:60.98px" class="cls_022"><span class="cls_022">JSP (JavaServer Pages)</span><span class="cls_113"> 35</span></div>
<div style="position:absolute;left:267.18px;top:60.98px" class="cls_022"><span class="cls_022">mapRowToIngredient( ) method</span><span class="cls_113"> 58</span></div>
<div style="position:absolute;left:57.18px;top:70.97px" class="cls_022"><span class="cls_022">just( ) method</span><span class="cls_113"> 246</span></div>
<div style="position:absolute;left:267.18px;top:70.97px" class="cls_022"><span class="cls_022">MarshallingMessageConverter</span><span class="cls_113"> 197</span></div>
<div style="position:absolute;left:57.18px;top:80.99px" class="cls_022"><span class="cls_022">JVM (Java virtual machine)</span><span class="cls_113"> 24</span></div>
<div style="position:absolute;left:267.18px;top:80.99px" class="cls_022"><span class="cls_022">matches( ) method</span><span class="cls_113"> 92</span></div>
<div style="position:absolute;left:267.18px;top:90.98px" class="cls_022"><span class="cls_022">@Max annotation</span><span class="cls_113"> 126</span></div>
<div style="position:absolute;left:57.18px;top:100.67px" class="cls_112"><span class="cls_112">K</span></div>
<div style="position:absolute;left:267.18px;top:100.97px" class="cls_022"><span class="cls_022">MBeans</span></div>
<div style="position:absolute;left:276.18px;top:110.99px" class="cls_022"><span class="cls_022">Actuator MBeans</span><span class="cls_113"> 446-449</span></div>
<div style="position:absolute;left:57.18px;top:120.98px" class="cls_022"><span class="cls_022">Kafka</span><span class="cls_113"> 202-208</span></div>
<div style="position:absolute;left:276.18px;top:120.98px" class="cls_022"><span class="cls_022">creating</span><span class="cls_113"> 449-451</span></div>
<div style="position:absolute;left:66.18px;top:130.97px" class="cls_022"><span class="cls_022">sending messages with KafkaTemplate</span><span class="cls_113"> 204-206</span></div>
<div style="position:absolute;left:267.18px;top:130.97px" class="cls_022"><span class="cls_022">MDBs (message-driven beans)</span><span class="cls_113"> 179</span></div>
<div style="position:absolute;left:66.18px;top:140.99px" class="cls_022"><span class="cls_022">setting up</span><span class="cls_113"> 203-204</span></div>
<div style="position:absolute;left:267.18px;top:140.99px" class="cls_022"><span class="cls_022">mergeWith( ) method</span><span class="cls_113"> 253</span></div>
<div style="position:absolute;left:66.18px;top:150.98px" class="cls_022"><span class="cls_022">writing listeners</span><span class="cls_113"> 206-208</span></div>
<div style="position:absolute;left:267.18px;top:150.98px" class="cls_022"><span class="cls_022">message channels</span><span class="cls_113"> 217-219</span></div>
<div style="position:absolute;left:267.18px;top:160.97px" class="cls_022"><span class="cls_022">message-driven beans (MDBs)</span><span class="cls_113"> 179</span></div>
<div style="position:absolute;left:57.18px;top:170.66px" class="cls_112"><span class="cls_112">L</span></div>
<div style="position:absolute;left:267.18px;top:170.99px" class="cls_022"><span class="cls_022">MessagePostProcessor</span><span class="cls_113"> 182, 188, 198</span></div>
<div style="position:absolute;left:267.18px;top:180.98px" class="cls_022"><span class="cls_022">MessageProperties</span><span class="cls_113"> 196</span></div>
<div style="position:absolute;left:57.18px;top:190.97px" class="cls_022"><span class="cls_022">latency. </span><span class="cls_114">See</span><span class="cls_022"> failure and latency</span></div>
<div style="position:absolute;left:267.18px;top:190.97px" class="cls_022"><span class="cls_022">messaging. </span><span class="cls_114">See</span><span class="cls_022"> asynchronous messaging</span></div>
<div style="position:absolute;left:57.18px;top:200.99px" class="cls_022"><span class="cls_022">LDAP (Lightweight Directory Access Protocol)</span></div>
<div style="position:absolute;left:267.18px;top:200.99px" class="cls_022"><span class="cls_022">@MessagingGateway annotation</span><span class="cls_113"> 211</span></div>
<div style="position:absolute;left:75.18px;top:210.98px" class="cls_022"><span class="cls_022">backed user store</span><span class="cls_113"> 92-96</span></div>
<div style="position:absolute;left:267.18px;top:210.98px" class="cls_022"><span class="cls_022">MessagingMessageConverter</span><span class="cls_113"> 197</span></div>
<div style="position:absolute;left:66.18px;top:221.00px" class="cls_022"><span class="cls_022">configuring embedded LDAP server</span><span class="cls_113"> 94-96</span></div>
<div style="position:absolute;left:267.18px;top:220.99px" class="cls_022"><span class="cls_022">metadata, declaring</span><span class="cls_113"> 126-129</span></div>
<div style="position:absolute;left:66.18px;top:230.99px" class="cls_022"><span class="cls_022">configuring password comparison</span><span class="cls_113"> 93-94</span></div>
<div style="position:absolute;left:267.18px;top:230.98px" class="cls_022"><span class="cls_022">MeterRegistry</span><span class="cls_113"> 422</span></div>
<div style="position:absolute;left:66.18px;top:240.98px" class="cls_022"><span class="cls_022">referring to remote LDAP server</span><span class="cls_113"> 94</span></div>
<div style="position:absolute;left:267.18px;top:240.97px" class="cls_022"><span class="cls_022">methodOn( ) method</span><span class="cls_113"> 154</span></div>
<div style="position:absolute;left:57.18px;top:251.00px" class="cls_022"><span class="cls_022">LDIF (LDAP Data Interchange Format)</span><span class="cls_113"> 95</span></div>
<div style="position:absolute;left:267.18px;top:250.99px" class="cls_022"><span class="cls_022">Micrometer</span><span class="cls_113"> 422</span></div>
<div style="position:absolute;left:57.18px;top:260.99px" class="cls_022"><span class="cls_022">links property</span><span class="cls_113"> 151</span></div>
<div style="position:absolute;left:267.18px;top:260.98px" class="cls_022"><span class="cls_022">microservices</span><span class="cls_113"> 323-342</span></div>
<div style="position:absolute;left:57.18px;top:270.98px" class="cls_022"><span class="cls_022">linkTo( ) method</span><span class="cls_113"> 154</span></div>
<div style="position:absolute;left:276.18px;top:270.97px" class="cls_022"><span class="cls_022">Eureka service registry</span><span class="cls_113"> 326-334</span></div>
<div style="position:absolute;left:57.18px;top:281.00px" class="cls_022"><span class="cls_022">LiveReload</span><span class="cls_113"> 24</span></div>
<div style="position:absolute;left:285.18px;top:280.99px" class="cls_022"><span class="cls_022">client-side load balancer</span><span class="cls_113"> 327-330</span></div>
<div style="position:absolute;left:57.18px;top:290.99px" class="cls_022"><span class="cls_022">@LoadBalanced annotation</span><span class="cls_113"> 338</span></div>
<div style="position:absolute;left:285.18px;top:290.98px" class="cls_022"><span class="cls_022">configuring</span><span class="cls_113"> 330-332</span></div>
<div style="position:absolute;left:57.18px;top:300.98px" class="cls_022"><span class="cls_022">loadByUsername( ) method</span><span class="cls_113"> 99</span></div>
<div style="position:absolute;left:285.18px;top:300.97px" class="cls_022"><span class="cls_022">configuring Eureka client properties</span></div>
<div style="position:absolute;left:432.45px;top:300.98px" class="cls_113"><span class="cls_113">335-337</span></div>
<div style="position:absolute;left:57.18px;top:311.00px" class="cls_022"><span class="cls_022">log( ) method</span><span class="cls_113"> 264</span></div>
<div style="position:absolute;left:285.18px;top:311.00px" class="cls_022"><span class="cls_022">overview</span><span class="cls_113"> 326-327</span></div>
<div style="position:absolute;left:57.18px;top:320.99px" class="cls_022"><span class="cls_022">Logback</span><span class="cls_113"> 120</span></div>
<div style="position:absolute;left:285.18px;top:320.99px" class="cls_022"><span class="cls_022">scaling</span><span class="cls_113"> 333-334</span></div>
<div style="position:absolute;left:57.18px;top:330.98px" class="cls_022"><span class="cls_022">loggerLevels</span><span class="cls_113"> 448</span></div>
<div style="position:absolute;left:276.18px;top:330.98px" class="cls_022"><span class="cls_022">overview</span><span class="cls_113"> 324-326</span></div>
<div style="position:absolute;left:57.18px;top:341.00px" class="cls_022"><span class="cls_022">logging</span></div>
<div style="position:absolute;left:276.18px;top:341.00px" class="cls_022"><span class="cls_022">registering and discovering services</span><span class="cls_113"> 334-342</span></div>
<div style="position:absolute;left:66.18px;top:350.99px" class="cls_022"><span class="cls_022">configuring</span><span class="cls_113"> 120-121</span></div>
<div style="position:absolute;left:285.18px;top:350.99px" class="cls_022"><span class="cls_022">configuring Eureka client properties</span></div>
<div style="position:absolute;left:66.18px;top:360.98px" class="cls_022"><span class="cls_022">out</span><span class="cls_113"> 109</span></div>
<div style="position:absolute;left:300.18px;top:360.98px" class="cls_113"><span class="cls_113">335-337</span></div>
<div style="position:absolute;left:57.18px;top:371.00px" class="cls_022"><span class="cls_022">logging.file property</span><span class="cls_113"> 121</span></div>
<div style="position:absolute;left:285.18px;top:371.00px" class="cls_022"><span class="cls_022">consuming services</span><span class="cls_113"> 337-342</span></div>
<div style="position:absolute;left:57.18px;top:380.99px" class="cls_022"><span class="cls_022">logging.path property</span><span class="cls_113"> 121</span></div>
<div style="position:absolute;left:267.18px;top:380.99px" class="cls_022"><span class="cls_022">@Min annotation</span><span class="cls_113"> 126</span></div>
<div style="position:absolute;left:57.18px;top:390.98px" class="cls_022"><span class="cls_022">loginPage( ) method</span><span class="cls_113"> 107</span></div>
<div style="position:absolute;left:267.18px;top:390.98px" class="cls_022"><span class="cls_022">@ModelAttribute annotation</span><span class="cls_113"> 70</span></div>
<div style="position:absolute;left:57.18px;top:401.00px" class="cls_022"><span class="cls_022">Lombok</span><span class="cls_113"> 32, 478</span></div>
<div style="position:absolute;left:267.18px;top:401.00px" class="cls_022"><span class="cls_022">MongoDB. </span><span class="cls_114">See</span><span class="cls_022"> Spring Data MongoDB</span></div>
<div style="position:absolute;left:267.18px;top:410.99px" class="cls_022"><span class="cls_022">MongoRepository</span><span class="cls_113"> 318</span></div>
<div style="position:absolute;left:57.18px;top:420.68px" class="cls_112"><span class="cls_112">M</span></div>
<div style="position:absolute;left:267.18px;top:420.98px" class="cls_022"><span class="cls_022">MongoTemplate bean</span><span class="cls_113"> 405</span></div>
<div style="position:absolute;left:267.18px;top:431.00px" class="cls_022"><span class="cls_022">monitoring Spring. </span><span class="cls_114">See</span><span class="cls_022"> JMX</span></div>
<div style="position:absolute;left:57.18px;top:440.99px" class="cls_022"><span class="cls_022">Mail.imapInboundAdapter( ) method</span><span class="cls_113"> 234</span></div>
<div style="position:absolute;left:267.18px;top:440.99px" class="cls_022"><span class="cls_022">monitoring threads, Admin server</span><span class="cls_113"> 440</span></div>
<div style="position:absolute;left:57.18px;top:451.01px" class="cls_022"><span class="cls_022">main( ) method</span><span class="cls_113"> 16</span></div>
<div style="position:absolute;left:267.18px;top:451.01px" class="cls_022"><span class="cls_022">MPA (multipage application)</span><span class="cls_113"> 139</span></div>
<div style="position:absolute;left:57.18px;top:461.00px" class="cls_022"><span class="cls_022">@ManagedAttribute annotation</span><span class="cls_113"> 449</span></div>
<div style="position:absolute;left:267.18px;top:461.00px" class="cls_022"><span class="cls_022">Mustache</span><span class="cls_113"> 53</span></div>
<div style="position:absolute;left:57.18px;top:470.99px" class="cls_022"><span class="cls_022">@ManagedOperation annotation</span><span class="cls_113"> 449</span></div>
<div style="position:absolute;left:57.18px;top:481.01px" class="cls_022"><span class="cls_022">@ManagedResource annotation</span><span class="cls_113"> 449</span></div>
<div style="position:absolute;left:267.18px;top:480.68px" class="cls_112"><span class="cls_112">N</span></div>
<div style="position:absolute;left:57.18px;top:491.00px" class="cls_022"><span class="cls_022">management.endpoint.health.show-details</span></div>
<div style="position:absolute;left:75.18px;top:500.99px" class="cls_022"><span class="cls_022">property</span><span class="cls_113"> 401</span></div>
<div style="position:absolute;left:267.18px;top:500.99px" class="cls_022"><span class="cls_022">name parameter</span><span class="cls_113"> 481</span></div>
<div style="position:absolute;left:57.18px;top:511.01px" class="cls_022"><span class="cls_022">management.endpoints.web.exposure.exclude</span></div>
<div style="position:absolute;left:267.18px;top:511.01px" class="cls_022"><span class="cls_022">NetBeans, initializing projects with</span><span class="cls_113"> 473-476</span></div>
<div style="position:absolute;left:75.18px;top:521.00px" class="cls_022"><span class="cls_022">property</span><span class="cls_113"> 398</span></div>
<div style="position:absolute;left:267.18px;top:521.00px" class="cls_022"><span class="cls_022">NetworkTopologyStrategy</span><span class="cls_113"> 302</span></div>
<div style="position:absolute;left:57.18px;top:530.99px" class="cls_022"><span class="cls_022">management.endpoints.web.exposure.include</span></div>
<div style="position:absolute;left:267.18px;top:530.99px" class="cls_022"><span class="cls_022">ngOnInit( ) method</span><span class="cls_113"> 140</span></div>
<div style="position:absolute;left:75.18px;top:541.01px" class="cls_022"><span class="cls_022">property</span><span class="cls_113"> 398</span></div>
<div style="position:absolute;left:267.18px;top:541.01px" class="cls_022"><span class="cls_022">@NoArgsConstructor annotation</span><span class="cls_113"> 77</span></div>
<div style="position:absolute;left:57.18px;top:551.00px" class="cls_022"><span class="cls_022">management.endpoint.web.base-path</span></div>
<div style="position:absolute;left:267.18px;top:551.00px" class="cls_022"><span class="cls_022">Not Found (HTTP 404) error</span><span class="cls_113"> 35, 290</span></div>
<div style="position:absolute;left:75.18px;top:560.99px" class="cls_022"><span class="cls_022">property</span><span class="cls_113"> 397</span></div>
<div style="position:absolute;left:267.18px;top:560.99px" class="cls_022"><span class="cls_022">@NotBlank annotation</span><span class="cls_113"> 47</span></div>
<div style="position:absolute;left:57.18px;top:571.01px" class="cls_022"><span class="cls_022">@ManyToMany annotation</span><span class="cls_113"> 78</span></div>
<div style="position:absolute;left:267.18px;top:571.01px" class="cls_022"><span class="cls_022">notes( ) method</span><span class="cls_113"> 425</span></div>
<div style="position:absolute;left:57.18px;top:581.00px" class="cls_022"><span class="cls_022">map( ) method</span><span class="cls_113"> 246</span></div>
<div style="position:absolute;left:267.18px;top:581.00px" class="cls_022"><span class="cls_022">NotesEndpoint class</span><span class="cls_113"> 424</span></div>
<div style="position:absolute;left:57.18px;top:590.99px" class="cls_022"><span class="cls_022">mapping reactive data</span><span class="cls_113"> 260-263</span></div>
<div style="position:absolute;left:267.18px;top:590.99px" class="cls_022"><span class="cls_022">NotificationPublisherAware interface</span><span class="cls_113"> 451</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:340700px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background515.jpg" width="531" height="666"></div>
<div style="position:absolute;left:261.09px;top:26.96px" class="cls_109"><span class="cls_109">INDEX</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_024"><span class="cls_024">493</span></div>
<div style="position:absolute;left:66.18px;top:50.99px" class="cls_022"><span class="cls_022">@NotNull annotation</span><span class="cls_113"> 46</span></div>
<div style="position:absolute;left:276.18px;top:50.99px" class="cls_022"><span class="cls_022">ProductService bean</span><span class="cls_113"> 5</span></div>
<div style="position:absolute;left:66.18px;top:60.98px" class="cls_022"><span class="cls_022">numberChannel</span><span class="cls_113"> 220</span></div>
<div style="position:absolute;left:276.18px;top:60.98px" class="cls_022"><span class="cls_022">profiles</span><span class="cls_113"> 129-133</span></div>
<div style="position:absolute;left:285.18px;top:70.97px" class="cls_022"><span class="cls_022">activating</span><span class="cls_113"> 131-132</span></div>
<div style="position:absolute;left:66.18px;top:80.66px" class="cls_112"><span class="cls_112">O</span></div>
<div style="position:absolute;left:285.18px;top:80.98px" class="cls_022"><span class="cls_022">conditionally creating beans with</span><span class="cls_113"> 132-133</span></div>
<div style="position:absolute;left:285.18px;top:90.98px" class="cls_022"><span class="cls_022">defining profile-specific properties</span><span class="cls_113"> 130-131</span></div>
<div style="position:absolute;left:66.18px;top:100.97px" class="cls_022"><span class="cls_022">objects, creating reactive types from</span><span class="cls_113"> 249-250</span></div>
<div style="position:absolute;left:276.18px;top:100.97px" class="cls_022"><span class="cls_022">projects. </span><span class="cls_114">See</span><span class="cls_022"> Spring projects</span></div>
<div style="position:absolute;left:66.18px;top:110.99px" class="cls_022"><span class="cls_022">oddChannel</span><span class="cls_113"> 221</span></div>
<div style="position:absolute;left:276.18px;top:110.99px" class="cls_022"><span class="cls_022">property injection</span><span class="cls_113"> 115</span></div>
<div style="position:absolute;left:66.18px;top:120.98px" class="cls_022"><span class="cls_022">onAfterCreate( ) method</span><span class="cls_113"> 423, 451</span></div>
<div style="position:absolute;left:276.18px;top:120.98px" class="cls_022"><span class="cls_022">propertySources property</span><span class="cls_113"> 349</span></div>
<div style="position:absolute;left:66.18px;top:130.97px" class="cls_022"><span class="cls_022">onError( ) method</span><span class="cls_113"> 245</span></div>
<div style="position:absolute;left:276.18px;top:130.97px" class="cls_022"><span class="cls_022">PublishSubscribeChannel</span><span class="cls_113"> 217</span></div>
<div style="position:absolute;left:66.18px;top:140.99px" class="cls_022"><span class="cls_022">onNext( ) method</span><span class="cls_113"> 245</span></div>
<div style="position:absolute;left:276.18px;top:140.99px" class="cls_022"><span class="cls_022">pull model</span><span class="cls_113"> 188</span></div>
<div style="position:absolute;left:66.18px;top:150.98px" class="cls_022"><span class="cls_022">onStatus( ) method</span><span class="cls_113"> 289</span></div>
<div style="position:absolute;left:276.18px;top:150.98px" class="cls_022"><span class="cls_022">push model</span><span class="cls_113"> 188</span></div>
<div style="position:absolute;left:66.18px;top:160.97px" class="cls_022"><span class="cls_022">onSubmit( ) method</span><span class="cls_113"> 145</span></div>
<div style="position:absolute;left:276.18px;top:160.97px" class="cls_022"><span class="cls_022">put( ) method</span><span class="cls_113"> 173</span></div>
<div style="position:absolute;left:66.18px;top:170.99px" class="cls_022"><span class="cls_022">onSubscribe( ) method</span><span class="cls_113"> 244</span></div>
<div style="position:absolute;left:276.18px;top:170.99px" class="cls_022"><span class="cls_022">PWS (Pivotal Web Services)</span><span class="cls_113"> 459</span></div>
<div style="position:absolute;left:66.18px;top:180.98px" class="cls_022"><span class="cls_022">OpenFeign</span><span class="cls_113"> 340</span></div>
<div style="position:absolute;left:66.18px;top:190.97px" class="cls_022"><span class="cls_022">OrderController class</span><span class="cls_113"> 43</span></div>
<div style="position:absolute;left:276.18px;top:190.67px" class="cls_112"><span class="cls_112">Q</span></div>
<div style="position:absolute;left:66.18px;top:200.99px" class="cls_022"><span class="cls_022">orderForm( ) method</span><span class="cls_113"> 42</span></div>
<div style="position:absolute;left:66.18px;top:210.98px" class="cls_022"><span class="cls_022">orderInserter variable</span><span class="cls_113"> 72</span></div>
<div style="position:absolute;left:276.18px;top:210.98px" class="cls_022"><span class="cls_022">query( ) method</span><span class="cls_113"> 63</span></div>
<div style="position:absolute;left:66.18px;top:221.00px" class="cls_022"><span class="cls_022">ordersForUser( ) method</span><span class="cls_113"> 122</span></div>
<div style="position:absolute;left:276.18px;top:221.00px" class="cls_022"><span class="cls_022">queryForObject( ) method</span><span class="cls_113"> 58, 62-63</span></div>
<div style="position:absolute;left:66.18px;top:230.99px" class="cls_022"><span class="cls_022">OrderSplitter</span><span class="cls_113"> 224</span></div>
<div style="position:absolute;left:276.18px;top:230.99px" class="cls_022"><span class="cls_022">QueueChannel</span><span class="cls_113"> 218</span></div>
<div style="position:absolute;left:66.18px;top:240.98px" class="cls_022"><span class="cls_022">overriding default user queries</span><span class="cls_113"> 90-91</span></div>
<div style="position:absolute;left:276.18px;top:250.67px" class="cls_112"><span class="cls_112">R</span></div>
<div style="position:absolute;left:66.18px;top:260.66px" class="cls_112"><span class="cls_112">P</span></div>
<div style="position:absolute;left:276.18px;top:270.98px" class="cls_022"><span class="cls_022">RabbitMQ</span><span class="cls_113"> 192-202</span></div>
<div style="position:absolute;left:66.18px;top:281.00px" class="cls_022"><span class="cls_022">PaaS (platform-as-a-service)</span><span class="cls_113"> 465</span></div>
<div style="position:absolute;left:285.18px;top:281.00px" class="cls_022"><span class="cls_022">adding to Spring</span><span class="cls_113"> 193-194</span></div>
<div style="position:absolute;left:66.18px;top:290.99px" class="cls_022"><span class="cls_022">packageName parameter</span><span class="cls_113"> 481</span></div>
<div style="position:absolute;left:285.18px;top:290.99px" class="cls_022"><span class="cls_022">receiving message from</span><span class="cls_113"> 198-202</span></div>
<div style="position:absolute;left:66.18px;top:300.98px" class="cls_022"><span class="cls_022">pageSize property</span><span class="cls_113"> 124</span></div>
<div style="position:absolute;left:294.18px;top:300.98px" class="cls_022"><span class="cls_022">handling messages with listeners</span><span class="cls_113"> 201-202</span></div>
<div style="position:absolute;left:66.18px;top:311.00px" class="cls_022"><span class="cls_022">paging</span><span class="cls_113"> 164-165</span></div>
<div style="position:absolute;left:294.18px;top:311.00px" class="cls_022"><span class="cls_022">with RabbitTemplate</span><span class="cls_113"> 198-201</span></div>
<div style="position:absolute;left:66.18px;top:320.99px" class="cls_022"><span class="cls_022">PagingAndSortingRepository</span><span class="cls_113"> 311</span></div>
<div style="position:absolute;left:285.18px;top:320.99px" class="cls_022"><span class="cls_022">sending messages with RabbitTemplate</span></div>
<div style="position:absolute;left:66.18px;top:330.98px" class="cls_022"><span class="cls_022">ParameterizedTypeReference</span><span class="cls_113"> 176, 201</span></div>
<div style="position:absolute;left:303.18px;top:330.98px" class="cls_113"><span class="cls_113">194-198</span></div>
<div style="position:absolute;left:66.18px;top:341.00px" class="cls_022"><span class="cls_022">passwordCompare( ) method</span><span class="cls_113"> 93</span></div>
<div style="position:absolute;left:294.18px;top:341.00px" class="cls_022"><span class="cls_022">configuring message converter</span><span class="cls_113"> 197</span></div>
<div style="position:absolute;left:66.18px;top:350.99px" class="cls_022"><span class="cls_022">passwordEncoder( ) method</span><span class="cls_113"> 91, 94</span></div>
<div style="position:absolute;left:294.18px;top:350.99px" class="cls_022"><span class="cls_022">setting message properties</span><span class="cls_113"> 197-198</span></div>
<div style="position:absolute;left:66.18px;top:360.98px" class="cls_022"><span class="cls_022">passwords</span></div>
<div style="position:absolute;left:276.18px;top:360.98px" class="cls_022"><span class="cls_022">RabbitTemplate beans</span><span class="cls_113"> 193</span></div>
<div style="position:absolute;left:75.18px;top:371.00px" class="cls_022"><span class="cls_022">comparison of, configuring</span><span class="cls_113"> 93-94</span></div>
<div style="position:absolute;left:276.18px;top:371.00px" class="cls_022"><span class="cls_022">range( ) method</span><span class="cls_113"> 251</span></div>
<div style="position:absolute;left:75.18px;top:380.99px" class="cls_022"><span class="cls_022">encoded</span><span class="cls_113"> 91-92</span></div>
<div style="position:absolute;left:276.18px;top:380.99px" class="cls_022"><span class="cls_022">reactive APIs</span><span class="cls_113"> 269-295</span></div>
<div style="position:absolute;left:66.18px;top:390.98px" class="cls_022"><span class="cls_022">patchOrder( ) method</span><span class="cls_113"> 148</span></div>
<div style="position:absolute;left:285.18px;top:390.98px" class="cls_022"><span class="cls_022">consuming REST APIs reactively</span><span class="cls_113"> 285-292</span></div>
<div style="position:absolute;left:66.18px;top:401.00px" class="cls_022"><span class="cls_022">pathMatchers( ) method</span><span class="cls_113"> 294</span></div>
<div style="position:absolute;left:294.18px;top:401.00px" class="cls_022"><span class="cls_022">deleting resources</span><span class="cls_113"> 288-289</span></div>
<div style="position:absolute;left:66.18px;top:410.99px" class="cls_022"><span class="cls_022">@PathVariable annotation</span><span class="cls_113"> 144, 341</span></div>
<div style="position:absolute;left:294.18px;top:410.99px" class="cls_022"><span class="cls_022">exchanging requests</span><span class="cls_113"> 290-292</span></div>
<div style="position:absolute;left:66.18px;top:420.98px" class="cls_022"><span class="cls_022">@Pattern annotation</span><span class="cls_113"> 48</span></div>
<div style="position:absolute;left:294.18px;top:420.98px" class="cls_022"><span class="cls_022">GETting resources</span><span class="cls_113"> 285-287</span></div>
<div style="position:absolute;left:66.18px;top:431.00px" class="cls_022"><span class="cls_022">PayloadTypeRouter</span><span class="cls_113"> 224</span></div>
<div style="position:absolute;left:294.18px;top:431.00px" class="cls_022"><span class="cls_022">handling errors</span><span class="cls_113"> 289-290</span></div>
<div style="position:absolute;left:66.18px;top:440.99px" class="cls_022"><span class="cls_022">permitAll( ) method</span><span class="cls_113"> 104</span></div>
<div style="position:absolute;left:294.18px;top:440.99px" class="cls_022"><span class="cls_022">sending resources</span><span class="cls_113"> 287-288</span></div>
<div style="position:absolute;left:66.18px;top:451.01px" class="cls_022"><span class="cls_022">Pivotal Web Services (PWS)</span><span class="cls_113"> 459</span></div>
<div style="position:absolute;left:285.18px;top:451.01px" class="cls_022"><span class="cls_022">functional request handlers, defining</span><span class="cls_113"> 276-279</span></div>
<div style="position:absolute;left:66.18px;top:461.00px" class="cls_022"><span class="cls_022">placedAt property</span><span class="cls_113"> 73, 122</span></div>
<div style="position:absolute;left:285.18px;top:461.00px" class="cls_022"><span class="cls_022">reactive controllers</span></div>
<div style="position:absolute;left:66.18px;top:470.99px" class="cls_022"><span class="cls_022">platform-as-a-service (PaaS)</span><span class="cls_113"> 465</span></div>
<div style="position:absolute;left:294.18px;top:470.99px" class="cls_022"><span class="cls_022">testing</span><span class="cls_113"> 279-285</span></div>
<div style="position:absolute;left:66.18px;top:481.01px" class="cls_022"><span class="cls_022">poChannel</span><span class="cls_113"> 224</span></div>
<div style="position:absolute;left:294.18px;top:481.01px" class="cls_022"><span class="cls_022">writing</span><span class="cls_113"> 272-276</span></div>
<div style="position:absolute;left:66.18px;top:491.00px" class="cls_022"><span class="cls_022">POST requests, testing</span><span class="cls_113"> 282-283</span></div>
<div style="position:absolute;left:285.18px;top:491.00px" class="cls_022"><span class="cls_022">securing reactive web APIs</span><span class="cls_113"> 292-295</span></div>
<div style="position:absolute;left:66.18px;top:500.99px" class="cls_022"><span class="cls_022">postForEntity( ) method</span><span class="cls_113"> 174</span></div>
<div style="position:absolute;left:294.18px;top:500.99px" class="cls_022"><span class="cls_022">configuring reactive user details service</span></div>
<div style="position:absolute;left:66.18px;top:511.01px" class="cls_022"><span class="cls_022">postForLocation( ) method</span><span class="cls_113"> 174-175</span></div>
<div style="position:absolute;left:309.18px;top:511.01px" class="cls_113"><span class="cls_113">294-295</span></div>
<div style="position:absolute;left:66.18px;top:521.00px" class="cls_022"><span class="cls_022">postForObject( ) method</span><span class="cls_113"> 174-175</span></div>
<div style="position:absolute;left:294.18px;top:521.00px" class="cls_022"><span class="cls_022">configuring reactive web security</span><span class="cls_113"> 292-294</span></div>
<div style="position:absolute;left:66.18px;top:530.99px" class="cls_022"><span class="cls_022">@PostMapping annotation</span><span class="cls_113"> 35, 139</span></div>
<div style="position:absolute;left:285.18px;top:530.99px" class="cls_022"><span class="cls_022">Spring WebFlux</span><span class="cls_113"> 269-276</span></div>
<div style="position:absolute;left:66.18px;top:541.01px" class="cls_022"><span class="cls_022">PreparedStatementCreator( ) method</span></div>
<div style="position:absolute;left:219.87px;top:541.01px" class="cls_113"><span class="cls_113">69</span></div>
<div style="position:absolute;left:276.18px;top:541.01px" class="cls_022"><span class="cls_022">reactive code</span><span class="cls_113"> 242</span></div>
<div style="position:absolute;left:66.18px;top:551.00px" class="cls_022"><span class="cls_022">@PrePersist annotation</span><span class="cls_113"> 78</span></div>
<div style="position:absolute;left:276.18px;top:551.00px" class="cls_022"><span class="cls_022">reactive programming</span></div>
<div style="position:absolute;left:66.18px;top:560.99px" class="cls_022"><span class="cls_022">PriorityChannel</span><span class="cls_113"> 218</span></div>
<div style="position:absolute;left:285.18px;top:560.99px" class="cls_022"><span class="cls_022">defining Reactive Streams</span><span class="cls_113"> 243-245</span></div>
<div style="position:absolute;left:66.18px;top:571.01px" class="cls_022"><span class="cls_022">processDesign( ) method</span><span class="cls_113"> 40, 46, 70</span></div>
<div style="position:absolute;left:285.18px;top:571.00px" class="cls_022"><span class="cls_022">overview</span><span class="cls_113"> 242-245</span></div>
<div style="position:absolute;left:66.18px;top:581.00px" class="cls_022"><span class="cls_022">processOrder( ) method</span><span class="cls_113"> 46</span></div>
<div style="position:absolute;left:285.18px;top:581.00px" class="cls_114"><span class="cls_114">See also</span><span class="cls_022"> Reactor</span></div>
<div style="position:absolute;left:66.18px;top:590.99px" class="cls_022"><span class="cls_022">processRegistration( ) method</span><span class="cls_113"> 102</span></div>
<div style="position:absolute;left:276.18px;top:590.99px" class="cls_022"><span class="cls_022">reactive repositories. </span><span class="cls_114">See</span><span class="cls_022"> Spring Data</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:341376px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background516.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_024"><span class="cls_024">494</span></div>
<div style="position:absolute;left:252.09px;top:26.96px" class="cls_109"><span class="cls_109">INDEX</span></div>
<div style="position:absolute;left:57.18px;top:50.99px" class="cls_022"><span class="cls_022">ReactiveCassandraRepository interface</span><span class="cls_113"> 309</span></div>
<div style="position:absolute;left:267.18px;top:50.99px" class="cls_022"><span class="cls_022">REST services</span><span class="cls_113"> 137-168</span></div>
<div style="position:absolute;left:57.18px;top:60.98px" class="cls_022"><span class="cls_022">ReactiveCrudRepository interface</span><span class="cls_113"> 309, 318</span></div>
<div style="position:absolute;left:276.18px;top:60.98px" class="cls_022"><span class="cls_022">consuming</span><span class="cls_113"> 169-177</span></div>
<div style="position:absolute;left:57.18px;top:70.97px" class="cls_022"><span class="cls_022">ReactiveMongoRepository</span><span class="cls_113"> 318</span></div>
<div style="position:absolute;left:285.18px;top:70.97px" class="cls_022"><span class="cls_022">navigating REST APIs with Traverson</span></div>
<div style="position:absolute;left:57.18px;top:80.99px" class="cls_022"><span class="cls_022">ReactiveUserDetailsService</span><span class="cls_113"> 295</span></div>
<div style="position:absolute;left:300.18px;top:80.99px" class="cls_113"><span class="cls_113">175-177</span></div>
<div style="position:absolute;left:57.18px;top:90.98px" class="cls_022"><span class="cls_022">Reactor</span><span class="cls_113"> 241-268</span></div>
<div style="position:absolute;left:285.18px;top:90.98px" class="cls_022"><span class="cls_022">REST APIs, reactively</span><span class="cls_113"> 285-292</span></div>
<div style="position:absolute;left:66.18px;top:100.97px" class="cls_022"><span class="cls_022">getting started with</span><span class="cls_113"> 245-248</span></div>
<div style="position:absolute;left:285.18px;top:100.97px" class="cls_022"><span class="cls_022">REST endpoints with RestTemplate</span></div>
<div style="position:absolute;left:75.18px;top:110.99px" class="cls_022"><span class="cls_022">adding dependencies</span><span class="cls_113"> 247-248</span></div>
<div style="position:absolute;left:300.18px;top:110.99px" class="cls_113"><span class="cls_113">175-177</span></div>
<div style="position:absolute;left:75.18px;top:120.98px" class="cls_022"><span class="cls_022">diagramming reactive flows</span><span class="cls_113"> 246</span></div>
<div style="position:absolute;left:276.18px;top:120.98px" class="cls_022"><span class="cls_022">data-backed services, enabling</span><span class="cls_113"> 160-168</span></div>
<div style="position:absolute;left:66.18px;top:130.97px" class="cls_022"><span class="cls_022">reactive streams, transforming and</span></div>
<div style="position:absolute;left:285.18px;top:130.97px" class="cls_022"><span class="cls_022">adding custom endpoints</span><span class="cls_113"> 165-167</span></div>
<div style="position:absolute;left:84.18px;top:140.99px" class="cls_022"><span class="cls_022">filtering</span></div>
<div style="position:absolute;left:120.12px;top:140.99px" class="cls_113"><span class="cls_113">257-266</span></div>
<div style="position:absolute;left:285.18px;top:140.98px" class="cls_022"><span class="cls_022">adding custom hyperlinks to Spring Data</span></div>
<div style="position:absolute;left:75.18px;top:150.98px" class="cls_022"><span class="cls_022">buffering data</span><span class="cls_113"> 263-266</span></div>
<div style="position:absolute;left:300.18px;top:150.97px" class="cls_022"><span class="cls_022">endpoints</span><span class="cls_113"> 167-168</span></div>
<div style="position:absolute;left:75.18px;top:160.97px" class="cls_022"><span class="cls_022">filtering data from reactive types</span><span class="cls_113"> 257-260</span></div>
<div style="position:absolute;left:285.18px;top:160.96px" class="cls_022"><span class="cls_022">adjusting resource paths and relation</span></div>
<div style="position:absolute;left:75.18px;top:170.99px" class="cls_022"><span class="cls_022">mapping reactive data</span><span class="cls_113"> 260-263</span></div>
<div style="position:absolute;left:300.18px;top:170.98px" class="cls_022"><span class="cls_022">names</span><span class="cls_113"> 162-164</span></div>
<div style="position:absolute;left:66.18px;top:180.98px" class="cls_022"><span class="cls_022">reactive types</span></div>
<div style="position:absolute;left:285.18px;top:180.97px" class="cls_022"><span class="cls_022">paging and sorting</span><span class="cls_113"> 164-165</span></div>
<div style="position:absolute;left:75.18px;top:190.97px" class="cls_022"><span class="cls_022">combining</span><span class="cls_113"> 253-256</span></div>
<div style="position:absolute;left:276.18px;top:190.97px" class="cls_022"><span class="cls_022">hypermedia, enabling</span><span class="cls_113"> 149-160</span></div>
<div style="position:absolute;left:75.18px;top:200.99px" class="cls_022"><span class="cls_022">performing logic operations on</span><span class="cls_113"> 266-268</span></div>
<div style="position:absolute;left:285.18px;top:200.99px" class="cls_022"><span class="cls_022">adding hyperlinks</span><span class="cls_113"> 152-154</span></div>
<div style="position:absolute;left:57.18px;top:210.98px" class="cls_022"><span class="cls_022">reading and writing data, with JDBC</span><span class="cls_113"> 57-75</span></div>
<div style="position:absolute;left:285.18px;top:210.98px" class="cls_022"><span class="cls_022">creating resource assemblers</span><span class="cls_113"> 154-158</span></div>
<div style="position:absolute;left:66.18px;top:221.00px" class="cls_022"><span class="cls_022">adapting domain for persistence</span><span class="cls_113"> 59</span></div>
<div style="position:absolute;left:285.18px;top:221.00px" class="cls_022"><span class="cls_022">naming embedded relationships</span><span class="cls_113"> 159-160</span></div>
<div style="position:absolute;left:66.18px;top:230.99px" class="cls_022"><span class="cls_022">defining schema and preloading data</span><span class="cls_113"> 64-66</span></div>
<div style="position:absolute;left:276.18px;top:230.99px" class="cls_022"><span class="cls_022">RESTful controllers, writing</span><span class="cls_113"> 138-149</span></div>
<div style="position:absolute;left:66.18px;top:240.98px" class="cls_022"><span class="cls_022">inserting data</span><span class="cls_113"> 66-75</span></div>
<div style="position:absolute;left:285.18px;top:240.98px" class="cls_022"><span class="cls_022">deleting data from server</span><span class="cls_113"> 148-149</span></div>
<div style="position:absolute;left:75.18px;top:251.00px" class="cls_022"><span class="cls_022">inserting data with SimpleJdbcTemplate</span></div>
<div style="position:absolute;left:285.18px;top:251.00px" class="cls_022"><span class="cls_022">retrieving data from server</span><span class="cls_113"> 140-144</span></div>
<div style="position:absolute;left:90.18px;top:260.99px" class="cls_113"><span class="cls_113">71-75</span></div>
<div style="position:absolute;left:285.18px;top:260.99px" class="cls_022"><span class="cls_022">sending data to server</span><span class="cls_113"> 145-146</span></div>
<div style="position:absolute;left:75.18px;top:270.98px" class="cls_022"><span class="cls_022">saving data with JdbcTemplate</span><span class="cls_113"> 67-71</span></div>
<div style="position:absolute;left:285.18px;top:270.98px" class="cls_022"><span class="cls_022">updating data on server</span><span class="cls_113"> 146-148</span></div>
<div style="position:absolute;left:66.18px;top:281.00px" class="cls_022"><span class="cls_022">working with JdbcTemplate</span><span class="cls_113"> 60-64</span></div>
<div style="position:absolute;left:267.18px;top:281.00px" class="cls_022"><span class="cls_022">restart, automatic</span><span class="cls_113"> 23-24</span></div>
<div style="position:absolute;left:75.18px;top:290.99px" class="cls_022"><span class="cls_022">defining JDBC repositories</span><span class="cls_113"> 60-62</span></div>
<div style="position:absolute;left:267.18px;top:290.99px" class="cls_022"><span class="cls_022">RestClientException</span><span class="cls_113"> 380</span></div>
<div style="position:absolute;left:75.18px;top:300.98px" class="cls_022"><span class="cls_022">inserting row</span><span class="cls_113"> 62-64</span></div>
<div style="position:absolute;left:267.18px;top:300.98px" class="cls_022"><span class="cls_022">@RestController annotation</span><span class="cls_113"> 142, 160</span></div>
<div style="position:absolute;left:57.18px;top:311.00px" class="cls_022"><span class="cls_022">receive( ) method</span><span class="cls_113"> 190, 199</span></div>
<div style="position:absolute;left:267.18px;top:311.00px" class="cls_022"><span class="cls_022">@RestResource annotation</span><span class="cls_113"> 164</span></div>
<div style="position:absolute;left:57.18px;top:320.99px" class="cls_022"><span class="cls_022">receiveAndConvert( ) method</span><span class="cls_113"> 190, 199</span></div>
<div style="position:absolute;left:267.18px;top:320.99px" class="cls_022"><span class="cls_022">RestTemplate</span></div>
<div style="position:absolute;left:57.18px;top:330.98px" class="cls_022"><span class="cls_022">recents links</span><span class="cls_113"> 151</span></div>
<div style="position:absolute;left:276.18px;top:330.98px" class="cls_022"><span class="cls_022">consuming REST endpoints with</span><span class="cls_113"> 175-177</span></div>
<div style="position:absolute;left:57.18px;top:341.00px" class="cls_022"><span class="cls_022">registerForm( ) method</span><span class="cls_113"> 101</span></div>
<div style="position:absolute;left:285.18px;top:341.00px" class="cls_022"><span class="cls_022">delete( ) method</span><span class="cls_113"> 174</span></div>
<div style="position:absolute;left:57.18px;top:350.99px" class="cls_022"><span class="cls_022">registering</span></div>
<div style="position:absolute;left:285.18px;top:350.99px" class="cls_022"><span class="cls_022">getForObject( ) and getForEntity( )</span></div>
<div style="position:absolute;left:66.18px;top:360.98px" class="cls_022"><span class="cls_022">clients, Admin</span><span class="cls_113"> 431-435</span></div>
<div style="position:absolute;left:300.18px;top:360.98px" class="cls_022"><span class="cls_022">methods</span><span class="cls_113"> 172-173</span></div>
<div style="position:absolute;left:75.18px;top:371.00px" class="cls_022"><span class="cls_022">discovering Admin client applications</span></div>
<div style="position:absolute;left:285.18px;top:371.00px" class="cls_022"><span class="cls_022">postForObject( ) and postForLocation( )</span></div>
<div style="position:absolute;left:90.18px;top:380.99px" class="cls_113"><span class="cls_113">433-435</span></div>
<div style="position:absolute;left:300.18px;top:380.99px" class="cls_022"><span class="cls_022">methods</span><span class="cls_113"> 174-175</span></div>
<div style="position:absolute;left:75.18px;top:390.98px" class="cls_022"><span class="cls_022">explicitly configuring Admin client</span></div>
<div style="position:absolute;left:285.18px;top:390.98px" class="cls_022"><span class="cls_022">put( ) method</span><span class="cls_113"> 173</span></div>
<div style="position:absolute;left:90.18px;top:401.00px" class="cls_022"><span class="cls_022">applications</span><span class="cls_113"> 432-433</span></div>
<div style="position:absolute;left:276.18px;top:401.00px" class="cls_022"><span class="cls_022">consuming services with</span><span class="cls_113"> 337-339</span></div>
<div style="position:absolute;left:66.18px;top:410.99px" class="cls_022"><span class="cls_022">users</span><span class="cls_113"> 100-103</span></div>
<div style="position:absolute;left:267.18px;top:410.99px" class="cls_022"><span class="cls_022">retrieve( ) method</span><span class="cls_113"> 290</span></div>
<div style="position:absolute;left:57.18px;top:420.98px" class="cls_022"><span class="cls_022">RegistrationController class</span><span class="cls_113"> 100</span></div>
<div style="position:absolute;left:267.18px;top:420.98px" class="cls_022"><span class="cls_022">romanNumberChannel</span><span class="cls_113"> 220</span></div>
<div style="position:absolute;left:57.18px;top:431.00px" class="cls_022"><span class="cls_022">relation names, adjusting</span><span class="cls_113"> 162-164</span></div>
<div style="position:absolute;left:267.18px;top:431.00px" class="cls_022"><span class="cls_022">routerFunction( ) method</span><span class="cls_113"> 278-279</span></div>
<div style="position:absolute;left:57.18px;top:440.99px" class="cls_022"><span class="cls_022">release train</span><span class="cls_113"> 297</span></div>
<div style="position:absolute;left:267.18px;top:440.99px" class="cls_022"><span class="cls_022">routers</span><span class="cls_113"> 221-223</span></div>
<div style="position:absolute;left:57.18px;top:451.01px" class="cls_022"><span class="cls_022">remote LDAP server, referring to</span><span class="cls_113"> 94</span></div>
<div style="position:absolute;left:267.18px;top:451.01px" class="cls_022"><span class="cls_022">run( ) method</span><span class="cls_113"> 16</span></div>
<div style="position:absolute;left:57.18px;top:461.00px" class="cls_022"><span class="cls_022">RendezvousChannel</span><span class="cls_113"> 218</span></div>
<div style="position:absolute;left:267.18px;top:461.00px" class="cls_022"><span class="cls_022">@RunWith annotation</span><span class="cls_113"> 16, 284</span></div>
<div style="position:absolute;left:57.18px;top:470.99px" class="cls_022"><span class="cls_022">replacement operation</span><span class="cls_113"> 146</span></div>
<div style="position:absolute;left:267.18px;top:470.99px" class="cls_022"><span class="cls_022">RXJava types</span><span class="cls_113"> 275</span></div>
<div style="position:absolute;left:57.18px;top:481.01px" class="cls_022"><span class="cls_022">@Repository annotation</span><span class="cls_113"> 61</span></div>
<div style="position:absolute;left:57.18px;top:491.00px" class="cls_022"><span class="cls_022">@RepositoryRestController annotation</span><span class="cls_113"> 166-167</span></div>
<div style="position:absolute;left:267.18px;top:490.67px" class="cls_112"><span class="cls_112">S</span></div>
<div style="position:absolute;left:57.18px;top:500.99px" class="cls_022"><span class="cls_022">@RequestBody annotation</span><span class="cls_113"> 146</span></div>
<div style="position:absolute;left:57.18px;top:511.01px" class="cls_022"><span class="cls_022">@RequestMapping annotation</span><span class="cls_113"> 34-35, 143</span></div>
<div style="position:absolute;left:267.18px;top:511.01px" class="cls_022"><span class="cls_022">save( ) method</span><span class="cls_113"> 67</span></div>
<div style="position:absolute;left:57.18px;top:521.00px" class="cls_022"><span class="cls_022">RequestPredicate</span><span class="cls_113"> 278</span></div>
<div style="position:absolute;left:267.18px;top:521.00px" class="cls_022"><span class="cls_022">saveAll( ) method</span><span class="cls_113"> 276, 298</span></div>
<div style="position:absolute;left:57.18px;top:530.99px" class="cls_022"><span class="cls_022">@RequiredArgsConstructor annotation</span><span class="cls_113"> 77</span></div>
<div style="position:absolute;left:267.18px;top:530.99px" class="cls_022"><span class="cls_022">scanning</span><span class="cls_113"> 6, 15</span></div>
<div style="position:absolute;left:57.18px;top:541.01px" class="cls_022"><span class="cls_022">resource assemblers, creating</span><span class="cls_113"> 154-158</span></div>
<div style="position:absolute;left:267.18px;top:541.01px" class="cls_022"><span class="cls_022">SDKMAN</span><span class="cls_113"> 483</span></div>
<div style="position:absolute;left:57.18px;top:551.00px" class="cls_022"><span class="cls_022">resource paths, adjusting</span><span class="cls_113"> 162-164</span></div>
<div style="position:absolute;left:267.18px;top:551.00px" class="cls_022"><span class="cls_022">securing reactive web APIs</span><span class="cls_113"> 292-295</span></div>
<div style="position:absolute;left:57.18px;top:560.99px" class="cls_022"><span class="cls_022">ResourceProcessor</span><span class="cls_113"> 168</span></div>
<div style="position:absolute;left:276.18px;top:560.99px" class="cls_022"><span class="cls_022">configuring reactive user details service</span></div>
<div style="position:absolute;left:57.18px;top:571.01px" class="cls_022"><span class="cls_022">ResourceSupport</span><span class="cls_113"> 155</span></div>
<div style="position:absolute;left:294.18px;top:571.01px" class="cls_113"><span class="cls_113">294-295</span></div>
<div style="position:absolute;left:57.18px;top:581.00px" class="cls_022"><span class="cls_022">@ResponseStatus annotation</span><span class="cls_113"> 149</span></div>
<div style="position:absolute;left:276.18px;top:581.00px" class="cls_022"><span class="cls_022">configuring reactive web security</span><span class="cls_113"> 292-294</span></div>
<div style="position:absolute;left:57.18px;top:590.99px" class="cls_022"><span class="cls_022">ResponseStatusException</span><span class="cls_113"> 416</span></div>
<div style="position:absolute;left:267.18px;top:590.99px" class="cls_022"><span class="cls_022">security. </span><span class="cls_114">See</span><span class="cls_022"> Spring Security</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:342052px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background517.jpg" width="531" height="666"></div>
<div style="position:absolute;left:261.09px;top:26.96px" class="cls_109"><span class="cls_109">INDEX</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_024"><span class="cls_024">495</span></div>
<div style="position:absolute;left:66.18px;top:50.99px" class="cls_022"><span class="cls_022">SecurityConfig class</span><span class="cls_113"> 88</span></div>
<div style="position:absolute;left:285.18px;top:50.99px" class="cls_022"><span class="cls_022">testing</span><span class="cls_113"> 16-17</span></div>
<div style="position:absolute;left:66.18px;top:60.98px" class="cls_022"><span class="cls_022">SecurityContextHolder</span><span class="cls_113"> 111</span></div>
<div style="position:absolute;left:285.18px;top:60.98px" class="cls_022"><span class="cls_022">writing</span><span class="cls_113"> 17-26</span></div>
<div style="position:absolute;left:66.18px;top:70.97px" class="cls_022"><span class="cls_022">security.user.name property</span><span class="cls_113"> 117</span></div>
<div style="position:absolute;left:294.18px;top:70.97px" class="cls_022"><span class="cls_022">building and running application</span><span class="cls_113"> 21-23</span></div>
<div style="position:absolute;left:66.18px;top:80.99px" class="cls_022"><span class="cls_022">security.user.password property</span><span class="cls_113"> 117, 127</span></div>
<div style="position:absolute;left:294.18px;top:80.99px" class="cls_022"><span class="cls_022">defining view</span><span class="cls_113"> 19</span></div>
<div style="position:absolute;left:66.18px;top:90.98px" class="cls_022"><span class="cls_022">securityWebFilterChain( ) method</span><span class="cls_113"> 293</span></div>
<div style="position:absolute;left:294.18px;top:90.98px" class="cls_022"><span class="cls_022">handling web requests</span><span class="cls_113"> 17-19</span></div>
<div style="position:absolute;left:66.18px;top:100.97px" class="cls_022"><span class="cls_022">self links</span></div>
<div style="position:absolute;left:104.46px;top:100.97px" class="cls_113"><span class="cls_113">151</span></div>
<div style="position:absolute;left:294.18px;top:100.97px" class="cls_022"><span class="cls_022">Spring Boot DevTools use</span><span class="cls_113"> 23-25</span></div>
<div style="position:absolute;left:66.18px;top:110.99px" class="cls_022"><span class="cls_022">send( ) method</span><span class="cls_113"> 182, 195</span></div>
<div style="position:absolute;left:294.18px;top:110.99px" class="cls_022"><span class="cls_022">testing controller</span><span class="cls_113"> 20-21</span></div>
<div style="position:absolute;left:66.18px;top:120.98px" class="cls_022"><span class="cls_022">sendDefault( ) method</span><span class="cls_113"> 205</span></div>
<div style="position:absolute;left:285.17px;top:120.98px" class="cls_114"><span class="cls_114">See also</span><span class="cls_022"> bootstrapping applications</span></div>
<div style="position:absolute;left:66.18px;top:130.97px" class="cls_022"><span class="cls_022">sendNotification( ) method</span><span class="cls_113"> 451</span></div>
<div style="position:absolute;left:276.18px;top:130.97px" class="cls_022"><span class="cls_022">Spring Batch</span><span class="cls_113"> 27-28</span></div>
<div style="position:absolute;left:66.18px;top:140.99px" class="cls_022"><span class="cls_022">SerializerMessageConverter</span><span class="cls_113"> 197</span></div>
<div style="position:absolute;left:276.17px;top:140.99px" class="cls_022"><span class="cls_022">Spring Boot</span></div>
<div style="position:absolute;left:66.18px;top:150.98px" class="cls_022"><span class="cls_022">server, Admin</span><span class="cls_113"> 435-442</span></div>
<div style="position:absolute;left:285.17px;top:150.98px" class="cls_022"><span class="cls_022">overview of</span><span class="cls_113"> 26-27</span></div>
<div style="position:absolute;left:75.18px;top:160.97px" class="cls_022"><span class="cls_022">creating</span><span class="cls_113"> 430-431</span></div>
<div style="position:absolute;left:285.17px;top:160.97px" class="cls_022"><span class="cls_022">running in Docker container</span><span class="cls_113"> 461-464</span></div>
<div style="position:absolute;left:75.18px;top:170.99px" class="cls_022"><span class="cls_022">examining environment properties</span><span class="cls_113"> 438</span></div>
<div style="position:absolute;left:276.17px;top:170.99px" class="cls_022"><span class="cls_022">Spring Boot Actuator</span><span class="cls_113"> 395-428</span></div>
<div style="position:absolute;left:75.18px;top:180.98px" class="cls_022"><span class="cls_022">monitoring threads</span><span class="cls_113"> 440</span></div>
<div style="position:absolute;left:285.17px;top:180.98px" class="cls_022"><span class="cls_022">base path, configuring</span><span class="cls_113"> 397</span></div>
<div style="position:absolute;left:75.18px;top:190.97px" class="cls_022"><span class="cls_022">securing</span><span class="cls_113"> 442-445</span></div>
<div style="position:absolute;left:285.17px;top:190.97px" class="cls_022"><span class="cls_022">customizing</span><span class="cls_113"> 416-426</span></div>
<div style="position:absolute;left:84.18px;top:200.99px" class="cls_022"><span class="cls_022">authenticating with Actuator</span><span class="cls_113"> 444-445</span></div>
<div style="position:absolute;left:294.18px;top:200.99px" class="cls_022"><span class="cls_022">contributing information to /info</span></div>
<div style="position:absolute;left:84.18px;top:210.98px" class="cls_022"><span class="cls_022">enabling login</span><span class="cls_113"> 443-444</span></div>
<div style="position:absolute;left:309.18px;top:210.98px" class="cls_022"><span class="cls_022">endpoint</span><span class="cls_113"> 416-420</span></div>
<div style="position:absolute;left:75.18px;top:221.00px" class="cls_022"><span class="cls_022">tracing HTTP requests</span><span class="cls_113"> 441-442</span></div>
<div style="position:absolute;left:294.18px;top:221.00px" class="cls_022"><span class="cls_022">creating custom endpoints</span><span class="cls_113"> 424-426</span></div>
<div style="position:absolute;left:75.18px;top:230.99px" class="cls_022"><span class="cls_022">viewing and setting logging levels</span><span class="cls_113"> 439</span></div>
<div style="position:absolute;left:294.18px;top:230.99px" class="cls_022"><span class="cls_022">defining custom health indicators</span><span class="cls_113"> 421-422</span></div>
<div style="position:absolute;left:75.18px;top:240.98px" class="cls_022"><span class="cls_022">viewing general application health and</span></div>
<div style="position:absolute;left:294.18px;top:240.98px" class="cls_022"><span class="cls_022">registering custom metrics</span><span class="cls_113"> 422-424</span></div>
<div style="position:absolute;left:93.18px;top:251.00px" class="cls_022"><span class="cls_022">information</span><span class="cls_113"> 436-437</span></div>
<div style="position:absolute;left:285.18px;top:251.00px" class="cls_022"><span class="cls_022">endpoints, consuming</span><span class="cls_113"> 399-416</span></div>
<div style="position:absolute;left:75.18px;top:260.99px" class="cls_022"><span class="cls_022">watching key metrics</span><span class="cls_113"> 437-438</span></div>
<div style="position:absolute;left:294.18px;top:260.99px" class="cls_022"><span class="cls_022">fetching essential application</span></div>
<div style="position:absolute;left:66.18px;top:270.98px" class="cls_022"><span class="cls_022">ServerHttpSecurity object</span><span class="cls_113"> 293</span></div>
<div style="position:absolute;left:309.18px;top:270.98px" class="cls_022"><span class="cls_022">information</span><span class="cls_113"> 400-411</span></div>
<div style="position:absolute;left:66.18px;top:281.00px" class="cls_022"><span class="cls_022">server.port property</span><span class="cls_113"> 119, 355, 385</span></div>
<div style="position:absolute;left:294.18px;top:281.00px" class="cls_022"><span class="cls_022">tapping runtime metrics</span><span class="cls_113"> 413-416</span></div>
<div style="position:absolute;left:66.18px;top:290.99px" class="cls_022"><span class="cls_022">server.ssl.key-store property</span><span class="cls_113"> 119</span></div>
<div style="position:absolute;left:294.18px;top:290.99px" class="cls_022"><span class="cls_022">viewing application activity</span><span class="cls_113"> 411-413</span></div>
<div style="position:absolute;left:66.18px;top:300.98px" class="cls_022"><span class="cls_022">service activators</span><span class="cls_113"> 225-227</span></div>
<div style="position:absolute;left:285.18px;top:300.98px" class="cls_022"><span class="cls_022">endpoints, enabling and disabling</span><span class="cls_113"> 398</span></div>
<div style="position:absolute;left:66.18px;top:311.00px" class="cls_022"><span class="cls_022">@ServiceActivator annotation</span><span class="cls_113"> 214, 226</span></div>
<div style="position:absolute;left:285.18px;top:311.00px" class="cls_022"><span class="cls_022">MBeans</span><span class="cls_113"> 446-449</span></div>
<div style="position:absolute;left:66.18px;top:320.99px" class="cls_022"><span class="cls_022">@SessionAttributes annotation</span><span class="cls_113"> 70</span></div>
<div style="position:absolute;left:285.18px;top:320.99px" class="cls_022"><span class="cls_022">overview</span><span class="cls_113"> 396-397</span></div>
<div style="position:absolute;left:66.18px;top:330.98px" class="cls_022"><span class="cls_022">SessionStatus parameter</span><span class="cls_113"> 75</span></div>
<div style="position:absolute;left:285.18px;top:330.98px" class="cls_022"><span class="cls_022">securing</span><span class="cls_113"> 426-428</span></div>
<div style="position:absolute;left:66.18px;top:341.00px" class="cls_022"><span class="cls_022">setExpectReply( ) method</span><span class="cls_113"> 214</span></div>
<div style="position:absolute;left:276.18px;top:341.00px" class="cls_022"><span class="cls_022">Spring Boot Admin</span><span class="cls_113"> 429-445</span></div>
<div style="position:absolute;left:66.18px;top:350.99px" class="cls_022"><span class="cls_022">setHeader( ) method</span><span class="cls_113"> 198</span></div>
<div style="position:absolute;left:285.18px;top:350.99px" class="cls_022"><span class="cls_022">clients, registering</span><span class="cls_113"> 431-435</span></div>
<div style="position:absolute;left:66.18px;top:360.98px" class="cls_022"><span class="cls_022">setNotificationPublisher( ) method</span><span class="cls_113"> 451</span></div>
<div style="position:absolute;left:285.18px;top:360.98px" class="cls_022"><span class="cls_022">overview</span><span class="cls_113"> 430</span></div>
<div style="position:absolute;left:66.18px;top:370.99px" class="cls_022"><span class="cls_022">setStringProperty( ) method</span><span class="cls_113"> 187</span></div>
<div style="position:absolute;left:285.18px;top:371.00px" class="cls_022"><span class="cls_022">server</span><span class="cls_113"> 435-442</span></div>
<div style="position:absolute;left:66.18px;top:380.98px" class="cls_022"><span class="cls_022">setTypeIdMappings( ) method</span><span class="cls_113"> 186</span></div>
<div style="position:absolute;left:294.18px;top:380.99px" class="cls_022"><span class="cls_022">creating</span><span class="cls_113"> 430-431</span></div>
<div style="position:absolute;left:66.18px;top:390.97px" class="cls_022"><span class="cls_022">setTypeIdPropertyName( ) method</span><span class="cls_113"> 186</span></div>
<div style="position:absolute;left:294.18px;top:390.98px" class="cls_022"><span class="cls_022">examining environment properties</span><span class="cls_113"> 438</span></div>
<div style="position:absolute;left:66.18px;top:400.99px" class="cls_022"><span class="cls_022">setViewName( ) method</span><span class="cls_113"> 52</span></div>
<div style="position:absolute;left:294.18px;top:401.00px" class="cls_022"><span class="cls_022">monitoring threads</span><span class="cls_113"> 440</span></div>
<div style="position:absolute;left:66.18px;top:410.98px" class="cls_022"><span class="cls_022">showDesignForm( ) method</span><span class="cls_113"> 34-35</span></div>
<div style="position:absolute;left:294.18px;top:410.99px" class="cls_022"><span class="cls_022">securing</span><span class="cls_113"> 442-445</span></div>
<div style="position:absolute;left:66.18px;top:420.98px" class="cls_022"><span class="cls_022">SimpleJdbcInsert class</span><span class="cls_113"> 66</span></div>
<div style="position:absolute;left:294.18px;top:420.98px" class="cls_022"><span class="cls_022">tracing HTTP requests</span><span class="cls_113"> 441-442</span></div>
<div style="position:absolute;left:66.18px;top:431.00px" class="cls_022"><span class="cls_022">SimpleJdbcTemplate</span><span class="cls_113"> 71-75</span></div>
<div style="position:absolute;left:294.18px;top:431.00px" class="cls_022"><span class="cls_022">viewing and setting logging levels</span><span class="cls_113"> 439</span></div>
<div style="position:absolute;left:66.18px;top:440.99px" class="cls_022"><span class="cls_022">SimpleMessageConverter</span><span class="cls_113"> 186, 197</span></div>
<div style="position:absolute;left:294.18px;top:440.99px" class="cls_022"><span class="cls_022">viewing general application health and</span></div>
<div style="position:absolute;left:66.18px;top:451.01px" class="cls_022"><span class="cls_022">single-page application (SPA)</span><span class="cls_113"> 139</span></div>
<div style="position:absolute;left:309.18px;top:451.01px" class="cls_022"><span class="cls_022">information</span><span class="cls_113"> 436-437</span></div>
<div style="position:absolute;left:66.18px;top:461.00px" class="cls_022"><span class="cls_022">@Size annotation</span><span class="cls_113"> 46</span></div>
<div style="position:absolute;left:294.17px;top:461.00px" class="cls_022"><span class="cls_022">watching key metrics</span><span class="cls_113"> 437-438</span></div>
<div style="position:absolute;left:66.18px;top:470.99px" class="cls_022"><span class="cls_022">skip( ) method</span><span class="cls_113"> 257</span></div>
<div style="position:absolute;left:276.17px;top:470.99px" class="cls_022"><span class="cls_022">Spring Boot DevTools</span><span class="cls_113"> 23-25</span></div>
<div style="position:absolute;left:66.18px;top:481.01px" class="cls_022"><span class="cls_022">slash( ) method</span><span class="cls_113"> 153</span></div>
<div style="position:absolute;left:285.17px;top:481.01px" class="cls_022"><span class="cls_022">automatic application restart</span><span class="cls_113"> 23-24</span></div>
<div style="position:absolute;left:66.18px;top:491.00px" class="cls_022"><span class="cls_022">@Slf4j annotation</span><span class="cls_113"> 34</span></div>
<div style="position:absolute;left:285.17px;top:491.00px" class="cls_022"><span class="cls_022">automatic browser refresh</span><span class="cls_113"> 24</span></div>
<div style="position:absolute;left:66.18px;top:500.99px" class="cls_022"><span class="cls_022">sorting</span><span class="cls_113"> 164-165</span></div>
<div style="position:absolute;left:285.17px;top:500.99px" class="cls_022"><span class="cls_022">built in H2 console</span><span class="cls_113"> 25</span></div>
<div style="position:absolute;left:66.18px;top:511.01px" class="cls_022"><span class="cls_022">sources( ) method</span><span class="cls_113"> 457</span></div>
<div style="position:absolute;left:285.18px;top:511.01px" class="cls_022"><span class="cls_022">template cache disable</span><span class="cls_113"> 24</span></div>
<div style="position:absolute;left:66.18px;top:521.00px" class="cls_022"><span class="cls_022">SPA (single-page application)</span><span class="cls_113"> 139</span></div>
<div style="position:absolute;left:276.18px;top:521.00px" class="cls_022"><span class="cls_022">Spring Cloud</span><span class="cls_113"> 28</span></div>
<div style="position:absolute;left:66.18px;top:530.99px" class="cls_022"><span class="cls_022">special property values</span><span class="cls_113"> 121</span></div>
<div style="position:absolute;left:276.18px;top:530.99px" class="cls_022"><span class="cls_022">Spring Data</span><span class="cls_113"> 27, 296-320</span></div>
<div style="position:absolute;left:66.18px;top:541.01px" class="cls_022"><span class="cls_022">SpEL (Spring Expression Language)</span><span class="cls_113"> 212</span></div>
<div style="position:absolute;left:285.18px;top:541.01px" class="cls_022"><span class="cls_022">converting between reactive and nonreactive</span></div>
<div style="position:absolute;left:66.18px;top:551.00px" class="cls_022"><span class="cls_022">splitOrderChannel</span><span class="cls_113"> 224</span></div>
<div style="position:absolute;left:303.18px;top:551.00px" class="cls_022"><span class="cls_022">types</span><span class="cls_113"> 298-300</span></div>
<div style="position:absolute;left:66.18px;top:560.99px" class="cls_022"><span class="cls_022">splitters</span></div>
<div style="position:absolute;left:101.22px;top:560.99px" class="cls_113"><span class="cls_113">223-225</span></div>
<div style="position:absolute;left:285.18px;top:560.99px" class="cls_022"><span class="cls_022">developing reactive repositories</span><span class="cls_113"> 300</span></div>
<div style="position:absolute;left:66.18px;top:571.01px" class="cls_022"><span class="cls_022">Spring applications</span></div>
<div style="position:absolute;left:285.18px;top:571.01px" class="cls_022"><span class="cls_022">reactive Cassandra repositories</span><span class="cls_113"> 300-312</span></div>
<div style="position:absolute;left:75.18px;top:581.00px" class="cls_022"><span class="cls_022">automatic restart</span><span class="cls_113"> 23-24</span></div>
<div style="position:absolute;left:294.18px;top:581.00px" class="cls_022"><span class="cls_022">data modeling</span><span class="cls_113"> 303-304</span></div>
<div style="position:absolute;left:75.18px;top:590.99px" class="cls_022"><span class="cls_022">initializing</span></div>
<div style="position:absolute;left:121.20px;top:590.99px" class="cls_113"><span class="cls_113">6-17</span></div>
<div style="position:absolute;left:294.18px;top:590.99px" class="cls_022"><span class="cls_022">enabling Cassandra</span><span class="cls_113"> 301-303</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:342728px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background518.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_024"><span class="cls_024">496</span></div>
<div style="position:absolute;left:252.09px;top:26.96px" class="cls_109"><span class="cls_109">INDEX</span></div>
<div style="position:absolute;left:57.18px;top:50.99px" class="cls_022"><span class="cls_022">Spring Data</span><span class="cls_113"> </span><span class="cls_115">(continued)</span></div>
<div style="position:absolute;left:285.18px;top:50.99px" class="cls_022"><span class="cls_022">JDBC-based user store</span><span class="cls_113"> 89-92</span></div>
<div style="position:absolute;left:75.18px;top:60.98px" class="cls_022"><span class="cls_022">mapping domain types for Cassandra</span></div>
<div style="position:absolute;left:285.18px;top:60.98px" class="cls_022"><span class="cls_022">LDAP-backed user store</span><span class="cls_113"> 92-96</span></div>
<div style="position:absolute;left:90.18px;top:70.97px" class="cls_022"><span class="cls_022">persistence</span><span class="cls_113"> 304-309</span></div>
<div style="position:absolute;left:276.18px;top:70.97px" class="cls_022"><span class="cls_022">enabling</span><span class="cls_113"> 85-86</span></div>
<div style="position:absolute;left:75.18px;top:80.99px" class="cls_022"><span class="cls_022">writing</span><span class="cls_113"> 309-312</span></div>
<div style="position:absolute;left:276.18px;top:80.99px" class="cls_022"><span class="cls_022">knowing user</span><span class="cls_113"> 110-113</span></div>
<div style="position:absolute;left:66.18px;top:90.98px" class="cls_022"><span class="cls_022">writing reactive MongoDB repositories</span></div>
<div style="position:absolute;left:276.18px;top:90.98px" class="cls_022"><span class="cls_022">securing web requests</span><span class="cls_113"> 103-110</span></div>
<div style="position:absolute;left:84.18px;top:100.97px" class="cls_113"><span class="cls_113">312-320</span></div>
<div style="position:absolute;left:285.18px;top:100.97px" class="cls_022"><span class="cls_022">creating custom login page</span><span class="cls_113"> 106-108</span></div>
<div style="position:absolute;left:75.18px;top:110.99px" class="cls_022"><span class="cls_022">enabling Spring Data MongoDB</span><span class="cls_113"> 312-314</span></div>
<div style="position:absolute;left:285.18px;top:110.99px" class="cls_022"><span class="cls_022">CSRF forgery</span><span class="cls_113"> 109-110</span></div>
<div style="position:absolute;left:75.18px;top:120.98px" class="cls_022"><span class="cls_022">mapping domain types to documents</span></div>
<div style="position:absolute;left:285.18px;top:120.98px" class="cls_022"><span class="cls_022">logging out</span><span class="cls_113"> 109</span></div>
<div style="position:absolute;left:90.18px;top:130.97px" class="cls_113"><span class="cls_113">314-317</span></div>
<div style="position:absolute;left:285.18px;top:130.97px" class="cls_022"><span class="cls_022">securing requests</span><span class="cls_113"> 104-106</span></div>
<div style="position:absolute;left:75.18px;top:140.99px" class="cls_022"><span class="cls_022">writing reactive MongoDB repository</span></div>
<div style="position:absolute;left:267.18px;top:140.99px" class="cls_022"><span class="cls_022">Spring Tool Suite</span></div>
<div style="position:absolute;left:90.18px;top:150.98px" class="cls_022"><span class="cls_022">interfaces</span><span class="cls_113"> 317-320</span></div>
<div style="position:absolute;left:276.18px;top:150.98px" class="cls_022"><span class="cls_022">initializing projects with</span><span class="cls_113"> 466-470</span></div>
<div style="position:absolute;left:57.18px;top:160.97px" class="cls_022"><span class="cls_022">Spring Data JPA (Java Persistence API)</span><span class="cls_113"> 75-83</span></div>
<div style="position:absolute;left:276.18px;top:160.97px" class="cls_022"><span class="cls_022">initializing Spring projects with</span><span class="cls_113"> 7-11</span></div>
<div style="position:absolute;left:66.18px;top:170.99px" class="cls_022"><span class="cls_022">adding to project</span><span class="cls_113"> 76</span></div>
<div style="position:absolute;left:267.18px;top:170.99px" class="cls_022"><span class="cls_022">Spring WebFlux</span><span class="cls_113"> 269-276</span></div>
<div style="position:absolute;left:66.18px;top:180.98px" class="cls_022"><span class="cls_022">annotating domain as entities</span><span class="cls_113"> 76-80</span></div>
<div style="position:absolute;left:276.18px;top:180.98px" class="cls_022"><span class="cls_022">overview</span><span class="cls_113"> 271-272</span></div>
<div style="position:absolute;left:66.18px;top:190.97px" class="cls_022"><span class="cls_022">customizing JPA repositories</span><span class="cls_113"> 81-83</span></div>
<div style="position:absolute;left:276.18px;top:190.97px" class="cls_022"><span class="cls_022">reactive controllers, writing</span><span class="cls_113"> 272-276</span></div>
<div style="position:absolute;left:66.18px;top:200.99px" class="cls_022"><span class="cls_022">declaring JPA repositories</span><span class="cls_113"> 80-81</span></div>
<div style="position:absolute;left:285.18px;top:200.99px" class="cls_022"><span class="cls_022">handling input reactively</span><span class="cls_113"> 275-276</span></div>
<div style="position:absolute;left:57.18px;top:210.98px" class="cls_022"><span class="cls_022">Spring Data MongoDB</span><span class="cls_113"> 312-320</span></div>
<div style="position:absolute;left:285.18px;top:210.98px" class="cls_022"><span class="cls_022">returning single values</span><span class="cls_113"> 274-275</span></div>
<div style="position:absolute;left:66.18px;top:221.00px" class="cls_022"><span class="cls_022">enabling</span><span class="cls_113"> 312-314</span></div>
<div style="position:absolute;left:285.18px;top:221.00px" class="cls_022"><span class="cls_022">RXJava types</span><span class="cls_113"> 275</span></div>
<div style="position:absolute;left:66.18px;top:230.99px" class="cls_022"><span class="cls_022">mapping domain types to documents</span><span class="cls_113"> 314-317</span></div>
<div style="position:absolute;left:276.18px;top:230.99px" class="cls_022"><span class="cls_022">writing reactive controllers</span><span class="cls_113"> 272-276</span></div>
<div style="position:absolute;left:66.18px;top:240.98px" class="cls_022"><span class="cls_022">writing reactive repository interfaces</span><span class="cls_113"> 317-320</span></div>
<div style="position:absolute;left:285.18px;top:240.98px" class="cls_022"><span class="cls_022">handling input reactively</span><span class="cls_113"> 275-276</span></div>
<div style="position:absolute;left:57.18px;top:251.00px" class="cls_022"><span class="cls_022">Spring Expression Language (SpEL)</span><span class="cls_113"> 212</span></div>
<div style="position:absolute;left:285.18px;top:251.00px" class="cls_022"><span class="cls_022">returning single values</span><span class="cls_113"> 274-275</span></div>
<div style="position:absolute;left:57.18px;top:260.99px" class="cls_022"><span class="cls_022">Spring Framework</span><span class="cls_113"> 26</span></div>
<div style="position:absolute;left:285.18px;top:260.99px" class="cls_022"><span class="cls_022">RXJava types</span><span class="cls_113"> 275</span></div>
<div style="position:absolute;left:57.18px;top:270.98px" class="cls_022"><span class="cls_022">spring init command</span><span class="cls_113"> 483</span></div>
<div style="position:absolute;left:267.18px;top:270.98px" class="cls_022"><span class="cls_022">spring.activemq.broker-url property</span><span class="cls_113"> 181</span></div>
<div style="position:absolute;left:57.18px;top:281.00px" class="cls_022"><span class="cls_022">Spring Integration</span><span class="cls_113"> 27-28, 209-237</span></div>
<div style="position:absolute;left:267.18px;top:281.00px" class="cls_022"><span class="cls_022">spring.activemq.in-memory property</span><span class="cls_113"> 181</span></div>
<div style="position:absolute;left:66.18px;top:290.99px" class="cls_022"><span class="cls_022">channel adapters</span><span class="cls_113"> 228-230</span></div>
<div style="position:absolute;left:267.18px;top:290.99px" class="cls_022"><span class="cls_022">spring.active.profiles property</span><span class="cls_113"> 353</span></div>
<div style="position:absolute;left:66.18px;top:300.98px" class="cls_022"><span class="cls_022">creating email integration flow</span><span class="cls_113"> 231-237</span></div>
<div style="position:absolute;left:267.18px;top:300.98px" class="cls_022"><span class="cls_022">SpringApplication class</span><span class="cls_113"> 16</span></div>
<div style="position:absolute;left:66.18px;top:311.00px" class="cls_022"><span class="cls_022">endpoint modules</span><span class="cls_113"> 230-231</span></div>
<div style="position:absolute;left:267.18px;top:311.00px" class="cls_022"><span class="cls_022">spring.application.name property</span><span class="cls_113"> 335, 353, 433</span></div>
<div style="position:absolute;left:66.18px;top:320.99px" class="cls_022"><span class="cls_022">filters</span></div>
<div style="position:absolute;left:92.79px;top:320.99px" class="cls_113"><span class="cls_113">219-220</span></div>
<div style="position:absolute;left:267.18px;top:320.99px" class="cls_022"><span class="cls_022">spring.boot.admin.client.metadata.user.name</span></div>
<div style="position:absolute;left:66.18px;top:330.98px" class="cls_022"><span class="cls_022">gateways</span><span class="cls_113"> 227-228</span></div>
<div style="position:absolute;left:285.18px;top:330.98px" class="cls_022"><span class="cls_022">property</span><span class="cls_113"> 444</span></div>
<div style="position:absolute;left:66.18px;top:341.00px" class="cls_022"><span class="cls_022">integration flows</span><span class="cls_113"> 210-216</span></div>
<div style="position:absolute;left:267.18px;top:341.00px" class="cls_022"><span class="cls_022">spring.boot.admin.client.metadata.user.password</span></div>
<div style="position:absolute;left:75.18px;top:350.99px" class="cls_022"><span class="cls_022">configuring in Java</span><span class="cls_113"> 213-215</span></div>
<div style="position:absolute;left:285.18px;top:350.99px" class="cls_022"><span class="cls_022">property</span><span class="cls_113"> 444</span></div>
<div style="position:absolute;left:75.18px;top:360.98px" class="cls_022"><span class="cls_022">defining with XML</span><span class="cls_113"> 211-213</span></div>
<div style="position:absolute;left:267.18px;top:360.98px" class="cls_022"><span class="cls_022">spring.boot.admin.client.url property</span><span class="cls_113"> 432</span></div>
<div style="position:absolute;left:75.18px;top:371.00px" class="cls_022"><span class="cls_022">using DSL configuration</span><span class="cls_113"> 215-216</span></div>
<div style="position:absolute;left:267.18px;top:370.99px" class="cls_022"><span class="cls_022">@SpringBootApplication annotation</span><span class="cls_113"> 15</span></div>
<div style="position:absolute;left:66.18px;top:380.99px" class="cls_022"><span class="cls_022">message channels</span><span class="cls_113"> 217-219</span></div>
<div style="position:absolute;left:267.18px;top:380.99px" class="cls_022"><span class="cls_022">@SpringBootConfiguration annotation</span><span class="cls_113"> 15</span></div>
<div style="position:absolute;left:66.18px;top:390.98px" class="cls_022"><span class="cls_022">routers</span><span class="cls_113"> 221-223</span></div>
<div style="position:absolute;left:267.18px;top:390.98px" class="cls_022"><span class="cls_022">SpringBootServletInitializr</span><span class="cls_113"> 456</span></div>
<div style="position:absolute;left:66.18px;top:401.00px" class="cls_022"><span class="cls_022">service activators</span><span class="cls_113"> 225-227</span></div>
<div style="position:absolute;left:267.18px;top:401.00px" class="cls_022"><span class="cls_022">@SpringBootTest annotation</span><span class="cls_113"> 17, 284</span></div>
<div style="position:absolute;left:66.18px;top:410.99px" class="cls_022"><span class="cls_022">splitters</span></div>
<div style="position:absolute;left:101.22px;top:410.99px" class="cls_113"><span class="cls_113">223-225</span></div>
<div style="position:absolute;left:267.18px;top:410.99px" class="cls_022"><span class="cls_022">spring.cassandra.contact-points property</span><span class="cls_113"> 302</span></div>
<div style="position:absolute;left:66.18px;top:420.98px" class="cls_022"><span class="cls_022">transformers</span><span class="cls_113"> 220-221</span></div>
<div style="position:absolute;left:267.18px;top:420.98px" class="cls_022"><span class="cls_022">spring.cassandra.keyspace-name property</span><span class="cls_113"> 302</span></div>
<div style="position:absolute;left:57.18px;top:431.00px" class="cls_022"><span class="cls_022">Spring overview</span><span class="cls_113"> 4-6</span></div>
<div style="position:absolute;left:267.18px;top:431.00px" class="cls_022"><span class="cls_022">spring.cassandra.port property</span><span class="cls_113"> 302</span></div>
<div style="position:absolute;left:57.18px;top:440.99px" class="cls_022"><span class="cls_022">Spring projects</span></div>
<div style="position:absolute;left:267.18px;top:440.99px" class="cls_022"><span class="cls_022">spring.cloud.config.discovery.enabled</span></div>
<div style="position:absolute;left:66.18px;top:451.01px" class="cls_022"><span class="cls_022">initializing</span></div>
<div style="position:absolute;left:285.18px;top:451.01px" class="cls_022"><span class="cls_022">property</span><span class="cls_113"> 353</span></div>
<div style="position:absolute;left:75.18px;top:461.00px" class="cls_022"><span class="cls_022">at start.spring.io</span></div>
<div style="position:absolute;left:142.95px;top:461.00px" class="cls_113"><span class="cls_113">477-479</span></div>
<div style="position:absolute;left:267.18px;top:461.00px" class="cls_022"><span class="cls_022">spring.cloud.config.server.encrypt.enabled</span></div>
<div style="position:absolute;left:75.18px;top:470.99px" class="cls_022"><span class="cls_022">from command line</span><span class="cls_113"> 480-484</span></div>
<div style="position:absolute;left:285.18px;top:470.99px" class="cls_022"><span class="cls_022">property</span><span class="cls_113"> 359</span></div>
<div style="position:absolute;left:75.18px;top:481.01px" class="cls_022"><span class="cls_022">with IntelliJ IDEA</span><span class="cls_113"> 470-472</span></div>
<div style="position:absolute;left:267.18px;top:481.01px" class="cls_022"><span class="cls_022">spring.cloud.config.server.git.default-label</span></div>
<div style="position:absolute;left:75.18px;top:491.00px" class="cls_022"><span class="cls_022">with NetBeans</span><span class="cls_113"> 473-476</span></div>
<div style="position:absolute;left:285.18px;top:491.00px" class="cls_022"><span class="cls_022">property</span><span class="cls_113"> 351</span></div>
<div style="position:absolute;left:75.18px;top:500.99px" class="cls_022"><span class="cls_022">with Spring Tool Suite</span><span class="cls_113"> 7-11, 466-470</span></div>
<div style="position:absolute;left:267.18px;top:500.99px" class="cls_022"><span class="cls_022">spring.cloud.config.server.git.search-paths</span></div>
<div style="position:absolute;left:66.18px;top:511.01px" class="cls_022"><span class="cls_022">structure</span><span class="cls_113"> 11-17</span></div>
<div style="position:absolute;left:285.18px;top:511.01px" class="cls_022"><span class="cls_022">property</span><span class="cls_113"> 351</span></div>
<div style="position:absolute;left:75.18px;top:521.00px" class="cls_022"><span class="cls_022">bootstrapping application</span><span class="cls_113"> 15-16</span></div>
<div style="position:absolute;left:267.18px;top:521.00px" class="cls_022"><span class="cls_022">spring.cloud.config.server.git.uri property</span><span class="cls_113"> 348</span></div>
<div style="position:absolute;left:75.18px;top:530.99px" class="cls_022"><span class="cls_022">build specification</span><span class="cls_113"> 12-15</span></div>
<div style="position:absolute;left:267.18px;top:530.99px" class="cls_022"><span class="cls_022">spring.cloud.config.token property</span><span class="cls_113"> 364</span></div>
<div style="position:absolute;left:75.18px;top:541.01px" class="cls_022"><span class="cls_022">SpringRunner</span><span class="cls_113"> 17</span></div>
<div style="position:absolute;left:267.18px;top:541.01px" class="cls_022"><span class="cls_022">spring.cloud.config.uri property</span><span class="cls_113"> 352</span></div>
<div style="position:absolute;left:75.18px;top:551.00px" class="cls_022"><span class="cls_022">testing application</span><span class="cls_113"> 16-17</span></div>
<div style="position:absolute;left:267.18px;top:551.00px" class="cls_022"><span class="cls_022">spring-cloud.version property</span><span class="cls_113"> 328</span></div>
<div style="position:absolute;left:57.18px;top:560.99px" class="cls_022"><span class="cls_022">Spring Security</span><span class="cls_113"> 27, 84-113</span></div>
<div style="position:absolute;left:267.18px;top:560.99px" class="cls_022"><span class="cls_022">spring.data.mongodb.database property</span><span class="cls_113"> 314</span></div>
<div style="position:absolute;left:66.18px;top:571.01px" class="cls_022"><span class="cls_022">configuring</span><span class="cls_113"> 86-103</span></div>
<div style="position:absolute;left:267.18px;top:571.01px" class="cls_022"><span class="cls_022">spring.data.mongodb.host property</span><span class="cls_113"> 314</span></div>
<div style="position:absolute;left:75.18px;top:581.00px" class="cls_022"><span class="cls_022">customizing user authentication</span><span class="cls_113"> 96-103</span></div>
<div style="position:absolute;left:267.18px;top:581.00px" class="cls_022"><span class="cls_022">spring.data.mongodb.password property</span><span class="cls_113"> 314,</span></div>
<div style="position:absolute;left:75.18px;top:590.99px" class="cls_022"><span class="cls_022">in-memory user store</span><span class="cls_113"> 88-89</span></div>
<div style="position:absolute;left:285.18px;top:590.99px" class="cls_113"><span class="cls_113">358</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:343404px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background519.jpg" width="531" height="666"></div>
<div style="position:absolute;left:261.09px;top:26.96px" class="cls_109"><span class="cls_109">INDEX</span></div>
<div style="position:absolute;left:460.05px;top:24.35px" class="cls_024"><span class="cls_024">497</span></div>
<div style="position:absolute;left:66.18px;top:50.99px" class="cls_022"><span class="cls_022">spring.data.mongodb.port property</span><span class="cls_113"> 314</span></div>
<div style="position:absolute;left:276.18px;top:50.99px" class="cls_022"><span class="cls_022">Traverson library, navigating REST APIs with</span></div>
<div style="position:absolute;left:66.18px;top:60.98px" class="cls_022"><span class="cls_022">spring.data.mongodb.username property</span><span class="cls_113"> 314</span></div>
<div style="position:absolute;left:294.18px;top:60.98px" class="cls_113"><span class="cls_113">175-177</span></div>
<div style="position:absolute;left:66.18px;top:70.97px" class="cls_022"><span class="cls_022">spring.datasource.data property</span><span class="cls_113"> 118</span></div>
<div style="position:absolute;left:276.18px;top:70.97px" class="cls_022"><span class="cls_022">turbine.app-config property</span><span class="cls_113"> 390</span></div>
<div style="position:absolute;left:66.18px;top:80.99px" class="cls_022"><span class="cls_022">spring.datasource.driver-class-name property</span><span class="cls_113"> 118</span></div>
<div style="position:absolute;left:66.18px;top:90.98px" class="cls_022"><span class="cls_022">spring.datasource.jndi-name property</span><span class="cls_113"> 118</span></div>
<div style="position:absolute;left:276.18px;top:90.65px" class="cls_112"><span class="cls_112">U</span></div>
<div style="position:absolute;left:66.18px;top:100.97px" class="cls_022"><span class="cls_022">spring.datasource.schema property</span><span class="cls_113"> 118</span></div>
<div style="position:absolute;left:66.18px;top:110.99px" class="cls_022"><span class="cls_022">spring.jms.template.default-destination</span></div>
<div style="position:absolute;left:276.18px;top:110.99px" class="cls_022"><span class="cls_022">UDT (user-defined type)</span><span class="cls_113"> 306</span></div>
<div style="position:absolute;left:84.18px;top:120.98px" class="cls_022"><span class="cls_022">property</span><span class="cls_113"> 184</span></div>
<div style="position:absolute;left:276.18px;top:120.98px" class="cls_022"><span class="cls_022">UI (user interface)</span><span class="cls_113"> 429</span></div>
<div style="position:absolute;left:66.18px;top:130.97px" class="cls_022"><span class="cls_022">SpringJUnit4ClassRunner</span><span class="cls_113"> 17</span></div>
<div style="position:absolute;left:276.18px;top:130.97px" class="cls_022"><span class="cls_022">update( ) method</span><span class="cls_113"> 63, 66</span></div>
<div style="position:absolute;left:66.18px;top:140.99px" class="cls_022"><span class="cls_022">spring.kafka.bootstrap-servers property</span><span class="cls_113"> 204</span></div>
<div style="position:absolute;left:276.18px;top:140.99px" class="cls_022"><span class="cls_022">uppercase( ) method</span><span class="cls_113"> 228</span></div>
<div style="position:absolute;left:66.18px;top:150.98px" class="cls_022"><span class="cls_022">spring.kafka.template.default-topic property</span><span class="cls_113"> 206</span></div>
<div style="position:absolute;left:276.18px;top:150.98px" class="cls_022"><span class="cls_022">url( ) method</span><span class="cls_113"> 94</span></div>
<div style="position:absolute;left:66.18px;top:160.97px" class="cls_022"><span class="cls_022">spring.main.web-application-type property</span><span class="cls_113"> 237</span></div>
<div style="position:absolute;left:276.18px;top:160.97px" class="cls_022"><span class="cls_022">user authentication, customizing</span><span class="cls_113"> 96-103</span></div>
<div style="position:absolute;left:66.18px;top:170.99px" class="cls_022"><span class="cls_022">spring.profiles property</span><span class="cls_113"> 130</span></div>
<div style="position:absolute;left:285.18px;top:170.99px" class="cls_022"><span class="cls_022">creating user-details service</span><span class="cls_113"> 98-100</span></div>
<div style="position:absolute;left:66.18px;top:180.98px" class="cls_022"><span class="cls_022">spring.profiles.active property</span><span class="cls_113"> 131</span></div>
<div style="position:absolute;left:285.18px;top:180.98px" class="cls_022"><span class="cls_022">defining user domain and persistence</span><span class="cls_113"> 96-98</span></div>
<div style="position:absolute;left:66.18px;top:190.97px" class="cls_022"><span class="cls_022">spring.rabbitmq.template.receive-timeout</span></div>
<div style="position:absolute;left:285.18px;top:190.97px" class="cls_022"><span class="cls_022">registering users</span><span class="cls_113"> 100-103</span></div>
<div style="position:absolute;left:84.18px;top:200.99px" class="cls_022"><span class="cls_022">property</span><span class="cls_113"> 201</span></div>
<div style="position:absolute;left:276.18px;top:200.99px" class="cls_022"><span class="cls_022">user interface (UI)</span><span class="cls_113"> 429</span></div>
<div style="position:absolute;left:66.18px;top:210.98px" class="cls_022"><span class="cls_022">SpringRunner</span><span class="cls_113"> 17</span></div>
<div style="position:absolute;left:276.18px;top:210.98px" class="cls_022"><span class="cls_022">user queries, default</span><span class="cls_113"> 90-91</span></div>
<div style="position:absolute;left:66.18px;top:221.00px" class="cls_022"><span class="cls_022">SQLException</span><span class="cls_113"> 58</span></div>
<div style="position:absolute;left:276.18px;top:221.00px" class="cls_022"><span class="cls_022">user-defined type (UDT)</span><span class="cls_113"> 306</span></div>
<div style="position:absolute;left:66.18px;top:230.99px" class="cls_022"><span class="cls_022">StandardPasswordEncoder</span><span class="cls_113"> 91</span></div>
<div style="position:absolute;left:276.18px;top:230.99px" class="cls_022"><span class="cls_022">@UserDefinedType annotation</span><span class="cls_113"> 307</span></div>
<div style="position:absolute;left:66.18px;top:240.98px" class="cls_022"><span class="cls_022">start.spring.io, initializing projects at</span></div>
<div style="position:absolute;left:213.39px;top:240.98px" class="cls_113"><span class="cls_113">477-479</span></div>
<div style="position:absolute;left:276.18px;top:240.98px" class="cls_022"><span class="cls_022">user-details service, creating</span><span class="cls_113"> 98-100</span></div>
<div style="position:absolute;left:66.18px;top:251.00px" class="cls_022"><span class="cls_022">StepVerifier</span><span class="cls_113"> 249</span></div>
<div style="position:absolute;left:276.18px;top:251.00px" class="cls_022"><span class="cls_022">userDetailsService( ) method</span><span class="cls_113"> 99, 295</span></div>
<div style="position:absolute;left:66.18px;top:260.99px" class="cls_022"><span class="cls_022">StreamUtils</span><span class="cls_113"> 282</span></div>
<div style="position:absolute;left:276.18px;top:260.99px" class="cls_022"><span class="cls_022">UsernameNotFoundException</span><span class="cls_113"> 98</span></div>
<div style="position:absolute;left:66.18px;top:270.98px" class="cls_022"><span class="cls_022">subscribe( ) method</span><span class="cls_113"> 244</span></div>
<div style="position:absolute;left:276.18px;top:270.98px" class="cls_022"><span class="cls_022">userPassword attribute</span><span class="cls_113"> 93</span></div>
<div style="position:absolute;left:66.18px;top:281.00px" class="cls_022"><span class="cls_022">System.currentTimeMillis( ) method</span></div>
<div style="position:absolute;left:214.29px;top:281.00px" class="cls_113"><span class="cls_113">205</span></div>
<div style="position:absolute;left:276.18px;top:281.00px" class="cls_022"><span class="cls_022">UserRepositoryUserDetailsService</span><span class="cls_113"> 99</span></div>
<div style="position:absolute;left:66.18px;top:290.99px" class="cls_022"><span class="cls_022">systemEnvironment property</span><span class="cls_113"> 407</span></div>
<div style="position:absolute;left:276.18px;top:290.99px" class="cls_022"><span class="cls_022">userSearchBase( ) method</span><span class="cls_113"> 93</span></div>
<div style="position:absolute;left:276.18px;top:300.98px" class="cls_022"><span class="cls_022">userSearchFilter( ) method</span><span class="cls_113"> 92</span></div>
<div style="position:absolute;left:66.18px;top:310.67px" class="cls_112"><span class="cls_112">T</span></div>
<div style="position:absolute;left:276.18px;top:320.66px" class="cls_112"><span class="cls_112">V</span></div>
<div style="position:absolute;left:66.18px;top:330.98px" class="cls_022"><span class="cls_022">@Table annotation</span><span class="cls_113"> 304</span></div>
<div style="position:absolute;left:66.18px;top:341.00px" class="cls_022"><span class="cls_022">take( ) method</span><span class="cls_113"> 258</span></div>
<div style="position:absolute;left:276.18px;top:341.00px" class="cls_022"><span class="cls_022">@Valid annotation</span><span class="cls_113"> 48</span></div>
<div style="position:absolute;left:66.18px;top:350.99px" class="cls_022"><span class="cls_022">template cache disable</span><span class="cls_113"> 24</span></div>
<div style="position:absolute;left:276.18px;top:350.99px" class="cls_022"><span class="cls_022">@Validated annotation</span><span class="cls_113"> 126</span></div>
<div style="position:absolute;left:66.18px;top:360.98px" class="cls_022"><span class="cls_022">testHomePage( ) method</span><span class="cls_113"> 21</span></div>
<div style="position:absolute;left:276.18px;top:360.98px" class="cls_022"><span class="cls_022">validating form input</span><span class="cls_113"> 45-51</span></div>
<div style="position:absolute;left:66.18px;top:371.00px" class="cls_022"><span class="cls_022">testing</span></div>
<div style="position:absolute;left:285.18px;top:371.00px" class="cls_022"><span class="cls_022">declaring validation rules</span><span class="cls_113"> 46-48</span></div>
<div style="position:absolute;left:75.18px;top:380.99px" class="cls_022"><span class="cls_022">applications</span><span class="cls_113"> 16-17</span></div>
<div style="position:absolute;left:285.18px;top:380.99px" class="cls_022"><span class="cls_022">displaying validation errors</span><span class="cls_113"> 49-51</span></div>
<div style="position:absolute;left:75.18px;top:390.98px" class="cls_022"><span class="cls_022">controller</span><span class="cls_113"> 20-21</span></div>
<div style="position:absolute;left:285.18px;top:390.98px" class="cls_022"><span class="cls_022">performing validation at form binding</span><span class="cls_113"> 48-49</span></div>
<div style="position:absolute;left:75.18px;top:401.00px" class="cls_022"><span class="cls_022">reactive controllers</span><span class="cls_113"> 279-285</span></div>
<div style="position:absolute;left:276.18px;top:401.00px" class="cls_022"><span class="cls_022">Vault</span><span class="cls_113"> 360-364</span></div>
<div style="position:absolute;left:84.18px;top:410.99px" class="cls_022"><span class="cls_022">testing GET requests</span><span class="cls_113"> 279-282</span></div>
<div style="position:absolute;left:285.18px;top:410.99px" class="cls_022"><span class="cls_022">enabling backend in Config Server</span><span class="cls_113"> 362-363</span></div>
<div style="position:absolute;left:84.18px;top:420.98px" class="cls_022"><span class="cls_022">testing POST requests</span><span class="cls_113"> 282-283</span></div>
<div style="position:absolute;left:285.18px;top:420.98px" class="cls_022"><span class="cls_022">setting token in Config Server clients</span><span class="cls_113"> 364</span></div>
<div style="position:absolute;left:84.18px;top:431.00px" class="cls_022"><span class="cls_022">testing with live server</span><span class="cls_113"> 284-285</span></div>
<div style="position:absolute;left:285.18px;top:431.00px" class="cls_022"><span class="cls_022">starting server</span><span class="cls_113"> 360-361</span></div>
<div style="position:absolute;left:66.18px;top:440.99px" class="cls_022"><span class="cls_022">textInChannel</span><span class="cls_113"> 214</span></div>
<div style="position:absolute;left:285.18px;top:440.99px" class="cls_022"><span class="cls_022">writing application and profile-specific</span></div>
<div style="position:absolute;left:66.18px;top:451.01px" class="cls_022"><span class="cls_022">threads, monitoring</span><span class="cls_113"> 440</span></div>
<div style="position:absolute;left:303.18px;top:451.01px" class="cls_022"><span class="cls_022">secrets</span><span class="cls_113"> 364</span></div>
<div style="position:absolute;left:66.18px;top:461.00px" class="cls_022"><span class="cls_022">Thymeleaf</span><span class="cls_113"> 14, 18-19, 478</span></div>
<div style="position:absolute;left:285.18px;top:461.00px" class="cls_022"><span class="cls_022">writing secrets to</span><span class="cls_113"> 361-362</span></div>
<div style="position:absolute;left:66.18px;top:470.99px" class="cls_022"><span class="cls_022">timeout( ) method</span><span class="cls_113"> 287</span></div>
<div style="position:absolute;left:276.18px;top:470.99px" class="cls_022"><span class="cls_022">version parameter</span><span class="cls_113"> 481</span></div>
<div style="position:absolute;left:66.18px;top:481.01px" class="cls_022"><span class="cls_022">toAnyEndpoint( ) method</span><span class="cls_113"> 428</span></div>
<div style="position:absolute;left:276.18px;top:481.01px" class="cls_022"><span class="cls_022">view controllers</span><span class="cls_113"> 51-52</span></div>
<div style="position:absolute;left:66.18px;top:491.00px" class="cls_022"><span class="cls_022">toIterable( ) method</span><span class="cls_113"> 299</span></div>
<div style="position:absolute;left:276.18px;top:491.00px" class="cls_022"><span class="cls_022">view template library, choosing</span></div>
<div style="position:absolute;left:66.18px;top:500.99px" class="cls_022"><span class="cls_022">Tomcat</span><span class="cls_113"> 22</span></div>
<div style="position:absolute;left:285.18px;top:500.99px" class="cls_022"><span class="cls_022">caching templates</span><span class="cls_113"> 54-55</span></div>
<div style="position:absolute;left:66.18px;top:511.01px" class="cls_022"><span class="cls_022">toObject( ) method</span><span class="cls_113"> 176</span></div>
<div style="position:absolute;left:285.18px;top:511.01px" class="cls_022"><span class="cls_022">general discussion</span><span class="cls_113"> 52-55</span></div>
<div style="position:absolute;left:66.18px;top:521.00px" class="cls_022"><span class="cls_022">toResource( ) method</span><span class="cls_113"> 156</span></div>
<div style="position:absolute;left:276.18px;top:521.00px" class="cls_022"><span class="cls_022">view, designing</span><span class="cls_113"> 35-40</span></div>
<div style="position:absolute;left:66.18px;top:530.99px" class="cls_022"><span class="cls_022">toRoman( ) method</span><span class="cls_113"> 220</span></div>
<div style="position:absolute;left:66.18px;top:541.01px" class="cls_022"><span class="cls_022">toString( ) method</span><span class="cls_113"> 31</span></div>
<div style="position:absolute;left:276.18px;top:540.68px" class="cls_112"><span class="cls_112">W</span></div>
<div style="position:absolute;left:66.18px;top:551.00px" class="cls_022"><span class="cls_022">toUser( ) method</span><span class="cls_113"> 103</span></div>
<div style="position:absolute;left:66.18px;top:560.99px" class="cls_022"><span class="cls_022">tracing HTTP requests, Admin server</span></div>
<div style="position:absolute;left:216.45px;top:560.99px" class="cls_113"><span class="cls_113">441-442</span></div>
<div style="position:absolute;left:276.18px;top:560.99px" class="cls_022"><span class="cls_022">WAR files, building and deploying</span><span class="cls_113"> 456-458</span></div>
<div style="position:absolute;left:66.18px;top:571.01px" class="cls_022"><span class="cls_022">@Transformer annotation</span><span class="cls_113"> 220</span></div>
<div style="position:absolute;left:276.18px;top:571.01px" class="cls_022"><span class="cls_022">web applications, developing</span><span class="cls_113"> 29-55</span></div>
<div style="position:absolute;left:66.18px;top:581.00px" class="cls_022"><span class="cls_022">transformerFlow( ) method</span><span class="cls_113"> 221</span></div>
<div style="position:absolute;left:285.18px;top:581.00px" class="cls_022"><span class="cls_022">displaying information</span><span class="cls_113"> 30-40</span></div>
<div style="position:absolute;left:66.18px;top:590.99px" class="cls_022"><span class="cls_022">transformers</span><span class="cls_113"> 220-221</span></div>
<div style="position:absolute;left:294.18px;top:590.99px" class="cls_022"><span class="cls_022">creating controller class</span><span class="cls_113"> 32-35</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:344080px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background520.jpg" width="531" height="666"></div>
<div style="position:absolute;left:57.18px;top:24.35px" class="cls_024"><span class="cls_024">498</span></div>
<div style="position:absolute;left:252.09px;top:26.96px" class="cls_109"><span class="cls_109">INDEX</span></div>
<div style="position:absolute;left:57.18px;top:50.99px" class="cls_022"><span class="cls_022">web applications, developing</span><span class="cls_113"> </span><span class="cls_115">(continued)</span></div>
<div style="position:absolute;left:267.18px;top:50.99px" class="cls_022"><span class="cls_022">WebSecurityConfigurerAdapter class</span><span class="cls_113"> 88, 292, 427</span></div>
<div style="position:absolute;left:75.18px;top:60.98px" class="cls_022"><span class="cls_022">designing view</span><span class="cls_113"> 35-40</span></div>
<div style="position:absolute;left:267.18px;top:60.98px" class="cls_022"><span class="cls_022">WebTestClient</span><span class="cls_113"> 281</span></div>
<div style="position:absolute;left:75.18px;top:70.97px" class="cls_022"><span class="cls_022">establishing domain</span><span class="cls_113"> 31-32</span></div>
<div style="position:absolute;left:267.18px;top:70.97px" class="cls_022"><span class="cls_022">withDetail( ) method</span><span class="cls_113"> 417</span></div>
<div style="position:absolute;left:66.18px;top:80.99px" class="cls_022"><span class="cls_022">processing form submission</span><span class="cls_113"> 40-45</span></div>
<div style="position:absolute;left:267.18px;top:80.99px" class="cls_022"><span class="cls_022">withUser( ) method</span><span class="cls_113"> 89</span></div>
<div style="position:absolute;left:66.18px;top:90.98px" class="cls_022"><span class="cls_022">validating form input</span><span class="cls_113"> 45-51</span></div>
<div style="position:absolute;left:267.18px;top:90.98px" class="cls_022"><span class="cls_022">wrapper scripts, Maven</span><span class="cls_113"> 11</span></div>
<div style="position:absolute;left:75.18px;top:100.97px" class="cls_022"><span class="cls_022">declaring validation rules</span><span class="cls_113"> 46-48</span></div>
<div style="position:absolute;left:267.18px;top:100.97px" class="cls_022"><span class="cls_022">writeToFile( ) method</span><span class="cls_113"> 211</span></div>
<div style="position:absolute;left:75.18px;top:110.99px" class="cls_022"><span class="cls_022">displaying validation errors</span><span class="cls_113"> 49-51</span></div>
<div style="position:absolute;left:267.18px;top:110.99px" class="cls_022"><span class="cls_022">writing data. </span><span class="cls_114">See</span><span class="cls_022"> reading and writing data, with</span></div>
<div style="position:absolute;left:75.18px;top:120.98px" class="cls_022"><span class="cls_022">performing validation at form binding</span></div>
<div style="position:absolute;left:285.18px;top:120.98px" class="cls_022"><span class="cls_022">JDBC</span></div>
<div style="position:absolute;left:90.18px;top:130.97px" class="cls_113"><span class="cls_113">48-49</span></div>
<div style="position:absolute;left:267.18px;top:130.97px" class="cls_022"><span class="cls_022">writing Spring applications</span><span class="cls_113"> 17-26</span></div>
<div style="position:absolute;left:66.18px;top:140.99px" class="cls_022"><span class="cls_022">view controllers</span><span class="cls_113"> 51-52</span></div>
<div style="position:absolute;left:276.18px;top:140.99px" class="cls_022"><span class="cls_022">building and running application</span><span class="cls_113"> 21-23</span></div>
<div style="position:absolute;left:66.17px;top:150.98px" class="cls_022"><span class="cls_022">view template library, choosing</span><span class="cls_113"> 52-55</span></div>
<div style="position:absolute;left:276.18px;top:150.98px" class="cls_022"><span class="cls_022">defining view</span><span class="cls_113"> 19</span></div>
<div style="position:absolute;left:57.17px;top:160.97px" class="cls_022"><span class="cls_022">Web dependency</span><span class="cls_113"> 478</span></div>
<div style="position:absolute;left:276.18px;top:160.97px" class="cls_022"><span class="cls_022">handling web requests</span><span class="cls_113"> 17-19</span></div>
<div style="position:absolute;left:57.17px;top:170.99px" class="cls_022"><span class="cls_022">web requests, securing</span><span class="cls_113"> 103-110</span></div>
<div style="position:absolute;left:276.18px;top:170.99px" class="cls_022"><span class="cls_022">Spring Boot DevTools use</span><span class="cls_113"> 23-25</span></div>
<div style="position:absolute;left:66.17px;top:180.98px" class="cls_022"><span class="cls_022">creating custom login page</span><span class="cls_113"> 106-108</span></div>
<div style="position:absolute;left:285.18px;top:180.98px" class="cls_022"><span class="cls_022">automatic application restart</span><span class="cls_113"> 23-24</span></div>
<div style="position:absolute;left:66.17px;top:190.97px" class="cls_022"><span class="cls_022">logging out</span><span class="cls_113"> 109</span></div>
<div style="position:absolute;left:285.18px;top:190.97px" class="cls_022"><span class="cls_022">automatic browser refresh and template cache</span></div>
<div style="position:absolute;left:66.17px;top:200.99px" class="cls_022"><span class="cls_022">preventing cross-site request forgery</span></div>
<div style="position:absolute;left:300.18px;top:200.99px" class="cls_022"><span class="cls_022">disable</span><span class="cls_113"> 24</span></div>
<div style="position:absolute;left:84.18px;top:210.98px" class="cls_022"><span class="cls_022">(CSRF)</span><span class="cls_113"> 109-110</span></div>
<div style="position:absolute;left:285.18px;top:210.98px" class="cls_022"><span class="cls_022">built in H2 console</span><span class="cls_113"> 25</span></div>
<div style="position:absolute;left:57.17px;top:221.00px" class="cls_022"><span class="cls_022">WebApplicationInitialier</span><span class="cls_113"> 456</span></div>
<div style="position:absolute;left:276.18px;top:221.00px" class="cls_022"><span class="cls_022">testing controller</span><span class="cls_113"> 20-21</span></div>
<div style="position:absolute;left:57.17px;top:230.99px" class="cls_022"><span class="cls_022">WebClient, consuming services with</span><span class="cls_113"> 339-340</span></div>
<div style="position:absolute;left:57.17px;top:240.98px" class="cls_022"><span class="cls_022">WebClientResponseException</span><span class="cls_113"> 289</span></div>
<div style="position:absolute;left:267.18px;top:240.65px" class="cls_112"><span class="cls_112">X</span></div>
<div style="position:absolute;left:57.17px;top:251.00px" class="cls_022"><span class="cls_022">webEnvironment attribute</span><span class="cls_113"> 284</span></div>
<div style="position:absolute;left:57.17px;top:260.99px" class="cls_022"><span class="cls_022">webhooks</span></div>
<div style="position:absolute;left:267.18px;top:260.99px" class="cls_022"><span class="cls_022">X-Config-Token header</span><span class="cls_113"> 363</span></div>
<div style="position:absolute;left:66.17px;top:270.98px" class="cls_022"><span class="cls_022">creating</span><span class="cls_113"> 368-371</span></div>
<div style="position:absolute;left:267.18px;top:270.98px" class="cls_022"><span class="cls_022">XML, defining integration flows using</span><span class="cls_113"> 211-213</span></div>
<div style="position:absolute;left:66.18px;top:281.00px" class="cls_022"><span class="cls_022">handling webhook updates in Config</span></div>
<div style="position:absolute;left:267.18px;top:281.00px" class="cls_022"><span class="cls_022">X-Vault-Token header</span><span class="cls_113"> 363</span></div>
<div style="position:absolute;left:84.18px;top:290.99px" class="cls_022"><span class="cls_022">Server</span><span class="cls_113"> 371-372</span></div>
<div style="position:absolute;left:66.18px;top:300.98px" class="cls_022"><span class="cls_022">overview of</span><span class="cls_113"> 367</span></div>
<div style="position:absolute;left:267.18px;top:300.68px" class="cls_112"><span class="cls_112">Z</span></div>
<div style="position:absolute;left:57.18px;top:311.00px" class="cls_022"><span class="cls_022">WebMvcConfigurer interface</span><span class="cls_113"> 51</span></div>
<div style="position:absolute;left:57.18px;top:320.99px" class="cls_022"><span class="cls_022">@WebMvcTest annotation</span><span class="cls_113"> 21, 52</span></div>
<div style="position:absolute;left:267.18px;top:320.99px" class="cls_022"><span class="cls_022">zip( ) method</span><span class="cls_113"> 254</span></div>
</div>
<div style="position:absolute;left:50%;margin-left:-265px;top:344756px;width:531px;height:666px;border-style:outset;overflow:hidden">
<div style="position:absolute;left:0px;top:0px">
<img src="./background521.jpg" width="531" height="666"></div>
<div style="position:absolute;left:34.02px;top:25.87px" class="cls_119"><span class="cls_119">JAVA</span></div>
<div style="position:absolute;left:73.17px;top:44.40px" class="cls_117"><span class="cls_117">Spring </span><span class="cls_118">IN ACTION Fifth Edition</span></div>
<div style="position:absolute;left:371.57px;top:77.52px" class="cls_120"><span class="cls_120">See first page</span></div>
<div style="position:absolute;left:154.67px;top:75.91px" class="cls_116"><span class="cls_116">Craig Walls</span></div>
<div style="position:absolute;left:55.15px;top:97.72px" class="cls_122"><span class="cls_122">pring Framework makes life easier for Java developers.</span></div>
<div style="position:absolute;left:55.15px;top:111.22px" class="cls_122"><span class="cls_122">New features in Spring 5 bring its productivity-focused</span></div>
<div style="position:absolute;left:34.02px;top:85.31px" class="cls_121"><span class="cls_121">S</span></div>
<div style="position:absolute;left:55.15px;top:124.72px" class="cls_122"><span class="cls_122">approach to microservices, reactive development, and</span></div>
<div style="position:absolute;left:357.67px;top:125.28px" class="cls_127"><span class="cls_127">This new edition is a</span></div>
<div style="position:absolute;left:34.02px;top:138.22px" class="cls_122"><span class="cls_122">other modern application designs. With Spring Boot now</span></div>
<div style="position:absolute;left:345.25px;top:120.28px" class="cls_129"><span class="cls_129">“</span></div>
<div style="position:absolute;left:336.24px;top:140.28px" class="cls_127"><span class="cls_127">comprehensive update that</span></div>
<div style="position:absolute;left:34.02px;top:151.72px" class="cls_122"><span class="cls_122">fully integrated, you can start even complex projects with</span></div>
<div style="position:absolute;left:336.02px;top:155.28px" class="cls_127"><span class="cls_127">strikes the balance between</span></div>
<div style="position:absolute;left:34.02px;top:165.22px" class="cls_122"><span class="cls_122">minimal configuration code. And the upgraded WebFlux</span></div>
<div style="position:absolute;left:342.54px;top:170.28px" class="cls_127"><span class="cls_127">practical instruction and</span></div>
<div style="position:absolute;left:34.02px;top:178.72px" class="cls_122"><span class="cls_122">framework supports reactive apps right out of the box!</span></div>
<div style="position:absolute;left:341.63px;top:185.78px" class="cls_127"><span class="cls_127">comprehensive theory.</span></div>
<div style="position:absolute;left:34.02px;top:197.56px" class="cls_123"><span class="cls_123">Spring in Action, Fifth Edition</span><span class="cls_122"> guides you through Spring’s core</span></div>
<div style="position:absolute;left:453.98px;top:179.78px" class="cls_129"><span class="cls_129">”</span></div>
<div style="position:absolute;left:363.82px;top:204.10px" class="cls_126"><span class="cls_126">—Daniel Vaughan</span></div>
<div style="position:absolute;left:34.02px;top:212.70px" class="cls_122"><span class="cls_122">features, explained in Craig Walls’ famously clear style. You’ll</span></div>
<div style="position:absolute;left:331.34px;top:216.10px" class="cls_126"><span class="cls_126">European Bioinformatics Institute</span></div>
<div style="position:absolute;left:34.02px;top:226.20px" class="cls_122"><span class="cls_122">roll up your sleeves and build a secure database-backed web</span></div>
<div style="position:absolute;left:34.02px;top:239.70px" class="cls_122"><span class="cls_122">app step by step. Along the way, you’ll explore reactive pro-</span></div>
<div style="position:absolute;left:339.81px;top:240.10px" class="cls_127"><span class="cls_127">The go-to book for learning</span></div>
<div style="position:absolute;left:34.02px;top:253.20px" class="cls_122"><span class="cls_122">gramming, microservices, service discovery, RESTful APIs,</span></div>
<div style="position:absolute;left:327.39px;top:235.10px" class="cls_129"><span class="cls_129">“</span></div>
<div style="position:absolute;left:329.13px;top:255.10px" class="cls_127"><span class="cls_127">the Spring Framework and an</span></div>
<div style="position:absolute;left:34.02px;top:266.70px" class="cls_122"><span class="cls_122">deployment, and expert best practices. Whether you’re just</span></div>
<div style="position:absolute;left:335.10px;top:270.60px" class="cls_127"><span class="cls_127">excellent reference guide.</span></div>
<div style="position:absolute;left:34.02px;top:280.20px" class="cls_122"><span class="cls_122">discovering Spring or leveling up to Spring 5, this Manning</span></div>
<div style="position:absolute;left:460.51px;top:264.60px" class="cls_129"><span class="cls_129">”</span></div>
<div style="position:absolute;left:358.86px;top:288.92px" class="cls_126"><span class="cls_126">—Colin Joyce, Cisco</span></div>
<div style="position:absolute;left:34.02px;top:293.70px" class="cls_122"><span class="cls_122">classic is your ticket!</span></div>
<div style="position:absolute;left:351.49px;top:312.92px" class="cls_127"><span class="cls_127">Everything you need to</span></div>
<div style="position:absolute;left:34.02px;top:320.75px" class="cls_124"><span class="cls_124">What’s Inside</span></div>
<div style="position:absolute;left:339.07px;top:307.92px" class="cls_129"><span class="cls_129">“</span></div>
<div style="position:absolute;left:344.91px;top:327.92px" class="cls_127"><span class="cls_127">know about Spring and</span></div>
<div style="position:absolute;left:44.46px;top:340.55px" class="cls_125"><span class="cls_125"><sup>●</sup></span><span class="cls_122"> Building reactive applications</span></div>
<div style="position:absolute;left:338.83px;top:342.92px" class="cls_127"><span class="cls_127">how to build cloud-native</span></div>
<div style="position:absolute;left:44.46px;top:356.35px" class="cls_125"><span class="cls_125"><sup>●</sup></span><span class="cls_122"> Spring </span><span class="cls_126">MVC</span><span class="cls_122"> for web apps and </span><span class="cls_126">REST</span><span class="cls_122">ful web services</span></div>
<div style="position:absolute;left:371.00px;top:357.92px" class="cls_127"><span class="cls_127">applications.</span></div>
<div style="position:absolute;left:44.46px;top:372.15px" class="cls_125"><span class="cls_125"><sup>●</sup></span><span class="cls_122"> Securing applications with Spring Security</span></div>
<div style="position:absolute;left:434.36px;top:351.92px" class="cls_129"><span class="cls_129">”</span></div>
<div style="position:absolute;left:337.34px;top:376.24px" class="cls_126"><span class="cls_126">—David Witherspoon, Parsons</span></div>
<div style="position:absolute;left:44.46px;top:387.95px" class="cls_125"><span class="cls_125"><sup>●</sup></span><span class="cls_122"> Covers Spring 5.0</span></div>
<div style="position:absolute;left:369.41px;top:400.24px" class="cls_127"><span class="cls_127">This book is the</span></div>
<div style="position:absolute;left:34.02px;top:413.84px" class="cls_122"><span class="cls_122">For intermediate Java developers.</span></div>
<div style="position:absolute;left:356.99px;top:395.24px" class="cls_129"><span class="cls_129">“</span></div>
<div style="position:absolute;left:358.79px;top:415.24px" class="cls_127"><span class="cls_127">Spring developer’s</span></div>
<div style="position:absolute;left:359.64px;top:430.74px" class="cls_127"><span class="cls_127">Swiss Army knife!</span></div>
<div style="position:absolute;left:34.02px;top:438.03px" class="cls_123"><span class="cls_123">Craig Walls</span><span class="cls_122"> is a principal software engineer at Pivotal, a popu-</span></div>
<div style="position:absolute;left:448.97px;top:424.74px" class="cls_129"><span class="cls_129">”</span></div>
<div style="position:absolute;left:359.83px;top:449.06px" class="cls_126"><span class="cls_126">—Riccardo Noviello</span></div>
<div style="position:absolute;left:34.02px;top:453.17px" class="cls_122"><span class="cls_122">lar author, an enthusiastic supporter of Spring Framework,</span></div>
<div style="position:absolute;left:349.41px;top:461.06px" class="cls_126"><span class="cls_126">Nuvio Software Solutions</span></div>
<div style="position:absolute;left:34.02px;top:466.67px" class="cls_122"><span class="cls_122">and a frequent conference speaker.</span></div>
<div style="position:absolute;left:50.18px;top:505.27px" class="cls_128"><span class="cls_128">To download their free eBook in PDF, ePub, and Kindle formats,</span></div>
<div style="position:absolute;left:113.11px;top:517.27px" class="cls_128"><span class="cls_128">owners of this book should visit</span></div>
<div style="position:absolute;left:79.40px;top:529.27px" class="cls_128"><span class="cls_128">manning.com/books/spring-in-action-fifth-edition</span></div>
<div style="position:absolute;left:33.51px;top:561.62px" class="cls_131"><span class="cls_131">Over 100,000 copies sold!</span></div>
<div style="position:absolute;left:153.13px;top:621.53px" class="cls_132"><span class="cls_132">$49.99 / Can $65.99  </span><span class="cls_133">[INCLUDING eBOOK]</span></div>
<div style="position:absolute;left:71.87px;top:619.07px" class="cls_134"><span class="cls_134">MANNING</span></div>
</div>



</body><div class="XTranslate"></div></html>